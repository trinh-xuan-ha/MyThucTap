;/*FB_PKG_DELIM*/

__d("EchoBackupCompareUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b;return{contentSubtype:a.contentSubtype,contentType:a.contentType,reactionTsList:(b=a.reactionAuthoritativeTimestampMs)==null?void 0:b.map(function(a){return a.displayName==null?null:Number(a.displayName)/1e3}).filter(Boolean).sort(),receiptTsList:(b=a.receiptStatusList)==null?void 0:b.map(function(a){return a.timestampMs==null?null:a.timestampMs/1e3}).filter(Boolean).sort()}}function g(a,b){if(a==null&&b==null)return!0;if(a!=null&&b!=null)return a.length===b.length&&a.every(function(a,c){return a===b[c]});return a==null&&(b==null?void 0:b.length)===0||b==null&&(a==null?void 0:a.length)===0?!0:!1}function b(a,b){return b!=null&&a.contentSubtype===b.contentSubtype&&a.contentType===b.contentType&&g(a.reactionTsList,b.reactionTsList)}f.buildEchoDocCacheValue=a;f.echoEquals=b}),66);
__d("EchoCommonUtils",[],(function(a,b,c,d,e,f){"use strict";c="Echo-Doc-Version";function a(a,b){var c=a.localKey;a=a.transportKey;return c+"@"+a+"-"+b}function b(a,b,c){return a==null?{localKey:b,transportKey:c}:{displayName:a,localKey:b,transportKey:c}}f.ECHO_COMMON_FIELD_DOCUMENT_VERSION=c;f.getEchoAddressFieldNameWithSuffix=a;f.craftEchoAddress=b}),66);
__d("EchoConstants",[],(function(a,b,c,d,e,f){"use strict";a=new Set(["\0","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f",'"'," ","(",")",",",":",";","<",">","@","[","]","\\"]);f.ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE=a}),66);
__d("EchoDecodingUtils",["invariant","EchoConstants","WALogger"],(function(a,b,c,d,e,f,g,h){"use strict";function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] "," not a valid number in echo message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Fail to decode if the input string does not have CRLF"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Address  decode failed with value: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid input to echoDecodeAddressList detected"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid transportKey in address detected"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid localKey in address detected"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] parse localKey in address failed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echoDecodeAddress failed"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] conditional quote mode decode failed"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid input to echoDecodeAddress"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Fail decoding because we didn't have a closing quote. Error Field: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Field name is blank"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] This is a raw line and we cannot decode its field name and value."]);u=function(){return a};return a}var v=new Set([]);function w(a,b){if(a.length===0)return;var c=a.indexOf(":");if(c===-1){d("WALogger").ERROR(u());return}var e=a.substring(0,c).trim();a=a.substring(c+1).trim();if(e.length===0){d("WALogger").ERROR(t());return}if(a.length===0){b.has(e)&&b["delete"](e);return}b.set(e,a)}function x(a,b,c,e){c===void 0&&(c=new Set());var f=!1,g=b==="conditional"&&a[0]==='"',h="",i=g?1:0;while(i<a.length){var j=a[i];if(b==="conditional"&&!g&&j==='"')break;if(!g&&c.has(j))break;if(g&&!f&&j==='"'){g=!1;i++;break}if(g&&!f&&j==="\\"){if(i===a.length-1)break;f=!0}else f&&j==="r"?h+="\r":f&&j==="n"?h+="\n":h+=j,f=!1;i++}if(g||h.length===0){c=(j=e)!=null?j:"unknown";d("WALogger").ERROR(s(),c);return{remainder:a,result:null,success:!1}}return{remainder:a.substring(i),result:h,success:!0}}function y(a,b){if(a.length===0){d("WALogger").ERROR(r());return{remainder:a,result:null,success:!1}}var c=a.trimLeft();c=x(c,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE,b);if(!c.success){d("WALogger").ERROR(q());return{remainder:a,result:null,success:!1}}c.result!=null||h(0,47923);if(c.remainder[0]==="@"){var e=z(c.remainder,c.result,b);return{remainder:e.remainder,result:e.result,success:e.success}}e=c.result;c=c.remainder.trimLeft();if(c.startsWith("<")){c=z(c.substring(1),void 0,b);b=c.result;var f=c.remainder;if(c.success&&b!=null&&f.startsWith(">"))if(e.length===0)return{remainder:f.substring(1),result:b,success:!0};else return{remainder:f.substring(1),result:babelHelpers["extends"]({},b,{displayName:e}),success:!0}}d("WALogger").ERROR(p());return{remainder:a,result:null,success:!1}}function z(a,b,c){var e=b==null?a.trimLeft():a;b=b;if(b==null){var f=x(e,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE,c);if(!f.success){d("WALogger").ERROR(o());return{remainder:a,result:null,success:!1}}b=f.result;e=f.remainder}if(b==null||b.length===0||e[0]!=="@"){d("WALogger").ERROR(n());return{remainder:a,result:null,success:!1}}f=x(e.substring(1),"never",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE,c);e=f.result;if(f.success&&e!=null&&e.length>0)return{remainder:f.remainder,result:{localKey:b,transportKey:e},success:!0};else{d("WALogger").ERROR(m());return{remainder:a,result:null,success:!1}}}function A(a,b){if(a.length===0){d("WALogger").ERROR(l());return{result:null,success:!1}}var c=y(a,b);if(!c.success){d("WALogger").ERROR(k(),a);return{result:null,success:!1}}c.result!=null||h(0,47927);a=[c.result];c=c.remainder;while(c.startsWith(",")){var e=y(c.substring(1).trimLeft(),b);if(e.success)e.result!=null&&a.push(e.result),c=e.remainder;else break}return{result:a,success:!0}}function a(a){var b=new Map(),c=a.split("\r\n");if(c.length===1&&c[0]===a){d("WALogger").ERROR(j());return b}c.forEach(function(a){return w(a,b)});return b}function b(a,b){a=a.get(b);if(a==null||a.length===0||a==='""')return{result:null,success:!1};a=x(a,"conditional",v,b);b=a.result;a=a.success;return{result:b,success:a}}function c(a,b){a=B(a,b);return{result:(b=a.result)!=null?b:0,success:a.success}}function B(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};a=parseInt(a,10);if(isNaN(a)){d("WALogger").ERROR(i(),b);return{result:null,success:!1}}else return Number.isSafeInteger(a)?{result:a,success:!0}:{result:a>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,success:!0}}function e(a,b){a=C(a,b);return{result:(b=a.result)!=null?b:!1,success:a.success}}function C(a,b){a=B(a,b);return!a.success||a.result!==0&&a.result!==1?{result:null,success:!1}:{result:a.result===1,success:!0}}function f(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};a=y(a,b);b=a.result;a=a.success;return{result:b,success:a}}function D(a,b){a=a.get(b);return a==null||a.length===0?{result:null,success:!1}:A(a,b)}function E(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};b=a.split(",").map(function(a){return a.trim()}).filter(Boolean);return b.length===0?{result:null,success:!1}:{result:b,success:!0}}g.echoDecodeFields=a;g.echoDecodeStringField=b;g.echoDecodeIntField=c;g.echoDecodeNullableIntField=B;g.echoDecodeBooleanField=e;g.echoDecodeNullableBooleanField=C;g.echoDecodeAddressField=f;g.echoDecodeAddressListField=D;g.echoDecodeObjectIdListField=E}),98);
__d("EchoEncodingUtils",["EchoConstants","EchoMessage","MAWMsgType","WABase64","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(['"',"\\","\n","\r","\0"]),i=new Set(["\0","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f",'"',"\\"]);function j(a,b){for(var b=b,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;if(a.indexOf(e)>=0)return!0}return!1}function k(a,b,d){d===void 0&&(d=new Set());if(a.length<=0)throw c("unrecoverableViolation")("The input string must be non-empty","labyrinth_web");var e=b;b==="conditional"&&(j(a,d)?e="always":e="never");if(e==="never")return a;b='"';for(d=0;d<a.length;d++){e=a[d];h.has(e)?(b+="\\",e==="\r"?b+="r":e==="\n"?b+="n":b+=e):b+=e}return b+'"'}function l(a){if(!Number.isSafeInteger(a))throw c("unrecoverableViolation")("The input value must be a safe integer","labyrinth_web");return a.toString()}function m(a){var b="",c=a.displayName,e=a.localKey;a=a.transportKey;c!=null&&c.length>0&&(b+=k(c,"always")+" <");b+=k(e,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE)+"@"+a;c!=null&&c.length>0&&(b+=">");return b}function n(a,b,c){c!=null&&c.length!==0&&a.set(b,k(c,"conditional",i))}function a(a,b,c){if(c!=null){c=l(c);n(a,b,c)}}function b(a,b,c){if(c!=null){c=l(c?1:0);n(a,b,c)}}function e(a,b,c){c!=null&&a.set(b,m(c))}function f(a,b,c){if(c!=null){var d="";c.forEach(function(a,b){d+=m(a),b<c.length-1&&(d+=", ")});a.set(b,d)}}function o(a){var b="";a.forEach(function(a,c){b=b+c+": "+a+"\r\n"});return b}function p(a){return d("WABase64").encodeB64UrlSafe(a)}function q(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("EchoMessage").EchoXMessageContentType.TEXT;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("EchoMessage").EchoXMessageContentType.IMAGE;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("EchoMessage").EchoXMessageContentType.VIDEO;case d("MAWMsgType").MSG_TYPE.PTT:return d("EchoMessage").EchoXMessageContentType.AUDIO;case d("MAWMsgType").MSG_TYPE.STICKER:return d("EchoMessage").EchoXMessageContentType.STICKER;case d("MAWMsgType").MSG_TYPE.GIF:return d("EchoMessage").EchoXMessageContentType.GIF;case d("MAWMsgType").MSG_TYPE.XMA:return d("EchoMessage").EchoXMessageContentType.XMA;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("EchoMessage").EchoXMessageContentType.DOCUMENT;case d("MAWMsgType").MSG_TYPE.REACTION:return d("EchoMessage").EchoXMessageContentType.REACTION;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("EchoMessage").EchoXMessageContentType.EPHEMERAL_SETTINGS;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("EchoMessage").EchoXMessageContentType.EPHEMERAL_SYNC_RESPONSE;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("EchoMessage").EchoXMessageContentType.MESSAGE_DELETE_FOR_ME;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("EchoMessage").EchoXMessageContentType.UNSEND;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("EchoMessage").EchoXMessageContentType.GROUP_INVITES;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return d("EchoMessage").EchoXMessageContentType.BUMP;default:return d("EchoMessage").EchoXMessageContentType.UNKNOWN}}function r(a){if(a==null)return void 0;switch(a){case d("EchoMessage").EchoXMessageContentType.TEXT:return d("MAWMsgType").MSG_TYPE.TEXT;case d("EchoMessage").EchoXMessageContentType.IMAGE:return d("MAWMsgType").MSG_TYPE.IMAGE;case d("EchoMessage").EchoXMessageContentType.VIDEO:return d("MAWMsgType").MSG_TYPE.VIDEO;case d("EchoMessage").EchoXMessageContentType.AUDIO:return d("MAWMsgType").MSG_TYPE.PTT;case d("EchoMessage").EchoXMessageContentType.STICKER:return d("MAWMsgType").MSG_TYPE.STICKER;case d("EchoMessage").EchoXMessageContentType.GIF:return d("MAWMsgType").MSG_TYPE.GIF;case d("EchoMessage").EchoXMessageContentType.XMA:return d("MAWMsgType").MSG_TYPE.XMA;case d("EchoMessage").EchoXMessageContentType.DOCUMENT:return d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE;case d("EchoMessage").EchoXMessageContentType.REACTION:return d("MAWMsgType").MSG_TYPE.REACTION;case d("EchoMessage").EchoXMessageContentType.EPHEMERAL_SETTINGS:return d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN;case d("EchoMessage").EchoXMessageContentType.EPHEMERAL_SYNC_RESPONSE:return d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE;case d("EchoMessage").EchoXMessageContentType.MESSAGE_DELETE_FOR_ME:return d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME;case d("EchoMessage").EchoXMessageContentType.UNSEND:return d("MAWMsgType").MSG_TYPE.REVOKED;case d("EchoMessage").EchoXMessageContentType.GROUP_INVITES:return d("MAWMsgType").MSG_TYPE.GROUP_INVITE;case d("EchoMessage").EchoXMessageContentType.BUMP:return d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE;default:return void 0}}g.echoSetStringField=n;g.echoSetIntField=a;g.echoSetBooleanField=b;g.echoSetAddressField=e;g.echoSetAddressListField=f;g.echoEncodeFields=o;g.convertMediaKeyToString=p;g.convertDbMsgTypeToXMessageContentType=q;g.convertXMessageContentTypeToDbMsgType=r}),98);
__d("EchoMessage",["$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils","EchoMessageMediaFieldUtils","EchoMessageMediaGroupFieldUtil","EchoMessageQuoteFieldUtils","EchoMessageReceiptStatusFieldUtils","EchoMessageXMAFieldUtils","FBLogger","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory xma data is missing from xma message, msgId: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fieldsMap is empty for the echo message"]);m=function(){return a};return a}var n="Message-ID",o="Thread-ID",p="Sort-Order",q="Display-Timestamp",r="Authoritative-Timestamp",s="From",t="Text",u="Text-Size",v="Send-Error",w="Is-Tombstoned",x="Expire-Timestamp",y="Delete-Timestamp",z="Ephemeral-Duration",A="Message-Content-Type",B="X-Message-Content-Type",C="Message-Content-Subtype",D="Is-Forwarded",E="X-Offline-Threading-ID",F="X-Thread-ID",G="X-Message-Placeholder-Type",H="Reactions",I="Reaction-Authoritative-Timestamps",J="X-Reaction-Offline-Threading-IDs",K="Echo-Serialization-Origin",L="Revoke-Sent-Timestamp",M="Revoke-Unsent-Timestamp",N="Edit-Count",O="Edit-Contents-",P="Edit-Timestamps-";f="Group-ID";var Q="Group-Index",R="Group-Size",S=1,T=(b=b("$InternalEnum"))({NONE:"none",SMALL:"small",MEDIUM:"medium",LARGE:"large"}),U=b({NONE:"none",UNSEND:"unsend"}),V=b({DECRYPTION_FAILURE:"decryption_failure",UNSUPPORTED_NEEDS_UPDATE:"unsupported_needs_update",TEXT:"text",ADMIN_MESSAGE:"admin_message",MEDIA:"media",XMA:"xma",NULL_STATE:"null_state",PLACEHOLDER:"placeholder"}),W=b({UNKNOWN:"unknown",TEXT:"text",IMAGE:"image",VIDEO:"video",AUDIO:"audio",STICKER:"sticker",GIF:"gif",URL:"url",EPHEMERAL_SETTINGS:"ephemeral_settings",LOCATION:"location",DOCUMENT:"document",UNSEND:"unsend",SCREENSHOT_ACTION:"screenshot_action",REACTION:"reaction",XMA:"xma",VISUAL_MESSAGE_VIDEO:"visual_message_video",VISUAL_MESSAGE_IMAGE:"visual_message_image",VISUAL_MESSAGE_ACTION:"visual_message_action",SCREEN_RECORDING_ACTION:"screen_recording_action",MESSAGE_DELETE_FOR_ME:"message_delete_for_me",ENCRYPTED_BACKUP_NEW_DEVICE_ENROLLMENT:"encrypted_backup_new_device_enrollment",SENDER_KEY:"sender_key",DELETE_THREAD:"delete_thread",READ_THREAD:"read_thread",UNREAD_THREAD:"unread_thread",REACTION_UNSEND:"reaction_unsend",GROUP_INVITES:"group_invites",EPHEMERAL_SYNC_RESPONSE:"ephemeral_sync_response",BUMP:"bump"}),X=b({NO_PLACEHOLDER:"0",DECRYPTION_FAILURE:"-1",CLIENT_NOT_SUPPORTED_NEED_UPDATE:"-2",UNAVIALABLE_DEVICE:"-3"}),Y=b({UNKNOWN:"Unknown",WEB:"Web",MOBILE:"Mobile"});function a(a){var b=new Map();fa(b,a);"mediaData"in a&&a.mediaData&&d("EchoMessageMediaFieldUtils").echoMessageSetMediaMetadataFields(b,a.mediaData);return d("EchoEncodingUtils").echoEncodeFields(b)}function Z(a,b){var c,e=[],f=new Set();b.forEach(function(c,g,h){c=g.startsWith(O);h=g.startsWith(P);if(c||h){h=g.slice(c?O.length:P.length);if(!f.has(h)){f.add(h);c=(g=d("EchoDecodingUtils").echoDecodeStringField(b,""+O+h).result)!=null?g:"";g=((g=d("EchoDecodingUtils").echoDecodeIntField(b,""+P+h).result)!=null?g:0)/1e3;e.push({messageId:h,originalMessageId:a,text:c,timestamp:g})}}});c=(c=d("EchoDecodingUtils").echoDecodeIntField(b,N).result)!=null?c:0;return{editCount:c,editHistory:e}}function e(a){a=d("EchoDecodingUtils").echoDecodeFields(a);if(a.size===0){d("WALogger").ERROR(m());return null}var b=d("EchoDecodingUtils").echoDecodeStringField(a,n),e=d("EchoDecodingUtils").echoDecodeStringField(a,o),f=d("EchoDecodingUtils").echoDecodeIntField(a,p),g=d("EchoDecodingUtils").echoDecodeIntField(a,q),N=d("EchoDecodingUtils").echoDecodeStringField(a,A),O=d("EchoDecodingUtils").echoDecodeStringField(a,B),P=d("EchoDecodingUtils").echoDecodeStringField(a,C);if(b.success&&e.success&&f.success){b=b.result;if(b==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("The decoded messageId cannot be null");e=e.result;if(e==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("The decoded threadId cannot be null");N=N==null?void 0:N.result;if(N==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("The decoded contentTypeString cannot be null");var Q=Z(b,a),R=Q.editCount;Q=Q.editHistory;P={contentSubtype:ca(P.result),contentType:aa(N),displayTimestampMs:g.success?g.result:f.result,editCount:R,editHistory:Q,messageId:b,sortOrderMs:f.result,threadId:e};N=ba(O.result);N!=null&&(P.xContentType=N);g=d("EchoDecodingUtils").echoDecodeAddressField(a,s);g.success&&g.result!=null&&(P.from=g.result);R=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,w);R.success&&R.result!=null&&(P.isTombstoned=R.result);Q=d("EchoDecodingUtils").echoDecodeStringField(a,t);Q.success&&Q.result!=null&&(P.text=Q.result);b=d("EchoDecodingUtils").echoDecodeStringField(a,u);if(b.success&&b.result!=null){f=$(b.result);P.textSize=f}e=d("EchoDecodingUtils").echoDecodeStringField(a,G);if(e.success&&e.result!=null){O=da(e.result);P.xMessagePlaceholderType=O}N=d("EchoDecodingUtils").echoDecodeStringField(a,v);N.success&&N.result!=null&&(P.sendError=N.result);g=d("EchoDecodingUtils").echoDecodeNullableIntField(a,x);g.success&&g.result!=null&&(P.expireTimestampMs=g.result);R=d("EchoDecodingUtils").echoDecodeNullableIntField(a,y);R.success&&R.result!=null&&(P.deleteTimestampMs=R.result);Q=d("EchoDecodingUtils").echoDecodeNullableIntField(a,z);Q.success&&Q.result!=null&&(P.ephemeralDurationInSec=Q.result);b=d("EchoDecodingUtils").echoDecodeNullableIntField(a,r);b.success&&b.result!=null&&(P.authoritativeTimestampMs=b.result);f=d("EchoMessageReceiptStatusFieldUtils").echoMessageDecodeReceiptStatusDataFields(a);f.length>0&&(P.receiptStatusList=f);e=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,D);e.success&&e.result!=null&&(P.isForwarded=e.result);d("EchoMessageMediaGroupFieldUtil").decodeMessageMediaGroupFields(a,P);O=d("EchoDecodingUtils").echoDecodeStringField(a,E);O.success&&O.result!=null&&(P.xOfflineThreadingId=O.result);N=d("EchoDecodingUtils").echoDecodeStringField(a,F);N.success&&N.result!=null&&(P.xThreadId=N.result);g=d("EchoDecodingUtils").echoDecodeStringField(a,K);g.success&&g.result!=null&&(P.serializationOrigin=ea(g.result));R=d("EchoDecodingUtils").echoDecodeNullableIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION);P.version=R.success&&R.result!=null?R.result:S;Q=d("EchoDecodingUtils").echoDecodeAddressListField(a,H);Q.success&&Q.result!=null&&(P.reactions=Q.result);b=d("EchoDecodingUtils").echoDecodeAddressListField(a,I);b.success&&b.result!=null&&(P.reactionAuthoritativeTimestampMs=b.result);f=d("EchoDecodingUtils").echoDecodeAddressListField(a,J);f.success&&f.result!=null&&(P.reactionXOfflineThreadingIds=f.result);e=d("EchoMessageQuoteFieldUtils").echoMessageDecodeQuoteFields(a);e!=null&&(P.quoteData=e);O=(P==null?void 0:P.contentType)===V.XMA&&a.has(d("EchoMessageMediaFieldUtils").ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_TYPE)&&(a.has(d("EchoMessageMediaFieldUtils").ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_ID)||a.has(d("EchoMessageMediaFieldUtils").ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_IDS));if((P==null?void 0:P.contentType)===V.MEDIA||O){N=d("EchoMessageMediaFieldUtils").echoMessageDecodeMediaDataFields(a,P==null?void 0:P.contentType,P==null?void 0:P.xContentType);g="[labyrinth_web] mandatory media data is missing from media message, msgId: "+P.messageId+".";N!=null?(N.length!==1&&N.length!==2&&((P==null?void 0:P.contentType)===V.MEDIA&&d("WALogger").ERROR(l(),g,P.serializationOrigin),(P==null?void 0:P.contentType)===V.XMA&&d("WALogger").WARN(k(),g,P.serializationOrigin)),P.mediaData=N[0],N.length===2&&(P.previewMediaData=N[1])):((P==null?void 0:P.contentType)===V.MEDIA&&d("WALogger").ERROR(j(),g,P.serializationOrigin),(P==null?void 0:P.contentType)===V.XMA&&d("WALogger").WARN(i(),g,P.serializationOrigin))}if(P.contentType===V.PLACEHOLDER&&P.contentSubtype===U.UNSEND){R=d("EchoDecodingUtils").echoDecodeNullableIntField(a,L);R.success&&R.result!=null&&(P.revokeSentTimestampMs=R.result);Q=d("EchoDecodingUtils").echoDecodeNullableIntField(a,M);Q.success&&Q.result!=null&&(P.revokeUnsentTimestampMS=Q.result)}if(P.contentType===V.XMA){b=d("EchoMessageXMAFieldUtils").decodeXMAFields(a);if(b!=null)P.xmaData=b;else{d("WALogger").ERROR(h(),P.messageId);return null}}return P}else return null}function $(a){return(a=T.cast(a))!=null?a:T.NONE}function aa(a){return(a=V.cast(a))!=null?a:V.TEXT}function ba(a){return W.cast(a)}function ca(a){return(a=U.cast(a))!=null?a:U.NONE}function da(a){return(a=X.cast(a))!=null?a:X.NO_PLACEHOLDER}function ea(a){return(a=Y.cast(a))!=null?a:Y.UNKNOWN}function fa(a,b){var c;(c=d("EchoEncodingUtils")).echoSetStringField(a,n,b.messageId);c.echoSetStringField(a,o,b.threadId);c.echoSetIntField(a,p,b.sortOrderMs);c.echoSetIntField(a,q,b.displayTimestampMs);c.echoSetIntField(a,r,b.authoritativeTimestampMs);c.echoSetAddressField(a,s,b.from);c.echoSetStringField(a,t,b.text);b.textSize!=null&&d("EchoEncodingUtils").echoSetStringField(a,u,b.textSize);b.xMessagePlaceholderType!=null&&d("EchoEncodingUtils").echoSetStringField(a,G,b.xMessagePlaceholderType);d("EchoEncodingUtils").echoSetStringField(a,v,b.sendError);d("EchoEncodingUtils").echoSetBooleanField(a,w,b.isTombstoned);d("EchoEncodingUtils").echoSetIntField(a,x,b.expireTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,y,b.deleteTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,z,b.ephemeralDurationInSec);b.contentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,A,b.contentType);b.xContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,B,b.xContentType);d("EchoMessageReceiptStatusFieldUtils").echoMessageSetReceiptStatusDataFields(a,b.receiptStatusList);d("EchoEncodingUtils").echoSetBooleanField(a,D,b.isForwarded);d("EchoEncodingUtils").echoSetStringField(a,E,b.xOfflineThreadingId);d("EchoEncodingUtils").echoSetStringField(a,F,b.xThreadId);d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION,b.version);b.contentSubtype!=null&&d("EchoEncodingUtils").echoSetStringField(a,C,b.contentSubtype);d("EchoEncodingUtils").echoSetAddressListField(a,H,b.reactions);d("EchoEncodingUtils").echoSetAddressListField(a,I,b.reactionAuthoritativeTimestampMs);d("EchoEncodingUtils").echoSetAddressListField(a,J,b.reactionXOfflineThreadingIds);d("EchoMessageQuoteFieldUtils").echoMessageSetQuoteFields(a,b);b.serializationOrigin!=null&&d("EchoEncodingUtils").echoSetStringField(a,K,b.serializationOrigin);b.revokeSentTimestampMs!=null&&d("EchoEncodingUtils").echoSetIntField(a,L,b.revokeSentTimestampMs);b.revokeUnsentTimestampMS!=null&&d("EchoEncodingUtils").echoSetIntField(a,M,b.revokeUnsentTimestampMS);d("EchoMessageMediaGroupFieldUtil").echoMessageSetMediaGroupFields(a,b);c=b.xmaData;c!=null&&d("EchoMessageXMAFieldUtils").echoMessageSetXMAFields(a,c);((c=b.editHistory)==null?void 0:c.length)>0&&(d("EchoEncodingUtils").echoSetIntField(a,N,b.editCount),b.editHistory.forEach(function(b){var c=b.messageId;c!=null&&(d("EchoEncodingUtils").echoSetStringField(a,O+c,b.text),d("EchoEncodingUtils").echoSetIntField(a,P+c,b.timestamp*1e3))}))}g.ECHO_SERIALIZATION_ORIGIN=K;g.ECHO_MESSAGE_FIELD_NAME_EDIT_COUNT=N;g.ECHO_MESSAGE_FIELD_NAME_EDIT_CONTENT_PREFIX=O;g.ECHO_MESSAGE_FIELD_NAME_EDIT_TS_PREFIX=P;g.ECHO_MESSAGE_FIELD_GROUP_ID=f;g.ECHO_MESSAGE_FIELD_GROUP_INDEX=Q;g.ECHO_MESSAGE_FIELD_GROUP_SIZE=R;g.ECHO_MESSAGE_MIGRATION_DOCUMENT_VERSION=S;g.MessageTextSize=T;g.EchoMessageContentSubtype=U;g.EchoMessageContentType=V;g.EchoXMessageContentType=W;g.EchoMessagePlaceholderType=X;g.EchoSerializationOriginType=Y;g.encodeEchoMessage=a;g.decodeEchoMessage=e}),98);
__d("EchoMessageMediaFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils","EchoMessage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid media attachment type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: can not parse objects ids. "," msgType: "," mediaType: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing enum fields from media fields: attachmentType: "," mediaPreviewContentType: "," mediaAttachmentType: "," EchoOrigin: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields. AttachmentType: "," EchoOrigin: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields. AttachmentType: "," EchoOrigin: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields. xAttachmentType: ",", AttachmentType: ",". EchoOrigin: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to get primary and secondary attachment object ids"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: primary attachment object id is null. msgType: "," mediaType: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing xAttachmentType field from required media metadata fields"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing xContentType field from required media metadata fields"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing plaintextHash field from required media metadata fields"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing direct path field from required media metadata fields"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing attachment type from required media metadata fields"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing attachment object id from required media metadata fields"]);u=function(){return a};return a}var v="X-Object-Id",w="X-Attachment-Object-Ids",x="Attachment-Type",y="Content-Type",z="X-Encrypted-Hash",A="X-Attachment-Type",B="X-Backup-Ent-Fbid",C="X-Backup-Status",D="X-Content-Type",E="X-Direct-Path",F="Height",G="X-Media-Key",H="X-Media-Key-Timestamp",I="Playable-Duration",J="Preview-Height",K="Preview-Content-Type",L="Preview-Width",M="Size",N="Width",O="X-Plaintext-Hash",P="File-Name",Q="Header-Attribution-Content-Type",R=(e=b("$InternalEnum"))({IMAGE:"image",STICKER:"sticker",VIDEO:"video",GIF:"animated_image",PTT:"audio",XMA:"xma",DOCUMENT:"document"}),S=e({IMAGE_JPEG:"image/jpeg",IMAGE_PNG:"image/png",STICKER:"image/webp",GIF:"image/gif",AUDIO_MP4:"audio/mp4",AUDIO_WAV:"audio/wav",XMA:"xma"}),T=e({INVALID:"-1",IMAGE:"0",PTT:"1",AUDIO:"2",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",PROFILE_PICTURE:"7",APP_STATE:"8",HISTORY_SYNC:"9",THUMBNAIL_IMAGE:"10",THUMBNAIL_VIDEO:"11",THUMBNAIL_GIF:"12",THUMBNAIL_DOCUMENT:"13",THUMBNAIL_LINK:"14",NOVI_IMAGE:"15",NOVI_VIDEO:"16",KYCID:"17",WAFFLE_IMAGE:"18",WAFFLE_VIDEO:"19",WAFFLE_GIF:"20",PAYMENT_BG_IMAGE:"21",XMA_IMAGE:"22",PAYMENT_BR_DOCUMENT:"23",BIZ_COVER_PHOTO:"24",MESSENGER_PREVIEW:"25"}),U=e({FULL:"full",PREVIEW:"preview"});function V(a){var b=a.attachmentObjectId,c=a.attachmentType,e=a.backupEntFbid,f=a.directPath,g=a.filename,h=a.encryptedHash,i=a.height,j=a.mediaBackupStatus,k=a.mediaContentType,l=a.mediaKey,m=a.mediaKeyTimestamp,n=a.mediaPlayableDuration,o=a.plaintextHash,v=a.previewContentHeight,w=a.previewContentType,x=a.previewContentWidth,y=a.size,z=a.width,A=a.xAttachmentType,B=a.xContentType;a=a.xmaData;if(b==null)d("WALogger").ERROR(u());else if(c==null)d("WALogger").ERROR(t());else if(f==null)d("WALogger").ERROR(s());else if(o==null)d("WALogger").ERROR(r());else if(B==null)d("WALogger").ERROR(q());else if(A==null)d("WALogger").ERROR(p());else return{attachmentObjectId:b,attachmentType:c,backupEntFbid:e,directPath:f,encryptedHash:h,filename:g,height:i,mediaBackupStatus:j,mediaContentType:k,mediaKey:l,mediaKeyTimestamp:m,mediaPlayableDuration:n,plaintextHash:o,previewContentHeight:v,previewContentType:w,previewContentWidth:x,size:y,width:z,xAttachmentType:A,xContentType:B,xmaData:a}}function a(a,b){var c;(c=d("EchoEncodingUtils")).echoSetStringField(a,v,b.attachmentObjectId);c.echoSetStringField(a,x,b.attachmentType);c.echoSetStringField(a,O,b.plaintextHash);c.echoSetStringField(a,z,b.encryptedHash);c.echoSetIntField(a,M,b.size);c.echoSetStringField(a,G,b.mediaKey);c.echoSetIntField(a,H,b.mediaKeyTimestamp);c.echoSetStringField(a,E,b.directPath);b.mediaContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,y,b.mediaContentType);d("EchoEncodingUtils").echoSetIntField(a,N,b.width);d("EchoEncodingUtils").echoSetIntField(a,F,b.height);b.previewContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,K,b.previewContentType);b.headerAttributionContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,Q,b.headerAttributionContentType);d("EchoEncodingUtils").echoSetIntField(a,L,b.previewContentWidth);d("EchoEncodingUtils").echoSetIntField(a,J,b.previewContentHeight);d("EchoEncodingUtils").echoSetIntField(a,I,b.mediaPlayableDuration);b.xAttachmentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,A,b.xAttachmentType);d("EchoEncodingUtils").echoSetStringField(a,D,b.xContentType);d("EchoEncodingUtils").echoSetStringField(a,B,b.backupEntFbid);d("EchoEncodingUtils").echoSetStringField(a,C,b.mediaBackupStatus);d("EchoEncodingUtils").echoSetStringField(a,P,b.filename)}function c(a,b,c){var e={},f=!1,g=!1,h=!1;if(aa(a)){var i=$(a,b,c);if(i==null){d("WALogger").ERROR(o(),b,c);return null}i.length!==2&&d("WALogger").ERROR(n());c=!1;var j=!1,k=i[0];i=i[1];var l={};f=Y(a,e,k);c=Y(a,l,i);g=X(a,e,b,k,k);j=X(a,l,b,i,k);h=W(a,e,k);k=W(a,l,i);if(!f||!g||!h||!c||!j||!k)return null;i=V(e);c=V(l);if(i!=null&&c!=null)return[i,c]}else{f=Y(a,e);g=X(a,e,b);h=W(a,e);if(!f||!g||!h)return null;j=V(e);if(j!=null)return[j]}return null}function W(a,b,c){var e;e=(e=a.get(d("EchoMessage").ECHO_SERIALIZATION_ORIGIN))!=null?e:"";c=[{fieldName:"height",id:F},{fieldName:"width",id:N},{fieldName:"size",id:M},{fieldName:"previewContentHeight",id:J},{fieldName:"previewContentWidth",id:L},{fieldName:"mediaKeyTimestamp",id:c!=null?c+"-"+H:H}];var f=[{attachmentTypes:[T.VIDEO,T.AUDIO],fieldName:"mediaPlayableDuration",id:I}];for(var g=0;g<f.length;g++){var h=f[g],i=h.attachmentTypes,j=h.fieldName;h=h.id;h=d("EchoDecodingUtils").echoDecodeIntField(a,h);var k=h.result;h=h.success;if(h&&k!=null)b[j]=k;else if(!(b.xAttachmentType!=null&&!Z(i,b.xAttachmentType)||b.attachmentType===R.XMA)){d("WALogger").ERROR(m(),j,b.xAttachmentType,b.attachmentType,e);return!1}}c.map(function(f){var c=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var e=f.result;f=f.success;f&&e!=null&&(b[c]=e)});return!0}function X(a,b,c,e,f){var g,h,i;g=(g=a.get(d("EchoMessage").ECHO_SERIALIZATION_ORIGIN))!=null?g:"";var j=[{fieldName:"filename",id:P}];e!=null&&f!=null?(b.attachmentObjectId=e,h=[{fieldName:"plaintextHash",id:e+"-"+O},{fieldName:"directPath",id:e+"-"+E},{fieldName:"xContentType",id:e+"-"+D}],j.push({fieldName:"mediaKey",id:e+"-"+G}),i=f+"-"+B,e=e+"-"+z):(h=[{fieldName:"attachmentObjectId",id:v},{fieldName:"plaintextHash",id:O},{fieldName:"directPath",id:E},{fieldName:"xContentType",id:D}],j.push({fieldName:"mediaKey",id:G}),i=B,e=z);j.push({fieldName:"backupEntFbid",id:i});j.push({fieldName:"mediaContentType",id:y});j.push({fieldName:"encryptedHash",id:e});i=f!=null?f+"-"+C:C;j.push({fieldName:"mediaBackupStatus",id:i});e=[];for(f=h,i=Array.isArray(f),h=0,f=i?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(i){if(h>=f.length)break;m=f[h++]}else{h=f.next();if(h.done)break;m=h.value}m=m;var n=m.fieldName;m=m.id;m=d("EchoDecodingUtils").echoDecodeStringField(a,m);var o=m.result;m=m.success;m&&o!=null?b[n]=o:e.push(n)}if(e.length>0){m=e.join(", ");c===d("EchoMessage").EchoMessageContentType.XMA?d("WALogger").WARN(l(),m,b.attachmentType,g):d("WALogger").ERROR(k(),m,b.attachmentType,g);return!1}j.map(function(f){var c=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeStringField(a,f);var e=f.result;f=f.success;f&&e!=null&&(b[c]=e)});return!0}function Y(a,b,c){var e;e=(e=a.get(d("EchoMessage").ECHO_SERIALIZATION_ORIGIN))!=null?e:"";var f=d("EchoDecodingUtils").echoDecodeStringField(a,x);f=f.result==="file"?R.DOCUMENT:R.cast(f.result);f!=null&&(b.attachmentType=f);var g=d("EchoDecodingUtils").echoDecodeStringField(a,K);g=S.cast(g.result);g!=null&&(b.previewContentType=g);var h=d("EchoDecodingUtils").echoDecodeStringField(a,Q);h=h.result;h!=null&&(b.headerAttributionContentType=h);h=d("EchoDecodingUtils").echoDecodeStringField(a,c!=null?c+"-"+A:A);h.success&&h.result!=null&&(a=ba(h.result),a!=null&&(b.xAttachmentType=a));if(f!=null&&(g!=null||f===R.DOCUMENT||f===R.PTT))return!0;else d("WALogger").ERROR(j(),f,g,h,e);return!1}function Z(a,b){return a.reduce(function(a,c){return a||c===b},!1)}function aa(a){return a.has(w)}function $(a,b,c){var e=d("EchoDecodingUtils").echoDecodeObjectIdListField(a,w),f=e.result;e=e.success;if(!e||f==null||f.length!==2){d("WALogger").ERROR(i(),f,b,c);return null}e=f.find(function(b){b=b+"-"+C;b=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=b.result;b=b.success;if(b&&c!=null)return!0});if(e!=null){b=e===f[0]?f[1]:f[0];return[e,b]}e=f.find(function(b){b=b+"-"+D;b=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=b.result;b=b.success;if(b&&c!=null&&U.cast(c)===U.FULL)return!0});if(e!=null){c=e===f[0]?f[1]:f[0];return[e,c]}return f}function ba(a){var b=T.cast(a);b==null&&d("WALogger").ERROR(h(),a);return(a=b)!=null?a:T.INVALID}g.ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_ID=v;g.ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_IDS=w;g.ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_TYPE=x;g.AttachmentType=R;g.EchoMessageMediaPreviewType=S;g.EchoMessageActMediaAttachmentType=T;g.convertMediaMetadataDetailsToMediaMetadata=V;g.echoMessageSetMediaMetadataFields=a;g.echoMessageDecodeMediaDataFields=c;g.setMediaIntFields=W;g.setMediaEnumFields=Y;g.getAttachmentObjectIdsFromMultiBlobMediaMsg=$}),98);
__d("EchoMessageMediaGroupFieldUtil",["EchoDecodingUtils","EchoEncodingUtils","EchoMessage"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b.groupId!=null&&d("EchoEncodingUtils").echoSetStringField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_ID,b.groupId),b.groupIndex!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_INDEX,b.groupIndex),b.groupSize!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_SIZE,b.groupSize)}function b(a,b){var c=d("EchoDecodingUtils").echoDecodeStringField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_ID);c.success&&c.result!=null&&(b.groupId=c.result);c=d("EchoDecodingUtils").echoDecodeIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_INDEX);c.success&&c.result!=null&&(b.groupIndex=c.result);c=d("EchoDecodingUtils").echoDecodeIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_SIZE);c.success&&c.result!=null&&(b.groupSize=c.result)}g.echoMessageSetMediaGroupFields=a;g.decodeMessageMediaGroupFields=b}),98);
__d("EchoMessageQuoteFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Reply-Message-Id",i="Reply-Message-Sender",j="Reply-Sort-Order",k="Reply-Type",l="Reply-Status",m=b("$InternalEnum").Mirrored(["BUMP"]),n=b("$InternalEnum")({VALID:"valid"});function a(a){var b={quoteMessageId:"<not set>",quoteMessageSender:{localKey:"<not set>",transportKey:"<not set>"},quoteSortOrderInMs:0},c=o(a,b),d=p(a,b),e=q(a,b);a=r(a,b);return!c||!d||!e||!a?null:b}function c(a,b){b=b.quoteData;if(b==null)return;d("EchoEncodingUtils").echoSetStringField(a,h,b.quoteMessageId);d("EchoEncodingUtils").echoSetAddressField(a,i,b.quoteMessageSender);d("EchoEncodingUtils").echoSetIntField(a,j,b.quoteSortOrderInMs);b.status!=null&&d("EchoEncodingUtils").echoSetStringField(a,l,b.status);b.replyType!=null&&d("EchoEncodingUtils").echoSetStringField(a,k,b.replyType)}function o(a,b){var c=[{fieldName:"quoteMessageSender",id:i}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeAddressField(a,f);var h=f.result;f=f.success;if(f&&h!=null)b[g]=h;else return!1}return!0}function p(a,b){var c=[{fieldName:"quoteMessageId",id:h}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeStringField(a,f);var i=f.result;f=f.success;if(f&&i!=null)b[g]=i;else return!1}return!0}function q(a,b){var c=[{fieldName:"quoteSortOrderInMs",id:j}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var h=f.result;f=f.success;if(f&&h!=null)b[g]=h;else return!1}return!0}function r(a,b){var c=d("EchoDecodingUtils").echoDecodeStringField(a,k);c=m.cast(c.result);c!=null&&(b.replyType=c);c=d("EchoDecodingUtils").echoDecodeStringField(a,l);a=n.cast(c.result);a!=null&&(b.status=a);return!0}g.EchoMessageQuoteReplyType=m;g.EchoMessageQuoteStatus=n;g.echoMessageDecodeQuoteFields=a;g.echoMessageSetQuoteFields=c}),98);
__d("EchoMessageReceiptStatusFieldUtils",["$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error occurred while decoding participants from echo doc, error: ",""]);h=function(){return a};return a}var i="Receipt-Status",j="Receipt-Timestamp",k=b("$InternalEnum")({UNKNOWN:"unknown",SENDING:"sending",SERVER_RECEIVED:"server_received",DELIVERED:"delivered",READ:"read",ERROR:"error",NON_RETRYABLE_ERROR:"non_retryable_error"});function a(a,b){if(b==null||b.length===0)return;b.forEach(function(b){d("EchoEncodingUtils").echoSetStringField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,i),b.status),b.timestampMs!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,j),b.timestampMs)})}function c(a){var b=[];l(a).forEach(function(c){var e=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(c,i);e=d("EchoDecodingUtils").echoDecodeStringField(a,e);if(e.success){e=(e=k.cast(e.result))!=null?e:k.UNKNOWN;var f=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(c,j);f=d("EchoDecodingUtils").echoDecodeNullableIntField(a,f);f.result!=null?b.push({address:c,status:e,timestampMs:f.result}):b.push({address:c,status:e})}});return b}function l(a){var b=new Set();for(var a=a.keys(),c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(f.includes(i))try{f=f.split("@");var g=f[0];f=m(f[1]);b.add({localKey:g,transportKey:f})}catch(a){d("WALogger").ERROR(h(),a)}}return Array.from(b)}function m(a){a=a.split(i);return a[0].split("-")[0]}g.MessageReceiptStatus=k;g.echoMessageSetReceiptStatusDataFields=a;g.echoMessageDecodeReceiptStatusDataFields=c}),98);
__d("EchoMessageXMAFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing xmaIsTombstoned from xma fields"]);k=function(){return a};return a}var l="XMA-Default-CTA",m="XMA-Gating-Type",n="XMA-Header-Subtitle",o="XMA-Header-Title",p="XMA-Is-Tombstoned",q="XMA-Layout-Type",r="XMA-Max-Subtitle-Num-Lines",s="XMA-Max-Title-Num-Lines",t="XMA-Subtitle-Text",u="XMA-Target-Expiry",v="XMA-Target-ID",w="XMA-Target-Type",x="XMA-Target-Username",y="XMA-Title-Text",z="XMA-Content-Ref",A=b("$InternalEnum").Mirrored(["SINGLE","HSCROLL","VSTACK","PORTRAIT"]),B=b("$InternalEnum").Mirrored(["NONE","IG_STORY_PHOTO_MENTION","IG_SINGLE_IMAGE_POST_SHARE","IG_MULTIPOST_SHARE","IG_SINGLE_VIDEO_POST_SHARE","IG_STORY_PHOTO_SHARE","IG_STORY_VIDEO_SHARE","IG_CLIPS_SHARE","IG_IGTV_SHARE","IG_SHOP_SHARE","IG_PROFILE_SHARE","IG_STORY_PHOTO_HIGHLIGHT_SHARE","IG_STORY_VIDEO_HIGHLIGHT_SHARE","IG_STORY_REPLY","IG_STORY_REACTION","FB_FEED_SHARE","FB_STORY_REPLY","FB_STORY_SHARE","FB_STORY_MENTION","FB_FEED_VIDEO_SHARE","FB_GAMING_CUSTOM_UPDATE","FB_PRODUCER_STORY_REPLY","MSG_EXTERNAL_LINK_SHARE","MSG_RECEIVER_FETCH","RTC_AUDIO_CALL","RTC_VIDEO_CALL","RTC_MISSED_AUDIO_CALL","RTC_MISSED_VIDEO_CALL","RTC_GROUP_AUDIO_CALL","RTC_GROUP_VIDEO_CALL","FB_EVENT"]),C=b("$InternalEnum").Mirrored(["NONE","PRIVATE","SENSITIVE","MISINFORMATION","MEDIA_LABEL","POST_COVER","POST_LABEL","WARNING_SCREENS","INFO","EYE_OFF","NEWS_OFF","WARNING"]);function a(a,b){b.xmaLayoutType!=null&&d("EchoEncodingUtils").echoSetStringField(a,q,b.xmaLayoutType),b.xmaTargetType!=null&&d("EchoEncodingUtils").echoSetStringField(a,w,b.xmaTargetType),d("EchoEncodingUtils").echoSetStringField(a,x,b.xmaTargetUsername),d("EchoEncodingUtils").echoSetStringField(a,v,b.xmaTargetId),b.xmaTargetExpiry!=null&&d("EchoEncodingUtils").echoSetIntField(a,u,b.xmaTargetExpiry),d("EchoEncodingUtils").echoSetStringField(a,l,b.xmaDefaultCTA),d("EchoEncodingUtils").echoSetStringField(a,o,b.xmaHeaderTitle),d("EchoEncodingUtils").echoSetStringField(a,n,b.xmaHeaderSubtitle),d("EchoEncodingUtils").echoSetStringField(a,y,b.xmaTitleText),d("EchoEncodingUtils").echoSetStringField(a,t,b.xmaSubtitleText),b.xmaMaxTitleNumLines!=null&&d("EchoEncodingUtils").echoSetIntField(a,s,b.xmaMaxTitleNumLines),b.xmaMaxSubtitleNumLines!=null&&d("EchoEncodingUtils").echoSetIntField(a,r,b.xmaMaxSubtitleNumLines),b.xmaGatingType!=null&&d("EchoEncodingUtils").echoSetStringField(a,m,b.xmaGatingType),d("EchoEncodingUtils").echoSetBooleanField(a,p,b.xmaIsTombstoned),b.xmaContentRef!=null&&d("EchoEncodingUtils").echoSetStringField(a,z,b.xmaContentRef)}function c(a){var b=F(a,p);if(b==null){d("WALogger").ERROR(k());return null}var c=C.cast(d("EchoDecodingUtils").echoDecodeStringField(a,m).result),e=A.cast(d("EchoDecodingUtils").echoDecodeStringField(a,q).result),f=B.cast(d("EchoDecodingUtils").echoDecodeStringField(a,w).result);return{xmaContentRef:D(a,z),xmaDefaultCTA:D(a,l),xmaGatingType:c,xmaHeaderSubtitle:D(a,n),xmaHeaderTitle:D(a,o),xmaIsTombstoned:b,xmaLayoutType:e,xmaMaxSubtitleNumLines:E(a,r),xmaMaxTitleNumLines:E(a,s),xmaSubtitleText:D(a,t),xmaTargetExpiry:E(a,u),xmaTargetId:D(a,v),xmaTargetType:f,xmaTargetUsername:D(a,x),xmaTitleText:D(a,y)}}function D(a,b){a=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=a.result;a=a.success;if(a&&c!=null)return c;else d("WALogger").WARN(j(),b)}function E(a,b){a=d("EchoDecodingUtils").echoDecodeIntField(a,b);var c=a.result;a=a.success;if(a&&c!=null)return c;else d("WALogger").WARN(i(),b)}function F(a,b){a=d("EchoDecodingUtils").echoDecodeBooleanField(a,b);var c=a.result;a=a.success;if(a&&c!=null)return c;else d("WALogger").WARN(h(),b)}g.XMALayoutType=A;g.XMAContentType=B;g.XMAGatingType=C;g.echoMessageSetXMAFields=a;g.decodeXMAFields=c}),98);
__d("EncryptedBackupsAttachmentProductType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({MSGR:"msgr",IGD:"igd"});c=a;f["default"]=c}),66);
__d("LSEBPayloadSerializerError",[],(function(a,b,c,d,e,f){a=Object.freeze({INVALID_BACKUP_OPERATION:-7,INVALID_CONTENT_TYPE:-6,INVALID_PAYLOAD_FORMAT:-5,CQL_DB_ERROR:-4,REQUIRED_COLUMN_NOT_PRESENT_ON_CLIENT:-3,DEPRECATED_SPROC:-2,UNKNOWN_ERROR:-1,NOT_AN_ERROR:0,BACKUP_NOT_FOUND:1,REQUIRED_TABLE_NOT_FOUND:2,NATIVE_OP_NOT_FOUND:3,BACKUP_UPLOAD_KILLSWITCHED:4,TASK_ID_NOT_FOUND:5,NOT_IMPLEMENTED:6,NOT_SUPPORTED_ON_WEB:7,DUPLICATE_TASK:8,CLIENT_STATE_NOT_LOADED:9,RECOVERY_CODE_NOT_FOUND:10,EPOCH_KEYS_NOT_FOUND:11,DEVICE_PAYLOAD_NOT_CREATED:12,NULL_DEVICE_PAYLOAD:13,EPOCH_PAYLOAD_NOT_CREATED:14,NULL_EPOCH_PAYLOAD:15,VIRTUAL_DEVICE_PAYLOAD_NOT_CREATED:16,NULL_VIRTUAL_DEVICE_PAYLOAD:17,DEVICE_METADATA_NOT_FOUND:18,NO_MATCHING_DEVICE_PUBLIC_KEY:19,NULL_MAILBOX_ROOT_KEY:20,NULL_ENCRYPTION_VERSION:21,NULL_OCMF_KEY:22,NULL_EPOCH_KEYS:23,NULL_DEVICE_ID:24,OPE_KEY_DERIVATION_FAILED:25,MESSAGE_KEY_DERIVATION_FAILED:26,NULL_MAILBOX_ROOT_KEY_V2:27,ECHO_DOCUMENT_ENCODING_FAILED:30,ECHO_PAYLOAD_CREATION_DISABLED:31,MESSAGE_PAYLOAD_ENCRYPTION_FAILED:40,SERVER_THREAD_ID_NOT_FOUND_FOR_JID:52,UNKNOWN_PROTOBUF_TYPE:60,SUPPLEMENTARY_DATA_KEY_UNEXPECTED:61,PROTOBUF_ENCRYPTION_FAILED:62,PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE:63,PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE:64,SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE:65,SUPPLEMENTAL_ENCRYPTION_FAILED:66,PROTOBUF_CONTEXT_ROW_NOT_FOUND:67,PROTOBUF_FORMATTING_FAILED:68,SUPPLEMENTAL_FORMATTING_FAILED:69,PROTOBUF_ALREADY_DELETED:70,THREAD_PK_NOT_FOUND_FOR_JID:100,MESSAGE_DECRYPTION_FAILED:101,EPOCH_KEY_FETCH_FAILED:102,TOO_MANY_OPEN_EPOCHS:103,MESSAGE_RANGE_PREPARE_FAILURE:104,ECHO_DOCUMENT_RESTORE_FAILED:105,MISMATCH_POINT_QUERY_MESSAGE_AND_RANGE_LENGTH:106,INITIAL_THREADS_FETCH_FOR_RESTORE_FAILED:107,MISSING_SUPPLEMENTAL_KEY_CIPHERTEXT:108,SUPPLEMENTAL_KEY_DECRYPTION_FAILURE:109,DEVICE_ID_MISMATCH:110,RESTORE_TO_TAM_INFO:111,MISSING_SERVER_THREAD_KEY:112,EB_ADD_DEVICE_FOUND_NO_LOCAL_THREADS:113,EB_MORE_THREADS_IN_MAPPING_TABLE:114,MESSAGE_PK_NOT_FOUND_IN_CLIENT_MESSAGES:200,OTID_NOT_FOUND_IN_ACT_MESSAGES:201,THREAD_ID_NOT_FOUND_IN_ACT_THREADS:202,THREAD_PK_NOT_FOUND_IN_CLIENT_THREADS:203,FAILED_TO_GET_THREAD_SORT_KEY:204,MEDIA_INFO_INVALID:205,REVERB_DB_NOT_ENABLED_FOR_INSTAMADILLO:206,SKIPPED_EB_DISABLED:300,SKIPPED_THREAD_NOT_ELIGIBLE:301,SKIPPED_MESSAGE_NOT_ELIGIBLE:302,NO_EPOCHS_FOUND:400,LATEST_EPOCH_QUERY_BY_ID_FAILED:401,FOUND_EPOCH_WITH_NULL_ROOT_KEY:402,FOUND_EPOCH_WITH_NULL_ANON_ID:403,NO_RECOVERY_CODE:501,NO_ERROR:601,ERROR_GENERAL:602,UNKNOWN:603,ONBOARDING_MATERIAL_DERIVATION_FAILURE:604,NULL_DEVICE_HMAC:605,MISSING_LATEST_EPOCH_AT_ONBOARDING:606,NO_THREADS_TO_COMPARE:701,START_SORT_KEY_FAILURE:702,END_SORT_KEY_FAILURE:703,LOOPING_UPLOAD_PAYLOAD_NOT_FOUND:704,NULL_ECHO_IDENTIFIERS:705,ECHO_TIMESTAMP_CONVERSION_FAILED:706,ECHO_PROTOBUF_THREAD_ID_MISMATCH:707,ECHO_PROTOBUF_TIMESTAMP_MISMATCH:708,ECHO_PROTOBUF_OTID_MISMATCH:709,NULL_ECHO_DOCUMENT:710,INVALID_PROTOBUF_BACKUP_ACTION:711,EMPTY_ENCODED_ECHO_DOCUMENT:712,ECHO_DOCUMENT_ENCODING_UNKNOWN_ENCODING_ERROR:750,ECHO_DOCUMENT_ENCODING_MESSAGE_PK_NOT_FOUND_ERROR:751,ECHO_DOCUMENT_ENCODING_DISK_WRITE_CHECK_FAILED:752,ECHO_DOCUMENT_ENCODING_THREAD_TRANSPORT_ID_FETCH_FAILED:753,ECHO_DOCUMENT_ENCODING_FILE_WRITE_FAILED:754,ECHO_DOCUMENT_ENCODING_DISK_WRITE_DISABLED:755,ECHO_DOCUMENT_ENCODING_SHOULD_NOT_PERSIST:756,MISSING_SUPPLEMENTAL_DATA:757,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REPLY_PROXY_ERROR:758,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_QUERY_ERROR:759,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_ERROR:760,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_RECEIPTS_ERROR:761,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REACTIONS_ERROR:762,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_VISUAL_MESSAGE_ACTIONS_ERROR:763,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_POLLS_ERROR:764});f["default"]=a}),66);
__d("MAWBridgeThread",["MAWTimeUtils","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){var g=d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return!0},user:function(a){return!1}});return{authoritativeThreadKey:c,cannotReplyReason:a.cannotReplyReason,clientThreadKey:b,description:e,folder:a.folder,isGroup:g,jid:a.jid,lastActivityTs:d("MAWTimeUtils").ensureValidMillisTime(a.snippetMsgTs!=null&&d("WATimeUtils").fromMillisTime(a.snippetMsgTs)!==0?a.snippetMsgTs:f)||d("WATimeUtils").castToMillisTime(0),lastReadTs:d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs)||d("WATimeUtils").castToMillisTime(0),muteExpireTimeMs:(c=a.muteExpireTimeMs)!=null?c:0}}function b(a,b,c,d){return{lastActivityTimestampMs:c,lastReadWatermarkTs:b,markUnread:d,threadJid:a}}g.createBridgeThread=a;g.createBridgeThreadTimestampsUpdated=b}),98);
__d("MAWBridgeTypesCreators",["I64","MAWDbMsg","MAWImageUtils","MAWMsgType","WAGlobals","WAJids","WAMediaUtils","WATimeUtils","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return{threadJid:a}}function i(a){var b,c=a.ts;switch(a.type){case d("MAWMsgType").MSG_TYPE.REVOKED:c=(b=a.originalTs)!=null?b:a.ts;break;default:c=d("MAWDbMsg").getCanonicalTsFromMsg(a)}return{msgId:a.msgId,ts:c}}function b(a,b){b=b.map(i);return{messages:b,threadJid:a}}function e(a){return{ravenMsgId:a.msgId,threadJid:a.threadJid}}function f(a,b){return a.filter(function(a){return b===a.threadJid}).map(function(a){return a.msgId})}function j(a){var b,e=a.chatJid,f=a.filteredMsgIds,g=a.hasMediaForUI,h=a.media,i=a.offlineAttachmentId,j=a.ravenSettings;a=a.sortOrderMs;switch(h.mediaType){case"Image":return{duration:null,ephemeralMediaState:j==null?void 0:j.ephemeralMediaState,ephemeralMediaViewMode:j==null?void 0:j.ephemeralMediaViewMode,filesize:h.size,hasMedia:g,mediaId:h.mediaId,mediaType:h.mediaType,msgIds:f,offlineAttachmentId:i,plaintextHash:h.plaintextHash,previewHeight:(b=h.validatedImageInfo)==null?void 0:b.jpegThumbnailHeight,previewHeightLarge:(b=h.validatedImageInfo)==null?void 0:b.height,previewWidth:(b=h.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(b=h.validatedImageInfo)==null?void 0:b.width,sortOrderMs:d("WATimeUtils").castToMillisTime(a!=null?a:h.ts*1e3),threadJid:e,ts:d("WATimeUtils").castToUnixTime(a!=null?a/1e3:h.ts)};case"Video":return{duration:((b=h.validatedVideoInfo)==null?void 0:b.duration)!=null?((b=h.validatedVideoInfo)==null?void 0:b.duration)*1e3:0,ephemeralMediaState:j==null?void 0:j.ephemeralMediaState,ephemeralMediaViewMode:j==null?void 0:j.ephemeralMediaViewMode,filesize:h.size,hasMedia:g,mediaId:h.mediaId,mediaType:h.mediaType,msgIds:f,offlineAttachmentId:i,plaintextHash:h.plaintextHash,previewHeight:(b=h.validatedVideoInfo)==null?void 0:b.jpegThumbnailHeight,previewHeightLarge:(j=h.validatedVideoInfo)==null?void 0:j.height,previewWidth:(b=h.validatedVideoInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(j=h.validatedVideoInfo)==null?void 0:j.width,sortOrderMs:d("WATimeUtils").castToMillisTime(a!=null?a:h.ts*1e3),threadJid:e,ts:d("WATimeUtils").castToUnixTime(a!=null?a/1e3:h.ts)};case"Ptt":return{duration:((b=h.validatedAudioInfo)==null?void 0:b.duration)?h.validatedAudioInfo.duration*1e3:null,filesize:h.size,hasMedia:g,mediaId:h.mediaId,mediaType:h.mediaType,msgIds:f,offlineAttachmentId:i,plaintextHash:h.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(a!=null?a:h.ts*1e3),threadJid:e,ts:d("WATimeUtils").castToUnixTime(a!=null?a/1e3:h.ts)};case"Gif":return{duration:null,filesize:h.size,hasMedia:g,mediaId:h.mediaId,mediaType:h.mediaType,msgIds:h.msgIds,offlineAttachmentId:i,plaintextHash:h.plaintextHash,previewHeight:(j=h.validatedImageInfo)==null?void 0:j.jpegThumbnailHeight,previewHeightLarge:(b=h.validatedImageInfo)==null?void 0:b.height,previewWidth:(j=h.validatedImageInfo)==null?void 0:j.jpegThumbnailWidth,previewWidthLarge:(b=h.validatedImageInfo)==null?void 0:b.width,sortOrderMs:d("WATimeUtils").castToMillisTime(a!=null?a:h.ts*1e3),threadJid:e,ts:d("WATimeUtils").castToUnixTime(a!=null?a/1e3:h.ts)};case"Sticker":j=d("MAWImageUtils").boundHeightWidth((j=h.validatedImageInfo)==null?void 0:j.jpegThumbnailHeight,(b=h.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,128);b=j.height;j=j.width;return{duration:null,filesize:h.size,hasMedia:g,mediaId:h.mediaId,mediaType:h.mediaType,msgIds:h.msgIds,offlineAttachmentId:i,plaintextHash:h.plaintextHash,previewHeight:b,previewHeightLarge:b,previewWidth:j,previewWidthLarge:j,sortOrderMs:d("WATimeUtils").castToMillisTime(a!=null?a:h.ts*1e3),threadJid:e,ts:d("WATimeUtils").castToUnixTime(a!=null?a/1e3:h.ts)};case"DocumentFile":b={};for(var j=h.mediaEntries,k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}m=m;var n=m[0];m=m[1];m=d("WAMediaUtils").mediaEntryDataToRawData(h.plaintextHash,m);m=m.filename;m!=null&&(b[n]=m)}return{defaultFilename:(n=h.validatedDocumentFileInfo)==null?void 0:n.filename,duration:null,filenames:b,filesize:h.size,hasMedia:g,mediaId:h.mediaId,mediaType:h.mediaType,msgIds:f,offlineAttachmentId:i,plaintextHash:h.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(a!=null?a:h.ts*1e3),threadJid:e,ts:d("WATimeUtils").castToUnixTime(a!=null?a/1e3:h.ts)};default:h.mediaType;throw c("err")("[createBridgeMedia] Unsupported media type: "+h.mediaType)}}function k(a,b,c,e,f){return{chatJid:a,deliveredWatermarkTs:(a=c)!=null?a:d("WATimeUtils").castToUnixTime(0),fbid:b,lastReadActionTs:(c=f)!=null?c:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:(a=e)!=null?a:d("WATimeUtils").castToUnixTime(0)}}function l(a){var b=a.cannotReplyReason,c=a.folder,d=a.muteExpireTimeMs,e=a.snippetParams,f=a.snippetSenderContactId,g=a.snippetType;a=a.threadJid;return{cannotReplyReason:b,folder:c,muteExpireTimeMs:d,snippetContactIDs:e==null?void 0:e.contactIDs,snippetMentionJIDs:e==null?void 0:e.mentionJIDs,snippetParams:e==null?void 0:e.strings,snippetSenderContactId:f,snippetType:g,threadJid:a}}function m(a){return{chatJid:a.groupJid,memberAddMode:a.memberAddMode,threadName:a.name}}function n(a,b,c,e,f,g,i,j){return{description:i,lastActivityTs:b,lastMsgExternalId:j!==void 0?(h||(h=d("I64"))).of_string_opt(j):void 0,lastReadTs:(i=c)!=null?i:d("WATimeUtils").castToMillisTime(0),snippetContactIDs:f.contactIDs,snippetMentionJIDs:(b=f.mentionJIDs)!=null?b:[],snippetParams:f.strings,snippetSenderContactId:g,snippetType:e,threadJid:a}}function o(a){var b=a.bumpTimestampMs,c=a.description,d=a.isMessageAuthorMe,e=a.skipBumpTimestampValidation,f=a.skipServerThreadBump,g=a.snippetParams,h=a.snippetSenderContactId,i=a.snippetType;a=a.threadJid;return{bumpTimestampMs:b,description:c,isMessageAuthorMe:d,skipBumpTimestampValidation:(b=e)!=null?b:!1,skipServerThreadBump:(c=f)!=null?c:!1,snippetContactIDs:g.contactIDs,snippetMentionJIDs:(d=g.mentionJIDs)!=null?d:[],snippetParams:g.strings,snippetSenderContactId:h,snippetType:i,threadJid:a}}function p(a){var b;if(c("gkx")("239"))return 0;return!c("justknobx")._("2319")?d("MAWDbMsg").getOriginalTsFromMsg(a)*1e3:(b=a.sortOrderMs)!=null?b:d("MAWDbMsg").getOriginalTsFromMsg(a)*1e3}function q(a,b,d,e,f,g){g===void 0&&(g="before");b=b;if(b.length===0)return{chatJid:a,rangeExtensionType:null};if(d)return{chatJid:a,rangeExtensionType:{hasMoreBefore:e,maxMsgId:b[0].msgId,minMsgId:b[b.length-1].msgId,minMsgTs:p(b[b.length-1]),rangeKind:"initial"}};return c("gkx")("23927")?{chatJid:a,rangeExtensionType:{hasMoreAfter:f,hasMoreBefore:e,maxMsgId:b[0].msgId,maxMsgTs:p(b[0]),minMsgId:b[b.length-1].msgId,minMsgTs:p(b[b.length-1]),rangeKind:g==="before"?"before":"after"}}:{chatJid:a,rangeExtensionType:{hasMoreBefore:e,minMsgId:b[b.length-1].msgId,minMsgTs:p(b[b.length-1]),rangeKind:"extensionBefore"}}}function r(a){var b=d("WAJids").extractDeviceIDParts(d("WAGlobals").getMyDeviceJid()).userId;return s(a,b)}function s(a,b){var c=a.author,e=a.chatJid,f=a.reaction,g=a.reactToMsgId;a=a.ts;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:e,messageId:g,reaction:f,ts:a}}function t(a){var b=a.newestMsgId,c=a.newestMsgTs,e=a.oldestMsgId;a=a.thread;return{hasMoreAfter:!1,hasMoreBefore:!1,maxMsgId:b,maxMsgTs:c,minMsgId:e,minMsgTs:d("WATimeUtils").castToMillisTime(0),threadJid:a.jid}}function u(a){var b=d("WAJids").extractDeviceIDParts(d("WAGlobals").getMyDeviceJid()).userId,c=a.author,e=a.chatJid;a=a.reactToMsgId;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:e,messageId:a}}function v(a){return{creationTs:a.creationTs,creator:a.creator,groupJid:a.groupJid,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function w(a){var b=a.threadJid,c=a.inviteeJid;return{caption:a.caption,inviteCode:a.inviteCode,inviteeId:c,inviteExpireTs:a.inviteExpirationTs,inviterId:d("WAJids").extractUserId(a.inviterJid),threadJid:b}}function x(a){return{threadJid:a}}function y(a,b,c){return{senderId:d("WAJids").extractUserId(b),state:c,threadJid:a}}g.createBridgeUpdateE2EEMetadataParticipants=a;g.createBridgeDeleteMessages=b;g.createBridgeRavenAction=e;g.getMsgIdsFilteredByJid=f;g.createBridgeMedia=j;g.createBridgeReceivedReceipt=k;g.createBridgeUpdatedThread=l;g.createBridgeUpdatedGroupInfo=m;g.createBridgeBumpedThread=n;g.createBridgeBumpedThreadV2=o;g.createBridgeMsgsLoadedInfo=q;g.createBridgeUpsertReaction=r;g.createBridgeUpsertReactionWithMyUserId=s;g.createBridgeUpdateMessageRange=t;g.createBridgeDeleteReaction=u;g.createBridgeGroupInfo=v;g.createBridgeGroupInvite=w;g.createBridgeDeleteGroupInvite=x;g.createBridgeReceivedChatState=y}),98);
__d("WAErrorMessage",[],(function(a,b,c,d,e,f){"use strict";var g="NoErrorMessageProvided";function a(a){var b;a instanceof Error?b=a.message:typeof a==="string"?b=a:typeof a==="object"?typeof (a==null?void 0:a.description)==="string"?b=a.description:typeof (a==null?void 0:a.message)==="string"?b=a.message:b=g:b=g;return b}f.NO_ERROR_MESSAGE_PROVIDED=g;f.maybeGetMessageFromError=a}),66);
__d("MAWDbChunkTxns",["MAWMediaUtils","WAErrorMessage","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["MAWDbChunkTxns"]);b=function a(b,c,e,f,g){g===void 0&&(g=0);var n=d("MAWMediaUtils").genHMACPlaintextHash(c);return b.chunk.where("hashedPlaintextHash").equals(n).first().then(function(o){if(o){g>0&&m.LOG(l(),n);return o}else{var p={blobData:e,hashedPlaintextHash:n,mimetype:f,plaintextHash:c};return b.chunk.add(p).then(function(a){return babelHelpers["extends"]({},p,{chunkId:a})})["catch"](function(l){var o=d("WAErrorMessage").maybeGetMessageFromError(l);if(g>0){m.WARN(k(),n,o);m.ERROR(j(),o);throw l}else{m.WARN(i(),n,o);m.ERROR(h(),o);return a(b,c,e,f,g+1)}})}})};c=function(a,b){return n(a,b).then(function(a){return a!=null})};var n=function(a,b){return a.chunk.where("hashedPlaintextHash").equals(b).first()};e=function(a,b){return a.chunk.where("hashedPlaintextHash").anyOf(b).toArray().then(function(a){return new Map(a.map(function(a){return[a.hashedPlaintextHash,a]}))})};function a(a,b){return a.chunk.bulkGet(b)}f=function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.get({hashedPlaintextHash:b})};g.getOrCreateMediaChunk=b;g.hasMediaChunk=c;g.maybeGetChunkFromHash=n;g.maybeBulkGetChunksFromHash=e;g.bulkGetChunks=a;g.maybeGetChunkByPlaintextHash=f}),98);
__d("MAWJidUtils",["FBLogger","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){if(d("WAJids").isAuthorSystem(a)||b==null||e==null){c("FBLogger")("messenger_e2ee_web").warn("Failed to create protocolMsgId with externalId %s for a msg to edit",e);return}return{author:a,chat:b,externalId:e}}function a(a){var b;return h(a.author,a.threadJid,(b=a.externalId)!=null?b:a.editExternalId)}function b(a){return d("WAJids").isAuthorMe(a)?d("WAGlobals").getMyUserJid():a}g.maybeToProtocolMsgId=h;g.toProtocolMsgId=a;g.getAuthorJid=b}),98);
__d("MAWLoadReplyMediaTxns",["MAWDbChunkTxns","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWXMAUtils","WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""]);i=function(){return a};return a}function j(a,b,e){if(c("gkx")("2419")&&e!=null){e=d("MAWMediaUtils").genHMACPlaintextHash(e);return a.media.where("hashedPlaintextHash").equals(e).first().then(function(b){return b==null?[void 0,void 0]:d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){return a==null?[void 0,b]:[a,b]})})}else return a.media.get(b).then(function(b){return b==null?[void 0,void 0]:d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){return a==null?[void 0,b]:[a,b]})})}var k=new Set([(e=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,e.MEDIA_TYPE.GIF,e.MEDIA_TYPE.PTT,e.MEDIA_TYPE.STICKER,e.MEDIA_TYPE.VIDEO,e.MEDIA_TYPE.DOCUMENT_FILE]);function l(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.STICKER:b=a.validatedImageInfo;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:b=a.validatedVideoInfo;break}a=b||{};var c=a.jpegThumbnailHeight;a=a.jpegThumbnailWidth;return{replyMediaPreviewHeight:c,replyMediaPreviewWidth:a}}function m(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return!0;case d("MAWMsgType").MSG_TYPE.XMA:return d("MAWXMAUtils").isXMAShare(a.xmaMessageType);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").NOTE_REPLY:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return!1;default:return c("WAAssertUnreachable")(a.type)}}function n(a,b,c){return b==null?d("MAWDexieTable").dexieResolve():j(a,b,c).then(function(a){var c=a[0];a=a[1];if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!k.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");var e=l(a),f=e.replyMediaPreviewHeight;e=e.replyMediaPreviewWidth;var g;c!=null&&(g=c.mimetype);return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:f,replyMediaPreviewWidth:e,replyMediaUrlMimeType:g,replyPlaintextHash:a.plaintextHash})}).then(function(a){if(a.success!==!0){d("WALogger").ERROR(i(),b,a.error);return}return a.value})}function o(a,b){var c=b.defaultPreviewMediaId;return c==null?d("MAWDexieTable").dexieResolve({replyXMAId:b.xmaId}):j(a,c).then(function(a){var c=a[0];a=a[1];if(c==null||a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found");if(!k.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");a=l(a);var e=a.replyMediaPreviewHeight;a=a.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:e,replyMediaPreviewWidth:a,replyMediaUrlMimeType:c.mimetype,replyXMAId:b.xmaId})}).then(function(a){if(a.success!==!0){d("WALogger").ERROR(h(),b.xmaId,a.error);return}return a.value})}function a(a,b){var c,e;c=((c=b.quote)==null?void 0:c.content)||{};var f=c.author,g=c.externalId,h=c.mediaId,i=c.plaintextHash;c=c.xmaMessageType;if(((e=b.quote)==null?void 0:e.content)==null||!m((e=b.quote)==null?void 0:e.content))return d("MAWDexieTable").dexieResolve();e=b.threadJid;b=f===d("WAGlobals").getMyUserJid();b=b?d("WAJids").AUTHOR_ME:f;return d("MAWXMAUtils").isXMAShare(c)?p(a,d("MAWJidUtils").maybeToProtocolMsgId(b,e,g)):n(a,h,i)}function p(a,b){return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null||d("MAWXMAUtils").isXMAExpired(b.isTombstoned,b.targetExpiringAtSec))return;return o(a,b)})}function b(a,b){var c=b.author,e=b.externalId,f=b.mediaId,g=b.plaintextHash,h=b.threadJid,i=b.xmaMessageType;i=d("MAWXMAUtils").isXMAShare(i);return!d("MAWDbMsg").isMediaMsg(b)&&!i?d("MAWDexieTable").dexieResolve():i?p(a,d("MAWJidUtils").maybeToProtocolMsgId(c,h,e)):n(a,f,g)}g.MSG_MEDIA_TYPE=k;g.getImageAttributes=l;g.isMediaReplyContent=m;g.getReplyMediaForMsgQuote=a;g.getReplyMediaForMsg=b}),98);
__d("WAMsgMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this;this.$1=new Map();a==null?void 0:a.forEach(function(a){var c=a[0];a=a[1];b.set(c,a)})}var b=a.prototype;b.clear=function(){this.$1.clear()};b["delete"]=function(a){var b;(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b["delete"](a.chat)};b.get=function(a){var b;return(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b.get(a.chat)};b.has=function(a){var b;return(b=(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b.has(a.chat))!=null?b:!1};b.set=function(a,b){var c,d;c=(c=this.$1.get(a.externalId))!=null?c:new Map();this.$1.has(a.externalId)||this.$1.set(a.externalId,c);d=(d=c.get(a.author))!=null?d:new Map();c.has(a.author)||c.set(a.author,d);d.set(a.chat,b);return this};b.keys=function(){var a=[],b=this.$1;for(var c=b.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;f=(f=b.get(g))!=null?f:new Map();for(var h=f.keys(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(i){if(j>=h.length)break;l=h[j++]}else{j=h.next();if(j.done)break;l=j.value}l=l;k=(k=f.get(l))!=null?k:new Map();for(var k=k.keys(),m=Array.isArray(k),n=0,k=m?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=k.length)break;o=k[n++]}else{n=k.next();if(n.done)break;o=n.value}o=o;a.push({externalId:g,author:l,chat:o})}}}return a};b.entries=function(){var a=[],b=this.$1;for(var c=b.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;f=(f=b.get(g))!=null?f:new Map();for(var h=f.keys(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(i){if(j>=h.length)break;l=h[j++]}else{j=h.next();if(j.done)break;l=j.value}l=l;k=(k=f.get(l))!=null?k:new Map();for(var m=k.keys(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}p=p;var q=k.get(p);q!=null&&a.push([{externalId:g,author:l,chat:p},q])}}}return a};b.values=function(){return this.entries().map(function(a){return a[1]})};return a}();f.MsgMap=a}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"]);i=function(){return a};return a}function a(a){return a.reduce(function(a,b){var c=b.threadJid;if(c==null){d("WALogger").ERROR(i());return a}if(b.author==="@system"){d("WALogger").ERROR(h());return a}a.set({author:b.author,chat:c,externalId:b.externalId},b);return a},new(d("WAMsgMap").MsgMap)())}function b(a){return d("WAJids").isAuthorSystem(a.author)||a.threadJid==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}g.convertMsgArrayToMap=a;g.getProtocolMsgIdFromDbMsg=b}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"]);j=function(){return a};return a}function a(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_unrendered_msg"):k(a,f,e,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_unrendered_msg"):d("WAResultOrError").makeResult(a)})})}function b(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.unrenderedMessages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function k(a,b,c,d){return a.unrenderedMessages.where("externalId").equals(b).filter(function(a){return a.author===d&&a.threadJid===c}).first()}function l(a,b){return a+"_"+b}function c(a,b){var c=b.map(function(a){a=a.externalId;return a}),e=Array.from(new Set(b.map(function(a){return a.chat})));return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.unrenderedMessages.where("externalId").anyOf(c).toArray()]).then(function(a){var c=a[0];a=a[1];if(a.length===0||c.length===0)return[];var d=new Map();b.forEach(function(a){var b=a.author,c=a.chat;a=a.externalId;var e=d.get(a)||new Set();e.add(l(b,c));d.set(a,e)});return a.filter(function(a){var b=a.author,c=a.externalId;a=a.threadJid;c=d.get(c);return c!=null&&a!=null&&c.has(l(b,a))})})}function e(a,b,c){return m(a,[{ack:c,msgId:b}]).then(function(a){a=a[0];if(a==null){d("WALogger").LOG(j());return null}return a})}function m(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){return e.set(a.msgId,{ack:a.ack})});return a.unrenderedMessages.where("msgId").anyOf(c).toArray().then(function(b){if(b.length===0)return b;var c=[],f=[];b.forEach(function(a){var b;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());c.push(a);return}b=(b=e.get(a.msgId))==null?void 0:b.ack;if(b==null)return null;a=babelHelpers["extends"]({},a,{ack:b});b===d("MAWAckLevel").ACK.sent&&delete a.resendCount;f.push(a)});return a.unrenderedMessages.bulkPut(f).then(function(){return[].concat(f,c)})})}function f(a,b){b=b.map(function(b){return a.unrenderedMessages.get({msgId:b})});return d("MAWDexieTable").dexieAll(b)}function n(a,b){return a.unrenderedMessages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetUnrenderedMsgByProtocolMsgId=a;g.getUnrenderedMsgMapByProtocolMsgId=b;g.maybeGetUnrenderedMsgByExternalId=k;g.getUnrenderedMsgsByProtocolMsgId=c;g.updateSystemAckForUnrenderedMsg=e;g.bulkUpdateSystemAckForUnrenderedMsgs=m;g.getUnrenderedMsgsByMsgIds=f;g.getNextUnrenderedMsgIdNumberForThread=n}),98);
__d("MAWDbMsgTxns",["MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMsgType","MAWSharedMsgIdUtil","MAWUpdateThreadMsgMetadataApi","Random","WAJids","WALogger","WAMsgMap","WAResultOrError","WATimeUtils","err","gkx","justknobx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgsFromOffset() newest msg thread jid is not equal to thread jid.\n            msg.threadJid: ",",\n            thread.jid: ",",\n            thread.chatId: ",",\n            offsetMsgId: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgsFromOffset, fetched msgs length: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgsFromOffset input: offsetMsgId: ",", numMsgs: ",", includeOffset: ",", includeExpired: ",", direction: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByExternalId] Found "," messages with external id ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[CacheDiscrepancy] Thread "," has a discrepancy between the cached and uncached values for field: ",". Cached value: ",", uncached value: ",".\n        Cached msgType: ",", uncached msgType: ",".\n        Cached ts: ",", uncached sortOrderMs: ","."]);v=function(){return a};return a}function w(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.messages.get({msgId:b})}function a(a,b){var c="newestMsg",e=E("query_by_sortOrderMs",c),f=e.isCacheBypassed;e=e.isLoggingExpected;var g=b.newestMsg==null;a=a.messages.where("threadJid").equals(b.jid).count().then(function(a){return a===0});e&&y(b,c,g,a);return f?a:d("MAWDexieTable").dexieResolve(g)}function x(a,b,c,e,f,g){d("WALogger").LOG(v(),a.jid,b,c,e,f==null?void 0:f.type,g==null?void 0:g.type,a.newestMsgTs,g==null?void 0:g.sortOrderMs)}function y(a,b,c,d){return d.then(function(d){if(c===d)return;x(a,b,c,d,null,null)})}function z(a,b,c,e){return d("MAWDexieTable").dexieAll([c,e]).then(function(c){var d=c[0];c=c[1];if((d==null?void 0:d.msgId)===(c==null?void 0:c.msgId))return;x(a,b,d==null?void 0:d.msgId,c==null?void 0:c.msgId,d,c)})}function A(a,b,c,e,f){return f.then(function(f){if(e===f)return;return d("MAWDexieTable").dexieAll([w(a,e),w(a,f)]).then(function(a){var d=a[0];a=a[1];x(b,c,e,f,d,a)})})}function B(a,b,c,e){return e.then(function(e){if(e==null&&c==null||e===d("WATimeUtils").castToMillisTime(0)||e!=null&&c!=null&&Math.floor(e/1e3)===c/1e3)return;x(a,b,c,e,null,null)})}function C(a,b){if(b)switch(a){case"newestMsg":return c("qex")._("961")===!0;case"newestMsgTs":return c("qex")._("962")===!0}else switch(a){case"newestMsg":return c("qex")._("928")===!0;case"newestMsgTs":return c("qex")._("944")===!0}}function D(a){switch(a){case"newestMsg":case"newestMsgTs":return d("Random").coinflip(c("justknobx")._("2537"))}}function E(a,b){var c=D(b),d=!1;switch(a){case"defer_to_qe":d=C(b,c);break;case"query_by_sortOrderMs":d=!0;break;case"use_cached_fields":d=!1;break}return{isCacheBypassed:d,isLoggingExpected:c}}function F(a,b,c,d){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function G(a,b){return F(a,b,!1,!1).last()}function b(a,b,c){c===void 0&&(c="query_by_sortOrderMs");var d="newestMsg";c=E(c,d);var e=c.isCacheBypassed;c=c.isLoggingExpected;var f=w(a,b.newestMsg);a=G(a,b.jid).then(function(a){return a});c&&z(b,d,f,a);return e?a:f}function e(a,b,c){c===void 0&&(c="query_by_sortOrderMs");var e="newestMsg";c=E(c,e);var f=c.isCacheBypassed;c=c.isLoggingExpected;var g=b.newestMsg,h=G(a,b.jid).then(function(a){return a==null?void 0:a.msgId});c&&A(a,b,e,g,h);return f?h:d("MAWDexieTable").dexieResolve(g)}function f(a,b,c){c===void 0&&(c="defer_to_qe");var e="newestMsgTs";c=E(c,e);var f=c.isCacheBypassed;c=c.isLoggingExpected;var g=b.newestMsgTs;a=G(a,b.jid).then(function(a){return(a==null?void 0:a.sortOrderMs)==null?null:d("WATimeUtils").castToMillisTime(a.sortOrderMs)});c&&B(b,e,g,a);return f?a:d("MAWDexieTable").dexieResolve(g)}function H(a,b,c){return F(a,b,!1,!1).reverse().limit(c).toArray()}function I(a,b){return F(a,b,!1,!1).first()}function J(a,b){return I(a,b).then(function(a){return a==null?void 0:a.msgId})}function K(a,b){return a.messages.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){if(a.length>1){var b=a.map(function(a){var b;return a.type+":"+((b=a.serverTs)!=null?b:0).toString()+":"+((b=a.ts)!=null?b:0).toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(u(),a.length):d("WALogger").ERROR(t())}return a[0]})}function L(a,b){return a.messages.where("msgId").equals(b).toArray()}function M(a,b){return P(a,b).then(function(a){return a.success?a:a})}function N(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.messages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function O(a,b){return a.messages.where("msgId").equals(b).first().then(function(a){return a==null?void 0:a.sortOrderMs})}function P(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_msg"):R(a,f,b.jid,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_msg"):d("WAResultOrError").makeResult(a)})})}function Q(a,b){var c=b.author,d=b.chat,e=b.externalId;return a.threads.get({jid:d}).then(function(b){if(b==null)return;return a.messages.where("revokedExternalId").equals(e).filter(function(a){return a.author===c&&a.threadJid===b.jid&&a.type==="Revoked"}).first()})}function R(a,b,c,e){return a.messages.where("externalId").equals(b).filter(function(a){return a.author===e&&a.threadJid===c}).toArray().then(function(a){a.length>1&&d("WALogger").ERROR(s(),a.length,b);return a[0]})}function S(a,b,c,e){var f=a.messages.where("revokedExternalId").equals(b).filter(function(a){return a.author===e&&a.threadJid===c&&a.type===d("MAWMsgType").MSG_TYPE.REVOKED}).first();a=d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(a,b,c,e).then(function(a){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return a});return d("MAWDexieTable").dexieAll([f,a]).then(function(a){var b=a[0];a=a[1];return b!=null||a!=null})}function T(a,b){var c=new Array(b.length),e=new Set();b.forEach(function(a){c.push(a.externalId),e.add(d("MAWSharedMsgIdUtil").convertWAMsgIdToStringId(a))});return a.messages.where("externalId").anyOf(c).filter(function(a){return e.has(d("MAWSharedMsgIdUtil").convertWAMsgIdToStringId({author:a.author,chat:a.threadJid,externalId:a.externalId}))}).toArray()}function U(a,b,c,e,f){return V(a,[{ack:c,msgId:b,reportingMeta:f,serverTs:e}]).then(function(a){a=a.find(function(a){return a.msgId===b});if(a==null){d("WALogger").LOG(r());return null}return a})}function V(a,b){var c=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,c).then(function(e){var f=new Map();b.forEach(function(a){f.set(a.msgId,{ack:a.ack,reportingMeta:a.reportingMeta,serverTs:a.serverTs});var b=e.get(a.msgId);b!=null&&f.set(b,{ack:a.ack,reportingMeta:a.reportingMeta,serverTs:a.serverTs})});var g=Array.from(new Set(c.concat(Array.from(e.values()))));return a.messages.where("msgId").anyOf(g).toArray().then(function(b){if(b.length===0)return b;var c=[],e=[];b.forEach(function(a){var b,g;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(q());c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(p());c.push(a);return}b=(b=f.get(a.msgId))==null?void 0:b.ack;g=(g=f.get(a.msgId))==null?void 0:g.serverTs;if(b==null)return null;var h=babelHelpers["extends"]({},a,{ack:b});g!=null&&(h.serverTs=g);a=(g=f.get(a.msgId))==null?void 0:g.reportingMeta;a!=null&&(h.reportingMeta=a);b===d("MAWAckLevel").ACK.sent&&delete h.resendCount;e.push(h)});return a.messages.bulkPut(e).then(function(){return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)}))}).then(function(a){e.forEach(function(b,c){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a[c])})});return[].concat(e,c)})})})}function aa(a,b,c,e){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success||e==null||b.value.oldestMsg!==c&&b.value.newestMsg!==c)return;var f=b.value;b=[a.messages.where(["threadJid","sortOrderMs"]).above([f.jid,e]).first(),a.messages.where(["threadJid","sortOrderMs"]).below([f.jid,e]).last()];return d("MAWDexieTable").dexieAll(b).then(function(b){var e=b[0];b=b[1];return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},f,{newestMsg:f.newestMsg===c?b==null?void 0:b.msgId:f.newestMsg,newestMsgTs:f.newestMsg===c?(b==null?void 0:b.ts)==null?null:d("WATimeUtils").castUnixTimeToMillisTime(b.ts):f.newestMsgTs,oldestMsg:f.oldestMsg===c?e==null?void 0:e.msgId:f.oldestMsg})).then(function(){})})})}function ba(a,b,e,f,g){if(b===(e==null?void 0:e.msgId)&&f===(g==null?void 0:g.msgId))return d("MAWDexieTable").dexieResolve();d("MAWIndexedDb").afterTransactionEffect(function(){c("promiseDone")(c("MAWUpdateThreadMsgMetadataApi")(a,b,e,f,g))})}function ca(a,b,e,f,g,h,i){g===void 0&&(g=!1);h===void 0&&(h=!1);i===void 0&&(i="before");return f===0?d("MAWDexieTable").dexieResolve({hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]}):d("MAWDexieTable").dexieAll([a.threads.get({jid:b}),e==null?d("MAWDexieTable").dexieResolve(null):a.messages.get({msgId:e})]).then(function(b){var j=b[0],k=b[1],l=j==null?void 0:j.oldestMsg,p=j==null?void 0:j.newestMsg;if(j==null||e!=null&&k==null)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};var q=h?function(a){return!0}:function(a){return a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime()};b=d("MAWDexieTable").dexieResolve([]);f===1&&g&&k!=null&&(b=d("MAWDexieTable").dexieResolve([k].filter(q)));d("WALogger").LOG(o(),k==null?void 0:k.msgId,f,g,h,i);return b.then(function(b){b=b.length>0?d("MAWDexieTable").dexieResolve(b):na(a,j.jid,k,g,f,q,i);var h=c("gkx")("23927");return d("MAWDexieTable").dexieAll([b,G(a,j.jid),I(a,j.jid)]).then(function(a){var b=a[0],c=a[1];a=a[2];ba(j,l,a,p,c);d("WALogger").LOG(n(),b.length);if(b.length===0)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};var g=b[b.length-1],i=b[0];g=h?g.msgId!==(a==null?void 0:a.msgId):g.msgId!==(a==null?void 0:a.msgId)&&b.length===f;a=h?i.msgId!==(c==null?void 0:c.msgId):!1;i.threadJid!==j.jid&&d("WALogger").ERROR(m(),i.threadJid,j.jid,j.chatId,e);return{hasMoreAfter:a,hasMoreBefore:g,msgs:b}})})})}function da(a){return a.messages.where("altIndex").equals(d("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").ERROR(l(),a.msgId,a.type);return}b.push(a)});return b})}function W(a){return a.toString()}function ea(a,b,c,e){var f=b.mediaId;if(f===c){d("WALogger").LOG(k(),b.msgId,c);return d("MAWDexieTable").dexieResolve()}f=f!=null?a.media.get(f):d("MAWDexieTable").dexieResolve();return f.then(function(f){f&&d("WALogger").ERROR(j(),b.type);f=(f=e)!=null?f:void 0;f=babelHelpers["extends"]({},b,{mediaId:c,plaintextHash:f});return a.messages.put(f).then(function(){})})}function fa(a,b){var e=Array.from(b.keys());return a.messages.where("msgId").anyOf(e).toArray().then(function(e){var f=[];e.map(function(a){var e=b.get(a.msgId),g=a.mediaId;if(g!=null&&g!==e){if(e!=null)throw c("err")("mediaId "+W(g)+" in message "+a.msgId+" is different with the "+W(e)+" in bulkUpdateMediaId");d("WALogger").LOG(i(),a.msgId,e);return}g=babelHelpers["extends"]({},a,{mediaId:e,plaintextHash:a.plaintextHash});f.push(g)});return a.messages.bulkPut(f).then(function(){})})}function ga(a,b){return X(a,[b]).then(function(){})}function X(a,b){return a.messages.where("msgId").anyOf(b).toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{isExpiredXmaMsg:!0})});return a.messages.bulkPut(c).then(function(){return c})})}function Y(a,b,c,e){if(e!=null&&e<=0)return d("MAWDexieTable").dexieResolve([]);a=a.messages.where("altIndex").equals(d("MAWDbMsg").craftToBeReadAltIndex(b)).filter(c);e!=null&&(a=a.limit(e));return a.toArray()}function ha(a,b,c,d){return Y(a,b,function(a){return a.msgId<=c},d)}function Z(a,b,c,e){return Y(a,b,function(a){return d("MAWDbMsg").getSortOrderWithFallback(a)<=c},e)}function ia(a,b,c){return Z(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function ja(a,b){return a.messages["delete"](b)}function ka(a,b,c){var e=b.map(function(a){return a.rowId});b=c!=null?b.map(function(a){a=d("MAWJidUtils").toProtocolMsgId(a);if(!a)return;return babelHelpers["extends"]({},a,{reason:c})}).filter(Boolean):[];return d("MAWDexieTable").dexieAll([a.deletedMessages.bulkAdd(b),a.messages.bulkDelete(e)]).then(function(a){a[0];a=a[1];d("WALogger").LOG(h(),a)})}function la(a,b){return a.messages.where("msgId").anyOf(b).toArray()}function ma(a){return a.messages.where("altIndex").anyOf([d("MAWDbMsg").SPAM_ALT_INDEX,d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function na(a,b,c,e,f,g,h){h===void 0&&(h="before");c=c==null?null:d("MAWDbMsg").getSortOrderWithFallback(c);if(h==="before"){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,(h=c)!=null?h:Number.MAX_SAFE_INTEGER],!0,e).reverse().filter(g).limit(f).toArray()}else{return a.messages.where(["threadJid","sortOrderMs"]).between([b,(h=c)!=null?h:Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],e,!0).filter(g).limit(f).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}}function oa(a,b,c,d){var e=c.msgId;if(a==null&&b==null)return{newestMsg:e,oldestMsg:e};if(d==null){var f;return{newestMsg:e,oldestMsg:(f=a==null?void 0:a.msgId)!=null?f:e}}f=[a,b,c].filter(Boolean);return{newestMsg:f.reduce(function(a,b){return $(b,e,d)>=$(a,e,d)?b:a}).msgId,oldestMsg:f.reduce(function(a,b){return $(a,e,d)<$(b,e,d)?a:b}).msgId}}function $(a,b,c){return a.msgId===b?c:d("MAWDbMsg").getSortOrderWithFallback(a)}function pa(a,b){return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetMsg=w;g.getIsThreadEmpty=a;g.getThreadMessagesBySortOrder=F;g.getThreadNewestMessageBySortOrder=G;g.getThreadNewestMessageBySortOrderOrCache=b;g.getThreadNewestMessageId=e;g.getThreadNewestMessageTs=f;g.getThreadNewestNumMessagesBySortOrder=H;g.getThreadOldestMessageBySortOrder=I;g.getThreadOldestMessageId=J;g.maybeGetMsgByProtocolMsgId=K;g.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=L;g.maybeGetMsgResultByProtocolMsgId=M;g.getMsgMapByProtocolMsgId=N;g.getSortOrderFromMsgId=O;g.maybeGetRevokedMsgByProtocolMsgId=Q;g.maybeGetMsgByExternalId=R;g.checkIfMsgIsDeletedForMeOrRevoked=S;g.getMsgsByProtocolMsgId=T;g.updateSystemAck=U;g.bulkUpdateSystemAck=V;g.maybeUpdateThreadMsgsForDeleteForMe=aa;g.getMsgsFromOffset=ca;g.getFutureProofMsgs=da;g.updateMediaId=ea;g.bulkUpdateMediaId=fa;g.updateDbMsgXMAExpiration=ga;g.bulkUpdateDbMsgXMAExpired=X;g.getMsgsNeedingRetroactiveReadReceiptsUpTo__DONOTUSE=ha;g.getMsgsNeedingRetroactiveReadReceiptsUpTo=Z;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo=ia;g.deleteDbMsg=ja;g.deleteMessages=ka;g.getMsgsByMsgIds=la;g.getSpamMsgs=ma;g.calculateOldestAndNewestMsg=oa;g.getNextMsgIdNumberForThread=pa}),98);
__d("WAArrayZip",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Math.min(a.length,b.length);return a.slice(0,c).map(function(a,c){return[a,b[c]]})}f.zip=a}),66);
__d("MAWDbThreadTxns",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","WAArrayZip","WALogger","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"]);j=function(){return a};return a}function a(a,b){return a.threads.get({deduplicationKey:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function k(a,b){return a.threads.get({jid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function l(a,b){return a.threads.where("jid").anyOf(b).toArray()}function b(a,b){return a.threads.where("jid").startsWith(b+"@").first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function c(a,b){return a.threads.where("jid").equals(b)["delete"]().then(function(){})}function e(a,b){return a.participants.where("userJid").equals(b).toArray().then(function(b){b=b.map(function(a){return a.threadJid});return l(a,b)})}function f(a,b){return a.participants.where("userJid").anyOf(b).toArray().then(function(b){var c=new Map(),d=new Set();b.forEach(function(a){var b,e=a.userJid;b=(b=c.get(e))!=null?b:[];b.push(a.threadJid);c.set(e,b);d.add(a.threadJid)});return l(a,Array.from(d)).then(function(a){var b=a.reduce(function(a,b){a.set(b.jid,b);return a},new Map());return new Map(Array.from(c.entries()).map(function(a){var c=a[0];a=a[1];return[c,a.map(function(a){return b.get(a)}).filter(Boolean)]}))})})}function m(a,b,c){return(b==null?void 0:b.lastReadMsgReceiptSent)==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbMsgTxns").getSortOrderFromMsgId(a,b.lastReadMsgReceiptSent).then(function(a){return c.sortOrderMs==null||a==null?!1:c.sortOrderMs<=a})}function n(a,b){return a.threads.get({jid:b.threadJid}).then(function(c){return m(a,c,b)})}function o(a,b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){return d("MAWDexieTable").dexieAll(d("WAArrayZip").zip(b,c).map(function(b){var c=b[0];b=b[1];return m(a,b,c)}))})}function p(a,b,c){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var e=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!0,cannotReplyReason:c?"viewer_not_subscribed":a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return a.threads.bulkPut(e).then(function(){e.forEach(function(a){c&&d("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:a.jid})})})})})}function q(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:null})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){a={cannotReplyReason:null,threadJid:a.jid};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(a)})})})})}function r(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!1,cannotReplyReason:a.cannotReplyReason==="viewer_not_subscribed"?a.cannotReplyReason:null,folder:d("MAWFolderTypes").FOLDER_ID.INBOX})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:a.jid})})})})})}function s(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:"viewer_not_subscribed"})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){var b={cannotReplyReason:"viewer_not_subscribed",threadJid:a.jid};d("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(b)})})})})}function t(a,b){return k(a,b).then(function(b){if(!b.success){d("WALogger").WARN(j());return}b=b.value;if(b.isMigratedLocally===!0){d("WALogger").WARN(i());return}b=babelHelpers["extends"]({},b,{isMigratedLocally:!0});return a.threads.put(b).then(function(){})})}function u(a,b){if(b.isMigratedLocally===!1){d("WALogger").WARN(h());return d("MAWDexieTable").dexieResolve(b)}var c=babelHelpers["extends"]({},b,{isMigratedLocally:!1});return a.threads.put(c).then(function(){return c})}function v(a,b){return a.threads.put(b).then(function(){})}function w(a,b,c,e,f,g){c=c===(e==null?void 0:e.msgId);f=f===(g==null?void 0:g.msgId);return c&&f?d("MAWDexieTable").dexieResolve():v(a,babelHelpers["extends"]({},b,{newestMsg:g==null?void 0:g.msgId,newestMsgTs:f?b.newestMsgTs:(g==null?void 0:g.ts)==null?null:d("WATimeUtils").castUnixTimeToMillisTime(g.ts),oldestMsg:e==null?void 0:e.msgId}))}g.getThreadByDeduplicationKey=a;g.getThread=k;g.getThreads=l;g.getThreadPrimaryId=b;g.deleteThreadRow=c;g.getAllThreadsForUser=e;g.getAllThreadsForUsers=f;g.needsRetroactiveReadReceiptInThread=n;g.bulkNeedsRetroactiveReadReceiptInThread=o;g.archiveThreads=p;g.subscribeToThreads=q;g.unarchiveThreads=r;g.unsubscribeFromThreads=s;g.markCutoverThreadAsMigratedLocally=t;g.markCutoverThreadAsNotMigratedLocally=u;g.updateThread=v;g.updateThreadMsgsForUndefinedOldestOrNewestMsgs=w}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""]);i=function(){return a};return a}function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.media.get({mediaId:b})}function j(a,b){return a.media.where("hashedPlaintextHash").equals(b).first()}function b(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return j(a,b)}function e(a,b){return a.media.where("hashedPlaintextHash").anyOf(b).toArray()}function f(a,b){return b==null?d("MAWDexieTable").dexieResolve():k(a,b).then(function(c){c=c==null?void 0:c.mediaId;return c!=null?a.media.get({mediaId:c}):a.media.get({objectId:b})})}function k(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.mediaBackup.get({objectId:b})}function l(a,b){a=a.mediaBackup.where("objectId").anyOf(b).toArray();return a.then(function(a){return new Map(a.map(function(a){return[a.objectId,a]}))})}function m(a,b){return l(a,b).then(function(b){b=Array.from(b.values()).map(function(a){return a.mediaId});return a.media.bulkGet(b)})}function n(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();a=a.mediaBackup.where("msgId").equals(b).toArray();return a}function o(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg);var e=b.reduce(function(a,b){if(b.mediaId==null){d("WALogger").ERROR(i(),b.msgId);return a}return a.set(b.mediaId,b)},new Map());b=Array.from(e.keys());return r(a,b).then(function(a){var b=[];a.forEach(function(a){if(a==null)throw c("err")("Error missing media");var d=e.get(a.mediaId);if(d==null)throw c("err")("Error missing media");b.push([d,a])});return b})}function p(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg).map(function(a){var b=a.mediaId;if(b==null){d("WALogger").ERROR(h(),a.msgId);throw c("err")("mediaId is missing")}else return b});return r(a,b).then(function(a){var b=[];a.forEach(function(a){a!=null&&b.push(a)});return b})}function q(a,b){if(b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;return c==null?b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing")):a.media.get(c).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}function r(a,b){return a.media.bulkGet(b)}function s(a,b){var c=b.previewMediaIds!=null?r(a,b.previewMediaIds):d("MAWDexieTable").dexieResolve(),e=b.headerMediaId!=null?a.media.get(b.headerMediaId):d("MAWDexieTable").dexieResolve();a=b.faviconMediaId!=null?a.media.get(b.faviconMediaId):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,e,a]).then(function(a){var c=a[0],e=a[1];a=a[2];if(b.headerMediaId!=null&&e==null)return d("WAResultOrError").makeError("missing");if(b.faviconMediaId!=null&&a==null)return d("WAResultOrError").makeError("missing");if(c==null)return d("WAResultOrError").makeError("missing");var f=[];for(var c=c,g=Array.isArray(c),h=0,c=g?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=c.length)break;i=c[h++]}else{h=c.next();if(h.done)break;i=h.value}i=i;if(i==null)return d("WAResultOrError").makeError("missing");else f.push(i)}return d("WAResultOrError").makeResult({favicon:a,header:e,previews:f})})}function t(a,b,c){b=babelHelpers["extends"]({},b,c);return a.media.put(b)}g.maybeGetMediaFromMediaId=a;g.maybeGetMediaFromHashedPlaintextHash=j;g.maybeGetMediaFromPlaintextHash=b;g.maybeBulkGetMediaFromHashedPlaintextHash=e;g.maybeGetMediaFromObjectId=f;g.maybeGetMediaBackupRowFromObjectId=k;g.maybeGetMediaBackupRowsFromObjectIds=l;g.maybeGetBulkMediaFromObjectIds=m;g.maybeGetMediaBackupRowFromMsgId=n;g.getMsgMediaPairFromMsgs=o;g.getMediaFromMsgs=p;g.getAndCheckMediaFromMsg=q;g.bulkGetMedias=r;g.getMediaForXMA=s;g.updateMedia=t}),98);
__d("MAWDbXMATxns",["MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.xma.bulkGet(b)}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.get({xmaId:b})}function h(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("associatedMessageId").equals(b).first()}function i(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function c(a,b){return i(a,b).then(function(b){return b==null?d("WAResultOrError").makeError("missing"):d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.favicon,f=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,favicon:e,header:f,previews:c,xma:b})})})}function e(a,b){return h(a,b).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsg(a,b.msgId)})}function f(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isXMAMsg).map(function(a){return d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId)}).filter(Boolean);b=b.map(function(b){return i(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})}function j(a,b){return a.xma.where("associatedMessageId").anyOf(b).toArray().then(function(a){a=a.filter(function(a){return a.msgId!=null&&d("MAWXMAUtils").isXMAShare(a.targetType)});return a.reduce(function(a,b){return b.associatedMessageId!=null&&b.msgId!=null?a.set(b.associatedMessageId,b.msgId):a},new Map())})}function k(a,b){return a.xma.where("associatedMessageId").equals(b).first()}function l(a,b){return a.xma.where("associatedMessageId").equals(b).first().then(function(b){if(b==null)return;b=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)})}function m(a,b){return k(a,b).then(function(b){return b==null?d("WAResultOrError").makeResult():d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.favicon,f=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,favicon:e,header:f,previews:c,xma:b})})})}function n(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){if(!c.success)return;c=c.value;if(b==null)return d("MAWDexieTable").dexieResolve();c={author:b.author,chat:c.jid,externalId:b.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)})}g.bulkGetXMAs=a;g.maybeGetXMAFromXMAId=b;g.maybeGetXMAFromAssociatedMsgId=h;g.maybeGetXMAFromProtocolMsgId=i;g.maybeGetXMAPayloadFromProtocolMsgId=c;g.getDbXMAMsgFromAssociatedMsgId=e;g.getXMAFromMsgs=f;g.getXMAMsgIdsFromAssociatedMsgIds=j;g.maybeGetDbXMAMsgByAssociatedMsgId=l;g.maybeGetXMAPayloadFromAssociatedMsgId=m;g.maybeGetAssociatedXMAMsg=n}),98);
__d("MAWUpdateThreadMsgMetadataApi",["MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated oldestMsg from id "," to id "," when oldestMsg is undefined"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated newestMsg from id "," to id ",", and newestMsgTs from "," to "," when newestMsg is undefined"]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadMsgMetadataApiTransactor",function(a){return function(b,c,e,f,g){var j=c===(e==null?void 0:e.msgId),k=f===(g==null?void 0:g.msgId);if(j&&k)return d("MAWDexieTable").dexieResolve();k||d("WALogger").ERROR(i(),f,g==null?void 0:g.msgId,b.newestMsgTs,(g==null?void 0:g.ts)==null?null:d("WATimeUtils").castUnixTimeToMillisTime(g.ts));j||d("WALogger").ERROR(h(),c,e==null?void 0:e.msgId);return d("MAWDbThreadTxns").updateThreadMsgsForUndefinedOldestOrNewestMsgs(a,b,c,e,f,g).then(function(){})}});b=a;g["default"]=b}),98);
__d("MAWGetOrCreateThreadTxns",["MAWAdminMsgTxns","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MAWWriteBulkWriteIncomingAdminMsgTxns","WATimeUtils","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a!=null&&b!=null){var c=d("WATimeUtils").fromMillisTime(a),e=d("WATimeUtils").fromMillisTime(b);return d("WATimeUtils").castToMillisTime(Math.max(c,e))}return(c=a)!=null?c:b}function i(a,b){return a.threads.get({jid:b})}function j(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(a){var c=new Map();for(var a=a,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;c.set(f.jid,f)}return b.map(function(a){return c.get(a)})})}function a(a,b){var c=b.deduplicationKey,e=b.jid;c=b.deduplicationKey!=null?a.threads.get({deduplicationKey:c}):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,i(a,e)]).then(function(c){var d=c[0];c=c[1];if(d!=null)return{created:!1,thread:d};if(c==null)return l(a,b).then(function(a){return{created:!0,thread:a}});else return o(a,b,c).then(function(a){return{created:!1,thread:a}})})}function b(a,b){var c=b.map(function(a){a=a.deduplicationKey;return a}).filter(function(a){return a!=null});c=a.threads.where("deduplicationKey").anyOf(c).toArray();return d("MAWDexieTable").dexieAll([c,j(a,b.map(function(a){a=a.jid;return a}))]).then(function(c){var e=c[0];c=c[1];var f=new Map();for(var e=e,g=Array.isArray(e),h=0,e=g?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{h=e.next();if(h.done)break;i=h.value}i=i;i.deduplicationKey!=null&&f.set(i.deduplicationKey,i)}var j={};i=[];h=[];for(g=c.entries(),e=Array.isArray(g),c=0,g=e?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(e){if(c>=g.length)break;l=g[c++]}else{c=g.next();if(c.done)break;l=c.value}l=l;var n=l[0];l=l[1];k=(k=b[n])==null?void 0:k.deduplicationKey;if(k!=null){var o=f.get(k);if(o!=null){j[k]={created:!1,thread:o};continue}}l==null?i.push(b[n]):h.push({params:b[n],thread:l})}return d("MAWDexieTable").dexieAll([i.length?m(a,i):d("MAWDexieTable").dexieResolve([]),h.length?p(a,h):d("MAWDexieTable").dexieResolve([])]).then(function(a){var c=a[0];a=a[1];for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;j[f.jid]={created:!0,thread:f}}for(f=a,e=Array.isArray(f),d=0,f=e?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(e){if(d>=f.length)break;c=f[d++]}else{d=f.next();if(d.done)break;c=d.value}a=c;j[a.jid]={created:!1,thread:a}}return b.map(function(a){var b=a.deduplicationKey;a=a.jid;if(b!=null){return(b=j[b])!=null?b:j[a]}return j[a]})})})}function k(a){var b=a.authoritativeThreadKey,c=a.clientThreadKey,e=a.createTs,f=a.deduplicationKey,g=a.folder,h=a.jid;a=a.lastActivityTimestamp;e=(a=(a=a)!=null?a:e)!=null?a:d("WATimeUtils").millisTime();b={authoritativeThreadKey:b!=null?b:void 0,deduplicationKey:f,folder:g!=null?g:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:h,lastReadMsg:null,lastReadMsgReceiptSent:null,newestMsg:null,newestMsgTs:e,oldestMsg:null,optimisticThreadKey:(a=c)!=null?a:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(e,h)};return b}function l(a,b){var e=b.authoritativeThreadKey,f=b.description,g=b.skipVerifyThread,h=k(b);return a.threads.add(h).then(function(b){b=babelHelpers["extends"]({},h,{chatId:b});g!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(b,b.optimisticThreadKey,e,f,h.newestMsgTs)});return d("MAWAdminMsgTxns").writeE2EEThreadDescriptionMsg(a,b)})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error creating thread: "+a.message;throw a})}function m(a,b){var e=b.map(k);return a.threads.bulkAdd(e,{allKeys:!0}).then(function(c){c=c.map(function(a,c){return{data:babelHelpers["extends"]({},e[c],{chatId:a}),params:b[c]}});for(var f=c,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;i.params.skipVerifyThread!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(i.data,i.data.optimisticThreadKey,i.params.authoritativeThreadKey,i.params.description)})}return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,c.map(function(a){return a.data}))})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error bulk creating threads: "+a.message;throw a})}function n(a,b,c){var d=b.authoritativeThreadKey,e=b.clientThreadKey,f=b.deduplicationKey,g=b.folder;b=b.lastActivityTimestamp;return babelHelpers["extends"]({},a,{authoritativeThreadKey:(d=d)!=null?d:a.authoritativeThreadKey,cannotReplyReason:g!=null||e!=null?null:a.cannotReplyReason,deduplicationKey:g!=null||e!=null?f:a.deduplicationKey,folder:(d=g)!=null?d:a.folder,newestMsgTs:h(c,b),optimisticThreadKey:(f=e)!=null?f:a.optimisticThreadKey})}function o(a,b,e){var f=b.authoritativeThreadKey,g=b.description,h=b.skipVerifyThread;return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,e).then(function(i){var j=n(e,b,i);return a.threads.update(e.chatId,j).then(function(){var a;h!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(j,j.optimisticThreadKey,f,g,i)});d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:(a=j==null?void 0:j.folder)!=null?a:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:j.jid})});return j})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error updating thread: "+a.message;throw a})})}function p(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.params,e=b.thread;return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,e).then(function(a){a=n(e,c,a);return{params:c,thread:a}})})).then(function(b){return a.threads.bulkUpdate(b.map(function(a){a=a.thread;return{changes:a,key:a.chatId}})).then(function(){for(var a=b,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;var g=f.params,h=g.authoritativeThreadKey,i=g.description;g=g.skipVerifyThread;f=f.thread;g!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(f,f.optimisticThreadKey,h,i)});d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:(g=f==null?void 0:f.folder)!=null?g:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:f.jid})})}return b.map(function(a){a=a.thread;return a})})})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error bulk updating threads: "+a.message;throw a})}g.getExistingThread=i;g.bulkGetExistingThread=j;g.getOrCreateThread=a;g.bulkGetOrCreateThread=b;g.createThread=l;g.bulkCreateThread=m;g.updateThread=o;g.bulkUpdateThread=p}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWExternalId","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){return{ack:d("MAWAckLevel").ACK.sent,altIndex:(e=e)!=null?e:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWExternalId").generateExternalId(),msgContent:a,threadJid:b,ts:(e=c)!=null?e:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ADMIN}}function b(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:return!0}return!1}function c(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function e(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}g.buildUnstoredDbAdminMsg=a;g.isAdminMsgNormalized=b;g.isDeviceChangeAdminMsg=c;g.isParticipantChangeAdminMsg=e}),98);
__d("MAWEphemeralMsgUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return function(b){return!a.has(b.msgId)&&b.ephemeralMsgDisappeared!==!0}}f.filterNonExpiredMsg=a}),66);
__d("MAWThreadSnippetUtils",["MAWEphemeralMsgUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED)return!0;if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return!0;b=((b=a.msgContent)==null?void 0:b.adminType)!=null?d("MAWLocalizationUtils").isDeviceChangeAdminMsg(a.msgContent.adminType):!1;if(a.type!==d("MAWMsgType").MSG_TYPE.ADMIN)return!1;a=a.msgContent.adminType;return a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:b}function a(a,b,c){return a.messages.where("[threadJid+sortOrderMs]").between([b.jid,Number.MIN_SAFE_INTEGER],[b.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(a){return(c==null||d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c)(a))&&!h(a)}).reverse().first()}g.isDbMsgDisabledForThreadSnippet=h;g.findMostRecentSnippetMsgFromThread=a}),98);
__d("MAWAdminMsgTxns",["MAWDbMsg","MAWDbThread","MAWDbThreadTxns","MAWLocalizationType","MAWLocalizationUtils","MAWThreadSnippetUtils","MAWTimeUtils","MAWWriteBulkWriteIncomingAdminMsgTxns","MAWWriteMsgTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeReachabilityErrorAdminMsg failed to create or get 1:1 thread"]);h=function(){return a};return a}function a(a,b,c){var e=a.ts;e=d("WATimeUtils").castUnixTimeToMillisTime(e);c=d("MAWTimeUtils").ensureValidMillisTime(c)||d("WATimeUtils").castToMillisTime(0);e=e>c?e:c;c=d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(a);return babelHelpers["extends"]({},b,{newestMsg:a.msgId,newestMsgTs:e,oldestMsg:a.msgId,snippetMsg:c?void 0:a.msgId,snippetMsgTs:c?void 0:d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a)),threadOrder:d("MAWDbThread").craftThreadOrder(e,b.jid)})}function b(a,b){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h());return}b=b.value;var c=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR,version:0},b.jid,d("WATimeUtils").castMillisTimeToUnixTime(d("WATimeUtils").millisTime()));return d("MAWWriteMsgTxns").writeMsg(a,c,b).then(function(){})})}function c(a,b){return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,[b]).then(function(a){a=a[0];return a})}function e(a){var b=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.chatId);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION,version:0},a.jid,d("WATimeUtils").castToUnixTime(0),b);return babelHelpers["extends"]({},b,{msgId:d("MAWDbMsg").craftMsgIdV2(a.chatId,1,b),sortOrderMs:0})}g.getUpdatedThreadForAdminMsg=a;g.writeReachabilityErrorAdminMsg=b;g.writeE2EEThreadDescriptionMsg=c;g.buildE2EEThreadDescriptionMsg=e}),98);
__d("MAWAfterWriteMsgUtil",["$InternalEnum","ArmadilloDataTraceType","I64","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMsg","MAWIndexedDb","MAWLocalizationType","MAWMsgType","MAWXMAUtils","WAJids","WALogger","WATimeUtils","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping thread bump for thread: ",", msgType: ",", snippetType: ",", newestMsgTs: ",", bumpThreadOption: ","."]);i=function(){return a};return a}var j=b("$InternalEnum").Mirrored(["DO_NOT_BUMP_THREAD","BUMP_LOCAL_ONLY","BUMP_LOCAL_AND_SERVER"]);function a(a){var b=a.bumpThreadOption,e=a.dbMsg,f=a.hasMoreAfter,g=a.hasMoreBefore,h=a.isFirstMsg,i=a.isOldestMsgUpdated,j=a.openMessageOtid,l=a.openMessageParticipantCount,m=a.optimisticMsg,n=a.participantCount,o=a.prevOldestMsg,p=a.quotedReplyAttachmentMeta,q=a.snippet;a=a.updatedThread;var r=a.authoritativeThreadKey,s=a.jid,t=a.newestMsgTs;a=a.oldestMsg;if(e.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||e.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX)return;d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(e,s,d("ArmadilloDataTraceType").armadilloMessageSend,j,h,l,n,r)});d("MAWXMAUtils").isXMAStoryReply(e.xmaMessageType)||d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(e,m,p)});k(b,e,s,t,q);if(o==null&&c("qex")._("1210")!==!0){d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(s,[e],!0,(j=g)!=null?j:!1,(h=f)!=null?h:!1)})}i&&a!=null&&d("MAWIndexedDb").afterTransaction({tag:"UpdateMinMessage",value:{minMessageId:a,minTimestampMs:d("MAWDbMsg").getCanonicalTsFromMsg(e)*1e3,threadJid:s}})}function k(a,b,c,e,f){switch(a){case j.DO_NOT_BUMP_THREAD:l(a,b,c,e,f);return;case j.BUMP_LOCAL_ONLY:case j.BUMP_LOCAL_AND_SERVER:if(m(b)||f==null||e==null){l(a,b,c,e,f);return}var g=f.snippetParams,i=f.snippetSenderContactId;f=f.snippetType;e=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(b.serverTs!=null?d("WATimeUtils").castUnixTimeToMillisTime(b.serverTs):e,(h||(h=d("I64"))).of_string_opt(b.externalId));d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:e,description:"writeMsgAfterTransaction-"+b.type,isMessageAuthorMe:b.author===d("WAJids").AUTHOR_ME,skipServerThreadBump:a===j.BUMP_LOCAL_ONLY,snippetParams:g,snippetSenderContactId:i,snippetType:f,threadJid:c})})}}function l(a,b,c,e,f){d("WALogger").LOG(i(),c,b.type,f==null?void 0:f.snippetType,e,a)}function m(a){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return!0;return c("justknobx")._("2017")&&a.type===d("MAWMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE)?!0:!1}g.WriteMsgAfterTxnBumpThreadOption=j;g.writeMsgAfterTransaction=a}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["MAWAdminMsgNormalized","MAWLocalizationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.msgContent.adminType;a=d("MAWLocalizationUtils").isAdminMsgNormalized(c)?d("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(c,a.msgContent.adminMsgContent):{contactIds:[],contents:a.msgContent.adminMsgContent};var e=a.contactIds;a=a.contents;return{snippetParams:{contactIDs:[].concat(e.map(function(a){return a==="Facebook User"?"0":a})),strings:[].concat(a)},snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"]);j=function(){return a};return a}function k(a,b,c){return{snippetParams:{contactIDs:(c=c)!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}var l=function(a){return k(a,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function a(a,b,c){var e;if(d("WAJids").isAuthorSystem(a.author)){d("WALogger").ERROR(j());return l(b)}e=(e=(e=a.quote)==null?void 0:e.content.author)!=null?e:c;if(e==null){d("WALogger").ERROR(i());return l(b)}if(d("WAJids").isAuthorMe(a.author))return d("WAJids").isAuthorMe(e)?k(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):k(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[d("WAJids").userIdFromJid(e)]);if(b==null){d("WALogger").ERROR(h());return l(b)}if(d("WAJids").isAuthorMe(e))return k(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[b]);return e===a.author?k(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[b]):k(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[b,d("WAJids").userIdFromJid(e)])}g["default"]=a}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return{snippetParams:{contactIDs:(c=c)!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}function a(a,b){var c=a.author;a=a.msgContent.subtype;if(d("WAJids").isAuthorMe(c))switch(a){case"liveLocationMessage":case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}g["default"]=a}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,f={contactIDs:[],mentionJIDs:a.msgContent.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,f.contactIDs.push(b));if(a.specialTextSize===1||a.specialTextSize===2||a.specialTextSize===3){c=d("MAWVault").unvault(a.msgContent.content);f.strings.push(c==="\ud83d\udc4d"?"(Y)":a.msgContent.content)}else f.strings.push(a.msgContent.content);return{snippetParams:f,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"]);y=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};a.xmaMessageType==null&&d("WALogger").ERROR(y());switch(a.xmaMessageType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(x()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:if(d("WAJids").isAuthorMe(a.author)){var f;if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT;c.strings.push((f=a.msgContent)==null?void 0:f.content)}else e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT}else if(d("WAJids").isAuthorSystem(a.author)||b==null)d("WALogger").ERROR(w());else{e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT;c.contactIDs.push(b);if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){c.strings.push((f=a.msgContent)==null?void 0:f.content)}}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(v()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(u()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(t()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(s()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(r()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;f=a.threadJid;var g;f!=null&&(g=d("WAJids").interpretAsUserJid(f));if(g!=null){f=d("WAJids").userIdFromJid(g);c.contactIDs.push(f)}else d("WALogger").ERROR(q())}else d("WAJids").isAuthorSystem(a.author)?d("WALogger").ERROR(p()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(o()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(n()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(m()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(l()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(k()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(j()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(i()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,c.contactIDs.push(b));break;default:d("WALogger").ERROR(h())}return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return/^\d+$/.test(a)}function i(a){if(d("WAJids").isAuthorSystem(a))return;a=d("WAJids").isAuthorMe(a)?d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid()):d("WAJids").userIdFromJid(a);if(!h(a)){c("FBLogger")("maw_db").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return a}function a(a,b,e){var f=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,f,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,f);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,f);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,f);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,f);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,f);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,f);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,f);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,f);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,f);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,f,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,f);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:f,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}g.getSnippetContactId=i;g.buildThreadSnippet=a}),98);
__d("MAWWriteBulkWriteIncomingAdminMsgTxns",["MAWAdminMsgTxns","MAWAfterWriteMsgUtil","MAWDbMsgTxns","MAWDexieTable","MAWMessageHasUniqueExternalIdValidator","MAWThreadSnippet","MAWThreadSnippetForAdminOrEphemeralMsg","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["OfflineBulkWriteAdminmsg - Missing thread when write e2ee thread description"]);h=function(){return a};return a}function i(a,b){var e=[],f=[],g=[],i=new Map(),j=new Map(),k=b.map(function(b){return d("MAWDbMsgTxns").getThreadOldestMessageId(a,b.jid).then(function(a){return i.set(b.jid,a)})}),l=b.map(function(b){return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b).then(function(a){return j.set(b.jid,a)})});return d("MAWDexieTable").dexieAll([k,l]).then(function(){b.forEach(function(a){a==null&&d("WALogger").ERROR(h());var b=d("MAWAdminMsgTxns").buildE2EEThreadDescriptionMsg(a),k=d("MAWAdminMsgTxns").getUpdatedThreadForAdminMsg(b,a,j.get(a.jid)),l=c("MAWThreadSnippetForAdminOrEphemeralMsg")(b,d("MAWThreadSnippet").getSnippetContactId(b.author));a=i.get(a.jid);e.push(b);g.push(k);f.push({bumpThreadOption:d("MAWAfterWriteMsgUtil").WriteMsgAfterTxnBumpThreadOption.BUMP_LOCAL_ONLY,dbMsg:b,isFirstMsg:!1,isOldestMsgUpdated:a!=null&&b.msgId!==a,prevOldestMsg:a==null?void 0:a,snippet:l,updatedThread:k})});return{afterTransactionSyncMsgsData:f,e2eeThreadAdminMsgs:e,threadsToUpdate:g}})}function a(a,b){return i(a,b).then(function(b){var c=b.afterTransactionSyncMsgsData,e=b.e2eeThreadAdminMsgs,f=b.threadsToUpdate;d("MAWMessageHasUniqueExternalIdValidator").logMessageAddSource(e.map(function(a){return a.externalId}),"MAWWriteBulkWriteIncomingAdminMsgTxns.js::writeE2EEAdminMsgsForIncomingCreatedThreads");return d("MAWDexieTable").dexieAll([a.messages.bulkAdd(e),a.threads.bulkPut(f)]).then(function(){c.forEach(function(a){return d("MAWAfterWriteMsgUtil").writeMsgAfterTransaction(a)});return f})})}g.writeE2EEAdminMsgsForIncomingCreatedThreads=a}),98);
__d("MAWBuildIncomingMsgs",["MAWAckLevel","MAWDbMsg","MAWMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS;function a(a,b){var c=a.author;a=a.externalId;return{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:c,externalId:a,serverTs:b,ts:b,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT}}function b(a,b){var c=a.author;a=a.externalId;return{ack:d("MAWAckLevel").ACK.failed,altIndex:void 0,author:c,externalId:a,serverTs:b,ts:b,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE}}function c(a,b){var c;return{ack:a.ack,author:a.author,externalId:a.externalId,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h),msgContent:(c=d("MAWDbMsg").getMsgContent(a))==null?void 0:c.content,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME}}function e(a,b,c){return{ack:a.ack,altIndex:void 0,author:a.author,externalId:c.externalId,msgContent:d("MAWDbMsg").getMsgContent(a),originalTs:a.ts,revokedExternalId:c.revokedExternalId,threadJid:b.jid,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h)}}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.buildUnstoredCiphertextMsg=a;g.buildUnstoredUnavailableMsg=b;g.buildUnstoredDeleteForMeMsg=c;g.buildUnstoredRevokedMsg=e}),98);
__d("MAWDbEditMsgHistory",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return(h||(h=d("I64"))).of_float(a)}function c(a){return(h||(h=d("I64"))).to_float(a)}g.unsafeCoerceToEditMsgHistoryId=a;g.convertToEditMsgHistoryId64=b;g.convertToEditMsgHistoryId=c}),98);
__d("MAWDbEditMsgHistoryTxns",["MAWAckLevel","MAWDbEditMsgHistory","MAWDexieTable","MAWIndexedDb","MAWVault","WALogger","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[getEditHistoryMsgByEditedProtocolMsgId] Suspected multiple instances of same message!"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[getEditHistoryMsgByEditedProtocolMsgId] Can't have "," messages with the same editExternalId!"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No msgId found mapped with externalId: Edit messages with the externalId do not have associated Msg in the IDB."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n          'No edit history found for the messages despite there being an editCount greater than 0"]);k=function(){return a};return a}function a(a,b){var c=[];if(b.length===0)return d("MAWDexieTable").dexieResolve(c);b=b.filter(function(a){return a.editCount!=null&&a.editCount>0});var e=b.map(function(a){return[a.externalId,a.threadJid]});if(e.length===0)return d("MAWDexieTable").dexieResolve([]);var f=b.reduce(function(a,b){b.msgId!=null&&a.set(b.externalId,b.msgId);return a},new Map());return l(a,e).then(function(a){if(a.length===0){d("WATagsLogger").TAGS(["MAWLoadMsgsTxns"]).ERROR(k());return[]}for(var b=0;b<a.length;b++){var e=a[b],g=f.get(e.originalMsgExternalId);g!=null?c.push(babelHelpers["extends"]({},e,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(e.editMsgHistoryId),originalMsgId:g})):d("WATagsLogger").TAGS(["MAWLoadMsgsTxns"]).ERROR(j())}d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:c});return c})}function l(a,b){return a.editMsgHistory.where(["originalMsgExternalId","threadJid"]).anyOf(b).toArray()}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.editMsgHistory.get({editMsgHistoryId:b})}function c(a,b,c){return a.editMsgHistory.where("originalMsgExternalId").equals(c).filter(function(a){return a.editExternalId===b.externalId&&a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){if(a.length>1){var b=a.map(function(a){return""+a.editTs.toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(i(),a.length):d("WALogger").ERROR(h())}return a[0]})}function e(a,b){return b==null?d("MAWDexieTable").dexieResolve([]):a.editMsgHistory.where("originalMsgExternalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){var b=[];a.forEach(function(a){if(a==null)return;b.push(a)});return b})}function f(a,b){return a.editMsgHistory.bulkGet(b)}function m(a,b,c){var e=b.map(function(a,b){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(c[b])})});return a.messages.where("externalId").anyOf(e.map(function(a){return a.originalMsgExternalId})).toArray().then(function(a){var b=new Map();a.forEach(function(a){a!=null&&b.set(a.externalId,a)});return e.map(function(a){var c=b.get(a.originalMsgExternalId);return c==null?null:babelHelpers["extends"]({},a,{originalMsgId:c.msgId})}).filter(Boolean)}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:a});return c})}function n(a,b,c){c===void 0&&(c=!0);return a.editMsgHistory.bulkAdd(b,{allKeys:!0}).then(function(e){return c?m(a,b,e):d("MAWDexieTable").dexieResolve(e)})}function o(a,b,c,d){return d.then(function(d){return p(a,b,c,d)})}function p(a,b,c,e){var f=[];return a.editMsgHistory.where("originalMsgExternalId").equals(b).filter(function(a){return a.threadJid===e&&a.author===c&&(a.sendStatus==null||a.sendStatus>=d("MAWAckLevel").ACK.sent)}).toArray().then(function(a){a.forEach(function(a){f.push({messageId:a.editExternalId,originalMessageId:a.originalMsgExternalId,text:d("MAWVault").unvault(a.msgContent.content),timestamp:a.editTs})});return f})}function q(a,b,c,d){return a.editMsgHistory.where("originalMsgExternalId").equals(b).filter(function(a){return a.threadJid===d&&a.author===c})["delete"]().then(function(){})}var r=function(a,b){return a.editMsgHistory.where(["originalMsgExternalId","threadJid"]).anyOf(b)["delete"]().then(function(){return d("MAWDexieTable").dexieResolve(b.length)})};function s(a,b,c){return a.editMsgHistory.put(babelHelpers["extends"]({},b,{msgContent:c.msgContent})).then(function(b){return a.editMsgHistory.get({editMsgHistoryId:b})})}g.loadEditMsgHistory=a;g.getEditHistoryByOriginalMsgExternalIdAndThreadJid=l;g.maybeGetEditMsgHistoryFromEditMsgHistoryId=b;g.getEditHistoryMsgByEditedProtocolMsgId=c;g.maybeGetEditMsgHistoryFromProtocolMsgId=e;g.bulkGetEditMsgHistorys=f;g.bulkAddEditMsgHistory=n;g.getEditHistoryAsEchoWithJidPromise=o;g.getEditHistoryAsEcho=p;g.bulkRemoveEditHistory=q;g.deleteExpiredEditMsgHistory=r;g.updateEditMsgHistoryWithNewIncomingMsg=s}),98);
__d("MAWDbPendingStanza",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";var h="revoked",i="deleteForMe",j="deleteThread";b="Revoked";d="DeleteForMe";e="DeleteThread";f={DELETE_FOR_ME:d,DELETE_THREAD:e,REVOKED:b};function a(a){switch(a){case"Revoked":return h;case"DeleteForMe":return i;case"DeleteThread":return j;default:return c("WAAssertUnreachable")(a)}}g.PENDING_REVOKED=h;g.PENDING_DELETE_FOR_ME=i;g.REVOKED=b;g.DELETE_FOR_ME=d;g.PENDING_TYPE=f;g.getPendingSuffix=a}),98);
__d("MAWDeleteThreadUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){if(a.pendingContent.type==="DeleteThread"){a=a.pendingContent.content.metaSyncMessageRange.lastMessageTimestamp;a!=null&&b.push(a)}});if(b.length===0)return null;b.sort(function(a,b){return b-a});a=b[0];return{lastMessageTimestamp:a}}function b(a,b){return b!=null&&b.lastMessageTimestamp>=a}f.getLatestDeleteThreadInfo=a;f.isMsgDeletedViaDeleteThread=b}),66);
__d("MAWSharedCOPLogger",["WATagsLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(c("gkx")("4255")?["COP","WORM"]:["COP"]);g["default"]=a}),98);
__d("WAPersistedQueueCache",["WAResolvable","WAShiftTimer","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during flush: ",""]);h=function(){return a};return a}function a(a,c,e){var f=d("WATagsLogger").TAGS(["PersistedQueue",a,"cache"]),g=[],i=new(d("WAResolvable").Resolvable)(),j=(a=e)!=null?a:{},k=new(d("WAShiftTimer").ShiftTimer)(function(){void n()});return{commit:function(){return n()},add:function(a){g.push(a);a=i;l();m();return a.promise},config:function(a){j=a}};function l(){j.cacheSize!=null&&g.length>=j.cacheSize&&void n()}function m(){if(j.maxDelay!=null){var a=j.maxDelay;k.cancel();k.onOrAfter(a)}}function n(){var a,e;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:if(!(g.length===0)){j.next=2;break}return j.abrupt("return");case 2:k.cancel();a=g;g=[];e=i;i=new(d("WAResolvable").Resolvable)();j.prev=7;j.next=10;return b("regeneratorRuntime").awrap(c(a));case 10:e.resolve();j.next=18;break;case 13:j.prev=13;j.t0=j["catch"](7);f.ERROR(h(),j.t0);e.reject(j.t0);throw j.t0;case 18:case"end":return j.stop()}},null,this,[[7,13]])}}g.makePersistedQueueCache=a}),98);
__d("WAPubSub",[],(function(a,b,c,d,e,f){"use strict";var g=function(){function a(){this.$1=new Set()}var b=a.prototype;b.publish=function(a){this.$1.forEach(function(b){return b(a)})};b.subscribe=function(a){var b=this;this.$1.add(a);return function(){b.$1["delete"](a)}};return a}();function a(){return new g()}f.WAPubSub=g;f.simplePubSub=a}),66);
__d("WAPersistedQueue",["WALogger","WAPersistedQueueCache","WAPubSub"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] new entry & commit"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] new entry"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] flush: ","}"]);j=function(){return a};return a}var k=function(){function a(a,b,c){var e=this;this.$1=d("WAPubSub").simplePubSub();this.keys=function(){return e.$4.keys(e.$3)};this.read=function(a){return e.$4.read(e.$3,a)};this.$3=a;this.$4=b;this.$2=d("WAPersistedQueueCache").makePersistedQueueCache(a,function(c){return b.write(a,c).then(function(){d("WALogger").DEV(j(),c.length),e.$1.publish({type:"flush"})})},c)}var b=a.prototype;b.subscribe=function(a){return this.$1.subscribe(a)};b.index=function(a){function b(b){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(a){return this.$4.index(this.$3,a)});b.addPending=function(a,b,c){d("WALogger").DEV(i()),this.$1.publish({type:"new_entity"}),void this.$2.add(a).then(function(){return b==null?void 0:b()},function(a){return c==null?void 0:c(a)})};b.addAndCommit=function(a){var b=this;d("WALogger").DEV(h());this.$1.publish({type:"new_entity"});a.forEach(function(a){return void b.$2.add(a)});return this.$2.commit()};b.commit=function(){return this.$2.commit()};b.ack=function(a){return this.$4.ack(this.$3,a)};b["delete"]=function(a){return this.$4["delete"](this.$3,a)};b.clear=function(){return this.$4.clear(this.$3)};return a}();function a(a,b,c){return new k(a,b,c)}g.PersistedQueue=k;g.initPersistedQueue=a}),98);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({DECRYPT_MESSAGE_FINAL:"decrypt_message_final",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MEDIA_VALIDATE:"media_validate",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ICDC_ERROR:"icdc_error",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RETRY_RECEIPTS_SENT:"retry_receipts_sent",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",APP_STATE_SYNC_DAILY:"app_state_sync_daily",SYNCD:"syncd",SEND_MESSAGE:"send_message",RECEIVE_MESSAGE:"receive_message",SYNCD_KEY_ROTATION:"syncd_key_rotation",REMOVE_PARTICIPANTS:"remove_participants",CREATE_GROUP:"create_group",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_DISCONNECT:"wa_disconnect",WA_JOB_MANAGER:"wa_job_manager",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",ONE_QUEUE:"one_queue",PROTOCOL_QUEUE_CONSUMER:"protocol_queue_consumer",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key",EB_RESTORE_WITH_HIM:"eb_restore_with_him",WORM:"worm"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]);i=function(){return a};return a}c=6e4;e=18e4;f=10*60*1e3;var j=0;function a(){var c=[];function e(a){c.push(a)}function b(){d("WALogger").WARN(i()),c.length=0}function a(a){c.length===0&&d("WALogger").WARN(h()),c.forEach(function(b){b(a)})}return{subscribe:e,notify:a,clear:b}}a=a();var k=a.notify,l=a.clear;a=a.subscribe;function b(a,b,c,d){var e;c==null&&j++;var f=(e=c)!=null?e:j,g="open";c==null?k({name:a,stage:"START",instanceKey:f,annotations:b,timeoutInMs:d}):k({name:a,stage:"RESUME",instanceKey:f,annotations:b});return{addPoint:function(c,b){k({name:a,stage:"POINT",reason:c,instanceKey:f,annotations:b})},addAnnotations:function(b){k({name:a,stage:"ANNOTATE",instanceKey:f,annotations:b})},endSuccess:function(b){k({name:a,stage:"SUCCESS",instanceKey:f,annotations:b}),g="closed"},endFail:function(c,b){k({name:a,stage:"FAIL",reason:c,instanceKey:f,annotations:b}),g="closed"},getFlowDetails:function(){return{name:a,instanceKey:f}},isActive:function(){return g==="open"}}}g.QPL_DEFAULT_TIMEOUT_IN_MS=c;g.QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS=e;g.QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS=f;g.clear=l;g.subscribe=a;g.startMetric=b}),98);
__d("WADbTransactor",["MAWIndexedDb","MAWTransactionMode","WAErr","WAExceededStorageQuota","WAPREList","WAPREMetrics","asyncToGeneratorRuntime","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=Object.keys(a),g=f.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,j=new Array(a),k=0;k<a;k++)j[k]=arguments[k];return d("MAWIndexedDb").getSignalDB(b).then(function(a){return h(g,f,function(){return e(a.stores).apply(void 0,j)})})["catch"](function(a){d("WAExceededStorageQuota").checkQuotaExceededError(a);a=i(a);throw c("WAErr")("["+((a=a==null?void 0:a.toString())!=null?a:"unknown error")+"] Error performing %s transaction "+b)})}}function h(a,b,e){if(c("dexie_maw").currentTransaction!=null)throw c("WAErr")("protocolDB transactor %s cannot be called within another transaction");return d("MAWIndexedDb").getSignalDB().then(function(c){return c.transact(a,b,e)})}function i(a){if(a instanceof Error)return a;else if(typeof a==="string")return c("WAErr")(a);else return null}function e(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a+"_"+e,g=a==="stanzaQueue"?d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WORM,{string:{operationType:f},bool:{isDexiePQ:!0}},void 0,1e4):null,h=(yield d("MAWIndexedDb").getDB(f));return h.transact(b,[a],function(){return c(h.stores[a])}).then(function(a){g==null?void 0:g.endSuccess();return a})["catch"](function(a){g==null?void 0:g.endFail("error");d("WAExceededStorageQuota").checkQuotaExceededError(a);var b=i(a);throw a("["+((a=b==null?void 0:b.toString())!=null?a:"unknown error")+"] Error performing %s transaction "+f)})});return j.apply(this,arguments)}g.makeSignalTransactor=a;g.persistedQueueTransactor=e}),98);
__d("WAPersistedQueueApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{ack:k,clear:m,"delete":l,index:i,keys:n,read:h,write:j}}function h(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();(b==null?void 0:b.order)==="desc"&&(a=a.reverse());(b==null?void 0:b.filter)!=null&&(a=a.filter(b.filter));(b==null?void 0:b.limit)!=null&&(a=a.limit(b.limit));return a.toArray()},"read")}function i(a,b){return{equals:function(c){return{read:function(e){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.where(b).equals(c.length===1?c[0]:c);(e==null?void 0:e.order)==="desc"&&(a=a.reverse());(e==null?void 0:e.filter)!=null&&(a=a.filter(e.filter));(e==null?void 0:e.limit)!=null&&(a=a.limit(e.limit));return a.toArray()},"index-equal")}}},keys:function(){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);return a.uniqueKeys()},"index-keys")},read:function(c){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);(c==null?void 0:c.order)==="desc"&&(a=a.reverse());(c==null?void 0:c.filter)!=null&&(a=a.filter(c.filter));(c==null?void 0:c.limit)!=null&&(a=a.limit(c.limit));return a.toArray()},"index-read")}}}function j(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkAdd(b).then(function(){})},"write")}function k(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"ack")}function l(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"delete")}function m(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.clear().then(function(){})},"clear")}function n(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();return a.primaryKeys()},"keys")}g.dexieApiForPersistedQueue=a;g.persistedQueueRead=h;g.persistedQueueIndex=i;g.persistedQueueWrite=j;g.persistedQueueAck=k;g.persistedQueueDelete=l;g.persistedQueueClear=m;g.persistedQueueKeys=n}),98);
__d("MAWDbStaleQueue",["MAWCurrentUser","MAWDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MAWSharedCOPLogger","WAGetPlatformFromStanzaId","WAOdsEnums","WAPersistedQueue","WAPersistedQueueApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping: ",", error: ",". Source: ",""]);h=function(){return a};return a}var i=null;function j(){if(i)return i;var a=d("WAPersistedQueue").initPersistedQueue("staleQueue",d("WAPersistedQueueApi").dexieApiForPersistedQueue());i=a;return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.type==="message"?a.subtype!=null?d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.stanzaId):d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.message.details.externalId):null;c("MAWSharedCOPLogger").EXPECTED_ERROR(h(),a.type,b,e);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.POISON_QUEUE_ENTTITY,key:""+a.type});e=j();var f=d("MAWCurrentUser").getID();f=(f=(yield d("MAWDbVersion").getDexieDbVersion(d("MAWIndexedDbMetadata").dbName(f))))!=null?f:0;if(a.type!=="message")return;return e.addAndCommit([{dbVersion:f,exception:b,stanza:a}])});return k.apply(this,arguments)}e=function(){return j().read({limit:1}).then(function(a){return a.length===0})};f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=500);a=j().read({limit:a});a=(yield a.then(function(a){return a.flatMap(function(a){return a})}));return a});return function(b){return a.apply(this,arguments)}}();g.mawAddStaleStanza=a;g.isEmpty=e;g.read=f}),98);
__d("MAWIsQuotaExceededError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.name==="QuotaExceededError"||a.inner&&a.inner.name==="QuotaExceededError"};f.isQuotaExceededError=a}),66);
__d("MAWBridgeUpload",["MAWMainTraceUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.actionType,c=a.attachmentContext,d=a.authTs,e=a.echoDocument,f=a.echoEncodingLatencyNs,g=a.errorCode,i=a.errorMessage,j=a.messageId,k=a.messageType,l=a.productType,m=a.protoMsg,n=a.sortOrderMs,o=a.threadId,p=a.traceId;a=a.uploadTrackingInstanceKey;c=h(c,l!=null?l:"msgr");return{actionType:b,attachmentBackupContext:c,authTs:d,echoDocument:e,echoEncodingLatencyNs:f,errorCode:g,errorMessage:i,messageId:j,messageType:k,protoMsg:m,sortOrderMs:n,threadId:o,traceId:p,uploadTrackingInstanceKey:a}}function b(a,b,c,d,e,f){return{actionType:f,echoDocument:e,folderType:b,threadId:a,transportKey:c,ts:d}}function c(a,b,c,d,e,f,g,h){return{deliveryObjectId:a,mediaType:b,messageId:c,productType:d,threadId:e,threadJid:f,traceId:h,ts:g}}function h(a,b){if(a==null)return void 0;else{a={attachmentTraceId:d("MAWMainTraceUtils").createTraceId(),mediaType:a.mediaType,zippyObjectId:a.mediaObjectId};a={attachmentInfos:[a],productType:b};return a}}g.createBridgeUploadMessage=a;g.createBridgeDeleteMessagesOfThread=b;g.createBridgeUploadAttachment=c;g.createBridgeUploadAttachmentBackupContext=h}),98);
__d("MAWUploadThreadTxns",["$InternalEnum","MAWFolderTypes"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5});function i(a){switch(a){case d("MAWFolderTypes").FOLDER_ID.INBOX:return h.INBOX;case d("MAWFolderTypes").FOLDER_ID.PENDING:return h.PENDING;case d("MAWFolderTypes").FOLDER_ID.ARCHIVED:return h.ARCHIVED;default:return h.INBOX}}function a(a){return i(a).toString()}g.FolderType=h;g.getFolderTypeAsText=a}),98);
__d("MAWBridgeEventTransmitter",["MAWBridge","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypesCreators","MAWBridgeUpload","MAWIndexedDb","MAWUploadThreadTxns","WAJids","WATimeUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"IssuePointQuery",value:{jid:f,messageId:a,startSortKey:c,taskSource:e,threadId:b}}]})}function b(a,b){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessagesOfThread",value:d("MAWBridgeUpload").createBridgeDeleteMessagesOfThread(d("WAJids").threadIdForChatJid(a.jid),d("MAWUploadThreadTxns").getFolderTypeAsText(a.folder),"AdvancedCrypto",(a=b)!=null?a:d("WATimeUtils").castToMillisTime(1),null,2)})}function e(a,b,c,e,f,g){d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(b,c,e,f,g)})}function f(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(a,b,c)}]})}function h(a,b,e){var f=c("qpl")._(521482576,"1069");(e==null?void 0:e.get(a.externalId))!=null?d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(a,e.get(a.externalId),void 0,f,b,"EncryptedBackups")}]}):d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,void 0,f,b,"EncryptedBackups")}]})}function i(a,b,c,e){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a,folder:b,threadJid:e})}]})}function j(a,b,c){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessageRangesV2",value:{minMsgId:a,minTimestampMs:b,threadJid:c}})}g.issuePointQueryOutsideTxn=a;g.deleteMessagesOfThreadAfterTxn=b;g.issueMsgLoadedEventAfterTxn=e;g.startTraceOutsideTxn=f;g.issueNewMsgUiEventOutsideTxn=h;g.updateThreadOutsideTxn=i;g.deleteMessageRangesV2AfterTxn=j}),98);
__d("MAWSharedRestoreUnavailableMessages",["LSMEBTaskCreationSource","MAWBridgeEventTransmitter","WAGlobals","WAJids","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=new Map();function j(a){if(i.has(a.externalId))return;i.set(a.externalId,!0);c("setTimeout")(function(){var b=a.chat;d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(a.externalId,d("WAJids").threadIdForChatJid(b),void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES,b)},h)}function a(a){a.forEach(function(a){if(a.type!=="message")return;if(a.subtype!=null){if(a.subtype==="unavailable"||a.subtype==="ciphertext"){var b=d("WAJids").extractUserJid(a.from);j({author:d("WAGlobals").getMyUserJid()===b?"@me":b,chat:a.jid,externalId:a.stanzaId})}}else(a.message.decrypted.type==="IncomingCiphertextMsg"||a.message.decrypted.type==="UnavailableMsg")&&j(a.message.decrypted.id)})}g.restoreUnavailableMessages=a}),98);
__d("WAMapContentTypeToFbType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"text":return"text";case"media":return"media";case"reaction":return"reaction";case"live_location":case"pay":case"product_list":case"poll_creation":case"poll_vote":case"scheduled_call":return"text";default:return"text"}}f.mapContentTypeToFbType=a}),66);
__d("WAProtocolQueue",["WAErr","WAGlobals","WAJids","WALogger","WAMapContentTypeToFbType","WAPersistedQueue"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Protocol Queue is already initialized"]);h=function(){return a};return a}var i=5e3,j=null;function a(a){if(j!=null){d("WALogger").WARN(h());return j}a=d("WAPersistedQueue").initPersistedQueue("stanzaQueue",a,{cacheSize:null,maxDelay:i});j=a;return j}function b(){if(!j)throw c("WAErr")("Protocol queue not initialized");return j}function e(a){return{flush:function(){return a.commit()}}}function f(a){return a.map(function(a){return a.type==="message"?k(a):babelHelpers["extends"]({},a)})}function k(a){switch(a.subtype){case"unavailable":var b=a,c=d("WAJids").extractUserJid(b.from);c={id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:b.jid,externalId:b.stanzaId},ts:b.serverTs,type:"UnavailableMsg"};return{incomingType:"wa",jid:b.jid,message:{decrypted:c,details:{count:null,externalId:b.stanzaId,folder:b.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return{author:b.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:b.from,chat:a,deviceJid:b.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:b.offline,recipient:b.recipient,reportingMeta:b.reportingMeta,retryCount:b.retryCount,ts:b.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(b.contentType)}},priority:b.priority,stanzaId:b.stanzaId,stanzaQueueId:a.stanzaQueueId,type:b.type};case"armadillo":var e=a;c=d("WAJids").extractUserJid(e.from);c={device:{id:d("WAJids").extractDeviceId(e.from),identity:e.remoteIdentity},folder:e.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:e.jid,externalId:e.stanzaId},msg:e.message,recipientsCount:null,reportingMeta:e.reportingMeta,ts:e.serverTs,type:"IncomingMsg"};return{incomingType:a.incomingType,jid:e.jid,message:{decrypted:c,details:{count:null,externalId:e.stanzaId,folder:e.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(a){return{author:e.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:e.from,chat:a,deviceJid:e.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:e.offline,recipient:e.recipient,reportingMeta:e.reportingMeta,retryCount:e.retryCount,ts:e.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(e.contentType)}},priority:e.priority,stanzaId:e.stanzaId,stanzaQueueId:a.stanzaQueueId,type:e.type};case"instamadillo":var f=a;c=d("WAJids").extractUserJid(f.from);c={device:{id:d("WAJids").extractDeviceId(f.from),identity:f.remoteIdentity},folder:f.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:f.jid,externalId:f.stanzaId},msg:f.message,recipientsCount:null,reportingMeta:f.reportingMeta,ts:f.serverTs,type:"InstamadilloMsg"};return{incomingType:"wa",jid:f.jid,message:{decrypted:c,details:{count:null,externalId:f.stanzaId,folder:f.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(f.jid,{group:function(a){return{author:f.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:f.from,chat:a,deviceJid:f.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!0,offline:f.offline,recipient:f.recipient,reportingMeta:f.reportingMeta,retryCount:f.retryCount,ts:f.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(f.contentType)}},priority:f.priority,stanzaId:f.stanzaId,stanzaQueueId:a.stanzaQueueId,type:f.type};case"ciphertext":var g=a;c=d("WAJids").extractUserJid(g.from);c={createPlaceholder:g.contentType!=="reaction",id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:g.jid,externalId:g.stanzaId},ts:g.serverTs,type:"IncomingCiphertextMsg"};return{incomingType:"wa",jid:g.jid,message:{decrypted:c,details:{count:null,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(g.contentType),externalId:g.stanzaId,folder:g.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(g.jid,{group:function(a){return{author:g.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:g.from,chat:a,deviceJid:g.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:g.offline,recipient:g.recipient,reportingMeta:g.reportingMeta,retryCount:g.retryCount,ts:g.serverTs}},priority:g.priority,stanzaId:g.stanzaId,stanzaQueueId:a.stanzaQueueId,type:g.type};default:a;return babelHelpers["extends"]({},a)}}var l=9,m=5,n=2;function o(a){return a}function p(a){return a}g.initProtocolQueue=a;g.protocolQueue=b;g.protocolQueueFlushable=e;g.mapProtocolEntriesV2toV1=f;g.mapProcolQueueMessageV2toV1=k;g.WAProtocolQueuePriorityHigh=l;g.WAProtocolQueuePriorityLow=m;g.WAProtocolQueuePriorityBackground=n;g.appdataApplicationProtocol=o;g.extractSubProtocolFromAppdataProtocol=p}),98);
__d("WAWaterFlow",["$InternalEnum","WAErr","WAMapWithDefault","WAPREMetrics","WATagsLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose([" -> Done. Success: false\nTime taken: "," sec;","","\n"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([" -> Done. Success: true\nTime taken: "," sec;","","\n"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([" -> in progress.\nTime passed: "," sec;","","\n"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose([""," -> Done.;\nTime taken: ",";\nTime from start: ",";","","\n"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["No start point was found for step: ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose([""," -> Start.","",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose([" -> Start.",""]);q=function(){return a};return a}var r=d("WATagsLogger").TAGS(["WAWaterflow"]),s=b("$InternalEnum").Mirrored(["INIT","ON_GOING","COMPLETED"]),t=function(){function a(a,b,c){this.$1=s.INIT,this.$7=[],this.$9=new(d("WAMapWithDefault").MapWithDefault)(function(){return[]}),this.$5=r.TAGS([a]),this.$8=b,this.$3={},this.$4=new Set(),this.$10=!c,this.$6=d("WATimeUtils").performanceAbsoluteNow()}var b=a.prototype;b.$11=function(){var a=this,b={"int":{},bool:{},string:{},string_array:{}};this.$4.forEach(function(c){var d=a.$3[c];Array.isArray(d)&&(b.string_array[c]=d);typeof d==="boolean"&&(b.bool[c]=d);typeof d==="number"&&(b["int"][c]=d);typeof d==="string"&&(b.string[c]=d)});return b};b.$12=function(a){if(a==null)return;for(var b in a){var c=a[b];c!==this.$3[b]&&(this.$4.add(b),this.$3[b]=c)}};b.$13=function(a,b){this.$6=d("WATimeUtils").performanceAbsoluteNow();this.$12(a);a=this.$11();this.$4.clear();this.$10&&this.$5.LOG(q(),u(this.$3));this.$1=s.ON_GOING;if(this.$8==null)return this;this.$2=d("WAPREMetrics").startMetric(this.$8,a,b);return this};b.startMetric=function(a){return this.$13(a)};b.reStartMetric=function(a,b){return this.$13(b,a)};b.startPoint=function(a,b){var e;if(typeof a!=="string"){this.$5.ERROR(p());throw c("WAErr")("Step should be a enum type")}this.$12(b);b=this.$11();(e=this.$2)==null?void 0:e.addPoint(a+"_start",b);this.$4.clear();e={step:a,from:d("WATimeUtils").performanceAbsoluteNow()};this.$7.push(e);this.$9.get(a).push(e);this.$10&&this.$5.LOG(o(),a,v(this.$7,this.$6),u(this.$3))};b.endPoint=function(a,b){var e,f=d("WATimeUtils").performanceAbsoluteNow(),g=this.$9.get(a).pop();g==null?this.$5.WARN(n(),a):g.to=f;if(typeof a!=="string"){this.$5.ERROR(m());throw c("WAErr")("Step should be a enum type")}this.$12(b);b=this.$11();(e=this.$2)==null?void 0:e.addPoint(a+"_end",b);this.$4.clear();this.$10&&this.$5.LOG(l(),a,w(g!=null?f-g.from:0),w(f-this.$6),v(this.$7,this.$6),u(this.$3))};b.isOnGoing=function(){return this.$1===s.ON_GOING};b.isCompleted=function(){return this.$1===s.COMPLETED};b.annotate=function(a){this.$12(a)};b.reAnnotate=function(a){this.$12(a(this.$3))};b.getAnnotations=function(){return this.$3};b.annotateImmediately=function(a){var b;this.$12(a);a=this.$11();(b=this.$2)==null?void 0:b.addAnnotations(a);this.$4.clear()};b.addPoint=function(a,b){var d;if(typeof a!=="string"){this.$5.ERROR(k());throw c("WAErr")("Step should be a enum type")}this.$12(b);b=this.$11();(d=this.$2)==null?void 0:d.addPoint(a,b);this.$4.clear()};b.getStartTime=function(){return this.$6};b.log=function(){this.$10&&this.$5.LOG(j(),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3))};b.endSuccess=function(a){var b;this.$12(a);a=this.$11();(b=this.$2)==null?void 0:b.endSuccess(a);this.$4.clear();this.$10&&this.$5.LOG(i(),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3));this.$1=s.COMPLETED};b.endFail=function(a,b){var c;this.$12(b);b=this.$11();(c=this.$2)==null?void 0:c.endFail(a,b);this.$4.clear();this.$10&&this.$5.LOG(h(),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3));this.$1=s.COMPLETED};return a}();function a(a){if(a==null)return{};var b={bool:{},"int":{},string:{},string_array:{}};for(var c in a)Array.isArray(a[c])&&(b.string_array[c]=a[c]),typeof a[c]==="number"&&(b["int"][c]=a[c]),typeof a[c]==="boolean"&&(b.bool[c]=a[c]),typeof a[c]==="string"&&(b.string[c]=a[c]);return b}function u(a){a=Object.entries(a).map(function(a){var b=a[0];a=a[1];return b+": "+String(a)});return a.length>0?"\n"+a.join("\n"):""}function v(a,b){a=a.map(function(a){var c=a.step,e=a.from;a=a.to;return typeof c==="string"?c+" => Started after: "+w(e-b)+"; "+(a!=null?"Completed after: "+w(a-e):"In progress: "+w(d("WATimeUtils").performanceAbsoluteNow()-e)):""}).filter(Boolean);return a.length>0?"\n"+a.join("\n"):""}function w(a){return a/1e3+"s"}function e(a,b,c){return new t(a,b,(a=c)!=null?a:!1)}g.WAWaterflow=t;g.convertToPREAnnotation=a;g.makeWaterflow=e}),98);
__d("MAWSharedCOPHandleBatch",["MAWDbStaleQueue","MAWIsQuotaExceededError","MAWSharedCOPLogger","MAWSharedRestoreUnavailableMessages","WAPREList","WAProtocolQueue","WAWaterFlow","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received more than 1 entry, despite having limit === 1"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed processing "," items"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ackProtocols] Cannot ack from MAWConsumer: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error while processing stanzas batch. ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Quota exceeded while processing stanzas batch. ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," stanzas. Config:",""]);m=function(){return a};return a}function n(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield a(b));b.order==="desc"&&(g=g.toReversed());if(g.length===0)return{exhausted:!0,handled:0};f==null?void 0:f.publish({type:"maw-infra-batch"});c("MAWSharedCOPLogger").LOG(m(),g.length,b);var o=d("WAWaterFlow").makeWaterflow("consumer",d("WAPREList").PRE_METRIC.PROTOCOL_QUEUE_CONSUMER,!0).startMetric();d("MAWSharedRestoreUnavailableMessages").restoreUnavailableMessages(g);var p=(yield e(g,o).then(function(a){return[a,null,!1]})["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a)){c("MAWSharedCOPLogger").ERROR(l(),a);o.endFail("quota_exceeded");return[[],null,!0]}c("MAWSharedCOPLogger").ERROR(k(),a);return[[],a instanceof Error?a:c("err")(""+a),!1]})),q=p[0],r=p[1];p=p[2];if(p)return{exhausted:!0,handled:0};r==null?o.endSuccess():o.endFail("fail_process_entity");yield d("WAProtocolQueue").protocolQueue().ack(q)["catch"](function(a){return c("MAWSharedCOPLogger").ERROR(j(),a)});if(q.length>=g.length)return{exhausted:!1,handled:q.length};c("MAWSharedCOPLogger").WARN(i(),g.length-q.length);if(b.limit===1){g.length>1&&c("MAWSharedCOPLogger").ERROR(h());if(g.length===0)return{exhausted:!1,handled:0};p=g[0];r=(g=r==null?void 0:r.toString())!=null?g:"not-processed";yield d("WAProtocolQueue").protocolQueue()["delete"]([p.stanzaQueueId]);yield d("MAWDbStaleQueue").mawAddStaleStanza(p,r);return{exhausted:!1,handled:1}}p=(yield n(a,{limit:Math.ceil(((g=b.limit)!=null?g:1)/2),order:b.order},e,f));return{exhausted:!1,handled:q.length+p.handled}});return o.apply(this,arguments)}g.copHandleBatch=n}),98);
__d("WAPromiseEach",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";a=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=[],e=0;case 2:if(!(e<a.length)){f.next=11;break}f.t0=d;f.next=6;return b("regeneratorRuntime").awrap(c(a[e]));case 6:f.t1=f.sent,f.t0.push.call(f.t0,f.t1);case 8:e++;f.next=2;break;case 11:return f.abrupt("return",d);case 12:case"end":return f.stop()}},null,this)};f.promiseEach=a}),66);
__d("MAWSharedCOPHandler",["$InternalEnum","MAWSharedCOPHandleBatch","MAWSharedCOPLogger","WAPromiseEach","WAProtocolQueue","asyncToGeneratorRuntime","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processed "," stanzas. Exhausted: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SafeGuard] Processing get downgraded to in order processing. Verify if it's intentional"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[UserBlocking] Processed "," stanzas from "," chats"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[LoadMoreMsgs] "," requested: ",", processed: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OnDemand] Fatal: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[UserFacing] Processed "," stanzas. Exhausted: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Background] Processed "," stanzas. Exhausted: ",""]);n=function(){return a};return a}var o=b("$InternalEnum").Mirrored(["PERSIST","PERSIST_FAIL","FOLLOW_UP","PROCESS_RETRIES"]),p=c("justknobx")._("2541"),q=c("justknobx")._("2542"),r=c("justknobx")._("2653");function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.processEntries;var b=r?"desc":"asc",e=c("justknobx")._("2539");e=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("priority").read,{limit:e,order:b},a,null));b=e.exhausted;a=e.handled;c("MAWSharedCOPLogger").LOG(n(),a,b);return{exhausted:b,handled:a}});return s.apply(this,arguments)}function e(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.activeJid;a=a.processEntries;if(!r)return x({processEntries:a}).then(function(){return{exhausted:!0}});var e={exhausted:!0,handled:0};b!=null&&(e=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([b,d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:q,order:"desc"},a,null)));b=e.handled;e.exhausted&&(e=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("priority").equals([d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:q,order:"desc"},a,null)),b+=e.handled);b>0&&c("MAWSharedCOPLogger").LOG(m(),b,e.exhausted);return{exhausted:e.exhausted}});return t.apply(this,arguments)}function f(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.activeJid,e=a.count;a=a.processEntries;if(!r)return;a=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([b,d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:e,order:"desc"},a,null)["catch"](function(a){c("MAWSharedCOPLogger").ERROR(l(),a)}));c("MAWSharedCOPLogger").LOG(k(),b,e,a==null?void 0:a.handled)});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.activeChat,f=a.processEntries,g=a.pubSub;a=a.recentChats;if(!r)return x({processEntries:f,pubSub:g});var h=0;yield d("WAPromiseEach").promiseEach(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c("gkx")("4258")&&a!==e?1:p;a=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([a,d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:b,order:"desc"},f,g));h+=a.handled});return function(b){return a.apply(this,arguments)}}());c("MAWSharedCOPLogger").LOG(j(),h,a.length)});return w.apply(this,arguments)}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.processEntries;a=a.pubSub;c("MAWSharedCOPLogger").ERROR(i());a==null?void 0:a.publish({type:"idle-oq-safe-guard"});var e=d("WAProtocolQueue").protocolQueue().index("priority").equals([d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read;while((f=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(e,{limit:c("justknobx")._("2540"),order:"asc"},b,(f=a)!=null?f:null))).exhausted===!1){var f;c("MAWSharedCOPLogger").LOG(h(),f.handled,f.exhausted)}});return y.apply(this,arguments)}g.ConsumerProcessingStages=o;g.copHandleBackgroundBatch=a;g.copHandleUserFacingBatch=e;g.copHandleMessagesOnDemand=f;g.copHandleRecentMessages=v}),98);
__d("MAWSharedCOPLoop",["$InternalEnum","MAWSharedCOPLogger","Promise","WAResolvable","WAShiftTimer","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Completed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stuck: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Possibly stuck: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["COPLoop fatal: ",""]);m=function(){return a};return a}var n=b("$InternalEnum")({BLOCKING:-1,NON_BLOCKING:0,BASE_TIMEOUT:2}),o=0,p=1,q=2,r=function(){function a(){var a=this;this.$2=0;this.$3=60;this.$4=30;this.$5=c("justknobx")._("2543");this.$6=new(d("WAResolvable").Resolvable)();this.$7=new(d("WAResolvable").Resolvable)();this.$8=new(d("WAResolvable").Resolvable)();this.$9=new(d("WAShiftTimer").ShiftTimer)(function(){try{a.$10()}catch(b){c("MAWSharedCOPLogger").ERROR(m(),b),a.$9.onOrBefore(a.$5)}});this.$11=c("MAWSharedCOPLogger").TAGS(["loop"]);this.$12=[new Map(),new Map(),new Map()]}var e=a.prototype;e.$13=function(){if(!this.$1)return;this.$2++;switch(this.$1.behaviour){case n.BLOCKING:break;case n.NON_BLOCKING:this.$1=null;return;case n.BASE_TIMEOUT:if(this.$2>Number(n.BASE_TIMEOUT)){this.$1=null;return}break}if(!this.$1)return;var a=this.$1;this.$2>this.$4&&a.stuck===!1&&(a.stuck=!0,this.$11.WARN(l(),a.id));this.$2>this.$3&&(this.$11.ERROR(k(),a.id),this.$1=null)};e.$14=function(){var a=this;if(this.$1!=null)return{endReached:!1};for(var b=o;b<=q;b++){var c=this.$12[b].entries().next().value;if(c!=null){var d=function(){var d=c[0],e=c[1];a.$12[b]["delete"](d);a.$1=e;a.$2=0;a.$11.LOG(j(),e.id);e.fn()["finally"](function(){a.$2=0,a.$11.LOG(i(),e.id),a.$1=null,(a.$12[o].size>0||a.$5===0)&&a.$9.forceRunNow()});return{v:{endReached:!1}}}();if(typeof d==="object")return d.v}b===o&&this.$6.resolve();b===p&&this.$7.resolve();b===q&&this.$8.resolve()}return{endReached:!0}};e.$10=function(){this.$13();var a=this.$14();a=a.endReached;a||this.$9.onOrBefore(this.$5)};e.$15=function(a,c,e,f){var g;for(var i=q;i>a;i--){var j=this.$12[i].get(c);j!=null&&(g=j.resolvable,this.$12[i]["delete"](c))}for(j=o;j<a;j++){i=this.$12[j].get(c);if(i!=null)return i.resolvable.promise}g==null&&(g=new(d("WAResolvable").Resolvable)());i={behaviour:f,fn:function(b){function a(){return b.apply(this,arguments)}a.toString=function(){return b.toString()};return a}(function(){g.resolve((h||(h=b("Promise"))).resolve().then(e));return g.promise}),id:c,resolvable:g,stuck:!1};this.$12[a].set(c,i);a===o&&this.$1==null?this.$9.forceRunNow():this.$9.onOrBefore(this.$5);return g.promise};e.awaitUserBlocking=function(a,b,c){this.$6.resolveWasCalled()&&(this.$6=new(d("WAResolvable").Resolvable)());this.$7.resolveWasCalled()&&(this.$7=new(d("WAResolvable").Resolvable)());this.$8.resolveWasCalled()&&(this.$8=new(d("WAResolvable").Resolvable)());return this.$15(o,a,b,c)};e.awaitUserFacing=function(a,b,c){this.$7.resolveWasCalled()&&(this.$7=new(d("WAResolvable").Resolvable)());this.$8.resolveWasCalled()&&(this.$8=new(d("WAResolvable").Resolvable)());return this.$15(p,a,b,c)};e.awaitBackground=function(a,b,c){this.$8.resolveWasCalled()&&(this.$8=new(d("WAResolvable").Resolvable)());return this.$15(q,a,b,c)};e.waitForBackgroundQueueEmpty=function(){return this.$8.promise};e.waitForUserFacingQueueEmpty=function(){return this.$7.promise};e.waitForUserUnblocked=function(){return this.$6.promise};return a}();function a(a){return"p0-"+a}var s=0;function e(a){s++;return a+"-"+s}function f(a){return a}var t="cop-rest",u="cop-user-facing",v="cop-user-blocking";g.COPBehaviour=n;g.COPLoop=r;g.makeChatCopId=a;g.makeCopGUID=e;g.makeCopNonUniqueId=f;g.copBackground=t;g.copUserFacing=u;g.copUserBlocking=v}),98);
__d("MAWSharedStaleQueueReporter",["MAWDbStaleQueue","MAWQplProxy","asyncToGeneratorRuntime","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWDbStaleQueue").isEmpty());if(a)return;a=c("justknobx")._("1498");a=(yield d("MAWDbStaleQueue").read(a));var b=a.map(function(a){return[a.dbVersion,a.exception]});d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056849770,"993"),{"int":{count:a.length},string_array:{dbErrors:Array.from(new Set(b.map(function(a){return a[1]}))),dbVersions:Array.from(new Set(b.map(function(a){return""+a[0]})))}}).endSuccess()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("WAWaitForUser",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)())}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("MAWSharedCOP",["FBLogger","MAWSharedCOPHandler","MAWSharedCOPLogger","MAWSharedCOPLoop","MAWSharedStaleQueueReporter","Promise","WAPubSub","WAWaitForUser","asyncToGeneratorRuntime","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["StaleQueue: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["IdleOQ: Offline"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Background FATAL: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["HighPri FATAL: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["HighPri FATAL: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["IdleOQ M2: Online"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["UserFacing FATAL: ",""]);o=function(){return a};return a}var p=function(){function a(a){var e=this;this.$1="offline";this.$2=d("WAPubSub").simplePubSub();this.$4=null;this.$5=new Set();this.$6=function(){e.queue.awaitUserFacing(d("MAWSharedCOPLoop").copUserFacing,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWSharedCOPHandler").copHandleUserFacingBatch({activeJid:e.$4,processEntries:e.$3}));a=a.exhausted;a||e.$6()}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)["catch"](function(a){c("MAWSharedCOPLogger").ERROR(o(),a),e.$6()})};this.queue=new(d("MAWSharedCOPLoop").COPLoop)();this.$3=a}var e=a.prototype;e.handleThreadMetadata=function(a){var b=this;a.forEach(function(a){b.$5.add(a)})};e.onlineProcessing=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;c("MAWSharedCOPLogger").LOG(n());try{yield this.queue.awaitUserBlocking(d("MAWSharedCOPLoop").makeCopNonUniqueId("online"),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSharedCOPHandler").copHandleUserFacingBatch({activeJid:void 0,processEntries:a.$3})}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)}catch(a){c("MAWSharedCOPLogger").ERROR(m(),a)}finally{this.$6(),this.$7()}});function e(){return a.apply(this,arguments)}return e}();e.$8=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;this.$2.publish({type:"maw-infra-start"});this.$4!=null&&this.$5.add(this.$4);try{yield this.queue.awaitUserBlocking(d("MAWSharedCOPLoop").copUserBlocking,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSharedCOPHandler").copHandleRecentMessages({activeChat:a.$4,processEntries:a.$3,pubSub:a.$2,recentChats:Array.from(a.$5)}),a.$2.publish({success:!0,type:"maw-infra-end"})}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)}catch(a){c("MAWSharedCOPLogger").ERROR(l(),a),this.$2.publish({success:!1,type:"maw-infra-end"})}finally{this.$6()}});function e(){return a.apply(this,arguments)}return e}();e.$7=function(){var a=this;this.queue.awaitBackground(d("MAWSharedCOPLoop").copBackground,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("MAWSharedCOPHandler").copHandleBackgroundBatch({processEntries:a.$3}));b=b.exhausted;b||a.$7()}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)["catch"](function(b){c("MAWSharedCOPLogger").ERROR(k(),b),a.$7()})};e.$9=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("MAWSharedCOPLogger").LOG(j());yield this.$8();this.$5.clear();this.$6();this.$7();this.queue.awaitBackground(d("MAWSharedCOPLoop").makeCopNonUniqueId("stale-queue-report"),function(){return c("MAWSharedStaleQueueReporter")()},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING)["catch"](function(a){c("MAWSharedCOPLogger").ERROR(i(),a)});return});function e(){return a.apply(this,arguments)}return e}();e.loadMoreMsgs=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=this;this.$4=a;return!d("WAWaitForUser").isStillWaitingForUserUnblocked()?(h||(h=b("Promise"))).resolve():this.queue.awaitUserBlocking(d("MAWSharedCOPLoop").makeCopNonUniqueId("load-more-msgs-"+a),function(){return d("MAWSharedCOPHandler").copHandleMessagesOnDemand({activeJid:a,count:c,processEntries:e.$3})},d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)});function c(b,c){return a.apply(this,arguments)}return c}();e.subscribeToOfflineQueue=function(a,b){var e=this;a.subscribe(function(a){switch(a.type){case"offline-start":e.$1="offline";d("WAWaitForUser").maybeResetWaitForUserUnblocked();break;case"offline-end":e.$1="online";e.$9()["finally"](function(){d("WAWaitForUser").unblockUser()});break;default:a.type;break}});b.subscribe(function(a){switch(a.type){case"flush":if(e.$1!=="online")return;c("promiseDone")(e.onlineProcessing());return}})};e.awaitBackground=function(a,b){var c=this;return d("WAWaitForUser").waitForUserUnblocked().then(function(){return c.queue.awaitBackground(a,b,d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING)})};e.subscribe=function(a){return this.$2.subscribe(a)};e.TEST_ONLY_setMode=function(a){this.$1=a};e.TEST_ONLY_getMode=function(){return this.$1};return a}(),q=null;function a(a){q!==null&&c("FBLogger")("messenger_e2ee_web").mustfix("COP init is called twice");q=new p(a);return q}function e(){if(q===null){c("FBLogger")("messenger_e2ee_web").mustfix("COP is called before init");throw c("err")("COP is called before init")}return q}g.COP=p;g.makeCOP=a;g.getCOP=e}),98);
__d("MAWMsgCleaner",["MAWLoggerUtils","MAWSharedCOP","MAWSharedCOPLoop","Promise","WAAssertUnreachable","WAShiftTimer","WATagsLogger","WATimeUtils","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow "," msgs' content cleaned"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::update ",""]);k=function(){return a};return a}a="Unsend";e="Ephemeral";f="DeleteForMe";var l="PendingStanza",m="Xma",n="IGDDM";f={DELETE_FOR_ME:f,EPHEMERAL:e,IGDDM:n,PENDING_STANZA:l,UNSEND:a,XMA:m};e=function(){function a(a,e){var f=this;this.$1=new(d("WAShiftTimer").ShiftTimer)(function(){c("gkx")("3547")?c("promiseDone")(d("MAWSharedCOP").getCOP().awaitBackground(d("MAWSharedCOPLoop").makeCopGUID(f.cleanerType),function(){return f.$2()})):c("promiseDone")(f.$2())});this.getNextTs=a.getNextTs;this.removeExpired=a.removeExpired;this.cleanerType=e;this.purgeEnabled=a.purgeEnabled;c("gkx")("3547")?c("promiseDone")(d("MAWSharedCOP").getCOP().awaitBackground(d("MAWSharedCOPLoop").makeCopGUID(e),function(){f.$1.forceRunNow();return(h||(h=b("Promise"))).resolve()})):this.$1.forceRunNow()}var e=a.prototype;e.update=function(a){var b=o(this.cleanerType);d("WATagsLogger").TAGS([b,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerUpdate]).LOG(k(),b,a);this.$1.onOrBefore(d("WATimeUtils").cappedMillisecondsUntil(a))};e.$2=function(){var a=this;if(!this.purgeEnabled())return(h||(h=b("Promise"))).resolve();var c=o(this.cleanerType);d("WATagsLogger").TAGS([c,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerPurge]).LOG(j(),c);return this.removeExpired().then(function(b){b>0&&d("WATagsLogger").TAGS([c,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerPurge]).LOG(i(),c,b);return a.getNextTs()}).then(function(b){b!=null&&a.update(b)})};return a}();function o(a){switch(a){case"Unsend":return"UnsendMsgCleaner";case"Ephemeral":return"EphemeralCleaner";case"DeleteForMe":return"DeleteForMeCleaner";case"PendingStanza":return"PendingStanzaCleaner";case"Xma":return"XmaCleaner";case"IGDDM":return"IGDDisappearingMsgCleaner";default:return c("WAAssertUnreachable")(a)}}n=e;g.CLEANER_TYPE=f;g.MsgCleaner=e;g.MSG_CLEANER_FOR_TESTING_ONLY=n}),98);
__d("MAWPendingStanzaCleaner",["MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["PendingStanzaCleaner: Adding timestamps (",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}var j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.PENDING_STANZA))}function b(a){if(j==null){var b="Trying to add new PendingStanzaCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),j.update(a)}function e(){return j}function f(){j=null}g.startPendingStanzaCleaner=a;g.addNewPendingStanzaCleanerTimestamp=b;g.getPendingStanzaCleaner_FOR_TESTING_ONLY=e;g.resetPendingStanzaCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWDbPendingStanzaTxns",["MAWDbPendingStanza","MAWDeleteThreadUtil","MAWPendingStanzaCleaner","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,e,f){var g=d("MAWDbPendingStanza").getPendingSuffix(f);return a.pendingStanzas.where("externalIdWithType").equals(b+"_"+g).filter(function(a){a=a.pendingContent;return a.type===f&&a.content.author===c&&a.content.threadJid===e}).first()}function a(a,b,c,e){return h(a,b,c,e,d("MAWDbPendingStanza").PENDING_TYPE.REVOKED)}function b(a,b,c,e){return h(a,b,c,e,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME)}function c(a,b){var c=b.map(function(a){a=a.expirationInSeconds;return d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+a)});b=b.map(function(a,b){var e=a.content,f=a.externalId;a=a.pendingStanzaType;return{deleteTs:c[b],externalIdWithType:f+"_"+d("MAWDbPendingStanza").getPendingSuffix(a),pendingContent:e}});return a.pendingStanzas.bulkAdd(b).then(function(){return c.forEach(d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp)}).then(function(){})}function e(a,b,c,e,f){f=d("MAWDbPendingStanza").getPendingSuffix(f);var g=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+c);c={deleteTs:g,externalIdWithType:e+"_"+f,pendingContent:b};return a.pendingStanzas.add(c).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(g)})}function f(a,b){var c=d("MAWDbPendingStanza").getPendingSuffix(d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD);return a.pendingStanzas.where("externalIdWithType").equals(b+"_"+c).toArray().then(function(a){return d("MAWDeleteThreadUtil").getLatestDeleteThreadInfo(a)})}function i(a){return a.pendingStanzas.toArray()}function j(a,b){b=b.map(function(a){return a.rowId});return a.pendingStanzas.bulkDelete(b)}function k(a){var b;return(a==null?void 0:(b=a.pendingContent)==null?void 0:b.type)===d("MAWDbPendingStanza").PENDING_TYPE.REVOKED?a==null?void 0:(b=a.pendingContent)==null?void 0:b.content:null}function l(a,b){var c=d("MAWDbPendingStanza").getPendingSuffix(d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD);b=b.map(function(a){return a+"_"+c});return a.pendingStanzas.where("externalIdWithType").anyOf(b).toArray().then(function(a){a=a.reduce(function(a,b){var c=a.get(b.externalIdWithType);c==null?a.set(b.externalIdWithType,[b]):c.push(b);return a},new Map());var b=new Map();a.forEach(function(a,c){c=d("WAJids").unsafeCoerceToChatJid(c.split("_")[0]);a=d("MAWDeleteThreadUtil").getLatestDeleteThreadInfo(a);a!=null&&b.set(c,a)});return b})}g.maybeGetPendingStanzaByExternalId=h;g.maybeGetPendingRevokedStanza=a;g.maybeGetPendingDeletedStanza=b;g.bulkPutPendingStanzas=c;g.putPendingStanza=e;g.maybeGetDeleteThreadFromPendingStanza=f;g.getAllPendingStanzas=i;g.deletePendingStanzas=j;g.getRevokedContent=k;g.bulkGetDeleteThreadPendingStanzas=l}),98);
__d("MAWAuthor",["WAGlobals","WAJids","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){if(a==null||a===d("WAJids").AUTHOR_SYSTEM)return null;if(d("WAJids").isAuthorMe(a))return d("WAGlobals").getMyUserJid();var b=d("WAJids").authorAsUserJid(a);if(b==null||c("isStringNullOrEmpty")(d("WAJids").userIdFromJid(b)))return null;else return d("WAJids").authorAsUserJid(a)};g.getAuthorUserJid=a}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","MAWIndexedDb","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."]);j=function(){return a};return a}var k=function(a){return a};function a(a,b){return a.reactions.put(k(b))}function b(a,b){return a.reactions["delete"](b.rowId).then(function(){var a=b.author,c=b.reactionId,e=b.reactToMsgId,f=b.threadJid;if(e==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:a,chatJid:f,reactToMsgId:e})});d("WALogger").LOG(j(),c)})}function e(a,b){return a.reactions.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function f(a,b){var c=d("MAWAuthor").getAuthorUserJid(b.author);return a.reactions.where("reactToExternalId").equals(b.externalId).filter(function(a){return(a.reactToAuthor===c||a.reactToAuthor===b.author)&&a.threadJid===b.chat}).toArray()}function l(a,b){var d=b.reduce(function(a,b){a.set(b.msgId,b);return a},new Map());return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId})).toArray().then(function(a){var b=a.filter(function(a){var b=a.reactToExternalId;a=a.reactToMsgId;return a!=null&&b===((b=d.get(a))==null?void 0:b.externalId)});b.length<a.length&&c("FBLogger")("messenger_e2ee_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return b})}function m(a,b){return l(a,[b])}function n(a,b){var c=b.author,d=b.chat;b=b.externalId;return a.reactions.where("externalId").equals(b).filter(function(a){return a.author===c&&a.threadJid===d}).first()}function o(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.reactions.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function p(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.author;b=b.externalId;var e=d("MAWAuthor").getAuthorUserJid(c);return a.reactions.where("reactToExternalId").equals(b).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===e}).toArray()})).then(function(b){b=b.reduce(function(a,b){return a.concat(b)},[]);b.forEach(function(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})});d("WALogger").LOG(i(),b.length);return a.reactions.bulkDelete(b.map(function(a){return a.rowId}))})}function q(a,b){return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId}))["delete"]().then(function(a){d("WALogger").LOG(h(),a)})}function r(a,b){return a.reactions.where("reactionId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.reactionId);return a+1})}g.coerceToReaction=k;g.putReaction=a;g.deleteReaction=b;g.getReaction=e;g.getReactionForEcho=f;g.getReactionsFromMessages=l;g.getReactionsFromMessage=m;g.maybeGetReactionByProtocolMsgId=n;g.getReactionMapByProtocolMsgId=o;g.deleteReactionsByUniqueMsgIdentifiers=p;g.deleteAllReactionsForMessages=q;g.getNextReactionIdNumberForThread=r}),98);
__d("MAWDeleteForMeMsgContentCleaner",["MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeleteForMeMsgContentCleaner: Adding timestamps (",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startDeleteForMeMsgContentCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.DELETE_FOR_ME))}function b(a){if(k==null){var b="Trying to add new DeleteForMeContentCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startDeleteForMeMsgContentCleaner=a;g.addNewDeleteForMeMsgContentCleanerTimestamp=b;g.getDeleteForMeMsgContentCleaner_FOR_TESTING_ONLY=e;g.resetDeleteForMeMsgContentCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWBridgeMsgCountdown",["MAWDbMsg","MAWLoggerUtils","WATagsLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["createBridgeMsgsStartCountdown: msg ",", expiration ",", ms until countdown ",", duration ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calling the messages starting countdown bridge event with remaning time less or equal to 0 (expired message)"]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown]);function a(a){return{msgs:a.map(function(a){var b,c=a.messageExpirationTs;b=(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec;if(c==null||b==null)return;var e=d("WATimeUtils").cappedMillisecondsUntil(c);if(e<=0){j.LOG(i());return}var f=b*1e3;e>f&&(e=f);j.LOG(h(),a.msgId,c,e,b);return{countdownTs:c,millisecondsUntilCountdownTs:e,msgId:a.msgId,threadJid:a.threadJid,ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)}}).filter(Boolean)}}function b(a,b){return{countdownTs:b,msgId:a}}g.createBridgeMsgsStartCountdown=a;g.createBridgeMsgClearCountdown=b}),98);
__d("MAWEphemeralCleaner",["MAWLoggerUtils","MAWMsgCleaner","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCleaner: Adding timestamps for UI(",") and backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startEphemeralCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){var b=a.backendFns;a=a.uiFns;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerStart]).LOG(j());if(k==null){var c;k={backend:new((c=d("MAWMsgCleaner")).MsgCleaner)(b,c.CLEANER_TYPE.EPHEMERAL),ui:new c.MsgCleaner(a,c.CLEANER_TYPE.EPHEMERAL)}}}function b(a,b){if(k==null){var e="Trying to add new ephemeral timestamp before the cleaner is initialized!";d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp]).ERROR(i(),e);throw c("err")(e)}else{e=k;var f=e.backend;e=e.ui;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp]).DEV(h(),a,b);e.update(a);f.update(b)}}function e(){return k}function f(){k=null}g.startEphemeralCleaner=a;g.addNewEphemeralTimestamp=b;g.getEphemeralCleaner_FOR_TESTING_ONLY=e;g.resetEphemeralCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWEphemeralSettingsCache",["MAWBridge","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(a,b){h.set(a,b)}function a(a){var b={ephemeralExpirationInSec:0,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castToUnixTime(0)};return(a=h.get(a))!=null?a:b}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b={ephemeralExpirationInSec:0,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castToUnixTime(0)};if(!h.has(a)){var c=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBEphemeralSetting",{chatJid:a}));i(a,(a=c)!=null?a:b)}});return j.apply(this,arguments)}g.setEphemeralSettingCache=i;g.getEphemeralSettingCache=a;g.requestLSDBCacheForJid=c}),98);
__d("WAArmadilloApplication.pb",["WAArmadilloXMA.pb","WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h,i;a={ES_OPEN:1,ES_CLOSE:2};b={PAYMENT_UNKNOWN:-1,REQUEST_INITED:4,REQUEST_DECLINED:5,REQUEST_TRANSFER_INITED:6,REQUEST_TRANSFER_COMPLETED:7,REQUEST_TRANSFER_FAILED:8,REQUEST_CANCELED:9,REQUEST_EXPIRED:10,TRANSFER_INITED:11,TRANSFER_PENDING:12,TRANSFER_PENDING_RECIPIENT_VERIFICATION:13,TRANSFER_CANCELED:14,TRANSFER_COMPLETED:15,TRANSFER_NO_RECEIVER_CREDENTIAL_NO_RTS_PENDING_CANCELED:16,TRANSFER_NO_RECEIVER_CREDENTIAL_NO_RTS_PENDING_OTHER:17,TRANSFER_REFUNDED:18,TRANSFER_PARTIAL_REFUND:19,TRANSFER_CHARGED_BACK:20,TRANSFER_EXPIRED:21,TRANSFER_DECLINED:22,TRANSFER_UNAVAILABLE:23};c={SCREENSHOT_IMAGE:1,SCREEN_RECORDING:2};e={PLAYED:0,SCREENSHOT:1,FORCE_DISABLE:2};f={VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2};var j={SMALL_LIKE:1,MEDIUM_LIKE:2,LARGE_LIKE:3},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={};k.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,m],metadata:[2,h.TYPES.MESSAGE,l]};l.internalSpec={};m.internalSpec={content:[1,h.TYPES.MESSAGE,D],applicationData:[2,h.TYPES.MESSAGE,r],signal:[3,h.TYPES.MESSAGE,o],subProtocol:[4,h.TYPES.MESSAGE,n],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};n.internalSpec={futureProof:[1,h.TYPES.ENUM,(i=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};o.internalSpec={encryptedBackupsSecrets:[1,h.TYPES.MESSAGE,p],__oneofs__:{signal:["encryptedBackupsSecrets"]}};p.internalSpec={backupId:[1,h.TYPES.UINT64],serverDataId:[2,h.TYPES.UINT64],epoch:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,q],tempOcmfClientState:[4,h.TYPES.BYTES],mailboxRootKey:[5,h.TYPES.BYTES],obliviousValidationToken:[6,h.TYPES.BYTES]};q.internalSpec={id:[1,h.TYPES.UINT64],anonId:[2,h.TYPES.BYTES],rootKey:[3,h.TYPES.BYTES],status:[4,h.TYPES.ENUM,a]};r.internalSpec={metadataSync:[1,h.TYPES.MESSAGE,C],aiBotResponse:[2,h.TYPES.MESSAGE,s],__oneofs__:{applicationData:["metadataSync","aiBotResponse"]}};s.internalSpec={summonToken:[1,h.TYPES.STRING],messageText:[2,h.TYPES.STRING],serializedExtras:[3,h.TYPES.STRING]};t.internalSpec={actionTimestamp:[1,h.TYPES.INT64],chatAction:[101,h.TYPES.MESSAGE,w],messageAction:[102,h.TYPES.MESSAGE,u],__oneofs__:{actionType:["chatAction","messageAction"]}};u.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],messageDelete:[101,h.TYPES.MESSAGE,v],__oneofs__:{action:["messageDelete"]}};v.internalSpec={};w.internalSpec={chatId:[1,h.TYPES.STRING],chatArchive:[101,h.TYPES.MESSAGE,z],chatDelete:[102,h.TYPES.MESSAGE,y],chatRead:[103,h.TYPES.MESSAGE,x],__oneofs__:{action:["chatArchive","chatDelete","chatRead"]}};x.internalSpec={messageRange:[1,h.TYPES.MESSAGE,B],read:[2,h.TYPES.BOOL]};y.internalSpec={messageRange:[1,h.TYPES.MESSAGE,B]};z.internalSpec={messageRange:[1,h.TYPES.MESSAGE,B],archived:[2,h.TYPES.BOOL]};A.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,h.TYPES.INT64]};B.internalSpec={lastMessageTimestamp:[1,h.TYPES.INT64],lastSystemMessageTimestamp:[2,h.TYPES.INT64],messages:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,A]};C.internalSpec={actions:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t]};D.internalSpec={commonSticker:[1,h.TYPES.MESSAGE,M],screenshotAction:[3,h.TYPES.MESSAGE,I],extendedContentMessage:[4,h.TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec],ravenMessage:[5,h.TYPES.MESSAGE,L],ravenActionNotifMessage:[6,h.TYPES.MESSAGE,K],extendedMessageContentWithSear:[7,h.TYPES.MESSAGE,J],imageGalleryMessage:[8,h.TYPES.MESSAGE,H],paymentsTransactionMessage:[10,h.TYPES.MESSAGE,E],bumpExistingMessage:[11,h.TYPES.MESSAGE,G],noteReplyMessage:[13,h.TYPES.MESSAGE,F],ravenMessageMsgr:[14,h.TYPES.MESSAGE,L],__oneofs__:{content:["commonSticker","screenshotAction","extendedContentMessage","ravenMessage","ravenActionNotifMessage","extendedMessageContentWithSear","imageGalleryMessage","paymentsTransactionMessage","bumpExistingMessage","noteReplyMessage","ravenMessageMsgr"]}};E.internalSpec={transactionId:[1,h.TYPES.UINT64],amount:[2,h.TYPES.STRING],currency:[3,h.TYPES.STRING],paymentStatus:[4,h.TYPES.ENUM,b],extendedContentMessage:[5,h.TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec]};F.internalSpec={noteId:[1,h.TYPES.STRING],noteText:[2,h.TYPES.MESSAGE,i.MessageTextSpec],noteTimestampMs:[3,h.TYPES.INT64],textContent:[4,h.TYPES.MESSAGE,i.MessageTextSpec],stickerContent:[5,h.TYPES.MESSAGE,i.SubProtocolSpec],videoContent:[6,h.TYPES.MESSAGE,i.SubProtocolSpec],__oneofs__:{noteReplyContent:["textContent","stickerContent","videoContent"]}};G.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec]};H.internalSpec={images:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,i.SubProtocolSpec]};I.internalSpec={screenshotType:[1,h.TYPES.ENUM,c]};J.internalSpec={searId:[1,h.TYPES.STRING],payload:[2,h.TYPES.BYTES],nativeUrl:[3,h.TYPES.STRING],searAssociatedMessage:[4,h.TYPES.MESSAGE,i.SubProtocolSpec],searSentWithMessageId:[5,h.TYPES.STRING]};K.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],actionTimestamp:[2,h.TYPES.INT64],actionType:[3,h.TYPES.ENUM,e]};L.internalSpec={ephemeralType:[1,h.TYPES.ENUM,f],imageMessage:[2,h.TYPES.MESSAGE,i.SubProtocolSpec],videoMessage:[3,h.TYPES.MESSAGE,i.SubProtocolSpec],__oneofs__:{mediaContent:["imageMessage","videoMessage"]}};M.internalSpec={stickerType:[1,h.TYPES.ENUM,j]};g.ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS=a;g.ARMADILLO_CONTENT_PAYMENTS_TRANSACTION_MESSAGE_PAYMENT_STATUS=b;g.ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE=c;g.ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE=e;g.ARMADILLO_CONTENT_RAVEN_MESSAGE_EPHEMERAL_TYPE=f;g.ARMADILLO_CONTENT_COMMON_STICKER_STICKER_TYPE=j;g.ArmadilloSpec=k;g.Armadillo$MetadataSpec=l;g.Armadillo$PayloadSpec=m;g.Armadillo$SubProtocolPayloadSpec=n;g.Armadillo$SignalSpec=o;g.Armadillo$Signal$EncryptedBackupsSecretsSpec=p;g.Armadillo$Signal$EncryptedBackupsSecrets$EpochSpec=q;g.Armadillo$ApplicationDataSpec=r;g.Armadillo$ApplicationData$AIBotResponseMessageSpec=s;g.Armadillo$ApplicationData$MetadataSyncActionSpec=t;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageActionSpec=u;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageAction$ActionMessageDeleteSpec=v;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatActionSpec=w;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatReadSpec=x;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatDeleteSpec=y;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatArchiveSpec=z;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageSpec=A;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageRangeSpec=B;g.Armadillo$ApplicationData$MetadataSyncNotificationSpec=C;g.Armadillo$ContentSpec=D;g.Armadillo$Content$PaymentsTransactionMessageSpec=E;g.Armadillo$Content$NoteReplyMessageSpec=F;g.Armadillo$Content$BumpExistingMessageSpec=G;g.Armadillo$Content$ImageGalleryMessageSpec=H;g.Armadillo$Content$ScreenshotActionSpec=I;g.Armadillo$Content$ExtendedContentMessageWithSearSpec=J;g.Armadillo$Content$RavenActionNotifMessageSpec=K;g.Armadillo$Content$RavenMessageSpec=L;g.Armadillo$Content$CommonStickerSpec=M}),98);
__d("MAWEphemeralUtil",["MAWAckLevel","MAWBridgeMsgCountdown","MAWExternalId","MAWIndexedDb","MAWLocalizationType","MAWMsgType","WAArmadilloApplication.pb","WAGlobals","WAJids","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["The new ephemeral setting timestamp should be greater than the existing timestamp"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New ephemeral duration should be different from the existing duration"]);i=function(){return a};return a}function a(a,b,c){var e=d("WAGlobals").getMyDeviceJid();e=b.ephemeralExpirationInSec!==a.ephemeralExpirationInSec&&b.ephemeralLastUpdatedOrSetTimestamp===a.ephemeralLastUpdatedOrSetTimestamp&&e<=c;return e||a.ephemeralLastUpdatedOrSetTimestamp>b.ephemeralLastUpdatedOrSetTimestamp}function b(a,b,c){if(a==null)return!0;a=a.ephemeralSetting;if(a!=null&&a.ephemeralExpirationInSec===b){d("WALogger").DEV(i());return!1}if(a!=null&&a.ephemeralLastUpdatedOrSetTimestamp>c){d("WALogger").DEV(h());return!1}return!0}function e(a){a={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES},ts:a,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};return{unstoredDbMedia:null,unstoredDbMsg:a,unstoredDbReaction:null}}function f(a,b){var e;switch(b){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:e=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE;break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:e=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING;break;default:throw c("err")("Received unexpected screenshot action type")}b={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,screenshotActionType:e},ts:a,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return{unstoredDbMedia:null,unstoredDbMsg:b,unstoredDbReaction:void 0}}function j(a){return d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){throw c("err")("Received invalid chatJid. We only support ephemeral messaging in 1:1 threads.")},user:function(a){return a}})}function k(a){a!=null&&a.messageExpirationTs!=null&&a.ephemeralCounterStarted===!0&&d("MAWIndexedDb").afterTransaction({tag:"MsgClearCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgClearCountdown(a.msgId,a.messageExpirationTs)})}g.isLocalSettingOutdated=a;g.shouldUpdateForOutgoingUserEphemeralSettingChange=b;g.buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder=e;g.buildUnstoredDbEphemeralScreenshotActionMsgWithoutContentPlaceholder=f;g.getUserJidForEphemeralSetting=j;g.maybeClearEphemeralMsgCountdown=k}),98);
__d("MAWEphemeralSettingsTxns",["DateConsts","MAWDbThreadTxns","MAWDexieTable","MAWEphemeralSettingsCache","MAWEphemeralUtil","MAWIndexedDb","MAWLoggerUtils","WAGlobals","WAJids","WALogger","WAResultOrError","WATagsLogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo reset for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo no op for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Contact "," "," and ephemeral setting "," should not be null when receiving the server ack for outgoing ephemeral setting change"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAndWriteIncomingEphemeralSetting - ephemeral setting in sync"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAndWriteIncomingEphemeralSetting - Sending Sync Response with duration ",", timestamp ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received invalid chat jid for incoming ephemeral settings"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAndWriteIncomingEphemeralSetting - Handle Incoming Ephemeral Setting duration: ",", lastUpdated: ",""]);o=function(){return a};return a}var p=d("WATagsLogger").TAGS([(h=d("MAWLoggerUtils")).Tag.Ephemeral,h.Tag.SettingChange,h.Tag.Incoming]),q=d("WATagsLogger").TAGS([h.Tag.Ephemeral,h.Tag.SettingChange,h.Tag.Outgoing]),r=null,s=90*d("DateConsts").SEC_PER_DAY;function a(a,b,e,f,g,h,i,j,k,q){if(f<0||f>s){j=d("WAJids").interpretAndValidateJid(i.jid).toString();throw c("err")("EphemeralSetting duration is invalid "+f+", jidType: "+j)}k={ephemeralExpirationInSec:f,ephemeralLastUpdatedOrSetTimestamp:g};d("WALogger").LOG(o(),f,g);j=d("WAJids").interpretAsUserJid(i.jid);if(j==null){p.ERROR(n());return d("MAWDexieTable").dexieResolve(r)}f=d("WAJids").isAuthorMe(b)?d("WAGlobals").getMyUserJid():b;b=e!=null?d("WAJids").toDeviceJid(f,e.id):null;e=d("MAWEphemeralSettingsCache").getEphemeralSettingCache(i.jid);var t=e==null?void 0:e.ephemeralExpirationInSec,u=e==null?void 0:e.ephemeralLastUpdatedOrSetTimestamp;if(q){if(e!=null&&b!=null&&!d("MAWEphemeralUtil").isLocalSettingOutdated(k,e,b))if(g!==u){d("WALogger").LOG(m(),t,u);return d("MAWDexieTable").dexieResolve({dbMsg:null,outOfSyncEphemeralSetting:{chatJid:i.jid,correctEphemeralExpirationInSec:e.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:e.ephemeralLastUpdatedOrSetTimestamp}})}else{d("WALogger").WARN(l());return d("MAWDexieTable").dexieResolve(r)}d("MAWIndexedDb").afterTransaction({tag:"EphemeralSettingsUpdatedForUI",value:{author:d("WAJids").userIdFromJid(f),chatJid:i.jid,ephemeralSettingArgs:k,isEphemeralSettingReset:h}});return d("MAWDexieTable").dexieResolve(r)}q={ephemeralSetting:k,ephemeralSyncResponseBackoffInfo:void 0,userJid:j};return a.ephemeralSettings.put(q).then(function(){return r})}function b(a,b,e,f,g){var h=e;if(h<0)throw c("err")("Ephemeral duration should be 0 or more");var i=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return d("MAWDbThreadTxns").getThread(a,b).then(function(b){return!b.success?{success:!1}:a.ephemeralSettings.get({userJid:i}).then(function(b){if(!d("MAWEphemeralUtil").shouldUpdateForOutgoingUserEphemeralSettingChange(b,h,f))return{success:!1};b=b==null?{ephemeralSetting:{ephemeralExpirationInSec:h,ephemeralLastUpdatedOrSetTimestamp:f},userJid:i}:babelHelpers["extends"]({},b,{ephemeralSetting:{ephemeralExpirationInSec:h,ephemeralLastUpdatedOrSetTimestamp:f}});return a.ephemeralSettings.put(b).then(function(){return{success:!0}})})})}function e(a,b,e){var f=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return a.ephemeralSettings.get({userJid:f}).then(function(b){if(b==null||b.ephemeralSetting==null){q.ERROR(k(),f,b,b==null?void 0:b.ephemeralSetting);throw c("err")("Contact and ephemeral setting should not be null when receiving the server ack for outgoing ephemeral setting change")}b=babelHelpers["extends"]({},b,{ephemeralSetting:{ephemeralExpirationInSec:b.ephemeralSetting.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e}});return a.ephemeralSettings.put(b).then(function(){})})}function f(a,b){a=d("WAJids").interpretAsUserJid(b);if(a==null)throw c("err")("Unexpected chatJid input to isEphemeralMessagesEnabledForContact");a=d("MAWEphemeralSettingsCache").getEphemeralSettingCache(b);if(a.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").castToUnixTime(0))return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("no_ephemeral_setting"));return a!=null&&a.ephemeralExpirationInSec>0?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({outOfSyncEphemeralSetting:{chatJid:b,correctEphemeralExpirationInSec:a.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:a.ephemeralLastUpdatedOrSetTimestamp}})):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("no_ephemeral_setting"))}function t(a,b){return a.ephemeralSettings.get({userJid:b}).then(function(c){if((c==null?void 0:c.ephemeralSyncResponseBackoffInfo)==null){p.LOG(j(),b);return d("WAResultOrError").makeResult()}c.ephemeralSyncResponseBackoffInfo=void 0;p.LOG(i(),b);return a.ephemeralSettings.put(c).then(function(){return d("WAResultOrError").makeResult()})})}g.handleAndWriteIncomingEphemeralSetting=a;g.handleAndWriteOutgoingUserEphemeralSettingChange=b;g.updateContactWhenEphemeralSettingChangeMarkedSent=e;g.getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg=f;g.maybeResetEphemeralSyncResponseBackoffInfo=t}),98);
__d("MAWDbGroupInfoTxns",["MAWBridgeTypesCreators","MAWIndexedDb","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b.jid).then(function(c){var d=b.participantVersion;c.success&&c.value.participantVersion!=null&&b.participantVersion==null&&(d=c.value.participantVersion);c=b.subject.content;c!=null&&c.length===0&&(c=void 0);var e={creationTs:b.creationTs,creator:b.creator,groupJid:b.jid,inviter:b.inviter,memberAddMode:b.memberAddMode,name:c,nameOwner:b.subject.user,nameTs:b.subject.ts,participantVersion:d};return i(a,e).then(function(){return e})})}function h(a,b){return a.groupInfo.get({groupJid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function i(a,b){return a.groupInfo.put(b).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(b)})})}function b(a,b){return a.groupInfo.bulkPut(b).then(function(){b.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}function c(a,b){return a.groupInfo.bulkGet(b)}function e(a,b){return a.groupInfo["delete"](b)}g.putGroupInfo=a;g.getGroupInfo=h;g.updateGroupInfo=i;g.bulkUpdateGroupInfo=b;g.getGroupInfos=c;g.deleteGroupInfo=e}),98);
__d("WAProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.externalId===b.externalId&&a.author===b.author&&a.chat===b.chat}f.equals=a}),66);
__d("MAWThreadSnippetBuildTxns",["$InternalEnum","FBLogger","I64","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbGroupInfoTxns","MAWDbMsg","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","WAGlobals","WAJids","WALongInt","WAProtocolMsgId","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("$InternalEnum").Mirrored(["DO_NOT_BUMP_THREAD","MATCH_BUMP_TIMESTAMPMS_TO_SNIPPET"]);function j(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWDbGroupInfoTxns").getGroupInfo(a,d("WAJids").toGroupJid(b.threadJid))]).then(function(a){a=a[0];a=a.success;return d("MAWThreadSnippet").buildThreadSnippet(b,a,c)})}function a(a,b,c,e){return d("MAWDexieTable").dexieAll([d("MAWDbGroupInfoTxns").getGroupInfo(a,d("WAJids").toGroupJid(e))]).then(function(a){a=a[0];a=a.success;return k(b,c,a)})}function k(a,b,e){var f;d("WAJids").isAuthorMe(a)?(c("FBLogger")("maw_db").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),f=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())):f=d("WAJids").userIdFromJid(a);a={contactIDs:[],strings:[]};e=e?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;a.contactIDs.push(f);a.strings.push(b);return{snippetParams:a,snippetSenderContactId:f,snippetType:e}}function e(a,b,c,e){var f=c.newestReaction,g=c.reactionsToClear;if(f!=null&&d("WATimeUtils").castUnixTimeToMillisTime(f.ts)>((c=b.snippetMsgTs)!=null?c:0))return d("MAWDexieTable").dexieResolve({newestReaction:f,reactionsToClear:[],thread:l(b,f,e)});return g!=null&&b.snippetMsg!=null?a.reactions.get({reactionId:b.snippetMsg}).then(function(c){var e=!1;if(c==null)e=!0;else{var f=d("MAWJidUtils").maybeToProtocolMsgId(c.author,c.threadJid,c.reactToExternalId);f!=null&&(e=g.some(function(a){a=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.reactToExternalId);return a!=null&&d("WAProtocolMsgId").equals(a,f)}))}return e?m(a,b,i.MATCH_BUMP_TIMESTAMPMS_TO_SNIPPET).then(function(a){return{newestReaction:null,reactionsToClear:g,thread:a}}):d("MAWDexieTable").dexieResolve({newestReaction:null,reactionsToClear:[],thread:b})}):d("MAWDexieTable").dexieResolve({newestReaction:null,reactionsToClear:[],thread:b})}function l(a,b,c){var e=d("WATimeUtils").castUnixTimeToMillisTime(b.ts);c=k(b.author,b.reaction,c);var f=c.snippetParams,g=c.snippetSenderContactId;c=c.snippetType;var i=b.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(b.externalId):void 0;e=b.senderTimestampMs!=null?(h||(h=d("I64"))).of_string(d("WALongInt").longIntToDecimalString(b.senderTimestampMs)):d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(e,i);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:e,description:"newReaction",isMessageAuthorMe:!1,snippetParams:f,snippetSenderContactId:g,snippetType:c,threadJid:a.jid})});return babelHelpers["extends"]({},a,{snippetMsg:b.reactionId,snippetMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts)})}function m(a,b,c,e){return d("MAWThreadSnippetUtils").findMostRecentSnippetMsgFromThread(a,b).then(function(f){if(f==null){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:"0",snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET,threadJid:b.jid})});return babelHelpers["extends"]({},b,{snippetMsg:void 0,snippetMsgTs:void 0})}var g=e==null?void 0:e.get(f.externalId);return j(a,f,g).then(function(a){var e=a.snippetParams,g=a.snippetSenderContactId;a=a.snippetType;var j=d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(f));switch(c){case i.DO_NOT_BUMP_THREAD:d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:e,snippetSenderContactId:g,snippetType:a,threadJid:b.jid})});break;case i.MATCH_BUMP_TIMESTAMPMS_TO_SNIPPET:var k=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(j,(h||(h=d("I64"))).of_string_opt(f==null?void 0:f.externalId));d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:k,description:"getRefreshThreadSnippetChangeset",isMessageAuthorMe:f.author==="@me",skipBumpTimestampValidation:!0,skipServerThreadBump:!0,snippetParams:e,snippetSenderContactId:g,snippetType:a,threadJid:b.jid})})}return babelHelpers["extends"]({},b,{snippetMsg:f.msgId,snippetMsgTs:j})})})}function f(a,b,c){return m(a,b,i.DO_NOT_BUMP_THREAD,c).then(function(b){return a.threads.put(b).then(function(){})})}g.buildThreadSnippet=j;g.buildReactionThreadSnippet=a;g.getReactionSnippetParams=k;g.getThreadChangesetForReactionChanges=e;g.getThreadChangesetForNewReaction=l;g.refreshThreadSnippet=f}),98);
__d("MAWEphemeralMsgTxns",["MAWBridgeMsgCountdown","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDbXMATxns","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralConsts","MAWEphemeralMsgUtils","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWLocalizationType","MAWLoggerUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","WAJids","WATagsLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is not out of sync"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is out of sync: correct duration ",", correct timestamp ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is ephemeral: duration ",", timestamp ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is non-ephemeral"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateEphemeralSettingOrCheckOutOfSyncAfterWritingIncomingMsg: Message from ",", chat ",", type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["updating ephemeral timestamp msg ",", existing expiration ",", existing deletion ",", updated expiration ",", updated deletion ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["markEphemeralMessageAsSent EphemeralCounter: Showing UI counter for ",""]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS([(e=d("MAWLoggerUtils")).Tag.Ephemeral,e.Tag.SettingSync,e.Tag.Incoming]),p=d("WATagsLogger").TAGS([e.Tag.Ephemeral,e.Tag.OnRead,e.Tag.Countdown]);function q(a,b,c){c===void 0&&(c=function(){return!0});return d("MAWDbMsgTxns").getThreadMessagesBySortOrder(a,b,!1,!0).filter(c).limit(1).toArray().then(function(a){return{needsUpdate:!0,value:(a=a[0])!=null?a:null}})}function r(a,b,c){return c.size===0?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var e=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadOldestMessageId(a,e.jid),d("MAWDbMsgTxns").getThreadNewestMessageId(a,e)]).then(function(b){var f=b[0],g=b[1];if(f==null||g==null)return;b=d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c);var h=c.has(f)?q(a,e.jid,b):d("MAWDexieTable").dexieResolve({needsUpdate:!1});b=c.has(g)?d("MAWDbMsgTxns").getThreadMessagesBySortOrder(a,e.jid,!0,!1).filter(b).reverse().limit(1).toArray().then(function(b){b=b[0];return b!=null&&d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(b)?d("MAWThreadSnippetUtils").findMostRecentSnippetMsgFromThread(a,e,c).then(function(a){return{needsUpdate:!0,value:(a=a)!=null?a:null}}):{needsUpdate:!0,value:(b=b)!=null?b:null}}):d("MAWDexieTable").dexieResolve({needsUpdate:!1});return d("MAWDexieTable").dexieAll([h,b]).then(function(b){var c=b[0],h=b[1];if(!c.needsUpdate&&!h.needsUpdate)return;b=h.needsUpdate?(b=(b=h.value)==null?void 0:b.msgId)!=null?b:void 0:g;var i=h.needsUpdate?h.value!=null?d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(h.value)):void 0:e.snippetMsgTs,j=babelHelpers["extends"]({},e,{newestMsg:b,oldestMsg:c.needsUpdate?(c=(c=c.value)==null?void 0:c.msgId)!=null?c:null:f,snippetMsg:b,snippetMsgTs:i});return a.threads.put(j).then(function(){if(h.needsUpdate){var b=h.value;if(b==null)d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:"0",snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET,threadJid:j.jid})});else return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:j.jid})})})}})})})})}function a(a,b){if(b==null||b.ephemeralSetting==null||b.ephemeralSetting.ephemeralExpirationInSec===0)return d("MAWDexieTable").dexieResolve(b);var c=d("WATimeUtils").castToUnixTime(b.ts+b.ephemeralSetting.ephemeralExpirationInSec),e=d("WATimeUtils").castToUnixTime(c+d("MAWEphemeralConsts").ephemeralReportingWindowInSeconds);return s(a,[{messageDeleteTs:e,messageExpirationTs:c,msgId:b.msgId,readTsForLogging:b.ts}]).then(function(a){var b=a[0],c=a[1];a=a[2];a.length>0&&(p.LOG(n(),a.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a)}));b!=null&&c!=null&&d("MAWEphemeralCleaner").addNewEphemeralTimestamp(b,c);return a[0]})}function s(a,b){var c=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,c).then(function(d){var e=new Map();b.forEach(function(a){e.set(a.msgId,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs,readTsForLogging:a.readTsForLogging});var b=d.get(a.msgId);b!=null&&e.set(b,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs,readTsForLogging:a.readTsForLogging})});var f=null,g=null,h=[],i=Array.from(new Set(c.concat(Array.from(d.values()))));return a.messages.where("msgId").anyOf(i).toArray().then(function(b){if(b.length===0)return;b.forEach(function(a){var b=a.messageExpirationTs,c=a.messageDeleteTs,d=e.get(a.msgId),i=d==null?void 0:d.messageExpirationTs;d=d==null?void 0:d.messageDeleteTs;p.LOG(m(),a.msgId,b,c,i,d);if(i==null||d==null)return;if(a.ephemeralCounterStarted===!0)return;f==null?f=i:i<f&&(f=i);g==null?g=d:d<g&&(g=d);b=babelHelpers["extends"]({},a,{ephemeralCounterStarted:!0,messageDeleteTs:d,messageExpirationTs:i});h.push(b)});return a.messages.bulkPut(h)}).then(function(){return[f,g,h]})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();var c=[];b.forEach(function(b,d){c.push(r(a,d,b))});return d("MAWDexieTable").dexieAll(c).then(function(){})}function c(a,b,c,e,f,g){if(b==null||f==null)return d("MAWDexieTable").dexieResolve();o.LOG(l(),c,e.jid,b.type);var m=d("MAWDexieTable").dexieResolve();if(b.ephemeralSetting==null)d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(){return d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,c).then(function(){})},user:function(){d("MAWDbMsg").isMsgEligibleForTriggeringEphemeralSyncResponse(b)&&(o.LOG(k()),m=d("MAWEphemeralSettingsTxns").getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg(a,e.jid).then(function(a){return a==null?void 0:(a=a.value)==null?void 0:a.outOfSyncEphemeralSetting}))}});else if(b.messageExpirationTs!=null&&b.messageDeleteTs!=null){var n=b.ephemeralSetting,p=b.messageDeleteTs,q=b.messageExpirationTs;o.LOG(j(),n.ephemeralExpirationInSec,n.ephemeralLastUpdatedOrSetTimestamp);d("MAWEphemeralCleaner").addNewEphemeralTimestamp(q,p);m=d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,c,f,n.ephemeralExpirationInSec,n.ephemeralLastUpdatedOrSetTimestamp,!1,e,g,null,!0).then(function(a){return a==null?void 0:a.outOfSyncEphemeralSetting})}return m.then(function(b){if(b!=null){o.LOG(i(),b.correctEphemeralExpirationInSec,b.correctEphemeralLastUpdatedOrSetTimestamp);return b}else{o.LOG(h());return d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,c).then(function(){})}})}g.markEphemeralMessageAsSent=a;g.bulkUpdateEphemeralMessageTimestamps=s;g.updateThreadsOnMessagesExpiredFromUi=b;g.syncEphemeralSettingOnIncomingMsg=c}),98);
__d("isE2EEConversationSearchEnabled",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return(a=c("qex")._("518"))!=null?a:!1}g["default"]=a}),98);
__d("isE2EEUniversalSearchEnabled",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return(a=c("qex")._("772"))!=null?a:!1}g["default"]=a}),98);
__d("isWAFTSContentSearchEnabled",["isE2EEConversationSearchEnabled","isE2EEUniversalSearchEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("isE2EEConversationSearchEnabled")()||c("isE2EEUniversalSearchEnabled")()}g["default"]=a}),98);
__d("MAWFTSTxns",["MAWDexieTable","isWAFTSContentSearchEnabled","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("justknobx")._("1146");function a(a,b){return!c("isWAFTSContentSearchEnabled")()?d("MAWDexieTable").dexieResolve(null):a.ftsPurgeBacklog.put({externalId:b})}function b(a,b){return!c("isWAFTSContentSearchEnabled")()||!h?d("MAWDexieTable").dexieResolve(null):a.ftsBackloggedMessages.put({rowId:b})}function e(a,b){return!c("isWAFTSContentSearchEnabled")()?d("MAWDexieTable").dexieResolve(null):a.ftsPurgeThreadBacklog.put({chatJid:b})}g.maybePutMessageToPurgeBacklog=a;g.maybePutMessageToBacklog=b;g.maybePutThreadToPurgeBacklog=e}),98);
__d("MAWGetMsgQuoteTxn",["MAWDbMsgTxns","MAWDexieTable","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){return a==null||a===d("WAJids").AUTHOR_SYSTEM?null:d("WAJids").authorAsUserJid(a)};function i(a,b,c){var e=b.quote;b=(e==null?void 0:e.content)||{};var f=b.author;b=b.externalId;if(f==null)return d("MAWDexieTable").dexieResolve(null);f=d("WAJids").isAuthorMe(f)?d("WAJids").AUTHOR_ME:h(f);if(e==null||f==null||b==null)return d("MAWDexieTable").dexieResolve(null);f={author:f,chat:c,externalId:b};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f).then(function(b){if(b==null||!d("MAWMsgType").isQuotedMsgType(b.type))return{quote:e,quoteExternalId:e.content.externalId};var a=b.author,c=b.externalId,f=b.mediaId,g=b.msgContent,h=b.msgId,i=b.plaintextHash,j=b.specialTextSize,k=b.ts,l=b.type,m=b.xmaMessageType;a={author:a,externalId:c,mediaId:f,msgContent:g,msgId:h,plaintextHash:i,specialTextSize:j,ts:k,type:l,xmaMessageType:m};b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(a=babelHelpers["extends"]({},a,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL}));return{quote:babelHelpers["extends"]({},e,{content:a}),quoteExternalId:b.externalId}})}function a(a,b,c){return i(a,b,c).then(function(a){return babelHelpers["extends"]({},b,{quote:a==null?void 0:a.quote,quoteExternalId:a==null?void 0:a.quoteExternalId})})}g.getMsgQuoteInfo=i;g.enhanceMsgWithQuoteInfo=a}),98);
__d("MAWUpdateQuotedMsgTxns",["MAWAuthor","MAWBridgeMsg","MAWDexieTable","MAWIndexedDb","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,e,f,g,h){var i=d("MAWAuthor").getAuthorUserJid(e);return a.messages.where("quoteExternalId").equals(c).toArray().then(function(c){if(c.length===0)return;var e=c;(h==null||!h)&&(e=c.filter(function(a){var c=a.quote;a=a.threadJid;return d("MAWAuthor").getAuthorUserJid(c==null?void 0:c.content.author)===i&&a===b}));var j=e.map(function(a){var b;b=Object.assign({},(b=a.quote)==null?void 0:b.content,f.content);b=babelHelpers["extends"]({},a.quote,f,{content:b});b.content.msgId==null&&g!=null&&(b.content.msgId=g);return babelHelpers["extends"]({},a,{quote:b})});return a.messages.bulkPut(j).then(function(){return j})})},i=function(a,b,c,e,f){f===void 0&&(f=d("MAWMsgType").MSG_TYPE.UNAVAILABLE);f={content:{mediaId:void 0,msgContent:void 0,type:f}};return h(a,b,c,e,f).then(function(a){if(a==null)return;a.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})};a=function(a,b,c){c===void 0&&(c=d("MAWMsgType").MSG_TYPE.UNAVAILABLE);var e=b.author,f=b.chat,g=b.externalId;return a.threads.get({jid:f}).then(function(b){if(b==null)return;return i(a,b.jid,g,e,c)})};b=function(a,b,c,e){var f=c.author,g=c.externalId,i=c.mediaId,j=c.msgContent,k=c.msgId,l=c.plaintextHash,m=c.ts;c=c.type;if(!d("MAWMsgType").isQuotedMsgType(c))return d("MAWDexieTable").dexieResolve();i={author:f,externalId:g,mediaId:i,msgContent:j,plaintextHash:l,ts:m,type:c};return h(a,b,g,f,{content:i},k,e)};g.disassociateQuotedMsg=i;g.disassociateQuotedMessageByProtocolMsgId=a;g.associateQuotedMessage=b}),98);
__d("MAWBridgeParticipants",["WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.deliveredWatermarkTs,c=a.lastReadActionTs,e=a.lastReadWatermarkTs,f=a.threadJid,g=a.type;a=a.userJid;return{deliveredWatermarkTs:b||d("WATimeUtils").castToUnixTime(0),fbid:d("WAJids").extractUserId(a),isAdmin:g==="superadmin"||g==="admin",isInvited:g==="invitedParticipant",isSuperAdmin:g==="superadmin",lastReadActionTs:(b=c)!=null?b:d("WATimeUtils").castToUnixTime(0),readWatermarkTs:e||d("WATimeUtils").castToUnixTime(0),threadJid:f}}function a(a){return{participants:a.map(function(a){return h(a)})}}g.createBridgeParticipant=h;g.createBridgeParticipants=a}),98);
__d("MAWDbParticipantTxns",["FBLogger","MAWBridgeParticipants","MAWBridgeTypesCreators","MAWCurrentUser","MAWDbParticipant","MAWDexieTable","MAWIndexedDb","MAWODSProxy","WAGlobals","WAJids","WAOdsEnums","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e){d===void 0&&(d="participant");return h(a,b,[{addressable:e,type:d,userJid:c}]).then(function(a){return a[0]})}function h(a,b,c){return j(a,c.map(function(a){return babelHelpers["extends"]({},a,{threadJid:b})}))}function i(a,b){d("WAJids").switchOnMsgrChatJidType(a.threadJid,{group:function(){},user:function(e){a.userJid!==e&&a.userJid!==d("WAGlobals").getMyUserJid()&&c("FBLogger")("messenger_e2ee_web").mustfix("Attempting to insert participant to a mismatched one-on-one thread at %s",b)}})}function j(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var c=[];b.forEach(function(a){var b=a.addressable,e=a.threadJid,f=a.type;a=a.userJid;c.push({addressable:b,deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),id:d("MAWDbParticipant").craftParticipantId(e,a),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0),threadJid:e,type:f,userJid:a})});c.forEach(function(a){return i(a,"bulkAddParticipantsInThreads")});return a.participants.bulkPut(c).then(function(){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(c)});return c})}function b(a,b,c){return p(a,b).then(function(e){var f=[],g=new Set(c.map(function(a){return a.userJid}));for(var i=e,j=Array.isArray(i),k=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(j){if(k>=i.length)break;m=i[k++]}else{k=i.next();if(k.done)break;m=k.value}m=m;var n=g.has(m.userJid);n||f.push([m.threadJid,m.userJid])}n=[];m=new Set(e.map(function(a){return a.userJid}));for(k=0;k<c.length;k++){j=c[k];i=m.has(j.userJid);i||n.push(j)}f.length>0&&d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_ONE_TO_ONE_THREAD_PARTICIPANT_CLEANUP,key:d("MAWCurrentUser").isEmployee()?"employee":"public"});return d("MAWDexieTable").dexieAll([h(a,b,n),l(a,f)]).then(function(a){var b=a[0];a[1];a=c.reduce(function(a,c){var d=b.find(function(a){return a.userJid===c.userJid}),f=e.find(function(a){return a.userJid===c.userJid});d!=null&&f==null?a.push(d):f!=null&&a.push(f);return a},[]);return a})})}function e(a,b){b.forEach(function(a){return i(a,"bulkUpdateParticipants")});return a.participants.bulkPut(b).then(function(){b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(b)});return b})}function f(a,b,c){if(c.length===0)return d("MAWDexieTable").dexieResolve();c=c.map(function(a){return[b,a]});return l(a,c)}function k(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.map(function(a){return[a,c]});return l(a,b)}function l(a,b){return a.participants.where(["threadJid","userJid"]).anyOf(b).toArray().then(function(b){return a.participants.bulkDelete(b.map(function(a){return a.id})).then(function(){return a.threads.where("jid").anyOf(Array.from(new Set(b.map(function(a){return a.threadJid})))).toArray()}).then(function(a){var c=new Map(a.map(function(a){return[a.jid,a.chatId]}));b.forEach(function(a){var b=c.get(a.threadJid);b!=null&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantRemoved",value:{threadJid:a.threadJid,userId:d("WAJids").extractUserId(a.userJid)}})})})})}function m(a,b){return a.participants.where("threadJid").equals(b)["delete"]()}function n(a,b,c,d,e){return o(a,[{deliveredWatermarkTs:c,lastReadActionTs:e,lastReadWatermarkTs:d,participantKey:b}]).then(function(a){return a[0]})}function o(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var c=new Map(),e=[];b.forEach(function(a){e.push(a.participantKey),c.set(JSON.stringify(a.participantKey),a)});return a.participants.where(["threadJid","userJid"]).anyOf(e).toArray().then(function(b){var e=[],f=[];b.forEach(function(a){var b=c.get(JSON.stringify([a.threadJid,a.userJid]));if(b==null)return;var d=b.deliveredWatermarkTs,g=b.lastReadActionTs;b=b.lastReadWatermarkTs;var h=a.deliveredWatermarkTs,i=a.lastReadWatermarkTs,j=a.lastReadActionTs,k=d>h,l=b>i,m=j==null||g>j;if(!k&&!l&&!m){f.push(a);return}e.push(babelHelpers["extends"]({},a,{deliveredWatermarkTs:k?d:h,lastReadActionTs:m?g:j,lastReadWatermarkTs:l?b:i}))});e.forEach(function(a){return i(a,"bulkUpdateParticipantTimestamps")});return a.participants.bulkPut(e).then(function(){e.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ReceivedReceipt",value:d("MAWBridgeTypesCreators").createBridgeReceivedReceipt(a.threadJid,d("WAJids").extractUserId(a.userJid),a.deliveredWatermarkTs,a.lastReadWatermarkTs,a.lastReadActionTs)})});return[].concat(e,f)})})}function p(a,b){return a.participants.where("threadJid").equals(b).toArray()}function q(a,b){return a.participants.where("threadJid").anyOf(b).toArray()}function r(a,b){return p(a,b).then(function(a){return a.filter(function(a){return a.type==="invitedParticipant"})})}function s(a,b,c){return a.participants.where(["threadJid","userJid"]).equals([b,c]).first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function t(a,b){return a.participants.where(["threadJid","userJid"]).anyOf(b).toArray().then(function(a){var c=new Map(a.map(function(a){return[JSON.stringify([a.threadJid,a.userJid]),a]}));return b.map(function(a){return c.get(JSON.stringify(a))})})}g.addParticipant=a;g.bulkAddParticipants=h;g.logIfIllegalParticipant=i;g.bulkAddParticipantsInThreads=j;g.bulkUpsertParticiantsInThread=b;g.bulkUpdateParticipants=e;g.bulkDeleteParticipantsInThread=f;g.bulkDeleteParticipantAcrossThreads=k;g.bulkDeleteParticipants=l;g.deleteAllParticipantsForThread=m;g.updateParticipantTimestamps=n;g.bulkUpdateParticipantTimestamps=o;g.getParticipantsInThread=p;g.getParticipantsInThreads=q;g.getInvitedParticipantsInThread=r;g.getParticipant=s;g.bulkGetParticipants=t}),98);
__d("MAWWriteMsgSideEffectTxns",["MAWDbMsg","MAWDbParticipantTxns","MAWDexieTable"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=d("MAWDbMsg").getCanonicalTsFromMsg(b),e=b.author;return e!=="@me"&&e!=="@system"?d("MAWDbParticipantTxns").updateParticipantTimestamps(a,[b.threadJid,e],c,c,c):d("MAWDexieTable").dexieResolve()}g.updateParticipantTimestampsForMsg=a}),98);
__d("MAWWriteDeleteMessageTxns",["MAWAckLevel","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanza","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbXMATxns","MAWDeleteForMeMsgContentCleaner","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWMsgType","MAWPendingStanzaCleaner","MAWThreadSnippetBuildTxns","MAWUpdateQuotedMsgTxns","MAWUploadMessagesBackup","MAWXMAUtils","WAResultOrError","WATimeUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS,i=30*d("WATimeUtils").DAY_SECONDS;function a(a,b){var c=b.protocolMsgId,e=c.author;b=c.chat;var f=c.externalId;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b),a.unrenderedMessages.get({externalId:f}),d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,f)]).then(function(b){var g=b[0];b=b[1];if(!g.success)return d("WAResultOrError").makeError("missing_thread");return b!=null&&b.threadJid===g.value.jid&&b.author===e?d("WAResultOrError").makeError("duplicate_delete_for_me"):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c).then(function(b){if(b==null){var h={ack:d("MAWAckLevel").ACK.received,author:e,externalId:f,threadJid:g.value.jid,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME},k=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+i);h={deleteTs:k,externalIdWithType:f+"_"+d("MAWDbPendingStanza").PENDING_DELETE_FOR_ME,pendingContent:{content:h,type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME}};return a.pendingStanzas.add(h).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(k);return d("WAResultOrError").makeResult()})}return d("MAWDexieTable").dexieResolve(j(a,b,e,c.chat,g.value)).then(function(){return d("WAResultOrError").makeResult()})})})}function j(a,b,e,f,g){var i,j=d("MAWDexieTable").dexieResolve();d("MAWXMAUtils").isXMAStoryReply((i=b.quote)==null?void 0:i.content.xmaMessageType)&&(j=k(a,b));var l={ack:b.ack,author:e,externalId:b.externalId,mediaId:b.mediaId,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h),msgContent:(i=d("MAWDbMsg").getMsgContent(b))==null?void 0:i.content,msgId:b.msgId,quote:b.quote,reportingMeta:b.reportingMeta,serverTs:c("justknobx")._("1753")?void 0:b.serverTs,threadJid:f,ts:b.ts,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME,xmaMessageType:b.xmaMessageType};i=d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId),j]).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,[b])});c("gkx")("23914")&&c("justknobx")._("1071")&&d("MAWUploadMessagesBackup").sendDeleteEchoMessage(b,g.jid);if(d("MAWDbMsg").isMediaMsg(b)){var e=b.mediaId,f=b.plaintextHash;e!=null&&(c("gkx")("2419")&&f!=null?d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:e,msgId:b.msgId,plaintextHash:f,threadJid:b.threadJid}}):d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:e,msgId:b.msgId,threadJid:b.threadJid}}))}return d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,g)});return d("MAWDexieTable").dexieAll([i,a.unrenderedMessages.add(l),d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:e,chatJid:b.threadJid,externalId:b.externalId}]),d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,b.threadJid,b.externalId,b.author,d("MAWMsgType").MSG_TYPE.REVOKED)]).then(function(){return d("MAWDbMsgTxns").maybeUpdateThreadMsgsForDeleteForMe(a,g.jid,b.msgId,b.sortOrderMs).then(function(){d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(l.messageDeleteForMeTs);return d("WAResultOrError").makeResult()})})}function k(a,b){return d("MAWDbXMATxns").maybeGetXMAFromAssociatedMsgId(a,b.msgId).then(function(b){return d("MAWDbMsgTxns").maybeGetMsg(a,b==null?void 0:b.msgId).then(function(b){if(b!=null)return d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId)})})}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.handleDeleteForMe=a;g.deleteXMAStoryReplyMsg=k}),98);
__d("MAWDbDeletedMessages",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({ChatDelete:"chat_delete",Revoke:"revoke"});f.DbDeletedMsgReasonEnum=a}),66);
__d("MAWUnsendMsgContentCleaner",["MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["UnsendMsgContentCleaner: Adding timestamps (",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startUnsendMsgContentCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.UNSEND))}function b(a){if(k==null){var b="Trying to add new UnsendMsgContentCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startUnsendMsgContentCleaner=a;g.addNewUnsendMsgContentCleanerTimestamp=b;g.getUnsendMsgContentCleaner_FOR_TESTING_ONLY=e;g.resetUnsendMsgContentCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWWriteRevokeMessageTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbDeletedMessages","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanza","MAWDbReactionsTxns","MAWDexieTable","MAWEphemeralUtil","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWMsgType","MAWPendingStanzaCleaner","MAWThreadSnippetBuildTxns","MAWUnsendMsgContentCleaner","MAWUpdateQuotedMsgTxns","MAWUploadMessagesBackup","MAWWriteDeleteMessageTxns","MAWXMAUtils","WATimeUtils","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS,i=30*d("WATimeUtils").DAY_SECONDS;function a(a,b,e,f,g){var h=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+i),k=b.author,m=b.externalId,n=b.revokedExternalId,o=g!=null?l(a,g):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([f==null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.revokedExternalId,e.jid,b.author):d("MAWDexieTable").dexieResolve(f),d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,m)]).then(function(g){var i=g[0];(f==null||i!=null)&&c("FBLogger")("messenger_e2ee_web").warn("Revoked message missing originalMsg incorrectly");if(i==null){g={deleteTs:h,externalIdWithType:n+"_"+d("MAWDbPendingStanza").PENDING_REVOKED,pendingContent:{content:{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:k,externalId:m,revokedExternalId:n,threadJid:e.jid,ts:b.ts,type:"Revoked"},type:d("MAWDbPendingStanza").PENDING_TYPE.REVOKED}};return d("MAWDexieTable").dexieAll([a.pendingStanzas.add(g),o]).then(function(b){b[0];b=b[1];d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(h);b===!0&&d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,e)})}return o.then(function(){return j(a,i,e,b.externalId,b.revokedExternalId,b.serverTs,b.ts,!1)})})}function j(a,b,c,e,f,g,i,j){var l=babelHelpers["extends"]({},b,{altIndex:void 0,externalId:e,msgContent:d("MAWDbMsg").getMsgContent(b),originalTs:(e=b.serverTs)!=null?e:b.ts,revokedExternalId:f,serverTs:g,threadJid:c.jid,ts:i,type:"Revoked",unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h)});if(j){d("MAWUploadMessagesBackup").sendDeleteEchoMessage(b,c.jid);return d("MAWDexieTable").dexieResolve(l)}return k(a,b,l,c).then(function(){return l})}function k(a,b,e,f,g){var h;g===void 0&&(g=!1);h=d("MAWXMAUtils").isXMAStoryReply((h=b.quote)==null?void 0:h.content.xmaMessageType)?d("MAWWriteDeleteMessageTxns").deleteXMAStoryReplyMsg(a,b):d("MAWDexieTable").dexieResolve();var i=d("MAWJidUtils").toProtocolMsgId(b);i=i!=null?a.deletedMessages.add(babelHelpers["extends"]({},i,{reason:d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke})):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([a.messages.put(e),d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:e.author,chatJid:e.threadJid,externalId:e.revokedExternalId}]),d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,e.threadJid,e.revokedExternalId,e.author,d("MAWMsgType").MSG_TYPE.REVOKED),h,i,d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,b.externalId)]).then(function(){g||d("MAWUnsendMsgContentCleaner").addNewUnsendMsgContentCleanerTimestamp(e.unsendMsgContentDeleteTs);return d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,f)}).then(function(){b!=null&&d("MAWUploadMessagesBackup").sendDeleteEchoMessage(b,b.threadJid);d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e)});if(b!=null&&d("MAWDbMsg").isMediaMsg(b)){var a=b.mediaId,f=b.plaintextHash;a!=null&&(c("gkx")("2419")&&f!=null?d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:a,msgId:b.msgId,plaintextHash:f,threadJid:b.threadJid}}):d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:a,msgId:b.msgId,threadJid:b.threadJid}}))}d("MAWEphemeralUtil").maybeClearEphemeralMsgCountdown(b)})}function b(a,b,e){if(b.type!==d("MAWMsgType").MSG_TYPE.REVOKED)throw c("err")("Cant mark unrevoked message revoked");var f=d("MAWJidUtils").toProtocolMsgId(b);f=f!=null?a.deletedMessages.add(babelHelpers["extends"]({},f,{reason:d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke})):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:b.author,chatJid:b.threadJid,externalId:b.revokedExternalId}]),d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,e),f]).then(function(){d("MAWUnsendMsgContentCleaner").addNewUnsendMsgContentCleanerTimestamp(b.unsendMsgContentDeleteTs),d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b)})})}function l(a,b){return b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?a.messages["delete"](b.rowId).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,[b])});return!0}):d("MAWDexieTable").dexieResolve(!1)}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.writeIncomingRevokeMsg=a;g.revokeUnstoredMsg=j;g.markExistingMsgRevoked=k;g.markIncomingMessageRevoked=b}),98);
__d("MAWConstants",[],(function(a,b,c,d,e,f){"use strict";a=5;b="Facebook user";c="Instagram user";d=3;e=50;f.MESSAGE_RETRY_COUNT_LIMIT=a;f.FB_UNKNOWN_USER=b;f.INS_UNKNOWN_USER=c;f.CURRENT_REGISTRATION_VERSION=d;f.BRIDGE_UPLOAD_BATCH_SIZE=e}),66);
__d("MAWEBBackendQPLUtils",["MAWEBSwitch","MAWQplProxy","Random","WAHashStringToNumber","gkx","hashString","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=(b=b)!=null?b:c("Random").uint32();d("MAWQplProxy").startQplUserFlow(c("qpl")._(521479468,"1752"),{"int":{numMessagesRestored:0},string:{threadId:a}},b);return b}function b(a,b){d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521479468,"1752"),{string:{threadId:b}},a)}function e(a){return a.dyiBatch.each(function(a){if(a.isThread===!1)return;d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521479468,"1752"),"dyi_backup_restore_error",{string:{threadId:a.threadId}},a.qplInstanceKeyForThread)})}function f(a,b){if(b.qplInstanceKeyForThread==null)return;a=a===!1?"dyi_backup_restore_continuing":"dyi_backup_restore_finished";var e=b.qplInstanceKeyForThread;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521479468,"1752"),a,{annotations:{"int":{numMessages:b.numMessages,numMessagesRestored:b.numMessagesRestored},string:{threadId:b.threadId}},instanceKey:(a=e)!=null?a:void 0})}function h(a,b){if(a==null)return;d("MAWQplProxy").sendQPLErrorThroughBridge(c("qpl")._(521479468,"1752"),"dyi_backup_restore_thread_halted",{debugInfo:"DYI attempting to re-restore previous batch - halting DYI for thread "+b,instanceKey:a})}function i(a,b){if(a==null)return;d("MAWQplProxy").sendQPLErrorThroughBridge(c("qpl")._(521479468,"1752"),"dyi_backup_restore_batch_not_in_progress",{debugInfo:"DYI for thread with jid "+b+" is not currently in progress",instanceKey:a})}function j(a,b){if(a==null)return;d("MAWQplProxy").sendQPLErrorThroughBridge(c("qpl")._(521479468,"1752"),"dyi_backup_restore_stopping_dyi",{debugInfo:"Error occurred on restore - stopping DYI for thread with chat jid "+b,instanceKey:a})}function k(a,b){if(a==null)return;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521478596,"1329"),"dyi_get_thread_list",{annotations:{"int":{threadsToRestore:b}},instanceKey:a})}function l(a){return c("hashString")(a)}function m(a,b){if(c("gkx")("23946")!==!0)return;var e=l(b);d("MAWQplProxy").startQplUserFlow(c("qpl")._(521485625,"1876"),{bool:{eb_switch:c("MAWEBSwitch").isEnabled(),is_retroactive_backups_upload:a},string:{trace_id:b}},e)}function n(a,b,e){if(c("gkx")("23946")!==!0||a==null)return;a=l(a);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521485625,"1876"),b,{annotations:e,instanceKey:a})}function o(a,b,e){if(c("gkx")("23946")!==!0||a==null)return;a=l(a);d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521485625,"1876"),b,e,a)}function p(a,b,e){if(a==null)return;a=d("WAHashStringToNumber").hashStringToNumber(a);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521485815,"2166"),b,{annotations:e,instanceKey:a})}function q(a,b,e){if(a==null)return;a=d("WAHashStringToNumber").hashStringToNumber(a);d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521485815,"2166"),b,e,a)}g.startDYIBackupRestoreQplUserFlow=a;g.endSuccessDYIBackupRestoreQplUserFlow=b;g.cleanupDYIBackupRestoreQplUserFlow=e;g.addPointDYIBackupRestoreQplUserFlow=f;g.markErrorDyiBackupRestoreThreadHalt=h;g.markErrorDyiBackupRestoreBatchNotInProgress=i;g.markErrorDyiBackupRestoreStoppingDyi=j;g.logDyiE2EGetThreadList=k;g.getQplInstanceKey=l;g.startEBBackupUploadQplUserFlow=m;g.addPointEBBackupUpload=n;g.endFailEBBackupUpload=o;g.logMediaRestoreFromMIQPLPoint=p;g.logMediaRestoreFromMIQPLEndFailure=q}),98);
__d("MAWEncryptedBackupCacheManager",[],(function(a,b,c,d,e,f){"use strict";var g=new Map(),h=new Map(),i=new Map();function a(a,b){h.set(a,{cache:b,status:"restoring"})}function b(a){a.forEach(function(a){var b=h.get(a);b!=null&&h.set(a,{cache:b.cache,status:"done"})})}function c(a){a=h.get(a);if(a!=null)return a.status;else return"none"}function d(a){return(a=h.get(a))==null?void 0:a.cache}function e(a){return h["delete"](a)}function j(a,b){var c=g.get(a)||new Set();c.add(b);g.set(a,c)}function k(a,b){a=g.get(a);return a!=null?a==null?void 0:a.has(b):!1}function l(a,b){a=g.get(a);a!=null&&a["delete"](b)}function m(a){return h.has(a)}function n(a){return i.has(a)}function o(a){return i.get(a)}function p(a){n(a)&&i["delete"](a)}function q(a,b){i.set(a,b)}f.restoredCache=h;f.addMsgEntryToRestoredCache=a;f.setRestoredCacheStatusAsDone=b;f.getRestoredCacheStatus=c;f.getRestoredCache=d;f.removeFromRestoredCache=e;f.addMsgEntryToReuploadCache=j;f.checkForMsgEntryInReuploadCache=k;f.removeMsgEntryFromReuploadCache=l;f.peekRestoreCache=m;f.peekPendingStanzaCache=n;f.getPendingStanzaCacheValue=o;f.removePendingStanzaCacheValue=p;f.addPendingStanzaToPendingStanzaCache=q}),66);
__d("MAWJobsIndexedDb",["MAWCurrentUser","MAWErrorObject","MAWGetWorkerStatusApi","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWTransactionMode","Promise","WAExceededStorageQuota","WALogger","WAWorkerGlobalScope","err","promiseDone","qex","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[JobsDb initialization] upgradeneeded is triggered in another worker. This should not happen."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[JOB] Setting up the jobs database"]);j=function(){return a};return a}var k=null,l=null,m="jobs";function n(){return c("qex")._("940")}function o(){if(k==null)throw c("err")("JobDB IndexDB should've been initialized");return k}function p(){if(l==null)throw c("err")("JobDB IndexDB should've been initialized");return l.then(function(){return o()})}function a(){return k!=null}var q=[function(a){a=a.target.result;a=a.createObjectStore(m,{autoIncrement:!0,keyPath:"jobId"});a.createIndex("uniqKey","uniqKey")},function(){},function(){}];function e(a){l=null;k=null;return r(a).then(function(){return k.version})}function r(a){if(l!=null)return l;if(k!=null)return(h||(h=b("Promise"))).resolve();var c=d("MAWCurrentUser").getID(),e=d("MAWIndexedDbMetadata").jobsDbName(c),f=(a=(c=a)!=null?c:n())!=null?a:q.length;d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Initializing);d("MAWGetWorkerStatusApi").setDatabaseApi(e,"native");l=new(h||(h=b("Promise")))(function(a,b){d("WALogger").LOG(j());var c=indexedDB.open(e,f);c.onupgradeneeded=function(a){d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Upgrading);for(var b=0;b<q.length;b++){var c=q[b],f=b+1;s(a,f)&&c(a)}};c.onsuccess=function(b){var c=b.target.result;d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Open);c.onversionchange=function(){var a;d("WALogger").ERROR(i());c.close();(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:a.reload==null?void 0:a.reload()};k=c;a()};c.onerror=function(){d("MAWGetWorkerStatusApi").setDatabaseStatus(e,d("MAWLowLevelApiTypes").DatabaseState.Error),b(c.error)}});return l}function s(a,b){var c=a.newVersion;a=a.oldVersion;return a<b&&c>=b}function t(a){return a===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function f(a,b,e,f){var g=t(b);return function(b){return function(){for(var h=arguments.length,i=new Array(h),j=0;j<h;j++)i[j]=arguments[j];var m=f!=null?d("MAWQplProxy").startQplUserFlow(f):null,n=function f(h){return p().then(function(c){var e=function(b){b=c.transaction(a,b!=null?t(b):g,{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(b);return b.objectStore(a)};return b.apply(void 0,[e].concat(i))}).then(function(a){m==null?void 0:m.endSuccess();return a})["catch"](function(b){m==null?void 0:m.endFail("job_transaction_fail");b=d("MAWErrorObject").getErrorObject(b);if((b==null?void 0:b.name)==="InvalidStateError"&&h===1){l=null;k=null;c("promiseDone")(r());return f(h-1)}throw c("unrecoverableViolation")(e+":"+a+" - Error performing transaction in jobDB transactor v2","maw_db",b?{error:b}:{})})};return n(1)}}}g.getJobsDbVersion=n;g.getJobDB=o;g.isJobDBInitted=a;g.dbMigrations=q;g.makeJobsDbIgnoringPreviousCreations=e;g.makeJobsDb=r;g.makeJobsTransactor=f}),98);
__d("MAWJobPersistenceAccessorsApi",["MAWJobActionsV2","MAWJobsIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a,b,c;return{deletePersistedJob:(a=d("MAWJobsIndexedDb")).makeJobsTransactor("jobs",(b=d("MAWTransactionMode")).READWRITE,"deletePersistedJob")((c=d("MAWJobActionsV2")).deletePersistedJob),loadAllJobs:a.makeJobsTransactor("jobs",b.READONLY,"loadAllJobs")(c.readAllPersistedJobs),maybeCreateJob:a.makeJobsTransactor("jobs",b.READWRITE,"maybeCreateJob")(c.maybeCreateJob),readPersistedJob:a.makeJobsTransactor("jobs",b.READONLY,"readPersistedJob")(c.readPersistedJob),updatePersistedJob:a.makeJobsTransactor("jobs",b.READWRITE,"updatePersistedJob")(c.updatePersistedJob)}}g.getJobPersistenceAccessors=a}),98);
__d("WAJobRequirement",["Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["JobRequirement[","] blocker errored ",""]);i=function(){return a};return a}c=function(){function a(a){var c=this;this.$1=(h||(h=b("Promise"))).resolve();this.$2=!0;this.$3=null;this.$4=function(){var a=c.$3;if(a!=null){c.$3=null;return(h||(h=b("Promise"))).all(a).then(c.$4)}c.$2=!0};this.name=a}var c=a.prototype;c.addBlocker=function(a){var c=this;a=a["catch"](function(a){d("WALogger").ERROR(i(),c.name,a).sendLogs("job-blocker-rejected")});if(this.$2)this.$2=!1,this.$1=(h||(h=b("Promise"))).all([this.$1,a]).then(this.$4);else{var e=this.$3;e!=null?e.push(a):this.$3=[a]}};c.waitUntilSatisfied=function(){return this.$1};c.isSatisfied=function(){return this.$2};c.isSatisfiable=function(){return!0};return a}();e=function(a){babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;a.prototype.addBlocker.call(babelHelpers.assertThisInitialized(c),new(h||(h=b("Promise")))(function(){}));return c}var d=c.prototype;d.addBlocker=function(){};d.isSatisfiable=function(){return!1};return c}(c);function a(a,c){var d=a.filter(function(a){return!a.isSatisfiable()});if(d.length>0){var e=d.map(function(a){return a.name});return function(a){c==null?void 0:c("unsatisfiable",e,a);return d[0].waitUntilSatisfied()}}var f=a.map(function(){return(h||(h=b("Promise"))).resolve()}),g=(h||(h=b("Promise"))).resolve(),i=null,j=function c(){if(f.every(function(b,c){return b===a[c].waitUntilSatisfied()})){i=null;return}var d=[],e=a.map(function(a){var b=a.waitUntilSatisfied();a.isSatisfied()||(d.push(a.name),b.then(function(){var b=d.indexOf(a.name);d.splice(b,1)}));return b});f=e;i=d;return(h||(h=b("Promise"))).all(e).then(c)};return function(a){if(i==null){var b=j();b!=null&&(g=g.then(function(){return b}))}c==null?void 0:c(i==null?"satisfied":"unsatisfied",i,a);return g}}g.JobRequirement=c;g.UnsatisfiableJobRequirement=e;g.joinRequirements=a}),98);
__d("WAJobPriorityBucket",["WAJobOrchestratorTypes","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"]);i=function(){return a};return a}a=function(){function a(a){this.tasks=[];this.pendingTasks=[];this.lastJobStartedTimestampMs=null;this.jobMaxConcurrency=(a=a.jobMaxConcurrencyMap)!=null?a:{}}var b=a.prototype;b.updateConfig=function(a){this.jobMaxConcurrency=(a=a.jobMaxConcurrencyMap)!=null?a:{}};b.getStats=function(){return[].concat(this.tasks,this.pendingTasks).reduce(function(a,b){var c;c=(c=a[b.jobName])!=null?c:0;a[b.jobName]=c+1;return a},{})};b.next=function(){var a=this;if(this.tasks.length===0)return null;var b=this.pendingTasks.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),c=this.tasks.filter(function(c){var e;return((e=b.get(c.jobName))!=null?e:0)<((e=a.jobMaxConcurrency[c.jobName])!=null?e:d("WAJobOrchestratorTypes").DEFAULT_CONCURRENCY)});return c.length>0?[c[0]]:null};b.add=function(a,b,c,d){c={jobId:c,jobInfo:b,jobName:a,run:d};this.tasks.push(c);return c};b.markJobTaskPending=function(a){this.pendingTasks.includes(function(b){return b.jobId===a.jobId})&&d("WALogger").ERROR(i(),a.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.lastJobStartedTimestampMs=Date.now(),this.pendingTasks.push(a),this.tasks=this.tasks.filter(function(b){return b.jobId!==a.jobId})};b.markJobTaskDone=function(a){this.pendingTasks=this.pendingTasks.filter(function(b){return b.jobId!==a}),this.tasks.includes(function(b){return b.jobId===a})&&d("WALogger").ERROR(h(),a).sendLogs("JobOrchestrator::markJobTaskDone")};b.count=function(){return this.tasks.length};b.pendingCount=function(){return this.pendingTasks.length};b.clearWaitingTasks=function(){this.tasks=[]};b.clear=function(){this.tasks=[],this.pendingTasks=[]};b.getLastJobStartedTimestamp=function(){return this.lastJobStartedTimestampMs};return a}();b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.next=function(){var a=this,b,c;if(this.tasks.length===0)return null;var d=this.pendingTasks.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),e=this.tasks.filter(function(b){var c;return((c=d.get(b.jobName))!=null?c:0)<((c=a.jobMaxConcurrency[b.jobName])!=null?c:1)});if(e.length===0)return null;b=(b=this.jobMaxConcurrency[e[0].jobName])!=null?b:1;c=(c=d.get(e[0].jobName))!=null?c:0;if(b>1&&c<b){var f=e.filter(function(a){return a.jobName===e[0].jobName});b=Math.min(f.length,b-c);return f.slice(0,b)}return[e[0]]};return b}(a);g.BaseJobBucket=a;g.LowJobBucket=b}),98);
__d("WAMetrics",["Promise","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("WATimeUtils").performanceAbsoluteNow();return new(h||(h=b("Promise")))(function(b){setTimeout(function(){b(d("WATimeUtils").performanceAbsoluteNow()-a)},0)})}g.getEventLoopDelay=a}),98);
__d("WAConcurrentBucketJobQueue",["Promise","WABase64","WACustomError","WAErr","WAJobOrchestratorTypes","WAJobPriorityBucket","WALogger","WAMetrics","WANullthrows","WAPromiseTimeout","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated WAConcurrentBucketJobQueue config"]);j=function(){return a};return a}var k=30,l=new Map([[d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]);a=function(){function a(){this.$1=!1,this.$2=0,this.$3=0,this.$4=0,this.$5=new Map(),this.$6=new Map(),this.$7=new Map(),this.$9=0}var e=a.prototype;e.init=function(a,b){var e,f,g;if(this.$1)throw c("WAErr")("WAConcurrentBucketJobQueue has already initialized");this.$4=(e=a==null?void 0:a.bestEffortWaitTimeoutSec)!=null?e:k;this.$2=a.maxConcurrency;this.$3=a.maxConcurrency;this.$8=b;this.$7=this.$11(a==null?void 0:a.jobPrioritiesQuota);this.$6=new Map(this.$7);this.$5=new Map();this.$9=Date.now();b=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(e=a.maxConcurrencyPerJob)!=null?e:{}});e=new(d("WAJobPriorityBucket").LowJobBucket)({jobMaxConcurrencyMap:(e=a.maxConcurrencyPerJob)!=null?e:{}});f=new(d("WAJobPriorityBucket").LowJobBucket)({jobMaxConcurrencyMap:(f=a.maxConcurrencyPerJob)!=null?f:{}});g=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(g=a.maxConcurrencyPerJob)!=null?g:{}});a=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(a=a.maxConcurrencyPerJob)!=null?a:{}});this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION,b);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,b);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.OFFLINE,g);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.HISTORY_SYNC,a);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,e);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,f);this.$1=!0};e.updateConfig=function(a){this.$3+=a.maxConcurrency-this.$2,this.$2=a.maxConcurrency,this.$5.forEach(function(b){return b.updateConfig({jobMaxConcurrencyMap:(b=a.maxConcurrencyPerJob)!=null?b:{}})}),this.$7=this.$11(a==null?void 0:a.jobPrioritiesQuota),d("WALogger").LOG(j())};e.isInitialized=function(){return this.$1};e.clearQueue=function(){if(!this.$1)throw c("WAErr")("WAConcurrentBucketJobQueue not initialized");this.$5.forEach(function(a){return a.clear()})};e.clearQueueByPriority=function(a){if(!this.$1)throw c("WAErr")("WAConcurrentBucketJobQueue not initialized");(a=this.$5.get(a))==null?void 0:a.clearWaitingTasks()};e.getIntStats=function(){var a=this,b=function(b){var c;b=a.$5.get(b);return((c=b==null?void 0:b.count())!=null?c:0)+((c=b==null?void 0:b.pendingCount())!=null?c:0)};return{highPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}};e.getStringStats=function(){var a=this,b=function(b){var c=(b=(b=a.$5.get(b))==null?void 0:b.getStats())!=null?b:{};b=Object.keys(c).reduce(function(a,b){var d=a[0];a=a[1];var e=c[b];return e>d?[e,b]:[d,a]},[0,null]);b=b[1];return b};return{highPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}};e.enqueue=function(a,e,f,g){var i,j=this;if(!this.$1)return(h||(h=b("Promise"))).reject(c("WAErr")("WAConcurrentBucketJobQueue not initialized"));var k,l,m=new(h||(h=b("Promise")))(function(a,b){k=a,l=b}),n=babelHelpers["extends"]({priority:d("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},f),o=this.getJobBucketByType(n.priority);if(!o)return(h||(h=b("Promise"))).reject(c("WAErr")("WAConcurrentBucketJobQueue no bucket for job with name "+a+" was found."));void d("WAMetrics").getEventLoopDelay().then(function(a){(g==null?void 0:g.isActive())&&(g==null?void 0:g.addPoint("measure_event_loop_delay",{"int":{eventLoopDelay:a}}))});g==null?void 0:g.addPoint("scheduling_job",{string:babelHelpers["extends"]({},this.getStringStats(),{priority:n.priority}),"int":babelHelpers["extends"]({},this.getIntStats(),{maxTimeoutMs:(i=f==null?void 0:f.maxTimeoutMs)!=null?i:0})});var p=n.priority+"-"+a+"-"+((i=f==null?void 0:f.jobId)!=null?i:d("WABase64").randomBase64(8));i=o.add(a,n,p,function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.prev=0;j.$8.logJobStarted(p);c.next=4;return b("regeneratorRuntime").awrap(j.$12(e(),f==null?void 0:f.maxTimeoutMs));case 4:a=c.sent;j.$8.logJobCompleted(p);k(a);c.next=13;break;case 9:c.prev=9,c.t0=c["catch"](0),c.t0 instanceof d("WACustomError").TimeoutError?j.$8.logJobTimeout(p):j.$8.logJobError(p),l(c.t0);case 13:case"end":return c.stop()}},null,this,[[0,9]])});this.$8.logJobCreated({jobId:p,jobName:a,jobPriority:n.priority,pendingJobsCount:o.count()});f&&f.priority===d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&void this.$13(i);this.$14();return m};e.getAvailableThreadsCount=function(){return this.$3};e.getJobQuotaConfig=function(){return this.$7};e.getRemainingJobCountMap=function(){return this.$6};e.getJobBucketByType=function(a){return this.$5.get(a)};e.getSnapshot=function(a){a=this.getJobBucketByType(a);return!a?null:a.getStats()};e.$11=function(a){var b;!a?b=new Map(l):b=new Map(a);b.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,0);return b};e.$15=function(a){return(a=this.$6.get(a))!=null?a:0};e.$16=function(){this.$6=new Map(this.$7)};e.$17=function(a){var b=this;a===void 0&&(a=!0);var c=0,e=null,f=0;this.$5.forEach(function(a,d){c+=a==null?void 0:a.count();f+=b.$15(d);if(e!=null)return;a.count()>0&&b.$15(d)>0&&(e=a)});var g=e==null||f===0;g&&this.$16();if(this.$18(c,g))return this.getJobBucketByType(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT);return e==null&&a?this.$17(!1):e};e.$18=function(a,b){var c=this;function e(a,b){var c=Date.now();return a>c?!1:c-a<b*1e3}function f(a,b){a=Math.ceil(a-Date.now())+b*1e3;return a>0?a:0}var g=this.getJobBucketByType(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT);a=a-((a=g==null?void 0:g.count())!=null?a:0);var h=g==null?void 0:g.getLastJobStartedTimestamp();if((g==null?void 0:g.count())===0)return!1;if(h==null&&e(this.$9,this.$4)){if(this.$10==null){g=f(this.$9,this.$4);this.$10=setTimeout(function(){c.$14(),c.$10=null},g)}return!1}return a>0&&h!=null&&e(h,this.$4)?!1:b};e.$19=function(a){a=this.$20(a);return c("WANullthrows")(this.$5.get(a))};e.$20=function(a){var b=a.split("-")[0];b=d("WAJobOrchestratorTypes").JOB_PRIORITY.cast(b);if(!b)throw c("WAErr")("ConcurrentBucketQueue cannot extract known job priority type from id: "+a);return b};e.$21=function(a){a=this.$20(a);this.$15(a)>0?this.$6.set(a,this.$15(a)-1):this.$6.set(a,0)};e.$14=function(){var a=this;while(this.$3>0){var b=this.$17();b=b==null?void 0:b.next();if(b==null)break;b.forEach(function(b){a.$21(b.jobId),void a.$13(b)})}};e.$12=function(a,b){return b!==void 0?d("WAPromiseTimeout").promiseTimeout(a,b):a};e.$13=function(a){var c=this,e,f,g,h,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=this.$19(a.jobId);this.$3--;e.markJobTaskPending(a);f=a.run,g=a.jobId,h=a.jobName;k.prev=4;k.next=7;return b("regeneratorRuntime").awrap(this.$12(f(),((j=a.jobInfo)==null?void 0:j.maxTimeoutMs)===void 0?d("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0));case 7:k.next=17;break;case 9:k.prev=9;k.t0=k["catch"](4);if(!(k.t0 instanceof d("WACustomError").TimeoutError)){k.next=16;break}this.$8.logJobTimeout(g);d("WALogger").LOG(i(),h);k.next=17;break;case 16:throw k.t0;case 17:k.prev=17;this.$3++;e.markJobTaskDone(g);this.$3>0&&setTimeout(function(){return c.$14()},0);return k.finish(17);case 22:case"end":return k.stop()}},null,this,[[4,9,17,22]])};return a}();g.WAConcurrentBucketJobQueue=a}),98);
__d("WAConcurrentPreemptiveJobQueue",["Promise","WACustomError","WAErr","WAHex","WAJobOrchestratorTypes","WALogger","WAPromiseTimeout","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated ConcurrentPreemptiveJobQueue config"]);l=function(){return a};return a}a=function(){function a(){this.$1=!1,this.$2=0,this.$3=0,this.$4={},this.$5=[],this.$6=[]}var e=a.prototype;e.init=function(a,b){if(this.$1)throw c("WAErr")("ConcurrentPreemptiveJobQueue has already initialized");this.$2=a.maxConcurrency;this.$3=a.maxConcurrency;this.$4=(a=a.maxConcurrencyPerJob)!=null?a:{};this.$7=b;this.$1=!0};e.updateConfig=function(a){this.$3+=a.maxConcurrency-this.$2;this.$2=a.maxConcurrency;this.$4=(a=a.maxConcurrencyPerJob)!=null?a:{};d("WALogger").LOG(l())};e.isInitialized=function(){return this.$1};e.clearQueueByPriority=function(a){if(!this.$1)throw c("WAErr")("ConcurrentPreemptiveJobQueue not initialized");this.$5=this.$5.filter(function(b){return((b=b.jobInfo)==null?void 0:b.priority)!==a})};e.clearQueue=function(){if(!this.$1)throw c("WAErr")("ConcurrentPreemptiveJobQueue not initialized");this.$5=[];this.$6=[]};e.enqueue=function(a,e,f){var g,i=this;if(!this.$1)return(h||(h=b("Promise"))).reject(c("WAErr")("ConcurrentPreemptiveJobQueue not initialized"));var j,k,l=new(h||(h=b("Promise")))(function(a,b){j=a,k=b}),m=babelHelpers["extends"]({priority:d("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},f),n=(g=f==null?void 0:f.jobId)!=null?g:d("WAHex").randomHex(8).substr(0,64);g=this.$8(a,m,n,function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.prev=0;i.$7.logJobStarted(n);c.next=4;return b("regeneratorRuntime").awrap(i.$9(e(),f==null?void 0:f.maxTimeoutMs));case 4:a=c.sent;i.$7.logJobCompleted(n);j(a);c.next=13;break;case 9:c.prev=9,c.t0=c["catch"](0),c.t0 instanceof d("WACustomError").TimeoutError?i.$7.logJobTimeout(n):i.$7.logJobError(n),k(c.t0);case 13:case"end":return c.stop()}},null,this,[[0,9]])});f&&f.priority===d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&this.$10(g);this.$11();return l};e.getAvailableThreadsCount=function(){return this.$3};e.getJobMaxConcurrency=function(){return this.$4};e.getSnapshot=function(a){};e.$11=function(){while(this.$3>0){var a=this.$12();if(a==null)break;this.$10(a)}};e.$9=function(a,b){return b!==void 0?d("WAPromiseTimeout").promiseTimeout(a,b):a};e.$10=function(a){var c=this,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:this.$3--;this.$13(a);e=a.run,f=a.jobId,g=a.jobName;i.prev=3;i.next=6;return b("regeneratorRuntime").awrap(this.$9(e(),((h=a.jobInfo)==null?void 0:h.maxTimeoutMs)===void 0?d("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0));case 6:i.next=16;break;case 8:i.prev=8;i.t0=i["catch"](3);if(!(i.t0 instanceof d("WACustomError").TimeoutError)){i.next=15;break}this.$7.logJobTimeout(f);d("WALogger").LOG(k(),g);i.next=16;break;case 15:throw i.t0;case 16:i.prev=16;this.$3++;this.$14(f);setTimeout(function(){return c.$11()},0);return i.finish(16);case 21:case"end":return i.stop()}},null,this,[[3,8,16,21]])};e.$8=function(a,b,c,d){d={jobId:c,jobInfo:b,jobName:a,run:d};this.$7.logJobCreated({jobId:c,jobName:a,jobPriority:b.priority,pendingJobsCount:this.$5.length});this.$5.push(d);return d};e.$13=function(a){this.$6.includes(function(b){return b.jobId===a.jobId})&&d("WALogger").ERROR(j(),a.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.$6.push(a),this.$5=this.$5.filter(function(b){return b.jobId!==a.jobId})};e.$14=function(a){this.$6=this.$6.filter(function(b){return b.jobId!==a}),this.$5.includes(function(b){return b.jobId===a})&&d("WALogger").ERROR(i(),a).sendLogs("JobOrchestrator::markJobTaskDone")};e.$12=function(){var a=this;if(this.$5.length===0)return null;var b=this.$6.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),c=this.$5.filter(function(c){var d;return((d=b.get(c.jobName))!=null?d:0)<((d=a.$4[c.jobName])!=null?d:1)});return c[0]};return a}();g.WAConcurrentPreemptiveJobQueue=a}),98);
__d("WADefaultJobNoQueue",["WAErr","WAHex","WAJobOrchestratorTypes","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$2=!1}var e=a.prototype;e.init=function(a,b){if(this.$2)throw c("WAErr")("DefaultNoQueue has already initialized");this.$1=b;this.$2=!0};e.updateConfig=function(a){};e.isInitialized=function(){return this.$2};e.clearQueue=function(){};e.clearQueueByPriority=function(a){};e.getSnapshot=function(){throw c("WAErr")("getSnapshot is not implemented for DefaultNoQueue")};e.enqueue=function(a,c,e){var f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:h=(f=e==null?void 0:e.jobId)!=null?f:d("WAHex").randomHex(8).substr(0,64);this.$1.logJobCreated({jobId:h,jobName:a,jobPriority:(g=e==null?void 0:e.priority)!=null?g:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,pendingJobsCount:0});j.prev=2;this.$1.logJobStarted(h);j.next=6;return b("regeneratorRuntime").awrap(c());case 6:i=j.sent;this.$1.logJobCompleted(h);return j.abrupt("return",i);case 11:j.prev=11;j.t0=j["catch"](2);this.$1.logJobError(h);throw j.t0;case 15:case"end":return j.stop()}},null,this,[[2,11]])};return a}();g.WADefaultJobNoQueue=a}),98);
__d("WAOrchestratorJobStatsLogger",["WAGlobals","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(a,b,c){this.jobName=a,this.pendingJobsCount=c,this.jobPriority=b}var b=a.prototype;b.logJobAdded=function(){this.webcJobAddedT=Date.now(),this.eventFlow=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR,{string:{name:this.jobName,jobPriority:this.jobPriority,orchestratorVersion:d("WAGlobals").getConfig().orchestratorVersion()},"int":{pendingJobsCount:this.pendingJobsCount,addedAt:this.webcJobAddedT}})};b.logJobStarted=function(){this.webcJobStartedT=Date.now(),this.eventFlow.addPoint("start_job",{"int":{startedAt:this.webcJobStartedT}})};b.logJobCompleted=function(a){this.webcJobCompletedT=Date.now();this.jobResultType=a;var b={"int":{pendingJobsCount:this.pendingJobsCount,completedAt:this.webcJobCompletedT}};a==="completed"?this.eventFlow.endSuccess(b):this.eventFlow.endFail(a,b)};return a}();a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.logJobCreated=function(a){var b=a.jobName,c=a.jobId,d=a.jobPriority;a=a.pendingJobsCount;b=new h(b,d,a);b.logJobAdded();this.$1.set(c,b)};b.logJobStarted=function(a){a=this.$1.get(a);a==null?void 0:a.logJobStarted()};b.logJobCompleted=function(a){this.$2(a,"completed")};b.logJobError=function(a){this.$2(a,"error")};b.logJobTimeout=function(a){this.$2(a,"timeout")};b.logJobAborted=function(a){this.$2(a,"aborted")};b.$2=function(a,b){var c=this.$1.get(a);c==null?void 0:c.logJobCompleted(b);this.$1["delete"](a)};return a}();g.JobInfoEvent=h;g.JobStatsLogger=a}),98);
__d("WAOrchestrator",["WAConcurrentBucketJobQueue","WAConcurrentPreemptiveJobQueue","WADefaultJobNoQueue","WAGlobals","WAJobOrchestratorTypes","WAOrchestratorJobStatsLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a={maxConcurrency:1},b="default",c={},e=a,f=new(d("WAOrchestratorJobStatsLogger").JobStatsLogger)();return function(g,j){var k;g===void 0&&(g=!1);g=g?b:d("WAGlobals").getConfig().orchestratorVersion();k=(k=i())!=null?k:a;var l;j==null?void 0:j.addPoint("get_orchestrator",{string:{orchestrator:g},"int":{maxConcurrency:k.maxConcurrency,highPriorityQuota:(j=(j=k.jobPrioritiesQuota)==null?void 0:j.get(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH))!=null?j:0,lowPriorityQuota:(j=(j=k.jobPrioritiesQuota)==null?void 0:j.get(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW))!=null?j:0}});if(c[g]){h(e,k)&&(e=k,c[g].updateConfig(k));return c[g]}switch(g){case"preemptive":l=new(d("WAConcurrentPreemptiveJobQueue").WAConcurrentPreemptiveJobQueue)();break;case"bucket":l=new(d("WAConcurrentBucketJobQueue").WAConcurrentBucketJobQueue)();break;default:l=new(d("WADefaultJobNoQueue").WADefaultJobNoQueue)();break}l.init(k,f);c[g]=l;e=k;return l}}function h(a,b){var c;if(a.maxConcurrency!==b.maxConcurrency)return!0;if(((c=a.jobPrioritiesQuota)==null?void 0:c.size)!==((c=b.jobPrioritiesQuota)==null?void 0:c.size))return!0;return Object.keys((c=a.maxConcurrencyPerJob)!=null?c:{}).length!==Object.keys((c=b.maxConcurrencyPerJob)!=null?c:{}).length?!0:JSON.stringify(a)!==JSON.stringify(b)}function i(){var a={jobPrioritiesQuota:new Map([[d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]),maxConcurrency:5,maxConcurrencyPerJob:{}};return a}g.getInstanceDelegate=a}),98);
__d("WAPromiseBackoffs",["Promise","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a===0)return 0;var c=o(b.algo);for(var d=1;d<a;d++)c();return j(b,c())}function i(a){var b=a.relativeDelay,c=b===void 0?!1:b,d=null,e=o(a.algo);return function(){var b=d;if(b==null){d=c?Date.now():0;return 0}var f=j(a,e());if(c){var g=Date.now();b=g-b;b>0&&(f=Math.max(0,f-b));d=g}return f}}function d(a){var c=i(a);return function(a){return new(h||(h=b("Promise")))(function(b){var d=c();d>0?setTimeout(b,d,a):b(a)})}}function j(a,b){var c=a.max,d=a.min;a=a.jitter;a=a===void 0?.1:a;b=b;c!=null&&b>c&&(b=c);d!=null&&b<d&&(b=d);a!==0&&(b=Math.ceil(b*(1+a*Math.random())));return b}function k(a){var b=a.second-a.first,c=a.first-b;return function(){var a=b+c;c=b;b=a;return a}}function l(a){var b=a.base,c=b===void 0?2:b,d=a.first;return function(){var a=d;d*=c;return a}}function m(a){var b=a.delay;return function(){return b}}function n(a){var b=a.toMs;a=a.backoff;var c=o(a);return function(){return b(c())}}function o(a){switch(a.type){case"fibonacci":return k(a);case"exponential":return l(a);case"constant":return m(a);case"adjust":return n(a);default:a;throw c("WAErr")("makeTimeFunc unrecognized backoff "+a.type)}}g.getDelay=a;g.createTimer=i;g.createPromiseTimer=d}),98);
__d("WAPersistedJobManager",["Promise","WAJobRequirement","WALogger","WAPromiseBackoffs","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["waitUntilCompletedNonPersisted not implemented in PersistedJobManager"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["fireAndForgetNonPersisted not implemented in PersistedJobManager"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": requires page"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running step"]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["No entry for job ",""]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": restarting"]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"]);K=function(){return a};return a}var L=1,M=function(){function a(a){this.feature=a}var b=a.prototype;b.toString=function(){return"RequiresPage: "+this.feature};return a}(),N=function(){function a(a){this.backoffOptions=a}var b=a.prototype;b.toString=function(){return"RetryOnBackoff"};return a}();a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(babelHelpers.wrapNativeSuper(Error));var O=function(a){this.result=a},P="$unstarted",Q="$finished";c=function(){function a(a){var c=this,e=a.isRestartAfterCrash,f=a.accessors,g=a.unfinishedJobEntries,i=new Map();g=g.then(function(a){var g=[],j=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?g.push(a):j.push(a)});return(h||(h=b("Promise"))).all(g.map(function(a){d("WALogger").ERROR(K(),S(a),a.step).devConsole(R(a)).sendLogs("job-stuck-"+a.type);return f.deletePersistedJob(a.jobId)})).then(function(){j.forEach(function(a){if(i.has(a.jobId))return;d("WALogger").LOG(J(),R(a));i.set(a.jobId,c.$1(a,e))})})});this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=f;this.activeJobs=i;this.initialJobsPromise=g;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs}var c=a.prototype;c.loadAndRunJobFromId=function(a){var b=this.activeJobs.get(a);if(b!=null)return b;b=this.$2(a);this.activeJobs.set(a,b);return b};c.$2=function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=this.initialJobsPromise,e=this.accessors;g.next=3;return b("regeneratorRuntime").awrap(c);case 3:g.next=5;return b("regeneratorRuntime").awrap(e.readPersistedJob(a));case 5:f=g.sent;if(f){g.next=10;break}d("WALogger").DEV(I(),a);d("WALogger").WARN(H());return g.abrupt("return",null);case 10:return g.abrupt("return",this.$1(f,!1));case 11:case"end":return g.stop()}},null,this)};c.$3=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};c.$4=function(a,c){if(c==null||c.length===0)return(h||(h=b("Promise"))).resolve();var e=this.stepBlockers,f=e.get(c);f==null&&(f=d("WAJobRequirement").joinRequirements(c.map(function(a){return a()}),U),e.set(c,f));return f(a)};c.$5=function(a,b,c,e){var f=this;c===void 0&&(c=!1);var g=a.step,h=b.findIndex(function(a){return a.stepName===g}),i=b[h].info(a.current,a.original,V(a,c)),j=i.requirements,k=i.code;i=this.$4(a,j);e&&(i=i.then(e));return i.then(function(){d("WALogger").LOG(G(),T(a));return k(a.current,a.original,V(a,c))}).then(function(e){if(e instanceof O){d("WALogger").LOG(F(),T(a));return e.result}var g=h+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return f.accessors.updatePersistedJob(a).then(function(){return f.$5(a,b,c)})})};c.$1=function(a,c){var e,f=this,g,i,j,k,l,m,n,F,G,H,I,J,K,O,S,U;return b("regeneratorRuntime").async(function(W){while(1)switch(W.prev=W.next){case 0:g=this.accessors,i=this.activeJobs,j=this.deprecatedJobs,k=this.listeners,l=k.onJobFinished,m=k.onJobStarted;W.next=3;return b("regeneratorRuntime").awrap(this.$3(a.type));case 3:n=W.sent;F=j[a.type];if(n){W.next=21;break}if(F){W.next=13;break}d("WALogger").ERROR(E(),a.type).sendLogs("missing-job-implementation");W.next=10;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 10:return W.abrupt("return",null);case 13:if(!(F==="NOOP")){W.next=18;break}d("WALogger").WARN(D(),a.type);W.next=17;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 17:return W.abrupt("return",null);case 18:W.next=20;return b("regeneratorRuntime").awrap(F());case 20:n=W.sent;case 21:G=n;F&&d("WALogger").LOG(C(),a.type);H=(e=a.stepFirstStartTime)!=null?e:d("WATimeUtils").unixTime();a.stepFirstStartTime=H;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(!(a.step===Q)){W.next=44;break}I=a.waitUntil;J=d("WATimeUtils").secondsUntil(H);if(!(I!=null&&d("WATimeUtils").isInFuture(I)&&J>0)){W.next=38;break}d("WALogger").LOG(B(),R(a));I=d("WATimeUtils").castToUnixTime(I-J);if(!d("WATimeUtils").isInFuture(I)){W.next=38;break}a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(H-J);a.waitUntil=I;W.next=38;return b("regeneratorRuntime").awrap(this.accessors.updatePersistedJob(a));case 38:if(!(I==null||!d("WATimeUtils").isInFuture(I))){W.next=42;break}d("WALogger").LOG(A(),R(a));W.next=42;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 42:i["delete"](a.jobId);return W.abrupt("return",a.current);case 44:K=a.step!==P?n.find(function(b){return b.stepName===a.step}):n[0];if(K){W.next=50;break}d("WALogger").ERROR(z(),a.type,a.step).sendLogs("missing-job-step");W.next=49;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 49:return W.abrupt("return",null);case 50:a.step=K.stepName;O=function e(){var g=a.waitUntil,i=(h||(h=b("Promise"))).resolve();if(g!=null){var j=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);g>j?(d("WALogger").LOG(y(),T(a),g,j),a.waitUntil=j,i=f.accessors.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(j)})):(d("WALogger").LOG(x(),T(a),g),i=d("WATimeUtils").delayUntil(g))}return i.then(function(){var g=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(H,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return f.accessors.updatePersistedJob(a)};return f.$5(a,G,c,g)["catch"](function(c){if(c instanceof M){d("WALogger").LOG(w(),T(a));a.stepHardStartCountAfterTimeout>0&&(--a.stepHardStartCountAfterTimeout,f.accessors.updatePersistedJob(a));return new(h||(h=b("Promise")))(function(){})}else if(c instanceof N){d("WALogger").LOG(v(),T(a));var g=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,c.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(g/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return f.accessors.updatePersistedJob(a).then(e)}else if(a.stepUnexpectedErrorCount<L){d("WALogger").WARN(u(),T(a),a.stepUnexpectedErrorCount);d("WALogger").WARN(t(),T(a),c);a.stepUnexpectedErrorCount++;return f.accessors.updatePersistedJob(a).then(e)}throw c})})};S=O();U=S.then(function(c){var e;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:d("WALogger").LOG(s(),T(a));e=null;try{e=l(a.jobId,a.type,a.original,c)}catch(b){d("WALogger").ERROR(r(),a.type,b).sendLogs("onJobFinished-threw")}if(!(e!=null&&e>0)){h.next=12;break}a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(e/1e3));a.step=Q;a.current=c;a.stepFirstStartTime=d("WATimeUtils").unixTime();h.next=10;return b("regeneratorRuntime").awrap(f.accessors.updatePersistedJob(a));case 10:h.next=15;break;case 12:h.next=14;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 14:i["delete"](a.jobId);case 15:case"end":return h.stop()}},null,this)},function(e){var f,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:d("WALogger").ERROR(q(),a.type,e).sendLogs("job-threw-exception-"+a.type);f=G.find(function(b){return b.stepName===a.step});if(f){j.next=6;break}d("WALogger").ERROR(p(),a.type,a.step);j.next=10;break;case 6:h=f.info(a.current,a.original,V(a,c));if(!(h.stopRetryIf!=null)){j.next=10;break}j.next=10;return b("regeneratorRuntime").awrap(h.stopRetryIf.onStopRetry(a.current,a.original,V(a,c)));case 10:j.next=12;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 12:i["delete"](a.jobId);case 13:case"end":return j.stop()}},null,this)});try{m(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(o(),a.type,b).sendLogs("onJobStarted-threw")}return W.abrupt("return",U.then(function(){return S}));case 56:case"end":return W.stop()}},null,this)};c.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(n(),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(m(),a);c.set(a,b)};c.fireAndForget=function(a){var b=this;this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};c.waitUntilPersisted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;b.loadAndRunJobFromId(a)})};c.waitUntilCompleted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};c.fireAndForgetNonPersisted=function(a){d("WALogger").LOG(l())};c.waitUntilCompletedNonPersisted=function(a){return(h||(h=b("Promise"))).resolve(function(){return d("WALogger").LOG(k())})};return a}();function R(a){return"Job["+a.jobId+"] ("+a.type+")"}function S(a){return"[Job "+a.type+"] "}function T(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function U(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(j(),T(c),b):a==="unsatisfied"?d("WALogger").LOG(i(),T(c),b):a}function V(a,b){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:W}}function W(a){return new O(a)}g.RequiresPage=M;g.RetryOnBackoff=N;g.NonRetryableError=a;g.InterruptJob=O;g.UNSTARTED_JOB=P;g.FINISHED_JOB=Q;g.PersistedJobManager=c}),98);
__d("WaJobInMemoryAccessors",["Promise","WAHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=-1,c=new Map();return{deletePersistedJob:function(a){return(h||(h=b("Promise"))).resolve(c["delete"](a))},loadAllJobs:function(){return(h||(h=b("Promise"))).resolve(Array.from(c.values()))},maybeCreateJob:function(e){var f,g=JSON.stringify([e.type,(f=e.uniqKey)!=null?f:d("WAHex").randomHex(32)]),i={backedOffCount:0,current:e.args,original:e.args,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:e.type,uniqKey:g,version:e.version,waitUntil:null,scheduleConfig:e.scheduleConfig};f=function(){var d=a--,e=babelHelpers["extends"]({},i,{jobId:d});c.set(d,e);return(h||(h=b("Promise"))).resolve({id:d,newlyCreated:!0})};if(e.uniqKey!=null){e=Array.from(c.values()).filter(function(a){return a.uniqKey===g});if(e.length===0)return f();var j=null;e.forEach(function(a){a.step!=="$finished"?j=a:c["delete"](a.jobId)});return j!=null?(h||(h=b("Promise"))).resolve({id:j.jobId,newlyCreated:!1}):f()}return f()},readPersistedJob:function(a){a=c.get(a);return(h||(h=b("Promise"))).resolve(a&&babelHelpers["extends"]({},a))},updatePersistedJob:function(a){return(h||(h=b("Promise"))).resolve(c.set(a.jobId,babelHelpers["extends"]({},a)))}}}g.getJobInMemoryAccessors=a}),98);
__d("WAPersistedJobManagerV2",["Promise","WAErr","WAGlobals","WAJids","WAJobOrchestratorTypes","WAJobRequirement","WALogger","WAOrchestrator","WAPREList","WAPREMetrics","WAPersistedJobManager","WAPromiseBackoffs","WAResolvable","WATimeUtils","WaJobInMemoryAccessors","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running step"]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]);K=function(){return a};return a}function L(){var a=babelHelpers.taggedTemplateLiteralLoose(["[JOB MANAGER] Restarting job with the same id"]);L=function(){return a};return a}function M(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"]);M=function(){return a};return a}var N=1;function O(a){var b=a.code,c=a.annotations;c=c===void 0?{}:c;a=a.eventFlow;var d=a===void 0?P(c):a;return b(d).then(function(a){d.endSuccess();return a})["catch"](function(a){d.endFail("error",{string:{error:""+a}});throw a})}function P(a){a===void 0&&(a={});return d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOB_MANAGER,babelHelpers["extends"]({},a,{string:babelHelpers["extends"]({},(a=(a=a)==null?void 0:a.string)!=null?a:{},{userHash:d("WAGlobals").getDependencies().isEmployee()&&d("WAGlobals").getDependencies().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null})}))}a=function(){function a(a){var c=this;this.$1=[];var e=a.isRestartAfterCrash,f=a.accessors,g=a.unfinishedJobEntries,i=a.ignoreForceNonPersistedJobList;this.getOrchestratorDelegate=d("WAOrchestrator").getInstanceDelegate();this.activeJobs=new Map();this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=f;this.isRestartAfterCrash=e||!1;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs;this.inMemoryAccessors=d("WaJobInMemoryAccessors").getJobInMemoryAccessors();this.offlineQueueMode=!0;this.$1=i;a.offlineQueueCompletePromise!=null?a.offlineQueueCompletePromise["finally"](function(){c.offlineQueueMode=!1}):this.offlineQueueMode=!1;this.initialJobsPromise=g.then(function(a){var e=[],f=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?e.push(a):f.push(a)});return(h||(h=b("Promise"))).all(e.map(function(a){d("WALogger").ERROR(M(),R(a),a.step).devConsole(Q(a)).sendLogs("job-stuck-"+a.type);return c.accessors.deletePersistedJob(a.jobId)})).then(function(){f.forEach(function(a){var b=c.$2(a.jobId);if(b.alreadyActive===!0){d("WALogger").ERROR(L());return}b.deferred.resolve(O({code:function(b){return c.$3(a,c.accessors,{eventFlow:b})},annotations:{string:{name:a.type},bool:{offlineQueueMode:c.offlineQueueMode}}}))})})})}var e=a.prototype;e.$4=function(a,e,f){var g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:f===void 0&&(f={});h=this.$2(a);(g=f.eventFlow)==null?void 0:g.addPoint("start_load_and_run",{bool:{skipped:h.alreadyActive}});if(!(h.alreadyActive===!0)){j.next=5;break}return j.abrupt("return",h.deferred);case 5:j.next=7;return b("regeneratorRuntime").awrap(e.readPersistedJob(a));case 7:i=j.sent;if(!(i==null)){j.next=11;break}d("WALogger").ERROR(K()).sendLogs("missing-job-entry");throw c("WAErr")("Persisted job missing for given ID "+a);case 11:h.deferred.resolve(this.$3(i,e,f));return j.abrupt("return",h.deferred.promise);case 13:case"end":return j.stop()}},null,this)};e.$3=function(a,b,c){var e;c===void 0&&(c={});(e=c.eventFlow)==null?void 0:e.addPoint("enqueueing_job",{string:{name:a.type}});return this.getOrchestratorDelegate(((e=a.scheduleConfig)==null?void 0:e.priority)===d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP,c.eventFlow).enqueue(a.type,this.$5(a,b,c),a.scheduleConfig,c.eventFlow)};e.$6=function(a,b,c){var d=this;c===void 0&&(c={});return b.maybeCreateJob(a).then(function(a){var e;a=a.id;(e=c.eventFlow)==null?void 0:e.addPoint("job_persisted",{"int":{jobId:a},bool:{nonPersisted:b===d.inMemoryAccessors}});return a})};e.$2=function(a){var b=this.activeJobs.get(a);if(b!=null)return{alreadyActive:!0,deferred:b};b=new(d("WAResolvable").Resolvable)();this.activeJobs.set(a,b.promise);return{alreadyActive:!1,deferred:b}};e.$5=function(a,b,c){var d=this;return function(){return d.$7(a,b,c)}};e.$8=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};e.$9=function(a,c){if(c==null||c.length===0)return(h||(h=b("Promise"))).resolve();var e=this.stepBlockers,f=e.get(c);f==null&&(f=d("WAJobRequirement").joinRequirements(c.map(function(a){return a()}),T),e.set(c,f));return f(a)};e.$10=function(a,b,c,e,f){var g,h=this;f===void 0&&(f={});var i=a.step;(g=f.eventFlow)==null?void 0:g.addPoint("start_step");var j=b.findIndex(function(a){return a.stepName===i});g=b[j].info(a.current,a.original,U(a,this.isRestartAfterCrash));var k=g.requirements,l=g.code;g=this.$9(a,k);e&&(g=g.then(e));return g.then(function(){var b;d("WALogger").LOG(J(),S(a));(b=f.eventFlow)==null?void 0:b.addPoint("run_step");return l(a.current,a.original,U(a,h.isRestartAfterCrash,f.eventFlow))}).then(function(e){var g;(g=f.eventFlow)==null?void 0:g.addPoint("step_is_complete");if(e instanceof d("WAPersistedJobManager").InterruptJob){d("WALogger").LOG(I(),S(a));return e.result}g=j+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return c.updatePersistedJob(a).then(function(){return h.$10(a,b,c,void 0,f)})})};e.$7=function(a,c,e){var f,g,i=this,j,k,l,m,n,o,p,q,r,I,J,K,L,M,O;return b("regeneratorRuntime").async(function(P){while(1)switch(P.prev=P.next){case 0:e===void 0&&(e={});j=this.activeJobs,k=this.deprecatedJobs,l=this.listeners,m=l.onJobFinished,n=l.onJobStarted;(f=e.eventFlow)==null?void 0:f.addPoint("run_job");P.next=5;return b("regeneratorRuntime").awrap(this.$8(a.type));case 5:o=P.sent;p=k[a.type];if(o){P.next=23;break}if(p){P.next=15;break}d("WALogger").ERROR(H(),a.type).sendLogs("missing-job-implementation");P.next=12;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 12:return P.abrupt("return",null);case 15:if(!(p==="NOOP")){P.next=20;break}d("WALogger").WARN(G(),a.type);P.next=19;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 19:return P.abrupt("return",null);case 20:P.next=22;return b("regeneratorRuntime").awrap(p());case 22:o=P.sent;case 23:q=o;p&&d("WALogger").LOG(F(),a.type);r=(g=a.stepFirstStartTime)!=null?g:d("WATimeUtils").unixTime();a.stepFirstStartTime=r;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(!(a.step===d("WAPersistedJobManager").FINISHED_JOB)){P.next=46;break}I=a.waitUntil;J=d("WATimeUtils").secondsUntil(r);if(!(I!=null&&d("WATimeUtils").isInFuture(I)&&J>0)){P.next=40;break}d("WALogger").LOG(E(),Q(a));I=d("WATimeUtils").castToUnixTime(I-J);if(!d("WATimeUtils").isInFuture(I)){P.next=40;break}a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(r-J);a.waitUntil=I;P.next=40;return b("regeneratorRuntime").awrap(c.updatePersistedJob(a));case 40:if(!(I==null||!d("WATimeUtils").isInFuture(I))){P.next=44;break}d("WALogger").LOG(D(),Q(a));P.next=44;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 44:j["delete"](a.jobId);return P.abrupt("return",a.current);case 46:K=a.step!==d("WAPersistedJobManager").UNSTARTED_JOB?o.find(function(b){return b.stepName===a.step}):o[0];if(K){P.next=52;break}d("WALogger").ERROR(C(),a.type,a.step).sendLogs("missing-job-step");P.next=51;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 51:return P.abrupt("return",null);case 52:a.step=K.stepName;L=function f(){var g=a.waitUntil,j=(h||(h=b("Promise"))).resolve();if(g!=null){var k=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);g>k?(d("WALogger").LOG(B(),S(a),g,k),a.waitUntil=k,j=c.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(k)})):(d("WALogger").LOG(A(),S(a),g),j=d("WATimeUtils").delayUntil(g))}return j.then(function(){var b=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(r,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return c.updatePersistedJob(a)};return i.$10(a,q,c,b,e)["catch"](function(b){if(b instanceof d("WAPersistedJobManager").RetryOnBackoff){var g;d("WALogger").LOG(z(),S(a));(g=e.eventFlow)==null?void 0:g.addPoint("retry_on_backoff");g=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,b.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(g/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return c.updatePersistedJob(a).then(f)}else{if(!(b instanceof d("WAPersistedJobManager").NonRetryableError)&&a.stepUnexpectedErrorCount<N){(g=e.eventFlow)==null?void 0:g.addPoint("retry_on_unexpected_error");d("WALogger").WARN(y(),S(a),a.stepUnexpectedErrorCount);d("WALogger").WARN(x(),S(a),b);a.stepUnexpectedErrorCount++;return c.updatePersistedJob(a).then(f)}throw b}})})};M=L();O=M.then(function(e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d("WALogger").LOG(w(),S(a));f=null;try{f=m(a.jobId,a.type,a.original,e)}catch(b){d("WALogger").ERROR(v(),a.type,b).sendLogs("onJobFinished-threw")}if(!(f!=null&&f>0)){g.next=12;break}a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(f/1e3));a.step=d("WAPersistedJobManager").FINISHED_JOB;a.current=e;a.stepFirstStartTime=d("WATimeUtils").unixTime();g.next=10;return b("regeneratorRuntime").awrap(c.updatePersistedJob(a));case 10:g.next=15;break;case 12:g.next=14;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 14:j["delete"](a.jobId);case 15:case"end":return g.stop()}},null,this)},function(e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:d("WALogger").ERROR(u(),a.type,e).sendLogs("job-threw-exception-"+a.type);f=q.find(function(b){return b.stepName===a.step});if(f){h.next=6;break}d("WALogger").ERROR(t(),a.type,a.step);h.next=10;break;case 6:g=f.info(a.current,a.original,U(a,i.isRestartAfterCrash));if(!(g.stopRetryIf!=null)){h.next=10;break}h.next=10;return b("regeneratorRuntime").awrap(g.stopRetryIf.onStopRetry(a.current,a.original,U(a,i.isRestartAfterCrash)));case 10:h.next=12;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 12:j["delete"](a.jobId);case 13:case"end":return h.stop()}},null,this)});try{n(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(s(),a.type,b).sendLogs("onJobStarted-threw")}return P.abrupt("return",O.then(function(){return M}));case 58:case"end":return P.stop()}},null,this)};e.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(r(),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(q(),a);c.set(a,b)};e.fireAndForget=function(a){var c=this;if(this.$1.indexOf(a.type)===-1){d("WALogger").LOG(p(),a.type);this.fireAndForgetNonPersisted(a);return}d("WALogger").LOG(o(),a.type);O({code:function(d){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:e={eventFlow:d};f.next=3;return b("regeneratorRuntime").awrap(c.initialJobsPromise);case 3:d.addPoint("initial_jobs_promise_fulfilled");return f.abrupt("return",c.$6(a,c.accessors,e).then(function(a){return c.$4(a,c.accessors,e)}));case 5:case"end":return f.stop()}},null,this)},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};e.waitUntilPersisted=function(a){var c=this,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!(this.$1.indexOf(a.type)===-1)){f.next=4;break}d("WALogger").LOG(n(),a.type);this.fireAndForgetNonPersisted(a);return f.abrupt("return",(h||(h=b("Promise"))).resolve());case 4:d("WALogger").LOG(m(),a.type);e=P({string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}});f.next=8;return b("regeneratorRuntime").awrap(this.initialJobsPromise);case 8:e.addPoint("initial_jobs_promise_fulfilled");return f.abrupt("return",this.$6(a,this.accessors,{eventFlow:e}).then(function(a){O({code:function(b){b={eventFlow:b};return c.$4(a,c.accessors,b)},eventFlow:e})})["catch"](function(a){e.endFail("error",{string:{error:""+a}});throw a}));case 10:case"end":return f.stop()}},null,this)};e.waitUntilCompleted=function(a){var c=this;if(this.$1.indexOf(a.type)===-1){d("WALogger").LOG(l(),a.type);return this.waitUntilCompletedNonPersisted(a)}d("WALogger").LOG(k(),a.type);return O({code:function(d){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:e={eventFlow:d};f.next=3;return b("regeneratorRuntime").awrap(c.initialJobsPromise);case 3:d.addPoint("initial_jobs_promise_fulfilled");return f.abrupt("return",c.$6(a,c.accessors,e).then(function(a){return c.$4(a,c.accessors,e)}));case 5:case"end":return f.stop()}},null,this)},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};e.fireAndForgetNonPersisted=function(a){var c=this;O({code:function(d){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:e={eventFlow:d};f.next=3;return b("regeneratorRuntime").awrap(c.initialJobsPromise);case 3:d.addPoint("initial_jobs_promise_fulfilled");return f.abrupt("return",c.$6(a,c.inMemoryAccessors,e).then(function(a){return c.$4(a,c.inMemoryAccessors,e)}));case 5:case"end":return f.stop()}},null,this)},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};e.waitUntilCompletedNonPersisted=function(a){var c=this;return O({code:function(d){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:e={eventFlow:d};f.next=3;return b("regeneratorRuntime").awrap(c.initialJobsPromise);case 3:d.addPoint("initial_jobs_promise_fulfilled");return f.abrupt("return",c.$6(a,c.inMemoryAccessors,e).then(function(a){return c.$4(a,c.inMemoryAccessors,e)}));case 5:case"end":return f.stop()}},null,this)},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};return a}();function Q(a){return"Job["+a.jobId+"] ("+a.type+")"}function R(a){return"[Job "+a.type+"] "}function S(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function T(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(j(),S(c),b):a==="unsatisfied"?d("WALogger").LOG(i(),S(c),b):a}function U(a,b,c){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:V,eventFlow:c}}function V(a){return new(d("WAPersistedJobManager").InterruptJob)(a)}g.PersistedJobManager=a}),98);
__d("WAWaitForComms",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){return h.promise}function b(){h.resolve()}function c(){return!h.resolveWasCalled()}g.waitForComms=a;g.unblockComms=b;g.isStillWaitingForComms=c}),98);
__d("MAWJobManager",["MAWBridge","MAWDefinePersistedJob","MAWJobPersistenceAccessorsApi","WAPersistedJobManagerV2","WAWaitForComms","WAWaitForUser"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAPersistedJobManagerV2").PersistedJobManager)({accessors:d("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors(),deprecatedJobs:{removeCurrentDevice:"NOOP"},ignoreForceNonPersistedJobList:["sendMsg","sendReactionMsg","sendMediaMsg","sendWrittenMsg","linkReactionsToMsgs","downloadAndHandleMedia"],isRestartAfterCrash:!1,listeners:{onJobFinished:function(a,b,c,e){d("MAWBridge").getBridge().fireAndForget("event","onJobFinished",{id:a,originalArgs:c,result:e,type:b},!0);return null},onJobStarted:function(){}},offlineQueueCompletePromise:d("WAWaitForUser").waitForUserUnblocked(),unfinishedJobEntries:d("WAWaitForComms").waitForComms().then(function(){return d("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors().loadAllJobs()})});function a(){return d("MAWDefinePersistedJob").persistedJobsApi}function b(){return h}g.getPersistedJobsApi=a;g.getJobManager=b}),98);
__d("WAJobBuilder",["Promise","WAPersistedJobManager","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(a){this.steps=a}var b=a.prototype;b.step=function(a,b){return this.$1(a,typeof b==="function"?{code:b}:b)};b.$1=function(b,c){var e=c.stopRetryIf,f=c.requirements;c=c.code;f=k(f,c,e);if(e){var g=e.timePassedSeconds;c=e.appCrashed;var h=e.onStopRetry;h=k(null,l(h),e);g!=null&&(f=j(function(a,b,c){a=c.jobStartTime;return d("WATimeUtils").happenedWithin(a,g)},f,h));c&&(f=j(function(a,b,c){a=c.afterCrash;return!a},f,h))}return new a([].concat(this.steps,[{stepName:b,info:f}]))};b.finalStep=function(a,b){var c=this.step(a,b);return{end:function(){return c.steps}}};return a}();function a(){return new i([])}function j(a,b,c){return function(d,e,f){return a(d,e,f)?b(d,e,f):c(d,e,f)}}function k(a,b,c){var d={requirements:a,code:b,stopRetryIf:c};return function(){return d}}function l(a){return function(c,e,f){return(h||(h=b("Promise"))).resolve(a(c,e,f)).then(function(a){return a instanceof d("WAPersistedJobManager").InterruptJob?a:new(d("WAPersistedJobManager").InterruptJob)(a)})}}g.JobBuilder=i;g.definePersistedJob=a}),98);
__d("MAWDefinePersistedJob",["MAWJobManager","Promise","WAJobBuilder"],(function(a,b,c,d,e,f,g){"use strict";var h;e={definePersistedJob:function(){return d("WAJobBuilder").definePersistedJob()}};function a(a){var c=d("MAWJobManager").getJobManager();Object.keys(a).forEach(function(d){var e=a[d];c.addPersistedJobImplementation(d,function(){return(h||(h=b("Promise"))).resolve(e)})})}function c(a){var b=d("MAWJobManager").getJobManager();Object.keys(a).forEach(function(c){var d=a[c];b.addPersistedJobImplementation(c,d)})}g.persistedJobsApi=e;g.setMsgrJobImplementations=a;g.setMsgrDeferredJobImplementations=c}),98);
__d("MAWUploadMessagesBackup",["$InternalEnum","EchoBackupCompareUtils","EchoMessage","LSDataTraceCheckPoint","LSDataTraceType","LSEBPayloadSerializerError","LSIntEnum","LSMEBTaskCreationSource","MAWBridge","MAWBridgeEventTransmitter","MAWBridgeTrace","MAWBridgeUpload","MAWConstants","MAWDbMsg","MAWDbMsgTxns","MAWDbMsgUtil","MAWDbPendingStanza","MAWDbThreadTxns","MAWDbXMA","MAWDexieTable","MAWEBBackendQPLUtils","MAWEBSwitch","MAWEBUploadMessageUtils","MAWEBUploadTrackingUtils","MAWEncryptedBackupCacheManager","MAWHMACKey","MAWHandlePendingStanzasInRestoreV2","MAWIndexedDb","MAWJobManager","MAWMsgType","MAWQplProxy","MAWTraceUtils","MAWTransactionMode","Promise","WAGlobals","WAJids","WALogger","WAMediaUtils","WAProtocolMsgId","WAStanzaUtils","WATimeUtils","asyncToGeneratorRuntime","cr:5916","gkx","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot proceed with encodeAndSendEchoMessage: Encrypted Backups are not enabled"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot proceed with encodeAndSendEchoMessage: Encrypted Backups are not enabled"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Duplicated upload stopped by cache, extId: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJid is null for pendingStanza"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] externalId is null for pendingStanza"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] pendingStanzaMessageType: "," not supported"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unhandled error in uploadMessagesBackup job: ",""]);u=function(){return a};return a}var v=c("requireDeferred")("EchoSerializationFailureFalcoEvent").__setRef("MAWUploadMessagesBackup"),w=c("requireDeferred")("EchoSerializationSuccessFalcoEvent").__setRef("MAWUploadMessagesBackup"),x=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("echoSerialization",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.messageIds,c=a.oldTraceIdMap,e=a.pendingStanzaIds,f=a.reactionIds,g=a.uploadTrackingInstanceMap;a=a.xmaIds;try{a=d("MAWDbXMA").convertNumbersToXMAIds(a);e=(e=e)!=null?e:[];yield z(b,e,f,a,c,g)}catch(a){d("WALogger").ERROR(u(),a)}});return function(b){return a.apply(this,arguments)}}()).end();function a(a){return a==null?[]:a.filter(Boolean).map(function(a){if(a!=null)return d("MAWDbMsg").toMsgId(a)}).filter(Boolean)}var y=b("$InternalEnum").Mirrored(["FATAL","WARN"]);function z(a,b,c,d,e,f){a=E(a,b,c,d).then(function(a){return Q(a,void 0,!1,e,f)});return a.then(function(){})}function A(a,b){return a.messages.bulkGet(b).then(function(a){return a.filter(Boolean)})}function B(a,b){return a.pendingStanzas.bulkGet(b).then(function(a){return a.filter(Boolean).map(function(a){var b=a.pendingContent.type;if(b==null||b!==d("MAWDbPendingStanza").PENDING_TYPE.REVOKED&&b!==d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME){d("WALogger").WARN(t(),b);return}b=a.pendingContent.content.externalId;if(b==null){d("WALogger").WARN(s());return}b=a.pendingContent.content.threadJid;if(b==null){d("WALogger").WARN(r());return}d("MAWHandlePendingStanzasInRestoreV2").issuePointQueryForPendingStanza(a)})}).then(function(a){return[]})}function C(a,b){return a.reactions.bulkGet(b).then(function(b){b=b.filter(Boolean).map(function(b){return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(e){var f=e.success?e.value:null;if(f!=null&&f.chatId!=null){e=b.reactToAuthor;e=e===d("WAGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:e;return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.reactToExternalId,f.jid,e).then(function(a){if(a==null&&!d("MAWEncryptedBackupCacheManager").peekRestoreCache(b.reactToExternalId)){var e=d("WAJids").threadIdForChatJid(f.jid);d("MAWEncryptedBackupCacheManager").addMsgEntryToReuploadCache(f.jid,b.reactToExternalId);d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(b.reactToExternalId,e,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,f.jid)}return a})}})});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})})}function D(a,b){b=b.filter(Boolean);return a.xma.bulkGet(b).then(function(b){b=b.map(function(a){return a==null?void 0:a.associatedMessageId}).filter(Boolean);return a.messages.where("msgId").anyOf(b).toArray()})}var E=d("MAWIndexedDb").makeMsgrTransactor({messages:(j=d("MAWTransactionMode")).READONLY,pendingStanzas:j.READONLY,reactions:j.READONLY,threads:j.READONLY,xma:j.READONLY},"uploadMsgBackupGetMsgs",function(a){return function(b,c,d,e){return S(a,b,c,d,e)}});function F(a,b,c){b.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(a.uploadTrackingInstanceKey,"fire_ui_event")}),G({tag:"UploadMessageByBatch",value:{checkPoint:a,messages:b,qpl:c}})}function G(a){a=[a];d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:a})}function H(a,b,e){var f=[],g=[];if(a!=null){var h=c("gkx")("23946"),j=c("qpl")._(521485625,"1876");b.forEach(function(b){var c=b.checkPoint;b=b.pointName;h&&b!=null&&f.push({action:{name:b,type:"point"},annotations:null,event:j,instanceKey:d("MAWEBBackendQPLUtils").getQplInstanceKey(a),timestamp:d("MAWQplProxy").performanceAbsoluteNow()});g.push(d("MAWBridgeTrace").createBridgeTraceRecordCheckpointData((i||(i=d("LSIntEnum"))).ofNumber(c),(b=e)!=null?b:a,void 0,!1,-1,void 0))})}return{checkPointArray:g,qplArray:f}}function I(a,b,c,e,f,g,h){var i=b.xOfflineThreadingId;if(i==null)return!1;var j=d("WAStanzaUtils").toStanzaId(i);if(d("MAWEncryptedBackupCacheManager").getRestoredCacheStatus(j)==="done"){var k=d("EchoBackupCompareUtils").buildEchoDocCacheValue(b);k=d("EchoBackupCompareUtils").echoEquals(k,d("MAWEncryptedBackupCacheManager").getRestoredCache(j));d("MAWEncryptedBackupCacheManager").removeFromRestoredCache(j);if(k){d("WALogger").LOG(q(),j);return!1}}if(c!=null&&e!=null){k=window.performance.now();var l=d("EchoMessage").encodeEchoMessage(b),m=window.performance.now();h=h==null?void 0:h.get(j);if(h==null&&b.mediaData!=null){j=b.mediaData.xAttachmentType;h={mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(b.mediaData.attachmentObjectId),mediaType:j}}a.push(d("MAWBridgeUpload").createBridgeUploadMessage({actionType:1,attachmentContext:h,authTs:c.serverTs,echoDocument:l,echoEncodingLatencyNs:(m-k)*1e6,errorCode:null,errorMessage:null,messageId:i,messageType:c.type,productType:"msgr",protoMsg:f,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(c),threadId:b.threadId,traceId:e,uploadTrackingInstanceKey:N(g,c.externalId)}));O("point",g,c.externalId,"construct_echo_success");K(c.externalId,e);return!0}return!1}function J(a,b){a!=null&&void v.load().then(function(c){return c.log(function(){return{message_id:a,trace_id:b}})})}function K(a,b){a!=null&&void w.load().then(function(c){return c.log(function(){return{message_id:a,trace_id:b}})})}function L(a,b,c){if(a==null||b==null)return c;else{b=N(b,a.externalId);if(b!=null)return b.toString();else return c}}function M(a,b,e,f){var g=new Map();a.forEach(function(a){return g.set(a.dbMsg.externalId,a)});return R(a).then(function(a){var h=[],j=[],k=[];a.forEach(function(a){var l,m=g.get(a.externalId)||{dbMsg:null,traceId:null},n=m.dbMsg;m=m.traceId;l=n!=null?(l=b==null?void 0:b.find(function(a){var b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(n);return b==null?!1:d("WAProtocolMsgId").equals(a.msgId,b)}))!=null?l:void 0:void 0;var o=a.echoMessage,q=[],r=L(n,e,m);if(a.maybeErrorDetail!=null){a=a.maybeErrorDetail;if(n!=null&&m!=null)if(a.uploadErrorType===y.WARN||a.errorCode===c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID){var s;s=a.uploadErrorType===y.WARN?"possible error when constructing echo message: "+((s=a.errorMsg)!=null?s:""):"media info invalid thrown from constructEchoMessage, error msg: "+((s=a.errorMsg)!=null?s:"");d("WALogger").WARN(p(),s);O("success",e,n.externalId,"construct_echo_success_media/xma_warn/error",{string:{errorMsg:s}});J(n.externalId,m)}else{h.push(d("MAWBridgeUpload").createBridgeUploadMessage({actionType:1,authTs:n.serverTs,echoDocument:null,echoEncodingLatencyNs:null,errorCode:a.errorCode,errorMessage:a.errorMsg,messageId:(s=o==null?void 0:o.xOfflineThreadingId)!=null?s:"0",messageType:n.type,protoMsg:l,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(n),threadId:(s=o==null?void 0:o.threadId)!=null?s:"0",traceId:m,uploadTrackingInstanceKey:N(e,n.externalId)}));O("fail",e,n.externalId,"construct_echo_failed",{string:{errorMsg:(s=a.errorMsg)!=null?s:"null error msg, msg type: "+n.type}});K(n.externalId,m)}return}if((o==null?void 0:o.xOfflineThreadingId)==null){if(n!=null&&m!=null){h.push(d("MAWBridgeUpload").createBridgeUploadMessage({actionType:1,authTs:n.serverTs,echoDocument:null,echoEncodingLatencyNs:null,errorCode:c("LSEBPayloadSerializerError").OTID_NOT_FOUND_IN_ACT_MESSAGES,errorMessage:null,messageId:"0",messageType:n.type,protoMsg:l,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(n),threadId:(a=o==null?void 0:o.threadId)!=null?a:"0",traceId:m,uploadTrackingInstanceKey:N(e,n.externalId)}));O("fail",e,n.externalId,"construct_echo_failed",{string:{errorMsg:"oitd not found"}});K(n.externalId,m)}}else{s=I(h,o,n,m,l,e,f);if(!s){n!=null&&O("success",e,n.externalId,"construct_echo_success_duplicate_message",{string:{errorMsg:"not unique from cache"}});return}}q.push({checkPoint:c("LSDataTraceCheckPoint").LABYRINTH_WEB_UPLOAD_ISSUE_MESSAGE_UPLOAD_UI_EVENT,pointName:"issue_message_upload_ui_event"});a=H(m,q,r);o=a.checkPointArray;l=a.qplArray;j.push.apply(j,l);k.push.apply(k,o);d("MAWTraceUtils").startNewTrace((i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_UPLOAD),d("MAWTraceUtils").CONTEXT_BACKUP_UPLOAD,r);(h.length>=d("MAWConstants").BRIDGE_UPLOAD_BATCH_SIZE||k.length>=d("MAWConstants").BRIDGE_UPLOAD_BATCH_SIZE)&&(F(k.slice(),h.slice(),j.slice()),k.length=0,h.length=0,j.length=0)});(h.length>0||k.length>0)&&F(k,h,j);return a})}function N(a,b){return a.get(b)}function O(a,b,c,e,f){b=N(b,c);if(b!=null)switch(a){case"success":d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(b,e,f);break;case"fail":d("MAWEBUploadTrackingUtils").endFailWorkerOnly(b,e,f);break;case"point":d("MAWEBUploadTrackingUtils").addPointWorkerOnly(b,e,f);break}}function P(a){var b=new Set(),c=[];a.forEach(function(a){var e=a.externalId+"|"+d("WAJids").threadIdForChatJid(a.threadJid)+"|"+a.author;d("MAWEncryptedBackupCacheManager").getRestoredCacheStatus(a.externalId)!=="restoring"&&!b.has(e)&&(b.add(e),c.push(a))});return c}function Q(a,e,f,g,i,j){if(!c("MAWEBSwitch").isEnabled()){d("WALogger").LOG(o());i.forEach(function(a,b){d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(a,"upload_tracking_cancelled_eb_turned_off_upload",{string:{externalId:b,from:"uploadUniqueMessage"}})});return(h||(h=b("Promise"))).resolve()}a=P(a).filter(function(a){return d("MAWEBUploadTrackingUtils").isUploadSupported(a)}).map(function(a){var b;b=(b=f)!=null?b:!1;b={bool:{isMedia:d("MAWMsgType").isMAWSupportedMediaType(a.type),isRetroactiveBackupsUpload:b},string:{msgType:a.type}};O("point",i,a.externalId,"construct_echo_start",b);b=((b=N(i,a.externalId))!=null?b:d("MAWTraceUtils").createTraceId()).toString();d("MAWEBBackendQPLUtils").startEBBackupUploadQplUserFlow(f,b);f!=null&&f&&d("MAWEBBackendQPLUtils").addPointEBBackupUpload(b,"retroactive_backup_upload_started");return{lastRetryTs:d("WATimeUtils").millisTime(),msg:a,retriedTimes:0,traceId:b}});return T(a.map(function(a){var b=a.msg.quoteExternalId;if(b!=null)return{dbMsg:a.msg,quotedMsg:e==null?void 0:e.get(b),traceId:a.traceId};else return{dbMsg:a.msg,traceId:a.traceId}}),g,j,i).then(function(){return(h||(h=b("Promise"))).resolve()})}function e(a,e,f,g){if(!c("MAWEBSwitch").isEnabled()){d("WALogger").LOG(n());e.forEach(function(a,b){d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(a,"upload_tracking_cancelled_eb_turned_off_upload",{string:{externalId:b,from:"uploadMessageFromUploadQueue"}})});return(h||(h=b("Promise"))).resolve()}return T(a.filter(function(a){var b=d("MAWEBUploadTrackingUtils").isUploadSupported(a);b||O("success",e,a.externalId,"upload_not_supported",{string:{msgType:a.type}});return b}).map(function(a){var b;b=((b=N(e,a.externalId))!=null?b:d("MAWTraceUtils").createTraceId()).toString();O("point",e,a.externalId,"construct_echo_start");return{dbMsg:a,traceId:b}}),void 0,f,e,g).then(function(){return(h||(h=b("Promise"))).resolve()})}var R=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:j.READONLY,media:j.READONLY,mediaBackup:j.READONLY,messages:j.READONLY,reactions:j.READONLY,threads:j.READONLY,xma:j.READONLY},"constructEchoMessage",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b("cr:5916").constructEchoMessage.apply(b("cr:5916"),[a].concat(d))}});function S(a,b,e,f,g){b=A(a,b);c("gkx")("2251")?B(a,e):d("MAWDexieTable").dexieResolve();e=C(a,f);f=D(a,g);return d("MAWDexieTable").dexieAll([b,e,f]).then(function(a){return a.flat()})}function T(a,e,f,g,j){var n=new Map();a.forEach(function(a){var b=a.dbMsg;a=a.traceId;d("MAWEBBackendQPLUtils").addPointEBBackupUpload(a,"echo_message_upload_begin",{string:{message_type:b.type}});var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521475102,"868"),{bool:{eb_switch:c("MAWEBSwitch").isEnabled()},"int":{sort_order:b.sortOrderMs,timestamp:Date.now()},string:{hashed_msgid:U(b.externalId),message_id:b.externalId,message_type:b.type.toString(),org_trace_id:e==null?void 0:e.get(b.externalId),trace_id:a}});n.set(b.externalId,{constructEchoFlow:f,traceId:a})});a=M(a,f,g,j)["catch"](function(a){a="[labyrinth_web] Error while encode and upload message to backup: "+String(a);d("WALogger").ERROR(m(),a);for(var e of n.values())d("MAWEBBackendQPLUtils").endFailEBBackupUpload(e.traceId,"echo_message_upload_failure",{string:{error_message:a}}),d("MAWTraceUtils").recordFailureAndFlushForTraceId(e.traceId,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_FAILURE),[],a),e.constructEchoFlow.endFail("serialisation_failure");return(h||(h=b("Promise"))).resolve()});return a.then(function(a){a==null?void 0:a.forEach(function(a){var b;b=(b=a.echoMessage)==null?void 0:b.messageId;if(b!=null&&n.has(d("WAStanzaUtils").toStanzaId(b))){var e;b=n.get(d("WAStanzaUtils").toStanzaId(b))||{constructEchoFlow:null,traceId:null};var f=b.constructEchoFlow;b=b.traceId;e=a==null?void 0:(e=a.maybeErrorDetail)==null?void 0:e.uploadErrorType;a=a==null?void 0:(a=a.maybeErrorDetail)==null?void 0:a.errorMsg;if(e!=null)switch(e){case y.WARN:a!=null&&d("WALogger").WARN(l(),a);f==null?void 0:f.endSuccess({bool:{is_skipped:!0}});b!=null&&(d("MAWEBBackendQPLUtils").addPointEBBackupUpload(b,"echo_message_upload_invalid_request"),d("MAWTraceUtils").recordInvalidUploadRequestAndFlushTrace(b,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_INVALID_REQUEST),[]));break;case y.FATAL:a=(e=a)!=null?e:"[labyrinth_web] unknown error in the upload message flow";d("WALogger").ERROR(k(),a);b!=null&&(d("MAWEBBackendQPLUtils").endFailEBBackupUpload(b,"echo_message_upload_failure",{string:{error_message:a}}),d("MAWTraceUtils").recordFailureAndFlushForTraceId(b,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_FAILURE),[],a));f==null?void 0:f.endFail("serialisation_failure");break}else f==null?void 0:f.endSuccess()}});return(h||(h=b("Promise"))).resolve()})}function U(a){if(a==null)return"";var b=d("WAGlobals").getHMACKey();return d("MAWHMACKey").hmacTweetNaCl(a,b)}function f(a,b){var e=d("MAWTraceUtils").startNewTrace((i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_UPLOAD),d("MAWTraceUtils").CONTEXT_BACKUP_UPLOAD);d("MAWTraceUtils").recordCheckpointForTrace(e,i.ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_BEGIN),[d("MAWTraceUtils").getTagForMsgType(a.type)],!1);d("MAWIndexedDb").afterTransaction({tag:"UploadMessage",value:d("MAWBridgeUpload").createBridgeUploadMessage({actionType:2,authTs:a.serverTs,echoDocument:null,echoEncodingLatencyNs:null,errorCode:null,errorMessage:null,messageId:a.externalId,messageType:a.type,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(a),threadId:d("WAJids").threadIdForChatJid(b),traceId:e,uploadTrackingInstanceKey:null})})}g.uploadMessagesBackup=x;g.convertStringMsgIdtoMsgId=a;g.UploadErrorType=y;g.deduplicateMessageArray=P;g.uploadUniqueMessage=Q;g.uploadMessageFromUploadQueue=e;g.getMessagesBackupForUpload=S;g.sendDeleteEchoMessage=f}),98);
__d("MAWReStoreDb",["MAWIndexedDb","MAWReStoreDbSetup","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){if(c("gkx")("3577"))return d("MAWReStoreDbSetup").getDB();h==null&&(d("MAWIndexedDb").willSetupDB()?h=d("MAWIndexedDb").getDB().then(function(){return d("MAWReStoreDbSetup").getDB()}):h=d("MAWReStoreDbSetup").getDB());return h}g.getDB=a}),98);
__d("MAWReStoreTiming",["FBLogger","MAWErrorObject","MAWIndexedDb","MAWLLAMigrationUtils","MAWQplProxy","MAWReStoreDb","MAWRestoreDbState","asyncToGeneratorRuntime","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=["MWPTransactor"];function i(a){a=d("MAWLLAMigrationUtils").getTransactorQPLParam(a);a=a.length===2?a:[null,void 0];var b=a[0];a=a[1];return b!=null?d("MAWQplProxy").startQplUserFlow(b,a,void 0,d("MAWLLAMigrationUtils").QPL_TRANSACTION_TIMEOUT_MS):null}var j=c("FBLogger")("messenger_e2ee_web");function k(a){if(a)return j.catching(a);else return j}function l(a,c){return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("MAWReStoreDb").getDB()),e=i(a),f;try{e==null?void 0:e.addPoint("transactor_execution_start");for(var g=arguments.length,j=new Array(g),l=0;l<g;l++)j[l]=arguments[l];f=(yield c.apply(void 0,[b].concat(j)));e==null?void 0:e.addPoint("transactor_execution_end");e==null?void 0:e.endSuccess()}catch(b){var m;e==null?void 0:e.endFail("transaction_fail");var n=d("MAWErrorObject").getErrorObject(b);throw k(n).mustfixThrow("[%s] Error performing %s transaction",h.join("|"),(m=a)!=null?m:"")}return f})}function a(a,b,e,f){return function(){for(var g=arguments.length,h=new Array(g),i=0;i<g;i++)h[i]=arguments[i];return!c("qex")._("1016")?d("MAWIndexedDb").makeMsgrTransactor(e,a,f).apply(void 0,h):d("MAWRestoreDbState").isUsingShim().then(function(c){return c?l(a,b).apply(void 0,h):d("MAWIndexedDb").makeMsgrTransactor(e,a,f).apply(void 0,h)})}}g.makeShimTransactor=a}),98);
__d("MAWHandlePendingStanzasInRestoreV2",["I64","LSMEBTaskCreationSource","MAWBridgeEventTransmitter","MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDexieTable","MAWEBUploadTrackingUtils","MAWEncryptedBackupCacheManager","MAWIndexedDb","MAWReStoreTiming","MAWTransactionMode","MAWUploadMessagesBackup","MAWWriteRevokeMessageTxns","Promise","ReQL","WAJids","WALogger","cr:553","cr:7702","cr:8066","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] pendingStanza type "," is not supported"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] revokedExternalId is null for pendingStanza"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] revokedExternalId is null for pendingStanza"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJid is null for pendingStanza"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] pendingStanzaTs is null for pendingStanza"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] revokedExternalId is null for pendingStanza"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] externalId is null for pendingStanza"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Could not find thread for chatId "," for pendingStanza"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Delete For Me pending stanza does not need to be applied."]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread is null"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] pendingStanza type "," is not supported"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Pending Stanza not found in the cache. This shouldn't happen."]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] externalId is null for pendingStanza"]);v=function(){return a};return a}var w=(a=(e=(a=b("cr:553"))==null?void 0:a.structuredClone)!=null?e:(f=b("cr:7702"))==null?void 0:f.structuredClone)!=null?a:(e=b("cr:8066"))==null?void 0:e.structuredClone;f=function(a,c,d){a=a.restoredMsgsData;if(a){var e=a.newlyAddedMsgs;e=e.concat(a.existingMsgs);return x(e,c,d)}return(i||(i=b("Promise"))).resolve()};var x=function(a,e,f){f==null?void 0:f.addPoint("apply_pending_stanza_start");var g=0,h=0,j=0,k=0,l=new Map();return F().then(function(a){a==null?void 0:a.map(function(a){var b=a.pendingContent.content.externalId;if(b==null){d("WALogger").WARN(v());return}l.set(a.externalIdWithType,a)}),k=l.size}).then(function(){var b=new Set();return B(a).then(function(f){return d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.externalId;if(e)if(d("MAWEncryptedBackupCacheManager").peekPendingStanzaCache(c)){var i=d("MAWEncryptedBackupCacheManager").getPendingStanzaCacheValue(c);if(i==null){d("WALogger").ERROR(u());return}return A(i,a,f,e).then(function(a){a!=null&&b.add(i);d("MAWEncryptedBackupCacheManager").removePendingStanzaCacheValue(c);l["delete"](i.externalIdWithType);a=i.pendingContent.type;a===d("MAWDbPendingStanza").PENDING_TYPE.REVOKED&&g++;h++})}else l.clear();else{var k=c+"_"+d("MAWDbPendingStanza").PENDING_REVOKED,m=l.get(k);if(m!=null)return A(m,a,f,e).then(function(a){a!=null&&(b.add(m),g++,j++),l["delete"](m.externalIdWithType)})}})).then(function(){if(!e){var a=y(l);g+=a[1];h+=a[0]+a[1];c("promiseDone")(z(Array.from(b)))}})})}).then(function(a){f==null?void 0:f.addPoint("apply_pending_stanza_end",{"int":{initialRestorePendingStanzaCount:j,pendingStanzasToBeUploadedCount:k,pointRestorePendingStanzaCount:h,revokedCount:g}});return(i||(i=b("Promise"))).resolve()})},y=function(a){var b=0,c=0;a.forEach(function(a){var e=a.pendingContent.type;e===d("MAWDbPendingStanza").PENDING_TYPE.REVOKED?c++:e===d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME&&b++;E(a)});a.clear();return[b,c]},z=d("MAWIndexedDb").makeMsgrTransactor({pendingStanzas:d("MAWTransactionMode").READWRITE},"deletePendingStanzasFromIndexedDB",function(a){return function(b){return d("MAWDbPendingStanzaTxns").deletePendingStanzas(a,b)}}),A=function(a,e,f,g){var h=a.pendingContent.type;if(h===d("MAWDbPendingStanza").PENDING_TYPE.REVOKED)return D(a,e,f,g).then(function(a){if(a!=null){var b=d("MAWEBUploadTrackingUtils").genInstanceKeyOnly();d("MAWEBUploadTrackingUtils").startUploadTracking(a.externalId,a.type,"pendingstanza",b);c("promiseDone")(d("MAWUploadMessagesBackup").uploadUniqueMessage([a],void 0,!1,void 0,new Map([[a.externalId,b]])))}});else if(h===d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME)return C(a);else{d("WALogger").WARN(t(),h);return(i||(i=b("Promise"))).resolve()}},B=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"getThreadsForMessages",function(a){return function(b){var c=[];b.forEach(function(a){c.push(a.threadJid)});return a.threads.where("jid").anyOf(c).toArray().then(function(a){var b=new Map();a.forEach(function(a){if(a==null){d("WALogger").WARN(s());return d("MAWDexieTable").dexieResolve()}b.set(a.jid,a)});return b})}}),C=d("MAWIndexedDb").makeMsgrTransactor({pendingStanzas:d("MAWTransactionMode").READWRITE},"deleteForMeMsg",function(a){return function(b){d("WALogger").LOG(r());return d("MAWDexieTable").dexieAll([a.pendingStanzas["delete"](b.rowId)]).then(function(){return d("MAWDexieTable").dexieResolve(b)})}}),D=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,deletedMessages:d("MAWTransactionMode").READWRITE,ftsPurgeBacklog:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY},"revokeMessage",function(a){return function(b,c,e,f){e=e.get(c.threadJid);if(e==null){d("WALogger").ERROR(q(),c.threadJid);return d("MAWDexieTable").dexieResolve()}var g=b.pendingContent.content.externalId;if(g==null){d("WALogger").ERROR(p());return d("MAWDexieTable").dexieResolve()}var h=b.pendingContent.content.revokedExternalId;if(h==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve()}var i=b.pendingContent.content.ts;if(i==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve()}return d("MAWWriteRevokeMessageTxns").revokeUnstoredMsg(a,c,e,g,h,c.serverTs,c.ts,f).then(function(c){a.pendingStanzas["delete"](b.rowId);return d("MAWDexieTable").dexieResolve(c)})}});function E(a){var b=a.pendingContent.content.threadJid;if(b==null){d("WALogger").WARN(m());return}var e=d("WAJids").threadIdForChatJid(b),f=a.pendingContent.type;if(f===d("MAWDbPendingStanza").PENDING_TYPE.REVOKED){var g=a.pendingContent.content.revokedExternalId;if(g==null){d("WALogger").WARN(l());return}g=g}else if(f===d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME){var h=a.pendingContent.content.externalId;if(h==null){d("WALogger").WARN(k());return}g=h}else{d("WALogger").WARN(j(),f);return}d("MAWEncryptedBackupCacheManager").addPendingStanzaToPendingStanzaCache(g,a);d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(g,e,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,b)}var F=d("MAWReStoreTiming").makeShimTransactor("getAllPendingStanzas",function(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.e2ee_pendingStanzas).map(function(a){a=c("nullthrows")(w)(a);return babelHelpers["extends"]({},a,{rowId:(h||(h=d("I64"))).to_float(a.rowId)})}))},{pendingStanzas:d("MAWTransactionMode").READONLY},function(a){return function(){return d("MAWDbPendingStanzaTxns").getAllPendingStanzas(a)}});g.applyPendingStanzas=f;g.issuePointQueryForPendingStanza=E}),98);
__d("MAWWriteMsgTxns",["I64","MAWAfterWriteMsgUtil","MAWBridgeMsg","MAWBridgeTypesCreators","MAWBuildIncomingMsgs","MAWCalculateBumpTimestampMs","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanzaTxns","MAWDbReactionsTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDeleteForMeMsgContentCleaner","MAWDeleteThreadUtil","MAWDexieTable","MAWEBUploadMessageUtils","MAWEphemeralMsgTxns","MAWFTSTxns","MAWFolderTypes","MAWGetMsgQuoteTxn","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWLocalizationUtils","MAWMessageHasUniqueExternalIdValidator","MAWMsgType","MAWThreadEvent","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTimeUtils","MAWUpdateQuotedMsgTxns","MAWWriteMsgSideEffectTxns","MAWWriteRevokeMessageTxns","WAJids","WALogger","WATimeUtils","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle"," Msg: Message from ",", chat ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeMsgAfterTransaction - sortOrderMs: ",""]);j=function(){return a};return a}function k(a,b,e,f){var g=e.ts;g=[d("WATimeUtils").castUnixTimeToMillisTime(g),e.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN];var h=g[0],i=g[1];return d("MAWGetOrCreateThreadTxns").getExistingThread(a,b.jid).then(function(b){if(b==null)throw c("err")("at this point there's always a thread - checking for updates");var g=d("MAWDbMsgTxns").getThreadOldestMessageBySortOrder(a,b.jid),j=d("MAWDbMsgTxns").getThreadNewestMessageBySortOrderOrCache(a,b,"defer_to_qe");return d("MAWDexieTable").dexieAll([g,j]).then(function(c){var g,j,k=c[0];c=c[1];var l=c==null?1:d("MAWDbMsg").getInChatMsgIdFromMsgId(c.msgId)+1;g=d("WATimeUtils").castToMillisTime((g=c==null?void 0:c.sortOrderMs)!=null?g:0);var m=h>g&&!i?h:g;g=(g=d("MAWTimeUtils").ensureValidMillisTime(b.lastReadMsgTs))!=null?g:0;j=d("WATimeUtils").castToMillisTime((j=c==null?void 0:c.sortOrderMs)!=null?j:0);g=g<j;var n=e.author===d("WAJids").AUTHOR_ME||e.type===d("MAWMsgType").MSG_TYPE.ADMIN&&d("MAWLocalizationUtils").isParticipantChangeAdminMsg(e.msgContent.adminType)&&!g,o=babelHelpers["extends"]({},e,{msgId:d("MAWDbMsg").craftMsgIdV2(b.chatId,l,e)}),p=d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(e);g=p>((j=b.snippetMsgTs)!=null?j:0);var q=!d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(o)&&g;l=d("MAWDbMsgTxns").calculateOldestAndNewestMsg(k,c,o,f);var r=l.newestMsg,s=l.oldestMsg;j=q?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,o):d("MAWDexieTable").dexieResolve(null);return j.then(function(a){return{isOldestMsgUpdated:k!=null&&s!==k.msgId,msgId:o.msgId,prevOldestMsg:k,updatedSnippet:a,updatedThread:babelHelpers["extends"]({},b,{lastReadMsg:n?o.msgId:b.lastReadMsg,lastReadMsgTs:n?m:b.lastReadMsgTs,newestMsg:r,newestMsgTs:m,oldestMsg:s,snippetMsg:q?o.msgId:b.snippetMsg,snippetMsgTs:q?d("WATimeUtils").castToMillisTime(p):b.snippetMsgTs,threadOrder:d("MAWDbThread").craftThreadOrder(m,b.jid)})}})})})}function l(a,b,c,e,f,g,h,i){e===void 0&&(e={});e=e;var l=e.isFirstMsg,m=l===void 0?!1:l;l=e.isIncoming;var n=l===void 0?!1:l;l=e.isOutgoing;var o=l===void 0?!1:l,p=e.openMessageOtid,q=e.openMessageParticipantCount,r=e.optimisticMsg,s=e.participantCount,t=e.quotedReplyAttachmentMeta;l=e.skipLocalThreadBump;var u=l===void 0?!1:l;l=e.sortOrderMs;return k(a,c,b,l).then(function(c){var e=c.isOldestMsgUpdated,k=c.msgId,l=c.prevOldestMsg,v=c.updatedSnippet,w=c.updatedThread,x=babelHelpers["extends"]({},b,{msgId:k,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(b)});if(h!=null&&h){d("MAWMessageHasUniqueExternalIdValidator").logMessageAddSource([x.externalId],"MAWWriteMsgTxns::writeMsg isPointRestoreForEB");return a.messages.add(x).then(function(a){return babelHelpers["extends"]({},x,{rowId:a})})}d("MAWMessageHasUniqueExternalIdValidator").logMessageAddSource([x.externalId],"MAWWriteMsgTxns::writeMsg");return d("MAWDexieTable").dexieAll([a.messages.add(x).then(function(a){return babelHelpers["extends"]({},x,{rowId:a})}),a.threads.put(w),d("MAWFTSTxns").maybePutMessageToBacklog(a,x.externalId)]).then(function(a){var b=a[0];a[1];o&&d("WALogger").LOG(j(),b.sortOrderMs);a=d("MAWAfterWriteMsgUtil").WriteMsgAfterTxnBumpThreadOption.BUMP_LOCAL_ONLY;n&&b.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&b.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&b.author!==d("WAJids").AUTHOR_ME?a=d("MAWAfterWriteMsgUtil").WriteMsgAfterTxnBumpThreadOption.BUMP_LOCAL_AND_SERVER:(o||u)&&(a=d("MAWAfterWriteMsgUtil").WriteMsgAfterTxnBumpThreadOption.DO_NOT_BUMP_THREAD);d("MAWAfterWriteMsgUtil").writeMsgAfterTransaction({bumpThreadOption:a,dbMsg:b,hasMoreAfter:g,hasMoreBefore:f,isFirstMsg:m,isOldestMsgUpdated:e,msgsLeftToRestoreForEB:i,openMessageOtid:p,openMessageParticipantCount:q,optimisticMsg:r,participantCount:s,prevOldestMsg:(l==null?void 0:l.msgId)==null?void 0:l.msgId,quotedReplyAttachmentMeta:t,snippet:v,updatedThread:w});return b})})}function m(a,b,e){return d("MAWGetOrCreateThreadTxns").getExistingThread(a,e.jid).then(function(e){if(e==null)throw c("err")("at this point there's always a thread - checking for updates");return d("MAWDbUnrenderedMsgTxns").getNextUnrenderedMsgIdNumberForThread(a,e).then(function(c){var f=babelHelpers["extends"]({},b,{msgId:d("MAWDbMsg").craftUnrenderedMsgId(e.chatId,c)});return d("MAWDexieTable").dexieAll([a.unrenderedMessages.add(f),a.threads.put(e)]).then(function(a){var b=a[0];a[1];return babelHelpers["extends"]({},f,{rowId:b})})})})}function a(a,b,c){return d("MAWDexieTable").dexieAll([n(a,b,c),d("MAWDbEditMsgHistoryTxns").getEditHistoryByOriginalMsgExternalIdAndThreadJid(a,[[b.externalId,c.jid]]).then(function(a){return{editMsgHistories:a,originalEditMsgHistory:a.find(function(a){return a.editExternalId===b.externalId})}})]).then(function(a){var b=a[0];a=a[1];var c=a.editMsgHistories;a=a.originalEditMsgHistory;return babelHelpers["extends"]({},b,{editMsgHistories:c,existingEditMsgHistory:(b=a)!=null?b:null})})}function n(a,b,c){c=[b.externalId,c.jid,b.author];var e=c[0],f=c[1];c=c[2];return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,e,f,c),d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,e,c,f),d("MAWDbPendingStanzaTxns").maybeGetPendingDeletedStanza(a,e,c,f),d("MAWDbMsgTxns").checkIfMsgIsDeletedForMeOrRevoked(a,e,f,c),d("MAWDbPendingStanzaTxns").maybeGetDeleteThreadFromPendingStanza(a,f).then(function(a){return d("MAWDeleteThreadUtil").isMsgDeletedViaDeleteThread(b.ts,a)})]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3];a=a[4];return{existingMsg:(b=b)!=null?b:null,isDeletedWithThread:a,isDeleteForMeOrRevoked:e,pendingDeleteForMeStanza:(b=d)!=null?b:null,pendingRevokedStanza:(a=c)!=null?a:null}})}function b(a,b,e){return d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,b.externalId,b.author,e.jid).then(function(f){if(f!=null)return o(a,b,e,f);f=b.author;d("WALogger").DEV(i(),b.type,f,e.jid);var g=babelHelpers["extends"]({},babelHelpers["extends"]({},b,{threadJid:e.jid}));e.folder===d("MAWFolderTypes").FOLDER_ID.OTHER&&(g.altIndex=g.altIndex===d("MAWDbMsg").FUTUREPROOF_ALT_INDEX?d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX:d("MAWDbMsg").SPAM_ALT_INDEX);return d("MAWGetMsgQuoteTxn").getMsgQuoteInfo(a,g,e.jid).then(function(b){b!=null&&(g=babelHelpers["extends"]({},g,{quote:b==null?void 0:b.quote,quoteExternalId:b==null?void 0:b.quoteExternalId}));return d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,e.jid,g),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,g),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,g)]).then(function(b){var f=b[0],i=b[1],j=b[2],k=c("gkx")("2131");b=k?l(a,g,e,{isIncoming:!0,quotedReplyAttachmentMeta:i}):l(a,g,e,{quotedReplyAttachmentMeta:i,skipLocalThreadBump:g.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&g.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&g.author!==d("WAJids").AUTHOR_ME});return b.then(function(b){!k&&g.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&g.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&g.author!==d("WAJids").AUTHOR_ME&&d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;var f=g.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(g.externalId):void 0;f=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(d("WATimeUtils").castUnixTimeToMillisTime(g.ts),f);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:f,description:"writeNewIncomingMsg-"+g.type,isMessageAuthorMe:!1,snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:e.jid})})});return d("MAWDexieTable").dexieAll([d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,g),d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,b)]).then(function(a){a=a[1];f!=null&&f.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,j)})});return a||b})})})})})}function e(a,b,c,e,f){var g=babelHelpers["extends"]({},babelHelpers["extends"]({},b,{msgId:c.msgId,rowId:c.rowId,serverTs:c.serverTs,sortOrderMs:c.sortOrderMs,threadJid:e.jid,ts:c.ts}));return d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,e.jid,g),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,g),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,g),d("MAWGetMsgQuoteTxn").getMsgQuoteInfo(a,g,e.jid),d("MAWDbMsgTxns").getThreadNewestMessageId(a,e)]).then(function(h){var i=h[0],j=h[1],k=h[2],l=h[3],m=h[4];g=babelHelpers["extends"]({},g,{quote:l==null?void 0:l.quote,quoteExternalId:l==null?void 0:l.quoteExternalId});return((h=c.editCount)!=null?h:0)>0&&f!=null&&b.type===d("MAWMsgType").MSG_TYPE.TEXT?d("MAWDbEditMsgHistoryTxns").updateEditMsgHistoryWithNewIncomingMsg(a,f,b).then(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:[babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:c.msgId})]});return c}):a.messages.put(g).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,g)}).then(function(b){if(b){g.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(e.chatId);return a.messages.put(g)}}).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g,void 0,k)});d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g,void 0,j)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:e.jid,msgId:g.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);i!=null&&i.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,k)})});if(g.msgId===m){var b=g;b.rowId;b=babelHelpers.objectWithoutPropertiesLoose(b,["rowId"]);return d("MAWDexieTable").dexieAll([d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,g),d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,b)]).then(function(a){a=a[0];var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:e.jid})});return g})}return g})})}function f(a,b,c,e){var f=d("MAWBuildIncomingMsgs").buildUnstoredDeleteForMeMsg(b,c);return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:f.author,chatJid:f.threadJid,externalId:f.externalId}]),m(a,f,c),a.pendingStanzas["delete"](e.rowId),d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,b.externalId)]).then(function(a){a[0];a=a[1];d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(f.messageDeleteForMeTs);return babelHelpers["extends"]({},f,{msgId:a.msgId,rowId:a.rowId})})}function o(a,b,e,f){var g=d("MAWDbPendingStanzaTxns").getRevokedContent(f);if(g==null)throw c("err")("missing revoked content");b=d("MAWBuildIncomingMsgs").buildUnstoredRevokedMsg(b,e,g);return d("MAWDexieTable").dexieAll([l(a,b,e),a.pendingStanzas["delete"](f.rowId)]).then(function(b){var c=b[0];return d("MAWWriteRevokeMessageTxns").markIncomingMessageRevoked(a,c,e).then(function(){return c})})}g.writeMsg=l;g.writeUnrenderedMsg=m;g.prepareTextMsgWriteData=a;g.prepareMsgWriteData=n;g.writeNewIncomingMsg=b;g.writeCiphertextUpdate=e;g.handleDeleteForMeMessage=f;g.handleOutOfOrderRevokedMessage=o}),98);
__d("MAWBridgeXMA",["MAWBridgeUIEventDataValidation","MAWDbMedia","WALogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWBridge - createBridgeXMA received unexpected media type - ",""]);h=function(){return a};return a}function i(a){if(a==null)return void 0;switch(a){case"Image":case"Sticker":return"image/png";case"Gif":return"image/gif";case"Video":return"video/mp4";case"Ptt":return"audio/wav"}}function a(a,b,e){var f=b.contentRef,g=b.ctas,j=b.defaultCTA,k=b.defaultPreviewMediaId,l=b.faviconMediaId,m=b.headerMediaId,n=b.headerTitle,o=b.maxSubtitleNumOfLines,p=b.maxTitleNumOfLines,q=b.msgId,r=b.offlineAttachmentId,s=b.overlayIconGlyph,t=b.overlayTitle,u=b.subtitleText,v=b.targetId,w=b.targetType,x=b.targetUsername,y=b.threadJid,z=b.titleText,A=b.xmaId;b=b.xmaLayoutType;a!=null&&a.mediaType!==d("MAWDbMedia").IMAGE&&d("WALogger").WARN(h(),a.mediaType);v!=null&&d("MAWBridgeUIEventDataValidation").stringToI64Opt(v);return{contentRef:f,ctas:g,defaultCTA:j,defaultPreviewMediaId:k,duration:null,faviconMediaId:l,filesize:a==null?void 0:a.size,hasMedia:c("gkx")("821")?e:void 0,headerMediaId:m,headerTitle:n,maxSubtitleNumOfLines:o,maxTitleNumOfLines:p,mediaType:a==null?void 0:a.mediaType,msgId:q,offlineAttachmentId:r,overlayIconGlyph:s,overlayTitle:t,playableUrlMimeType:i(a==null?void 0:a.mediaType),previewHeight:a==null?void 0:(f=a.validatedImageInfo)==null?void 0:f.jpegThumbnailHeight,previewHeightLarge:a==null?void 0:(g=a.validatedImageInfo)==null?void 0:g.height,previewUrlMimeType:i(a==null?void 0:a.mediaType),previewWidth:a==null?void 0:(j=a.validatedImageInfo)==null?void 0:j.jpegThumbnailWidth,previewWidthLarge:a==null?void 0:(k=a.validatedImageInfo)==null?void 0:k.width,subtitleText:u,targetId:v,targetType:w,targetUsername:x,threadJid:y,titleText:z,ts:a==null?void 0:a.ts,xmaId:A,xmaLayoutType:b}}function b(a,b){var c=a.msgId;a=a.threadJid;return{msgId:c,threadJid:a,xmaId:b}}function e(a,b){var c=a.msgId;a=a.threadJid;return{msgId:c,threadJid:a,xmaId:b}}g.createBridgeXMA=a;g.createBridgeXMAShareExpired=b;g.createBridgeXMAShareTombstoned=e}),98);
__d("MAWDbReaction",["MAWAckLevel","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a.reactToAuthor!=="@me"||a.reaction==null)return null;var b=a.author==="@me"||a.author==="@system"?null:a.author;return b==null?null:babelHelpers["extends"]({},a,{author:b,reaction:a.reaction,reactToAuthor:a.reactToAuthor})}function b(a,b,c){var e=d("WAGlobals").getMyUserJid();return a.find(function(a){return a.threadJid===b&&d("WAJids").authorToUserId(a.author,e)===d("WAJids").authorToUserId(c,e)})}function c(a){return a}function e(a,b,c,e,f,g,h,i,j,k,l,m,n){m===void 0&&(m=d("MAWAckLevel").ACK.clock);m={ack:m,author:k,externalId:b,groupingKey:g,reaction:f,reactionId:c,reactToAuthor:h,reactToExternalId:e,reactToMsgId:i,senderTimestampMs:n,threadJid:a,ts:j};return l!=null?babelHelpers["extends"]({},m,{rowId:l}):m}g.castToIncomingDbReaction=a;g.findMatchingReaction=b;g.reactionIdToMsgId=c;g.formatReactionForDb=e}),98);
__d("MAWDbReactionUtils",["MAWBridgeTypesCreators","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;d("MAWIndexedDb").afterTransaction(c==null?{tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:f,reactToMsgId:e})}:{tag:"UpsertReaction",value:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a})})}g.dispatchReaction=a}),98);
__d("WAArrayGroupBy",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=new Map();for(var d=0;d<a.length;d++){var e=b(a[d]),f=c.get(e);f==null?c.set(e,[a[d]]):f.push(a[d])}return Array.from(c.entries())}f.groupBy=a}),66);
__d("MAWBulkPutReactionsWithThreadUpdateTxn",["MAWBridgeBuildThreadSnippet","MAWBridgeTypesCreators","MAWBridgeUIEventDataValidation","MAWDbReaction","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDexieTable","MAWJidUtils","MAWThreadSnippetBuildTxns","MAWTransactor","Promise","WAArrayGroupBy","WAJids","WAMsgMap","asyncToGeneratorRuntime","cr:3061","err","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a.reduce(function(a,b){var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.reactToExternalId);if(c==null)return a;a.set(c,d("MAWDbReactionsTxns").coerceToReaction(b));return a},new(d("WAMsgMap").MsgMap)()).values()}function a(a,e,f){if(e.length===0)return d("MAWDexieTable").dexieResolve();e=i(e);var g=e.map(function(a){var b=f.get(a.threadJid);if(b==null)throw c("err")("Should not have got here - expect thread to exist for flow");c("qex")._("1215")!==!0&&d("MAWDbReactionUtils").dispatchReaction(a);return a});e=d("WAArrayGroupBy").groupBy(g,function(a){a=a.threadJid;return a});e=e.map(function(b){var c=b[0];b=b[1];c=f.get(c);if(c==null||b.length===0)return null;var e=null;for(var g=b.length-1;g>=0;g--){e=d("MAWDbReaction").castToIncomingDbReaction(b[g]);if(e!=null)break}g=b.filter(function(a){return a.reaction==null});b=d("WAJids").interpretAsGroupJid(c.jid)!=null;return d("MAWThreadSnippetBuildTxns").getThreadChangesetForReactionChanges(a,c,{newestReaction:e,reactionsToClear:g},b)}).filter(Boolean);return d("MAWDexieTable").dexieAll(e).then(function(e){return d("MAWDexieTable").dexieAll([a.threads.bulkPut(e.map(function(a){a=a.thread;return a})),a.reactions.bulkPut(g)]).then(function(){if(c("qex")._("1215")===!0&&b("cr:3061")!=null)return d("MAWTransactor").runInLSDB(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(e.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=c.newestReaction;c=c.thread;var f=(yield b("cr:3061").getOrCreateOptimisticThreadKey(a,c.jid));f=(yield a.threads.get(f));if(f!=null&&e!=null&&c.snippetMsg!=null&&e.author!=null){var g=d("WAJids").interpretAsGroupJid(c.jid)!=null;e=d("MAWThreadSnippetBuildTxns").getReactionSnippetParams(e.author,e.reaction,g);g=e.snippetParams;var h=e.snippetSenderContactId;e=e.snippetType;g=d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:g,snippetSenderContactId:h,snippetType:e,threadJid:c.jid});h=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(g,f.snippet));yield a.threads.put(babelHelpers["extends"]({},f,{snippet:h,snippetSenderContactId:g.snippetSenderContactId!=null?d("MAWBridgeUIEventDataValidation").stringToI64Opt(g.snippetSenderContactId):void 0}))}});return function(a){return c.apply(this,arguments)}}()))});return function(b){return a.apply(this,arguments)}}())}).then(function(){})})}g.bulkPutReactionsWithThreadUpdates=a}),98);
__d("MAWBulkWriteReactionsTxns",["LSMEBTaskCreationSource","MAWAuthor","MAWBulkPutReactionsWithThreadUpdateTxn","MAWDbMsg","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWEncryptedBackupCacheManager","MAWIndexedDb","WAArrayGroupBy","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=[];b.forEach(function(a){var b=a.chatJid;a=a.unstoredReaction;a=a.reactToExternalId;e.push(b);f.push(a)});return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.messages.where("externalId").anyOf(f).toArray(),a.reactions.where("reactToExternalId").anyOf(f).toArray()]).then(function(e){var f=e[0],g=e[1];e=e[2];var h=new Map(f.map(function(a){return[a.jid,a]})),i=new Map(d("WAArrayGroupBy").groupBy(g,function(a){return a.externalId})),j=new Map(d("WAArrayGroupBy").groupBy(e,function(a){return a.reactToExternalId})),k=[];g=f.map(function(b){return d("MAWDbReactionsTxns").getNextReactionIdNumberForThread(a,b).then(function(a){return[b.jid,a]})});return d("MAWDexieTable").dexieAll(g).then(function(a){var e=new Map(a);b.forEach(function(a){var b=a.chatJid;a=a.unstoredReaction;var f=a.author,g=a.externalId,l=a.groupingKey,m=a.reaction,n=a.reactToAuthor,o=a.reactToExternalId,p=a.senderTimestampMs,q=a.ts,r=h.get(b);if(r==null)return"missing_thread";b=e.get(r.jid);if(b==null)throw c("err")("nextInChatReactionId should not be null");e.set(r.jid,b+1);var s=j.get(a.reactToExternalId)||[];s=d("MAWDbReaction").findMatchingReaction(s,r.jid,f);var t=d("MAWAuthor").getAuthorUserJid(n),u=i.get(a.reactToExternalId);if(u==null&&!d("MAWEncryptedBackupCacheManager").peekRestoreCache(a.reactToExternalId)){var v=d("WAJids").threadIdForChatJid(r.jid);d("MAWEncryptedBackupCacheManager").addMsgEntryToReuploadCache(r.jid,a.reactToExternalId);d("MAWIndexedDb").afterTransaction({tag:"IssuePointQuery",value:{jid:r.jid,messageId:a.reactToExternalId,startSortKey:void 0,taskSource:c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,threadId:v}})}a=u==null?void 0:u.find(function(a){return a.threadJid===r.jid&&t===d("MAWAuthor").getAuthorUserJid(a.author)});u=d("MAWDbReaction").formatReactionForDb(r.jid,g,d("MAWDbMsg").craftReactionId(r.chatId,b),o,m,l,n,a==null?void 0:a.msgId,q,(v=f)!=null?v:d("WAJids").AUTHOR_ME,s==null?void 0:s.rowId,void 0,p);k.push(u)});return{chatJidToDbThread:h,unstoredDbReactionsForInsertion:k}})})}function b(a,b){var c=b.chatJidToDbThread;b=b.unstoredDbReactionsForInsertion;return d("MAWBulkPutReactionsWithThreadUpdateTxn").bulkPutReactionsWithThreadUpdates(a,b,c)}g.prepareReactionsData=a;g.bulkWriteReactions=b}),98);
__d("MAWCastToMsgrServerMediaType",["MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid client mediaType: "," for castClientMediaTypeToServerMediaType method"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaType: "," for castToMsgrServerMediaType method"]);i=function(){return a};return a}function a(a,b){b===void 0&&(b=!1);if(b&&a==="image")return"xma";switch(a){case"image":case"video":case"gif":case"sticker":case"document":return a;case"ptt":return"audio";case"xma-image":return"xma";default:d("WALogger").ERROR(i(),a);return null}}function b(a,b){b===void 0&&(b=!1);if(b&&a===d("MAWDbMedia").MEDIA_TYPE.IMAGE)return"xma";switch(a){case"Image":return"image";case"Video":return"video";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"document";case"Ptt":return"audio";default:d("WALogger").ERROR(h(),a);return null}}g.castToMsgrServerMediaType=a;g.castClientMediaTypeToServerMediaType=b}),98);
__d("MAWParseXMAFBConfig",["WAArmadilloXMA.pb","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=new Set([(a=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT,c("gkx")("23929")?d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:null].filter(Boolean));g.FB_SUPPORTED_TARGET_TYPES=b}),98);
__d("WADbDeviceRegistration",[],(function(a,b,c,d,e,f){"use strict";a=25;b=6;c=100;d="https://reg-e2ee.facebook.com";e=d;var g="https://v.whatsapp.net",h="https://reg-e2ee.instagram.com",i="/v2/fb_icdc_fetch",j="/v2/fb_register_v2",k="Device has already been registered to WA servers",l="Device registration finished successfully",m="Device registration retries failed "+b+" times. No longer attempting registration.",n="Device registration response was null",o="Current user id is zero",p="CryptoAuthToken is empty",q="CryptoAuthToken is expired",r={failed:"failed",finished:"finished"};f.MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE=a;f.MAX_DEVICE_REGISTRATION_RETRIES=b;f.MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES=c;f.REG_FB_DOMAIN=d;f.REG_MSGR_DOMAIN=e;f.REG_WA_DOMAIN=g;f.REG_IGD_DOMAIN=h;f.ICDC_ENDPOINT=i;f.REGISTRATION_ENDPOINT=j;f.DEVICE_ALREADY_REGISTERED=k;f.DEVICE_SUCCESSFULLY_REGISTERED=l;f.FAILED_REGISTRATION_RETRIES=m;f.NULL_RESPONSE_FROM_SERVER=n;f.DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID=o;f.DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN=p;f.DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN=q;f.RegistrationStatesEnum=r}),66);
__d("getOrchestratorVersion",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return(a=c("qex")._("263"))!=null?a:"default"}g["default"]=a}),98);
__d("MAWMainWebWorkerConfig",["MAWGK","MAWParseXMAFBConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a={armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return c("justknobx")._("1866")},getDevicesV2:function(){return c("gkx")("4551")},getSignalFutureMessagesMax:function(){return c("gkx")("4280")?c("justknobx")._("847"):2e3},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return c("justknobx")._("1971")},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},ignoreReadReceipts:function(){return c("gkx")("2855")},isDocumentReceiveEnabled:function(){return!c("gkx")("23924")},isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return c("justknobx")._("1147")},isICDCErrorEnabled:function(){return c("gkx")("23975")},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isMediaStreamingForProgressiveJpegEnabled:function(){return c("gkx")("2325")},isMediaWaitForConnectionOnRetryEnabled:function(){return c("gkx")("23977")},isOctetStreamAttachmentMimeTypeEnabled:function(){return c("gkx")("4644")},isPollsFallbackExperienceEnabled:function(){return c("gkx")("23978")},isPreEstablishSessionEnabled:function(){return c("gkx")("23979")},isProgressiveJpegEnabledForDownload:function(){return c("justknobx")._("2411")},isProgressiveJpegSendEnabled:function(){return c("justknobx")._("2412")},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:function(){return c("justknobx")._("2618")},isUnsupportedMessagesRedesignEnabled:function(){return c("gkx")("1564")},jpegThumbnailTargetByteSizeKB:function(){return c("justknobx")._("2338")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return d("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},mediaDownloadDeduplication:function(){return c("gkx")("33150")},mediaTtlOnWhatsAppInfraInDays:function(){return c("justknobx")._("2715")},oneQueueTimeoutMs:function(){return c("justknobx")._("2583")},orchestratorVersion:function(){return c("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return c("justknobx")._("67")},sessionDropIfTooOld:function(){return c("justknobx")._("2240")},shouldDeviceStateTimesout:function(){return c("justknobx")._("2592")},skipDownloadablePreviewForProgressiveJpeg:function(){return c("justknobx")._("2371")},thumbnailImprovementsEnabled:function(){return c("gkx")("2655")},uiLayoutTriggeredMediaDownload:function(){return c("gkx")("4137")},useLongSessionDrop:function(){return c("gkx")("1244")},useProtocolMediaKey:function(){return c("gkx")("3718")},useUpdatedSenderKeySession:function(){return c("gkx")("23937")},waDanglingQueue:function(){return c("justknobx")._("1921")}};b={enableDocumentBackupAndRestore:function(){return!1},encryptForwardedMedia:function(){return c("gkx")("2983")},isEditMessageSendEnabled:function(){return!0},isMediaAssociatedXMAsEnabled:function(){return c("gkx")("4379")},isRavenMessagesEnabled:function(){return!0},isSaveThumbnailAsChunkEnabled:function(){return c("gkx")("9641")},productTypeForEBAttachments:"msgr",restoreExpiredMediaForNonMsgRestoreFlow:function(){return c("gkx")("4254")},skipExpiredDownload:function(){return c("gkx")("3981")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAFBConfig").FB_SUPPORTED_TARGET_TYPES}};g.waConfig=a;g.mawConfig=b}),98);
__d("MAWConfig",["MAWMainWebWorkerConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWMainWebWorkerConfig").mawConfig;function a(){return h}function b(a){h=a}g.getConfig=a;g.setConfig=b}),98);
__d("MAWDexieCastToPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){return(g||(g=b("Promise"))).resolve(a)}function c(a){return a}f.dexieCastToPromise=a;f.promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING=c}),66);
__d("MAWMediaAfterTxns",["MAWBridgeTypesCreators","MAWDbMedia","MAWDexieCastToPromise","MAWIndexedDb","MAWMediaUtils","MAWRavenUtils","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){return{ephemeralMediaState:b,ephemeralMediaViewMode:d("MAWRavenUtils").getEphemeralMediaViewMode(a)}};function a(a,b,e,f){c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise(f.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(g){var j=a.threadJid;g=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(g,j);j=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:j,filteredMsgIds:g,hasMediaForUI:e,media:b,ravenSettings:h(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:j,filteredMsgIds:g,hasMediaForUI:e,media:b,sortOrderMs:a.sortOrderMs});c("gkx")("2616")===!0?i(f,j):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:j})})))}function i(a,b,e){if(!j(b))return d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,e).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})))}function j(a){switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.VIDEO:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return!0;default:return!1}}g.handleNewMediaAfterTxn=a;g.handleNewMediaAfterTxnWithBridgeMedia=i}),98);
__d("MAWMediaBackupTxns",["MAWDbMediaTxns","MAWDexieTable","Promise","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fbid already exists for objectId"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaId or msgId cannot differ for an objectId in mediaBackup"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ObjectId already shared by different msgId"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fbid already exists for objectId"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaId or msgId cannot differ for an objectId in mediaBackup"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to add mediaBackup entry: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to add mediaBackup entry. Will attempt a retry. Error: ",""]);o=function(){return a};return a}var p=1;function q(a,b,e,f,g,h){h===void 0&&(h=0);return f==null?d("MAWDexieTable").dexieResolve():d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,f).then(function(i){if(i==null){var j={mediaId:b,msgId:e,objectId:f};g!=null&&(j=babelHelpers["extends"]({},j,{fbid:g}));return a.mediaBackup.add(j).then(function(a){return babelHelpers["extends"]({},j,{mediaBackupId:a})})["catch"](function(i){if(i.name==="ConstraintError"){if(h<p){d("WALogger").WARN(o(),i);return q(a,b,e,f,g,h+1)}throw c("err")("Failed to add mediaBackup entry. Original error: %s, %s",i.name,i.message)}d("WALogger").ERROR(n(),i);throw i})}else if(i.mediaId!==b||i.msgId!==e){d("WALogger").ERROR(m());return i}else{if(i.fbid==null&&g!=null){var k=babelHelpers["extends"]({},i,{fbid:g});return a.mediaBackup.put(k).then(function(a){return k})}else d("WALogger").WARN(l());return i}})}function a(a,c){if(c==null)return d("MAWDexieTable").dexieResolve();var e=[];c.forEach(function(a){a=a.objectId;a!=null&&e.push(a)});return d("MAWDbMediaTxns").maybeGetMediaBackupRowsFromObjectIds(a,e).then(function(e){var f=new Map(),g=[];c.forEach(function(a){var b=a.objectId;if(b!=null){var c=e.get(b);if(c==null){var h={mediaId:a.mediaId,msgId:a.msgId,objectId:b},l=a.fbid;h=babelHelpers["extends"]({},h,{fbid:l});f.get(b)!=null&&((l=f.get(b))==null?void 0:l.msgId)!==a.msgId&&d("WALogger").ERROR(k());f.set(b,h)}else{c.mediaId!==a.mediaId&&d("WALogger").ERROR(j());l=a.fbid;if(c.fbid==null&&l!=null){b=babelHelpers["extends"]({},c,{fbid:l});g.push(b)}else d("WALogger").WARN(i())}}});return(h||(h=b("Promise"))).all([a.mediaBackup.bulkAdd([].concat(Array.from(f.values()))),a.mediaBackup.bulkPut(g)]).then(function(){})}).then(function(){})}g.linkMediaBackup=q;g.bulkLinkMediaBackup=a}),98);
__d("WASortedLists",[],(function(a,b,c,d,e,f){"use strict";function a(){return[]}function b(){return[]}function c(a,b){return a.filter(b)}function d(a,b){return l(a.map(b))}function e(a,b){var c=a.length===b.length;for(var d=0;c&&d<a.length;d++)a[d]!==b[d]&&(c=!1);return c}function g(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return a;return a.concat([b]).sort()}function h(a,b){if(a.length<b.length)return!1;var c=!0;for(var d=0,e=0;c&&e<b.length;e++)do c=a[d]===b[e];while(!c&&++d<a.length);return c}function i(a,b){var c=[];for(var d=0,e=0;d<a.length;d++){var f=a[d];while(e<b.length&&f>b[e])e++;(e===b.length||f<b[e])&&c.push(f)}return c}function j(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length){var f=a[d],g=b[e];f<g?d++:f===g?(c.push(f),d++,e++):e++}return c}function k(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length)a[d]<b[e]?c.push(a[d++]):a[d]===b[e]?(c.push(a[d++]),e++):c.push(b[e++]);while(d<a.length)c.push(a[d++]);while(e<b.length)c.push(b[e++]);return c}function l(a){return m(a.slice().sort())}function m(a){var b=!1;for(var c=0;c<a.length-1;c++)a[c]===a[c+1]&&(b=!0);if(!b)return a;c=[];for(b=0;b<a.length-1;b++)a[b]!==a[b+1]&&c.push(a[b]);c.push(a[a.length-1]);return c}function n(a){return Array.from(a).sort()}function o(a){return a.slice().sort()}function p(a,b,c){var d=null;for(var e=0;!d&&e<a.length;e++)a[e]===b&&(d=a.slice(),d[e]=c,d=m(d.sort()));return d||a}function q(a){return[a]}function r(a){return a.length<1}function s(a,b,c){return a.slice(b,c)}f.emptySet=a;f.emptyList=b;f.filter=c;f.map=d;f.areEqual=e;f.addToSet=g;f.contains=h;f.subtract=i;f.intersect=j;f.joinUniq=k;f.sortAndDedupe=l;f.asSortedSet=n;f.sort=o;f.swapIn=p;f.singleElement=q;f.isEmpty=r;f.slice=s}),66);
__d("MAWMediaManagementTxns",["FBLogger","MAWBridgeTypesCreators","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaUtils","MAWMsgType","MAWSupportedDocumentTypes","MAWWriteMsgTxns","WAErrorMessage","WAJids","WALogger","WAMediaUtils","WASortedLists","WATagsLogger","WATimeUtils","err","gkx","isInstamadilloEB","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaBackup entry already exists for objectId ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Same FBId assigned for different mediaIds. fbId: "," - shared by hashedPlaintextHashes: "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Same objectId assigned for different mediaIds. objectId: "," shared by  hashedPlaintextHashes: "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][updateMediaWithEncodedMediaEntryData] media entry is missing, can't upate media with encoded data"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing, can't update media info"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link. Possible duplicate? Will attempt a retry. Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link. Possible duplicate? Will attempt a retry. For plaintextHash: ",", hashedPlaintextHash: ",". Error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link after retry. Error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link after retry. For plaintextHash: ",", hashedPlaintextHash: ",". Error: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media found after retry for plaintextHash: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing mandatory args for incoming media msg"]);r=function(){return a};return a}var s=d("WATagsLogger").TAGS(["MAWMediaManagementTxns"]),t=c("gkx")("23924");function a(a,b,c,e){var f=c==null||b.type===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE&&(t||!d("MAWSupportedDocumentTypes").isAllowedType((c=c.validatedDocumentFileInfo)==null?void 0:c.filename));return d("MAWWriteMsgTxns").prepareMsgWriteData(a,b,e).then(function(a){return babelHelpers["extends"]({},a,{shouldDropDocument:f})})}function b(a,b,e,f){f===void 0&&(f=!1);var g={validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},h=d("MAWMediaUtils").genHMACPlaintextHash(b.plaintextHash),i=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry),j=i.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(i.objectId):null;return d("MAWDexieTable").dexieAll([u(a,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntry,g,j,void 0,f),d("MAWDbChunkTxns").hasMediaChunk(a,h)]).then(function(b){var c=b[0];b=b[1];e.type!==d("MAWMsgType").MSG_TYPE.REVOKED&&!f&&d("MAWMediaAfterTxns").handleNewMediaAfterTxn(e,c,b,a);return c}).then(function(a){var b=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(i.serverMediaType,f),g=i.mediaKeyTimestamp;if(d("MAWMsgType").isMAWSupportedMediaType(e.type)&&!c("isInstamadilloEB")()){var h=e.threadJid;j!=null&&b!=null&&h!=null&&g!=null&&(b!=="document"||d("MAWConfig").getConfig().enableDocumentBackupAndRestore())?d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(j,b,e.externalId,d("MAWConfig").getConfig().productTypeForEBAttachments,d("WAJids").threadIdForChatJid(h),h,g)}):d("WALogger").WARN(r())}return a})}function u(a,b,c,e,f,g,h,i,j,k){k===void 0&&(k=!1);return v(a,b,c,e,f,g,h,i,j,k).then(function(c){var e=k?d("MAWDexieTable").dexieResolve():d("MAWDbMsgTxns").updateMediaId(a,b,c.mediaId,c.plaintextHash);return e.then(function(){return d("MAWMediaBackupTxns").linkMediaBackup(a,c.mediaId,b.msgId,i,j).then(function(){return c})})})}function v(a,b,e,f,g,h,i,j,k,l,r){l===void 0&&(l=!1);r===void 0&&(r=0);return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,e).then(function(t){var u=new Map(t==null?void 0:t.mediaEntries),w=z(h,j,k);w!=null&&u.set(b.msgId,w);if(t){r>0&&s.LOG(q(),e);t.msgIds||c("FBLogger")("messenger_e2ee_web").mustfix("Media missing msgIds: media type=%s",t.mediaType);t.mediaType||c("FBLogger")("messenger_e2ee_web").mustfix("Media missing mediaType: type=%s ; msg type=%s",f,b.type);var x=babelHelpers["extends"]({},t,i,{mediaEntries:u,mediaType:(w=t.mediaType)!=null?w:f,msgIds:d("WASortedLists").addToSet(t.msgIds||d("WASortedLists").emptySet(),b.msgId)});return a.media.put(x).then(function(){return x})}else{var y=d("MAWMediaUtils").genHMACPlaintextHash(e),A=babelHelpers["extends"]({fbid:(w=k)!=null?w:void 0,hashedPlaintextHash:y,mediaEntries:u,mediaType:f,msgIds:d("WASortedLists").singleElement(b.msgId),objectId:(t=j)!=null?t:void 0,plaintextHash:e,size:g,ts:d("WATimeUtils").unixTime()},i);return a.media.add(A).then(function(a){return babelHelpers["extends"]({},A,{mediaId:a})})["catch"](function(c){var q=d("WAErrorMessage").maybeGetMessageFromError(c);if(r>0){s.WARN(p(),e,y,q);s.ERROR(o(),q);throw c}else{s.WARN(n(),e,y,q);s.ERROR(m(),q);return v(a,b,e,f,g,h,i,j,k,l,r+1)}})}})}var w=function(a,b,e,f,g,h,i,j,k){k===void 0&&(k=!1);return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){if(b==null)throw c("err")("Do not have the media message in db when attachHashToMediaMsg");else return u(a,b,e,h,i,void 0,j,f,g,k)})},x=function(a,b,c){return d("MAWDbMediaTxns").maybeGetMediaFromHashedPlaintextHash(a,b).then(function(b){if(b!=null){var d=babelHelpers["extends"]({},b);c.validatedAudioInfo!=null&&(d.validatedAudioInfo=babelHelpers["extends"]({},b.validatedAudioInfo,c.validatedAudioInfo));c.validatedVideoInfo!=null&&(d.validatedVideoInfo=babelHelpers["extends"]({},b.validatedVideoInfo,c.validatedVideoInfo));c.validatedImageInfo!=null&&(d.validatedImageInfo=babelHelpers["extends"]({},b.validatedImageInfo,c.validatedImageInfo));c.validatedDocumentFileInfo!=null&&(d.validatedDocumentFileInfo=babelHelpers["extends"]({},b.validatedDocumentFileInfo,c.validatedDocumentFileInfo));return a.media.update(d.mediaId,d).then(function(){})}else s.WARN(l())})},y=function(a,b,c,e){return d("MAWDbMediaTxns").maybeGetMediaFromHashedPlaintextHash(a,b).then(function(b){if(b!=null){var f=e?b.mediaEntries.set(c,e):b.mediaEntries;b=babelHelpers["extends"]({},b,{mediaEntries:f});return a.media.update(b.mediaId,b)}else{s.ERROR(k());return d("MAWDexieTable").dexieResolve()}})};function e(a,b,c,e,f,g,h,i,j,k){k===void 0&&(k=!1);return d("MAWDexieTable").dexieAll([w(a,b,e,f,g,h,j.size,i,k),d("MAWDbChunkTxns").getOrCreateMediaChunk(a,e,c,j.type)]).then(function(a){a=a[0];return a})}function z(a,b,c){var e;a=a;a!=null&&b!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedObjectId(e,b));a!=null&&c!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(e,c));return a}function f(a,b,c){var e=new Map();a.mediaEntries.forEach(function(a,f){var g=d("WAMediaUtils").decodeMediaEntryData(a);g=g.objectId===b?d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(g,c):a;e.set(f,g)});return e}function A(a,b,c){var e=new Map();b.forEach(function(a){var b;b=(b=e.get(a.hashedPlaintextHash))!=null?b:[];b.push(a);e.set(a.hashedPlaintextHash,b)});return d("MAWDbMediaTxns").maybeBulkGetMediaFromHashedPlaintextHash(a,[].concat(Array.from(e.keys()))).then(function(f){var g=new Map(f.map(function(a){return[a.hashedPlaintextHash,a]})),h=new Map();b.forEach(function(a){var b=g.get(a.hashedPlaintextHash);if(a==null)return;var c=z(a==null?void 0:a.entry,a==null?void 0:a.objectId,a==null?void 0:a.fbId);if(b){var e=c?b.mediaEntries.set(a.msgId,c):b.mediaEntries;e=babelHelpers["extends"]({},b,{mediaEntries:e,msgIds:d("WASortedLists").addToSet(b.msgIds,a.msgId)});g.set(a.hashedPlaintextHash,e)}else I(h,a,c)});var i=new Map(),j=new Map();f=Array.from(h.values()).filter(function(a){return B(a,i,j)});return d("MAWDexieTable").dexieAll([a.media.bulkAdd(f),a.media.bulkPut(Array.from(g.values()))]).then(function(){return C(a,[].concat(Array.from(e.keys())),e,c)})})}function B(a,b,c){if(a.objectId!=null){var d=b.get(a.objectId);if(d!=null&&d!==a.hashedPlaintextHash){s.ERROR(j(),a.objectId,d,a.hashedPlaintextHash);return!1}}if(a.fbid!=null){d=c.get(a.fbid);if(d!=null&&d!==a.hashedPlaintextHash){s.ERROR(i(),a.fbid,d,a.hashedPlaintextHash);return!1}}a.objectId!=null&&b.set(a.objectId,a.hashedPlaintextHash);a.fbid!=null&&c.set(a.fbid,a.hashedPlaintextHash);return!0}function C(a,b,c,e){return d("MAWDbMediaTxns").maybeBulkGetMediaFromHashedPlaintextHash(a,b).then(function(b){return d("MAWDexieTable").dexieAll([F(a,b,c),d("MAWMediaBackupTxns").bulkLinkMediaBackup(a,G(b,c))]).then(function(){D(b,c,e,a);return b})})}function D(a,b,e,f){a.forEach(function(a){var g=b.get(a.hashedPlaintextHash);g!=null&&!E(g)&&c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise(f.messages.where("msgId").anyOf(a.msgIds).toArray().then(function(b){b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:e,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,e),hasMediaForUI:!1,media:a});c("gkx")("2616")===!0?d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(f,b):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b})})))})}function E(a){return a.reduce(function(a,b){return a||b.isXMAShare},!1)}function F(a,b,c){b=b.reduce(function(a,b){var d;(d=c.get(b.hashedPlaintextHash))==null?void 0:d.filter(function(a){return a!=null&&!a.isXMAShare}).forEach(function(c){return a.set(c.msgId,b.mediaId)});return a},new Map());return d("MAWDbMsgTxns").bulkUpdateMediaId(a,b)}function G(a,b){var c=new Map();a.forEach(function(a){var d;d=(d=b.get(a.hashedPlaintextHash))!=null?d:[];d.forEach(function(b){c.has(b.objectId)?s.ERROR(h(),b.objectId):b.objectId!=null&&c.set(b.objectId,{fbid:b.fbId,mediaId:a.mediaId,msgId:b.msgId,objectId:b.objectId})})});return Array.from(c.values())}function H(a,b){var c;a=a?new Map([[b.msgId,a]]):new Map();return babelHelpers["extends"]({fbid:(c=b.fbId)!=null?c:void 0,hashedPlaintextHash:b.hashedPlaintextHash,mediaEntries:a,mediaType:b.mediaType,msgIds:d("WASortedLists").singleElement(b.msgId),objectId:(c=b.objectId)!=null?c:void 0,plaintextHash:b.plaintextHash,size:b.size,ts:d("WATimeUtils").unixTime()},b.mediaInfo)}function I(a,b,c){var d=a.get(b.hashedPlaintextHash);d==null?a.set(b.hashedPlaintextHash,H(c,b)):(c!=null&&d.mediaEntries.set(b.msgId,c),d.msgIds.push(b.msgId))}g.prepareMediaWriteData=a;g.handleUnstoredDbMedia=b;g.linkMedia=u;g.createOrUpdateMediaRow=v;g.attachHashToMediaMsg=w;g.updateMediaEntryWithValidatedMediaInfo=x;g.updateMediaWithEncodedMediaEntryData=y;g.attachHashAndSaveMedia=e;g.updateBackupFbidInMediaEntries=f;g.bulkLinkMedia=A;g.linkMessageAndMediaBackupForMediaList=C}),98);/*FB_PKG_DELIM*/
__d("WAMediaTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NONE:0,LQ_4K:1,HQ_4K:2};b={NONE:0,GIPHY:1,TENOR:2};c={TALKING_A:0,IDLE_A:1,TALKING_B:2,IDLE_B:3,BACKGROUND:4};e={UNKNOWN:0,OPUS:1};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={};f.internalSpec={integral:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,l],ancillary:[2,h.TYPES.MESSAGE,i]};i.internalSpec={fileLength:[1,h.TYPES.UINT64],mimetype:[2,h.TYPES.STRING],thumbnail:[3,h.TYPES.MESSAGE,j],objectId:[4,h.TYPES.STRING]};j.internalSpec={jpegThumbnail:[1,h.TYPES.BYTES],downloadableThumbnail:[2,h.TYPES.MESSAGE,k],thumbnailWidth:[3,h.TYPES.UINT32],thumbnailHeight:[4,h.TYPES.UINT32]};k.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],thumbnailScansSidecar:[7,h.TYPES.BYTES],thumbnailScanLengths:[8,h.FLAGS.REPEATED|h.TYPES.UINT32]};l.internalSpec={fileSha256:[1,h.TYPES.BYTES],mediaKey:[2,h.TYPES.BYTES],fileEncSha256:[3,h.TYPES.BYTES],directPath:[4,h.TYPES.STRING],mediaKeyTimestamp:[5,h.TYPES.INT64]};m.internalSpec={integral:[1,h.TYPES.MESSAGE,o],ancillary:[2,h.TYPES.MESSAGE,n]};n.internalSpec={height:[1,h.TYPES.UINT32],width:[2,h.TYPES.UINT32],scansSidecar:[3,h.TYPES.BYTES],scanLengths:[4,h.FLAGS.REPEATED|h.TYPES.UINT32],midQualityFileSha256:[5,h.TYPES.BYTES],hdType:[6,h.TYPES.ENUM,a]};o.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};p.internalSpec={integral:[1,h.TYPES.MESSAGE,r],ancillary:[2,h.TYPES.MESSAGE,q]};q.internalSpec={seconds:[1,h.TYPES.UINT32],caption:[2,h.TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],gifPlayback:[3,h.TYPES.BOOL],height:[4,h.TYPES.UINT32],width:[5,h.TYPES.UINT32],sidecar:[6,h.TYPES.BYTES],gifAttribution:[7,h.TYPES.ENUM,b]};r.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};s.internalSpec={integral:[1,h.TYPES.MESSAGE,w],ancillary:[2,h.TYPES.MESSAGE,t]};t.internalSpec={seconds:[1,h.TYPES.UINT32],avatarAudio:[2,h.TYPES.MESSAGE,u]};u.internalSpec={poseId:[1,h.TYPES.UINT32],avatarAnimations:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,v]};v.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],animationsType:[7,h.TYPES.ENUM,c]};w.internalSpec={transport:[1,h.TYPES.MESSAGE,f],audioFormat:[2,h.TYPES.ENUM,e]};x.internalSpec={integral:[1,h.TYPES.MESSAGE,z],ancillary:[2,h.TYPES.MESSAGE,y]};y.internalSpec={pageCount:[1,h.TYPES.UINT32]};z.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};A.internalSpec={integral:[1,h.TYPES.MESSAGE,C],ancillary:[2,h.TYPES.MESSAGE,B]};B.internalSpec={pageCount:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],width:[3,h.TYPES.UINT32],firstFrameLength:[4,h.TYPES.UINT32],firstFrameSidecar:[5,h.TYPES.BYTES],mustacheText:[6,h.TYPES.STRING],isThirdParty:[7,h.TYPES.BOOL],receiverFetchId:[8,h.TYPES.STRING]};C.internalSpec={transport:[1,h.TYPES.MESSAGE,f],isAnimated:[2,h.TYPES.BOOL],receiverFetchId:[3,h.TYPES.STRING]};D.internalSpec={integral:[1,h.TYPES.MESSAGE,F],ancillary:[2,h.TYPES.MESSAGE,E]};E.internalSpec={displayName:[1,h.TYPES.STRING]};F.internalSpec={vcard:[1,h.TYPES.STRING],downloadableVcard:[2,h.TYPES.MESSAGE,f],__oneofs__:{contact:["vcard","downloadableVcard"]}};g.IMAGE_TRANSPORT_ANCILLARY_HD_TYPE=a;g.VIDEO_TRANSPORT_ANCILLARY_ATTRIBUTION=b;g.AUDIO_TRANSPORT_ANCILLARY_AVATAR_AUDIO_ANIMATIONS_TYPE=c;g.AUDIO_TRANSPORT_INTEGRAL_AUDIO_FORMAT=e;g.WAMediaTransportSpec=f;g.WAMediaTransport$AncillarySpec=i;g.WAMediaTransport$Ancillary$ThumbnailSpec=j;g.WAMediaTransport$Ancillary$Thumbnail$DownloadableThumbnailSpec=k;g.WAMediaTransport$IntegralSpec=l;g.ImageTransportSpec=m;g.ImageTransport$AncillarySpec=n;g.ImageTransport$IntegralSpec=o;g.VideoTransportSpec=p;g.VideoTransport$AncillarySpec=q;g.VideoTransport$IntegralSpec=r;g.AudioTransportSpec=s;g.AudioTransport$AncillarySpec=t;g.AudioTransport$Ancillary$AvatarAudioSpec=u;g.AudioTransport$Ancillary$AvatarAudio$DownloadableAvatarAnimationsSpec=v;g.AudioTransport$IntegralSpec=w;g.DocumentTransportSpec=x;g.DocumentTransport$AncillarySpec=y;g.DocumentTransport$IntegralSpec=z;g.StickerTransportSpec=A;g.StickerTransport$AncillarySpec=B;g.StickerTransport$IntegralSpec=C;g.ContactTransportSpec=D;g.ContactTransport$AncillarySpec=E;g.ContactTransport$IntegralSpec=F}),98);
__d("validateMAWMediaAndComposeEntryForProtoMsg",["WAMediaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)throw c("err")("DbMedia is null in validateMediaAndComposeEntryForProtoMsg");if(!b.msgIds.includes(a))throw c("err")("the media ("+b.mediaId+") is not linked to the msg ("+a+")");a=b.mediaEntries.get(a);if(a==null)throw c("err")("media entry not found in validateMediaAndComposeEntryForProtoMsg");var e=b.plaintextHash,f=d("WAMediaUtils").mediaEntryDataToRawData(e,a);e=["fileSha256","mediaKey","fileEncSha256","directPath","mediaKeyTimestamp"];a=e.filter(function(a){return f[a]==null});if(a.length>0)throw c("err")("missing fields in mediaEntryData: "+a.toString());return[b,f]}g["default"]=a}),98);
__d("MAWAsConsumerApplication",["I64","LSIntEnum","MAWDbMedia","MAWJids","MAWMsgType","MAWVault","WAAssertUnreachable","WAConsumerApplication.pb","WAGlobals","WAJids","WAMediaTransport.pb","encodeMAWDocumentFileMessage","encodeProtobuf","err","gkx","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="image/jpeg",k="video/mp4",l="audio/wav",m="image/gif",n="image/webp",o=c("gkx")("4644")?"application/octet-stream":"application/pdf",p=new ArrayBuffer(0);function a(a,b,e){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return r(a);case d("MAWMsgType").MSG_TYPE.IMAGE:return s(a,b);case d("MAWMsgType").MSG_TYPE.VIDEO:return z(a,b);case d("MAWMsgType").MSG_TYPE.PTT:return C(a,b);case d("MAWMsgType").MSG_TYPE.REVOKED:return F(a);case d("MAWMsgType").MSG_TYPE.GIF:return z(a,b);case d("MAWMsgType").MSG_TYPE.STICKER:return w(a,b);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("encodeMAWDocumentFileMessage")(a,b);case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return null;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:throw c("err")("Implemented ephemeral setting message in MAWAsConsumerApplication");case d("MAWMsgType").MSG_TYPE.XMA:throw c("err")("XMA content message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:throw c("err")("We do not support converting to protoMsg with "+a.type+" type","maw_db");case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:throw c("err")("Raven content message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:throw c("err")("We do not support editing messages right now since the sending flow is not implemented yet. ");case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return G(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:throw c("err")("Sending bump messages is not supported yet.");default:return c("WAAssertUnreachable")(a.type)}}function b(a,b){if(b==null)return q(a);else switch(b.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return t(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return A(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.PTT:return D(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.GIF:return A(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.STICKER:return x(a.msgId,b);default:return null}}function q(a){var b=null;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&a.msgContent!=null&&a.msgContent.content!=null)b=a.msgContent.content;else if(a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME&&a.msgContent!=null)b=a.msgContent;else return null;return{payload:{content:{messageText:{mentionedJid:[],text:d("MAWVault").unvault(b)}}}}}function r(a){var b={payload:{content:{messageText:{mentionedJid:a.msgContent.mentionedJids,text:d("MAWVault").unvault(a.msgContent.content)}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function s(a,b){return t(a.msgId,b)}function t(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return v(b,a)}function u(a,b){var c;a={ancillary:{height:(c=a.validatedImageInfo)==null?void 0:c.height,scanLengths:((c=b.progressiveJpegDetails)==null?void 0:c.scanLengths)||[],scansSidecar:(c=b.progressiveJpegDetails)==null?void 0:c.sidecar,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:j,objectId:b.objectId,thumbnail:{downloadableThumbnail:b.downloadableThumbnail,jpegThumbnail:void 0,thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};return d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,a).readBuffer()}function v(a,b){a=u(a,b);return{payload:{content:{imageMessage:{caption:{mentionedJid:[]},image:{payload:a,version:1}}}}}}function e(a){return{payload:{content:{editMessage:{key:{fromMe:!0,id:a.originalMsgExternalId,remoteJid:a.threadJid},message:{mentionedJid:a.msgContent.mentionedJids,text:d("MAWVault").unvault(a.msgContent.content)},timestampMs:a.editTs*1e3}}}}}function w(a,b){return x(a.msgId,b)}function x(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return y(b,a)}function y(a,b){var c;a={ancillary:{height:(c=a.validatedImageInfo)==null?void 0:c.height,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:n,objectId:b.objectId,thumbnail:{thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};c=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,a);return{payload:{content:{stickerMessage:{sticker:{payload:c.readBuffer(),version:1}}}}}}function z(a,b){return A(a.msgId,b)}function A(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return B(b,a)}function B(a,b){var c,e=a.mediaType===d("MAWDbMedia").MEDIA_TYPE.GIF,f=e?a.validatedImageInfo:a.validatedVideoInfo;c={ancillary:{gifPlayback:e,height:f==null?void 0:f.height,seconds:e?void 0:(c=a.validatedVideoInfo)==null?void 0:c.duration,sidecar:b.sidecar,width:f==null?void 0:f.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:e?m:k,objectId:b.objectId,thumbnail:e?{thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}:{downloadableThumbnail:b.downloadableThumbnail,jpegThumbnail:void 0,thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,c);return{payload:{content:{videoMessage:{caption:{mentionedJid:[]},video:{payload:a.readBuffer(),version:1}}}}}}function C(a,b){return D(a.msgId,b)}function D(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return E(b,a)}function E(a,b){var e;e={ancillary:{seconds:(e=a.validatedAudioInfo)==null?void 0:e.duration},integral:{audioFormat:c("gkx")("3532")?d("WAMediaTransport.pb").AUDIO_TRANSPORT_INTEGRAL_AUDIO_FORMAT.OPUS:void 0,transport:{ancillary:{fileLength:a.size,mimetype:l,objectId:b.objectId,thumbnail:{jpegThumbnail:p}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,e);return{payload:{content:{audioMessage:{audio:{payload:a.readBuffer(),version:1},ptt:!0}}}}}function F(a){return{payload:{applicationData:{revoke:{key:{fromMe:!0,id:a.revokedExternalId}}}}}}function f(a){var b=d("WAJids").isAuthorMe(a.reactToAuthor)||d("WAGlobals").getMyUserJid()===a.reactToAuthor,c=d("WAJids").interpretAsGroupJid(a.threadJid)!=null;c={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:{fromMe:b,id:a.reactToExternalId,participant:c&&!b?a.reactToAuthor:void 0,remoteJid:a.threadJid},senderTimestampMs:a.ts*1e3,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:c}}}}function G(a,b){if(a.threadJid==null)throw c("err")("msg threadJid is null in encodeGroupInviteMessage");if(b==null)throw c("err")("DbGroupInvite is null in encodeGroupInviteMessage");var e=d("WAJids").interpretAsGroupJid(a.threadJid);if(e==null)throw c("err")("groupJid is null in encodeGroupInviteMessage");return{payload:{content:{groupInviteMessage:{groupJid:e,groupName:a.groupName,inviteCode:b.inviteCode,inviteExpiration:b.inviteExpirationTs}}}}}function H(a){return(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(1))||(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(256))||a.textHasLinks||a.isUnsent?I(a):null}function I(a){var b;b=(b=a.mentionIds)==null?void 0:(b=b.split(","))==null?void 0:b.map(d("MAWJids").toUserJid);return{payload:{content:{messageText:{mentionedJid:(b=b)!=null?b:[],text:a.text}}}}}g.IMAGE_MIME_TYPE=j;g.VIDEO_MIME_TYPE=k;g.AUDIO_MIME_TYPE=l;g.GIF_MIME_TYPE=m;g.STICKER_MIME_TYPE=n;g.FILE_MIME_TYPE=o;g.emptyAudioFileArrayBuffer=p;g.asConsumerApplication=a;g.deletedMsgAsConsumerApplicationForSpamReporting=b;g.encodeValidatedMediaToImageTransport=u;g.encodeEditMessage=e;g.encodeReactionMessage=f;g.asConsumerApplicationLSDb=H}),98);
__d("encodeMAWDocumentFileMessage",["MAWAsConsumerApplication","WAMediaTransport.pb","encodeProtobuf","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a.msgId,b)}function h(a,b){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return i(b,a)}function i(a,b){b={ancillary:{},integral:{transport:{ancillary:{fileLength:a.size,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE,objectId:b.objectId,thumbnail:{jpegThumbnail:new ArrayBuffer(1),thumbnailHeight:1,thumbnailWidth:1}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};b=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,b);return{payload:{content:{documentMessage:{document:{payload:b.readBuffer(),version:1},fileName:(b=a.validatedDocumentFileInfo)==null?void 0:b.filename}}}}}g["default"]=a}),98);
__d("MAWCastToServerMediaType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"document":case"image":case"xma-image":case"video":case"ptt":case"gif":case"sticker":return a;default:return null}}f.castToServerMediaType=a}),66);
__d("MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentOverlayIconGlyph: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.INFO:return d("EchoMessageXMAFieldUtils").XMAGatingType.INFO;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.EYE_OFF:return d("EchoMessageXMAFieldUtils").XMAGatingType.EYE_OFF;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NEWS_OFF:return d("EchoMessageXMAFieldUtils").XMAGatingType.NEWS_OFF;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.WARNING:return d("EchoMessageXMAFieldUtils").XMAGatingType.WARNING;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE:return d("EchoMessageXMAFieldUtils").XMAGatingType.PRIVATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE:return d("EchoMessageXMAFieldUtils").XMAGatingType.NONE;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMAGatingType.NONE}}g.convertExtendedContentOverlayIconGlyphToXMAGatingType=a}),98);
__d("MAWConvertExtendedContentTargetTypeToXMATargetType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentTargetType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_IMAGE_POST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_MULTIPOST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_VIDEO_POST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_CLIPS_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_IGTV_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SHOP_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_PROFILE_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_HIGHLIGHT_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_HIGHLIGHT_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REACTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_GAMING_CUSTOM_UPDATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_PRODUCER_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.MSG_EXTERNAL_LINK_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_EVENT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:return d("EchoMessageXMAFieldUtils").XMAContentType.MSG_RECEIVER_FETCH;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMAContentType.NONE}}g.convertExtendedContentTargetTypeToXMATargetType=a}),98);
__d("MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentXMLLayoutType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE:return d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.PORTRAIT:return d("EchoMessageXMAFieldUtils").XMALayoutType.PORTRAIT;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE}}g.convertExtendedContentXMLLayoutTypeToXMALayoutType=a}),98);
__d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaGatingType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMAGatingType.INFO:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.INFO;case d("EchoMessageXMAFieldUtils").XMAGatingType.EYE_OFF:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.EYE_OFF;case d("EchoMessageXMAFieldUtils").XMAGatingType.NEWS_OFF:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NEWS_OFF;case d("EchoMessageXMAFieldUtils").XMAGatingType.WARNING:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.WARNING;case d("EchoMessageXMAFieldUtils").XMAGatingType.PRIVATE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE;case d("EchoMessageXMAFieldUtils").XMAGatingType.NONE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE;default:d("WALogger").ERROR(h(),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE}}g.convertXMAGatingTypeToExtendedContentOverlayIconGlyph=a}),98);
__d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaLayoutType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE;case d("EchoMessageXMAFieldUtils").XMALayoutType.PORTRAIT:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.PORTRAIT;default:d("WALogger").ERROR(h(),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE}}g.convertXMALayoutTypeToExtendedContentXMLLayoutType=a}),98);
__d("MAWDownloadManager",[],(function(a,b,c,d,e,f){"use strict";var g=1e4;a=function(){function a(){this.$1=[],this.$2=new Map()}var b=a.prototype;b.setToDownloadManager=function(a,b){this.$3(),this.$2.set(a,b),this.$1.push(a)};b.getFromDownloadManager=function(a){return this.$2.get(a)};b.removeFromMediaDownloadManager=function(a){this.$2["delete"](a);var b=this.$1.filter(function(b){return b!==a});this.setDownloadManagerQueue(b)};b.setDownloadManagerQueue=function(a){this.$1=a};b.$3=function(){if(this.$1.length>=g){var a=this.$1.shift();this.$2["delete"](a)}};return a}();f.DownloadManager=a}),66);
__d("MAWGetAttachmentTypeForServerMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid AttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE;case"video":return d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO;case"ptt":return d("EchoMessageMediaFieldUtils").AttachmentType.PTT;case"gif":return d("EchoMessageMediaFieldUtils").AttachmentType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").AttachmentType.STICKER;case"xma-image":return d("EchoMessageMediaFieldUtils").AttachmentType.XMA;case"document":return d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT;default:d("WALogger").WARN(h(),a);return null}}g.getAttachmentTypeForServerMediaType=a}),98);
__d("MAWGetMediaAttachmentTypeForServerMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid EchoMessageActMediaAttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE;case"video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO;case"ptt":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO;case"gif":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER;case"audio":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO;case"document":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT;case"ppic":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.PROFILE_PICTURE;case"md-app-state":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.APP_STATE;case"md-msg-hist":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.HISTORY_SYNC;case"thumbnail-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_IMAGE;case"thumbnail-video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_VIDEO;case"thumbnail-gif":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_GIF;case"thumbnail-document":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_DOCUMENT;case"thumbnail-link":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_LINK;case"novi-video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.NOVI_VIDEO;case"novi-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.NOVI_IMAGE;case"xma-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE;default:d("WALogger").ERROR(h(),a);return null}}g.getMediaAttachmentTypeForServerMediaType=a}),98);
__d("MAWOptimisticUploadManager",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(){return g}function b(){g.clear()}f.getOptimisticUploadManager=a;f.clearOptimisticUploadManager=b}),66);
__d("MAWGetMediaPlaintextApi",["MAWIndexedDb","MAWMediaUtils","MAWOptimisticUploadManager","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);i=function(){return a};return a}a=function(a){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();c=c.get(a);if(c==null)return j(a);else return(h||(h=b("Promise"))).resolve(c.file)};function j(a){return d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"getMediaPlaintextFromDb",function(a){return function(b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.where("hashedPlaintextHash").equals(b).first().then(function(a){if(!a){d("WALogger").WARN(i());return null}return new Blob([a.blobData],{type:a.mimetype})})}})(a)}g.getMediaPlaintext=a}),98);
__d("MAWGetPreviewContentTypeForMediaType",["EchoMessageMediaFieldUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;case"gif":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER;case"video":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4;case"ptt":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV;case"xma-image":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;default:return null}}g.getPreviewContentTypeForMediaType=a}),98);
__d("MAWMediaDownloadManager",["MAWDownloadManager"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWDownloadManager").DownloadManager)(),i=new(d("MAWDownloadManager").DownloadManager)();function a(a,b){h.setToDownloadManager(a,b)}function b(a){return h.getFromDownloadManager(a)}function c(a){h.removeFromMediaDownloadManager(a)}function e(a,b){i.setToDownloadManager(a,b)}function f(a){return i.getFromDownloadManager(a)}function j(a){i.removeFromMediaDownloadManager(a)}g.setToMediaDownloadManager=a;g.getFromMediaDownloadManager=b;g.removeFromMediaDownloadManager=c;g.setToMediaPlaintextDownloadManager=e;g.getFromMediaPlaintextDownloadManager=f;g.removeFromMediaPlaintextDownloadManager=j}),98);
__d("MAWHandleMediaDownloadApi",["MAWBridgeTypesCreators","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWLoggerUtils","MAWMediaAfterTxns","MAWMediaDownloadManager","MAWMediaUtils","MAWMsgType","MAWTransactionMode","MAWXMAUtils","Promise","WAArmadilloXMA.pb","WAResultOrError","WATagsLogger","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media is null when storing downloaded blob"]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);e=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,media:a.READWRITE,messages:a.READONLY,threads:a.READONLY,xma:a.READONLY},"handleMediaDownload",function(a){return function(e,f,g,l){var m=d("MAWMediaUtils").genHMACPlaintextHash(e);return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,l),a.media.where("hashedPlaintextHash").equals(m).first(),d("MAWDbChunkTxns").getOrCreateMediaChunk(a,e,g,f)]).then(function(l){var m=l[0],n=l[1];l[2];if(n==null){j.ERROR(i());return d("WAResultOrError").makeError("missing-media-on-save")}c("gkx")("2419")?l=d("MAWMediaDownloadManager").getFromMediaPlaintextDownloadManager(e):l=d("MAWMediaDownloadManager").getFromMediaDownloadManager(n.mediaId);l!=null&&(l((h||(h=b("Promise"))).resolve(new Blob([g],{type:f}))),c("gkx")("2419")?d("MAWMediaDownloadManager").removeFromMediaPlaintextDownloadManager(e):d("MAWMediaDownloadManager").removeFromMediaDownloadManager(n.mediaId));return k(a,m).then(function(b){if(!b)return a.messages.where("msgId").anyOf(n.msgIds).toArray().then(function(b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(e){e.forEach(function(e){if(e!=null){e=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:e.jid,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,e.jid),hasMediaForUI:!0,media:n,sortOrderMs:m==null?void 0:m.sortOrderMs});c("gkx")("2616")===!0?d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,e,b):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:e})}})})});else if(c("gkx")("821"))return a.messages.where("msgId").anyOf(n.msgIds).toArray().then(function(b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(e){e.forEach(function(e){if(e!=null)return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;if(b.defaultPreviewMediaId!==n.mediaId)return;c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(n,b,a))}))})})})})}).then(function(){return d("MAWDbMediaTxns").updateMedia(a,n,{size:g.byteLength})}).then(function(){return d("WAResultOrError").makeResult()})})}});function k(a,b){var c;if(b==null)return d("MAWDexieTable").dexieResolve(!1);if(b.type===d("MAWMsgType").MSG_TYPE.XMA)return d("MAWDexieTable").dexieResolve(!0);return((c=b.quote)==null?void 0:c.content.xmaMessageType)===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY?d("MAWDexieTable").dexieResolve(b.type===d("MAWMsgType").MSG_TYPE.TEXT):d("MAWDbXMATxns").maybeGetXMAFromAssociatedMsgId(a,b.msgId).then(function(a){return a!=null})}g.handleMediaDownload=e}),98);
__d("MAWMediaPreviewDownloadManager",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=[],j=new Map();function a(a){if(j.has(a))return;k();var b=new(d("WAResolvable").Resolvable)();j.set(a,b);i.push(a)}function b(a){return j.get(a)}function c(a){j["delete"](a)}function k(){if(i.length>=h){var a=i.shift();j["delete"](a)}}function e(){i=[],j.clear()}g.markMediaPreviewAsDownloading=a;g.getMediaPreviewDownloadingResolvable=b;g.removeMediaPreviewDownloadingResolvable=c;g.clear=e}),98);
__d("MAWHandleMediaPreviewBeforeDownloadApi",["MAWMediaPreviewDownloadManager","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){d("MAWMediaPreviewDownloadManager").markMediaPreviewAsDownloading(a);return(h||(h=b("Promise"))).resolve()};g.handleMediaPreviewBeforeDownload=a}),98);
__d("MAWHandleMediaPreviewDownloadApi",["MAWBridgeTypesCreators","MAWConfig","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLoggerUtils","MAWMediaAfterTxns","MAWMediaPreviewDownloadManager","MAWTransactionMode","WACryptoSha256","WAHashUtils","WALoggerTag","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Main media for preview is null. Type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling preview for main hash ","... preview hash ","..."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive,c("WALoggerTag").MediaPreview]);a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=d("WAHashUtils").toPlaintextHash(yield d("WACryptoSha256").sha256(b)),g=d("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(a);g!=null&&(g.resolve(new Blob([b],{type:"image/jpeg"})),d("MAWMediaPreviewDownloadManager").removeMediaPreviewDownloadingResolvable(a));return k(a,f,b,c,e)});return function(b,c,d,e){return a.apply(this,arguments)}}();var k=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,media:e.READWRITE,messages:e.READONLY,threads:e.READONLY},"handleMediaPreviewDownload",function(a){return function(b,e,f,g,k){return d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,k),l(a,e,f)]).then(function(k){var l=k[0],m=k[1];k[2];j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b),d("WAHashUtils").sanitisePlaintextHash(e));if(l==null){j.WARN(h(),g);return d("WAResultOrError").makeError("missing-media-on-save")}switch(g){case"image":a.media.update(l.mediaId,babelHelpers["extends"]({},l,{validatedImageInfo:babelHelpers["extends"]({},l.validatedImageInfo,{jpegThumbnail:f,thumbnailPlaintextHash:d("MAWConfig").getConfig().isSaveThumbnailAsChunkEnabled()?e:void 0})}));break;case"video":a.media.update(l.mediaId,babelHelpers["extends"]({},l,{validatedVideoInfo:babelHelpers["extends"]({},l.validatedVideoInfo,{jpegThumbnail:f,thumbnailPlaintextHash:d("MAWConfig").getConfig().isSaveThumbnailAsChunkEnabled()?e:void 0})}));break;default:g;break}return a.messages.where("msgId").anyOf(l.msgIds).toArray().then(function(b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(e){e.forEach(function(e){if(e!=null){e=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:e.jid,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,e.jid),hasMediaForUI:!0,media:l,sortOrderMs:m==null?void 0:m.sortOrderMs});c("gkx")("2616")===!0?d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,e,b):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:e})}});return d("WAResultOrError").makeResult()})})})}});function l(a,b,c){return!d("MAWConfig").getConfig().isSaveThumbnailAsChunkEnabled()?d("MAWDexieTable").dexieResolve():d("MAWDbChunkTxns").getOrCreateMediaChunk(a,b,c,"image/jpeg").then(function(){return d("MAWDexieTable").dexieResolve()})}g.handleMediaPreviewDownload=a}),98);
__d("MAWMediaRetryInfo",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a,b){g.set(a,b)}function b(a){return g.get(a)}function c(a){g.has(a)&&g["delete"](a)}f.setRetriedMediaInfo=a;f.getRetriedMediaInfo=b;f.clearRetriedMediaInfo=c}),66);
__d("MAWUpdateMediaEntryForMsgApi",["FBLogger","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWCastToServerMediaType","MAWConfig","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMediaBackupTxns","MAWOptimisticUploadManager","MAWTransactionMode","WAJids","WALogger","WAMediaUtils","err","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing required arguments for media backup"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Nothing to update if updatedMediaEntry is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," msgId does not exist within media entries"]);j=function(){return a};return a}var k=d("MAWIndexedDb").makeMsgrTransactor({media:(a=d("MAWTransactionMode")).READWRITE,mediaBackup:a.READWRITE,messages:a.READONLY,threads:a.READONLY},"updateMediaEntryForMsg",function(a){return function(b,e,f,g,k){var l=d("MAWCastToServerMediaType").castToServerMediaType(k);if(!l){c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Media type unsupported: "+((l=k)!=null?l:""))}return d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e)]).then(function(b){var l=b[0],m=b[1];if(!m)throw c("err")("Message does not exist for the given protocolMsgId");if(!l)throw c("err")("Media does not exist for the given hashedPlaintextHash");if(!l.msgIds.includes(m.msgId)){d("WALogger").LOG(j(),m.msgId);return}b=l.mediaEntries;var n=b.get(m.msgId);n=f(n);if(n==null){d("WALogger").LOG(i());return}b=babelHelpers["extends"]({},l,{mediaEntries:b.set(m.msgId,n)});g!=null&&(b=babelHelpers["extends"]({},b,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(g)}));var o=d("WAMediaUtils").decodeMediaEntryData(n);return a.media.put(b).then(function(b){return g!=null?d("MAWMediaBackupTxns").linkMediaBackup(a,l.mediaId,m.msgId,d("WAMediaUtils").stringToDeliveryObjectId(g)):d("MAWDexieTable").dexieResolve()}).then(function(){var a=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(k),b=o.mediaKeyTimestamp;g!=null&&a!=null&&b!=null&&(a!=="document"||d("MAWConfig").getConfig().enableDocumentBackupAndRestore())&&!c("isInstamadilloEB")()?d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(g,a,e.externalId,d("MAWConfig").getConfig().productTypeForEBAttachments,d("WAJids").threadIdForChatJid(e.chat),m.threadJid,b)}):d("WALogger").WARN(h())})})}});b=function(a,b,c,d,e){l(a,c);return k(a,b,c,d,e)};function l(a,b){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),e=c.get(a);if(e==null)return;b=b();if(b==null)return;c.set(a,babelHelpers["extends"]({},e,{mediaEntry:b}))}g.updateMediaEntryForMsg=b}),98);
__d("WAAPI",["cr:9751"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:9751")}),98);
__d("WAIsMediaExpiredError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){switch(a){case"media-key-expired":case"signature-expired":case"signature-expired-and-resign-failed-no-ids":case"signature-expired-and-resign-failed-cdn-url":return!0;case"missing-media-key-timestamp":case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"media-entry-invalid":case"no-media-entry-no-message":case"no-media-entry-missing-messages":case"no-media-entry-by-plaintext-hash":case"no-host":case"backoff":case"disconnected":case"missing-media-on-save":case"runtime-error":return!1;default:a;return!0}};f.isMediaExpiredError=a}),66);
__d("MAWHandleEchoMediaMsgsRestoreV2",["EchoMessage","EchoMessageMediaFieldUtils","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWAsConsumerApplication","MAWBridge","MAWBridgeTypesCreators","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbChunkTxns","MAWDbMediaTxns","MAWEBBackendQPLUtils","MAWFrontendMediaUtils","MAWGetMediaPlaintextApi","MAWGetStorageQplAnnotations","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWIndexedDb","MAWJids","MAWMediaManagementTxns","MAWMediaRetryInfo","MAWMediaUtils","MAWQplProxy","MAWSupportedDocumentTypes","MAWTraceUtils","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","Promise","WAAPI","WABase64","WAHashStringToNumber","WAHashUtils","WAIsMediaExpiredError","WAJids","WALogger","WAMediaUtils","WAPREList","WAPREMetrics","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find the media entry for message with mediaKey ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find the media entry for message with mediaKey ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media for message: "," is already downloaded on the device"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to construct downloadableThumbnail from previewMediaData: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encrypted hash cannot be null for non-XMA attachments"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot download media - document extension is disallowed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot download media - media content type null"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing from index db. It is required to retry download by resigning cdn url"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["isPointRestore: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media download failed with error: "," "," when downloading. Message timestamp: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Retry download media as signature has expired and should be renewed"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media download complete"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloading media from MI directly"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] start media download from whatsapp infra"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encrypted hash is null - unable to download thumbnail"]);x=function(){return a};return a}var y="media_restore";function z(a){var c=D(a);return c.then(function(c){var d=new Map();a.forEach(function(a){var b=c.get(a);b=b==null?void 0:b.blobData;d.set(a,b)});return(i||(i=b("Promise"))).resolve(d)})}function A(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG:return"image/jpeg";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_PNG:return"image/png";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER:return"image/webp";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF:return"image/gif";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4:return"audio/mp4";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV:return"audio/wav";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.XMA:return"xma"}}function a(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(a.length===0)return(i||(i=b("Promise"))).resolve();var g=[],q=[],r=new Map(),s=new Map();a.map(function(a){var c=a.mediaData,e=a.messageTimestamp,f=F(c.plaintextHash),h=c.attachmentObjectId,j=c.attachmentType,k=c.backupEntFbid,l=c.directPath,t=c.filename,u=c.height,v=c.mediaContentType,w=c.mediaKeyTimestamp,x=c.mediaPlayableDuration,y=c.previewContentHeight,z=c.previewContentType,B=c.previewContentWidth,C=c.size;c=c.width;var D=d("WAHashUtils").stringToPlaintextHash(f),E=d("MAWMediaUtils").genHMACPlaintextHash(D);q.push(E);v=v!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(v,a.isXMA):z!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(A(z)):null;if(v==null){d("WALogger").ERROR(p());return(i||(i=b("Promise"))).resolve()}if(j===d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT&&!d("MAWSupportedDocumentTypes").isAllowedType(t)){d("WALogger").LOG(o());return(i||(i=b("Promise"))).resolve()}z=a.mediaData.encryptedHash;if(z==null&&!a.isXMA){d("WALogger").ERROR(n());return(i||(i=b("Promise"))).resolve()}j=v.mediaType;v=v.serverMediaType;h=d("WAMediaUtils").stringToDeliveryObjectId(h);k=k!=null?d("WAMediaUtils").stringToBackupEntFbid(k):void 0;var J=a.threadJId,K=G({filename:t,height:u,mediaPlayableDuration:x,mediaType:j,previewContentHeight:y,previewContentWidth:B,width:c});s.set(h,{filename:t,height:u,mediaPlayableDuration:x,mediaType:j,messageTimestamp:e,plaintextHash:D,previewContentHeight:y,previewContentWidth:B,serverMediaType:v,threadJId:J,width:c});u=null;if(a.previewMediaData!=null)try{u=I(a.previewMediaData)}catch(a){d("WALogger").ERROR(m(),a)}if(z!=null){x=H(f,z,a.mediaData.mediaKey,l,w,v,t,k,h,u,C);g.push({entry:x,fbId:k,hashedPlaintextHash:E,isXMAShare:a.isXMA,mediaInfo:K,mediaType:j,msgId:a.msgId,objectId:h,plaintextHash:D,size:(e=C)!=null?e:0})}B=(y=r.get(E))!=null?y:[];B.push(a);r.set(E,B)});var t=(yield C(g,e));a=(yield z(q));var u=[];a.forEach(function(a,b){var i=r.get(b);i==null?void 0:i.forEach(function(i){if(i==null)return;if(a!=null){d("WALogger").LOG(l(),i.externalId);var m=t.find(function(a){return a.plaintextHash===i.mediaData.plaintextHash});if(m==null){d("WALogger").LOG(k(),i.mediaData.mediaKey);return}return E(m.msgIds).then(function(a){return d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewMedia",value:d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i.threadJId,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(a,e),hasMediaForUI:!0,media:m})}]})})}var n=d("MAWTraceUtils").startNewTrace((h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_RESTORE),y);d("MAWTraceUtils").recordCheckpointForTrace(n,h.ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_START),[],!1);var o=s.get(d("WAMediaUtils").stringToDeliveryObjectId(i.mediaData.attachmentObjectId));if(i==null||o==null)return;var p=o.filename,q=o.height,r=o.mediaPlayableDuration,v=o.mediaType,w=o.messageTimestamp,x=o.plaintextHash,z=o.previewContentHeight,A=o.previewContentWidth,B=o.serverMediaType,C=o.threadJId;o=o.width;var D=d("WAJids").extractUserId(d("MAWJids").toUserJid(i.threadJId));B=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(B,i.isXMA);if(B!=null){B={attachmentFbId:i.mediaData.backupEntFbid,attachmentObjectId:d("WAMediaUtils").stringToDeliveryObjectId(i.mediaData.attachmentObjectId),mediaType:B,messageId:i.externalId,messageTimeStamp:i.messageTimestamp,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,threadId:D,threadJid:C};D=g.find(function(a){return a.hashedPlaintextHash===b});D=D==null?void 0:D.entry;if(D==null){d("WALogger").ERROR(j(),i.mediaData.mediaKey);return}u.push(J({author:i.author,directPath:i.mediaData.directPath,echoMsg:i.echoMsg,externalId:i.externalId,filename:p,hashedPlaintextHash:b,height:q,isXMA:i.isXMA,mediaPlayableDuration:r,mediaType:v,messageTimestamp:w,plaintextHash:x,previewContentHeight:z,previewContentWidth:A,threadJId:C,width:o},n,B,void 0,d("WAMediaUtils").decodeMediaEntryData(D),f))}})});yield (i||(i=b("Promise"))).all(u)});return B.apply(this,arguments)}var C=(e=d("MAWIndexedDb")).makeMsgrTransactor({media:(f=d("MAWTransactionMode")).READWRITE,mediaBackup:f.READWRITE,messages:f.READWRITE},"restoreLinkMedias",function(a){return function(b,c){return d("MAWMediaManagementTxns").bulkLinkMedia(a,b,c)}}),D=e.makeMsgrTransactor({chunk:f.READONLY},"getChunksByHash",function(a){return function(b){return d("MAWDbChunkTxns").maybeBulkGetChunksFromHash(a,b)}}),E=e.makeMsgrTransactor({messages:f.READONLY},"getMessagesForMsgIds",function(a){return function(b){return a.messages.where("msgId").anyOf(b).toArray()}});function F(a){if(a.endsWith("=")){var b="";for(var c=0;c<a.length;c++){var d=a.charAt(c);if(d==="=")return b;b+=d}}return a}function G(a){var b=a.height,c=a.mediaType,e=a.width,f=a.previewContentHeight,g=a.previewContentWidth,h=a.mediaPlayableDuration;a=a.filename;return{validatedAudioInfo:c==="Ptt"&&h!=null?{duration:M(h),mimetype:d("MAWAsConsumerApplication").AUDIO_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:c==="DocumentFile"?{filename:a,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:c==="Image"?{height:b,jpegThumbnailHeight:f,jpegThumbnailWidth:g,width:e}:c==="Gif"||c==="Sticker"?{height:b,jpegThumbnailHeight:b,jpegThumbnailWidth:e,width:e}:null,validatedVideoInfo:c==="Video"?{height:b,jpegThumbnailHeight:f,jpegThumbnailWidth:g,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:e}:null}}function H(a,b,c,e,f,g,h,i,j,k,l){a=d("WABase64").decodeB64UrlSafe(a,!0);b=d("WABase64").decodeB64UrlSafe(b,!0);c=c!=null?d("WABase64").decodeB64UrlSafe(c,!0):void 0;return d("WAMediaUtils").rawDataToMediaEntry({directPath:e,downloadableThumbnail:k!=null?k:void 0,fbid:i!=null?i:void 0,fileEncSha256:b,filename:h,fileSha256:a,mediaKey:c,mediaKeyTimestamp:f!=null?d("WATimeUtils").castToUnixTime(f):void 0,objectId:j!=null?j:void 0,serverMediaType:g,size:l!=null?l:void 0})}function I(a){var b=a.attachmentObjectId,c=a.directPath,e=a.encryptedHash,f=a.mediaKey,g=a.mediaKeyTimestamp;a=a.plaintextHash;if(e==null){d("WALogger").ERROR(x());return}else{g=g!=null?d("WATimeUtils").castToUnixTime(g):void 0;f=f!=null?d("WAMediaUtils").castToMediaKey(d("WABase64").decodeB64UrlSafe(f,!0)):void 0;a=d("WABase64").decodeB64UrlSafe(a,!0);e=d("WABase64").decodeB64UrlSafe(e,!0);return{directPath:c,fileEncSha256:e,fileSha256:a,mediaKey:f,mediaKeyTimestamp:g,objectId:b}}}var J=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i){var j,k;d("WALogger").LOG(w());var l=a.author,m=a.externalId,n=a.filename,o=a.hashedPlaintextHash,p=a.height,q=a.mediaPlayableDuration,r=a.mediaType,x=a.messageTimestamp,y=a.plaintextHash,z=a.previewContentHeight,A=a.previewContentWidth,B=a.threadJId,C=a.width,D=d("WAJids").switchOnMsgrChatJidType(B,{group:function(a){return"group"},user:function(a){return"user"}});j=((j=(j=d("MAWMediaRetryInfo").getRetriedMediaInfo(m))==null?void 0:j.isXMA)!=null?j:!1)||((j=a==null?void 0:a.isXMA)!=null?j:!1);k=((k=d("MAWMediaRetryInfo").getRetriedMediaInfo(m))==null?void 0:(k=k.echoMsg)==null?void 0:k.serializationOrigin)||(a==null?void 0:(k=a.echoMsg)==null?void 0:k.serializationOrigin)||d("EchoMessage").EchoSerializationOriginType.UNKNOWN;var E=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isRetryFromMI:e==null,isXMA:j,pathMismatch:f!==g.directPath},"int":{mediaEntrySize:g.size},string:{chat_type:D,downloadEntry:"handleEchoMediaMsgsRestore",oldDirectPath:(j=a==null?void 0:a.oldDirectPath)!=null?j:"",origin:k,restorationCdnUrl:(D=f)!=null?D:""}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);void d("MAWGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){E.addAnnotations(a)});if(e!=null&&c("gkx")("23960")){d("WALogger").LOG(v());d("MAWMediaRetryInfo").setRetriedMediaInfo(m,a);return K(m,e,b)}j={author:l,chat:B,externalId:m};k=(yield c("WAAPI").downloadMedia({downloadMediaMetric:E,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload,hash:y,mediaEntry:g,onlyIfMediaTTLIsValid:f==null?d("MAWConfig").getConfig().skipExpiredDownload():!1,protocolMsgId:j,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg}));if(k.success){D=k.value;l=D.mimeType;B=D.plaintext;yield d("MAWHandleMediaDownloadApi").handleMediaDownload(y,l,B,j);E.endSuccess();d("MAWMediaRetryInfo").clearRetriedMediaInfo(m);g=G({filename:n,height:p,mediaPlayableDuration:q,mediaType:r,previewContentHeight:z,previewContentWidth:A,width:C});yield L(o,g);d("WALogger").LOG(u());d("MAWTraceUtils").recordSuccessAndFlushForTraceId(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_SUCCESS),[]);e==null&&b!=null&&d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521485815,"2166"),void 0,d("WAHashStringToNumber").hashStringToNumber(b))}else{f=k.error;d("WAIsMediaExpiredError").isMediaExpiredError(f)&&e?(E.addPoint("eb_resign_requested"),E.endSuccess(),d("WALogger").WARN(t()),d("MAWMediaRetryInfo").setRetriedMediaInfo(m,a),yield K(m,e,b,i)):(E.endFail(f),d("WALogger").ERROR(s(),m,f,x),d("MAWMediaRetryInfo").clearRetriedMediaInfo(m),d("MAWTraceUtils").recordFailureAndFlushForTraceId(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"media download failed with error: "+f),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(b,"media_download_failure"))}});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}(),K=e.makeMsgrTransactor({media:f.READONLY,mediaBackup:f.READONLY},"invokeRestoreAccessCheckSprocToDownloadAttachment",function(a){return function(b,e,f,g){var i=d("WAMediaUtils").stringToDeliveryObjectId(e.attachmentObjectId);return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,i).then(function(a){if(a){var i;if(f!=null&&e!=null){var j;a=d("WAHashStringToNumber").hashStringToNumber(f);j={bool:{isPointRestore:(j=g)!=null?j:!1},string:{mediaType:e.mediaType}};i=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521485815,"2166"),j,a)}d("WATagsLogger").TAGS(["labyrinth_web","media_restore",(j=f)!=null?j:""]).LOG(r(),g);g===!0?i!=null&&i.endSuccess():d("MAWIndexedDb").afterTransaction({tag:"ResignAttachmentCDNUrl",value:{backupEntFbid:e.attachmentFbId,chatId:e.chatId==null?void 0:e.chatId.toString(),deliveryObjectId:e.attachmentObjectId,mediaType:e.mediaType,messageId:b,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:e.messageTimeStamp,threadId:e.threadId,threadJid:e.threadJid,traceId:f}})}else d("WALogger").ERROR(q()),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"media entry is missing from index db. It is required to retry download by resigning cdn url")})}}),L=e.makeMsgrTransactor({media:f.READWRITE,messages:f.READWRITE},"updateMediaWithDownloadedChunkBlob",function(a){return function(b,c){return d("MAWMediaManagementTxns").updateMediaEntryWithValidatedMediaInfo(a,b,c)}});function M(a){var b=Math.floor(a/1e3);if(b>0)return b;else return a}g.downloadMediaAndWriteToMediaStore=a;g.getBase64WithoutPadding=F;g.constructMediaEntry=H;g.handleDownloadMedia=J;g.invokeRestoreAccessCheckSprocToDownloadAttachment=K}),98);
__d("MAWParseNoteReplyMsg",["MAWMsgType","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=a.content;a=a.meta;e=e.noteReplyMessage;if(e==null)throw c("err")("noteReplyMessage has no content");b=(b=e.textContent)==null?void 0:b.text;if(b==null)throw c("err")("noteReplyMessage has no text content");e=(e=e.noteText)==null?void 0:e.text;if(e==null)throw c("err")("noteReplyMessage has no note text");b={ack:a.ack,forwardingScore:a.forwardingScore,id:{author:a.id.author,chat:a.id.chat,externalId:a.id.externalId},msgContent:{content:b},quote:{content:{author:a.id.author,externalId:a.id.externalId,msgContent:{content:e},ts:a.serverTs,type:d("WAMsgType").NOTE_REPLY},remoteJid:a.id.chat},ts:a.serverTs,type:d("MAWMsgType").MSG_TYPE.TEXT};return{contentTypeForLogging:"noteReplyMessage",unstoredMedia:null,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g["default"]=a}),98);
__d("MAWParseRavenActionNotificationMsg",["MAWConfig","MAWMsg","WAStanzaUtils","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e,f=a.content;a=a.meta;if(!d("MAWConfig").getConfig().isRavenMessagesEnabled())return{unstoredMedia:null,unstoredMsg:null,unstoredQuotedMedia:null,unstoredXMA:null};b=(b=f.ravenActionNotifMessage)==null?void 0:b.actionType;b=d("MAWMsg").MAWRavenActionNotifType.cast(b);e=(e=f.ravenActionNotifMessage)==null?void 0:e.actionTimestamp;var g;if(e!=null){e=Number(e);e>d("WATimeUtils").MAX_INT?g=d("WATimeUtils").castMilliSecondsToUnixTime(e):g=d("WATimeUtils").castToUnixTime(e)}e=((e=f.ravenActionNotifMessage)==null?void 0:(e=e.key)==null?void 0:e.id)!=null?d("WAStanzaUtils").toStanzaId((e=f.ravenActionNotifMessage)==null?void 0:(f=e.key)==null?void 0:f.id):null;if(b==null)throw c("err")("Error when getting actionType for RavenNotificationMessage "+a.id.externalId);if(g==null)throw c("err")("Error when getting actionTimestamp for RavenNotificationMessage "+a.id.externalId);if(e==null)throw c("err")("Error when getting ravenActionToMsgExternalId for RavenNotificationMessage "+a.id.externalId);f={ack:a.ack,actionTimestamp:g,actionType:b,id:a.id,ravenActionToMsgExternalId:e,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.serverTs,type:"RavenAction"};return{unstoredMedia:null,unstoredMsg:f,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenActionNotificationMessage=a}),98);
__d("MAWParseSubprotocolVersionConsts",[],(function(a,b,c,d,e,f){"use strict";a=2;b=2;c=1;d=2;e=1;var g=1;f.ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION=a;f.XMA_PREVIEW_SUBPROTOCOL_VERSION=b;f.XMA_FAVICON_SUBPROTOCOL_VERSION=c;f.XMA_HEADER_SUBPROTOCOL_VERSION=d;f.RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION=e;f.RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION=g}),66);
__d("WAMessageKey",["WAErr","WAGlobals","WAJids","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a===d("WAJids").AUTHOR_ME||a==d("WAGlobals").getMyUserJid()}function a(a,b,e){if(e==null)throw c("WAErr")("messageKey is null");var f=e.id,g=e.remoteJid;if(f==null)throw c("WAErr")("messageKey.id is null");else if(g==null)throw c("WAErr")("messageKey.remoteJid is null");g=d("WAJids").interpretAndValidateJid(g);if(g.jidType==="unknown")throw c("WAErr")("messageKey.remoteJid is invalid");var i,j=d("WAJids").AUTHOR_ME;if(g.jidType==="group"){i=g.groupJid;if(h(b)&&e.fromMe===!0)j=d("WAJids").AUTHOR_ME;else if(e.fromMe==!0)j=b;else{var k=e.participant;if(k==null)throw c("WAErr")("key.participant is null");k=d("WAJids").interpretAndValidateJid(k);if(k.jidType==="msgrUser")j=k.userJid;else throw c("WAErr")("key.participant is invalid")}}else if(g.jidType==="msgrUser"||g.jidType==="msgrDevice"){k=d("WAJids").interpretAndValidateJid(a);if(k.jidType!=="msgrUser")throw c("WAErr")("expected user type jid.");i=k.userJid;h(b)?e.fromMe===!0?j=d("WAJids").AUTHOR_ME:j=k.userJid:e.fromMe===!0&&(j=k.userJid)}else throw c("WAErr")("Unsupported jidtype type");return{chat:i,author:h(j)?d("WAJids").AUTHOR_ME:j,externalId:d("WAStanzaUtils").toStanzaId(f)}}g.extractProtocolMessageId=a}),98);
__d("WAParseConsumerMessagePollCreation",["WAGlobals","WAHex","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){a={unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:d("WAGlobals").getConfig().isUnsupportedMessagesRedesignEnabled()?"pollCreationMessage":null},id:b.id,ts:b.ts,sentTs:b.sentTs,serverTs:b.serverTs,ack:b.ack,reportingMeta:c},unstoredMedia:null,unstoredQuotedMedia:null};return!e||!d("WAGlobals").getConfig().isPollsFallbackExperienceEnabled()?a:a}g["default"]=a}),98);
__d("WAParseProtocolUtils",["WAGlobals","WALogger","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported franking version ",""]);h=function(){return a};return a}function a(a,b){b=i(b,a.serverTs);a=b==null?void 0:b.expirationTs;var c=b==null?void 0:b.deleteTs;b=b==null?void 0:b.ephemeralSetting;return{expirationTs:a,deleteTs:c,ephemeralSetting:b}}function b(a,b){b=j(b);b!=null&&(a.reportingMeta=b);return b}function i(a,b){var c;c=a==null?void 0:(c=a.chatEphemeralSetting)==null?void 0:c.ephemeralExpiration;a=a==null?void 0:(a=a.chatEphemeralSetting)==null?void 0:a.ephemeralSettingTimestamp;if(c==null||a==null||c===0||!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return null;b=d("WATimeUtils").castToUnixTime(b+d("WAGlobals").getDependencies().ephemeralMaxDeletionWindowForUnseenMessage());var e=b,f=null;try{a=d("WALongInt").numberOrThrowIfTooLarge(a)/1e3;f=d("WATimeUtils").castToUnixTime(a)}catch(a){return null}return{expirationTs:b,deleteTs:e,ephemeralSetting:{expirationTs:c,updatedTs:f}}}function j(a){a=a==null?void 0:a.frankingVersion;a!=null&&a!==0&&d("WALogger").ERROR(h(),a);return{frankingKey:void 0,frankingTag:void 0,frankingVersion:a,reportingContent:void 0,reportingTag:void 0}}g.parseEphemerality=a;g.enhanceReportingMeta=b}),98);
__d("WAParseConsumerMessageProtocol",["WACommon.pb","WAConsumerApplication.pb","WAErr","WAGlobals","WAHex","WAJids","WALogger","WAMediaTransport.pb","WAMessageKey","WAMsgType","WAParseConsumerMessagePollCreation","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAResultOrError","WAStanzaUtils","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseConsumerMessageProtocol error :",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAParseConsumerMessageProtocol - ephemeralSetting duration is invalid ",", jidType: ",""]);i=function(){return a};return a}var j=90*d("WATimeUtils").DAY_SECONDS;b=1;e=0;f=1;f=d("WAGlobals").getConfig().armadilloWebProcessFutureproof()?f+1:f;function a(a,b,e,f,g){var k;b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);k=(k=b.payload)==null?void 0:(k=k.applicationData)==null?void 0:(k=k.revoke)==null?void 0:(k=k.key)==null?void 0:k.id;if(k!=null)return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.REVOKED,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta,revokedExternalId:d("WAStanzaUtils").toStanzaId(k),unsendMsgContentDeleteTs:null,msgContent:null},unstoredMedia:null,unstoredQuotedMedia:null};var l=(g==null?void 0:g.isForwarded)||!1;k=d("WAParseProtocolUtils").parseEphemerality(e,g);var m=k.expirationTs,w=k.deleteTs,x=k.ephemeralSetting;if(x!=null&&(x.expirationTs<0||x.expirationTs>j)){k=d("WAJids").interpretAndValidateJid(a);k=k.jidType;var y=x.expirationTs;d("WALogger").ERROR(i(),y,k)}var z=d("WAParseProtocolUtils").enhanceReportingMeta(e,g),A=(y=o(g))!=null?y:void 0,B=(k=b.payload)==null?void 0:k.content;if(!B)return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};var C=(y=b.metadata)==null?void 0:y.specialTextSize,D=t(B),E={contentTypeForLogging:D,unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:z},unstoredMedia:null,unstoredQuotedMedia:null};k=function(){try{switch(D){case"messageText":var b,i=B[D];if(i==null)throw c("WAErr")("consumerMessage has no messageText");b=((b=i.commands)==null?void 0:b.some(function(a){return a.commandType===d("WACommon.pb").COMMAND_COMMAND_TYPE.AI}))===!0;if(b)return babelHelpers["extends"]({},E,{unstoredMsg:babelHelpers["extends"]({},E.unstoredMsg,{msgContent:babelHelpers["extends"]({},E.unstoredMsg.msgContent,{subtype:d("WAGlobals").getConfig().isUnsupportedMessagesRedesignEnabled()?"metaAiMessage":null})})});if(i.text==null)throw c("WAErr")("consumerMessage has no messageText");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:i.text,mentionedJids:i.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l},e,{specialTextSize:C}),unstoredMedia:null,unstoredQuotedMedia:null};case"reactionMessage":return{unstoredMsg:n(a,e,B[D]),unstoredMedia:null,unstoredQuotedMedia:null};case"imageMessage":b=p(B,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.IMAGE,quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l,mediaId:b.plaintextHash},e),unstoredMedia:b,unstoredQuotedMedia:null};case"videoMessage":var j,k;i=B[D];if(i==null)throw c("WAErr")("consumerMessage has no videoMessage");b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,i==null?void 0:(b=i.video)==null?void 0:b.payload);j=b==null?void 0:(j=b.integral)==null?void 0:(j=j.transport)==null?void 0:(j=j.ancillary)==null?void 0:j.mimetype;k=(b==null?void 0:(k=b.ancillary)==null?void 0:k.gifPlayback)===!0&&j==="image/gif";if(k&&!d("WAGlobals").getConfig().isGifEnabled())return E;j=d("WAParseMediaTransportProtocol").parseVideoMsg(b,e.ts,k);if(j==null)throw c("WAErr")("consumerMessage has no video media info");if(v(g)&&((b=i.caption)==null?void 0:b.text)!=null){return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:(b=i.caption)==null?void 0:b.text,mentionedJids:i.caption.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l},e,{specialTextSize:C}),unstoredMedia:null,unstoredQuotedMedia:null}}return{unstoredMsg:k?babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.GIF},e,{quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l,reportingMeta:z,mediaId:j.plaintextHash}):babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.VIDEO},e,{quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l,mediaId:j.plaintextHash}),unstoredMedia:j,unstoredQuotedMedia:null};case"audioMessage":b=q(B,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.PTT,quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l,mediaId:b.plaintextHash},e),unstoredMedia:b,unstoredQuotedMedia:null};case"stickerMessage":if(d("WAGlobals").getConfig().isStickerEnabled()){i=r(B);k=d("WAParseMediaTransportProtocol").parseStickerMsg(i,e.ts);if(k==null){if(((j=i.integral)==null?void 0:j.receiverFetchId)!=null)return babelHelpers["extends"]({},E,{unstoredMsg:babelHelpers["extends"]({},E.unstoredMsg,{msgContent:babelHelpers["extends"]({},E.unstoredMsg.msgContent,{subtype:"stickerReceiverFetchMessage"})})});throw c("WAErr")("consumerMessage has no sticker media info")}return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.STICKER,quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l,reportingMeta:z,mediaId:k.plaintextHash},e),unstoredMedia:k,unstoredQuotedMedia:null}}return E;case"documentMessage":if(d("WAGlobals").getConfig().isDocumentReceiveEnabled()){b=s(B,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.DOCUMENT_FILE,quote:A,expirationTs:m,deleteTs:w,ephemeralSetting:x,isForwarded:l,reportingMeta:z,mediaId:b.plaintextHash},e),unstoredMedia:b,unstoredQuotedMedia:null}}return E;case"groupInviteMessage":return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null,unstoredIncomingGroupInvite:u(e,B)};case"editMessage":i=B[D];j=i==null?void 0:i.message;k=j==null?void 0:j.text;b=i==null?void 0:(b=i.key)==null?void 0:b.id;if(i==null||j==null||k==null)throw c("WAErr")("consumerMessage with editMessage type has no editMessage");if(b==null)throw c("WAErr")("consumerMessage with editMessage type has no original Msg External Id.");i=d("WAStanzaUtils").toStanzaId(b);return{unstoredEditMsg:{type:d("WAMsgType").MSG_TYPE.EDIT_ACTION,editMsgContent:{content:k,mentionedJids:j.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},originalMsgExternalId:i,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:z,specialTextSize:C},unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};case"pollCreationMessage":return c("WAParseConsumerMessagePollCreation")(f,e,z,B[D]);case"pollUpdateMessage":return d("WAGlobals").getConfig().isUnsupportedMessagesRedesignEnabled()?{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}:E;case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return E}}catch(a){d("WALogger").ERROR(h(),a);return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}}}();return babelHelpers["extends"]({},k,{contentTypeForLogging:D})}function k(a){if(d("WAJids").isAuthorSystem(a))throw c("WAErr")("Got system author");return a}var l=30;function m(a){if(a==null)return d("WAResultOrError").makeResult(null);return a.length>l?d("WAResultOrError").makeError("invalid-reaction-text-length"):d("WAResultOrError").makeResult(a)}function n(a,b,e){if(e==null)throw c("WAErr")("consumerMessage has no reactionMessage");var f=k(b.id.author);a=d("WAMessageKey").extractProtocolMessageId(a,f,e.key);f=e.text;var g=e.groupingKey;e=e.senderTimestampMs;var h=m(f);if(!h.success){throw c("WAErr")('"'+((f=f)!=null?f:"")+'" is not a valid reaction ['+h.error+"]")}return{type:d("WAMsgType").MSG_TYPE.REACTION,ack:b.ack,id:b.id,reactToExternalId:a.externalId,reactToAuthor:a.author,reaction:h.value,groupingKey:g,ts:b.ts,senderTimestampMs:e}}function o(a){var b,e;b=a==null?void 0:(b=a.quotedMessage)==null?void 0:b.stanzaId;e=a==null?void 0:(e=a.quotedMessage)==null?void 0:e.participant;a=a==null?void 0:(a=a.quotedMessage)==null?void 0:a.remoteJid;e=e!=null?d("WAJids").interpretAndValidateJid(e):null;var f;(e==null?void 0:e.jidType)==="msgrUser"&&e.userJid===d("WAGlobals").getMyUserJid()?f=d("WAJids").AUTHOR_ME:(e==null?void 0:e.jidType)==="msgrUser"?f=e.userJid:f=d("WAJids").AUTHOR_ME;if(b==null)return null;e={type:d("WAMsgType").MSG_TYPE.UNAVAILABLE,author:f,externalId:d("WAStanzaUtils").toStanzaId(b),ts:null};if(a!=null){f=d("WAJids").interpretAndValidateJid(a);if(f.jidType==="group")return{remoteJid:f.groupJid,content:e};else throw c("WAErr")("not supported")}else return{remoteJid:null,content:e}}function p(a,b){a=a.imageMessage;if(a==null)throw c("WAErr")("consumerMessage has no imageMessage");return d("WAParseMediaTransportProtocol").decodeImageTransport(a==null?void 0:(a=a.image)==null?void 0:a.payload,b)}function q(a,b){var e;a=a.audioMessage;if(a==null)throw c("WAErr")("consumerMessage has no audioMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").AudioTransportSpec,a==null?void 0:(e=a.audio)==null?void 0:e.payload);e=d("WAParseMediaTransportProtocol").parseAudioMsg(e,(a==null?void 0:a.ptt)||!1,b);if(e==null)throw c("WAErr")("consumerMessage has no audio media info");return e}function r(a){a=a.stickerMessage;if(a==null)throw c("WAErr")("consumerMessage has no stickerMessage");return d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").StickerTransportSpec,a==null?void 0:(a=a.sticker)==null?void 0:a.payload)}function s(a,b){var e;a=a.documentMessage;if(a==null)throw c("WAErr")("consumerMessage has no documentMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").DocumentTransportSpec,a==null?void 0:(e=a.document)==null?void 0:e.payload);a=a==null?void 0:a.fileName;e=d("WAParseMediaTransportProtocol").parseDocumentMsg(e,a,b);if(e==null)throw c("WAErr")("consumerMessage has no document media info");return e}function t(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("WAErr")(JSON.stringify(a)+" consumerMessage payload content should have exactly one field, instead found "+JSON.stringify(b));return b[0]}function u(a,b){b=b.groupInviteMessage;if(b==null)throw c("WAErr")("consumerMessage has no GroupInvite Data");return babelHelpers["extends"]({ack:a.ack,author:a.id.author,externalId:a.id.externalId,ts:a.ts},b)}function v(a){if((a==null?void 0:a.readonlyMetadataDataclass)!=null)try{a=JSON.parse(a==null?void 0:a.readonlyMetadataDataclass);return(a==null?void 0:(a=a.power_up)==null?void 0:a.power_up_style)!=null}catch(a){throw c("WAErr")("Failed to parse readonly metadata dataclass JSON")}return!1}g.MINIMAL_MEDIA_DURATION=b;g.DEFAULT_FILE_SIZE=e;g.SUPPORTED_TYPES_VERSION=f;g.parseConsumerMessageProtocol=a;g.interpretAsNonSystemAuthor=k;g.validReactionMessageText=m;g.parseReactionMessage=n;g.parsedQuotedConsumerMessage=o;g.parseOneOfContentType=t}),98);
__d("WAMedia",[],(function(a,b,c,d,e,f){"use strict";a="Image";b="Video";c="Ptt";d="Gif";e="Sticker";var g="DocumentFile",h={IMAGE:a,VIDEO:b,PTT:c,GIF:d,STICKER:e,DOCUMENT_FILE:g};f.IMAGE=a;f.VIDEO=b;f.PTT=c;f.GIF=d;f.STICKER=e;f.DOCUMENT_FILE=g;f.MEDIA_TYPE=h}),66);
__d("WAParseMediaTransportProtocol",["WAConsumerApplication.pb","WAErr","WAHashUtils","WALogger","WALongInt","WAMedia","WAMediaTransport.pb","WAMediaUtils","WAMsgMap","WAParseConsumerMessageProtocol","WAProgressiveJpegGetScanLengths","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadableThumbnail is missing some required fields"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseMediaKey error :",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is unknown fileds in integral of VideoTransport"]);m=function(){return a};return a}function n(a,b,c){var e,f,g;if(!((e=a.integral)==null?void 0:e.transport))return null;e=(e=a.integral)==null?void 0:e.transport;if(d("decodeProtobuf").getUnknownFields(e.integral)!=null){d("WALogger").ERROR(m());return null}f=(f=e.integral)==null?void 0:f.fileSha256;if(!f){d("WALogger").ERROR(l());return null}var h=null;if(((g=a.ancillary)==null?void 0:g.scansSidecar)!=null&&((g=a.ancillary)==null?void 0:g.scanLengths)!=null){h={sidecar:(g=a.ancillary)==null?void 0:g.scansSidecar,scanLengths:(g=a.ancillary)==null?void 0:(a=g.scanLengths)==null?void 0:a.map(d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength)}}if(((g=e.integral)==null?void 0:g.fileSha256)==null||((a=e.integral)==null?void 0:a.fileEncSha256)==null||((g=e.integral)==null?void 0:g.mediaKey)==null||((a=e.integral)==null?void 0:a.directPath)==null||((g=e.integral)==null?void 0:g.mediaKeyTimestamp)==null||((a=e.ancillary)==null?void 0:a.objectId)==null){d("WALogger").ERROR(k());return null}a=(g=e.ancillary)==null?void 0:g.fileLength;g=(g=e.ancillary.thumbnail)==null?void 0:g.downloadableThumbnail;e=d("WAMediaUtils").rawDataToMediaEntry({fileSha256:e.integral.fileSha256,fileEncSha256:e.integral.fileEncSha256,mediaKey:e.integral.mediaKey,directPath:e.integral.directPath,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(e.integral.mediaKeyTimestamp),serverMediaType:b,objectId:(b=e.ancillary)==null?void 0:b.objectId,fbid:void 0,downloadableThumbnail:{directPath:g==null?void 0:g.directPath,fileEncSha256:g==null?void 0:g.fileEncSha256,fileSha256:g==null?void 0:g.fileSha256,mediaKey:g==null?void 0:g.mediaKey,mediaKeyTimestamp:(g==null?void 0:g.mediaKeyTimestamp)==null?null:d("WATimeUtils").castLongIntToUnixTime(g==null?void 0:g.mediaKeyTimestamp),objectId:g==null?void 0:g.objectId},filename:c,progressiveJpegDetails:h,size:a==null?a:d("WALongInt").numberOrThrowIfTooLarge(a)});return{size:a==null?d("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE:d("WALongInt").numberOrThrowIfTooLarge(a),plaintextHash:d("WAHashUtils").toPlaintextHash(new Uint8Array(f)),mediaEntry:e}}function o(a,b){var c,e=n(a,"image");if(!e)return null;e=q(e,b);b=(b=a.ancillary)==null?void 0:b.width;c=(c=a.ancillary)==null?void 0:c.height;a.ancillary!=null&&(a.ancillary.width!=null&&a.ancillary.width===4294967295&&(b=void 0),a.ancillary.height!=null&&a.ancillary.height===4294967295&&(c=void 0));c=babelHelpers["extends"]({},e,{mediaType:d("WAMedia").MEDIA_TYPE.IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:b,height:c,jpegThumbnail:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(c=b.ancillary)==null?void 0:(e=c.thumbnail)==null?void 0:e.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(e=c.ancillary)==null?void 0:(b=e.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(c=a.integral)==null?void 0:(e=c.transport)==null?void 0:(b=e.ancillary)==null?void 0:(a=b.thumbnail)==null?void 0:a.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return c}function a(a,b){a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,a);a=o(a,b);if(a==null)throw c("WAErr")("consumerMessage has no image media info");return a}function b(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=n(a,c?"gif":"video");if(!e)return null;e=q(e,b);e=babelHelpers["extends"]({},e,{mediaType:c?d("WAMedia").MEDIA_TYPE.GIF:d("WAMedia").MEDIA_TYPE.VIDEO,validatedVideoInfo:c?null:{duration:(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)!=null&&(a==null?void 0:(e=a.ancillary)==null?void 0:e.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,width:a==null?void 0:(e=a.ancillary)==null?void 0:e.width,height:a==null?void 0:(b=a.ancillary)==null?void 0:b.height,mimetype:a==null?void 0:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(e=b.ancillary)==null?void 0:e.mimetype,jpegThumbnail:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailWidth},validatedImageInfo:c?{width:(b=a.ancillary)==null?void 0:b.width,height:(e=a.ancillary)==null?void 0:e.height,jpegThumbnail:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(e=b.ancillary)==null?void 0:(c=e.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(c=e.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null?void 0:(c=e.transport)==null?void 0:(b=c.ancillary)==null?void 0:(a=b.thumbnail)==null?void 0:a.thumbnailWidth}:null,validatedAudioInfo:null,validatedDocumentFileInfo:null});return e}function e(a,b,c){if(!((b=a.integral)==null?void 0:b.transport))return null;b=n(a,"ptt");if(!b)return null;b=q(b,c);b=babelHelpers["extends"]({},b,{mediaType:d("WAMedia").MEDIA_TYPE.PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedDocumentFileInfo:null,validatedAudioInfo:{duration:(a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds)!=null&&(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,mimetype:a==null?void 0:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:a.mimetype,played:!1}});return b}function f(a,b){var c;if(!((c=a.integral)==null?void 0:c.transport))return null;c=n(a,"sticker");if(!c)return null;c=q(c,b);c=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").MEDIA_TYPE.STICKER,validatedVideoInfo:null,validatedImageInfo:{width:(b=a.ancillary)==null?void 0:b.width,height:(c=a.ancillary)==null?void 0:c.height,jpegThumbnail:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(b=c.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(b=c.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:(b=a.thumbnail)==null?void 0:b.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return c}function p(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=n(a,"document",b);if(!e)return null;e=q(e,c);return babelHelpers["extends"]({},e,{mediaType:d("WAMedia").MEDIA_TYPE.DOCUMENT_FILE,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:null,validatedDocumentFileInfo:{mimetype:a==null?void 0:(c=a.integral)==null?void 0:(e=c.transport)==null?void 0:(a=e.ancillary)==null?void 0:a.mimetype,filename:(c=b)!=null?c:void 0}})}function q(a,b){return{mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,size:a.size,msgIds:[],mediaEntries:new(d("WAMsgMap").MsgMap)(),ts:b}}function r(a){a=a.msg;if(a.subprotocolType!=="consumerMessage")return[];a=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a.subprotocol);if(a.payload==null||a.payload.content==null)return[];var b=a.payload.content;a=d("WAParseConsumerMessageProtocol").parseOneOfContentType(a.payload.content);try{switch(a){case"imageMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(a=b.imageMessage)==null?void 0:(a=a.image)==null?void 0:a.payload);return s(a,"image");case"videoMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,(a=b.videoMessage)==null?void 0:(a=a.video)==null?void 0:a.payload);return s(a,"video");case"audioMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,(a=b.audioMessage)==null?void 0:(a=a.audio)==null?void 0:a.payload);return s(a,"ptt");case"stickerMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,(a=b.stickerMessage)==null?void 0:(a=a.sticker)==null?void 0:a.payload);return s(a,"sticker");case"documentMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,(a=b.documentMessage)==null?void 0:(b=a.document)==null?void 0:b.payload);return s(a,"document");case"groupInviteMessage":case"editMessage":case"pollCreationMessage":case"pollUpdateMessage":case"messageText":case"reactionMessage":case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return[]}}catch(a){d("WALogger").ERROR(j(),a);return[]}}function s(a,b){var c,e;if(!((c=a.integral)==null?void 0:c.transport))return[];c=(c=a.integral)==null?void 0:c.transport;if(c.integral==null||((e=c.integral)==null?void 0:e.fileSha256)==null||((e=c.integral)==null?void 0:e.fileEncSha256)==null||((e=c.integral)==null?void 0:e.mediaKey)==null||((e=c.integral)==null?void 0:e.directPath)==null||((e=c.integral)==null?void 0:e.mediaKeyTimestamp)==null||((e=c.ancillary)==null?void 0:e.objectId)==null){d("WALogger").ERROR(i());return[]}e=c.integral;var f=e.fileSha256,g=e.fileEncSha256,j=e.mediaKey,k=e.directPath;e=e.mediaKeyTimestamp;b={directPath:k,plaintextHash:d("WAHashUtils").toPlaintextHash(f),ciphertextHash:d("WAHashUtils").toCiphertextHash(g),fbid:void 0,fileEncSha256:g,fileSha256:f,mediaKey:j,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(e),objectId:(k=c.ancillary)==null?void 0:k.objectId,serverMediaType:b,sidecar:((g=a.ancillary)==null?void 0:g.scansSidecar)||((f=a.ancillary)==null?void 0:f.sidecar),size:d("WALongInt").maybeNumberOrThrowIfTooLarge((j=c.ancillary)==null?void 0:j.fileLength),scanLengths:(e=a.ancillary)==null?void 0:(k=e.scanLengths)==null?void 0:k.map(d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength),uploadToken:void 0};j=(g=c.ancillary)==null?void 0:(f=g.thumbnail)==null?void 0:f.downloadableThumbnail;a=null;if(j!=null&&(j==null?void 0:j.fileSha256)!=null&&(j==null?void 0:j.fileEncSha256)!=null&&(j==null?void 0:j.mediaKey)!=null&&(j==null?void 0:j.directPath)!=null&&(j==null?void 0:j.mediaKeyTimestamp)!=null&&(j==null?void 0:j.objectId)!=null){e=j.fileSha256;k=j.fileEncSha256;c=j.mediaKey;g=j.directPath;f=j.mediaKeyTimestamp;var l=j.objectId;a={ciphertextHash:d("WAHashUtils").toCiphertextHash(k),directPath:g,fileEncSha256:k,fileSha256:e,mediaKey:c,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(f),objectId:l,plaintextHash:d("WAHashUtils").toPlaintextHash(e),scanLengths:void 0,serverMediaType:"preview",sidecar:void 0,uploadToken:void 0,size:void 0}}else j!=null&&d("WALogger").ERROR(h());return[b,a].filter(Boolean)}g.getMediaMeta=n;g.parseImageMsg=o;g.decodeImageTransport=a;g.parseVideoMsg=b;g.parseAudioMsg=e;g.parseStickerMsg=f;g.parseDocumentMsg=p;g.parseMediaKey=r}),98);
__d("MAWParseRavenMsg",["MAWConfig","MAWMsg","MAWMsgType","MAWParseSubprotocolVersionConsts","WALogger","WAMediaTransport.pb","WAParseMediaTransportProtocol","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n        received video messsage version is older than expected ",". "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n        received image messsage version is older than expected ",". "]);i=function(){return a};return a}function a(a){var b=a.content;a=a.meta;if(!d("MAWConfig").getConfig().isRavenMessagesEnabled())return{unstoredMedia:null,unstoredMsg:null,unstoredQuotedMedia:null,unstoredXMA:null};b=b.ravenMessage;if(b==null)throw c("err")("Raven message payload has no content");var e=d("MAWMsg").MAWRavenMsgEphemeralType.cast(b.ephemeralType);if(e==null)throw c("err")("Error when casting ephemeralType for Raven message");var f=void 0;if(b.imageMessage)(b.imageMessage.version==null||b.imageMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(i(),d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION),f=d("WAParseMediaTransportProtocol").decodeImageTransport(b.imageMessage.payload,a.ts);else if(b.videoMessage){(b.videoMessage.version==null||b.videoMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(h(),d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,b.videoMessage.payload);f=d("WAParseMediaTransportProtocol").parseVideoMsg(b,a.ts,!1)}else throw c("err")("Error unsupported Raven message type");if(f==null)throw c("err")("Error Raven message has no associated image or video");b={ack:a.ack,id:a.id,mediaId:f.plaintextHash,ravenEphemeralMediaState:e===d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT?d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN,ravenEphemeralType:e,reportingMeta:a.reportingMeta,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.RAVEN};return{unstoredMedia:f,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenMessage=a}),98);
__d("WAAckLevel",[],(function(a,b,c,d,e,f){"use strict";a={SENDER_BACKFILL_SENT:-7,INACTIVE_RECEIVED:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4};f.ACK=a}),66);
__d("MAWParseScreenshotActionMsg",["MAWExternalId","MAWMsgType","WAAckLevel","WAArmadilloApplication.pb","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.content;a=a.meta;b=b.screenshotAction;if(b==null)throw c("err")("screenshotAction has no content");b=b.screenshotType;if(b==null)throw c("err")("Missing screenshot type in payload");if(![d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE,d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING].includes(b))throw c("err")("Received unexpected screenshot action type");b={ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a.id.chat,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:[],adminType:"youEphemeralTakeScreenshot",screenshotActionType:b},ts:a.serverTs,type:d("MAWMsgType").EPHEMERAL_SCREENSHOT_ACTION};return{contentTypeForLogging:"screenshotAction",unstoredMedia:null,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseEphemeralScreenshotActionProtocol=a}),98);
__d("MAWParseArmadilloProtocol",["MAWMsgType","MAWParseNoteReplyMsg","MAWParseRavenActionNotificationMsg","MAWParseRavenMsg","MAWParseScreenshotActionMsg","MAWParseXMAProtocol","WAArmadilloApplication.pb","WAGlobals","WAHex","WALogger","cr:3443","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - Dropping message. contentType: ",", reason: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - handling futureproof message for contentType: ",""]);i=function(){return a};return a}var j={unstoredMedia:null,unstoredMsg:null,unstoredQuotedMedia:null,unstoredXMA:null};e={getParser:function(){return b("cr:3443")}};var k=new Map([["screenshotAction",d("MAWParseScreenshotActionMsg").parseEphemeralScreenshotActionProtocol],["extendedContentMessage",d("MAWParseXMAProtocol").parseXMAProtocol],["ravenActionNotifMessage",d("MAWParseRavenActionNotificationMsg").parseRavenActionNotificationMessage],["ravenMessage",d("MAWParseRavenMsg").parseRavenMessage],["noteReplyMessage",c("MAWParseNoteReplyMsg")],["bumpExistingMessage",e]]);function a(a,b,c,e,f,g){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,b);b=(b=b.payload)==null?void 0:b.content;if(!b)return j;var n=m(b);try{var o=k.get(n);if(typeof o==="object"){var p;o=(p=o.getParser())!=null?p:void 0}if(o!=null)return o({chat:a,content:b,meta:c,metadata:g,protobuf:e},f);d("WALogger").LOG(i(),n);return{contentTypeForLogging:n,unstoredMedia:null,unstoredMsg:{ack:c.ack,id:c.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(e),subtype:l(n)},reportingMeta:c.reportingMeta,sentTs:c.sentTs,serverTs:c.serverTs,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null}}catch(a){d("WALogger").ERROR(h(),n,a);return j}}function l(a){if(!d("WAGlobals").getConfig().isUnsupportedMessagesRedesignEnabled())return null;switch(a){case"bumpExistingMessage":return"bumpMessage";default:return null}}function m(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("err")(JSON.stringify(a)+" armadillo payload content should only have one field");a=b[0];return a}g.EMPTY_CONTENT=j;g.parseArmadilloProtocol=a}),98);
__d("WAParseMessageApplication",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c,e=a.payload;if(e==null)return{version:"v3",type:"error",error:"The messageApplication has no payload"};if(d("decodeProtobuf").getUnknownFields(a.payload)!=null)return{version:"v3",type:"error",error:"There are unknown fields in the message application payload"};e=e.subProtocol;if(e==null)return{version:"v3",type:"error",error:"The messageApplication payload has no subProtocol"};if(d("decodeProtobuf").getUnknownFields(e)!=null)return{version:"v3",type:"error",error:"messageApplication subProtocol has unknown fields",futureProof:e.futureProof};e=[];b=(b=a.payload)==null?void 0:(b=b.subProtocol)==null?void 0:b.consumerMessage;c=(c=a.payload)==null?void 0:(c=c.subProtocol)==null?void 0:c.armadillo;a=(a=a.payload)==null?void 0:(a=a.subProtocol)==null?void 0:a.multiDevice;if(b!=null){if(b.payload==null)return{version:"v3",type:"error",error:"subprotocol of type consumerMessage has no payload"};e.push({payload:new Uint8Array(b.payload),type:"success",subprotocolType:"consumerMessage"})}if(c!=null){if(c.payload==null)return{version:"v3",type:"error",error:"subprotocol of type armadillo has no payload"};e.push({payload:new Uint8Array(c.payload),type:"success",subprotocolType:"armadillo"})}if(a!=null){if(a.payload==null)return{version:"v3",type:"error",error:"subprotocol of type multiDevice has no payload"};e.push({payload:new Uint8Array(a.payload),type:"success",subprotocolType:"multiDevice"})}return e.length!==1?{version:"v3",type:"error",error:"Wrong number of subprotocols: "+e.length}:e[0]}g.parseMessageApplication=a}),98);
__d("MAWParseXMAProtocol",["MAWConfig","MAWMsgType","MAWODSProxy","MAWParseArmadilloProtocol","MAWParseSubprotocolVersionConsts","MAWXMALoggingUtils","WAArmadilloXMA.pb","WAHex","WALogger","WAMedia","WAMsgApplication.pb","WAOdsEnums","WAParseConsumerMessageProtocol","WAParseMediaTransportProtocol","WAParseMessageApplication","WAParseProtocolUtils","WAStanzaUtils","WATimeUtils","decodeProtobuf","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["S410301 The url contains RTL characters"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['S410301 The url is invalid. It contains a colon separator, but not "://"']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid message text during XMA restore"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid url prefix during XMA restore"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid native URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid action URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid action and native URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExternalId: "," textId: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n      received previews version is older than expected ",". "]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n    received favicon version is older than expected ",". "]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n    received headerImage version is older than expected ",". "]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n      received associatedMessage version is older than expected "," as expected. "]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["extendedContentMessage does not have valid XMA content, dropping message"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[XMA] received associated message with incorrect version ",""]);u=function(){return a};return a}var aa=new Set([d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY]);function v(a,b){return a==null||a.payload==null?void 0:d("WAParseMediaTransportProtocol").decodeImageTransport(a.payload,b)}function ba(a,b,e,f,g){if(b==null||b.payload==null)return null;b.version!==d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION&&d("WALogger").ERROR(u(),b.version);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,b.payload);b=d("WAParseMessageApplication").parseMessageApplication(b);if(b.type==="error")throw c("err")("XMA contains unparseable message application.");b=b;if(b.subprotocolType!=="consumerMessage")throw c("err")("XMA contains incorrect message application type: "+b.subprotocolType);return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(a,b.payload,e,f,g)}var w="https://www.instagram.com/stories/",x="https://www.instagram.com/reel/",y="https://www.instagram.com/tv/",z="https://www.instagram.com/_n/profile_shop?",A="https://www.instagram.com/",B="https://www.alpha.facebook.com/share/",C="https://m.facebook.com/share/",D="https://www.facebook.com/share/",E="https://m.alpha.facebook.com/share/",F="https://facebook.com/share/",G="https://www.alpha.facebook.com/stories/",H="https://www.facebook.com/stories/",I="https://fb.gg/",J="https://www.facebook.com/",K="https://m.facebook.com/",L="https://www.alpha.facebook.com/",M="https://m.alpha.facebook.com/",N="https://facebook.com/",O="https://fb.watch/",P="https://www.facebook.com/l.php",Q="https://m.facebook.com/l.php",R="https://www.alpha.facebook.com/l.php",S="https://m.alpha.facebook.com/l.php",ca="https://facebook.com/l.php",da="https://l.facebook.com/l.php",T="https://facebook.com/events/",ea="https://www.facebook.com/events/",fa="https://www.alpha.facebook.com/events/",ga="https://m.facebook.com/events/",ha="https://m.alpha.facebook.com/events/",U="fb-messenger://payments/receipt?product_id=",V="messenger://location_share",ia="http://m.me/",ja=":",W="http://",ka="https://";function a(a,b){var e=a.chat,f=a.content,g=a.meta,h=a.metadata;a=a.protobuf;f=f.extendedContentMessage;if(f==null)throw c("err")("extendedContentMessage has no content");var i=f.targetType,j=!1;try{j=b(f)}catch(a){throw c("err")("Error trying to validate XMA content: "+a.message)}if(j===!1){d("WALogger").WARN(t());return d("MAWParseArmadilloProtocol").EMPTY_CONTENT}if(i==null||!d("MAWConfig").getConfig().supportedXMATargetTypes().has(i))return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:{ack:g.ack,id:g.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:ma(i)},reportingMeta:g.reportingMeta,sentTs:g.sentTs,serverTs:g.serverTs,ts:g.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null,xmaTargetTypeForLogging:i};b=d("WAParseProtocolUtils").parseEphemerality(g,h);j=b.deleteTs;var k=b.ephemeralSetting;b=b.expirationTs;var l=d("WAParseProtocolUtils").enhanceReportingMeta(g,h),m=f.associatedMessage,n=f.contentRef,u=f.ctas,w=f.favicon,x=f.headerImage,y=f.headerTitle,z=f.maxSubtitleNumOfLines,A=f.maxTitleNumOfLines,B=f.messageText,C=f.overlayDescription,D=f.overlayIconGlyph,E=f.overlayTitle,F=f.previews,G=f.sentWithMessageId,H=f.subtitleText,I=f.targetId,J=f.targetUsername,K=f.titleText,L=f.xmaLayoutType;m!=null&&(m.version==null||m.version<d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(s(),d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION);x!=null&&(x.version==null||x.version<d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(r(),d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION);w!=null&&(w.version==null||w.version<d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(q(),d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION);F.every(function(a){(a.version==null||a.version<d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(p(),d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)});f=f.targetExpiringAtSec!=null?d("WATimeUtils").castLongIntToUnixTime(f.targetExpiringAtSec):void 0;var M=m!=null&&G!=null?[d("WAStanzaUtils").toStanzaId(G),g.id.externalId]:[g.id.externalId,void 0],N=M[0];M=M[1];var O=[];if(F!=null)for(var P=0;P<F.length;P++){var Q,R=v(F[P],g.ts);R!=null&&!((i===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE||i===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE)&&R.mediaType===d("WAMedia").MEDIA_TYPE.IMAGE&&((Q=R.validatedImageInfo)==null?void 0:Q.height)===1&&((Q=R.validatedImageInfo)==null?void 0:Q.width)===1)&&O.push(R)}Q=v(x,g.ts);R=v(w,g.ts);F=(P=d("WAParseConsumerMessageProtocol").parsedQuotedConsumerMessage(h))!=null?P:void 0;x=babelHelpers["extends"]({deleteTs:j,ephemeralSetting:k,expirationTs:b,id:babelHelpers["extends"]({},g.id,{externalId:N}),quote:F,reportingMeta:l,type:d("MAWMsgType").MSG_TYPE.XMA},g);w=u.map(function(a){a.actionContentBlob;a=babelHelpers.objectWithoutPropertiesLoose(a,["actionContentBlob"]);return a});P=w.slice(1);i===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE&&u.length===1&&(P=w);b={author:g.id.author,contentRef:n,ctas:P,defaultCTA:w[0],externalId:N,faviconMediaId:(j=R==null?void 0:R.plaintextHash)!=null?j:void 0,headerMediaId:(k=Q==null?void 0:Q.plaintextHash)!=null?k:void 0,headerTitle:y,isTombstoned:f!=null?d("WATimeUtils").unixTime()>f:!1,maxSubtitleNumOfLines:z,maxTitleNumOfLines:A,overlayDescription:C,overlayIconGlyph:D,overlayTitle:E,previewMediaIds:O.length>0?O.map(function(a){return a.plaintextHash}):void 0,sentWithMessage:B,subtitleText:H,targetExpiringAtSec:f,targetId:I,targetType:i,targetUsername:J,threadJid:e,titleText:K,xmaLayoutType:L};var S;if(m!=null&&G==null)throw c("err")("XMA associatedMessage cannot be received without sentWithMessageId field");m!=null&&M!=null&&(S=ba(e,m,g,a,h));u=(l=(F=S)==null?void 0:F.unstoredMedia)!=null?l:null;n=d("MAWConfig").getConfig().isMediaAssociatedXMAsEnabled()===!0&&aa.has(i);if(u!=null&&!n){P=d("MAWXMALoggingUtils").getXmaTargetTypeStringFromEnum(i);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"assoc_msg_media_"+((w=P)!=null?w:"unknown")});throw c("err")("XMA associated msg cannot have additioinal dbMedia")}y=(k=(j=S)==null?void 0:j.unstoredMsg)!=null?k:null;M!=null&&y!=null&&(d("WALogger").DEV(o(),N,M),y.id=babelHelpers["extends"]({},y.id,{externalId:M}),x.id=babelHelpers["extends"]({},y.id,{externalId:N}),b.externalId=N);if(n&&u!=null&&((y==null?void 0:y.type)==="Gif"||(y==null?void 0:y.type)==="Sticker"))return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:x,unstoredQuotedMedia:null,unstoredXMA:{unstoredAssociatedMedia:u!=null?u:void 0,unstoredAssociatedMsg:y!=null?y:void 0,unstoredFavicon:R,unstoredHeaderMedia:Q,unstoredPreviews:O.length>0?O:void 0,xma:b},xmaTargetTypeForLogging:i};if(y!=null&&y.type!=="Text")throw c("err")('XMA associated msg cannot have type different from "Text". Received type: '+y.type);return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:x,unstoredQuotedMedia:null,unstoredXMA:{unstoredAssociatedMedia:void 0,unstoredAssociatedMsg:y!=null?y:void 0,unstoredFavicon:R,unstoredHeaderMedia:Q,unstoredPreviews:O.length>0?O:void 0,xma:b},xmaTargetTypeForLogging:i}}function b(a){var b=a.ctas,d=a.targetType;if(d==null)throw c("err")("extendedContentMessage does not have a targetType");var e=!0;b.forEach(function(a){a.actionContentBlob;a=babelHelpers.objectWithoutPropertiesLoose(a,["actionContentBlob"]);e=e&&X(a,d)});return e}function la(a){var b=a.ebRestore,c=a.hasActionUrl,e=a.hasNativeUrl,f=a.isActionUrlValid,g=a.isNativeUrlValid;a=a.targetType;!g&&!f?d("WALogger").ERROR(n(),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c):g&&!f?d("WALogger").ERROR(m(),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c):f&&!g&&d("WALogger").ERROR(l(),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c)}function X(a,b,c){var d=a.nativeUrl;a=a.actionUrl;var e=Y(d,b,c),f=Y(a,b,c);la({ebRestore:c,hasActionUrl:a!=null,hasNativeUrl:d!=null,isActionUrlValid:f,isNativeUrlValid:e,targetType:b});return e&&f}function ma(a){if(!c("gkx")("1564"))return null;switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return"locationMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return"contactShareMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return"storyMentionMessage";default:return null}}function Y(a,b,c){if(a==null)return!0;if(pa(a,b)===!1){c!=null&&c&&d("WALogger").ERROR(k());return!1}if(!qa(a)){c!=null&&c&&d("WALogger").ERROR(j());return!1}return!0}function Z(a){return a.startsWith(B)||a.startsWith(C)||a.startsWith(D)||a.startsWith(E)||a.startsWith(F)}function na(a){return a.startsWith(P)||a.startsWith(Q)||a.startsWith(R)||a.startsWith(S)||a.startsWith(ca)||a.startsWith(da)}function $(a){return a.startsWith(J)||a.startsWith(K)||a.startsWith(L)||a.startsWith(M)||a.startsWith(N)}function oa(a){return a.startsWith(T)||a.startsWith(ea)||a.startsWith(fa)||a.startsWith(ga)||a.startsWith(ha)}function pa(a,b){if(a==null)return!0;switch(b){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_HIGHLIGHT_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_HIGHLIGHT_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return a.startsWith(w);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return a.startsWith(x);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:return a.startsWith(y);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:return a.startsWith(z);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_IG_MEDIA_SHARE:return a.startsWith(A);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return a.startsWith(H)||a.startsWith(G)||Z(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return a.startsWith(I);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return($(a)||a.startsWith(O))&&!na(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return a.startsWith(V);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:return oa(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return oa(a)||Z(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return $(a)||a.startsWith(ia);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_EXTERNAL_LINK:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_VIDEO_CALL:if(a.includes(ja)&&(!a.startsWith(W)&&!a.startsWith(ka))){b=a.indexOf("://");b===-1&&d("WALogger").ERROR(i());return!1}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_RECEIVER_FETCH:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.DATACLASS_SENDER_COPY:return!0;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_P2P_PAYMENT:return a.startsWith(U)}return!0}function qa(a){for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case"\u202c":case"\u202d":case"\u202e":d("WALogger").ERROR(h());return!1;default:break}}return!0}g.kIGStoryCtaPrefix=w;g.kIGClipsCtaPrefix=x;g.kIGTVCtaPrefix=y;g.kIGShopCtaPrefix=z;g.kIGDefaultCtaPrefix=A;g.kFBStoryCtaPrefix=H;g.kFBGamingCustomUpdateCtaPrefix=I;g.kFBDefaultWWWCtaPrefix=J;g.kFBEventCtaPrefix=T;g.kMSGP2PPaymentUrlPrefix=U;g.kMessengerLocationSharePrefix=V;g.kHttpPrefix=W;g.parseXMAProtocol=a;g.isXMAContentValid=b;g.isValidCTA=X}),98);
__d("MAWHandleEchoXMARestoreV2",["EchoMessage","LSDataTraceCheckPoint","LSIntEnum","MAWBridge","MAWBridgeXMA","MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph","MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMediaTxns","MAWDbMsg","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWParseXMAProtocol","MAWTraceUtils","MAWTransactionMode","Promise","WAArmadilloXMA.pb","WALogger","WAMediaUtils","WATimeUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid CTA observed while restoring XMA. Echo message origin ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJid field is not present in the restoredMsg. Echo message origin ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaLayoutType field is not present in the echo doc. Echo message origin ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaGatingType field is not present in the echo doc. Echo message origin ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaTargetType field is not present in the echo doc. Echo message origin ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaDefaultCTA field is not present in the echo doc. Echo message origin ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaData is missing in the echo doc. Echo message origin ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] dbXMA is null. EchoMessage origin ",""]);q=function(){return a};return a}a=function(a,e,f,g){f==null?void 0:f.addPoint("xma_restore_start");d("MAWTraceUtils").recordCheckpointForTrace(g,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_XMA_RESTORE_STARTED),[],!1);var j=a.restoredMsgsData;if(j){var k=j.newlyAddedMsgs;k=k.concat(j.existingMsgs);var l=[];k.map(function(b){var c=b.externalId;c=a.echoMsgMap.get(c);c!=null&&(c.contentType===d("EchoMessage").EchoMessageContentType.XMA&&l.push(b))});return l.length===0?(h||(h=b("Promise"))).resolve():r(l,a.echoMsgMap,e,g).then(function(a){f==null?void 0:f.addPoint("xma_restore_end",{"int":{xma:a.length}});d("MAWTraceUtils").recordCheckpointForTrace(g,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_XMA_RESTORE_ENDED),[],!1);return(h||(h=b("Promise"))).resolve()})}f==null?void 0:f.addPoint("xma_restore_end",{"int":{xma:0}});return(h||(h=b("Promise"))).resolve()};function r(a,e,f,g){var h=new Map(a.map(function(a){var b=e.get(a.externalId);b=b==null?void 0:(b=b.mediaData)==null?void 0:b.attachmentObjectId;if(b!=null)return[d("WAMediaUtils").stringToDeliveryObjectId(b),a]}).filter(Boolean)),j=Array.from(h.keys()),k=new Map();return s(j).then(function(l){var m=[];j.forEach(function(a){var b;b=(b=h.get(a))==null?void 0:b.externalId;b!=null&&k.set(b,a)});a.filter(function(a){return d("MAWDbMsg").isXMAMsg(a)}).forEach(function(a){var b=e.get(a.externalId);if(b){var f=k.get(a.externalId),h;if(f!=null){f=l.get(f);f!=null&&(h=f.mediaId)}f=b.serializationOrigin;f==null&&(f=d("EchoMessage").EchoSerializationOriginType.UNKNOWN);a=u(a,b,h,f);a==null?(d("WALogger").ERROR(q(),f),d("MAWTraceUtils").recordCheckpointForTrace(g,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_XMA_RESTORE_DBXMA_NULL),[],!1)):m.push(a)}});return t(m).then(function(a){if(a.length>0){a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=k.get(a.externalId);if(f!=null){var e;b!=null&&(e=l.get(b));c("gkx")("821")?b=(yield d("MAWHandleXmaTransactionUtil").checkMediaChunkTransactionAndCreatedBridgeXma(e,a)):b=d("MAWBridgeXMA").createBridgeXMA(e,a,!1);d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewXMA",value:b}]})}});return function(b){return a.apply(this,arguments)}}());return a}return a})})}var s=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,mediaBackup:d("MAWTransactionMode").READONLY},"restoreGetMediaForXMAByObjectIds",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaBackupRowsFromObjectIds(a,b).then(function(b){var c=Array.from(b.values()).map(function(a){return a.mediaId});return a.media.bulkGet(c).then(function(a){var c=new Map();a!=null&&a.forEach(function(a){a!=null&&c.set(a.mediaId,a)});var d=new Map();b.forEach(function(a,b){a=c.get(a.mediaId);a!=null&&d.set(b,a)});return d})})}}),t=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READWRITE},"restoreWriteXMAsToDb",function(a){return function(b){return a.xma.bulkAdd(b,{allKeys:!0}).then(function(a){return a.map(function(a,c){return babelHelpers["extends"]({},b[c],{xmaId:a})})})}});function u(a,b,c,e){var f;if(b.xmaData==null){d("WALogger").ERROR(p(),e);return null}var g;if(b.xmaData.xmaDefaultCTA!=null){var h;g=v((h=b.xmaData)==null?void 0:h.xmaDefaultCTA)}else d("WALogger").WARN(o(),e);if(((h=b.xmaData)==null?void 0:h.xmaTargetType)!=null)h=d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(b.xmaData.xmaTargetType);else{d("WALogger").ERROR(n(),e);return null}var i;((f=b.xmaData)==null?void 0:f.xmaGatingType)!=null?i=d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph").convertXMAGatingTypeToExtendedContentOverlayIconGlyph(b.xmaData.xmaGatingType):d("WALogger").WARN(m(),e);var q;((f=b.xmaData)==null?void 0:f.xmaLayoutType)!=null?q=d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType").convertXMALayoutTypeToExtendedContentXMLLayoutType(b.xmaData.xmaLayoutType):d("WALogger").WARN(l(),e);if(a.threadJid!=null)f=a.threadJid;else{d("WALogger").ERROR(k(),e);return null}if(g!=null&&!d("MAWParseXMAProtocol").isValidCTA(g,h,!0)){d("WALogger").ERROR(j(),e);return null}var r;((e=b.xmaData)==null?void 0:e.xmaContentRef)!=null&&(r=b.xmaData.xmaContentRef);return{author:a.author,contentRef:r,ctas:[],defaultCTA:g,defaultPreviewMediaId:(e=c)!=null?e:void 0,externalId:a.externalId,headerTitle:b==null?void 0:(e=b.xmaData)==null?void 0:e.xmaHeaderTitle,isTombstoned:b==null?void 0:(e=b.xmaData)==null?void 0:e.xmaIsTombstoned,maxSubtitleNumOfLines:b==null?void 0:(e=b.xmaData)==null?void 0:e.xmaMaxSubtitleNumLines,maxTitleNumOfLines:b==null?void 0:(e=b.xmaData)==null?void 0:e.xmaMaxTitleNumLines,msgId:a.msgId,overlayIconGlyph:i,overlayTitle:b==null?void 0:(e=b.xmaData)==null?void 0:e.xmaHeaderSubtitle,previewMediaIds:c!=null?[c]:[],subtitleText:b==null?void 0:(a=b.xmaData)==null?void 0:a.xmaSubtitleText,targetExpiringAtSec:((e=b.xmaData)==null?void 0:e.xmaTargetExpiry)!=null?d("WATimeUtils").castToUnixTime(Number((c=b.xmaData)==null?void 0:c.xmaTargetExpiry)):void 0,targetId:b==null?void 0:(a=b.xmaData)==null?void 0:a.xmaTargetId,targetType:h,targetUsername:b==null?void 0:(e=b.xmaData)==null?void 0:e.xmaTargetUsername,threadJid:f,titleText:(c=b.xmaData)==null?void 0:c.xmaTitleText,xmaLayoutType:q}}function v(a){return{actionUrl:a,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:a}}g.writeXMAToXMAStore=a;g.getMediaForXMAByObjectIds=s;g.writeXMAsToDb=t}),98);
__d("MAWHandlePointRestoredMsgV2",["MAWEBUploadTrackingUtils","MAWEncryptedBackupCacheManager","MAWIndexedDb","MAWTransactionMode","MAWUploadMessagesBackup","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Completed handling of point restored message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Completed handling of point restored message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Started handling of point restored message"]);k=function(){return a};return a}function a(a){d("WALogger").LOG(k());a=a.restoredMsgsData;if(a){var c=a.existingMsgs;a=a.newlyAddedMsgs;a=a.concat(c);var e=[],f=new Map(),g=[],l=new Map();a.filter(function(a){return d("MAWEncryptedBackupCacheManager").checkForMsgEntryInReuploadCache(a.threadJid,a.externalId)}).forEach(function(a){e.push(a);g.push(a.externalId);var b=d("MAWEBUploadTrackingUtils").genInstanceKeyOnly();l.set(a.externalId,b);d("MAWEBUploadTrackingUtils").startUploadTracking(a.externalId,a.type,"pointrestore",b)});c=m(g);return c.then(function(a){a.forEach(function(a){var b=a.quoteExternalId;b!=null&&f.set(b,a)});return e.length>0?d("MAWUploadMessagesBackup").uploadUniqueMessage(e,f,void 0,void 0,l).then(function(a){e.forEach(function(a){d("MAWEncryptedBackupCacheManager").removeMsgEntryFromReuploadCache(a.threadJid,a.externalId)})}):(h||(h=b("Promise"))).resolve()}).then(function(a){d("WALogger").LOG(j())})}d("WALogger").LOG(i());return(h||(h=b("Promise"))).resolve()}function l(a,b){return a.messages.where("quoteExternalId").anyOf(b).toArray()}var m=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"maybeBatchGetMsgsByQuoteExternalId",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return l.apply(void 0,[a].concat(c))}});g.uploadPointRestoredMessageIfRequired=a}),98);
__d("MAWRestoreMsgsUiUpdator",["MAWBridgeEventTransmitter","MAWDbMsg","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWThreadSnippetBuildTxns","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,j,l,m,n,o,p,q,r){g=h(a,g,c,e,f,l,m);return g.then(function(c){if(m==null||j){var e=k(c);e&&!q&&d("MAWBridgeEventTransmitter").updateThreadOutsideTxn(c.cannotReplyReason,d("MAWFolderTypes").FOLDER_ID.INBOX,c.chatId,c.jid);return i(a,b,c,n,o,p,m,q).then(function(){return c})}return c}).then(function(b){return d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,b,r)}).then(function(){})}function h(a,b,c,e,f,g,h){var i=babelHelpers["extends"]({},b,{lastReadMsg:g,lastReadMsgTs:f,newestMsg:c,newestMsgTs:e,oldestMsg:h,threadOrder:d("MAWDbThread").craftThreadOrder(e,b.jid)});return a.threads.put(i).then(function(){return i})}function i(a,b,e,f,g,h,i,k){var l=b.map(function(a){return a}).reverse(),m=e.chatId,n=e.jid;if(f!=null){f=d("MAWDbMsg").toMsgId(f);if(f!=null)return a.messages.get({msgId:f}).then(function(f){if(f!=null){f=f.sortOrderMs;var o;c("gkx")("23906")||c("qex")._("1016")?o=d("MAWDexieTable").dexieResolve(0):o=a.messages.where(["threadJid","sortOrderMs"]).between([n,l[0].sortOrderMs],[n,f],!1,!1).count();return o.then(function(a){a===0&&(j(l,g,e,k),k||d("MAWBridgeEventTransmitter").issueMsgLoadedEventAfterTxn(m,e.jid,l,i===null,h,!1));return{chatId:m,restoredMessages:b}})}return{chatId:m,restoredMessages:b}})}k||d("MAWBridgeEventTransmitter").issueMsgLoadedEventAfterTxn(m,e.jid,l,i===null,h,!1);return d("MAWDexieTable").dexieResolve({chatId:m,restoredMessages:b})}function j(a,b,c,e){var f=b==null?void 0:b.sortOrderMs,g=a[a.length-1],h=g.sortOrderMs;b!=null&&g!=null&&f!=null&&h!=null&&f<h&&(a.push(b),e||d("MAWBridgeEventTransmitter").deleteMessageRangesV2AfterTxn(b.msgId,d("MAWDbMsg").getSortOrderWithFallback(b),c.jid))}function k(a){return a.archived===!0&&a.cannotReplyReason!=="viewer_not_subscribed"}g.updateThreadAndMessages=a;g.shouldThreadBeUnarchived=k}),98);
__d("MAWRestoreMsgsTxns",["ArmadilloDataTraceType","FBLogger","LSMEBTaskCreationSource","MAWBridgeEventTransmitter","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWEBBackendQPLUtils","MAWIndexedDb","MAWLocalizationType","MAWMessageHasUniqueExternalIdValidator","MAWMsgType","MAWQplProxy","MAWRestoreMsgsUiUpdator","MAWTimeUtils","MAWTransactionMode","WAHashStringToNumber","WAJids","WALogger","WATimeUtils","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to create restored messages and update thread metadata ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with jid "," does not exist for restore"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI attempting to re-restore previous batch - halting DYI for thread ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] DYI for thread with jid "," is not currently in progress"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error occurred on restore - stopping DYI for thread with chat jid ",""]);l=function(){return a};return a}function m(a,b,c){return c!=null?a.messages.where(["threadJid","sortOrderMs"]).between([b.jid,c.ts],[b.jid,d("MAWDbMsg").MAX_MSG_SORT_ORDER],!1,!0).limit(1).first():d("MAWDexieTable").dexieResolve()}function a(a,b,c){return d("MAWDbMsgTxns").maybeGetMsg(a,c).then(function(c){if(c!=null)return a.messages.where(["threadJid","sortOrderMs"]).between([b.jid,c.sortOrderMs],[b.jid,d("MAWDbMsg").MAX_MSG_SORT_ORDER],!1,!0).limit(1).first();else return d("MAWDexieTable").dexieResolve()})}function n(a){return a!=null&&a.type===d("MAWMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE)}var o=(e=d("MAWIndexedDb")).makeMsgrTransactor({messages:(f=d("MAWTransactionMode")).READONLY},"checkForDecryptionFailuresToPointRestore",function(a){return function(){return a.messages.filter(function(a){return a.type===d("MAWMsgType").MSG_TYPE.UNAVAILABLE||a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT}).toArray().then(function(a){a.forEach(function(a){a.threadJid!=null&&d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(a.externalId,d("WAJids").threadIdForChatJid(a.threadJid),void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES,a.threadJid)})})}});function p(a,b,c,e,f,g,h,i,j,k,l){var m=g.isOldestMsgUpdated,n=g.lastReadMsg,o=g.lastReadMsgTs,p=g.newestMsgId,q=g.newestMsgTs,s=g.oldestMsgId,t=!0;return d("MAWDbMsgTxns").getThreadNewestMessageId(a,c).then(function(g){b&&(g!=null&&(t=r(g,e)));g=d("MAWDexieTable").dexieResolve();t&&(f.length>0&&(g=d("MAWRestoreMsgsUiUpdator").updateThreadAndMessages(a,f,p,q,o,c,m,n,s,h,i,j,k,l)));return g.then(function(){if(k)return D(a,e,c,j);else return d("MAWDexieTable").dexieResolve()})})}function b(a){var b=a.bumpMessageAuthorMap,e=a.existingMsgs,f=a.hasMoreBefore,g=a.instanceKey,h=a.isDyiInProgress,i=a.isPointRestore,j=a.maybeNewestMsg,k=a.maybeOldestAdminMsg,l=a.maybeOldestMsg,m=a.minMsgId,n=a.newMsgs,o=a.optimisticMsgs,p=a.taskSource;a=a.thread;p=p===c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES;var q=new Map(),r=[];e.map(function(a){a.type===d("MAWMsgType").MSG_TYPE.UNAVAILABLE||a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?r.push(a):q.set(a.externalId,a)});var s=[];return G(n,e,a.jid,q,j,h,i,k,l,s,o,g,f,m,p,r,b).then(function(a){return a})}function q(a,b,c,e){a.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&a.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&(d("MAWBridgeEventTransmitter").startTraceOutsideTxn(a,b,d("ArmadilloDataTraceType").armadilloMessageSend),d("MAWBridgeEventTransmitter").issueNewMsgUiEventOutsideTxn(a,c,e))}function r(a,b){var c=!1;for(var e=0;e<b.length;e++){var f=b[e];d("MAWDbMsg").getInChatMsgIdFromMsgId(a)<=d("MAWDbMsg").getInChatMsgIdFromMsgId(f.msgId)&&(c=!0)}return c}var s=e.makeMsgrTransactor({messages:f.READONLY},"getMsgsByProtocolMsgIds",function(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWDbMsgTxns").getMsgsByProtocolMsgId.apply(void 0,[a].concat(c))}}),t=e.makeMsgrTransactor({messages:f.READONLY},"restoreGetMsg",function(a){return function(b){return d("MAWDbMsgTxns").maybeGetMsg(a,b)}}),u=e.makeMsgrTransactor({messages:f.READONLY},"restoreGetThreadNewestMessage",function(a){return function(b){return d("MAWDbMsgTxns").getThreadNewestMessageBySortOrderOrCache(a,b)}}),v=e.makeMsgrTransactor({messages:f.READONLY},"restoreMaybeGetOldestNonAdminMessage",function(a){return function(b){return d("MAWDbMsgTxns").getThreadOldestMessageBySortOrder(a,b.jid).then(function(c){if(c==null)return d("MAWDexieTable").dexieResolve({maybeOldestAdminMsg:null,maybeOldestMsg:null});else if(n(c))return m(a,b,c).then(function(a){return{maybeOldestAdminMsg:c,maybeOldestMsg:a}});return{maybeOldestAdminMsg:null,maybeOldestMsg:c}})}});function w(a,b,c,e,f,g,h,i,j){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.externalId,c.jid,b.author).then(function(a){if(a!=null)return;a=e.get(b.externalId);if(a==null){a=d("WATimeUtils").castUnixTimeToMillisTime(b.ts);i.newestMsgTs=a>i.newestMsgTs?a:i.newestMsgTs;var k=d("MAWDbMsg").craftMsgIdV2(c.chatId,i.msgNextInChatMsgId,b);i.msgNextInChatMsgId+=1;(i.oldestMsgId==null||!g&&a<i.oldestMsgTs)&&(i.isOldestMsgUpdated=!0,i.oldestMsgId=h!=null&&d("WATimeUtils").castUnixTimeToMillisTime(h.ts)<a?h.msgId:k,i.oldestMsgTs=h!=null&&d("WATimeUtils").castUnixTimeToMillisTime(h.ts)<a?d("WATimeUtils").castUnixTimeToMillisTime(h.ts):a);(i.newestMsgTs===a||n(f))&&(i.newestMsgId=k);b.author===d("WAJids").AUTHOR_ME&&(i.lastReadMsgTs==null||a>i.lastReadMsgTs)&&(i.lastReadMsg=k,i.lastReadMsgTs=a);a=babelHelpers["extends"]({},b,{msgId:k,sortOrderMs:d("MAWDbMsg").getSortOrderWithFallback(b)});j.push(a)}})})).then(function(){})}function x(a,b){d("WALogger").ERROR(l(),b);return a.dyiBatch.filter(function(a){return a.threadId===b}).toArray().then(function(c){var e;e=(e=c.find(function(a){return a.qplInstanceKeyForThread!==null}))==null?void 0:e.qplInstanceKeyForThread;d("MAWEBBackendQPLUtils").markErrorDyiBackupRestoreStoppingDyi(e,b);return a.dyiBatch.bulkDelete(c.map(function(a){return a.batchId}))})}function y(a,b,c){return a.dyiBatch.filter(function(a){return a.isThread&&a.threadId===b}).toArray().then(function(b){b=b[0];if(b.numMessagesRestored!=null)return a.dyiBatch.update(b.batchId,{numMessagesRestored:b.numMessagesRestored+c}).then(function(){})})}function z(a,b,c,d){d={isThread:!1,numMessages:d?b:-1,oldestTs:0,threadId:a.jid};if(c.length>0){b=c.reduce(function(a,b){if(b.sortOrderMs!=null&&a.sortOrderMs!=null&&b.sortOrderMs<a.sortOrderMs)return b;else return a},c[0]);b.sortOrderMs!=null&&(d.oldestTs=b.sortOrderMs)}return d}function A(a,b,c,d,e){var f=z(b,c,d,e);if(e)return C(a,b,f.oldestTs).then(function(d){if(!d)return a.dyiBatch.add(f).then(function(){return y(a,b.jid,c)})});else return a.dyiBatch.add(f).then(function(){return y(a,b.jid,c)})}function B(a,b,c){return a.dyiBatch.filter(function(a){return a.threadId===b.jid}).toArray().then(function(a){var e=!1;for(var f=a,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;i.isThread&&(e=!0)}h=(i=a.find(function(a){return a.qplInstanceKeyForThread!==null}))==null?void 0:i.qplInstanceKeyForThread;e||(d("MAWEBBackendQPLUtils").markErrorDyiBackupRestoreBatchNotInProgress(h,b.jid),(c==null||!c)&&d("WALogger").ERROR(k(),b.jid));return e})}function C(a,b,c){return a.dyiBatch.filter(function(a){return!a.isThread&&a.threadId===b.jid}).toArray().then(function(e){if(e.length>0){var f=!1,g=[];for(var e=e,h=Array.isArray(e),i=0,e=h?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(h){if(i>=e.length)break;k=e[i++]}else{i=e.next();if(i.done)break;k=i.value}k=k;k.oldestTs<=c?(d("WALogger").ERROR(j(),b.chatId),d("MAWEBBackendQPLUtils").markErrorDyiBackupRestoreThreadHalt(k.qplInstanceKeyForThread,b.chatId),f=!0):g.push(k.batchId)}return f?x(a,b.jid).then(function(a){return!0}):a.dyiBatch.bulkDelete(g).then(function(a){return!1})}return d("MAWDexieTable").dexieResolve(!1)})}function D(a,b,e,f){if(!c("gkx")("23911"))return d("MAWDexieTable").dexieResolve();var g=b.length;return a.dyiBatch.count().then(function(c){return c===0?d("MAWDexieTable").dexieResolve():B(a,e).then(function(c){if(!c)return a.dyiBatch.filter(function(a){return a.threadId===e.jid}).toArray().then(function(b){a.dyiBatch.bulkDelete(b.map(function(a){return a.batchId}))});else return A(a,e,g,b,f)})})}function E(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageId(a,b),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b),d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];return{newestMsgId:b,newestMsgTs:c,nextInChatMsgId:a}})}function F(a,b,c,e,f,g,h,i,j,k){return w(a,b,c,e,f,g,h,i,j).then(function(b){if(k!=null)for(b=0;b<j.length;b++){var e=j[b],f=e.externalId;f=k.get(f);f!=null&&(e.ts=d("WATimeUtils").castMilliSecondsToUnixTime(f.ts))}d("MAWMessageHasUniqueExternalIdValidator").logMessageAddSource(j.map(function(a){return a.externalId}),"MAWRestoreMsgsTxns.js::createRestoredMessages isPointRestore: "+(g?1:0));return a.messages.bulkAdd(j,{allKeys:!0}).then(function(a){return a.map(function(a,b){return babelHelpers["extends"]({},j[b],{rowId:a})})}).then(function(b){return a.threads.put(c).then(function(){return b})})})}var G=e.makeMsgrTransactor({dyiBatch:f.READWRITE,groupInfo:f.READWRITE,messages:f.READWRITE,threads:f.READWRITE},"createRestoredMessagesAndUpdateThread",function(a){return function(b,c,e,f,g,j,k,l,m,n,o,r,s,t,u,v,w){return a.threads.get({jid:e}).then(function(u){if(u==null){d("WALogger").ERROR(i(),e);return d("MAWDexieTable").dexieResolve()}return E(a,u).then(function(e){var i=e.newestMsgId,v=e.newestMsgTs;e=e.nextInChatMsgId;var x={isOldestMsgUpdated:!1,lastReadMsg:u.lastReadMsg,lastReadMsgTs:d("MAWTimeUtils").ensureValidMillisTime(u.lastReadMsgTs),msgNextInChatMsgId:e,newestMsgId:i,newestMsgTs:d("MAWTimeUtils").ensureValidMillisTime(v)||d("WATimeUtils").castToMillisTime(0),oldestMsgId:m==null?void 0:m.msgId,oldestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime((e=m==null?void 0:m.ts)!=null?e:d("WATimeUtils").castToUnixTime(0))};i=d("MAWDexieTable").dexieResolve();return i.then(function(){return F(a,b,u,f,g,k,l,x,n,o).then(function(b){if(!j)for(var d=0;d<b.length;d++){var e=b[d];q(e,u.jid,r,o)}e=c.concat(b);var f={existingMsgs:c,newlyAddedMsgs:b,threadJid:u.jid};return p(a,k,u,e,b,x,t,l,s,j,w).then(function(){return f})})["catch"](function(a){d("WALogger").ERROR(h(),a)})})})})}});g.getNextMsgBasedOnSortOrderMs=a;g.isE2eeOrCutoverAdminMsg=n;g.checkForDecryptionFailuresToPointRestore=o;g.restoreMsgsForThread=b;g.getMsgsByProtocolMsgIds=s;g.getMsg=t;g.maybeGetThreadNewestMessage=u;g.maybeGetOldestNonAdminMessage=v;g.prepareUnstoredMsgArrayAndUpdateKeyVariables=w;g.stopDyiForThread=x;g.checkIfBatchInProgress=B}),98);
__d("MAWRestoreValidationUtils",[],(function(a,b,c,d,e,f){"use strict";function g(a){return a.reduce(function(a,b){if(b.externalId!=null){a[b.externalId]=((b=a[b.externalId])!=null?b:0)+1;return a}return a},{})}function a(a,b,c,d,e){var f=g(a),h=g(b);if(c==null&&d==null)return;a=c!=null?c.map(function(a){return{externalId:a.otid}}):d!=null?d:[];b=g(a);c=Object.keys(f).filter(function(a){return!h[a]});d=Object.keys(h).filter(function(a){return!f[a]});a=Object.keys(b).filter(function(a){return!f[a]});var i=Object.entries(f).filter(function(a){a[0];a=a[1];return a>1}),j=Object.entries(h).filter(function(a){a[0];a=a[1];return a>1});b=Object.entries(b).filter(function(a){a[0];a=a[1];return a>1});j={"int":{duplicates_in_deanon_reference:j.length,duplicates_in_restore_request:b.length,duplicates_in_restored_messages:i.length,missing_in_deanon_reference:c.length,missing_in_restore_request:a.length,missing_in_restored_messages:d.length}};e==null?void 0:e.addPoint("restore_validation",j);return j}f.compareRestoredMsgstoDeanonData=a}),66);
__d("MAWHandleEchoMsgsRestoreApiV2",["EchoBackupCompareUtils","EchoMessage","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAckLevel","MAWBridgeEventTransmitter","MAWDbEditMsgHistoryTxns","MAWDbMsg","MAWDbThreadTxns","MAWDexieTable","MAWEBRestoreTrackingUtils","MAWEncryptedBackupCacheManager","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoMsgsRestoreApiUtils","MAWHandleEchoReactionsRestore","MAWHandleEchoXMARestoreV2","MAWHandlePendingStanzasInRestoreV2","MAWHandlePointRestoredMsgV2","MAWIndexedDb","MAWJids","MAWQplProxy","MAWRepliesRestoreUtils","MAWRestoreMsgsTxns","MAWRestoreValidationUtils","MAWTraceUtils","MAWTransactionMode","Promise","WAGlobals","WAJids","WAResultOrError","WAStanzaUtils","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","gkx","promiseDone","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Oldest message timestamp: "," and newest message timestamp: "," of the batch for thread: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No more messages to restore for thread: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Ignore duplicate restore request of an existing message"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Message ID must not be null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decode the message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No messages to be restored for thread: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] timestamp field should not be null as it is required for attachment download retry"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] timestamp field should not be null as it is required for attachment download retry"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] from field is missing from media message"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] from field is missing from media message"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Media data is null for the message: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Media data is null for the message: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo message is missing from the map: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo message is missing from the map: ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missed restoring optimistic messages for thread: "," count: "," }"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJidPrimaryId "," missing from index db"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing thread for thread jid: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error while restoring media/reaction: ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] handleEchoMsgsRestore v2 completed. newlyAdded: "," existing: "," isPointRestore: ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error while deleting point restored messages: ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Message creation complete. MessagesCreated: "," isPointRestore: "," startSortKey: "," taskSource: ",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Low level api handleEchoMsgsRestore v2 initiated restore of "," messages. isPointRestore: "," startSortKey: "," taskSource: ",""]);E=function(){return a};return a}var F=c("requireDeferred")("MAWHandleEBRestoreWithHIM").__setRef("MAWHandleEchoMsgsRestoreApiV2");a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,k,l,m,n,o,p,q,r){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(j=l)!=null?j:""]).LOG(E(),e.length,f,m,p);j=f?d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.POINT_RESTORE:m!=null?d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.PAGINATED_RESTORE:d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.INITIAL_RESTORE;j=j;var s=q!=null?q:d("MAWQplProxy").startQplUserFlow(c("qpl")._(521486220,"827"),{"int":{messages:e.length},string:{message_backup_type:"echo",restore_type:j,trace_id:(q=l)!=null?q:""}},void 0,3e5);d("MAWTraceUtils").recordCheckpointForTrace(l,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_RESTORE_BEGIN),[],!1);var t=(yield L(a,l,p!=null&&p===c("LSMEBTaskCreationSource").MSGR_DYI)),u={messageIds:[],pendingRestoreSortKeys:[]};if(t){j=G(t,e,f,g,s,k,n,o,l,p,r);var v=a;return j.then(function(g){var j,k=((j=g.restoredMsgsData)==null?void 0:j.newlyAddedMsgs)?(j=g.restoredMsgsData)==null?void 0:j.newlyAddedMsgs.length:0;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(j=l)!=null?j:""]).LOG(D(),k,f,m,p);O(a,g,n,o);return(h||(h=b("Promise"))).all([M(g,s),N(g,s,l,f),d("MAWHandleEchoReactionsRestore").writeEchoReactionsToReactionsStore(g,d("WAGlobals").getMyUserJid(),s),R(v,g,t==null?void 0:t.jid)]).then(function(j){d("MAWEncryptedBackupCacheManager").setRestoredCacheStatusAsDone(Array.from(g.echoMsgMap.keys()));return(h||(h=b("Promise"))).all([d("MAWRepliesRestoreUtils").updateQuoteDataForReplyMessages(g,s),d("MAWHandleEchoXMARestoreV2").writeXMAToXMAStore(g,t.chatId,s,l),c("gkx")("2251")?d("MAWHandlePendingStanzasInRestoreV2").applyPendingStanzas(g,f,s):d("MAWDexieTable").dexieResolve()]).then(function(){c("promiseDone")(d("MAWHandlePointRestoredMsgV2").uploadPointRestoredMessageIfRequired(g));var j=g.restoredMsgsData;if(f&&j!=null){var m=p===c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES||c("gkx")("1560")||c("gkx")("33");m||I(j.newlyAddedMsgs)["catch"](function(a){var b;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(b=l)!=null?b:""]).ERROR(C(),a)})}m=g.restoredMsgsData;j=(m==null?void 0:m.existingMsgs)?m==null?void 0:m.existingMsgs.length:0;m=e.length;s.endSuccess({"int":{existingMsgs:j,messages_lost:e.length-j-k,newlyAddedMsgs:k,restoredMsgs:j+k,totalMsgsToRestore:m},string:{threadJidPrimaryId:a}});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess({taskSource:p,traceId:l,type:"echo"});d("MAWTraceUtils").recordCheckpointForTrace(l,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_RESTORE_MESSAGES_SUCCESS),[],!1);d("MAWTraceUtils").recordCheckpointForTrace(l,i.ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),[],!0);g.quotesToBeRestored.forEach(function(a){u.messageIds.push(a.messageId),u.pendingRestoreSortKeys.push(a.sortOrderMs)});d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(m=l)!=null?m:""]).LOG(B(),k,j,f);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult(u))})})["catch"](function(a){var c;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(c=l)!=null?c:""]).ERROR(A(),a);s.endFail("error_in_handle_media_or_reaction");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult(u))})})}else{s.endFail("missing_thread_for_thread_jid");d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(q=l)!=null?q:""]).ERROR(z(),a);O(a,null,n,o)}return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult(u))});return function(b,c,d,e,f,g,h,i,j,k,l,m,n){return a.apply(this,arguments)}}();function G(a,b,c,d,e,f,g,h,i,j,k){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,j,k,l,m,n,o){i==null?void 0:i.addPoint("message_restore_start");var p=new Map(),q=n!=null&&n===c("LSMEBTaskCreationSource").MSGR_DYI,r=[];e=(yield J(e,f,a,p,g,i,m));var s=e.dbThread,t=e.hasMoreBefore,u=e.messagesToAdd;g=e.quotesToBeRestoredForThread;r.push.apply(r,g);e=u.map(function(b){return{author:b.author,chat:a.jid,externalId:d("WAStanzaUtils").toStanzaId(b.externalId)}});return(h||(h=b("Promise"))).all([d("MAWRestoreMsgsTxns").maybeGetThreadNewestMessage(a),d("MAWRestoreMsgsTxns").maybeGetOldestNonAdminMessage(a),d("MAWRestoreMsgsTxns").getMsgsByProtocolMsgIds(e)]).then(function(a){var b=a[0],c=a[1],e=c.maybeOldestAdminMsg;c=c.maybeOldestMsg;a=a[2];var g=new Set(a.map(function(a){return a.externalId})),h=u.filter(function(a){return!g.has(a.externalId)});b={existingMsgs:a,hasMoreBefore:t,instanceKey:k,isDyiInProgress:q,isPointRestore:f,maybeNewestMsg:b,maybeOldestAdminMsg:e,maybeOldestMsg:c,minMsgId:j,newMsgs:h,optimisticMsgs:l,taskSource:n,thread:s,traceId:m};var v=[];a.forEach(function(a){return v.push({externalId:a.externalId})});h.forEach(function(a){return v.push({externalId:a.externalId})});return d("MAWRestoreMsgsTxns").restoreMsgsForThread(b).then(function(a){var b=[];(a==null?void 0:a.existingMsgs)!=null&&(b=b.concat(a==null?void 0:a.existingMsgs));(a==null?void 0:a.newlyAddedMsgs)!=null&&(b=b.concat(a==null?void 0:a.newlyAddedMsgs));i==null?void 0:i.addPoint("message_restore_end");o!=null&&!f&&d("MAWRestoreValidationUtils").compareRestoredMsgstoDeanonData(b,o,void 0,v,i);return{echoMsgMap:p,quotesToBeRestored:r,restoredMsgsData:a,thread:s}})})});return H.apply(this,arguments)}var I=d("MAWIndexedDb").makeMsgrTransactor({messages:(e=d("MAWTransactionMode")).READWRITE},"restoreDeleteMessages",function(a){return function(b){var c=[];for(var d=0;d<b.length;d++)c.push(b[d].rowId);return a.messages.bulkDelete(c)}});function J(a,b,c,d,e,f,g){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=new Set(),p=new Map(),q=[];if(a==null||a.length===0){var r;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(r=h)!=null?r:""]).WARN(o(),c.jid);return{dbThread:c,hasMoreBefore:!1,messagesToAdd:[],quotesToBeRestoredForThread:q}}var s=0,t=[];a.forEach(function(a){a=d("EchoMessage").decodeEchoMessage(a);if(a==null){var b;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(b=h)!=null?b:""]).ERROR(n());return}a.contentType===d("EchoMessage").EchoMessageContentType.DECRYPTION_FAILURE&&s++;b=a.xOfflineThreadingId;if(b==null){var c;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(c=h)!=null?c:""]).ERROR(m());return}if(i.has(b)){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(c=h)!=null?c:""]).WARN(l());return}i.add(b);t.push(a)});s===a.length&&(g==null?void 0:g.addPoint("decryption_failure_batch",{"int":{decryptionFailuresCount:s}}));r=(yield F.load());a=r.restoreWithHIM;g=(yield a(t,c.jid,d("WAGlobals").getMyUserJid()));g.forEach(function(a){if(a.xOfflineThreadingId==null)return;var b=d("WAStanzaUtils").toStanzaId(a.xOfflineThreadingId),f=d("MAWHandleEchoMsgsRestoreApiUtils").getUnstoredDbMessageFromEchoMessage(a,c.jid,d("WAGlobals").getMyUserJid(),b,h);if(f!=null){d("MAWEncryptedBackupCacheManager").addMsgEntryToRestoredCache(b,d("EchoBackupCompareUtils").buildEchoDocCacheValue(a));p.set(b,f);e.set(b,a);a=a==null?void 0:a.quoteData;if(a!=null){var g=d("WAStanzaUtils").toStanzaId(a.quoteMessageId);if(g!=null&&!p.has(g))q.push({messageId:a.quoteMessageId,sortOrderMs:a.quoteSortOrderInMs.toString()});else{a=d("MAWRepliesRestoreUtils").addQuoteDataToReplyMessage(f,p.get(g));p.set(b,a)}}}});r=Array.from(p.values());r.sort(function(a,b){return((a=a.sortOrderMs)!=null?a:0)-((a=b.sortOrderMs)!=null?a:0)});a=b||f!==!1;if(!a){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(g=h)!=null?g:""]).LOG(k(),c.jid)}if(r.length>0){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(b=h)!=null?b:""]).LOG(j(),r[0].sortOrderMs,r[r.length-1].sortOrderMs,c.jid)}return{dbThread:c,hasMoreBefore:a,messagesToAdd:r,quotesToBeRestoredForThread:q}});return K.apply(this,arguments)}var L=d("MAWIndexedDb").makeMsgrTransactor({dyiBatch:e.READWRITE,threads:e.READONLY},"restoreGetThread",function(a){return function(b,c,e){return d("MAWDbThreadTxns").getThreadPrimaryId(a,b).then(function(f){if(f.success)return f.value;else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(f=c)!=null?f:""]).ERROR(y(),b);f=d("WAJids").unsafeCoerceToChatJid(b+"@msgr");return e!=null&&e?d("MAWRestoreMsgsTxns").stopDyiForThread(a,f):d("MAWDexieTable").dexieResolve()}})}}),M=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:e.READWRITE,messages:e.READWRITE},"restoreEditMsgHistory",function(a){return function(b,c){c==null?void 0:c.addPoint("msg_history_start");var e=b.restoredMsgsData;if(e!=null){var f=e.newlyAddedMsgs.map(function(c){var f=[],g=c.externalId,h=c.author,i=e.threadJid;c=b.echoMsgMap.get(g);if(c!=null){var j=c.editHistory;return d("MAWDbEditMsgHistoryTxns").getEditHistoryAsEcho(a,g,h,i).then(function(b){if(b.length>=j.length)return d("MAWDexieTable").dexieResolve([]);j.forEach(function(a){return f.push({author:h,editExternalId:a.messageId!=null?d("WAStanzaUtils").toStanzaId(a.messageId):null,editTs:d("WATimeUtils").castToUnixTime(a.timestamp),msgContent:{content:a.text},originalMsgExternalId:g,sendStatus:d("MAWAckLevel").ACK.sent,threadJid:i})});b.length>0&&d("MAWDbEditMsgHistoryTxns").bulkRemoveEditHistory(a,g,h,i);return d("MAWDexieTable").dexieResolve(f)})}else return d("MAWDexieTable").dexieResolve([])});return d("MAWDexieTable").dexieAll(f).then(function(b){return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,b.flat(),!0).then(function(a){return c==null?void 0:c.addPoint("msg_history_end")})})}else{c==null?void 0:c.addPoint("msg_history_end");return d("MAWDexieTable").dexieResolve()}}}),N=function(a,c,d,e){c==null?void 0:c.addPoint("media_restore_start");return P(a,d,e).then(function(a){c==null?void 0:c.addPoint("media_restore_end",{"int":{media:a}});return(h||(h=b("Promise"))).resolve()})};function O(a,b,e,f,g){if(e!=null&&c("gkx")("23961")){var h,i;h=(h=b==null?void 0:(h=b.restoredMsgsData)==null?void 0:h.newlyAddedMsgs.length)!=null?h:0;i=(i=b==null?void 0:(i=b.restoredMsgsData)==null?void 0:i.existingMsgs.length)!=null?i:0;if(f!=null&&f.size>0){var j,k=new Set([].concat((b==null?void 0:(j=b.restoredMsgsData)==null?void 0:(j=j.newlyAddedMsgs)==null?void 0:j.map(function(a){return a.externalId}))||[],(b==null?void 0:(j=b.restoredMsgsData)==null?void 0:(b=j.existingMsgs)==null?void 0:b.map(function(a){return a.externalId}))||[]));j=Array.from(f.keys()).reduce(function(a,b){return a+(k.has(b)?0:1)},0);if(j>0){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(b=g)!=null?b:""]).WARN(x(),a,j);d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521482576,"1069"),"optimistic_msgs_missed_restore",{"int":{messages_backend_existing:i,messages_backend_restored:h,missed_message_count:j,optimistic_msgs_count:f.size}},e)}else d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521482576,"1069"),{"int":{messages_backend_existing:i,messages_backend_restored:h,optimistic_msgs_count:f.size}},e)}else d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521482576,"1069"),{"int":{messages_backend_existing:i,messages_backend_restored:h,optimistic_msgs_count:0}},e)}}function P(a,c,e){var f=a.restoredMsgsData,g=0;if(f){var i=f.existingMsgs.filter(function(a){return d("MAWDbMsg").isMediaMsg(a)&&a.mediaId==null}),j=f.newlyAddedMsgs;i=[].concat(i,j);var k=f.threadJid,l=[];i.map(function(b){var e=b.externalId;e=a.echoMsgMap.get(e);if((e==null?void 0:e.contentType)===d("EchoMessage").EchoMessageContentType.MEDIA||(e==null?void 0:e.contentType)===d("EchoMessage").EchoMessageContentType.XMA){b=Q(k,b,a.echoMsgMap,(e==null?void 0:e.contentType)===d("EchoMessage").EchoMessageContentType.XMA,c);b!=null&&(g+=1,l.push(b))}});return d("MAWHandleEchoMediaMsgsRestoreV2").downloadMediaAndWriteToMediaStore(l,a.thread.jid,e).then(function(a){return g})}return(h||(h=b("Promise"))).resolve(g)}function Q(a,b,e,f,g){e=e.get(b.externalId);if(e==null){if(f){var h;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","xma",(h=g)!=null?h:""]).WARN(w(),b.externalId)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","xma",(h=g)!=null?h:""]).ERROR(v(),b.externalId)}return null}h=e.mediaData;if(h==null){if(f){var i;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","media",(i=g)!=null?i:""]).WARN(u(),e.messageId)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","media",(i=g)!=null?i:""]).ERROR(t(),e.messageId)}return null}i=e.from;if(i==null){if(f){var j;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","media",(j=g)!=null?j:""]).WARN(s())}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","media",(j=g)!=null?j:""]).ERROR(r())}return null}j=e.sortOrderMs;if(j==null){if(f){var k;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","media",(k=g)!=null?k:""]).WARN(q())}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore","media",(k=g)!=null?k:""]).ERROR(p())}return null}g=d("MAWJids").toUserJid(i.localKey);k=g===d("WAGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:g;i=b.externalId;g=b.msgId;b={author:k,echoMsg:e,externalId:i,isXMA:f,messageTimestamp:j,msgId:g,threadJId:a};k=c("gkx")("23925");i=Date.now()-j<1e3*60*60*24*30;return babelHelpers["extends"]({},b,{mediaData:h,previewMediaData:k&&i?e.previewMediaData:null})}function R(a,b,e){a!=null&&e!=null&&b.quotesToBeRestored.map(function(b){d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(b.messageId,a,b.sortOrderMs,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,e)})}g.handleEchoMsgsBulkRestore=a;g.deleteMessages=I;g.getThread=L;g.getMediaMetadataForDownload=Q}),98);
__d("MAWUnstoredQuotedMsgUtils",["MAWMsgType","WAErr","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a==null)return;var b=a.content;a=a.remoteJid;var e;switch(b.type){case d("MAWMsgType").MSG_TYPE.TEXT:e=j(b);break;case d("MAWMsgType").MSG_TYPE.IMAGE:e=k(b);break;case d("MAWMsgType").MSG_TYPE.VIDEO:e=l(b);break;case d("MAWMsgType").MSG_TYPE.PTT:e=m(b);break;case d("MAWMsgType").MSG_TYPE.GIF:e=n(b);break;case d("MAWMsgType").MSG_TYPE.STICKER:e=o(b);break;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:e=q(b);break;case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:e=r(b);break;case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:e=s(b);break;case d("WAMsgType").NOTE_REPLY:e=p(b);break;default:b.type;throw c("WAErr")("For flow")}return{content:e,remoteJid:a}}function i(a){if(d("WAJids").isAuthorSystem(a.author))throw c("WAErr")("A system message cannot be quoted");return{author:a.author,externalId:a.externalId,ts:a.ts}}function j(a){return babelHelpers["extends"]({},i(a),{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT})}function k(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.IMAGE})}function l(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.VIDEO})}function m(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.PTT})}function n(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.GIF})}function o(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.STICKER})}function p(a){return babelHelpers["extends"]({},i(a),{msgContent:a.msgContent,type:d("WAMsgType").NOTE_REPLY})}function q(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE})}function r(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE})}function s(a){return babelHelpers["extends"]({},i(a),{type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL})}function a(a){return{quote:h(a.quote)}}g.getWithQuoteMsg=a}),98);
__d("MAWUnstoredTypedMsgUtils",["MAWDbMsg","MAWMsgType","MAWRavenUtils","MAWUnstoredQuotedMsgUtils","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{ack:a.ack,author:a.id.author,externalId:a.id.externalId,reportingMeta:a.reportingMeta,serverTs:a.serverTs,ts:a.ts}}function i(a){return{forwardingScore:a.forwardingScore,isForwarded:a.isForwarded}}function j(a){return{ephemeralSetting:k(a.ephemeralSetting),messageDeleteTs:a.deleteTs,messageExpirationTs:a.expirationTs}}function k(a){if(a==null)return;return{ephemeralExpirationInSec:a.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.updatedTs}}function a(a,b){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,msgContent:{content:(a=b.sentWithMessage)!=null?a:"",mentionedJids:void 0},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:b.targetType})}function b(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,editCount:0,msgContent:a.msgContent,specialTextSize:a.specialTextSize,type:d("MAWMsgType").MSG_TYPE.TEXT})}function c(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,plaintextHash:(a=a.mediaId)!=null?a:void 0,type:d("MAWMsgType").MSG_TYPE.IMAGE})}function e(a){return babelHelpers["extends"]({},h(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,ravenEphemeralMediaState:d("MAWRavenUtils").getEphemeralMediaState(a.ravenEphemeralMediaState),ravenEphemeralType:a.ravenEphemeralType,type:d("MAWMsgType").MSG_TYPE.RAVEN})}function f(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,plaintextHash:(a=a.mediaId)!=null?a:void 0,type:d("MAWMsgType").MSG_TYPE.VIDEO})}function l(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,type:d("MAWMsgType").MSG_TYPE.PTT})}function m(a){return{adminMsgContent:a.adminMsgContent,adminType:a.adminType}}function n(a){return babelHelpers["extends"]({},h(a),{altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,msgContent:m(a.msgContent),type:d("MAWMsgType").MSG_TYPE.ADMIN})}function o(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,plaintextHash:(a=a.mediaId)!=null?a:void 0,type:d("MAWMsgType").MSG_TYPE.GIF})}function p(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,plaintextHash:(a=a.mediaId)!=null?a:void 0,type:d("MAWMsgType").MSG_TYPE.STICKER})}function q(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:void 0,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE})}function r(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").FUTUREPROOF_ALT_INDEX,msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF})}function s(a){return babelHelpers["extends"]({},h(a),{altIndex:void 0,revokedExternalId:a.revokedExternalId,type:d("MAWMsgType").MSG_TYPE.REVOKED})}function t(a){return{adminMsgContent:a.adminMsgContent,adminType:a.adminType}}function u(a){return babelHelpers["extends"]({},h(a),{altIndex:void 0,msgContent:t(a.msgContent),type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN})}function v(a){return{adminMsgContent:a.adminMsgContent,adminType:a.adminType,screenshotActionType:a.screenshotActionType,version:a.version}}function w(a){return babelHelpers["extends"]({},h(a),{altIndex:void 0,msgContent:v(a.msgContent),type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION})}function x(a){return{adminType:a.adminType,authorName:a.authorName}}function y(a){return babelHelpers["extends"]({},h(a),{altIndex:void 0,msgContent:x(a.msgContent),type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT})}function z(a){return babelHelpers["extends"]({},h(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),{altIndex:void 0,type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE})}g.getXMAMsg=a;g.getTextMsg=b;g.getImageMsg=c;g.getRavenMsg=e;g.getVideoMsg=f;g.getPttMsg=l;g.getAdminMsg=n;g.getGifMsg=o;g.getStickerMsg=p;g.getDocumentFileMsg=q;g.getFutureproofMsg=r;g.getRevokedMsg=s;g.getEphemeralSettingAdminMsg=u;g.getEphemeralScreenshotActionMsg=w;g.getICDCAlertMsg=y;g.getBumpExistingMessageMsg=z}),98);
__d("MAWUnstoredMsgUtils",["MAWMsgType","MAWUnstoredTypedMsgUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.unstoredMsg;a=a.unstoredXMA;if(b==null)return null;switch(b.type){case d("MAWMsgType").MSG_TYPE.TEXT:return d("MAWUnstoredTypedMsgUtils").getTextMsg(b);case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWUnstoredTypedMsgUtils").getImageMsg(b);case d("MAWMsgType").MSG_TYPE.VIDEO:return d("MAWUnstoredTypedMsgUtils").getVideoMsg(b);case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWUnstoredTypedMsgUtils").getPttMsg(b);case d("MAWMsgType").MSG_TYPE.ADMIN:return d("MAWUnstoredTypedMsgUtils").getAdminMsg(b);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return d("MAWUnstoredTypedMsgUtils").getFutureproofMsg(b);case d("MAWMsgType").MSG_TYPE.REVOKED:return d("MAWUnstoredTypedMsgUtils").getRevokedMsg(b);case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWUnstoredTypedMsgUtils").getGifMsg(b);case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWUnstoredTypedMsgUtils").getStickerMsg(b);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("MAWUnstoredTypedMsgUtils").getDocumentFileMsg(b);case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("MAWUnstoredTypedMsgUtils").getEphemeralSettingAdminMsg(b);case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("MAWUnstoredTypedMsgUtils").getEphemeralScreenshotActionMsg(b);case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("MAWUnstoredTypedMsgUtils").getICDCAlertMsg(b);case d("MAWMsgType").MSG_TYPE.XMA:if((a==null?void 0:a.xma)==null)throw c("err")("XMA content cannot be parsed without XMA payload");return d("MAWUnstoredTypedMsgUtils").getXMAMsg(b,a==null?void 0:a.xma);case d("MAWMsgType").MSG_TYPE.RAVEN:return d("MAWUnstoredTypedMsgUtils").getRavenMsg(b);case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:case d("MAWMsgType").MSG_TYPE.REACTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return null;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return d("MAWUnstoredTypedMsgUtils").getBumpExistingMessageMsg(b);default:b.type;return null}}function b(a){if(a==null)return null;switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return d("MAWUnstoredTypedMsgUtils").getTextMsg(a);case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWUnstoredTypedMsgUtils").getGifMsg(a);case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWUnstoredTypedMsgUtils").getStickerMsg(a);default:return null}}function e(a){a=a.unstoredMsg;if(!a||a.type!==d("MAWMsgType").MSG_TYPE.REACTION)return null;a=a;return{ack:a.ack,author:a.id.author,externalId:a.id.externalId,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,reactToExternalId:a.reactToExternalId,senderTimestampMs:a.senderTimestampMs,threadJid:a.id.chat,ts:a.ts}}function f(a){a=a.unstoredMsg;if(!a||a.type!==d("MAWMsgType").MSG_TYPE.RAVEN_ACTION)return null;a=a;return{ack:a.ack,actionTimestamp:a.actionTimestamp,actionType:a.actionType,author:a.id.author,externalId:a.id.externalId,ravenActionToMsgExternalId:a.ravenActionToMsgExternalId,ts:a.ts,type:a.type}}function h(a){a=a.unstoredIncomingGroupInvite;return!a?null:babelHelpers["extends"]({},a)}function i(a){return a==null?null:{ack:a.ack,author:a.id.author,editMsgContent:a.editMsgContent,externalId:a.id.externalId,originalMsgExternalId:a.originalMsgExternalId,reportingMeta:a.reportingMeta,serverTs:a.serverTs,specialTextSize:a.specialTextSize,ts:a.ts,type:a.type}}g.getUnstoredMsg=a;g.getUnstoredAssociatedMsg=b;g.getUnstoredReaction=e;g.getUnstoredRavenActionMsg=f;g.getGroupInvite=h;g.getUnstoredEditActionMsg=i}),98);
__d("MAWUnstoredMediaUtils",["MAWUnstoredMsgUtils","WASortedLists"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a==null?null:{mediaEntry:a.mediaEntry,mediaType:a.mediaType,msgIds:d("WASortedLists").emptySet(),plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedVideoInfo:a.validatedVideoInfo}}function a(a){a=a.unstoredXMA;if(a==null)return;var b=a.unstoredAssociatedMedia,c=a.unstoredAssociatedMsg,e=a.unstoredFavicon,f=a.unstoredHeaderMedia,g=a.unstoredPreviews;a=a.xma;return{unstoredAssociatedMedia:(b=h(b))!=null?b:void 0,unstoredAssociatedMsg:(b=d("MAWUnstoredMsgUtils").getUnstoredAssociatedMsg(c))!=null?b:void 0,unstoredDbXMA:{author:a.author,contentRef:a.contentRef,ctas:a.ctas,defaultCTA:a.defaultCTA,externalId:a.externalId,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,subtitleText:a.subtitleText,targetExpiringAtSec:a.targetExpiringAtSec,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType},unstoredFavicon:(c=h(e))!=null?c:void 0,unstoredHeaderMedia:(b=h(f))!=null?b:void 0,unstoredPreviews:g?g.map(function(a){return h(a)}).filter(Boolean):void 0}}g.getUnstoredMedia=h;g.getUnstoredXMA=a}),98);
__d("MAWUnstoredContentToUnstoredDbContentUtils",["MAWUnstoredMediaUtils","MAWUnstoredMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c=(b=d("MAWUnstoredMsgUtils")).getUnstoredMsg(a),e=d("MAWUnstoredMediaUtils").getUnstoredMedia(a.unstoredMedia),f=b.getUnstoredReaction(a),g=b.getUnstoredRavenActionMsg(a),h=d("MAWUnstoredMediaUtils").getUnstoredXMA(a),i=b.getGroupInvite(a);b=b.getUnstoredEditActionMsg(a.unstoredEditMsg);if(i==null)return{contentTypeForLogging:a.contentTypeForLogging,unstoredDbEditActionMsg:b,unstoredDbMedia:e,unstoredDbMsg:c,unstoredDbRavenActionMsg:g,unstoredDbReaction:f,unstoredXMA:h,xmaTargetTypeForLogging:a.xmaTargetTypeForLogging};else return{contentTypeForLogging:a.contentTypeForLogging,unstoredDbEditActionMsg:b,unstoredDbMedia:e,unstoredDbMsg:c,unstoredDbRavenActionMsg:g,unstoredDbReaction:f,unstoredIncomingDbGroupInvite:i,unstoredXMA:h,xmaTargetTypeForLogging:a.xmaTargetTypeForLogging}}g.unstoredContentToUnstoredDbContent=a}),98);
__d("MAWWriteReactionTxns",["MAWAuthor","MAWDbMsg","MAWDbReaction","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDexieTable","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=b.author,g=b.externalId,h=b.groupingKey,i=b.reaction,j=b.reactToAuthor,k=b.reactToExternalId,l=b.senderTimestampMs,m=b.ts;return d("MAWDexieTable").dexieAll([a.messages.where("externalId").equals(k).toArray(),a.reactions.where("reactToExternalId").equals(k).toArray(),d("MAWDbReactionsTxns").getNextReactionIdNumberForThread(a,e)]).then(function(b){var n=b[0],o=b[1];b=b[2];o=d("MAWDbReaction").findMatchingReaction(o,e.jid,f);var p=d("MAWAuthor").getAuthorUserJid(j);n=n.find(function(a){return a.threadJid===e.jid&&p===d("MAWAuthor").getAuthorUserJid(a.author)});var q=d("MAWDbReaction").formatReactionForDb(e.jid,g,d("MAWDbMsg").craftReactionId(e.chatId,b),k,i,h,j,n==null?void 0:n.msgId,m,f,o==null?void 0:o.rowId,void 0,l);return d("MAWDbReactionsTxns").putReaction(a,q).then(function(a){a=babelHelpers["extends"]({},q,{rowId:a});c("qex")._("1016")!==!0&&d("MAWDbReactionUtils").dispatchReaction(a);return a})})}g.writeReaction=a}),98);
__d("MAWWriteReactionMsgApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","MAWWriteReactionTxns","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,e,f,g){g===void 0&&(g=d("WAJids").AUTHOR_ME);var h=e.groupingKey,i=e.reaction,j=e.reactToAuthor,k=e.reactToExternalId;e=e.senderTimestampMs;var l={author:g,externalId:b,groupingKey:h,reaction:i,reactToAuthor:j,reactToExternalId:k,senderTimestampMs:e,ts:f};return a.threads.get({jid:c}).then(function(b){return b==null?"missing_thread":d("MAWWriteReactionTxns").writeReaction(a,l,b)}).then(function(a){return a==="missing_thread"?{type:"missing_thread"}:{msgId:a.reactionId,protocolMsgId:{author:g,chat:c,externalId:a.externalId},type:"not_sent"}})};b=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READWRITE,threads:a.READWRITE},"writeReactionMsg",function(a){return function(b,c,e,f,g){g===void 0&&(g=d("WAJids").AUTHOR_ME);return h(a,b,c,e,f,g)}});c=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:a.READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READWRITE,threads:a.READWRITE},"bulkWriteReactionMsg",function(a){return function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return h(a,b.externalId,b.chatJid,b.args,b.ts,b.author)}))}});g.writeReactionMsg=b;g.bulkWriteReactionMsg=c}),98);
__d("MessageBackupSupplementalKeyGenerator",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";b=b("$InternalEnum")({REACTION:"reaction",EDIT:"edit"});var g=":";function a(a,b){return""+a+g+b}function c(a){return a.split(g)[1]}function h(a,b){b=b.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");b=new RegExp("^"+b,"i");return b.test(a)}function d(a){return h(a,"reaction")}function e(a){return h(a,"edit")}f.SupplementalKeyPrefix=b;f.SUPPLEMENTAL_KEY_DELIMITER=g;f.createMessageSupplementalKey=a;f.getSupplementalSenderId=c;f.isSupplementalProtobufAReaction=d;f.isSupplementalProtobufAnEdit=e}),66);
__d("MAWHandleEchoProtobufsRestoreApi",["EchoMessageMediaFieldUtils","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWBridge","MAWBridgeEventTransmitter","MAWBridgeMsg","MAWBridgeXMA","MAWDbEditMsgHistoryTxns","MAWDbMsg","MAWDexieTable","MAWEBRestoreTrackingUtils","MAWEBUploadMessageUtils","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoMsgsRestoreApiUtils","MAWHandleEchoMsgsRestoreApiV2","MAWHandleEchoXMARestoreV2","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWJids","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWRestoreMsgsTxns","MAWRestoreValidationUtils","MAWTraceUtils","MAWTransactionMode","MAWUnstoredContentToUnstoredDbContentUtils","MAWUpdateQuotedMsgTxns","MAWWriteReactionMsgApi","MessageBackupSupplementalKeyGenerator","Promise","WAAckLevel","WAArmadilloApplication.pb","WAArmadilloBackupMessage.pb","WABase64","WAConsumerApplication.pb","WAGlobals","WAHashUtils","WAJids","WALogger","WAMediaTransport.pb","WAMediaUtils","WAMsgApplication.pb","WAMsgType","WAParseConsumerMessageProtocol","WAParseMessageApplication","WAStanzaUtils","WATimeUtils","asyncToGeneratorRuntime","decodeProtobuf","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Cannot download media - timestamp cannot be null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] cannot support message type for protobuf restore - reverting to echo restore"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Protobuf restore initiated for "," messages. isPointRestore: "," referenceTimestamp: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] No text content found in edit msg"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unable to parse edit msg, missing either timestamp or msg id"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message contains unparseable message application - unable to restore message"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unable to retrieve decoded protobuf from backup message - unsupported message type"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] No author found for original message that was bumped - unable to restore"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unable to retrieve revoked message external id"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Invalid attachment type, cannot restore attachment"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Unsupported media type, cannot get mimetype for attachment"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Failed to create db msg from protobuf"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Missing required fields, unable to create db msg from protobuf for thread jid "," and otid ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] No target type found for XMA - unable to extract XMA content for message"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] XMA data is null - unable to extract XMA content for message"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Timestamp for original message not found - cannot restore revoked msg"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] No revoked msg external id found for revoked msg"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] text content cannot be null for msg type text - unable to restore msg"]);A=function(){return a};return a}var B=new Set(),C=new Set(),D=new Map(),E=new Map(),F=new Map(),G=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READONLY,media:e.READONLY,messages:e.READWRITE,xma:e.READONLY},"associateQuotedMessagesForRestoredDbMsgs",function(a){return function(b,c,e){var f=0;return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,c,b,!0).then(function(b){b!=null&&b.length>0&&(f+=b.length,b.forEach(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a)})})}))})})).then(function(){e==null?void 0:e.addPoint("replies_restore_end",{"int":{replies:f}});return d("MAWDexieTable").dexieResolve()})}});function H(a,b,c){c={author:c,chat:b,externalId:a};return c}function I(a,b,c){var e=new Map(),f=a.metadata;a=a.reactionData;if(f!=null&&a!=null){var g=f.senderId,h=f.messageId;if(g!=null&&h!=null){a.forEach(function(a){var f=a.ts,i=a.senderId,j=a.reactionExternalId,k=d("WAStanzaUtils").toStanzaId(h);if(i==null||j==null)return;j=d("WAStanzaUtils").toStanzaId(j);i=d("MAWJids").toUserJid(i);var l=d("MAWJids").toUserJid(g);i=i===c?d("WAJids").AUTHOR_ME:i;l=l===c?d("WAJids").AUTHOR_ME:l;var m=i===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED;m={ack:m,chatJid:b,reaction:a.reaction,reactionAuthor:i,reactionExternalId:j,reactToExternalId:k,reactToMsgAuthor:l,ts:f};e.set(j,m)});return e}}}function J(a,b,c,e,f,g,h,i,j,k){if(a===d("MAWMsgType").MSG_TYPE.TEXT)if(h==null){d("WALogger").ERROR(A());return}else{h={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,msgContent:{content:h,mentionedJids:i!=null?i.map(d("WAJids").validateUserJid).filter(Boolean):void 0},ts:b,type:d("MAWMsgType").MSG_TYPE.TEXT};return h}else if(a===d("MAWMsgType").MSG_TYPE.VIDEO){i={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,mediaId:void 0,ts:b,type:d("MAWMsgType").MSG_TYPE.VIDEO};return i}else if(a===d("MAWMsgType").MSG_TYPE.GIF){h={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,mediaId:void 0,ts:b,type:d("MAWMsgType").MSG_TYPE.GIF};return h}else if(a===d("MAWMsgType").MSG_TYPE.IMAGE){i={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,mediaId:void 0,ts:b,type:d("MAWMsgType").MSG_TYPE.IMAGE};return i}else if(a===d("MAWMsgType").MSG_TYPE.STICKER){h={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,mediaId:void 0,ts:b,type:d("MAWMsgType").MSG_TYPE.STICKER};return h}else if(a===d("MAWMsgType").MSG_TYPE.PTT){i={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,mediaId:void 0,ts:b,type:d("MAWMsgType").MSG_TYPE.PTT};return i}else if(a===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE){h={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,mediaId:void 0,ts:b,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE};return h}else if(a===d("MAWMsgType").MSG_TYPE.XMA){i={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,forwardingScore:g,id:e,isForwarded:f,ts:b,type:d("MAWMsgType").MSG_TYPE.XMA};return i}else if(a===d("MAWMsgType").MSG_TYPE.REVOKED){if(j==null){d("WALogger").ERROR(z());return}if(k==null){d("WALogger").ERROR(y());return}h={ack:c===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED,id:e,msgContent:void 0,revokedExternalId:j,ts:d("WATimeUtils").castMilliSecondsToUnixTime(k),type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:b};return h}else if(a===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE){g={ack:d("WAAckLevel").ACK.SENT,id:e,ts:b,type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE};return g}}function K(a,b,c,e,f){if(f==null){d("WALogger").ERROR(x());return}var g=f==null?void 0:f.ctas.map(function(a){return{actionUrl:a.actionUrl,buttonType:a.buttonType,ctaType:a.ctaType,nativeUrl:a.nativeUrl,title:a.title}}),h=f.targetType;if(h==null){d("WALogger").ERROR(w());return}var i;f.targetExpiringAtSec!=null&&typeof f.targetExpiringAtSec==="number"&&(i=d("WATimeUtils").castToUnixTime(f.targetExpiringAtSec));a={author:a,contentRef:f.contentRef,ctas:g,defaultCTA:g.length>0?g[0]:void 0,externalId:b,headerTitle:f.headerTitle,maxSubtitleNumOfLines:f.maxSubtitleNumOfLines,maxTitleNumOfLines:f.maxTitleNumOfLines,msgId:c,overlayDescription:f.overlayDescription,overlayIconGlyph:f.overlayIconGlyph,overlayTitle:f.overlayTitle,subtitleText:f.subtitleText,targetExpiringAtSec:i,targetId:f.targetId,targetType:h,targetUsername:f.targetUsername,threadJid:e,titleText:f.titleText,xmaLayoutType:f.xmaLayoutType};return a}function L(a,b,c){var e=a.metadata,f=a.msgType;if(e!=null&&f!=null){var g,h,i=e.timestampMs,j=e.messageId;e=e.senderId;g=(g=a.decodedPayload)==null?void 0:g.text;h=(h=a.decodedPayload)==null?void 0:h.mentionedJid;if(i!=null&&typeof i==="number"&&j!=null&&e!=null){i=d("WATimeUtils").castMilliSecondsToUnixTime(i);e=d("MAWJids").toUserJid(e);var k=d("WAStanzaUtils").toStanzaId(j),l=e===c?d("WAJids").AUTHOR_ME:e,m=H(k,b,e);if(a.editMsgData.length>0){var n=i;a.editMsgData.forEach(function(a){var b;if(a.ts>n&&((b=a.editMsgContent.message)==null?void 0:b.text)!=null){n=a.ts;g=(b=a.editMsgContent.message)==null?void 0:b.text;h=(b=a.editMsgContent.message)==null?void 0:b.mentionedJid}})}i=J(f,i,l,m,a.isForwarded,a.forwardingScore,g,h,a.revokedMsgExternalId,a.revokedMsgTimestampMs);if(i==null){d("WALogger").ERROR(v(),b,k);return}var o;if(a.xmaData!=null&&((l=a.xmaData)==null?void 0:l.targetType)!=null){l={author:e,externalId:k,targetType:(m=a.xmaData)==null?void 0:m.targetType,threadJid:b};o={unstoredAssociatedMedia:void 0,unstoredAssociatedMsg:void 0,unstoredFavicon:void 0,unstoredHeaderMedia:void 0,unstoredPreviews:void 0,xma:l}}e={unstoredMedia:void 0,unstoredMsg:i,unstoredQuotedMedia:void 0,unstoredXMA:o};m=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(e);if(m.unstoredDbMsg!=null){b=m.unstoredDbMsg;a.noteReply!=null&&(b.quote={content:a.noteReply,remoteJid:void 0});l=D.get(j);b.author!=null&&c===b.author&&b.author!==d("WAJids").AUTHOR_SYSTEM&&(b.author=d("WAJids").AUTHOR_ME);l!=null&&(b.quoteExternalId=d("WAStanzaUtils").toStanzaId(l));f===d("MAWMsgType").MSG_TYPE.TEXT&&(b.editCount=a.editMsgData.length);i={author:b.author,stanzaId:k,unstoredDbContent:m};return i}}}d("WALogger").ERROR(u())}function M(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;default:return null}}function N(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:return d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:return d("EchoMessageMediaFieldUtils").AttachmentType.GIF;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:return d("EchoMessageMediaFieldUtils").AttachmentType.STICKER;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:return d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:return d("EchoMessageMediaFieldUtils").AttachmentType.PTT;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:return d("EchoMessageMediaFieldUtils").AttachmentType.XMA;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT:return d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT;default:return null}}function O(a){var b;switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:b="image/jpeg";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:b="audio/wav";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:b="video/mp4";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:b="image/gif";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:b="image/webp";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:b="image/jpeg";break;case d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT:b=d("WAGlobals").getConfig().isOctetStreamAttachmentMimeTypeEnabled()===!0?"application/octet-stream":"application/pdf";break;default:d("WALogger").ERROR(t())}return b}function P(a,b,c){var e,f,g,h,i,j;b=b;var k=a.ancillary;a=a.integral;e=a==null?void 0:(e=a.transport)==null?void 0:(e=e.integral)==null?void 0:e.fileSha256;f=a==null?void 0:(f=a.transport)==null?void 0:(f=f.integral)==null?void 0:f.fileEncSha256;g=a==null?void 0:(g=a.transport)==null?void 0:(g=g.integral)==null?void 0:g.mediaKey;h=(a==null?void 0:(h=a.transport)==null?void 0:(h=h.integral)==null?void 0:h.mediaKeyTimestamp)!=null?typeof (a==null?void 0:(h=a.transport)==null?void 0:h.integral.mediaKeyTimestamp)==="number"?a==null?void 0:(h=a.transport)==null?void 0:h.integral.mediaKeyTimestamp:void 0:void 0;var l=k==null?void 0:k.gifPlayback;l!=null&&l&&(b=d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF);l=a==null?void 0:(l=a.transport)==null?void 0:(l=l.ancillary)==null?void 0:(l=l.thumbnail)==null?void 0:l.thumbnailHeight;i=a==null?void 0:(i=a.transport)==null?void 0:(i=i.ancillary)==null?void 0:(i=i.thumbnail)==null?void 0:i.thumbnailWidth;var m=M(b),n=N(b);if(n===null){d("WALogger").ERROR(s());return}a={attachmentObjectId:a==null?void 0:(j=a.transport)==null?void 0:(j=j.ancillary)==null?void 0:j.objectId,attachmentType:n,directPath:a==null?void 0:(j=a.transport)==null?void 0:(n=j.integral)==null?void 0:n.directPath,encryptedHash:f!=null?d("WAHashUtils").toPlaintextHash(f):void 0,filename:c,height:k==null?void 0:k.height,mediaKey:g!=null?d("WABase64").encodeB64UrlSafe(g):void 0,mediaKeyTimestamp:h,mediaPlayableDuration:k==null?void 0:k.seconds,plaintextHash:e!=null?d("WAHashUtils").toPlaintextHash(e):void 0,width:k==null?void 0:k.width,xAttachmentType:b,xContentType:"full"};j=O(b);j!=null&&(a.mediaContentType=j);m!=null&&(a.previewContentType=m,a.previewContentHeight=l,a.previewContentWidth=i);return d("EchoMessageMediaFieldUtils").convertMediaMetadataDetailsToMediaMetadata(a)}function Q(a,b,c,e){b!=null&&a!=null&&(c.push({mediaMetadata:b,mediaRestoreType:e}),E.set(d("WAStanzaUtils").toStanzaId(a),c))}function R(a,b,c,e,f){var g,h,i=T(a);g=i==null?void 0:(g=i.obj.payload)==null?void 0:g.content;var j={editMsgData:[],externalId:e,forwardingScore:(h=i==null?void 0:(h=i.metadata)==null?void 0:h.forwardingScore)!=null?h:0,isForwarded:(h=i==null?void 0:(h=i.metadata)==null?void 0:h.isForwarded)!=null?h:!1,metadata:a.metadata,reactionData:[],unknownFieldCount:a.$$unknownFieldCount},k=[];if(g!=null){if(g.messageText!=null){j.msgType=d("MAWMsgType").MSG_TYPE.TEXT;j.decodedPayload=g.messageText;return j}else if(g.extendedContentMessage!=null){j.msgType=d("MAWMsgType").MSG_TYPE.XMA;j.xmaData=g.extendedContentMessage;if(((h=g.extendedContentMessage)==null?void 0:h.headerImage)!=null){h=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,(h=g.extendedContentMessage)==null?void 0:h.headerImage.payload);h=P(h,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);Q(e,h,k,"xma_header")}if(((h=g.extendedContentMessage)==null?void 0:h.favicon)!=null){h=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,(h=g.extendedContentMessage)==null?void 0:h.favicon.payload);h=P(h,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);Q(e,h,k,"xma_favicon")}if(((h=g.extendedContentMessage)==null?void 0:h.previews)!=null){(h=g.extendedContentMessage)==null?void 0:h.previews.forEach(function(a){a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,a.payload);a=P(a,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);j.mediaMetadata=a;Q(e,a,k,"xma_preview")})}return j}else if(g.audioMessage!=null){h=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,(h=g.audioMessage)==null?void 0:(h=h.audio)==null?void 0:h.payload);h=P(h,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO);j.msgType=d("MAWMsgType").MSG_TYPE.PTT;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}else if(g.videoMessage!=null){var l;l=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,(l=g.videoMessage)==null?void 0:(l=l.video)==null?void 0:l.payload);h=P(l,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO);h!=null&&h.xAttachmentType===d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF?j.msgType=d("MAWMsgType").MSG_TYPE.GIF:j.msgType=d("MAWMsgType").MSG_TYPE.VIDEO;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}else if(g.imageMessage!=null){l=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(l=g.imageMessage)==null?void 0:(l=l.image)==null?void 0:l.payload);h=P(l,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);j.msgType=d("MAWMsgType").MSG_TYPE.IMAGE;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}else if(g.stickerMessage!=null){l=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,(l=g.stickerMessage)==null?void 0:(l=l.sticker)==null?void 0:l.payload);h=P(l,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER);j.msgType=d("MAWMsgType").MSG_TYPE.STICKER;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}else if(g.documentMessage!=null){l=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,(l=g.documentMessage)==null?void 0:(l=l.document)==null?void 0:l.payload);h=P(l,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT,(l=g.documentMessage)==null?void 0:l.fileName);j.msgType=d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}}else if((i==null?void 0:(g=i.obj.payload)==null?void 0:(l=g.applicationData)==null?void 0:l.revoke)!=null){g=i==null?void 0:(g=i.obj.payload)==null?void 0:(l=g.applicationData)==null?void 0:(g=l.revoke)==null?void 0:(l=g.key)==null?void 0:l.id;if(g==null)d("WALogger").ERROR(r());else{j.revokedMsgExternalId=d("WAStanzaUtils").toStanzaId(g);j.msgType=d("MAWMsgType").MSG_TYPE.REVOKED;b!=null&&(j.revokedMsgTimestampMs=b);return j}}if((i==null?void 0:(l=i.obj.payload)==null?void 0:(g=l.content)==null?void 0:g.bumpExistingMessage)!=null){g=i==null?void 0:(b=i.obj.payload)==null?void 0:(l=b.content)==null?void 0:l.bumpExistingMessage;l=(b=g.key)==null?void 0:b.id;l!=null&&(C.has(l)||B.add(l),D.set(e,l));l=(b=g.key)==null?void 0:b.participant;if(l==null){l=(b=g.key)==null?void 0:b.remoteJid}if(l==null)d("WALogger").ERROR(q());else{g=d("WAJids").unsafeCoerceToUserJid(l);b=g===c?d("WAJids").AUTHOR_ME:g;F.set(d("WAStanzaUtils").toStanzaId(e),b);j.msgType=d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE;return j}}if((i==null?void 0:(l=i.obj)==null?void 0:(g=l.payload)==null?void 0:(b=g.content)==null?void 0:b.noteReplyMessage)!=null){l=i==null?void 0:(l=i.obj)==null?void 0:(g=l.payload)==null?void 0:(b=g.content)==null?void 0:b.noteReplyMessage;g=l.noteTimestampMs;b=l.noteText;a=(a=a.metadata)==null?void 0:a.senderId;if(g!=null&&typeof g==="number"&&a!=null&&f!=null){a=d("MAWJids").toUserJid(a);f=d("MAWJids").toUserJid(f);a=f===a?c:f;f={author:a===c?d("WAJids").AUTHOR_ME:a,externalId:d("WAStanzaUtils").toStanzaId(e),ts:d("WATimeUtils").castMilliSecondsToUnixTime(g),type:d("WAMsgType").NOTE_REPLY};if((b==null?void 0:b.text)!=null){c={content:b==null?void 0:b.text,mentionedJids:b==null?void 0:b.mentionedJid.map(function(a){return d("MAWJids").toUserJid(a)})};f.msgContent=c}j.noteReply=f}if(l.textContent!=null){j.msgType=d("MAWMsgType").MSG_TYPE.TEXT;j.decodedPayload=l.textContent;return j}else if(l.stickerContent!=null){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,l.stickerContent.payload);h=P(a,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER);j.msgType=d("MAWMsgType").MSG_TYPE.STICKER;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}else if(l.videoContent!=null){g=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,l.videoContent.payload);h=P(g,d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO);h!=null&&h.xAttachmentType===d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF?j.msgType=d("MAWMsgType").MSG_TYPE.GIF:j.msgType=d("MAWMsgType").MSG_TYPE.VIDEO;j.mediaMetadata=h;Q(e,h,k,"attachment");return j}}i!=null&&S(j,i.obj);d("WALogger").ERROR(p());return j}function S(a,b){var c;(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.locationMessage)!=null&&(a.futureProofMessageType="locationMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.liveLocationMessage)!=null&&(a.futureProofMessageType="liveLocationMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.pollCreationMessage)!=null&&(a.futureProofMessageType="pollCreationMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.pollUpdateMessage)!=null&&(a.futureProofMessageType="pollUpdateMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.viewOnceMessage)!=null&&(a.futureProofMessageType="viewOnceMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.contactMessage)!=null&&(a.futureProofMessageType="contactMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.extendedTextMessage)!=null&&(a.futureProofMessageType="extendedTextMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.groupInviteMessage)!=null&&(a.futureProofMessageType="groupInviteMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.commonSticker)!=null&&(a.futureProofMessageType="commonSticker");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.screenshotAction)!=null&&(a.futureProofMessageType="screenshotAction");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.ravenMessage)!=null&&(a.futureProofMessageType="ravenMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.ravenActionNotifMessage)!=null&&(a.futureProofMessageType="ravenActionNotifMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.extendedMessageContentWithSear)!=null&&(a.futureProofMessageType="extendedMessageContentWithSear");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.imageGalleryMessage)!=null&&(a.futureProofMessageType="imageGalleryMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.paymentsTransactionMessage)!=null&&(a.futureProofMessageType="paymentsTransactionMessage");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.ravenMessageMsgr)!=null&&(a.futureProofMessageType="ravenMessageMsgr");(b==null?void 0:(c=b.payload)==null?void 0:(c=c.applicationData)==null?void 0:c.metadataSync)!=null&&(a.futureProofMessageType="metadataSync");(b==null?void 0:(c=b.payload)==null?void 0:(b=c.applicationData)==null?void 0:b.aiBotResponse)!=null&&(a.futureProofMessageType="aiBotResponse")}function T(a){var b;b=(b=a.metadata)==null?void 0:b.messageId;a=d("decodeProtobuf").decodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);var c=d("WAParseMessageApplication").parseMessageApplication(a);if(c.type==="error"){d("WALogger").ERROR(o());return}a=a.metadata;var e=a==null?void 0:a.quotedMessage;e=e==null?void 0:e.stanzaId;b!=null&&e!=null&&(C.has(e)||B.add(e),D.set(b,e));if(c.subprotocolType==="armadillo"){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,c.payload);return{metadata:a,obj:b}}else if(c.subprotocolType==="consumerMessage")return{metadata:a,obj:d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,c.payload)}}function U(a,b,c){return a.map(function(a){return V(a,b,c)})}function V(a,b,c){var e=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,a.toplevelProtobuf.decryptedProtobuf);e=R(e,a.toplevelProtobuf.protobufTimestampMS,b,a.otid,c);c=a.supplementalProtobufs;for(c of c){var f=c[0],g=c[1];if(!d("MessageBackupSupplementalKeyGenerator").isSupplementalProtobufAReaction(f)&&!d("MessageBackupSupplementalKeyGenerator").isSupplementalProtobufAnEdit(f))continue;var h=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,g.decryptedProtobuf);if(d("MessageBackupSupplementalKeyGenerator").isSupplementalProtobufAReaction(f)&&h.payload!=null){var i,j;i=(i=h.metadata)==null?void 0:i.messageId;j=(j=T(h))==null?void 0:(j=j.obj.payload)==null?void 0:(j=j.content)==null?void 0:j.reactionMessage;var k=d("MessageBackupSupplementalKeyGenerator").getSupplementalSenderId(f);j!=null&&k!=null&&e.reactionData.push({reaction:j,reactionExternalId:i,senderId:k,ts:d("WATimeUtils").castMilliSecondsToUnixTime(g.protobufTimestampMS)})}else if(d("MessageBackupSupplementalKeyGenerator").isSupplementalProtobufAnEdit(f)&&h.payload!=null){j=f.split(":");j.length!==3&&d("WALogger").ERROR(n());i=d("WAStanzaUtils").toStanzaId(j[1]);j=(k=T(h))==null?void 0:(g=k.obj.payload)==null?void 0:(f=g.content)==null?void 0:f.editMessage;g=(k=h.metadata)==null?void 0:k.senderId;if(j!=null){h=(f=j.key)==null?void 0:f.id;k=j.timestampMs;if(h!=null&&k!=null&&g!=null&&typeof k==="number"){f=d("MAWJids").toUserJid(g);g=f===b?d("WAJids").AUTHOR_ME:f;f=k;e.editMsgData.push({author:g,editMsgContent:j,externalId:i,originalMsgExternalId:d("WAStanzaUtils").toStanzaId(h),ts:d("WATimeUtils").castMilliSecondsToUnixTime(f)})}}}}C.add(a.otid);return e}function W(a,b,e,f,g,h){h==null?void 0:h.addPoint("replies_restore_start");return G(a,g,h).then(function(){b!=null&&(B.forEach(function(a){d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(a,b,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,g)}),B.clear(),D.clear(),C.clear(),E.clear());if(f)return d("MAWHandleEchoMsgsRestoreApiV2").deleteMessages(a)})}function aa(a,e,f){f==null?void 0:f.addPoint("xma_restore_start");var g=[],h=new Map();return(i||(i=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("MAWDbMsg").isXMAMsg(a)){var b=a.externalId,c=e.get(b);if(c!=null&&c.xmaData!=null){a=K(a.author,a.externalId,a.msgId,a.threadJid,c.xmaData);if(a!=null){var f,i,j=[],k=[],l=[];c=E.get(b);c!=null&&c.forEach(function(a){var b=d("WAMediaUtils").stringToDeliveryObjectId(a.mediaMetadata.attachmentObjectId);l.push(b);a.mediaRestoreType==="xma_header"&&(f=b);a.mediaRestoreType==="xma_favicon"&&(i=b);a.mediaRestoreType==="xma_preview"&&j.push(b)});var m=(yield d("MAWHandleEchoXMARestoreV2").getMediaForXMAByObjectIds(l));m.forEach(function(a,b){h.set(a.mediaId,a)});if(f!=null){a.headerMediaId=(b=m.get(f))==null?void 0:b.mediaId}if(i!=null){a.faviconMediaId=(c=m.get(i))==null?void 0:c.mediaId}j.forEach(function(a){a=(a=m.get(a))==null?void 0:a.mediaId;a!=null&&k.push(a)});a.previewMediaIds=k;k.length>0&&(a.defaultPreviewMediaId=k[0]);g.push(a)}}}});return function(b){return a.apply(this,arguments)}}())).then(function(){return d("MAWHandleEchoXMARestoreV2").writeXMAsToDb(g).then(function(a){a.forEach(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a.previewMediaIds!=null&&a.previewMediaIds.length>0&&(b=h.get(a.previewMediaIds[0]));var e;c("gkx")("821")?e=(yield d("MAWHandleXmaTransactionUtil").checkMediaChunkTransactionAndCreatedBridgeXma(b,a)):e=d("MAWBridgeXMA").createBridgeXMA(b,a,!1);d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewXMA",value:e}]})});return function(b){return a.apply(this,arguments)}}()),f==null?void 0:f.addPoint("xma_restore_end",{"int":{xma:a.length}})})})}function a(a){return X.apply(this,arguments)}function X(){X=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.currentUserJid,f=a.deanonApiPayload,g=a.decryptedMessagesProtobufs,m=a.echoMessages,n=a.hasMoreAfter,o=a.hasMoreBefore,p=a.instanceKey,q=a.isPointRestore,r=a.minMsgId,s=a.referenceTimestamp,t=a.requestId,u=a.taskSource;a=a.threadJidPrimaryId;if(g.length===0)return(i||(i=b("Promise"))).resolve();d("WALogger").LOG(l(),g.length,q,s);var v=u!=null&&u===c("LSMEBTaskCreationSource").MSGR_DYI,w=a,x=(yield d("MAWHandleEchoMsgsRestoreApiV2").getThread(a,t,v));s=q?d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.POINT_RESTORE:s!=null?d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.PAGINATED_RESTORE:d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.INITIAL_RESTORE;s=s;var y=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521486220,"827"),{bool:{isPointRestore:q},"int":{messages:g.length},string:{message_backup_type:"protobuf",restore_type:s}},void 0,3e5);d("MAWTraceUtils").recordCheckpointForTrace(t,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_RESTORE_BEGIN),[],!1);if(x){s=U(g,e,a);var z=x.jid,A=new Set(),B=new Map(),D=s.map(function(a){B.set(d("WAStanzaUtils").toStanzaId(a.externalId),a);var b=L(a,z,e);b==null&&A.add(a.externalId);return b}).filter(Boolean);s=s.filter(function(a){return A.has(a==null?void 0:a.externalId)});if(s.length>0){var G=new Map();s.forEach(function(a){var b="unknown";a.msgType!=null?b=a.msgType:a.futureProofMessageType!=null&&(b=a.futureProofMessageType);a=G.get(b);a!=null?G.set(b,a+1):G.set(b,1)});var H={};G.forEach(function(a,b){b="protobuf_restore_failure_"+b;H[b]=a});y==null?void 0:y.addPoint("protobuf_restore_failed_count_by_msg_type",{"int":H});if(m!=null&&m.length===g.length){d("WALogger").LOG(k());C.clear();y==null?void 0:y.addPoint("reverting_to_echo_restore");yield d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(a,m,!1,o,n,r,void 0,void 0,p,void 0,void 0,y);return}}s=D.map(function(a){return{author:a.author,chat:x.jid,externalId:a.stanzaId}});var I=new Set();m=D.map(function(a){I.add(a.stanzaId);return babelHelpers["extends"]({},babelHelpers["extends"]({},a.unstoredDbContent.unstoredDbMsg,{threadJid:x.jid}))});m.forEach(function(a){var b=d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(a);a.sortOrderMs=b});m.sort(function(a,b){return((a=a.sortOrderMs)!=null?a:0)-((a=b.sortOrderMs)!=null?a:0)});n=(yield (i||(i=b("Promise"))).all([d("MAWRestoreMsgsTxns").maybeGetThreadNewestMessage(x),d("MAWRestoreMsgsTxns").maybeGetOldestNonAdminMessage(x),d("MAWRestoreMsgsTxns").getMsgsByProtocolMsgIds(s)]));D=n[0];s=n[1];var J=s.maybeOldestAdminMsg;s=s.maybeOldestMsg;n=n[2];var K=new Set(n.map(function(a){return a.externalId}));m=m.filter(function(a){return!K.has(a.externalId)});o=q||o;o={bumpMessageAuthorMap:F,existingMsgs:n,hasMoreBefore:(n=o)!=null?n:!0,instanceKey:p,isDyiInProgress:v,isPointRestore:q,maybeNewestMsg:D,maybeOldestAdminMsg:J,maybeOldestMsg:s,minMsgId:r,newMsgs:m,thread:x};y==null?void 0:y.addPoint("message_restore_start");n=(yield d("MAWRestoreMsgsTxns").restoreMsgsForThread(o));p=0;v=0;y==null?void 0:y.addPoint("message_restore_end");D=[];(n==null?void 0:n.existingMsgs)!=null&&(D=D.concat(n==null?void 0:n.existingMsgs),p=n==null?void 0:n.existingMsgs.length);(n==null?void 0:n.newlyAddedMsgs)!=null&&(D=D.concat(n==null?void 0:n.newlyAddedMsgs),v=n==null?void 0:n.newlyAddedMsgs.length);f!=null&&!q&&d("MAWRestoreValidationUtils").compareRestoredMsgstoDeanonData(D,f,g,void 0,y);var M=[];D.map(function(a){if(a!=null&&E.has(a.externalId)){var b=a.sortOrderMs,c=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(a.author),e=E.get(a.externalId);b==null?d("WALogger").ERROR(j()):e!=null&&a.mediaId==null&&e.map(function(e){e={author:c,echoMsg:void 0,externalId:a.externalId,isXMA:d("MAWDbMsg").isXMAMsg(a),mediaData:e.mediaMetadata,messageTimestamp:b,msgId:a.msgId,previewMediaData:void 0,threadJId:a.threadJid};M.push(e)})}});J=d("MAWHandleEchoMediaMsgsRestoreV2").downloadMediaAndWriteToMediaStore(M,z,q);s=i.all(D.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=B.get(a.externalId);a!=null&&(yield ba(a,z,y,e),yield ca(a,z,e,y))});return function(b){return a.apply(this,arguments)}}()));y==null?void 0:y.addPoint("media_restore_start");yield i.all([J,s]);y==null?void 0:y.addPoint("media_restore_end",{"int":{media:M.length}});yield aa(D,B,y);yield W(D,w,x.chatId,q,z,y);y.endSuccess({"int":{existingMsgs:p,messages_lost:g.length-p-v,newlyAddedMsgs:v,restoredMsgs:p+v,totalMsgsToRestore:g.length},string:{threadJidPrimaryId:a}});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess({taskSource:u,traceId:t,type:"protobuf"});d("MAWTraceUtils").recordCheckpointForTrace(t,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_RESTORE_MESSAGES_SUCCESS),[],!1);d("MAWTraceUtils").recordCheckpointForTrace(t,h.ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),[],!0)}});return X.apply(this,arguments)}function ba(a,b,c,d){return Y.apply(this,arguments)}function Y(){Y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){c.addPoint("msg_history_start");if(a.editMsgData.length>0){var f,g,h,i,j=[];f=(f=a.metadata)==null?void 0:f.timestampMs;g=(g=a.metadata)==null?void 0:g.messageId;h=(h=a.metadata)==null?void 0:h.senderId;i=(i=a.decodedPayload)==null?void 0:i.text;if(f!=null&&typeof f==="number"&&g!=null&&h!=null){f=d("WATimeUtils").castMilliSecondsToUnixTime(f);h=d("MAWJids").toUserJid(h);g=d("WAStanzaUtils").toStanzaId(g);e=h===e?d("WAJids").AUTHOR_ME:h;h=Z(e,i,g,g,f,b);h!=null&&j.push(h);a.editMsgData.forEach(function(a){var c;c=Z(a.author,(c=a.editMsgContent.message)==null?void 0:c.text,a.externalId,a.originalMsgExternalId,a.ts,b);c!=null&&j.push(c)});yield da(j);c.addPoint("msg_history_end")}}});return Y.apply(this,arguments)}function Z(a,b,c,e,f,g){var h=a===d("WAJids").AUTHOR_ME?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.RECEIVED;if(b!=null)return{author:a,editExternalId:c,editTs:f,msgContent:{content:b},originalMsgExternalId:e,sendStatus:h,threadJid:g};d("WALogger").ERROR(m());return void 0}function ca(a,b,c,d){return $.apply(this,arguments)}function $(){$=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){f=I(a,e,f);a=a.metadata;if(f!=null&&a!=null){g.addPoint("reactions_restore_start");var h=a.messageId,j=[];f.forEach(function(a,b){return j.push({stanzaId:b,waReactionMsg:a})});if(c("gkx")("4219")){a=j.filter(function(a){a=a.waReactionMsg;return h!=null&&a.ts!=null}).map(function(a){var b=a.stanzaId;a=a.waReactionMsg;return{args:{groupingKey:a.reaction.groupingKey,reaction:a.reaction.text,reactToAuthor:d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(a.reactToMsgAuthor),reactToExternalId:a.reactToExternalId,senderTimestampMs:a.reaction.senderTimestampMs},author:d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(a.reactionAuthor),chatJid:e,externalId:b,ts:a.ts}});yield d("MAWWriteReactionMsgApi").bulkWriteReactionMsg(a)}else{f=(i||(i=b("Promise"))).all(j.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.waReactionMsg,c=b.ts;c!=null&&h!=null&&(yield d("MAWWriteReactionMsgApi").writeReactionMsg(a.stanzaId,e,{groupingKey:b.reaction.groupingKey,reaction:b.reaction.text,reactToAuthor:d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(b.reactToMsgAuthor),reactToExternalId:b.reactToExternalId,senderTimestampMs:b.reaction.senderTimestampMs},c,d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(b.reactionAuthor)))});return function(b){return a.apply(this,arguments)}}()));yield f}g.addPoint("reactions_restore_end")}});return $.apply(this,arguments)}var da=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:e.READWRITE,messages:e.READWRITE},"bulkAddEditMsgHistory",function(a){return function(b){return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,b).then(function(){})}});g.associateQuotedMessagesForRestoredDbMsgsTransactor=G;g.createUnstoredDbContentFromProtobufObject=L;g.decodeProtobufArray=U;g.decodeDecryptedMessageProtobuf=V;g.handleProtobufsRestore=a}),98);
__d("MAWParseBumpExistingMessageMsg",["WAMessageKey","WAParseConsumerMessageProtocol","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chat,e=a.content;a=a.meta;e=e.bumpExistingMessage;if(e==null)throw c("err")("bumpExistingMessage has no content");e=e.key;if(e==null)throw c("err")("bumpExistingMessage has no message key");var f=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(a.id.author);f=d("WAMessageKey").extractProtocolMessageId(b,f,e);e=f.author;f=f.externalId;e={ack:a.ack,id:{author:a.id.author,chat:a.id.chat,externalId:a.id.externalId},quote:{content:{author:e,externalId:f,ts:null,type:"Unavailable"},remoteJid:b},reportingMeta:a.reportingMeta,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.serverTs,type:"BumpExistingMessage"};return{contentTypeForLogging:"bumpExistingMessage",unstoredMedia:null,unstoredMsg:e,unstoredQuotedMedia:null,unstoredXMA:null}}g["default"]=a}),98);
__d("MAWUploadMessageTxns",["EchoCommonUtils","EchoEncodingUtils","EchoMessage","EchoMessageQuoteFieldUtils","LSEBPayloadSerializerError","LSMEBTaskCreationSource","MAWBridgeEventTransmitter","MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType","MAWConvertExtendedContentTargetTypeToXMATargetType","MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbMsgUtil","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWEBUploadMessageUtils","MAWEncryptedBackupCacheManager","MAWGetAttachmentTypeForServerMediaType","MAWGetMediaAttachmentTypeForServerMediaType","MAWGetPreviewContentTypeForMediaType","MAWJidUtils","MAWJids","MAWMsgType","MAWUploadMessagesBackup","MAWVault","MAWXMAUtils","WAArmadilloXMA.pb","WABase64","WAGlobals","WAJids","WALogger","WAMediaUtils","WATimeUtils","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] edit history has length ",", but edit count on message is ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No XMA object found for msg with external id ",". Cannot upload XMA"]);k=function(){return a};return a}var l="You unsent a message";function m(a){switch(a.specialTextSize){case 1:return d("EchoMessage").MessageTextSize.SMALL;case 2:return d("EchoMessage").MessageTextSize.MEDIUM;case 3:return d("EchoMessage").MessageTextSize.LARGE;default:return d("EchoMessage").MessageTextSize.NONE}}function n(a,b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId)).then(function(e){if(e!=null)return e.previewMediaIds!=null?d("MAWDexieTable").dexieAll(e.previewMediaIds.map(function(b){return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b)})).then(function(a){for(var a=a,b=Array.isArray(a),f=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(b){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;if(g==null)return d("MAWDexieTable").dexieResolve({maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"constructEchoMessage: DbMedia is null for the XMA message",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN},xmaData:void 0})}return u(e)}):u(e);else{d("WALogger").ERROR(k(),b.externalId);return d("MAWDexieTable").dexieResolve({maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").UNKNOWN_ERROR,errorMsg:"constructEchoMessage: no xma object found for msg with external id "+b.externalId,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN},xmaData:void 0})}})}function o(a,b){try{return d("MAWDbMsg").isMediaMsg(a)||a.type===d("MAWMsgType").MSG_TYPE.XMA}catch(e){a="[labyrinth_web] Invalid msg type for isMediaMsg check: "+e;d("WALogger").ERROR(j(),a);b.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:a,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return!1}}function p(a,b){return{echoMessage:null,externalId:a,maybeErrorDetail:{errorCode:c("LSEBPayloadSerializerError").NOT_IMPLEMENTED,errorMsg:b,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}}}function q(a,b,c){var e=d("MAWDexieTable").dexieResolve(c.threadJid),f={mediaMetadata:null},g=o(c,f);g=g?s(a,c):d("MAWDexieTable").dexieResolve(f);f=t(a,c);b=c.quote!=null?z(a,c.quote,e,b):d("MAWDexieTable").dexieResolve();var h=d("MAWDbMsg").isXMAMsg(c)?n(a,c):d("MAWDexieTable").dexieResolve(null);a=d("MAWDbEditMsgHistoryTxns").getEditHistoryAsEchoWithJidPromise(a,c.externalId,c.author,e);return{editHistoryPromise:a,mediaMetadataUploadPromise:g,quotedMsgPromise:b,reactionsPromise:f,threadJidPromise:e,xmaDataUploadRequestPromise:h}}function r(a,b,e,f,g,h,j,k){var n,o=d("WAJids").threadIdForChatJid(a),p=j.serverTs;n=(n=j.editCount)!=null?n:0;h.length>0&&h.length-1!==j.editCount&&(d("WALogger").WARN(i(),h.length,j.editCount),n=h.length-1);p={authoritativeTimestampMs:p!=null?p*1e3:void 0,contentSubtype:d("EchoMessage").EchoMessageContentSubtype.NONE,contentType:d("EchoMessage").EchoMessageContentType.TEXT,displayTimestampMs:j.ts*1e3,editCount:n,editHistory:h,from:d("EchoCommonUtils").craftEchoAddress(null,k,"AdvancedCrypto"),groupId:j.groupId,groupIndex:j.groupIndex,groupSize:j.groupSize,isForwarded:j.isForwarded,messageId:j.externalId,serializationOrigin:d("EchoMessage").EchoSerializationOriginType.WEB,sortOrderMs:d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(j),textSize:m(j),threadId:o,version:d("EchoMessage").ECHO_MESSAGE_MIGRATION_DOCUMENT_VERSION,xContentType:d("EchoEncodingUtils").convertDbMsgTypeToXMessageContentType(j.type),xMessagePlaceholderType:d("EchoMessage").EchoMessagePlaceholderType.NO_PLACEHOLDER,xOfflineThreadingId:j.externalId,xThreadId:o};((n=j.msgContent)==null?void 0:n.content)!=null&&(p=babelHelpers["extends"]({},p,{text:d("MAWVault").unvault(j.msgContent.content)}));j.type===d("MAWMsgType").MSG_TYPE.REVOKED&&(p.contentType=d("EchoMessage").EchoMessageContentType.PLACEHOLDER,p.contentSubtype=d("EchoMessage").EchoMessageContentSubtype.UNSEND,p.revokeSentTimestampMs=j.originalTs,p.revokeUnsentTimestampMS=j.unsendMsgContentDeleteTs,p.text=l);if(f!=null){h=y(f);k=d("MAWXMAUtils").isXMAStoryReply(f.xmaMessageType)?A(h.senderId,a):h.senderId;o=d("EchoCommonUtils").craftEchoAddress(null,k,"AdvancedCrypto");f.sortOrderMs!=null&&(p.quoteData={quoteMessageId:f.externalId,quoteMessageSender:o,quoteSortOrderInMs:f.sortOrderMs,replyType:j.type===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE?d("EchoMessageQuoteFieldUtils").EchoMessageQuoteReplyType.BUMP:void 0,status:d("EchoMessageQuoteFieldUtils").EchoMessageQuoteStatus.VALID},f.type===d("MAWMsgType").MSG_TYPE.XMA&&c("gkx")("458")&&(p.xContentType=d("EchoEncodingUtils").convertDbMsgTypeToXMessageContentType(f.type)))}if(d("MAWMsgType").isMAWSupportedMediaType(j.type)){n=b.mediaMetadata;if(n!=null)p=babelHelpers["extends"]({},p,{contentType:d("EchoMessage").EchoMessageContentType.MEDIA,mediaData:n});else if(j.type!==d("MAWMsgType").MSG_TYPE.XMA)return{echoMessage:p,externalId:j.externalId,maybeErrorDetail:b.maybeErrorDetail}}if(g!=null&&g.xmaData!=null&&j.type===d("MAWMsgType").MSG_TYPE.XMA){p.xmaData=g.xmaData;p.contentType=d("EchoMessage").EchoMessageContentType.XMA;if(p.mediaData==null&&((a=g.xmaData)==null?void 0:a.xmaDefaultCTA)!=null&&p.text==null){p.text=(h=g.xmaData)==null?void 0:h.xmaDefaultCTA}}else if(g!=null&&g.xmaData==null&&j.type===d("MAWMsgType").MSG_TYPE.XMA)return{echoMessage:p,externalId:j.externalId,maybeErrorDetail:g.maybeErrorDetail};return{echoMessage:babelHelpers["extends"]({},p,e),externalId:j.externalId}}function a(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.dbMsg;b=b.quotedMsg;if(!d("MAWMsgType").isEBSupportedMsgType(c.type))return d("MAWDexieTable").dexieResolve(p(c.externalId,'constructEchoMessage: "'+String(c.type)+'" NYI'));if(c.serverTs==null)return d("MAWDexieTable").dexieResolve(p(c.externalId,'constructEchoMessage: "'+String(c.type)+'" Not authoritative msg. '));var e=d("WATimeUtils").castToUnixTime(0);if(c.serverTs===e||c.serverTs===null&&c.ts===e){e="constructEchoMessage: Invalid timestamp - timestamp for message corresponds to 1/1/1970";d("WALogger").ERROR(h(),e);return d("MAWDexieTable").dexieResolve(p(c.externalId,e))}e=y(c);var f=e.senderId;e=q(a,b,c);b=e.editHistoryPromise;var g=e.mediaMetadataUploadPromise,i=e.quotedMsgPromise,j=e.reactionsPromise,k=e.threadJidPromise;e=e.xmaDataUploadRequestPromise;return d("MAWDexieTable").dexieAll([k,g,j,i,e,b]).then(function(a){var b=a[0],d=a[1],e=a[2],g=a[3],h=a[4];a=a[5];return r(b,d,e,g,h,a,c,f)})}))}function s(a,b){var e={mediaMetadata:null};if(b.type===d("MAWMsgType").MSG_TYPE.XMA)return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId)).then(function(b){if(b!=null)return v(a,b);else{e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] Media meta data couldn't be created for XMA because DbXMA is not in IndexedDB. This probably means the XMA message was not sent properly by ChatX.",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}});if(!d("MAWMsgType").isMAWSupportedMediaType(b.type)){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").NOT_SUPPORTED_ON_WEB,errorMsg:"[labyrinth_web] Media type is not supported for msg, type: "+b.type,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(e)}if(b.mediaId==null){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No media id found in a media msg",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}var f=d("WATimeUtils").DAY_SECONDS*28,g=b.serverTs;if(g!=null&&d("WATimeUtils").unixTime()-g>f){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] Media is older than 28 days and is not being uploaded.",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(e)}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.mediaId).then(function(f){if(!f){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No media db entry for media id",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}var g=d("MAWDbMediaTxns").maybeGetMediaBackupRowFromMsgId(a,b.msgId);return g.then(function(a){return d("MAWDexieTable").dexieResolve(w(b.msgId,f,!1,a))})})}function t(a,b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbReactionsTxns").getReactionForEcho(a,b).then(function(a){if(a!=null&&a.length>0){var b=d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()),c=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress(a.reaction,c,"AdvancedCrypto")}),e=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress((a.ts*1e3).toString(),c,"AdvancedCrypto")});a=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress(a.externalId.toString(),c,"AdvancedCrypto")});return{reactionAuthoritativeTimestampMs:e,reactions:c,reactionXOfflineThreadingIds:a}}})}function u(a){var b={xmaData:null};if(a.isTombstoned==null){b.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no isTombstoned to construct XMAData",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return b}var e={xmaContentRef:a.contentRef,xmaHeaderSubtitle:a.overlayTitle,xmaHeaderTitle:a.headerTitle,xmaIsTombstoned:a.isTombstoned,xmaMaxSubtitleNumLines:a.maxSubtitleNumOfLines,xmaMaxTitleNumLines:a.maxTitleNumOfLines,xmaSubtitleText:a.subtitleText,xmaTargetExpiry:a.targetExpiringAtSec,xmaTargetId:a.targetId,xmaTargetUsername:a.targetUsername,xmaTitleText:a.titleText},f=a.xmaLayoutType||d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE;e=babelHelpers["extends"]({},e,{xmaLayoutType:d("MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType").convertExtendedContentXMLLayoutTypeToXMALayoutType(f)});a.targetType!=null&&(e=babelHelpers["extends"]({},e,{xmaTargetType:d("MAWConvertExtendedContentTargetTypeToXMATargetType").convertExtendedContentTargetTypeToXMATargetType(a.targetType)}));a.overlayIconGlyph!=null&&(e=babelHelpers["extends"]({},e,{xmaGatingType:d("MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType").convertExtendedContentOverlayIconGlyphToXMAGatingType(a.overlayIconGlyph)}));a.defaultCTA!=null&&a.defaultCTA.nativeUrl!=null&&(e=babelHelpers["extends"]({},e,{xmaDefaultCTA:a.defaultCTA.nativeUrl}));b.xmaData=e;return b}function v(a,b){var e={mediaMetadata:null};if(b.previewMediaIds!=null){var f=b.previewMediaIds[0];return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,f).then(function(f){if(!f){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No media db entry for media id to be used for xma",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(e)}var g=b.msgId;if(g==null){e.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] No message id found in a xma msg",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(e)}var h=d("MAWDbMediaTxns").maybeGetMediaBackupRowFromMsgId(a,g);return h.then(function(a){return d("MAWDexieTable").dexieResolve(w(g,f,!0,a))})})}else return d("MAWDexieTable").dexieResolve(e)}function w(a,b,e,f){var g={mediaMetadata:null},h=null;f!=null&&f.length>0&&(h=f.find(function(a){return a.mediaId===b.mediaId}));f=h!=null?h.fbid:b.fbid;a=b.mediaEntries.get(a);if(a==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no media entry to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}a=d("WAMediaUtils").decodeMediaEntryData(a);h=h!=null?h.objectId:b.objectId;if(h==null)return g;var i=d("MAWGetAttachmentTypeForServerMediaType").getAttachmentTypeForServerMediaType(a.serverMediaType);if(i==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no attachment type to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var j=a.mediaKey;if(j==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no mediaKey to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var k=a.mediaKeyTimestamp;if(k==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no mediaKeyTimestamp to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var l=a.directPath;if(l==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no directPath to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no mediaContentType to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}e=e?"image/jpeg":d("WAMediaUtils").getMimeTypeFromServerMediaType(a.serverMediaType);var m=d("MAWGetMediaAttachmentTypeForServerMediaType").getMediaAttachmentTypeForServerMediaType(a.serverMediaType);if(m==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no xAttachmentType to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType!=null&&a.serverMediaType in{gif:1,image:1,sticker:1}&&b.validatedImageInfo==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no imageinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType==="video"&&b.validatedVideoInfo==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no videoinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.serverMediaType==="ptt"&&b.validatedAudioInfo==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no audioinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}if(a.fileSha256==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no WA fileSha256 found",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}var n=d("WABase64").encodeB64UrlSafe(a.fileSha256);if(a.fileEncSha256==null){g.maybeErrorDetail={errorCode:c("LSEBPayloadSerializerError").MEDIA_INFO_INVALID,errorMsg:"[labyrinth_web] no WA fileEncSha256 found",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return g}g=d("WABase64").encodeB64UrlSafe(a.fileEncSha256);var o=null,p=null,q=null,r=null,s=null,t=void 0;a=d("MAWGetPreviewContentTypeForMediaType").getPreviewContentTypeForMediaType(a.serverMediaType);if(b.validatedImageInfo!=null){var u;o=(u=b.validatedImageInfo.width)!=null?u:0;p=(u=b.validatedImageInfo.height)!=null?u:0;r=(u=b.validatedImageInfo.jpegThumbnailWidth)!=null?u:0;s=(u=b.validatedImageInfo.jpegThumbnailHeight)!=null?u:0}if(b.validatedVideoInfo!=null){o=(u=b.validatedVideoInfo.width)!=null?u:0;p=(u=b.validatedVideoInfo.height)!=null?u:0;r=(u=b.validatedVideoInfo.jpegThumbnailWidth)!=null?u:0;s=(u=b.validatedVideoInfo.jpegThumbnailHeight)!=null?u:0;q=(u=b.validatedVideoInfo.duration)!=null?u:0}if(b.validatedAudioInfo!=null){q=(u=b.validatedAudioInfo.duration)!=null?u:0}b.validatedDocumentFileInfo!=null&&(t=b.validatedDocumentFileInfo.filename);u={attachmentObjectId:h,attachmentType:i,directPath:l,encryptedHash:g,mediaBackupStatus:"success",mediaContentType:e,mediaKey:d("EchoEncodingUtils").convertMediaKeyToString(j),mediaKeyTimestamp:k,plaintextHash:n,size:b.size,xAttachmentType:m,xContentType:"full"};u=x(u,f,a,o,p,q,r,s,t);return{mediaMetadata:u}}function x(a,b,c,d,e,f,g,h,i){a=a;b!=null&&(a=babelHelpers["extends"]({},a,{backupEntFbid:b}));c!=null&&(a=babelHelpers["extends"]({},a,{previewContentType:c}));d!=null&&(a=babelHelpers["extends"]({},a,{width:d}));e!=null&&(a=babelHelpers["extends"]({},a,{height:e}));f!=null&&(a=babelHelpers["extends"]({},a,{mediaPlayableDuration:f*1e3}));g!=null&&(a=babelHelpers["extends"]({},a,{previewContentWidth:g}));h!=null&&(a=babelHelpers["extends"]({},a,{previewContentHeight:h}));i!=null&&(a=babelHelpers["extends"]({},a,{filename:i}));return a}function y(a){a=d("WAJids").authorToUserId(a.author,d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid()));var b=d("MAWJids").toUserJid(a);return{senderId:a,senderJid:b}}function z(a,b,e,f){var g=b.content.msgId,h=b.content.externalId;return f!=null?d("MAWDexieTable").dexieResolve(f):d("MAWDbMsgTxns").maybeGetMsg(a,g).then(function(a){if(a==null)return e.then(function(a){var b=d("WAJids").threadIdForChatJid(a);if(!d("MAWEncryptedBackupCacheManager").peekRestoreCache(h)){d("MAWEncryptedBackupCacheManager").addMsgEntryToReuploadCache(a,h);d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(h,b,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT,a);return null}else{a=(b=d("MAWEncryptedBackupCacheManager").getRestoredCache(h))==null?void 0:b.dbMsg;return d("MAWDexieTable").dexieResolve(a)}});else return d("MAWDexieTable").dexieResolve(a)})}function A(a,b){var e=d("WAJids").extractUserId(d("WAGlobals").getMyUserJid());b=d("WAJids").interpretAsUserJid(b);if(b==null)throw c("err")("this is a flow check, participant jid can not be null");return a===e?d("WAJids").extractUserId(b):e}g.constructEchoMessage=a;g.constructXMAData=u;g.constructMediaMetadata=w;g.setConditionalFields=x}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWAuthor","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAStanzaUtils","WATimeUtils","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}var j=function(a,b,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),a,{annotations:e,instanceKey:b})};b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,c,e,f,g){f.content!=null&&(f.content=d("MAWVault").vault(f.content));j("write_outgoing_msg_start",f.s2sInstanceKey);return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),a.messages.where("externalId").equals(b).toArray(),k(a,f.quote,c),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,f.ravenProtocolMsgId,g)]).then(function(c){var h=c[0],i=c[1],k=c[2];c=c[3];j("write_outgoing_msg_data_fetched",f.s2sInstanceKey,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(g)}});if(h==null)return{type:"missing_thread"};i=i.find(function(a){return a.threadJid===h.jid&&a.author===d("WAJids").AUTHOR_ME});if(i!=null)return i.ack>=d("MAWAckLevel").ACK.sent?{msgId:i.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:h.jid,externalId:i.externalId},type:"already_sent"}:{msgId:i.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:h.jid,externalId:i.externalId},type:"not_sent"};else{if(!d("MAWDbMsg").isUnrenderedMsgType(g)){i={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:f.ephemeralSetting,externalId:b,isForwarded:f.isForwarded,specialTextSize:f.specialTextSize,threadJid:h.jid,ts:e};var n=l(g,i,f,k),p=f.isFirstMsg,q=f.openMessageOtid,r=f.openMessageParticipantCount,s=f.optimisticMsg,t=f.participantCount;i=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,n).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,n,h,{isCurrentDeviceSendingMsg:!0,isFirstMsg:p,isOutgoing:!0,openMessageOtid:q,openMessageParticipantCount:r,optimisticMsg:s,participantCount:t,quotedReplyAttachmentMeta:b})})}else{k={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:h.jid,ts:e};k=m(g,k,f,c==null?void 0:c.externalId);i=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,k,h)}return i.then(function(c){j("write_outgoing_msg_promise_resolved",f.s2sInstanceKey);return o(a,g,h.jid,e).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:h.jid,externalId:b},type:"not_sent"}})})}})}});function k(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=n(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function l(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});i=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.IMAGE},i);case"Video":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");b=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},f,{msgContent:{content:b},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("err")("EditAction is not supported yet");case"BumpExistingMessage":throw c("err")("BumpExistingMessage is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("err")("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function m(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("err")("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("err")("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("err")("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("err")("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("err")("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("err")("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function n(a){var b={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});default:d("WALogger").ERROR(h(),a.type);throw c("err")("Trying to reply to a message type that does not support replies")}}function o(a,b,c,e){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:e};return a.ephemeralSettings.put(b)}).then(function(){})}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(function(){})})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b}),98);
__d("MediaDownloadMediator",["WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][labyrinth_dyi] MI download failure: ",""]);h=function(){return a};return a}var i=new Map();function a(a,b){i.set(a,b)}function c(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;yield (c=i.get(a))==null?void 0:c["continue"](b);i["delete"](a)});return j.apply(this,arguments)}function e(a,b){d("WALogger").ERROR(h(),b.message);void ((b=i.get(a))==null?void 0:b.handleError());i["delete"](a)}g.mapDeliveryObjectIdToMediaDownloader=a;g.handleNewCDNUrlFromMI=c;g.handleMIDownloadFailure=e}),98);
__d("WAAPIMetrics",["WAGlobals","WAJids","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){c===void 0&&(c={});return function(){var d=h(b,c);for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return a.apply(void 0,[d].concat(f)).then(function(a){d.endSuccess();return a})["catch"](function(a){d.endFail("error",{string:{error:""+a.toString()}});throw a})}}function h(a,b){b===void 0&&(b={});var c=null;try{c=d("WAGlobals").getDependencies().isEmployee()&&d("WAGlobals").getDependencies().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null}catch(a){}return d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOB_MANAGER,babelHelpers["extends"]({},b,{string:babelHelpers["extends"]({},(b=(b=b)==null?void 0:b.string)!=null?b:{},{name:a,userHash:c})}))}g.withMetrics=a}),98);
__d("WAParseMessageTransport",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{version:"v3",type:"error",error:a}}function i(a,b){return a!=null&&(b.dsm==null||b.dsm.destinationJid==null||b.dsm.destinationJid!==a)}function a(a,b){var c=a.payload;a=a.protocol;if(c==null&&a==null)return h("There is no payload and protocol in the message transport");else if(a==null)return h("There is no protocol part in the message transport");var e=a.integral;if(e==null)return h("There is no integral part in the message transport");else if(e.padding==null)return h("There is no padding in the message transport");else if(i(b,e))return h("The recipient does not match the device sent message recipient");else if(d("decodeProtobuf").getUnknownFields(e)!=null)return babelHelpers["extends"]({},h("There are unknown fields in the integral"),{futureProof:c==null?void 0:c.futureProof});if(c!=null){b=c.applicationPayload;return b==null?h("There is no applicationPayload payload in the message transport"):{type:"applicationPayload",applicationPayload:b,skdm:j(a.ancillary),icdc:k(a.ancillary)}}e=j(a.ancillary);return e!=null?{type:"skdm",skdm:e,icdc:k(a.ancillary)}:{type:"unknown"}}function j(a){return a==null?null:a.skdm}function k(a){return a==null?null:a.icdc}g.parseMessageTransport=a}),98);
__d("WADecodeIncomingMsg",["WALogger","WALongInt","WAMsgApplication.pb","WAMsgTransport.pb","WAParseMessageApplication","WAParseMessageTransport","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeIncomingMsg called with unexpected encoding version: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instamadillo decodeIncomingMsg called with null applicationPayload"]);i=function(){return a};return a}function j(a,b){return a.futureProof?{version:"v3",type:"futureProof",futureProof:a.futureProof,protobuf:b,subtype:null}:{version:"v3",type:"error",error:a.error}}function a(a,b,c,e){if(b==="v2")return{version:"v2",encoded:a};else if(b==="v3"){var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgTransport.pb").MessageTransportSpec,a);f=d("WAParseMessageTransport").parseMessageTransport(f,c);if(f.type==="error")return j(f,a);if(f.type==="skdm")return k(f.skdm,f.icdc);else if(f.type==="applicationPayload"){if(e===!0){if(f.applicationPayload.payload==null){d("WALogger").DEV(i());return{version:"v3",type:"error",error:"instamadillo unhandled proto"}}return{version:"v3",type:"instamadillo",applicationPayload:new Uint8Array(f.applicationPayload.payload)}}c=l(f.applicationPayload,a,f.icdc);if(f.skdm!=null){e=k(f.skdm,f.icdc);return{version:"v3",type:"msgWithSKDM",msg:c,skdm:e}}return c}else{f.type;return{version:"v3",type:"error",error:"unhandled proto"}}}else{d("WALogger").DEV(h(),b);return{type:"error",version:"v3",error:"decodeIncomingMsg called with unexpected encoding version: "+b}}}function k(a,b){var c=a.axolotlSenderKeyDistributionMessage;a=a.groupId;if(c==null)return{type:"error",version:"v3",error:"parseSKDM called with null axolotlSenderKeyDistributionMessage"};else if(a==null)return{type:"error",version:"v3",error:"parseSKDM called with null groupId"};return{version:"v3",type:"skdm",msg:{senderKey:c,groupId:a},icdc:b}}function l(a,b,c){var e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);if(e.payload==null)return m(e.metadata);var f=d("WAParseMessageApplication").parseMessageApplication(e);return f.type==="error"?j(f,b):{version:"v3",type:"subprotocol",metadata:(e=e.metadata)!=null?e:null,subprotocolType:f.subprotocolType,subprotocol:f.payload,protobuf:b,frankingContent:a.payload,icdc:c}}function m(a){a=a==null?void 0:a.chatEphemeralSetting;if(a!=null){var b=a.ephemeralExpiration,c=a.ephemeralSettingTimestamp;if(b==null)return{version:"v3",type:"error",error:"Ephemeral setting without expiration"};try{c=c!=null?d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(c)/1e3):d("WATimeUtils").DEFAULT_UNIXTIME;return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:c,isEphemeralSettingReset:(c=a.isEphemeralSettingReset)!=null?c:!1}}catch(e){return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").DEFAULT_UNIXTIME,isEphemeralSettingReset:(c=a.isEphemeralSettingReset)!=null?c:!1}}}else return{version:"v3",type:"error",error:"MessageApplication has no payload and is not ephemeral"}}g.decodeIncomingMsg=a}),98);
__d("WAParseV3Protocol",["WAAckLevel","WAAssertUnreachable","WAErr","WAGlobals","WAHex","WAMsgType","WAParseConsumerMessageProtocol"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,e,f,g,h){h={id:{chat:e,author:g,externalId:f},ts:h,serverTs:h,ack:d("WAAckLevel").ACK.RECEIVED,forwardingScore:b.type!=="futureProof"?(f=b==null?void 0:(g=b.metadata)==null?void 0:g.forwardingScore)!=null?f:0:0};g=b.type!=="futureProof"&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)!=null&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)>0;if(b.type==="futureProof"||g&&!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return{unstoredMsg:{type:d("WAMsgType").FUTUREPROOF,msgContent:{subtype:null,protobuf:d("WAHex").bytesToBuffer(b.protobuf)},id:h.id,ts:h.ts,sentTs:h.sentTs,serverTs:h.serverTs,ack:h.ack,reportingMeta:h.reportingMeta},unstoredMedia:null,unstoredQuotedMedia:null};else if(b.type==="subprotocol"){f=a==null?void 0:a.get(b.subprotocolType);if(f!=null)return f(e,b.subprotocol,h,b.protobuf,b.metadata);switch(b.subprotocolType){case"consumerMessage":return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(e,b.subprotocol,h,b.protobuf,b.metadata);case"businessMessage":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"paymentMessage":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"multiDevice":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"voip":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);default:throw c("WAErr")("Subprotocol parser for: "+b.subprotocolType+" was not found")}}else return c("WAAssertUnreachable")(b.type)}}g.createV3ProtocolParser=a}),98);/*FB_PKG_DELIM*/
__d("WAArrayUtils",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=b("regeneratorRuntime").mark(c);function a(a,b){var c=a.pop();b<a.length&&(a[b]=c)}function c(a,c){var d;return b("regeneratorRuntime").wrap(function(b){while(1)switch(b.prev=b.next){case 0:d=0;case 1:if(!(d<a.length)){b.next=7;break}b.next=4;return a.slice(d,d+c);case 4:d+=c;b.next=1;break;case 7:case"end":return b.stop()}},g,this)}f.removeIndexWithoutPreservingOrder=a;f.peekEvery=c}),66);
__d("WAErrors",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";b=(a=d("WACustomError")).customError("BufferTooLarge",!1);c=a.customError("Disconnected",!1);e=a.customError("Offline",!1,c);f=a.customError("MaxRetries",!1);g.BufferTooLargeError=b;g.Disconnected=c;g.Offline=e;g.MaxRetries=f}),98);
__d("WANotifyConnectionChangeFactory",[],(function(a,b,c,d,e,f){"use strict";var g=15e3;function a(a,b,c){c===void 0&&(c=g);var d={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},e=function(){var a=d.optimismLevel,e=d.connectionStatus;a==="optimist"?d.timeoutID=setTimeout(function(){d.optimismLevel="realist",b(e)},c):b(e)};return function(c){d.connectionStatus=c,c==="disconnected"?e():c==="in_handshake"?e():(c,d.timeoutID!=null&&(clearTimeout(d.timeoutID),d.timeoutID=null),b(c)),a(c)}}f.notifyConnectionChangeFactory=a}),66);
__d("WAPromiseRetryLoop",["Promise","WAErr","WALogger","WAPromiseBackoffs","WAPromiseDelays","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: retrying "," in ","ms"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop was called several times. You may have race conditions"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: starting ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""]);m=function(){return a};return a}a=function(){function a(a){var b=this;this.$2=new(d("WAResolvable").Resolvable)();this.$3=null;this.$4=null;this.$5=0;this.endWithValue=function(a){b.$5++,b.$2.resolve(a)};this.$1=a}var e=a.prototype;e.resetTimeoutAfter=function(a){this.$4=Date.now()+a};e.cancelReset=function(){this.$4=null};e.reset=function(){if(this.$2.resolveWasCalled())return;d("WALogger").LOG(m(),this.$1.name);this.$5++;this.$6()};e.start=function(){if(this.$2.resolveWasCalled())return;d("WALogger").LOG(l(),this.$1.name);this.$5!==0&&d("WALogger").ERROR(k());this.$5++;this.$6()};e.$6=function(){var a=this,c=this.$1,e=this.$5,f=d("WAPromiseBackoffs").createTimer(this.$1.timer);f();var g=function b(){if(a.$2.resolveWasCalled())return;if(e!==a.$5)return;var g=Date.now();a.$3=c.code(a.endWithValue).then(function(){if(a.$2.resolveWasCalled())return;var e=c.resetDelay;(e!==void 0&&Date.now()>=g+e||a.$4!=null&&a.$4<=Date.now())&&(d("WALogger").LOG(j(),c.name),f=d("WAPromiseBackoffs").createTimer(a.$1.timer));a.$4=null;e=f();d("WALogger").LOG(i(),c.name,e);return d("WAPromiseDelays").delayMs(e).then(b)});return a.$3};this.$3=(h||(h=b("Promise"))).resolve().then(g)};e.promise=function(){var a=this;if(this.$2.resolveWasCalled())return this.$2.promise;return!this.$3?(h||(h=b("Promise"))).reject(c("WAErr")("PromiseRetryLoop "+this.$1.name+" had promise() called before start()")):(h||(h=b("Promise"))).race([this.$2.promise,this.$3.then(function(){return a.$2.promise})])};return a}();g.PromiseRetryLoop=a}),98);
__d("WASmaxInPingsEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={validators:[d("WAJids").validateDomainJid,d("WAJids").validateUserJid],typeName:"DomainJid|UserJid"};g.DOMAINJID_USERJID=a}),98);
__d("WACryptoPrimitives",["tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";b={scalarbase:(a=d("tweetnacl")).lowlevel.scalarbase,crypto_hash:a.lowlevel.crypto_hash,modL:a.lowlevel.modL,pack25519:a.lowlevel.pack25519,S:a.lowlevel.S,M:a.lowlevel.M,A:a.lowlevel.A,Z:a.lowlevel.Z,D:a.lowlevel.D,unpack25519:a.lowlevel.unpack25519,pow2523:a.lowlevel.pow2523,crypto_verify_32:a.lowlevel.crypto_verify_32,set25519:a.lowlevel.set25519,add:a.lowlevel.add,scalarmult:a.lowlevel.scalarmult};g.hash=a.hash;g.scalarMult=a.scalarMult;g.verify=a.verify;g.lowlevel=b;g.keypairFromSecretKey=a.box.keyPair.fromSecretKey;g.keyPair=a.box.keyPair;g.signDetachedVerify=a.sign.detached.verify}),98);
__d("WACryptoUtils",["WACryptoDependencies","WACryptoPrimitives","WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(new Uint8Array(a),new Uint8Array(b))}function h(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function b(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function e(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function f(a){if(a!==(a|0))throw c("WAErr")("bound must be int32");if(a<=0)throw c("WAErr")("bound must not be positive");var b=new Int32Array(1),e=-1>>>1;e=a*Math.floor(e/a);var f=-1;while(f===-1){d("WACryptoDependencies").getCrypto().getRandomValues(b);var g=b[0]>>>1;g<e&&(f=g%a)}return f}g.arrayBuffersEqual=a;g.uint8ArraysEqual=h;g.rawKeysEqual=b;g.serializedPubKeysEqual=e;g.randomNumberLessThan=f}),98);
__d("WADeepEquals",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){if(a===b)return!0;if(!a||!b||typeof a!=="object"&&typeof b!=="object")return!1;var c=Array.isArray(a),d=Array.isArray(b);if(c!==d)return!1;d=!0;if(c){c=a.length;if(c!==b.length)return!1;for(var e=0;d&&e<c;e++)d=g(a[e],b[e]);return d}c=Object.keys(a);for(e=0;d&&e<c.length;e++){var f=c[e];d=b.propertyIsEnumerable(f)&&g(a[f],b[f])}return d&&Object.keys(b).length===c.length}f.deepEqual=g}),66);
__d("WAWapJid",["$InternalEnum","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h={JID:0,JID_U:1,JID_AD:1,JID_FB:3,JID_INTEROP:4},i=b("$InternalEnum")({WHATSAPP:0,LID:1,HOSTED:128,HOSTED_LID:129});a=function(){function a(a){this.$1=a}a.createAD=function(b,c,d){return new a({type:h.JID_AD,user:b,device:d==null?0:d,agent:c==null?0:c,domainType:i.WHATSAPP})};a.createJidU=function(b,c,d){return new a({type:h.JID_U,user:b,device:d==null?0:d,domainType:c==null?i.WHATSAPP:c})};a.createFbJid=function(b,c){c=c==null?0:c;return new a({type:h.JID_FB,user:b,device:c})};a.createInteropJid=function(b,c,d){c=c==null?0:c;return new a({type:h.JID_INTEROP,user:b,device:c,integrator:d})};a.create=function(b,c){return new a({type:h.JID,user:b,server:c})};var b=a.prototype;b.toString=function(){if(this.$1.type===h.JID_AD||this.$1.type===h.JID_U){var a=this.$1,b=a.user,c=a.device;a=a.domainType;var e;a===i.WHATSAPP?e=d("WAJids").WA_USER_JID_SUFFIX:a===i.HOSTED?e=d("WAJids").HOSTED_SUFFIX:a===i.HOSTED_LID?e=d("WAJids").HOSTED_LID_SUFFIX:e=d("WAJids").LID_SUFFIX;return c===0?b+"@"+e:b+":"+c+"@"+e}else if(this.$1.type===h.JID_FB){a=this.$1;b=a.user;c=a.device;e=d("WAJids").MSGR_USER_JID_SUFFIX;return b+":"+c+"@"+e}else if(this.$1.type===h.JID_INTEROP){a=this.$1;b=a.user;c=a.device;e=a.integrator;a=d("WAJids").INTEROP_USER_JID_SUFFIX;return e+"-"+b+":"+c+"@"+a}else{this.$1.type;e=this.$1;b=e.user;c=e.server;return b!=null?b+"@"+c:c}};b.getInnerJid=function(){return this.$1};return a}();g.WAP_JID_SUBTYPE=h;g.DomainType=i;g.WapJid=a}),98);
__d("WASmaxParseUtils",["WABase64","WABinary","WACryptoUtils","WADeepEquals","WAHasProperty","WAResultOrError","WAStanzaUtils","WAWapJid"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAResultOrError").makeResult();function a(a,b){return a.tag!==b?H(a,"to be <"+b+">"):h}function i(a,b){return!I(a,b)?H(a,'to have attribute "'+b+'"'):J(a,a.attrs[b])}function j(a,b,c,e){var f=i(a,b);if(!f.success)return f;c=c(f.value);return c!=null?d("WAResultOrError").makeResult(c):H(a,'to have "'+b+'"={'+e+'}, but instead has "'+f.value+'"')}function k(a,b,c){var e=B(a);if(!e.success)return e;b=b(e.value);return b!=null?d("WAResultOrError").makeResult(b):H(a,"to have "+c+' content, but instead has "'+e.value+'"')}function b(a,b,c){var d=i(a,b);if(!d.success)return d;else if(d.value!==c)return H(a,'to have "'+b+'"="'+c+'", but instead has "'+d.value+'"');return h}function e(a,b){return j(a,b,d("WAStanzaUtils").toStanzaId,"stanzaID")}function l(a,b){return j(a,b,K,"integer")}function f(a,b,c,e){var f=l(a,b);if(!f.success)return f;f=f.value;if(c!==void 0&&f<c)return H(a,'to have "'+b+'"={at least '+c+"} but has value "+f);else if(e!==void 0&&f>e)return H(a,'to have "'+b+'"={at most '+e+"} but has value "+f);return d("WAResultOrError").makeResult(f)}function m(a){var b=a.content;return b instanceof Uint8Array?H(a,"to have children"):d("WAResultOrError").makeResult(b)}function n(a,b){var c=m(a);if(!c.success)return c;c=c.value;if(c==null)return h;var e=null;for(var f=0;f<c.length;f++){var g=c[f];if(g.tag===b){if(e!=null)return H(a,"to have 1 child <"+b+">, but found more than 1");e=g}}return d("WAResultOrError").makeResult(e)}function o(a,b,c){a=n(a,b);if(!a.success)return a;return a.value==null?h:c(a.value)}function p(a,b,c){c=o(a,b,c);if(!c.success)return c;c=c.value;return c==null?H(a,"to have 1 child <"+b+">, but found 0"):d("WAResultOrError").makeResult(c)}function q(a,b){var c=n(a,b);if(!c.success)return c;return c.value==null?H(a,"to have 1 child <"+b+">, but found 0"):d("WAResultOrError").makeResult(c.value)}function r(a,b,c,e,f){a=L(a,b,c,e);if(!a.success)return a;b=[];for(c=0;c<a.value.length;c++){e=f(a.value[c]);if(!e.success)return e;b.push(e.value)}return d("WAResultOrError").makeResult(b)}function s(a,b,c,e,f){a=L(a,b,c,e);if(!a.success)return a;b=a.value.length;for(c=0;c<b;c++){e=f(a.value[c]);if(!e.success)return e}return d("WAResultOrError").makeResult(b)}function t(a,b,c){b=r(a,b,0,Infinity,c);if(!b.success)return b;for(c=0;c<b.value.length;c++)if(!d("WADeepEquals").deepEqual(b.value[0],b.value[c]))return H(a,"to have homogeneous children, but found two children that are not equal");return b}function u(a,b,c){a=t(a,b,c);return!a.success?a:d("WAResultOrError").makeResult(a.value.length)}function v(a,b,c,d,e){return I(b,c)?a(b,c,d,e):h}function w(a,b,c,e){if(e==null)return h;a=v(a,b,c);if(!a.success)return a;if(a.value===e)return d("WAResultOrError").makeResult(e);return a.value==null?h:H(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function x(a,b,c,e){a=a(b,c);if(!a.success)return a;return a.value===e?d("WAResultOrError").makeResult(e):H(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function y(a,b,c){a=a(b);if(!a.success)return a;return a.value===c?d("WAResultOrError").makeResult(c):H(b,'to have content "'+c+'", but instead has "'+a.value+'"')}function z(a,b,c){var e=i(a,b);if(!e.success)return e;var f=c[e.value];if(f!=null)return d("WAResultOrError").makeResult(f);f=Object.values(c).join("|");return H(a,'to have "'+b+'"={'+f+'}, but instead has "'+e.value+'"')}function A(a,b){var c=B(a);if(!c.success)return c;var e=b[c.value];if(e!=null)return d("WAResultOrError").makeResult(e);e=Object.values(b).join("|");return H(a,'to have content "'+e+'", but instead has "'+c.value+'"')}function B(a){var b=C(a);if(!b.success)return b;else try{b=new(d("WABinary").Binary)(b.value);b=b.readString(b.size());return d("WAResultOrError").makeResult(b)}catch(b){return H(a,"to have string content, but run into decoding error: "+b.message)}}function C(a){var b=a.content;if(b==null)return H(a,"to have content");else if(Array.isArray(b))return H(a,"to have content, but has children instead");else return d("WAResultOrError").makeResult(b)}function D(a,b){var c=C(a);if(!c.success)return c;return d("WACryptoUtils").uint8ArraysEqual(c.value,b)?d("WAResultOrError").makeResult(b):H(a,'to have content ":binary:'+d("WABase64").encodeB64(b)+'", but instead has ":binary:'+d("WABase64").encodeB64(c.value)+'"')}function E(a,b,c){var e=a.content;if(e==null)if(b===void 0||b<1)return d("WAResultOrError").makeResult(new Uint8Array([]));else return H(a,"to have content");else if(Array.isArray(e))return H(a,"to have content, but has children instead");else{var f=e.length;if(b!==void 0&&f<b)return H(a,"to have binary content at least "+b+" bytes but has "+f+" bytes");else if(c!==void 0&&f>c)return H(a,"to have binary content at most "+c+" bytes but has "+f+" bytes");return d("WAResultOrError").makeResult(e)}}function F(a){return k(a,K,"integer")}function G(a){return a}function H(a,b){return d("WAResultOrError").makeError("expected <"+a.tag+">: "+b)}function I(a,b){return c("WAHasProperty")(a.attrs,b)}function J(a,b){if(b instanceof d("WAWapJid").WapJid)return d("WAResultOrError").makeResult(b.toString());return typeof b==="string"?d("WAResultOrError").makeResult(b):H(a,"decodeAsString: attribute is "+typeof b+" not a string: "+String(b))}function K(a){a=parseInt(a,10);return Number.isNaN(a)?null:a}function L(a,b,c,e){var f=m(a);if(!f.success)return f;f=f.value;if(f==null)if(c!==0)return H(a,"to have at least "+c+" <"+b+"> children, but found 0");else return d("WAResultOrError").makeResult([]);var g=[];for(var h=0;h<f.length;h++){var i=f[h];i.tag===b&&g.push(i)}i=g.length;if(i<c)return H(a,"to have at least "+c+" <"+b+"> children, but found "+i);else if(i>e)return H(a,"to have at most "+e+" <"+b+"> children, but found "+i);return d("WAResultOrError").makeResult(g)}var M={};function N(a,b,c){var d=b.map(function(a,b){return a+": "+c[b].error});return H(a,["to match any of following mixins: "+b.join(", ")+", but all mixins failed."].concat(d).join(" "))}g.voidSuccess=h;g.assertTag=a;g.attrString=i;g.attrValidate=j;g.contentValidate=k;g.assertAttr=b;g.attrStanzaId=e;g.attrInt=l;g.attrIntRange=f;g.maybeChildren=m;g.optionalChild=n;g.optionalChildWithTag=o;g.childWithTag=p;g.flattenedChildWithTag=q;g.mapChildrenWithTag=r;g.countChildrenWithTag=s;g.mapHomogeneousChildrenWithTag=t;g.countHomogeneousChildrenWithTag=u;g.optional=v;g.optionalLiteral=w;g.literal=x;g.literalContent=y;g.attrStringEnum=z;g.contentStringEnum=A;g.contentString=B;g.contentBytes=C;g.contentLiteralBytes=D;g.contentBytesRange=E;g.contentInt=F;g.identity=G;g.errorMessage=H;g.emptyObject=M;g.errorMixinDisjunction=N}),98);
__d("WASmaxParseJid",["WAJids","WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateUserJid,"UserJid")}function b(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateDeviceJid,"DeviceJid")}function c(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateGroupJid,"GroupJid")}function e(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateCallJid,"CallJid")}function f(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateDomainJid,"DomainJid")}function h(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateBroadcastJid,"BroadcastJid")}function i(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateStatusJid,"StatusJid")}function j(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateNewsletterJid,"NewsletterJid")}function k(a,b,c){var e=d("WASmaxParseUtils").attrString(a,b);if(!e.success)return e;var f=c.validators;c=c.typeName;for(var g=0;g<f.length;g++){var h=f[g](e.value);if(h!=null)return d("WAResultOrError").makeResult(h)}return d("WASmaxParseUtils").errorMessage(a,'to have "'+b+'"={'+c+'}, but instead has "'+e.value+'"')}function l(a,b,c,e){a=a(b,c);if(!a.success)return a;return a.value===e?a:d("WASmaxParseUtils").errorMessage(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function m(a,b,c,e){a=d("WASmaxParseUtils").optional(a,b,c);if(!a.success)return a;return a.value==null||a.value===e?a:d("WASmaxParseUtils").errorMessage(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}g.attrUserJid=a;g.attrDeviceJid=b;g.attrGroupJid=c;g.attrCallJid=e;g.attrDomainJid=f;g.attrBroadcastJid=h;g.attrStatusJid=i;g.attrNewsletterJid=j;g.attrJidEnum=k;g.literalJid=l;g.optionalLiteralJid=m}),98);
__d("WASmaxParseReference",["WAHasProperty","WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,d,e){b=j(b,c);if(!b.success)return l(b);a=a(b.value,c[c.length-1],d,e);return!a.success?l(a):a}function a(a,b,c,e,f){return k(b,c)?h(a,b,c,e,f):d("WASmaxParseUtils").voidSuccess}function i(a,b){return h(d("WASmaxParseUtils").attrString,a,b)}function b(a,b){return k(a,b)?i(a,b):d("WASmaxParseUtils").voidSuccess}function e(a,b){a=j(a,b);if(!a.success)return l(a);b=d("WASmaxParseUtils").contentString(a.value);return!b.success?l(b):b}function j(a,b){var c=b.length;a=a;for(var e=0;e<c-1;e++){var f=b[e];f=d("WASmaxParseUtils").flattenedChildWithTag(a,f);if(!f.success)return f;a=f.value}return d("WAResultOrError").makeResult(a)}function k(a,b){a=j(a,b);return a.success&&c("WAHasProperty")(a.value.attrs,b[b.length-1])}function l(a){return d("WAResultOrError").makeError("in the reference, "+a.error)}g.attrFromReference=h;g.optionalAttrFromReference=a;g.attrStringFromReference=i;g.optionalAttrStringFromReference=b;g.contentStringFromReference=e}),98);
__d("WASmaxInPingsClientResponseServerResponse",["WAResultOrError","WASmaxInPingsEnums","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseJid").attrJidEnum(a,"from",d("WASmaxInPingsEnums").DOMAINJID_USERJID);if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"t");return!b.success?b:d("WAResultOrError").makeResult({from:c.value,type:e.value,t:b.value})}g.parseClientResponseServerResponse=a}),98);
__d("WATextEncoding",[],(function(a,b,c,d,e,f){"use strict";e=TextEncoder;var g=TextDecoder,h=e,i=g;function a(){return new h()}function b(){return new i()}function c(a){h=a}function d(a){i=a}f.newTextEncoder=a;f.newTextDecoder=b;f.setTextEncoderClass=c;f.setTextDecoderClass=d}),66);
__d("WAWapDict",[],(function(a,b,c,d,e,f){a=3;b=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","notification","disappearing_mode","status","jid","broadcast","user","devices","device_hash","to","offline","message","result","class","xmlns","duration","notify","iq","t","ack","g.us","enc","urn:xmpp:whatsapp:push","presence","config_value","picture","verified_name","config_code","key-index-list","contact","mediatype","routing_info","edge_routing","get","read","urn:xmpp:ping","fallback_hostname","0","chatstate","business_hours_config","unavailable","download_buckets","skmsg","verified_level","composing","handshake","device-list","media","text","fallback_ip4","media_conn","device","creation","location","config","item","fallback_ip6","count","w:profile:picture","image","business","2","hostname","call-creator","display_name","relaylatency","platform","abprops","success","msg","offline_preview","prop","key-index","v","day_of_week","pkmsg","version","1","ping","w:p","download","video","set","specific_hours","props","primary","unknown","hash","commerce_experience","last","subscribe","max_buckets","call","profile","member_since_text","close_time","call-id","sticker","mode","participants","value","query","profile_options","open_time","code","list","host","ts","contacts","upload","lid","preview","update","usync","w:stats","delivery","auth_ttl","context","fail","cart_enabled","appdata","category","atn","direct_connection","decrypt-fail","relay_id","mmg-fallback.whatsapp.net","target","available","name","last_id","mmg.whatsapp.net","categories","401","is_new","index","tctoken","ip4","token_id","latency","recipient","edit","ip6","add","thumbnail-document","26","paused","true","identity","stream:error","key","sidelist","background","audio","3","thumbnail-image","biz-cover-photo","cat","gcm","thumbnail-video","error","auth","deny","serial","in","registration","thumbnail-link","remove","00","gif","thumbnail-gif","tag","capability","multicast","item-not-found","description","business_hours","config_expo_key","md-app-state","expiration","fallback","ttl","300","md-msg-hist","device_orientation","out","w:m","open_24h","side_list","token","inactive","01","document","te2","played","encrypt","msgr","hide","direct_path","12","state","not-authorized","url","terminate","signature","status-revoke-delay","02","te","linked_accounts","trusted_contact","timezone","ptt","kyc-id","privacy_token","readreceipts","appointment_only","address","expected_ts","privacy","7","android","interactive","device-identity","enabled","attribute_padding","1080","03","screen_height"];c=["read-self","active","fbns","protocol","reaction","screen_width","heartbeat","deviceid","2:47DEQpj8","uploadfieldstat","voip_settings","retry","priority","longitude","conflict","false","ig_professional","replaced","preaccept","cover_photo","uncompressed","encopt","ppic","04","passive","status-revoke-drop","keygen","540","offer","rate","opus","latitude","w:gp2","ver","4","business_profile","medium","sender","prev_v_id","email","website","invited","sign_credential","05","transport","skey","reason","peer_abtest_bucket","America/Sao_Paulo","appid","refresh","100","06","404","101","104","107","102","109","103","member_add_mode","105","transaction-id","110","106","outgoing","108","111","tokens","followers","ig_handle","self_pid","tue","dec","thu","joinable","peer_pid","mon","features","wed","peer_device_presence","pn","delete","07","fri","audio_duration","admin","connected","delta","rcat","disable","collection","08","480","sat","phash","all","invite","accept","critical_unblock_low","group_update","signed_credential","blinded_credential","eph_setting","net","09","background_location","refresh_id","Asia/Kolkata","privacy_mode_ts","account_sync","voip_payload_type","service_areas","acs_public_key","v_id","0a","fallback_class","relay","actual_actors","metadata","w:biz","5","connected-limit","notice","0b","host_storage","fb_page","subject","privatestats","invis","groupadd","010","note.m4r","uuid","0c","8000","sun","372","1020","stage","1200","720","canonical","fb","011","video_duration","0d","1140","superadmin","012","Opening.m4r","keystore_attestation","dleq_proof","013","timestamp","ab_key","w:sync:app:state","0e","vertical","600","p_v_id","6","likes","014","500","1260","creator","0f","rte","destination","group","group_info","syncd_anti_tampering_fatal_exception_enabled","015","dl_bw","Asia/Jakarta","vp8/h.264","online","1320","fb:multiway","10","timeout","016","nse_retry","urn:xmpp:whatsapp:dirty","017","a_v_id","web_shops_chat_header_button_enabled","nse_call","inactive-upgrade","none","web","groups","2250","mms_hot_content_timespan_in_seconds","contact_blacklist","nse_read","suspended_group_deletion_notification","binary_version","018","https://www.whatsapp.com/otp/copy/","reg_push","shops_hide_catalog_attachment_entrypoint","server_sync",".","ephemeral_messages_allowed_values","019","mms_vcache_aggregation_enabled","iphone","America/Argentina/Buenos_Aires","01a","mms_vcard_autodownload_size_kb","nse_ver","shops_header_dropdown_menu_item","dhash","catalog_status","communities_mvp_new_iqs_serverprop","blocklist","default","11","ephemeral_messages_enabled","01b","original_dimensions","8","mms4_media_retry_notification_encryption_enabled","mms4_server_error_receipt_encryption_enabled","original_image_url","sync","multiway","420","companion_enc_static","shops_profile_drawer_entrypoint","01c","vcard_as_document_size_kb","status_video_max_duration","request_image_url","01d","regular_high","s_t","abt","share_ext_min_preliminary_image_quality","01e","32","syncd_key_rotation_enabled","data_namespace","md_downgrade_read_receipts2","patch","polltype","ephemeral_messages_setting","userrate","15","partial_pjpeg_bw_threshold","played-self","catalog_exists","01f","mute_v2"];d=["reject","dirty","announcement","020","13","9","status_video_max_bitrate","fb:thrift_iq","offline_batch","022","full","ctwa_first_business_reply_logging","h.264","smax_id","group_description_length","https://www.whatsapp.com/otp/code","status_image_max_edge","smb_upsell_business_profile_enabled","021","web_upgrade_to_md_modal","14","023","s_o","smaller_video_thumbs_status_enabled","media_max_autodownload","960","blocking_status","peer_msg","joinable_group_call_client_version","group_call_video_maximization_enabled","return_snapshot","high","America/Mexico_City","entry_point_block_logging_enabled","pop","024","1050","16","1380","one_tap_calling_in_group_chat_size","regular_low","inline_joinable_education_enabled","hq_image_max_edge","locked","America/Bogota","smb_biztools_deeplink_enabled","status_image_quality","1088","025","payments_upi_intent_transaction_limit","voip","w:g2","027","md_pin_chat_enabled","026","multi_scan_pjpeg_download_enabled","shops_product_grid","transaction_id","ctwa_context_enabled","20","fna","hq_image_quality","alt_jpeg_doc_detection_quality","group_call_max_participants","pkey","America/Belem","image_max_kbytes","web_cart_v1_1_order_message_changes_enabled","ctwa_context_enterprise_enabled","urn:xmpp:whatsapp:account","840","Asia/Kuala_Lumpur","max_participants","video_remux_after_repair_enabled","stella_addressbook_restriction_type","660","900","780","context_menu_ios13_enabled","mute-state","ref","payments_request_messages","029","frskmsg","vcard_max_size_kb","sample_buffer_gif_player_enabled","match_last_seen","510","4983","video_max_bitrate","028","w:comms:chat","17","frequently_forwarded_max","groups_privacy_blacklist","Asia/Karachi","02a","web_download_document_thumb_mms_enabled","02b","hist_sync","biz_block_reasons_version","1024","18","web_is_direct_connection_for_plm_transparent","view_once_write","file_max_size","paid_convo_id","online_privacy_setting","video_max_edge","view_once_read","enhanced_storage_management","multi_scan_pjpeg_encoding_enabled","ctwa_context_forward_enabled","video_transcode_downgrade_enable","template_doc_mime_types","hq_image_bw_threshold","30","body","u_aud_limit_sil_restarts_ctrl","other","participating","w:biz:directory","1110","vp8","4018","meta","doc_detection_image_max_edge","image_quality","1170","02c","smb_upsell_chat_banner_enabled","key_expiry_time_second","pid","stella_interop_enabled","19","linked_device_max_count","md_device_sync_enabled","02d","02e","360","enhanced_block_enabled","ephemeral_icon_in_forwarding","paid_convo_status","gif_provider","project_name","server-error","canonical_url_validation_enabled","wallpapers_v2","syncd_clear_chat_delete_chat_enabled","medianotify","02f","shops_required_tos_version","vote","reset_skey_on_id_change","030","image_max_edge","multicast_limit_global","ul_bw","21","25","5000","poll","570","22","031","1280","WhatsApp","032","bloks_shops_enabled","50","upload_host_switching_enabled","web_ctwa_context_compose_enabled","ptt_forwarded_features_enabled","unblocked","partial_pjpeg_enabled","fbid:devices","height","ephemeral_group_query_ts","group_join_permissions","order","033","alt_jpeg_status_quality","migrate","popular-bank","win_uwp_deprecation_killswitch_enabled","web_download_status_thumb_mms_enabled","blocking","url_text","035","web_forwarding_limit_to_groups","1600","val","1000","syncd_msg_date_enabled","bank-ref-id","max_subject","payments_web_enabled","web_upload_document_thumb_mms_enabled","size","request","ephemeral","24","receipt_agg","ptt_remember_play_position","sampling_weight","enc_rekey","mute_always","037","034","23","036","action","click_to_chat_qr_enabled","width","disabled","038","md_blocklist_v2","played_self_enabled","web_buttons_message_enabled","flow_id","clear","450","fbid:thread","bloks_session_state","America/Lima","attachment_picker_refresh","download_host_switching_enabled","1792","u_aud_limit_sil_restarts_test2","custom_urls","device_fanout","optimistic_upload","2000","key_cipher_suite","web_smb_upsell_in_biz_profile_enabled","e","039","siri_post_status_shortcut","pair-device","lg","lc","stream_attribution_url","model","mspjpeg_phash_gen","catalog_send_all","new_multi_vcards_ui","share_biz_vcard_enabled","-","clean","200","md_blocklist_v2_server","03b","03a","web_md_migration_experience","ptt_conversation_waveform","u_aud_limit_sil_restarts_test1"];e=["64","ptt_playback_speed_enabled","web_product_list_message_enabled","paid_convo_ts","27","manufacturer","psp-routing","grp_uii_cleanup","ptt_draft_enabled","03c","business_initiated","web_catalog_products_onoff","web_upload_link_thumb_mms_enabled","03e","mediaretry","35","hfm_string_changes","28","America/Fortaleza","max_keys","md_mhfs_days","streaming_upload_chunk_size","5541","040","03d","2675","03f","...","512","mute","48","041","alt_jpeg_quality","60","042","md_smb_quick_reply","5183","c","1343","40","1230","043","044","mms_cat_v1_forward_hot_override_enabled","user_notice","ptt_waveform_send","047","Asia/Calcutta","250","md_privacy_v2","31","29","128","md_messaging_enabled","046","crypto","690","045","enc_iv","75","failure","ptt_oot_playback","AIzaSyDR5yfaG7OG8sMTUj8kfQEb8T9pN8BM6Lk","w","048","2201","web_large_files_ui","Asia/Makassar","812","status_collapse_muted","1334","257","2HP4dm","049","patches","1290","43cY6T","America/Caracas","web_sticker_maker","campaign","ptt_pausable_enabled","33","42","attestation","biz","04b","query_linked","s","125","04a","810","availability","1411","responsiveness_v2_m1","catalog_not_created","34","America/Santiago","1465","enc_p","04d","status_info","04f","key_version","..","04c","04e","md_group_notification","1598","1215","web_cart_enabled","37","630","1920","2394","-1","vcard","38","elapsed","36","828","peer","pricing_category","1245","invalid","stella_ios_enabled","2687","45","1528","39","u_is_redial_audio_1104_ctrl","1025","1455","58","2524","2603","054","bsp_system_message_enabled","web_pip_redesign","051","verify_apps","1974","1272","1322","1755","052","70","050","1063","1135","1361","80","1096","1828","1851","1251","1921","key_config_id","1254","1566","1252","2525","critical_block","1669","max_available","w:auth:backup:token","product","2530","870","1022","participant_uuid","web_cart_on_off","1255","1432","1867","41","1415","1440","240","1204","1608","1690","1846","1483","1687","1749","69","url_number","053","1325","1040","365","59","Asia/Riyadh","1177","test_recommended","057","1612","43","1061","1518","1635","055","1034","1375","750","1430","event_code","1682","503","55","865","78","1309","1365","44","America/Guayaquil","535","LIMITED","1377","1613","1420","1599","1822","05a","1681","password","1111","1214","1376","1478","47","1082","4282","Europe/Istanbul","1307","46","058","1124","256","rate-overlimit","retail","u_a_socket_err_fix_succ_test","1292","1370","1388","520","861","psa","regular","1181","1766","05b","1183","1213","1304","1537"];var g=["1724","profile_picture","1071","1314","1605","407","990","1710","746","pricing_model","056","059","061","1119","6027","65","877","1607","05d","917","seen","1516","49","470","973","1037","1350","1394","1480","1796","keys","794","1536","1594","2378","1333","1524","1825","116","309","52","808","827","909","495","1660","361","957","google","1357","1565","1967","996","1775","586","736","1052","1670","bank","177","1416","2194","2222","1454","1839","1275","53","997","1629","6028","smba","1378","1410","05c","1849","727","create","1559","536","1106","1310","1944","670","1297","1316","1762","en","1148","1295","1551","1853","1890","1208","1784","7200","05f","178","1283","1332","381","643","1056","1238","2024","2387","179","981","1547","1705","05e","290","903","1069","1285","2436","062","251","560","582","719","56","1700","2321","325","448","613","777","791","51","488","902","Asia/Almaty","is_hidden","1398","1527","1893","1999","2367","2642","237","busy","065","067","233","590","993","1511","54","723","860","363","487","522","605","995","1321","1691","1865","2447","2462","NON_TRANSACTIONAL","433","871","432","1004","1207","2032","2050","2379","2446","279","636","703","904","248","370","691","700","1068","1655","2334","060","063","364","533","534","567","1191","1210","1473","1827","069","701","2531","514","prev_dhash","064","496","790","1046","1139","1505","1521","1108","207","544","637","final","1173","1293","1694","1939","1951","1993","2353","2515","504","601","857","modify","spam_request","p_121_aa_1101_test4","866","1427","1502","1638","1744","2153","068","382","725","1704","1864","1990","2003","Asia/Dubai","508","531","1387","1474","1632","2307","2386","819","2014","066","387","1468","1706","2186","2261","471","728","1147","1372","1961"],h=[c,d,e,g];f.DICT_VERSION=a;f.SINGLE_BYTE_TOKEN=b;f.DICTIONARY_0_TOKEN=c;f.DICTIONARY_1_TOKEN=d;f.DICTIONARY_2_TOKEN=e;f.DICTIONARY_3_TOKEN=g;f.DICTIONARIES=h}),66);
__d("WAXmlFormatter",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~");var b=a.length,c=!1,d=0,e="",f=0,h=["\n"];for(f=0;f<100;f++)h.push(h[f]+"    ");var i=function(b,a){var c=/^<[\w:\-.,]+/.exec(b[a-1]);b=/^<\/[\w:\-.,]+/.exec(b[a]);return c!=null&&b!=null&&c[0]===b[0]};for(f=0;f<b;f++)a[f].search(/<!/)>-1?(e+=h[d]+a[f],c=!0,(a[f].search(/-->/)>-1||a[f].search(/\]>/)>-1||a[f].search(/!DOCTYPE/)>-1)&&(c=!1)):a[f].search(/-->/)>-1||a[f].search(/\]>/)>-1?(e+=a[f],c=!1):i(a,f)?(e+=a[f],c||d--):a[f].search(/<\w/)>-1&&a[f].search(/<\//)===-1&&a[f].search(/\/>/)===-1?(a[f]=g(a[f]),e=c?e+=a[f]:e+=h[d++]+a[f]):a[f].search(/<\w/)>-1&&a[f].search(/<\//)>-1?e=c?e+=a[f]:e+=h[d]+a[f]:a[f].search(/<\//)>-1?e=c?e+=a[f]:e+=h[d===0?d:--d]+a[f]:a[f].search(/\/>/)>-1?e=c?e+=a[f]:e+=h[d]+a[f]:a[f].search(/<\?/)>-1?e+=h[d]+a[f]:a[f].search(/xmlns:/)>-1||a[f].search(/xmlns=/)>-1?e+=h[d]+a[f]:e+=a[f];return e[0]==="\n"?e.slice(1):e}function g(a){var b=a.match(/(<query.*>|<result>)(\{.*\})/);if(b===null)return a;try{var c=b[1];b=JSON.stringify(JSON.parse(b[2]),null,2);return c+"\n"+b}catch(b){return a+"[Error formatting JSON]"}}f["default"]=a}),66);
__d("WAXmlNode",["WAHex"],(function(a,b,c,d,e,f,g){"use strict";var h={};a=function(){function a(a,b,c){b===void 0&&(b=h),c===void 0&&(c=null),this.tag=a,this.attrs=b,this.content=c}var b=a.prototype;b.toString=function(){var a="<"+this.tag;a+=i(this.attrs);var b=this.content;Array.isArray(b)?a+=">"+b.map(String).join("")+"</"+this.tag+">":b instanceof Uint8Array?a+=">"+j(b)+"</"+this.tag+">":b!=null?a+=">"+String(b)+"</"+this.tag+">":a+=" />";return a};return a}();function i(a){var b=Object.keys(a),c="";for(var d=0;d<b.length;d++){var e=b[d];c+=" "+e+'="'+a[e].toString()+'"'}return c}function j(a){var b;a.length===0?b="<!-- empty binary -->":a.length<50?b=d("WAHex").bytesToDebugString(a):b="<!-- "+a.length+" bytes -->";return b}g.XmlNode=a;g.attrsToString=i;g.uint8ArrayToDebugString=j}),98);
__d("WAWap",["WAAssertUnreachable","WABinary","WACryptoDependencies","WAErr","WAJids","WALogger","WALongInt","WATextEncoding","WAWapDict","WAWapJid","WAXmlFormatter","WAXmlNode"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeNullableString got invalid value: ",", string expected"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeString got invalid value: ",", string expected"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decoding compressed stanza"]);k=function(){return a};return a}var l=(h=d("WAJids")).MSGR_USER_DOMAIN.replace("@",""),aa=h.WA_USER_DOMAIN.replace("@",""),m=h.LID_DOMAIN.replace("@",""),n=h.INTEROP_DOMAIN.replace("@",""),o=h.HOSTED_DOMAIN.replace("@",""),p=2,ba=128,q=0,r=236,s=237,t=238,u=239,ca=[r,s,t,u],v=245,w=246,x=247,y=248,z=249,A=250,B=251,C=252,D=253,E=254,F=255,da=["0","1","2","3","4","5","6","7","8","9","-",".","\ufffd","\ufffd","\ufffd","\ufffd"],ea=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],G="",fa=1,H={sentinel:"DROP_ATTR"},I=(s=d("WAWapJid")).WapJid.create(null,"g.us"),J=s.WapJid.create(null,h.WA_SERVER_JID_SUFFIX);t=s.WapJid.create("status","broadcast");var K=s.WapJid.create(null,"newsletter");h=s.WapJid.create(null,"hosted");var ga=s.WapJid.create(null,"hosted.lid"),L=s.WapJid.create(null,"call"),M={},N=!1;function a(){N=!0}var ha=d("WATextEncoding").newTextEncoder(),O=function(){function a(a,b,c){b===void 0&&(b=M),c===void 0&&(c=null),this.tag=a,this.attrs=b,this.content=c}var b=a.prototype;b.toString=function(){var a="<"+this.tag;a+=d("WAXmlNode").attrsToString(this.attrs);var b=this.content;Array.isArray(b)?a+=">"+b.map(String).join("")+"</"+this.tag+">":b?a+=">"+d("WAXmlNode").uint8ArrayToDebugString(b)+"</"+this.tag+">":a+=" />";N&&(a=c("WAXmlFormatter")(a));return a};return a}();function b(a,b,e){var f=null;if(b&&b.children!=null)throw c("WAErr")('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(e))f=e.filter(Boolean);else if(typeof e==="string")f=d("WABinary").Binary.build(e).readByteArray();else if(e instanceof ArrayBuffer)f=new Uint8Array(e);else if(e instanceof Uint8Array)f=e;else{var g=[];for(var h=2;h<arguments.length;h++){var i=arguments[h];i&&g.push(i)}f=g}Array.isArray(f)&&f.length===0&&(f=null);var j={};if(b){var k=b;Object.keys(k).forEach(function(b){if(["__self","__source"].includes(b))return;var d=k[b];if(d==null)throw c("WAErr")("Attr "+b+" in <"+a+"> is null");if(d===H)return;j[b]=d})}return new O(a,j,f)}s=b;function e(a){return a instanceof d("WAWapJid").WapJid?a.toString():a}function P(a){var b=a.content;Array.isArray(b)?b=b.map(P):typeof b==="string"&&(b=d("WABinary").Binary.build(b).readByteArray());return new O(a.tag,a.attrs||M,b)}function f(a){a=a instanceof O?a:P(a);var b=new(d("WABinary").Binary)();Q(a,b);a=0;b=b.readByteArray();var c=new Uint8Array(1+b.length);c[0]=a;c.set(b,1);return c}function Q(a,b){if(a==null)b.writeUint8(q);else if(a instanceof O)R(a,b);else if(a instanceof d("WAWapJid").WapJid)ia(a,b);else if(typeof a==="string")V(a,b);else if(a instanceof Uint8Array)ka(a,b);else{a;b=typeof a;throw c("WAErr")("Invalid payload type "+b)}}function ia(a,b){a=a.getInnerJid();if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_U){var c=a.user,e=a.device,f=a.domainType;b.writeUint8(x);b.writeUint8(f);b.writeUint8(e);Q(c,b)}else if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_FB){f=a.user;e=a.device;b.writeUint8(w);Q(f,b);b.writeUint16(e);Q(l,b)}else if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_INTEROP){c=a.user;f=a.device;e=a.integrator;b.writeUint8(v);Q(c,b);b.writeUint16(f);b.writeUint16(e)}else{c=a.user;f=a.server;b.writeUint8(A);c!=null?Q(c,b):b.writeUint8(q);Q(f,b)}}function R(a,b){if(a.tag===void 0){b.writeUint8(y);b.writeUint8(q);return}var c=1;a.attrs&&(c+=Object.keys(a.attrs).length*2);a.content&&c++;c<256?(b.writeUint8(y),b.writeUint8(c)):c<65536&&(b.writeUint8(z),b.writeUint16(c));Q(a.tag,b);a.attrs&&Object.keys(a.attrs).forEach(function(c){V(c,b),Q(a.attrs[c],b)});c=a.content;if(Array.isArray(c)){c.length<256?(b.writeUint8(y),b.writeUint8(c.length)):c.length<65536&&(b.writeUint8(z),b.writeUint16(c.length));for(var d=0;d<c.length;d++)R(c[d],b)}else c&&Q(c,b)}var S,T;function U(a){var b=new Map();for(var c=0;c<a.length;c++)b.set(a[c],c);return b}function V(a,b){if(a===""){b.writeUint8(C);b.writeUint8(0);return}S==null&&(S=U(d("WAWapDict").SINGLE_BYTE_TOKEN));var c=S.get(a);if(c!=null){b.writeUint8(c+1);return}if(T==null){T=[];for(c=0;c<d("WAWapDict").DICTIONARIES.length;++c)T.push(U(d("WAWapDict").DICTIONARIES[c]))}for(c=0;c<T.length;++c){var e=T[c].get(a);if(e!=null){b.writeUint8(ca[c]);b.writeUint8(e);return}}e=d("WABinary").numUtf8Bytes(a);if(e<128){c=/[^0-9.-]+?/;var f=/[^0-9A-F]+?/;if(!c.exec(a)){ja(a,F,b);return}else if(!f.exec(a)){ja(a,B,b);return}}la(e,b);b.writeString(a)}function ja(a,b,d){var e=a.length%2===1;d.writeUint8(b);var f=Math.ceil(a.length/2);e&&(f|=ba);d.writeUint8(f);e=0;for(f=0;f<a.length;f++){var g=a.charCodeAt(f),h=null;48<=g&&g<=57?h=g-48:b===F?g===45?h=10:g===46&&(h=11):b===B&&(65<=g&&g<=70&&(h=g-55));if(h==null)throw c("WAErr")("Cannot nibble encode "+g);else f%2===0?(e=h<<4,f===a.length-1&&(e|=15,d.writeUint8(e))):(e|=h,d.writeUint8(e))}}function ka(a,b){la(a.length,b),b.writeByteArray(a)}function la(a,b){if(a<256)b.writeUint8(C),b.writeUint8(a);else if(a<1048576)b.writeUint8(D),b.writeUint8(a>>>16&255),b.writeUint8(a>>>8&255),b.writeUint8(a&255);else if(a<4294967296)b.writeUint8(E),b.writeUint32(a);else throw c("WAErr")("Binary with length "+a+" is too big for WAP protocol")}function ma(a,b){a=new(d("WABinary").Binary)(a);var c=a.readUint8();c=c&p;if(c){d("WALogger").LOG(k());return b(a.readByteArray()).then(function(a){return X(new(d("WABinary").Binary)(a))})}return Promise.resolve(X(a))}function na(a){a=new(d("WABinary").Binary)(a);var b=a.readUint8();b=b&p;if(b)throw c("WAErr")("Cannot pass compressed stanza to decodeStanzaDebug");return X(a)}function W(a,b){var e=a.readUint8();if(e===q)return null;if(e===y)return oa(a,a.readUint8());if(e===z)return oa(a,a.readUint16());if(e===C){var f=a.readUint8();return Z(a,f,b)}if(e===D){f=a.readUint8();var g=a.readUint8(),h=a.readUint8();f=((f&15)<<16)+(g<<8)+h;return Z(a,f,b)}if(e===E){g=a.readUint32();return Z(a,g,b)}if(e===A)return qa(a);if(e===w)return ra(a);if(e===v)return sa(a);if(e===x)return ta(a);if(e===F){h=a.readUint8();f=h>>>7;g=h&127;return ua(a,da,f,g)}if(e===B){b=a.readUint8();h=b>>>7;f=b&127;return ua(a,ea,h,f)}if(e<=0||e>=240)throw c("WAErr")("Unable to decode WAP buffer");if(e>=r&&e<=u){g=e-r;b=d("WAWapDict").DICTIONARIES[g];if(b===void 0)throw c("WAErr")("Missing WAP dictionary "+g);h=a.readUint8();f=b[h];if(f===void 0)throw c("WAErr")("Invalid value index "+h+" in dict "+g);return f}a=d("WAWapDict").SINGLE_BYTE_TOKEN[e-1];if(a===void 0)throw c("WAErr")("Undefined token with index "+e);return a}function oa(a,b){var c=[];for(var d=0;d<b;d++)c.push(X(a));return c}function X(a){var b=a.readUint8(),e;if(b===y)e=a.readUint8();else if(b===z)e=a.readUint16();else throw c("WAErr")("Failed to decode node since type byte "+String(b)+" is invalid");b=void 0;var f=null;if(e===0)throw c("WAErr")("Failed to decode node, list cannot be empty");var g=Y(a);e-=1;while(e>1){b||(b={});var h=Y(a),i=W(a,!0);b[h]=i;e-=2}e===1&&(f=W(a,!1),f instanceof d("WAWapJid").WapJid&&(f=String(f)),typeof f==="string"&&(f=ha.encode(f)));return new O(g,b,f)}function Y(a){a=W(a,!0);if(typeof a!=="string"){d("WALogger").DEV(j(),String(a));throw c("WAErr")("WAWap:decodeString got invalid value, string expected")}return a}function pa(a){a=W(a,!0);if(a!=null&&typeof a!=="string"){d("WALogger").DEV(i(),String(a));throw c("WAErr")("WAWap:decodeNullableString got invalid value, string expected")}return a}function qa(a){var b=pa(a);a=Y(a);return d("WAWapJid").WapJid.create(b,a)}function ra(a){var b=Y(a),c=a.readUint16();Y(a);return d("WAWapJid").WapJid.createFbJid(b,c)}function sa(a){var b=Y(a),c=a.readUint16(),e=a.readUint16();Y(a);return d("WAWapJid").WapJid.createInteropJid(b,c,e)}function ta(a){var b=null,e=a.readUint8();if(e===0)b=d("WAWapJid").DomainType.WHATSAPP;else if(e===1)b=d("WAWapJid").DomainType.LID;else if((1&e)===0&&(128&e)!==0)b=d("WAWapJid").DomainType.HOSTED;else if(e===129)b=d("WAWapJid").DomainType.HOSTED_LID;else throw c("WAErr")("decodeJidU - Invalid domain type encoding "+e);e=a.readUint8();a=Y(a);return d("WAWapJid").WapJid.createJidU(a,b,e)}function Z(a,b,c){c===void 0&&(c=!1);if(c)return a.readString(b);else return a.readByteArray(b)}function ua(a,b,c,d){d=new Array(d*2-c);for(var e=0;e<d.length-1;e+=2){var f=a.readUint8();d[e]=b[f>>>4];d[e+1]=b[f&15]}if(c){f=a.readUint8();d[d.length-1]=b[f>>>4]}return d.join("")}function va(){if(!G){var a=new Uint16Array(2);d("WACryptoDependencies").getCrypto().getRandomValues(a);G=String(a[0])+"."+String(a[1])+"-"}return""+G+fa++}function wa(a){switch(a.type){case"group":return a.groupJid;case"status":return d("WAJids").STATUS_JID;case"device":return a.deviceJid;case"newsletter":return a.newsletterJid;case"hosted":return a.hostedDeviceJid;case"hostedLid":return a.hostedLidDeviceJid;default:a.type;return a.broadcastJid}}function xa(a){switch(a.type){case"group":return a.author;case"status":return a.author;case"broadcast":return a.author;default:a.type;return null}}function ya(a){return a.type==="status"||a.type==="group"||a.type==="broadcast"?$(a.author):H}function za(a){return $(wa(a))}function $(a){var b=d("WAJids").validateDomainJid(a);if(b!=null)return Aa(b);b=a.split("@");a=b[0];b=b[1];var e=null;if((b===aa||b===l||b===n||b===m||b===o||b===d("WAJids").HOSTED_LID_SUFFIX)&&a.indexOf(":")!==-1){var f=a.split(":");a=f[0];f=f[1];e=parseInt(f,10)}if(b===n){f=a.split("-");var g=f[0];f=f[1];return d("WAWapJid").WapJid.createInteropJid(f,e,parseInt(g,10))}else if(b===l)return d("WAWapJid").WapJid.createFbJid(a,e);f=null;if(b===m)f=d("WAWapJid").DomainType.LID;else if(b===o){if(e!==99)throw c("WAErr")("wid unexpected deviceId");f=d("WAWapJid").DomainType.HOSTED}else if(b===d("WAJids").HOSTED_LID_SUFFIX){if(e!==99)throw c("WAErr")("lid invalid deviceId");f=d("WAWapJid").DomainType.HOSTED_LID}else f=d("WAWapJid").DomainType.WHATSAPP;return e!=null&&e!==0?d("WAWapJid").WapJid.createJidU(a,f,e):d("WAWapJid").WapJid.create(a,b)}function Aa(a){if(a==="s.whatsapp.net")return J;else if(a==="g.us")return I;else if(a==="newsletter")return K;else if(a==="call")return L;else return c("WAAssertUnreachable")(a)}function Ba(a){return $(a)}function Ca(a){return $(a)}function Da(a){return $(a)}function Ea(a){return $(a)}function Fa(a){return $(a)}function Ga(a){return $(a)}function Ha(a){if(a.jidType==="phoneDevice")return $(a.deviceJid);else if(a.jidType==="msgrDevice")return $(a.deviceJid);else if(a.jidType==="lidDevice")return $(a.deviceJid);else if(a.jidType==="phoneUser")return $(a.userJid);else if(a.jidType==="msgrUser")return $(a.userJid);else if(a.jidType==="lidUser")return $(a.userJid);else if(a.jidType==="group")return $(a.groupJid);else if(a.jidType==="status")return $(a.statusJid);else if(a.jidType==="call")return $(a.callJid);else if(a.jidType==="interopDevice")return $(a.deviceJid);else if(a.jidType==="interopUser")return $(a.userJid);else if(a.jidType==="newsletter")return $(a.newsletterJid);else if(a.jidType==="hosted")return $(a.hostedDeviceJid);else if(a.jidType==="hostedLid")return $(a.hostedLidDeviceJid);else{a.jidType;return $(a.broadcastJid)}}function Ia(a){return a}function Ja(a){return a.toString()}function Ka(a){return a}function La(a){return a==null?H:a}function Ma(a){return a.toString()}function Na(a){return d("WALongInt").longIntToDecimalString(a)}function Oa(a,b){b===void 0&&(b=4);a=a;var c=new Uint8Array(b);for(b=b-1;b>=0;b--)c[b]=a&255,a>>>=8;return c}g.DROP_ATTR=H;g.G_US=I;g.S_WHATSAPP_NET=J;g.STATUS_BROADCAST=t;g.NEWSLETTER=K;g.HOSTED=h;g.HOSTED_LID=ga;g.CALL=L;g.enableXMLFormat=a;g.WapNode=O;g.makeWapNode=b;g.wap=s;g.decodeAsString=e;g.makeStanza=P;g.encodeStanza=f;g.decodeStanza=ma;g.decodeStanzaDebug=na;g.generateId=va;g.extractToJid=wa;g.extractParticipantJid=xa;g.PARTICIPANT_JID=ya;g.TO_JID=za;g.JID=$;g.DOMAIN_JID=Aa;g.USER_JID=Ba;g.DEVICE_JID=Ca;g.GROUP_JID=Da;g.BROADCAST_JID=Ea;g.CALL_JID=Fa;g.NEWSLETTER_JID=Ga;g.TO_WAP_JID=Ha;g.STANZA_ID=Ia;g.SMAX_ID=Ja;g.CUSTOM_STRING=Ka;g.MAYBE_CUSTOM_STRING=La;g.INT=Ma;g.LONG_INT=Na;g.BIG_ENDIAN_CONTENT=Oa}),98);
__d("WASmaxJsx",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";g.smax=d("WAWap").wap}),98);
__d("WASmaxMixins",["WAArrayBufferUtils","WAWapJid"],(function(a,b,c,d,e,f,g){"use strict";var h="smax$any";function i(a,b){j(a,b);k(a,b);b.content instanceof Uint8Array?m(a,b.content):b.content!=null&&n(a,b.content);return a}function a(a,b,c,d){return c!=null?a(b,c,d):b}function j(a,b){a=a.tag;b=b.tag;if(b===h)return;if(a!==b)throw new Error("tag mismatch: "+a+" != "+b)}function k(a,b){var c=a.attrs,d=b.attrs;Object.keys(d).forEach(function(a){var b=d[a],e=c[a];if(b!=null&&e!=null){if(l(b,e))return;throw new Error("conflict for key: "+a)}c[a]=b})}function l(a,b){if(typeof a==="string"&&typeof b==="string")return a===b;return a instanceof d("WAWapJid").WapJid&&b instanceof d("WAWapJid").WapJid?a.toString()===b.toString():!1}function m(a,b){var c=a.content;if(c instanceof Uint8Array){if(!d("WAArrayBufferUtils").uint8ArraysEqualUNSAFE(c,b))throw new Error("elementValue mismatch: bytes dose not equal");return}if(c!=null)throw new Error("elementValue mismatch: destination has children");a.content=b}function n(a,b){var c=a.content;if(c instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(c==null||c.length===0){a.content=b;return}if(!o(c,b))throw new Error("children mismatch: child counts are not compatible");var d=[],e=Array.from(c);b.forEach(function(a){var b=e.findIndex(function(b){return b.tag===a.tag});if(b===-1)d.push(a);else{b=e.splice(b,1);b=i(b[0],a);d.push(b)}});e.forEach(function(a){return d.push(a)});a.content=d}function o(a,b){b=p(b);a=p(a);var c=Object.keys(b);for(var d=0;d<c.length;d++){var e=c[d],f=b[e];e=a[e];if(f!=null&&e!=null&&f!==e)return!1}return!0}function p(a){return a.reduce(function(a,b){b=b.tag;var c=a[b];a[b]=c==null?1:c+1;return a},{})}g.mergeStanzas=i;g.optionalMerge=a}),98);
__d("WASmaxOutPingsClientWellFormedToMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientWellFormedToMixin=a}),98);
__d("WASmaxOutPingsClientRequest",["WASmaxJsx","WASmaxOutPingsClientWellFormedToMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPingsClientWellFormedToMixin").mergeClientWellFormedToMixin(d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get",xmlns:"w:p"}));return a}g.makeClientRequest=a}),98);
__d("WAComms",["Promise","WAArrayUtils","WAErr","WAErrors","WALogger","WANotifyConnectionChangeFactory","WAPromiseRetryLoop","WAResolvable","WAResultOrError","WAShiftTimer","WASmaxInPingsClientResponseServerResponse","WASmaxOutPingsClientRequest","WASmaxParseUtils","WATimeUtils","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: closeSocket called"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," closed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration failed ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration socket closed while in noise handshake"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration socket disconnected while in noise handshake"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: socketLoopIteration socket closed while in noise handshake using treasureHunt strategy"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," closed"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," opened"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," opening"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: maybeResetSocketLoop"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: closeSocketAndPreventRetry called"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAck: unrecognized ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: job response is NO_ACK"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: job response is CLOSE_SOCKET"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Receiving ---\n",""],["--- Receiving ---\\n",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failure parsing stanza!"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.startHandlingRequests"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["castStanza error ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["castStanza async error ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Sending ---\n",""],["--- Sending ---\\n",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\n",""],["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\\n",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched. We return mock response directly."]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Receive (via SMAX+E2E) ---\n",""],["--- Receive (via SMAX+E2E) ---\\n",""]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched:\n",". We return mock response directly."],["Dropping stanza since onBeforeCastStanza matched:\\n",". We return mock response directly."]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will resend stanza when socket opens"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: No stanzaId in ping request stanza"]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: sendPing ping still pending"]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: sendPing when socket dead"]);K=function(){return a};return a}function L(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," expired"]);L=function(){return a};return a}function M(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: testing socket"]);M=function(){return a};return a}function N(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq"]);N=function(){return a};return a}function O(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq with id ",""]);O=function(){return a};return a}var P=null,Q=null,R=1,S=0,T=function(){function a(a,c,e){var f=this;this.nextSocketId=1;this.pendingIqs=new Map();this.ackHandlers=[];this.pendingSmaxStanzas=new Map();this.$2=new(d("WAResolvable").Resolvable)();this.socketAbortController=null;this.activePing=null;this.$3=new Set();this.socketId=S;this.socket=null;this.softCloseSocket=null;this.handleStanza=function(a,b,c){var e=d("WASmaxParseUtils").attrString(a,"id");if(e.success&&a.tag!=="receipt"){e=e.value;var g=f.pendingSmaxStanzas.get(e);if(g){f.pendingSmaxStanzas["delete"](e);g.resolve(a);f.maybeScheduleHealthCheck();return"NO_ACK"}}e=$(a);if(e!=null){g=f.pendingIqs.get(e);g?(f.pendingIqs["delete"](e),g.resolve(a),f.maybeScheduleHealthCheck()):(d("WALogger").WARN(O(),e),d("WALogger").ERROR(N()))}else if(a.tag==="ack")f.handleAck(a);else return a.tag==="failure"&&f.config.shouldBlockReceivingUntilSuccess?f.$1(a,b,c):f.$2.promise.then(function(){return f.$1(a,b,c)});return"NO_ACK"};this.healthCheckTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WALogger").DEV(M());if(!f.socketId)return;f.sendPing()});this.deadSocketTimer=new(d("WAShiftTimer").ShiftTimer)(function(a){if(a!==f.socketId)return;d("WALogger").LOG(L(),a);f.softCloseSocket&&f.softCloseSocket()});this.sendPing=function(){var a,c,e,f,g,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:a=Z("sendPing");if(a.socketId){l.next=4;break}d("WALogger").LOG(K());return l.abrupt("return",(h||(h=b("Promise"))).resolve());case 4:if(!(a.activePing&&a.activePing.socketId===a.socketId)){l.next=7;break}d("WALogger").LOG(J());return l.abrupt("return",(h||(h=b("Promise"))).resolve());case 7:a.activePing&&a.activePing.handler.resolve();c=d("WASmaxOutPingsClientRequest").makeClientRequest();e=c.attrs.id;if(!(typeof e!=="string")){l.next=13;break}d("WALogger").ERROR(I());return l.abrupt("return",(h||(h=b("Promise"))).resolve());case 13:f=new(d("WAResolvable").Resolvable)();a.activePing={socketId:a.socketId,stanzaId:e,handler:f};a.callStanza(c);l.next=18;return b("regeneratorRuntime").awrap(f.promise);case 18:g=l.sent,g&&(i=d("WASmaxInPingsClientResponseServerResponse").parseClientResponseServerResponse(g,c),i.success&&(j=d("WATimeUtils").castToUnixTime(i.value.t),k=Math.round(Date.now()/1e3-j),a.config.handlers.onClockSkewUpdate==null?void 0:a.config.handlers.onClockSkewUpdate(k)));case 20:case"end":return l.stop()}},null,this)};this.$1=a;this.onConnectionChange=d("WANotifyConnectionChangeFactory").notifyConnectionChangeFactory((a=c.handlers.onConnectionChange)!=null?a:function(){},(a=c.handlers.onOptimisticConnectionChange)!=null?a:function(){});this.gzipInflate=e;this.config=c;this.socketLoop=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"MainSocketLoop",code:W,timer:{jitter:.1,max:c.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}var e=a.prototype;e.filterPending=function(a){var b=[];function c(c){a(c)&&b.push(c)}this.pendingIqs.forEach(c);this.ackHandlers.forEach(c);this.pendingSmaxStanzas.forEach(c);return b};e.sendPendingStanza=function(a){a.cleanup==null?void 0:a.cleanup(),a.cleanup=void 0,this.callStanza(a.stanza)};e.maybeSendPendingStanza=function(a){if(a.attempt>=this.config.maxRetries)this.config.handlers.onDropStanza==null?void 0:this.config.handlers.onDropStanza(a),a.cleanup==null?void 0:a.cleanup(),a.cleanup=void 0,this.removeHandler(a,"max-retries");else if(this.socket){a.attempt+=1;this.sendPendingStanza(a);return}else d("WALogger").LOG(H())};e.callStanzaAsync=function(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(this.callStanza(a,c));case 2:d=e.sent;return e.abrupt("return",d);case 4:case"end":return e.stop()}},null,this)};e.callStanza=function(a,b){a=this.castStanza(a,b);this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId);this.healthCheckTimer.cancel();return a};e.castStanzaAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.castStanza(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};e.castStanza=function(a,c){var e=this;try{var f=this.config.handlers.onBeforeCastStanzaForE2E==null?void 0:this.config.handlers.onBeforeCastStanzaForE2E(a,c);if(f!=null){d("WALogger").DEV_XMPP(G(),a);d("WALogger").DEV_XMPP(F(),f);d("WALogger").ERROR(E());if(Array.isArray(f))return(h||(h=b("Promise"))).all(f.map(function(a){return(h||(h=b("Promise"))).resolve(e.handleStanza(a,e.socketId,S))}));else{this.handleStanza(f,this.socketId,S);return(h||(h=b("Promise"))).resolve()}}}catch(a){d("WALogger").DEV_XMPP(D(),a)}f=this.socketOrThrow("castStanza");try{d("WALogger").DEV_XMPP(C(),a);return f.sendFrame(d("WAWap").encodeStanza(a)).then(function(){e.config.handlers.onCastStanza==null?void 0:e.config.handlers.onCastStanza(a,c)})["catch"](function(a){d("WALogger").ERROR(B(),a).devConsole(a);if(a instanceof d("WAErrors").BufferTooLargeError)return(h||(h=b("Promise"))).reject(a)})}catch(a){d("WALogger").ERROR(A(),a).devConsole(a)}return(h||(h=b("Promise"))).resolve()};e.socketOrThrow=function(a){var b=this.socket;if(b)return b;throw c("WAErr")("Comms."+a+" called while no socket")};e.startHandlingRequests=function(){d("WALogger").LOG(z());this.$2.resolve();return this.$2.promise.then(function(){})};e.parseAndHandleStanza=function(a,b){var c=this;a===this.socketId&&(this.deadSocketTimer.cancel(),Q&&(Q.resolve(),Q=null));var e=d("WAWap").decodeStanza(b,this.gzipInflate)["catch"](function(a){d("WALogger").ERROR(y()).devConsole(b);throw a}).then(function(e){d("WALogger").DEV_XMPP(x(),e);c.config.handlers.onHandleStanza==null?void 0:c.config.handlers.onHandleStanza(e,a,b.byteLength);var f=c.activePing;if(f&&f.socketId===a&&f.stanzaId===$(e)){c.activePing=null;f.handler.resolve(e);c.maybeScheduleHealthCheck();return"NO_ACK"}return c.handleStanza(e,a,b.byteLength)}).then(function(b){if(a!==c.socketId)return;if(b==="CLOSE_SOCKET"){d("WALogger").LOG(w());var e=c.socket;e&&e.close()}else b==="NO_ACK"?d("WALogger").DEV(v()):c.castStanza(b);return"NO_ACK"});this.$3.add(e);e["finally"](function(){return void c.$3["delete"](e)})};e.handleAck=function(a){var b=this.ackHandlers,c=-1,e=null;while(!e&&++c<b.length)e=b[c].parseAndTest(a);if(e){var f=b[c];d("WAArrayUtils").removeIndexWithoutPreservingOrder(b,c);this.config.handlers.onHandleAck==null?void 0:this.config.handlers.onHandleAck(a);f.resolve(e);this.maybeScheduleHealthCheck()}else d("WALogger").WARN(u(),a)};e.removeHandler=function(a,c){c===void 0&&(c="disconnect");if(a.type==="iq"||a.type==="smax"){var e=a.stanza.attrs.id;if(!e||typeof e!=="string")return;if(a.type==="iq"&&!this.pendingIqs["delete"](e)||a.type==="smax"&&!this.pendingSmaxStanzas["delete"](e))return}else{a.type;e=this.ackHandlers.indexOf(a);if(e===-1)return;d("WAArrayUtils").removeIndexWithoutPreservingOrder(this.ackHandlers,e)}c==="disconnect"?a.resolve((h||(h=b("Promise"))).reject(new(d("WAErrors").Disconnected)())):a.resolve((h||(h=b("Promise"))).reject(new(d("WAErrors").MaxRetries)()))};e.maybeScheduleHealthCheck=function(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size||this.pendingSmaxStanzas.size)return;var a=this.config.healthCheckInterval;a=Math.ceil(a*1e3*(1+Math.random()));this.healthCheckTimer.onOrBefore(a)};return a}();function a(){return P}function e(a,b,c,d){d===void 0&&(d=!0);if(P)return;P=new T(a,b,c);d&&setTimeout(U,0)}function f(){var a=Z("stopComms");a.socketLoop.endWithValue();a.socket&&X();P=null}function aa(){var a=Z("closeSocketAndPreventRetry");a.socketLoop.endWithValue();a.socket&&(d("WALogger").LOG(t()),X())}function U(){Z("openSocketLoop").socketLoop.start()}function ba(){d("WALogger").LOG(s()),V()||Z("maybeResetSocketLoop").socketLoop.reset()}function ca(){Z("forceResetSocketLoop").socketLoop.reset()}function da(){var a,b=Z("socketAbortController");(a=b.socketAbortController)==null?void 0:a.abort();b.softCloseSocket==null?void 0:b.softCloseSocket()}function V(){var a;return!!((a=P)==null?void 0:a.socket)}function W(){var a=Z("socketLoopIteration"),b=a.nextSocketId++;d("WALogger").LOG(r(),b);var c=function(){a.onConnectionChange("in_handshake")};a.config.handlers.onSocketLoopIteration==null?void 0:a.config.handlers.onSocketLoopIteration(a.socketAbortController);typeof AbortController==="function"&&(a.socketAbortController=new AbortController());return a.config.openChatSocket(c,(c=a.socketAbortController)==null?void 0:c.signal).then(d("WAResultOrError").onResult(function(c){a.config.handlers.onSocketOpen==null?void 0:a.config.handlers.onSocketOpen();var e=new(d("WAResolvable").Resolvable)();d("WALogger").LOG(q(),b);a.socketId=b;a.socket=c;a.softCloseSocket=function(){a.softCloseSocket=null,a.socket&&a.config.shouldCloseStaleSocket&&(X(),a.socket=null),e.resolve()};a.socketLoop.resetTimeoutAfter(1e4);a.deadSocketTimer.cancel();a.maybeScheduleHealthCheck();c.setOnFrame(function(c){return a.parseAndHandleStanza(b,c)});c.setOnClose(function(){d("WALogger").LOG(p(),b);a.activePing&&b===a.activePing.socketId&&(a.activePing.handler.resolve(),a.activePing=null);a.filterPending(function(a){return a.attachedToSocketId===b}).forEach(function(b){return void a.removeHandler(b)});if(b!==a.socketId)return;a.socketId=S;a.socket=null;a.onConnectionChange("disconnected");a.config.handlers.onDisconnect==null?void 0:a.config.handlers.onDisconnect();e.resolve()});a.onConnectionChange("connected");a.config.handlers.onConnect==null?void 0:a.config.handlers.onConnect();a.filterPending(function(a){return!a.attachedToSocketId}).sort(function(a,b){return a.orderedId-b.orderedId}).forEach(function(b){switch(b.type){case"smax":case"iq":a.maybeSendPendingStanza(b);break;case"ack":a.callStanza(b.stanza);break;default:b.type;break}});return e.promise})).then(d("WAResultOrError").catchError(function(a){switch(a){case"max-hunters":d("WALogger").WARN(o());break;case"disconnected":d("WALogger").WARN(n());break;default:a;return}}))["catch"](function(a){a instanceof d("WAErrors").Disconnected?d("WALogger").LOG(m()):d("WALogger").ERROR(l(),a).devConsole(a)})}function X(){var a=Z("closeSocket");a.socket&&(d("WALogger").LOG(k(),a.socketId),d("WALogger").LOG(j()),a.socket.close())}function ea(){Z("onStreamErrorReceived").socketLoop.cancelReset()}function fa(){Z("waitForConnection").sendPing();Q||(Q=new(d("WAResolvable").Resolvable)());return Q.promise}function ga(a,b){var c=Z("castStanza");c.socket?c.castStanza(a,b):d("WALogger").LOG(i())}function ha(a){var b=Z("castStanza");return b.socketId===a}function Y(a,e,f,g,i){f===void 0&&(f=0);i===void 0&&(i="iq");return new(h||(h=b("Promise")))(function(j){var k=Z("sendIq"),l=a.attrs.id;if(!l||typeof l!=="string")throw c("WAErr")("Comms:sendIq given iq without id: "+String(a));var m=k.socketId;if(e&&!m){j((h||(h=b("Promise"))).reject(new(d("WAErrors").Offline)()));return}var n=function(){var a=i==="iq"?k.pendingIqs.get(l):k.pendingSmaxStanzas.get(l);if(!a){j((h||(h=b("Promise"))).reject(c("WAErr")("Comms:_sendIq unexisting stanza to be cancelled: "+l)));return}k.removeHandler(a)},o=null;if(f>0){var p=setTimeout(n,f*1e3);o=function(){clearTimeout(p)}}if(g!=null)if(g.aborted){j((h||(h=b("Promise"))).reject(new(d("WAErrors").Disconnected)()));return}else g.addEventListener("abort",n),o=function(){g.removeEventListener("abort",n)};m={resolve:j,stanza:a,attachedToSocketId:e?m:S,orderedId:R++,attempt:0,cleanup:o};if(i==="iq"){o=babelHelpers["extends"]({type:i},m);k.pendingIqs.set(l,o);k.config.handlers.onSendIq==null?void 0:k.config.handlers.onSendIq(a);k.maybeSendPendingStanza(o)}else{i;o=babelHelpers["extends"]({type:i},m);k.pendingSmaxStanzas.set(l,o);k.maybeSendPendingStanza(o)}})}function ia(a,b){var c,d;c=(c=b==null?void 0:b.withoutRetry)!=null?c:!1;d=(d=b==null?void 0:b.timeoutSeconds)!=null?d:0;b=(b=b==null?void 0:b.signal)!=null?b:null;return Y(a,c,d,b,"smax")}function ja(){var a=Z("sendPing");return a.sendPing()}function ka(){return Z("startHandlingRequests").startHandlingRequests()}function la(){P&&P.deadSocketTimer.cancel()}function Z(a){if(P)return P;throw c("WAErr")("Comms::"+a+" called before startComms")}function $(a){if(a.tag==="iq"){var b=a.attrs.type;if(b==="result"||b==="error")return d("WAWap").decodeAsString(a.attrs.id)||null}return null}function ma(){return R++}function na(){P=null,Q=new(d("WAResolvable").Resolvable)(),R=1}g.DEFAULT_SOCKET_ID=S;g.getComms=a;g.startComms=e;g.stopComms=f;g.closeSocketAndPreventRetry=aa;g.openSocketLoop=U;g.maybeResetSocketLoop=ba;g.forceResetSocketLoop=ca;g.forceAbortSocketConnection=da;g.isSocketConnected=V;g.socketLoopIteration=W;g.closeSocket=X;g.onStreamErrorReceived=ea;g.waitForConnection=fa;g.castSmaxStanza=ga;g.isActiveSocket=ha;g._sendIq=Y;g.sendSmaxStanza=ia;g.sendPing=ja;g.startHandlingRequests=ka;g.cancelDeadSocketTimer=la;g.singletonOrThrowIfUninitialized=Z;g.getAndIncrementNextOrderedId=ma;g.resetStateForTests=na}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAErr","WAHasProperty","WAXmlParsingFailure"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("WAErr")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WAConvertRegistrationIdMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAParsableXmlNode").convertBytesToUint(a.registrationElementValue,4)}g.registrationIdMixin=a}),98);
__d("WAConvertSignedPreKeyMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.skeyIdKeyIDMixin.elementValue,3),pubkey:a.skeyValueKeyDataMixin.elementValue,signature:a.skeySignatureElementValue}}g.convertSignedPreKeyMixin=a}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={};a.internalSpec={sessionVersion:[1,(d=d("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,d.TYPES.BYTES],remoteIdentityPublic:[3,d.TYPES.BYTES],rootKey:[4,d.TYPES.BYTES],previousCounter:[5,d.TYPES.UINT32],senderChain:[6,d.TYPES.MESSAGE,e],receiverChains:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],pendingKeyExchange:[8,d.TYPES.MESSAGE,c],pendingPreKey:[9,d.TYPES.MESSAGE,b],remoteRegistrationId:[10,d.TYPES.UINT32],localRegistrationId:[11,d.TYPES.UINT32],needsRefresh:[12,d.TYPES.BOOL],aliceBaseKey:[13,d.TYPES.BYTES]};b.internalSpec={preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[3,d.TYPES.INT32],baseKey:[2,d.TYPES.BYTES]};c.internalSpec={sequence:[1,d.TYPES.UINT32],localBaseKey:[2,d.TYPES.BYTES],localBaseKeyPrivate:[3,d.TYPES.BYTES],localRatchetKey:[4,d.TYPES.BYTES],localRatchetKeyPrivate:[5,d.TYPES.BYTES],localIdentityKey:[7,d.TYPES.BYTES],localIdentityKeyPrivate:[8,d.TYPES.BYTES]};e.internalSpec={senderRatchetKey:[1,d.TYPES.BYTES],senderRatchetKeyPrivate:[2,d.TYPES.BYTES],chainKey:[3,d.TYPES.MESSAGE,h],messageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f]};f.internalSpec={index:[1,d.TYPES.UINT32],cipherKey:[2,d.TYPES.BYTES],macKey:[3,d.TYPES.BYTES],iv:[4,d.TYPES.BYTES]};h.internalSpec={index:[1,d.TYPES.UINT32],key:[2,d.TYPES.BYTES]};i.internalSpec={currentSession:[1,d.TYPES.MESSAGE,a],previousSessions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,a]};j.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES]};k.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES],signature:[4,d.TYPES.BYTES],timestamp:[5,d.TYPES.FIXED64]};l.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};m.internalSpec={senderKeyId:[1,d.TYPES.UINT32],senderChainKey:[2,d.TYPES.MESSAGE,p],senderSigningKey:[3,d.TYPES.MESSAGE,n],senderMessageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,o]};n.internalSpec={"public":[1,d.TYPES.BYTES],"private":[2,d.TYPES.BYTES]};o.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};p.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};q.internalSpec={senderKeyStates:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};g.SessionStructureSpec=a;g.SessionStructure$PendingPreKeySpec=b;g.SessionStructure$PendingKeyExchangeSpec=c;g.SessionStructure$ChainSpec=e;g.SessionStructure$Chain$MessageKeySpec=f;g.SessionStructure$Chain$ChainKeySpec=h;g.RecordStructureSpec=i;g.PreKeyRecordStructureSpec=j;g.SignedPreKeyRecordStructureSpec=k;g.IdentityKeyPairStructureSpec=l;g.SenderKeyStateStructureSpec=m;g.SenderKeyStateStructure$SenderSigningKeySpec=n;g.SenderKeyStateStructure$SenderMessageKeySpec=o;g.SenderKeyStateStructure$SenderChainKeySpec=p;g.SenderKeyRecordStructureSpec=q}),98);
__d("WACryptoHkdf",["Promise","WABinary","WACryptoHmac","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h,i=255*d("WACryptoHmac").SHA256_BYTE_LENGTH;function j(a,e,f){if(f<0||f>i)return(h||(h=b("Promise"))).reject(c("WAErr")("HKDF::expand given bad length "+f));var g,j=Math.ceil(f/d("WACryptoHmac").SHA256_BYTE_LENGTH),k=d("WABinary").Binary.build(e).readByteArray(),l=new(d("WABinary").Binary)(),m=d("WACryptoHmac").encodeKeySha256(a).then(function(a){g=a;return new Uint8Array(0)});e=function(a){m=m.then(function(b){return d("WACryptoHmac").sign(g,d("WABinary").Binary.build(b,k,a).readByteArray())}).then(function(a){a=new Uint8Array(a);l.writeByteArray(a);return a})};for(a=1;a<=j;a++)e(a);return m.then(function(){return l.readBuffer(f)})}function a(a,b,c){return d("WACryptoHmac").extractSha256(null,a).then(function(a){return j(new Uint8Array(a),b,c)})}function e(a,b,c,e){return d("WACryptoHmac").extractSha256(b,a).then(function(a){return j(new Uint8Array(a),c,e)})}g.expand=j;g.extractAndExpand=a;g.extractWithSaltAndExpand=e}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAErr","WAParsableXmlNode","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h={name:"AES-CBC"},i={name:"HMAC",hash:"SHA-256"};function j(a,b){if(a.length!==b)throw c("WAErr")("Signal expected "+b+" bytes, given "+a.length);return a}function a(a,b){return j(new Uint8Array(a),b)}function b(a){var b=a.buffer,c=a.byteOffset;a=a.length;return c===0&&a===b.byteLength?b:b.slice(c,c+a)}function e(a,b){return a.readByteArray(b)}function f(a){return new Uint8Array(a)}function k(a,b,d){if(a.length-b<d)throw c("WAErr")("Can not split off "+d+" bytes from index "+b+" of "+a.length+" bytes");return a.slice(b,b+d)}function l(a){a=a==="extendedRange"?(-1>>>1)-1:16380;return d("WACryptoUtils").randomNumberLessThan(a)+1}function m(a){return q(a)}function n(a){return d("WAParsableXmlNode").convertBytesToUint(a,4)}function o(){var a=-1>>>1;return d("WACryptoUtils").randomNumberLessThan(a)+1}function p(a){return q(a)}function q(a,b,d){b===void 0&&(b=0);d===void 0&&(d=4294967296);if(typeof a==="number"&&b<=a&&a<d&&Math.floor(a)===a)return a;else throw c("WAErr")("Expected integer in range ["+b+", "+d+"), given "+String(a))}function r(a,b){return d("encodeProtobuf").encodeProtobuf(a,b).readByteArray()}function s(a,b,c){return c(d("decodeProtobuf").decodeProtobuf(a,b))}function t(a,b,c,e){return d("WACryptoHkdf").extractWithSaltAndExpand(a,b,c,e).then(function(a){return new Uint8Array(a)})}function u(a,b){var c,e;b==="hmac-sha256"?(c=i,e=["sign"]):(b,c=h,e=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,c,!1,e)}function v(a){return a}function w(a){return a}function x(a,b){return d("WACryptoUtils").arrayBuffersEqual(a,b)}g.AES_CBC=h;g.HMAC_SHA256=i;g.ensureSize=j;g.toBytes=a;g.toBuffer=b;g.readBytes=e;g.makeBytes=f;g.sliceBytes=k;g.makeRegistrationId=l;g.castRegistrationId=m;g.castRegistrationIdFromBytes=n;g.makeSenderKeyId=o;g.castSenderKeyId=p;g.ensureIntInRange=q;g.encodeSignalProto=r;g.decodeSignalProto=s;g.hkdf=t;g.makeCryptoKey=u;g.castToByteEncoded=v;g.castToSessionHash=w;g.areSessionHashesEqual=x}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WAErr","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""]);h=function(){return a};return a}var i=5,j=16777215;function k(a,b){return{publicKey:a,privateKey:b}}function a(a){a=d("WACryptoPrimitives").keypairFromSecretKey(a);var b=a.publicKey;a=a.secretKey;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function b(a,b){return{publicKey:d("WASignalOther").toBytes(a,32),privateKey:d("WASignalOther").toBytes(b,32)}}function l(){var a=d("WACryptoPrimitives").keyPair(),b=a.publicKey;a=a.secretKey;a[0]&=248;a[31]=64|a[31]&63;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function m(a,b){return k(d("WASignalOther").sliceBytes(b,1,32),a)}function n(a,b){return{serializedPubKey:b,privateKey:a}}function e(){var a=l();return n(a.privateKey,o(a))}function o(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(a.publicKey,1);return b}function f(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(d("WASignalOther").ensureSize(a,32),1);return b}function p(a){return n(a.privateKey,o(a))}function q(a,b){a=(a-1)%j;a<=0&&(a+=j);var c=[];for(var e=0;e<b;e++){var f=a===j?1:a+1,g=l(),h=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:f,publicKey:o(g),privateKey:g.privateKey});c.push({plainObject:{id:f,keyPair:g},record:h});a=f}return c}function r(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey;a=a.privateKey;return b==null||c==null||a==null?null:{id:s(b),keyPair:m(d("WASignalOther").toBytes(a,32),u(new Uint8Array(c)))}}catch(a){d("WALogger").DEV(h(),a);return null}}function s(a){return d("WASignalOther").ensureIntInRange(a,1,j)}function t(a){return d("WASignalOther").ensureIntInRange(a,0,j)}function u(a){if(a.length===0||a[0]!==i)throw c("WAErr")("Unrecognized public key type");return d("WASignalOther").ensureSize(a,33)}function v(){var a=d("WASignalOther").makeBytes(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function w(a,b){return d("WACryptoPrimitives").scalarMult(a,b.subarray(1)).buffer}g.KEY_TYPE=i;g.makeKeyPairFrom=a;g.makeKeyPairFromArrayBuffers=b;g.makeKeyPair=l;g.makeKeyPairFromSerialized=m;g.makeSerializedKeyPairFrom=n;g.makeSerializedKeyPair=e;g.serializePubKey=o;g.serializeIdentity=f;g.toSerializedKeyPair=p;g.makePreKeys=q;g.deserializePreKey=r;g.castToPreKeyId=s;g.castToSignedPreKeyId=t;g.castToSerializedPubKey=u;g.makeRawSenderKey=v;g.ecdh=w}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve().then(function(){return d("WASignalKeys").makeKeyPair()})}function c(a,c){return(h||(h=b("Promise"))).resolve().then(function(){return d("WACryptoPrimitives").scalarMult(d("WASignalOther").ensureSize(c,32),d("WASignalOther").ensureSize(a,32)).buffer})}e={generateIdentityKeyPair:a,calculateAgreement:c};g.calculateAgreement=c;g.CURVE25519_SIGNAL_DEPENDENCIES=e}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){var b=h;h=[];try{return a()}finally{((a=h)!=null?a:[]).forEach(function(a){return void a.fill(0)});h=b}}function j(a,b){if(h==null)throw c("WAErr")("allocate called outside of active scope");return new a(b)}function a(a,b,c){d("WACryptoPrimitives").lowlevel.crypto_hash(a,b,c)}function b(a,b){for(var c=0;c<64;++c)b[c]=a[c],a[c]=0;l(a,b);b.fill(0)}function e(a,b){var c=[k(),k(),k(),k()];d("WACryptoPrimitives").lowlevel.scalarbase(c,b);R(a,c)}function k(a){var b=j(Float64Array,16);if(a){if(a.length>16)throw c("WAErr")("Incorrect initialiser array provided to the fieldElement");for(var d=0;d<a.length;d++)b[d]=a[d]}return b}function l(a,b){d("WACryptoPrimitives").lowlevel.modL(a,b)}var m=function(){return k([0])},n=function(){return k([1])},o=function(){return k([2])},p=function(){return k([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function q(){return[k(),k(),k(),k()]}function r(){return[k(),k(),k(),k()]}function s(){return[k(),k(),k()]}function t(a,b){var c=0;b=b;while(b>0){var d=b%65536;a[c]=d;b=(b-d)/65536;c++}}function u(a,b){return T(a,b)?0:1}function v(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=j(Uint8Array,32);b(c,a);return c[0]&1}function w(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=o(),g=k();c(g,b);e(a,f,g)}function x(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.A,g=m(),h=n(),i=k(),j=k(),l=k(),o=k();t(g,486662);c(i,b);e(j,g,b);f(l,i,j);f(o,l,h);e(a,b,o)}function y(a,b,c){c===1&&a.set(b)}var z=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function A(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.unpack25519,f=c.lowlevel.pow2523,g=c.lowlevel.M;c=c.lowlevel.S;var h=k();e(h,z);e=k();f(e,b);f=k();g(f,b,e);e=k();c(e,f);c=k();g(c,f,h);y(f,c,1^u(e,b));a.set(f)}function B(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.M,g=n(),h=k(),i=k(),j=k();c(h,b,g);e(i,b,g);S(j,i);f(a,h,j)}function C(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=m();c(a,e,b)}function D(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3])}function E(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3]);c(a[3],b[0],b[1])}function F(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.Z;c(a[0],b[0]);c(a[2],b[1]);w(a[3],b[2]);e(a[1],b[0],b[1]);b=k();c(b,a[1]);e(a[1],a[2],a[0]);f(a[2],a[2],a[0]);f(a[0],b,a[1]);f(a[3],a[3],a[2])}var G=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function H(a,b,c){var e=d("WACryptoPrimitives").lowlevel.unpack25519,f=d("WACryptoPrimitives").lowlevel.M,g=k();e(g,G);e=k();B(e,b);var h=k();x(h,b);var i=k();A(i,h);h=k();f(h,b,g);b=k();S(b,i);g=k();f(g,h,b);i=k();C(i,g);y(g,i,v(g)^c);a[0].set(g);a[1].set(e);a[2].set(n());f(a[3],a[0],a[1])}function I(a,b){a[0].set(b[0]),a[1].set(b[1]),a[2].set(b[2])}function J(a,b){var c=s();I(c,b);F(a,c)}function K(a,b){var c=r(),d=s();J(c,b);D(d,c);F(c,d);D(d,c);F(c,d);E(a,c)}function L(a){var b,c=(b=d("WACryptoPrimitives")).lowlevel.S,e=b.lowlevel.M,f=b.lowlevel.pow2523;b=b.lowlevel.pack25519;var g=k(),h=k(),i=k(),j=k(),l=k();f(g,a);c(h,g);c(i,h);e(j,i,a);e(l,j,a);f=new Uint8Array(32);b(f,l);return 1&f[31]}function M(a,b){C(a[0],b[0]),a[1].set(b[1]),a[2].set(b[2]),C(a[3],b[3])}function f(a,b){var c=q();b=U(c,b);if(b!==0)return-1;M(a,c);return 0}function N(a,b){var c=d("WACryptoPrimitives").lowlevel.M,e=d("WACryptoPrimitives").lowlevel.A;b=b;var f=n(),g=m();t(g,486662);var h=k();w(h,b);b=k();e(b,h,f);h=k();S(h,b);f=k();c(f,h,g);b=k();C(b,f);c=k();x(c,b);h=L(c);f=k([0]);y(f,g,h);c=k();e(c,b,f);g=k();C(g,c);y(c,g,h);a.set(c)}function O(a){var b=d("WACryptoPrimitives").lowlevel.unpack25519;a=d("WACryptoPrimitives").hash(a);var c=(a[31]&128)>>7;a[31]&=127;var e=k();b(e,a);b=k();P(b,e);a=q();H(a,b,c);e=q();K(e,a);return e}function P(a,b){return i(function(){return N(a,b)})}function Q(a){return i(function(){return O(a)})}function R(a,b){var c=k(),e=k(),f=k(),g=d("WACryptoPrimitives").lowlevel.M,h=d("WACryptoPrimitives").lowlevel.pack25519;S(f,b[2]);g(c,b[0],f);g(e,b[1],f);h(a,e);g=new Uint8Array(32);h(g,c);a[31]^=(g[0]&1)<<7}function S(a,b){var c=k();c.set(b);var e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.S;for(var g=253;g>=0;--g)f(c,c),g!==2&&g!==4&&e(c,c,b);a.set(c)}function T(a,b){var c=d("WACryptoPrimitives").lowlevel.pack25519,e=d("WACryptoPrimitives").lowlevel.crypto_verify_32,f=new Uint8Array(32),g=new Uint8Array(32);c(f,a);c(g,b);return e(f,0,g,0)}function U(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.set25519,f=c.lowlevel.S,g=c.lowlevel.M,h=c.lowlevel.Z,i=c.lowlevel.A,j=c.lowlevel.D,l=c.lowlevel.unpack25519;c=c.lowlevel.pow2523;var o=k(),q=k(),r=k(),s=k(),t=k(),u=k(),v=k();e(a[2],n());l(a[1],b);f(r,a[1]);g(s,r,j);h(r,r,a[2]);i(s,a[2],s);f(t,s);f(u,t);g(v,u,t);g(o,v,r);g(o,o,s);c(o,o);g(o,o,r);g(o,o,s);g(o,o,s);g(a[0],o,s);f(q,a[0]);g(q,q,s);T(q,r)&&g(a[0],a[0],p());f(q,a[0]);g(q,q,s);if(T(q,r))return-1;V(a[0])===b[31]>>7&&h(a[0],m(),a[0]);g(a[3],a[0],a[1]);return 0}function V(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=new Uint8Array(32);b(c,a);return c[0]&1}g.runInAllocationScope=i;g.allocate=j;g.hashSha512=a;g.reduce=b;g.scalarmultBase=e;g.fieldElement=k;g.modL=l;g.p3Element=q;g.unpack=f;g.elligator=P;g.hashToPoint=Q;g.pack=R;g.inv25519=S;g.unpackneg=U}),98);
__d("WALock",["Promise","WAResolvable","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Lock failed for ",""]);i=function(){return a};return a}function a(a){return{lock:function(c,e){var f=new(d("WAResolvable").Resolvable)(),g=c.map(function(a){return[a,new(d("WAResolvable").Resolvable)()]});(h||(h=b("Promise"))).all(g.map(function(b){var c=b[0],d=b[1];return a.enqueue(c,function(){d.resolve();return f.promise})}))["catch"](function(){d("WATagsLogger").TAGS(["WALock"]).ERROR(i(),c)});return h.all(g.map(function(a){a[0];a=a[1];return a.promise})).then(function(){return e()})["finally"](function(){f.resolve()})},wait:function(b){return a.wait(b)}}}g.makeLock=a}),98);
__d("WAPromiseQueue",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(a){a===void 0&&(a=-1),this.$1=(g||(g=b("Promise"))).resolve(),this.$3=0,this.$2=a}var c=a.prototype;c.wait=function(){return this.$1};c.enqueueHandlers=function(a,b,c){var d=this;this.$3++;b=this.$1.then(function(){return a}).then(b,c);c=b.then();this.$1=h(b,this.$2)["finally"](function(){d.$3--});return c};c.enqueue=function(a){var b=this;this.$3++;a=this.$1.then(a);var c=a.then();this.$1=h(a,this.$2)["finally"](function(){b.$3--});return c};c.size=function(){return this.$3};return a}();c=function(){function a(a){a===void 0&&(a=-1),this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitIfPending=function(a){return this.$1.get(a)};c.wait=function(a){return this.$1.get(a)||(g||(g=b("Promise"))).resolve()};c.enqueueHandlers=function(a,b,c,d){c=this.wait(a).then(function(){return b}).then(c,d);return this.$3(a,c)};c.enqueue=function(a,b){b=this.wait(a).then(b);return this.$3(a,b)};c.$3=function(a,b){var c=this,d=b.then(),e,f=function(){c.$1.get(a)===e&&c.$1["delete"](a)};e=h(b,this.$2).then(f,f);this.$1.set(a,e);return d};return a}();function h(a,c){if(c>=0)return new(g||(g=b("Promise")))(function(b){var d=function(){return void b()};a.then(d,d);setTimeout(d,c)});else return a.then(i,i)}function i(){}f.PromiseQueue=a;f.PromiseQueueMap=c}),66);
__d("WALockMap",["WALock","WAPromiseQueue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a===void 0&&(a=-1);a=new(d("WAPromiseQueue").PromiseQueueMap)(a);return d("WALock").makeLock(a)}g.makeLockMap=a}),98);
__d("WACryptoLibraryConfig",[],(function(a,b,c,d,e,f){"use strict";var g={signalFutureMessagesMax:2e3};function a(){return g}function b(a,b){g[a]=b}f.getCryptoLibraryConfig=a;f.setCryptoLibraryConfig=b}),66);
__d("WASignalSessions",["WABinary","WAErr","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h=3;function a(a,b){return i(a,0,b,[])}function i(a,b,c,d){return{ratchetPubKey:a,nextMsgIndex:b,chainKey:c,unusedMsgKeys:d}}function b(a,b){return j(a,0,b)}function j(a,b,c){return{ratchetKey:a,nextMsgIndex:b,chainKey:c}}function k(a,b,c){return{remoteOneTimeId:a,remoteSignedId:b,localOneTimePubKey:c}}function e(a,b){return n(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,a.initialExchangeInfo,a.prevSendChainHighestIndex,b,a.aliceBaseKey)}function f(a,b,c){return n(a.local,a.remote,a.rootKey,b,c,a.initialExchangeInfo,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function l(a,b,c,d){c===void 0&&(c=a.sendChain);return n(a.local,a.remote,d,b,c,null,Math.max(a.sendChain.nextMsgIndex-1,0),a.prevSessions,a.aliceBaseKey)}function m(a,b,c,d,e,f,g){return n(a,b,c,d,e,f,0,[],g)}function n(a,b,c,d,e,f,g,h,i){return{local:a,remote:b,rootKey:c,sendChain:e,recvChains:d,initialExchangeInfo:f,prevSendChainHighestIndex:g,prevSessions:h,aliceBaseKey:i}}function o(a,b){b=new(d("WABinary").Binary)(b);var c=d("WASignalOther").readBytes(b,32),e=d("WASignalOther").readBytes(b,32);b=d("WASignalOther").readBytes(b,16);return p(a,c,e,b)}function p(a,b,c,d){return{index:a,cipherKey:b,macKey:c,iv:d}}function q(a){return{senderRatchetKey:a.ratchetPubKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey},messageKeys:a.unusedMsgKeys}}function r(a){var b=a.ratchetKey;return{senderRatchetKey:b.serializedPubKey,senderRatchetKeyPrivate:b.privateKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey}}}function s(a){var b=a.local,c=a.remote,d=a.initialExchangeInfo,e=void 0;if(d){var f=d.remoteOneTimeId;e={preKeyId:f!=null?f:void 0,signedPreKeyId:d.remoteSignedId,baseKey:d.localOneTimePubKey}}return{currentSession:{sessionVersion:h,localIdentityPublic:b.pubKey,remoteIdentityPublic:c.pubKey,rootKey:a.rootKey,previousCounter:a.prevSendChainHighestIndex,senderChain:r(a.sendChain),receiverChains:a.recvChains.map(q),pendingPreKey:e,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey},previousSessions:a.prevSessions}}function t(a){var b=a.local,c=a.remote,e=a.sendChain,f=a.initialExchangeInfo,g=void 0;if(f){var i=f.remoteOneTimeId;g={preKeyId:i!=null?i:void 0,signedPreKeyId:f.remoteSignedId,baseKey:d("WASignalOther").toBuffer(f.localOneTimePubKey)}}return{sessionVersion:h,localIdentityPublic:d("WASignalOther").toBuffer(b.pubKey),remoteIdentityPublic:d("WASignalOther").toBuffer(c.pubKey),rootKey:d("WASignalOther").toBuffer(a.rootKey),previousCounter:a.prevSendChainHighestIndex,senderChain:{senderRatchetKey:d("WASignalOther").toBuffer(e.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:d("WASignalOther").toBuffer(e.ratchetKey.privateKey),chainKey:{index:e.nextMsgIndex,key:d("WASignalOther").toBuffer(e.chainKey)},messageKeys:[]},receiverChains:a.recvChains.map(function(a){return{senderRatchetKey:d("WASignalOther").toBuffer(a.ratchetPubKey),chainKey:{index:a.nextMsgIndex,key:d("WASignalOther").toBuffer(a.chainKey)},messageKeys:a.unusedMsgKeys.map(function(a){return{index:a.index,cipherKey:d("WASignalOther").toBuffer(a.cipherKey),macKey:d("WASignalOther").toBuffer(a.macKey),iv:d("WASignalOther").toBuffer(a.iv)}})}}),pendingPreKey:g,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey==null?void 0:d("WASignalOther").toBuffer(a.aliceBaseKey)}}function u(a){var b=A(a.currentSession,"currentSession");return w(b,a.previousSessions)}function v(a){return w(a,[])}function w(a,b){var e=A(a.sessionVersion,"sessionVersion");if(e!==h)throw c("WAErr")("Signal: bad session version "+e);e=A(a.senderChain,"senderChain");var f=A(e.chainKey,"senderChain.chainKey");e=j(d("WASignalKeys").makeSerializedKeyPairFrom(z(e.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),y(e.senderRatchetKey,"senderRatchetKey")),A(f.index,"senderChain.chainKey.index"),z(f.key,32,"senderChain.chainKey.key"));f=A(a.receiverChains,"receiverChains").map(function(a){var b=A(a.chainKey,"receiverChains[].chainKey");return i(y(a.senderRatchetKey,"receiverChains[].senderRatchetKey"),A(b.index,"receiverChains[].chainKey.index"),z(b.key,32,"receiverChains[].chainKey.key"),x(a.messageKeys))});var g={regId:d("WASignalOther").castRegistrationId(A(a.localRegistrationId,"localRegistrationId")),pubKey:y(a.localIdentityPublic,"localIdentityPublic")},l={regId:d("WASignalOther").castRegistrationId(A(a.remoteRegistrationId,"remoteRegistrationId")),pubKey:y(a.remoteIdentityPublic,"remoteIdentityPublic")},m=a.pendingPreKey,o=null;if(m){var p=m.preKeyId;o=k(p!=null?d("WASignalKeys").castToPreKeyId(p):null,d("WASignalKeys").castToSignedPreKeyId(A(m.signedPreKeyId,"pendingPreKey.signedPreKeyId")),y(m.baseKey,"pendingPreKey.baseKey"))}p=a.aliceBaseKey==null?null:y(a.aliceBaseKey,"aliceBaseKey");return n(g,l,z(a.rootKey,32,"rootKey"),f,e,o,a.previousCounter||0,b,p)}function x(a){return a.map(function(a){return{index:A(a.index,"messageKeys[].index"),cipherKey:z(a.cipherKey,32,"messageKeys[].cipherKey"),macKey:z(a.macKey,32,"messageKeys[].macKey"),iv:z(a.iv,16,"messageKeys[].iv")}})}function y(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(A(a,b)))}function z(a,b,c){return d("WASignalOther").toBytes(A(a,c),b)}function A(a,b){if(a==null)throw c("WAErr")("Signal: protobuf is missing "+b);return a}g.FORMAT_VERSION=h;g.makeFreshRecvChain=a;g.makeRecvChain=i;g.makeFreshSendChain=b;g.makeSendChain=j;g.makeInitialExchangeInfo=k;g.setPrevSessions=e;g.updateChains=f;g.ratchetSession=l;g.makeFreshSession=m;g.makeSession=n;g.splitMsgKey=o;g.serializeSession=s;g.detachSession=t;g.parseSessionFromRecord=u;g.parseSession=v;g._parseSession=w;g.bytesOrThrow=z;g.definedOrThrow=A}),98);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAErr","WAHex","WALogger","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeSignedPreKey error ",""]);i=function(){return a};return a}function j(a,b,c){return d("WACryptoEd25519").runInAllocationScope(function(){var e,f=b.length,g=a.privateKey,h=new Uint8Array(32);(e=d("WACryptoEd25519")).scalarmultBase(h,g);var i=h[31]&128,j=new Uint8Array(f+128);j[0]=254;j.fill(255,1,32);j.set(g,32);j.set(b,64);j.set(c,f+64);var k=e.allocate(Uint8Array,64);e.hashSha512(k,j,f+128);j.set(h,32);h=e.allocate(Float64Array,64);e.reduce(k,h);e.scalarmultBase(j,k);var l=e.allocate(Uint8Array,64);e.hashSha512(l,j,f+64);e.reduce(l,h);for(f=0;f<32;++f)h[f]=k[f];for(f=0;f<32;++f)for(k=0;k<32;++k)h[f+k]+=l[f]*g[k];e.modL(j.subarray(32,64),h);return{pubKeyNegative:i!==0,signedMsg:j}})}function a(a,c){return(h||(h=b("Promise"))).resolve().then(function(){var b=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(b);return k(a,c,b)})}function e(a,b,c){var e=c[63];return e&96?!1:d("WACryptoEd25519").runInAllocationScope(function(){var f,g,h=(f=d("WACryptoPrimitives")).lowlevel.A,i=f.lowlevel.M,j=f.lowlevel.Z,k=f.lowlevel.pack25519,l=f.lowlevel.unpack25519,m=(g=d("WACryptoEd25519")).allocate(Uint8Array,64);m.set(c);m[63]=e&127;var n=g.fieldElement(),o=g.fieldElement(),p=g.fieldElement(),q=g.fieldElement(),r=g.fieldElement(),s=g.allocate(Uint8Array,32),t=g.fieldElement();t[0]=1;l(n,a.subarray(1));j(o,n,t);h(p,n,t);g.inv25519(q,p);i(r,o,q);k(s,r);s[31]=s[31]&127|e&128;return f.signDetachedVerify(b,m,s)})}function k(a,b,c){a=j(a,b,c);b=d("WASignalOther").sliceBytes(a.signedMsg,0,64);b[63]=b[63]&127|(a.pubKeyNegative?128:0);return b}function l(a,b,e){var f=d("WASignalKeys").makeKeyPair(),g=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(g);e=k(e,d("WASignalKeys").serializePubKey(f),g);if(!Number.isSafeInteger(b))throw c("WAErr")("Expected timestamp to be a safe integer, given "+String(b));return{id:d("WASignalKeys").castToPreKeyId(a),ts:b,keyPair:f,signature:e}}function f(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);return k(a,b,c)}function m(a){var b=a.id,c=a.keyPair;return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:b,publicKey:d("WASignalKeys").serializePubKey(c),privateKey:c.privateKey,signature:a.signature,timestamp:a.ts})}function n(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey,e=a.privateKey,f=a.signature;a=a.timestamp;return b==null||c==null||e==null||f==null||a==null?null:{id:d("WASignalKeys").castToSignedPreKeyId(b),ts:d("WALongInt").numberOrThrowIfTooLarge(a),keyPair:d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalOther").toBytes(e,32),d("WASignalKeys").castToSerializedPubKey(new Uint8Array(c))),signature:d("WASignalOther").toBytes(f,64)}}catch(a){d("WALogger").DEV(i(),a);return null}}function o(a){return new Uint8Array(d("WAHex").parseHex(a))}function p(a){if(a.length===33)return d("WASignalKeys").castToSerializedPubKey(a);else if(a.length===32)return d("WASignalKeys").serializeIdentity(a);else throw c("WAErr")("verifyCertificate publicKey incorrect length")}function q(a,c,d){return(h||(h=b("Promise"))).resolve().then(function(){var b=l(a,c,d),e=m(b);return{plainObject:b,record:e}})}g.signMsg=a;g.verifyMsgSignalVariant=e;g.makeSignature=k;g.makeSignedPreKey=l;g.signSenderKeyMessage=f;g.serializeSignedPreKeyForPrivateStorage=m;g.deserializeSignedPreKey=n;g.convertPublicKeyHexToUint8Array=o;g.convertPublicKeyToSerializedPubKey=p;g.generateSignedPreKey=q}),98);
__d("WASignalWhisperTextProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={};a.internalSpec={ratchetKey:[1,(d=d("WAProtoConst")).TYPES.BYTES],counter:[2,d.TYPES.UINT32],previousCounter:[3,d.TYPES.UINT32],ciphertext:[4,d.TYPES.BYTES]};b.internalSpec={registrationId:[5,d.TYPES.UINT32],preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[6,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],identityKey:[3,d.TYPES.BYTES],message:[4,d.TYPES.BYTES]};c.internalSpec={id:[1,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],ratchetKey:[3,d.TYPES.BYTES],identityKey:[4,d.TYPES.BYTES],baseKeySignature:[5,d.TYPES.BYTES]};e.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],ciphertext:[3,d.TYPES.BYTES]};f.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],chainKey:[3,d.TYPES.BYTES],signingKey:[4,d.TYPES.BYTES]};h.internalSpec={generation:[1,d.TYPES.UINT32],signature:[2,d.TYPES.BYTES]};g.SignalMessageSpec=a;g.PreKeySignalMessageSpec=b;g.KeyExchangeMessageSpec=c;g.SenderKeyMessageSpec=e;g.SenderKeyDistributionMessageSpec=f;g.DeviceConsistencyCodeMessageSpec=h}),98);
__d("WASignalGroupSession",["WASignalKeys","WASignalSessions"],(function(a,b,c,d,e,f,g){"use strict";var h=5,i=3;function j(a){var b=d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey"),c=d("WASignalSessions").definedOrThrow(a.senderMessageKeys,"senderMessageKeys"),e=d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey");return{senderSigningKeyPublic:r(b["public"],"public"),senderSigningKeyPrivate:b["private"]?d("WASignalSessions").bytesOrThrow(b["private"],32,"private"):void 0,senderKeyId:d("WASignalSessions").definedOrThrow(a.senderKeyId,"senderKeyId"),unusedMsgKeys:c.map(function(a){return k(d("WASignalSessions").definedOrThrow(a.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(a.seed,50,"seed"))}),senderKeyChainKey:l(d("WASignalSessions").definedOrThrow(e.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(e.seed,32,"seed"))}}function a(a,b,c,d,e){return{senderSigningKeyPublic:a,senderSigningKeyPrivate:b,senderKeyChainKey:c,senderKeyId:d,unusedMsgKeys:e==null?[]:e}}function b(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b.senderKeyId});return{senderKeyStates:a.senderKeyStates.map(function(a,d){return d===c?b:a})}}function c(a,b){a=a.senderKeyStates.slice(a.senderKeyStates.length>h-1?1:0);a.push(b);return{senderKeyStates:a}}function e(a){return{senderKeyStates:[a]}}function k(a,b){return{iteration:a,seed:b}}function l(a,b){return{nextMsgIndex:a,chainKey:b}}function f(a){a=d("WASignalSessions").definedOrThrow(a.senderKeyStates,"senderKeyStates");return m(a)}function m(a){return n(a)}function n(a){a=a.map(function(a){return j(a)});return{senderKeyStates:a}}function o(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b});return c===-1?void 0:a.senderKeyStates[c]}function p(a){return{senderKeyStates:a.senderKeyStates.map(function(a){return q(a)})}}function q(a){return{senderKeyId:a.senderKeyId,senderChainKey:{iteration:a.senderKeyChainKey.nextMsgIndex,seed:a.senderKeyChainKey.chainKey},senderSigningKey:{"public":a.senderSigningKeyPublic,"private":a.senderSigningKeyPrivate},senderMessageKeys:a.unusedMsgKeys.map(function(a){var b=a.iteration;a=a.seed;return{iteration:b,seed:a}})}}function r(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(d("WASignalSessions").definedOrThrow(a,b)))}function s(a){return a}g.FORMAT_VERSION=i;g.makeSenderKeyState=a;g.updateSessionWithUpdatedSenderKeyState=b;g.updateSessionWithNewSenderKeyState=c;g.makeNewSenderKeySession=e;g.makeSenderKeyMsgKey=k;g.makeSenderKeyChainKey=l;g.parseSessionFromRecord=f;g._parseSession=m;g.makeSenderKeySessionFromRecord=n;g.findSenderKeyState=o;g.serializeSession=p;g.serializeSenderKeyState=q;g.convertFromRawToSenderKeyState=s}),98);
__d("WASignalWhitepaper",["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Uint8Array(32);i.fill(255);var j=new Uint8Array([1]),k=new Uint8Array([2]);function a(a,c,e){var f,g,h,j,k,l,m,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").async(function(A){while(1)switch(A.prev=A.next){case 0:g=a.regId,h=a.staticKeyPair;j=c.identity;k=c.signedKey.publicKey;l=e.privateKey;m=h.privateKey;q=(f=c.oneTimeKey)==null?void 0:f.publicKey;r=d("WABinary").Binary.build(i,p(m,k),p(l,j),p(l,k),q&&p(l,q)).readByteArray();A.next=9;return b("regeneratorRuntime").awrap(o(r,"WhisperText"));case 9:s=A.sent;t=s[0];u=s[1];v=c.ratchetKey;w=d("WASignalSessions").makeFreshRecvChain(v,u);x=d("WASignalKeys").makeSerializedKeyPair();A.next=17;return b("regeneratorRuntime").awrap(n(t,x,v));case 17:y=A.sent;z=d("WASignalSessions").makeInitialExchangeInfo(c.oneTimeKey==null?null:c.oneTimeKey.id,c.signedKey.id,d("WASignalKeys").serializePubKey(e));return A.abrupt("return",d("WASignalSessions").makeFreshSession({regId:g,pubKey:d("WASignalKeys").serializePubKey(h)},{regId:c.regId,pubKey:j},y.rootKey,[w],d("WASignalSessions").makeFreshSendChain(x,y.chainKey),z,d("WASignalKeys").serializePubKey(e)));case 20:case"end":return A.stop()}},null,this)}function c(a,c,e,f){var g,h,j,k,l,m,n,p,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:h=a.regId,j=a.staticKeyPair;k=j.privateKey;l=f.signed.privateKey;m=e;n=c.pubKey;p=(g=f.oneTime)==null?void 0:g.privateKey;r=d("WABinary").Binary.build(i,q(n,l),q(m,k),q(m,l),p&&q(m,p)).readByteArray();x.next=9;return b("regeneratorRuntime").awrap(o(r,"WhisperText"));case 9:s=x.sent;t=s[0];u=s[1];v=f.ratchet;w=d("WASignalSessions").makeFreshSendChain(v,u);return x.abrupt("return",d("WASignalSessions").makeSession({regId:h,pubKey:d("WASignalKeys").serializePubKey(j)},c,t,[],w,null,0,[],e));case 15:case"end":return x.stop()}},null,this)}function e(a){a=d("WASignalGroupSession").makeSenderKeyState(d("WASignalKeys").serializePubKey(a),a.privateKey,d("WASignalGroupSession").makeSenderKeyChainKey(0,d("WASignalKeys").makeRawSenderKey()),d("WASignalOther").makeSenderKeyId(),[]);return(h||(h=b("Promise"))).resolve(d("WASignalGroupSession").makeNewSenderKeySession(a))}function f(a,c,e,f,g){e=d("WASignalGroupSession").makeSenderKeyState(e,void 0,d("WASignalGroupSession").makeSenderKeyChainKey(c,f),a,[]);c=null;g?c=d("WASignalGroupSession").updateSessionWithNewSenderKeyState(g,e):c=d("WASignalGroupSession").makeNewSenderKeySession(e);return(h||(h=b("Promise"))).resolve(c)}function l(a,c){var e,f,g,i;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));case 2:e=l.sent;f=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};g=f(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperMessageKeys",80)}).then(function(b){return d("WASignalSessions").splitMsgKey(a,b)});i=f(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return l.abrupt("return",(h||(h=b("Promise"))).all([i,g]));case 7:case"end":return l.stop()}},null,this)}function m(a,c){var e,f,g,i;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));case 2:e=l.sent;f=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};g=f(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperGroup",50)}).then(function(b){return d("WASignalGroupSession").makeSenderKeyMsgKey(a,b)});i=f(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return l.abrupt("return",(h||(h=b("Promise"))).all([i,g]));case 7:case"end":return l.stop()}},null,this)}function n(a,c,e){var f,g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:f=c.privateKey;g=e;h=d("WASignalKeys").ecdh(f,g);l.next=5;return b("regeneratorRuntime").awrap(o(new Uint8Array(h),"WhisperRatchet",a));case 5:i=l.sent;j=i[0];k=i[1];return l.abrupt("return",{rootKey:j,chainKey:k});case 9:case"end":return l.stop()}},null,this)}function o(a,c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e===void 0&&(e=null);g.next=3;return b("regeneratorRuntime").awrap(d("WASignalOther").hkdf(a,e,c,64));case 3:f=g.sent;return g.abrupt("return",[d("WASignalOther").sliceBytes(f,0,32),d("WASignalOther").sliceBytes(f,32,32)]);case 5:case"end":return g.stop()}},null,this)}function p(a,b){return new Uint8Array(d("WASignalKeys").ecdh(a,b))}function q(a,b){return p(b,a)}g.initiateSessionOutgoing=a;g.initiateSessionIncoming=c;g.initiateSenderKeySessionOutgoing=e;g.initiateSenderKeySessionIncoming=f;g.deriveMsgKey=l;g.deriveSenderKeyMsgKey=m;g.calculateRatchet=n}),98);
__d("WASignalCipher",["Promise","WABinary","WACryptoDependencies","WACryptoLibraryConfig","WACryptoUtils","WALogger","WAResultOrError","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","decodeProtobuf","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptMsgFromSession error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializePkMsg error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeMsg error ",""]);k=function(){return a};return a}var l=40,m=8,n=2e3;function a(a,c){var e,f,g,h,i,j,k,l,n,o,p,q,r,s,u,x,y,z,A,B,C;return b("regeneratorRuntime").async(function(D){while(1)switch(D.prev=D.next){case 0:e=a.sendChain;D.next=3;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveMsgKey(e.nextMsgIndex,e.chainKey));case 3:f=D.sent;g=f[0];h=f[1];D.next=8;return b("regeneratorRuntime").awrap(w(h));case 8:i=D.sent;j=i.cipherKey;k=i.macKey;D.next=13;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:h.iv},j,c));case 13:l=D.sent;n=new(d("WABinary").Binary)();n.writeByteArray(a.local.pubKey);n.writeByteArray(a.remote.pubKey);o=n.size();n.writeUint8(t(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,{ratchetKey:e.ratchetKey.serializedPubKey,counter:h.index,previousCounter:a.prevSendChainHighestIndex,ciphertext:l},n);p=n.readByteArray();D.next=23;return b("regeneratorRuntime").awrap(v(k,p));case 23:q=D.sent;r=p.subarray(o);s=d("WABinary").Binary.build(r,new Uint8Array(q,0,m)).readByteArray();y=a.initialExchangeInfo;y!=null?(A=new(d("WABinary").Binary)(),A.writeUint8(t(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION)),d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,{registrationId:a.local.regId,preKeyId:(z=y.remoteOneTimeId)!=null?z:void 0,signedPreKeyId:y.remoteSignedId,baseKey:y.localOneTimePubKey,identityKey:a.local.pubKey,message:s},A),u="pkmsg",x=A.readByteArray()):(u="msg",x=s);B=d("WASignalSessions").makeSendChain(e.ratchetKey,h.index+1,g);C=d("WASignalSessions").updateChains(a,a.recvChains,B);return D.abrupt("return",[C,{type:u,ciphertext:x}]);case 31:case"end":return D.stop()}},null,this)}function c(a,c){var e,f,g,h,i,j,k,l,m,n,o,p,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:if(!(a==null)){t.next=2;break}return t.abrupt("return",d("WAResultOrError").makeError("errSignalNoSession"));case 2:t.next=4;return b("regeneratorRuntime").awrap(q(a,c));case 4:e=t.sent;if(!e.success){t.next=10;break}f=e.value,g=f[0],h=f[1];return t.abrupt("return",d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:g,plaintext:h}));case 10:i=a.prevSessions,j=e,k=0;case 13:if(!(!j.success&&k<i.length)){t.next=22;break}l=d("WASignalSessions").parseSession(i[k]);t.next=17;return b("regeneratorRuntime").awrap(q(l,c));case 17:m=t.sent,m.success&&((n=m.value,o=n[0],p=n[1]),r=d("WASignalSessions").setPrevSessions(o,[d("WASignalSessions").detachSession(a)].concat(i.slice(0,k),i.slice(k+1))),s=!a||!d("WACryptoUtils").serializedPubKeysEqual(r.remote.pubKey,a.remote.pubKey)?r.remote.pubKey:null,j=d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:s,baseSession:l,usedPreKey:null},updatedSession:r,plaintext:p}));case 19:k++;t.next=13;break;case 22:return t.abrupt("return",j);case 23:case"end":return t.stop()}},null,this)}function e(a,b){if(x(a,b))return a;var c=a.prevSessions;for(var e=0;e<c.length;e++){var f=d("WASignalSessions").parseSession(c[e]);if(x(f,b))return d("WASignalSessions").setPrevSessions(f,[d("WASignalSessions").detachSession(a)].concat(c.slice(0,e),c.slice(e+1)))}return null}function f(a,c,e,f){var g,h,i,j,k,m,n,o,p,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:h=f.localSignedPreKey;if(!(h==null)){u.next=3;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidSignedPreKey"));case 3:i=d("WASignalSignatures").deserializeSignedPreKey(h);if(!(i==null)){u.next=6;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalSignedPreKeyDeserialization"));case 6:if(!(i.id!==e.localSignedPreKeyId)){u.next=8;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalSignedPreKeyIdMismatch"));case 8:j=null;if(!(e.localOneTimeKeyId!=null)){u.next=18;break}k=f.localOneTimeKey;if(!(k==null)){u.next=13;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidOneTimeKey"));case 13:j=d("WASignalKeys").deserializePreKey(k);if(!(j==null)){u.next=16;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalOneTimeKeyDeserialization"));case 16:if(!(j.id!==e.localOneTimeKeyId)){u.next=18;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalOneTimeKeyMismatch"));case 18:u.next=20;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSessionIncoming(a,e.remote,e.sessionBaseKey,{signed:i.keyPair,oneTime:(g=j)==null?void 0:g.keyPair,ratchet:d("WASignalKeys").toSerializedKeyPair(i.keyPair)}));case 20:m=u.sent;n=m.remote.pubKey;o=!c||!d("WACryptoUtils").serializedPubKeysEqual(n,c.remote.pubKey)?n:null;c&&!o&&(m=d("WASignalSessions").setPrevSessions(m,[d("WASignalSessions").detachSession(c)].concat(c.prevSessions.slice(0,l-1))));u.next=26;return b("regeneratorRuntime").awrap(q(m,e));case 26:p=u.sent;if(p.success){u.next=29;break}return u.abrupt("return",p);case 29:r=p.value,s=r[0],t=r[1];return u.abrupt("return",d("WAResultOrError").makeResult({newIdentity:o,baseSession:m,updatedSession:s,plaintext:t}));case 31:case"end":return u.stop()}},null,this)}function o(a){var b,c,e=null;try{var f=s(a,d("WASignalSessions").FORMAT_VERSION,m);if(!f.success)return f;f=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,f.value);var g=f.ratchetKey;e=f.counter;c=f.ciphertext;if(g==null||e==null||c==null)return d("WAResultOrError").makeError("errSignalDeserializeInvalidProtoFormat");b=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(g))}catch(a){d("WALogger").DEV(k(),a);return d("WAResultOrError").makeError("errSignalDeserializeRatchetKeyBadFormat")}f={ratchetPubKey:b,counter:e,ciphertext:new Uint8Array(c),versionContentMac:a};return d("WAResultOrError").makeResult(f)}function p(a){a=s(a,d("WASignalSessions").FORMAT_VERSION,0);if(!a.success)return a;var b,c,e,f,g;try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,a.value);var h=a.registrationId,i=a.preKeyId,k=a.signedPreKeyId,l=a.baseKey,m=a.identityKey;a=a.message;if(h==null||k==null||l==null||m==null||a==null)return d("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");f=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(l));b={regId:d("WASignalOther").castRegistrationId(h),pubKey:d("WASignalKeys").castToSerializedPubKey(new Uint8Array(m))};e=i!=null?d("WASignalKeys").castToPreKeyId(i):null;c=d("WASignalKeys").castToSignedPreKeyId(k);g=new Uint8Array(a)}catch(a){d("WALogger").DEV(j(),a);return d("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}l=o(g);return!l.success?l:d("WAResultOrError").makeResult(babelHelpers["extends"]({},l.value,{remote:b,sessionBaseKey:f,localSignedPreKeyId:c,localOneTimeKeyId:e}))}function q(a,c){var e,f,g,h,j,k,l,n,o,p,q,s,t,u,x,y,z,A,B,C,D,E,F,G,H,I;return b("regeneratorRuntime").async(function(J){while(1)switch(J.prev=J.next){case 0:e=c.ratchetPubKey,f=c.counter,g=c.ciphertext,h=c.versionContentMac;j=a.recvChains;k=a.recvChains.findIndex(function(a){return d("WACryptoUtils").serializedPubKeysEqual(a.ratchetPubKey,e)});if(!(k===-1)){J.next=24;break}J.next=6;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").calculateRatchet(a.rootKey,a.sendChain.ratchetKey,e));case 6:o=J.sent;p=d("WASignalSessions").makeFreshRecvChain(e,o.chainKey);J.next=10;return b("regeneratorRuntime").awrap(r(p,f));case 10:q=J.sent;if(q.success){J.next=13;break}return J.abrupt("return",q);case 13:s=q.value;t=d("WASignalKeys").makeSerializedKeyPair();J.next=17;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").calculateRatchet(o.rootKey,t,e));case 17:u=J.sent;x=j.slice(-4);x.push(s.updatedChain);n=s.msgKey;l=d("WASignalSessions").ratchetSession(a,x,d("WASignalSessions").makeFreshSendChain(t,u.chainKey),u.rootKey);J.next=34;break;case 24:J.next=26;return b("regeneratorRuntime").awrap(r(j[k],f));case 26:y=J.sent;if(y.success){J.next=29;break}return J.abrupt("return",y);case 29:z=y.value,A=j.slice(),A[k]=z.updatedChain,n=z.msgKey,l=d("WASignalSessions").updateChains(a,A,a.sendChain);case 34:J.next=36;return b("regeneratorRuntime").awrap(w(n));case 36:B=J.sent;C=B.cipherKey;D=B.macKey;E=d("WABinary").Binary.build(a.remote.pubKey,a.local.pubKey,h.subarray(0,-m)).readByteArray();J.next=42;return b("regeneratorRuntime").awrap(v(D,E));case 42:F=J.sent;G=h.subarray(-m);H=!d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(F,0,m),G);I=null;J.prev=46;J.next=49;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:n.iv},C,g));case 49:I=J.sent;J.next=55;break;case 52:J.prev=52,J.t0=J["catch"](46),d("WALogger").DEV(i(),J.t0);case 55:if(!(H&&I==null)){J.next=59;break}if(!(k===-1)){J.next=58;break}return J.abrupt("return",d("WAResultOrError").makeError("errInvalidMacInvalidCipherKeyNewChain"));case 58:return J.abrupt("return",d("WAResultOrError").makeError("errInvalidMacInvalidCipherKey"));case 59:if(!H){J.next=61;break}return J.abrupt("return",d("WAResultOrError").makeError("errInvalidMacWithDecryptedPlaintext"));case 61:if(!(I==null)){J.next=63;break}return J.abrupt("return",d("WAResultOrError").makeError("errUnknownInvalidCipherKey"));case 63:return J.abrupt("return",d("WAResultOrError").makeResult([l,I]));case 64:case"end":return J.stop()}},null,this,[[46,52]])}function r(a,c){var e,f,g,h,i,j,k,l,m,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:e=c-a.nextMsgIndex;f=d("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(!(e>f)){r.next=4;break}return r.abrupt("return",d("WAResultOrError").makeError("errSignalTooManyMessagesInFuture"));case 4:g=a.unusedMsgKeys;if(!(e<0)){r.next=10;break}h=g.findIndex(function(a){return a.index===c});if(!(h===-1)){r.next=9;break}return r.abrupt("return",d("WAResultOrError").makeError("errDuplicateMsg"));case 9:return r.abrupt("return",d("WAResultOrError").makeResult({msgKey:g[h],updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,a.nextMsgIndex,a.chainKey,u(g,h))}));case 10:i=a.nextMsgIndex;r.next=13;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveMsgKey(i,a.chainKey));case 13:j=r.sent;k=j[0];l=j[1];m=null;if(!(e>0)){r.next=31;break}o=e+g.length-n;o>0?(m=g.slice(o),o-=g.length):m=g.slice();p=i+1;case 21:if(!(p<=c)){r.next=31;break}o>0?o--:m.push(l);r.next=25;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveMsgKey(p,k));case 25:q=r.sent,k=q[0],l=q[1];case 28:p++;r.next=21;break;case 31:return r.abrupt("return",d("WAResultOrError").makeResult({msgKey:l,updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,c+1,k,m||g)}));case 32:case"end":return r.stop()}},null,this)}function s(a,b,c){if(a.length<1)return d("WAResultOrError").makeError("errSignalEmptyVersionContentSuffix");var e=a[0]>>>4;if(e!==b)return e<b?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");e=a.length-c;return e<1?d("WAResultOrError").makeError("errSignalContentExceededExpectedLength"):d("WAResultOrError").makeResult(a.subarray(1,e))}function t(a,b){return(a<<4|b)&255}function u(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}function v(a,b){return d("WACryptoDependencies").getCrypto().subtle.sign(d("WASignalOther").HMAC_SHA256,a,b)}function w(a){return(h||(h=b("Promise"))).all([d("WASignalOther").makeCryptoKey(a.cipherKey,"aes-cbc"),d("WASignalOther").makeCryptoKey(a.macKey,"hmac-sha256")]).then(function(a){var b=a[0];a=a[1];return{cipherKey:b,macKey:a}})}function x(a,b){a=a.aliceBaseKey;return!a?!1:d("WACryptoUtils").serializedPubKeysEqual(a,b)}g.MAX_UNUSED_KEYS=n;g.encryptMsg=a;g.decryptMsg=c;g.findMatchingSession=e;g.decryptPkMsgWithNewSession=f;g.deserializeMsg=o;g.deserializePkMsg=p;g.decryptMsgFromSession=q;g.readContent=s;g.versionByte=t}),98);
__d("WASignalGroupCipher",["WABinary","WACryptoDependencies","WACryptoLibraryConfig","WALogger","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","decodeProtobuf","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Exception caught during SenderKeyMessageSpec Proto: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeSenderKeyDistributionMsg error ",""]);i=function(){return a};return a}var j=64;function a(a,c){var e,f,g,h,i,j,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:e=k(a);if(e.success){m.next=3;break}return m.abrupt("return",e);case 3:f=e.value,g=f.senderKeyId,h=f.iteration,i=f.signingKeyPublic,j=f.chainKey;m.next=6;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSenderKeySessionIncoming(g,h,i,j,c));case 6:l=m.sent;return m.abrupt("return",d("WAResultOrError").makeResult(l));case 8:case"end":return m.stop()}},null,this)}function c(a){a=d("WASignalGroupSession").serializeSenderKeyState(a);var b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,{id:a.senderKeyId,iteration:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").iteration,chainKey:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").seed,signingKey:d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey")["public"]},b);return b.readByteArray()}function e(a,c){var e,f,g,h,i,j,k,l,n,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:if(!(!a.senderKeyStates||a.senderKeyStates.length===0)){u.next=2;break}return u.abrupt("return",d("WAResultOrError").makeError("errSignalNoSession"));case 2:e=a.senderKeyStates[a.senderKeyStates.length-1];u.next=5;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveSenderKeyMsgKey(e.senderKeyChainKey.nextMsgIndex,e.senderKeyChainKey.chainKey));case 5:f=u.sent;g=f[0];h=f[1];u.next=10;return b("regeneratorRuntime").awrap(m(h.seed));case 10:i=u.sent;j=i[0];k=i[1];u.next=15;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:k},j,c));case 15:l=u.sent;n=new(d("WABinary").Binary)();d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,{id:e.senderKeyId,iteration:h.iteration,ciphertext:l},n);o=new(d("WABinary").Binary)();o.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));o.writeBinary(n);p=d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalSessions").definedOrThrow(e.senderSigningKeyPrivate,"senderSigningKeyPrivate"),e.senderSigningKeyPublic);q=d("WASignalSignatures").signSenderKeyMessage(p,o.readByteArray());r=new(d("WABinary").Binary)();r.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));r.writeBinary(n);r.writeByteArray(q);s=d("WASignalGroupSession").makeSenderKeyChainKey(h.iteration+1,g);t=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,d("WASignalGroupSession").makeSenderKeyState(e.senderSigningKeyPublic,e.senderSigningKeyPrivate,s,e.senderKeyId,e.unusedMsgKeys));return u.abrupt("return",d("WAResultOrError").makeResult([t,r.readByteArray()]));case 30:case"end":return u.stop()}},null,this)}function f(a,c){var e,f,g,h,i,j,k,l,p,q,r,s,t,u,v;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:e=c.senderKeyMessageId,f=c.iteration,g=c.ciphertext,h=c.versionContentMac;i=d("WASignalGroupSession").findSenderKeyState(a,e);if(!(i==null)){w.next=4;break}return w.abrupt("return",d("WAResultOrError").makeError("errSignalNoSession"));case 4:j=i.senderSigningKeyPublic;k=n(h,j);if(k){w.next=8;break}return w.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidKey"));case 8:w.next=10;return b("regeneratorRuntime").awrap(o(i,f));case 10:l=w.sent;if(l.success){w.next=13;break}return w.abrupt("return",l);case 13:p=l.value;q=p.msgKey;r=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,p.updatedSenderKeyState);w.next=18;return b("regeneratorRuntime").awrap(m(q.seed));case 18:s=w.sent;t=s[0];u=s[1];w.next=23;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:u},t,g));case 23:v=w.sent;return w.abrupt("return",d("WAResultOrError").makeResult([r,v]));case 25:case"end":return w.stop()}},null,this)}function k(a){var b,c,e,f;try{a=d("WASignalCipher").readContent(a,d("WASignalGroupSession").FORMAT_VERSION,0);if(!a.success)return a;a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,a.value);b=a.id;c=a.iteration;var g=d("WASignalSessions").bytesOrThrow(a.signingKey,33,"signingKey");e=d("WASignalKeys").castToSerializedPubKey(g);f=d("WASignalSessions").bytesOrThrow(a.chainKey,32,"chainKey");if(b==null||c==null)return d("WAResultOrError").makeError("errSignalGrpInvalidProtoFormat")}catch(a){d("WALogger").DEV(i(),a);return d("WAResultOrError").makeError("errSignalGrpInvalidKeyFormat")}return d("WAResultOrError").makeResult({senderKeyId:b,iteration:c,signingKeyPublic:e,chainKey:f})}function l(a){if(a.length<1)return d("WAResultOrError").makeError("errSignalGrpVersionContentEmpty");var b=a[0]>>>4;if(b!==d("WASignalGroupSession").FORMAT_VERSION)return b<d("WASignalGroupSession").FORMAT_VERSION?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");if(a.length<1+j)return d("WAResultOrError").makeError("errSignalGrpInvalidVersionContentLength");var c,e,f;try{b=a.subarray(1,-j);b=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,b);c=b.id;e=b.iteration;f=b.ciphertext;if(c==null||e==null||f==null)return d("WAResultOrError").makeError("errSignalGrpSenderKeyInvalidProtoFormat")}catch(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("errSignalGrpSenderKeyProtoError")}return d("WAResultOrError").makeResult({senderKeyMessageId:c,iteration:e,ciphertext:new Uint8Array(f),versionContentMac:a})}function m(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=new(d("WABinary").Binary)(a);e=d("WASignalOther").readBytes(c,16);f=d("WASignalOther").readBytes(c,32);g.next=5;return b("regeneratorRuntime").awrap(d("WASignalOther").makeCryptoKey(f,"aes-cbc"));case 5:g.t0=g.sent;g.t1=e;return g.abrupt("return",[g.t0,g.t1]);case 8:case"end":return g.stop()}},null,this)}function n(a,b){var c=a.subarray(a.length-j);a=a.subarray(0,a.length-j);return d("WASignalSignatures").verifyMsgSignalVariant(b,a,d("WASignalOther").toBytes(d("WASignalOther").toBuffer(c),64))}function o(a,c){var e,f,g,h,i,j,k,l,m,n,o,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:e=a;f=c-e.senderKeyChainKey.nextMsgIndex;g=d("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(!(f>g)){s.next=5;break}return s.abrupt("return",d("WAResultOrError").makeError("errSignalGrpTooManyMessagesInFuture"));case 5:h=a.unusedMsgKeys||[];if(!(f<0)){s.next=11;break}i=h.findIndex(function(a){return a.iteration===c});if(!(i===-1)){s.next=10;break}return s.abrupt("return",d("WAResultOrError").makeError("errDuplicateMsg"));case 10:return s.abrupt("return",d("WAResultOrError").makeResult({msgKey:h[i],updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(e.senderSigningKeyPublic,e.senderSigningKeyPrivate,e.senderKeyChainKey,e.senderKeyId,p(h,i))}));case 11:j=e.senderKeyChainKey.nextMsgIndex;s.next=14;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveSenderKeyMsgKey(j,e.senderKeyChainKey.chainKey));case 14:k=s.sent;l=k[0];m=k[1];n=null;if(!(f>0)){s.next=32;break}o=f+h.length-d("WASignalCipher").MAX_UNUSED_KEYS;o>0?(n=h.slice(o),o-=h.length):n=h.slice();q=j+1;case 22:if(!(q<=c)){s.next=32;break}o>0?o--:n.push(m);s.next=26;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").deriveSenderKeyMsgKey(q,l));case 26:r=s.sent,l=r[0],m=r[1];case 29:q++;s.next=22;break;case 32:return s.abrupt("return",d("WAResultOrError").makeResult({msgKey:m,updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(e.senderSigningKeyPublic,e.senderSigningKeyPrivate,d("WASignalGroupSession").makeSenderKeyChainKey(c+1,l),a.senderKeyId,n||h)}));case 33:case"end":return s.stop()}},null,this)}function p(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}g.processSenderKeyDistributionMsg=a;g.createSenderKeyDistributionProto=c;g.encryptSenderKeyMsgWithSession=e;g.decryptSenderKeyMsgFromSession=f;g.deserializeSenderKeyMsg=l}),98);
__d("WACryptoLibrary",["WACryptoUtils","WAJids","WALockMap","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSignatures","WASignalWhitepaper","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSessionForRecipient pkmsg signature verification result: ",""]);h=function(){return a};return a}var i=d("WALockMap").makeLockMap(60*1e3),j=[],k=300;function l(a){j.push(a),j.length>=k&&j.shift()}function a(a){a(j),j=[]}function m(a,c){var e,f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:l("createOutgoingSession");e=t(c);f=e.signedKey;j.next=5;return b("regeneratorRuntime").awrap(d("WASignalSignatures").verifyMsgSignalVariant(e.identity,f.publicKey,f.signature));case 5:g=j.sent;d("WALogger").DEV(h(),g);if(g){j.next=10;break}l("createOutgoingSession: errSignalInvalidKey");return j.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidKey"));case 10:j.next=12;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSessionOutgoing(a,e,d("WASignalKeys").makeKeyPair()));case 12:i=j.sent;return j.abrupt("return",d("WAResultOrError").makeResult(i));case 14:case"end":return j.stop()}},null,this)}function c(a,c,d,e,f){var g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:g=a.handleNewSession;l("establishOutgoingSession");j.next=4;return b("regeneratorRuntime").awrap(m(c,e));case 4:h=j.sent;if(h.success){j.next=7;break}return j.abrupt("return",h);case 7:i=h.value;return j.abrupt("return",g(d,i,i.remote.pubKey,null,f));case 9:case"end":return j.stop()}},null,this)}function e(a,c,e,f){var g=a.loadSession,h=a.handleNewSession;l("encryptContent");return i.lock([d("WAJids").extractUserJid(c)],function(){var a,i,j,k,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:a=null;case 1:o.next=3;return b("regeneratorRuntime").awrap(g(c,"cryptoLibraryEncryptContent"));case 3:i=o.sent;if(!(i==null)){o.next=7;break}l("encryptContent: errSignalInvalidKey");return o.abrupt("return",d("WAResultOrError").makeError("errSignalInvalidKey"));case 7:if(!(f!=null&&!d("WACryptoUtils").uint8ArraysEqual(f,i.remote.pubKey))){o.next=10;break}l("encryptContent: identity-mismatch");return o.abrupt("return",d("WAResultOrError").makeError("identity-mismatch"));case 10:o.next=12;return b("regeneratorRuntime").awrap(d("WASignalCipher").encryptMsg(i,e));case 12:j=o.sent;k=j[0];m=j[1];o.next=17;return b("regeneratorRuntime").awrap(h(c,k,k.remote.pubKey));case 17:n=o.sent,n.success?a=d("WAResultOrError").makeResult(babelHelpers["extends"]({},m,{baseKey:k.aliceBaseKey})):n.error;case 19:if(a==null){o.next=1;break}case 20:return o.abrupt("return",a);case 21:case"end":return o.stop()}},null,this)})}function f(a,c,e,f,g){var h=a.loadSession,j=a.handleNewSession,k=a.loadSignedPreKey,m=a.loadOneTimePreKey;l("decryptContent");return i.lock([d("WAJids").extractUserJid(e)],function(){var a,i,o,p,q,r,s,t,u,v,w,x;return b("regeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:a=!1;y.next=3;return b("regeneratorRuntime").awrap(h(e,"decryptContent"));case 3:i=y.sent;if(!(f.type==="pkmsg")){y.next=18;break}p=d("WASignalCipher").deserializePkMsg(f.ciphertext);if(p.success){y.next=9;break}l("decryptContent: errCryptoDeserialization");return y.abrupt("return",d("WAResultOrError").makeError("errCryptoDeserialization"));case 9:q=p.value;y.next=12;return b("regeneratorRuntime").awrap(n({loadSignedPreKey:k,loadOneTimePreKey:m},c,q,i));case 12:r=y.sent;if(r.success){y.next=15;break}return y.abrupt("return",r);case 15:o=r.value;y.next=30;break;case 18:f.type;s=d("WASignalCipher").deserializeMsg(f.ciphertext);if(s.success){y.next=23;break}l("decryptContent: errCryptoDeserialization");return y.abrupt("return",d("WAResultOrError").makeError("errCryptoDeserialization"));case 23:t=s.value;y.next=26;return b("regeneratorRuntime").awrap(d("WASignalCipher").decryptMsg(i,t));case 26:u=y.sent;if(u.success){y.next=29;break}return y.abrupt("return",u);case 29:o=u.value;case 30:v=o,w=v.newSessionInfo;if(!(w&&(w.newIdentity!=null||w.usedPreKey!=null))){y.next=34;break}y.next=34;return b("regeneratorRuntime").awrap(j(e,w.baseSession,w.newIdentity,w.usedPreKey));case 34:if(a){y.next=39;break}x=w==null?void 0:w.baseSession.remote.pubKey;y.next=38;return b("regeneratorRuntime").awrap(g(new Uint8Array(o.plaintext),x));case 38:a=!0;case 39:y.next=41;return b("regeneratorRuntime").awrap(j(e,o.updatedSession,o.updatedSession.remote.pubKey));case 41:return y.abrupt("return",d("WAResultOrError").makeResult());case 42:case"end":return y.stop()}},null,this)})}function n(a,c,e,f){var g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:g=a.loadSignedPreKey,h=a.loadOneTimePreKey;l("decryptPkMsg");i=f&&d("WASignalCipher").findMatchingSession(f,e.sessionBaseKey);if(!i){x.next=13;break}x.next=6;return b("regeneratorRuntime").awrap(d("WASignalCipher").decryptMsgFromSession(i,e));case 6:j=x.sent;if(j.success){x.next=9;break}return x.abrupt("return",j);case 9:k=j.value,m=k[0],n=k[1];return x.abrupt("return",d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:m,plaintext:n}));case 13:o=e.localOneTimeKeyId;x.next=16;return b("regeneratorRuntime").awrap(g(e.localSignedPreKeyId));case 16:p=x.sent;if(!(o==null)){x.next=21;break}x.t0=null;x.next=24;break;case 21:x.next=23;return b("regeneratorRuntime").awrap(h(o));case 23:x.t0=x.sent;case 24:q=x.t0;x.next=27;return b("regeneratorRuntime").awrap(d("WASignalCipher").decryptPkMsgWithNewSession(c,f,e,{localSignedPreKey:p,localOneTimeKey:q}));case 27:r=x.sent;if(r.success){x.next=30;break}return x.abrupt("return",r);case 30:s=r.value,t=s.newIdentity,u=s.baseSession,v=s.updatedSession,w=s.plaintext;return x.abrupt("return",d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:t,baseSession:u,usedPreKey:o},updatedSession:v,plaintext:w}));case 32:case"end":return x.stop()}},null,this)}function o(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;l("encryptGroupContent");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,i,j,k,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:c=null;case 1:q.next=3;return b("regeneratorRuntime").awrap(h(e,f));case 3:i=q.sent;if(i.success){q.next=6;break}return q.abrupt("return",d("WAResultOrError").makeError(i.error));case 6:j=i.value;q.next=9;return b("regeneratorRuntime").awrap(d("WASignalGroupCipher").encryptSenderKeyMsgWithSession(j,g));case 9:k=q.sent;if(!k.success){q.next=18;break}m=k.value,n=m[0],o=m[1];q.next=14;return b("regeneratorRuntime").awrap(a(e,f,n));case 14:p=j.senderKeyStates[j.senderKeyStates.length-1];c=d("WAResultOrError").makeResult({ciphertext:{ciphertext:o,type:"skmsg"},senderKeyId:p.senderKeyId,senderKeyDistributionProto:d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(p))});q.next=20;break;case 18:l("encryptGroupContent: sender-key-no-session");return q.abrupt("return",d("WAResultOrError").makeError("sender-key-no-session"));case 20:if(c==null){q.next=1;break}case 21:return q.abrupt("return",c);case 22:case"end":return q.stop()}},null,this)})}function p(c,e,f,g,h){var j=c.loadSenderKeySession,a=c.saveSenderKeySession;l("decryptGroupContent");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,i,k,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:c=!1;r.next=3;return b("regeneratorRuntime").awrap(j(e,f));case 3:i=r.sent;if(i.success){r.next=6;break}return r.abrupt("return",d("WAResultOrError").makeError(i.error));case 6:k=d("WASignalGroupCipher").deserializeSenderKeyMsg(g);if(k.success){r.next=10;break}l("decryptGroupContent: errCryptoDeserialization");return r.abrupt("return",d("WAResultOrError").makeError("errCryptoDeserialization"));case 10:m=i.value;r.next=13;return b("regeneratorRuntime").awrap(d("WASignalGroupCipher").decryptSenderKeyMsgFromSession(m,k.value));case 13:n=r.sent;if(n.success){r.next=16;break}return r.abrupt("return",n);case 16:o=n.value,p=o[0],q=o[1];if(c){r.next=21;break}r.next=20;return b("regeneratorRuntime").awrap(h(new Uint8Array(q)));case 20:c=!0;case 21:r.next=23;return b("regeneratorRuntime").awrap(a(e,f,p));case 23:return r.abrupt("return",d("WAResultOrError").makeResult());case 24:case"end":return r.stop()}},null,this)})}function q(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;l("saveSenderKeySession");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=null;if(!h){l.next=6;break}l.next=4;return b("regeneratorRuntime").awrap(h(e,f));case 4:i=l.sent,c=i.success?i.value:null;case 6:l.next=8;return b("regeneratorRuntime").awrap(d("WASignalGroupCipher").processSenderKeyDistributionMsg(g,c));case 8:j=l.sent;if(j.success){l.next=11;break}return l.abrupt("return",j);case 11:k=j.value;l.next=14;return b("regeneratorRuntime").awrap(a(e,f,k));case 14:return l.abrupt("return",d("WAResultOrError").makeResult());case 15:case"end":return l.stop()}},null,this)})}function r(c,e,f,g){var a=c.saveSenderKeySession;l("rotateGroupSenderKey");return i.lock([e,d("WAJids").extractUserJid(f)],function(){var c,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(d("WASignalWhitepaper").initiateSenderKeySessionOutgoing(g));case 2:c=i.sent;h=c.senderKeyStates[0].senderKeyId;i.next=6;return b("regeneratorRuntime").awrap(a(e,f,c));case 6:return i.abrupt("return",{senderKeyId:h});case 7:case"end":return i.stop()}},null,this)})}function s(c,e,f){var g,a,h,i,j,k;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:g=c.loadSenderKeySession,a=c.saveSenderKeySession;l("createSenderKeyDistributionMsg");m.next=4;return b("regeneratorRuntime").awrap(g(e,f));case 4:h=m.sent;i=h.error;if(!(!h.success&&i==="errLoadSenderKeySession")){m.next=15;break}m.next=9;return b("regeneratorRuntime").awrap(d("WASignalKeys").makeKeyPair());case 9:j=m.sent;m.next=12;return b("regeneratorRuntime").awrap(r({saveSenderKeySession:a},e,f,j));case 12:m.next=14;return b("regeneratorRuntime").awrap(g(e,f));case 14:h=m.sent;case 15:if(!h.success){m.next=19;break}k=h.value.senderKeyStates.slice(-1);if(!(k.length>0)){m.next=19;break}return m.abrupt("return",d("WAResultOrError").makeResult(d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(k[0]))));case 19:l("createSenderKeyDistributionMsg: errGetSenderKeyProto");return m.abrupt("return",d("WAResultOrError").makeError("errGetSenderKeyProto"));case 21:case"end":return m.stop()}},null,this)}function t(a){var b=a.regId,c=a.identity,e=a.signedKey;a=a.oneTimeKey;l("sanitizeInitialSessionInfo");var f=d("WASignalKeys").castToSerializedPubKey(e.publicKey);return{regId:d("WASignalOther").castRegistrationId(b),identity:d("WASignalKeys").castToSerializedPubKey(c),signedKey:{id:d("WASignalKeys").castToSignedPreKeyId(e.id),publicKey:f,signature:d("WASignalOther").ensureSize(e.signature,64)},oneTimeKey:a&&{id:d("WASignalKeys").castToPreKeyId(a.id),publicKey:d("WASignalKeys").castToSerializedPubKey(a.publicKey)},ratchetKey:f}}g.publishLogs=a;g.createOutgoingSession=m;g.establishOutgoingSession=c;g.encryptContent=e;g.decryptContent=f;g.encryptGroupContent=o;g.decryptGroupContent=p;g.saveSenderKeySession=q;g.rotateGroupSenderKey=r;g.createSenderKeyDistributionMsg=s}),98);
__d("WALoggerTag",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["CryptoManager","MediaPreview","PrekeyGenerateAndUpload","SignedPrekey","SignedPrekeyRotation","OneTimePrekey"]);c=a;f["default"]=c}),66);
__d("WACryptoManager",["Promise","WABridge","WACryptoLibrary","WACryptoUtils","WAErr","WAGlobals","WAJids","WALogger","WALoggerTag","WANullthrows","WAOdsEnums","WAPromiseQueue","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WASignalSessions","WASignalSignatures","WATagsLogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey with id: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] start encryption"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] sendWrittenMsg bulkEncryptContent"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Failed to create a session"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Received keys ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Removing session "," due to ratchet key"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] fail during key requesting"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Missing sessions: ",". Requesting keys"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] No need to establish outgoing sessions"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Establish outgoing sessions"]);t=function(){return a};return a}var u=d("WATagsLogger").TAGS([c("WALoggerTag").CryptoManager]),v={type:"default"};function a(a){return{flush:function(){return a.storage.savePendingToDatabase().then(function(){})}}}function e(a){return{regInfo:a.regInfo,network:a.network,storage:a.storage}}function w(a,c,e,f,g){var h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(f(c,g));case 2:h=m.sent;if(!(h!=null&&e.type!=="requestNewSession")){m.next=13;break}i=h;if(!(e.type==="default")){m.next=9;break}return m.abrupt("return",d("WAResultOrError").makeResult(i));case 9:if(!(i.aliceBaseKey!=null&&e.session.baseKey!=null)){m.next=13;break}e.type;if(d("WACryptoUtils").uint8ArraysEqual(e.session.baseKey,i.aliceBaseKey)){m.next=13;break}return m.abrupt("return",d("WAResultOrError").makeResult(i));case 13:if(!(e.type==="useSession")){m.next=17;break}j=e.session.keys;m.next=25;break;case 17:e.type;m.next=20;return b("regeneratorRuntime").awrap(a.network.requestKeys(c));case 20:k=m.sent;if(k.success){m.next=23;break}return m.abrupt("return",k);case 23:j=k.value.keys,e.type==="compareTSAndUseSession"&&e.session.timestamp>=k.value.timestamp&&(j=e.session.keys);case 25:m.next=27;return b("regeneratorRuntime").awrap(d("WACryptoLibrary").createOutgoingSession(a.regInfo,j));case 27:l=m.sent;if(l.success){m.next=30;break}return m.abrupt("return",l);case 30:return m.abrupt("return",d("WAResultOrError").makeResult(l.value));case 31:case"end":return m.stop()}},null,this)}function f(a,b,c,e){return d("WACryptoLibrary").establishOutgoingSession({handleNewSession:a.storage.handleNewSession},a.regInfo,b,c,e)}function x(a,c){var e,f,g,h,i,j,k,l,m,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:d("WALogger").DEV(t());x.next=3;return b("regeneratorRuntime").awrap(a.storage.loadSessions(c));case 3:e=x.sent;f=c.filter(function(a){return!e.has(a)});if(!(f.length===0)){x.next=8;break}d("WALogger").DEV(s());return x.abrupt("return",e);case 8:d("WALogger").DEV(r(),f.length);x.next=11;return b("regeneratorRuntime").awrap(a.network.bulkRequestKeys(f));case 11:g=x.sent;if(g.success){x.next=15;break}d("WALogger").ERROR(q());return x.abrupt("return",e);case 15:if(!d("WAGlobals").getConfig().useLongSessionDrop()){x.next=33;break}h=e.entries(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 17:if(!i){x.next=23;break}if(!(j>=h.length)){x.next=20;break}return x.abrupt("break",33);case 20:k=h[j++];x.next=27;break;case 23:j=h.next();if(!j.done){x.next=26;break}return x.abrupt("break",33);case 26:k=j.value;case 27:l=k,m=l[0],u=l[1],u.sendChain.nextMsgIndex>=d("WAGlobals").getConfig().sessionDropIfTooOld()&&(d("WALogger").DEV(p(),m),e["delete"](m),d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WA_LONG_SESSION_DROP,key:"decryption"}));case 31:x.next=17;break;case 33:v=g.value;d("WALogger").DEV(o(),v.size);w=new(d("WAPromiseQueue").PromiseQueue)();v.forEach(function(c,b){w.enqueue(function(){return d("WACryptoLibrary").createOutgoingSession(a.regInfo,c.keys).then(function(a){a.success===!1?d("WALogger").ERROR(n()):e.set(b,a.value)})})});x.next=39;return b("regeneratorRuntime").awrap(w.wait());case 39:return x.abrupt("return",e);case 40:case"end":return x.stop()}},null,this)}function y(a,e){var f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:f=Array.from(e.keys());d("WALogger").LOG(m());j.next=4;return b("regeneratorRuntime").awrap(x(a,f));case 4:g=j.sent;i=new Map();d("WALogger").DEV(l());return j.abrupt("return",(h||(h=b("Promise"))).all(Array.from(g.entries()).map(function(f){var g,h,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:h=f[0],j=f[1];n.next=3;return b("regeneratorRuntime").awrap(d("WASignalCipher").encryptMsg(j,c("WANullthrows")((g=e.get(h))==null?void 0:g.plaintext)));case 3:k=n.sent;l=k[0];m=k[1];i.set(h,babelHelpers["extends"]({},m,{baseKey:null}));return n.abrupt("return",a.storage.handleNewSession(h,l,l.remote.pubKey));case 8:case"end":return n.stop()}},null,this)})).then(function(){return d("WAResultOrError").makeResult(i)}));case 8:case"end":return j.stop()}},null,this)}function z(a,b,c,e,f){return d("WACryptoLibrary").encryptContent({loadSession:function(b){return w(a,b,e,a.storage.loadSession,"cryptoManagerEncryptContent").then(function(a){if(a.success===!0)return a.value;else return null})},handleNewSession:a.storage.handleNewSession},b,c,f)}function A(a,b,c,e){return d("WACryptoLibrary").decryptContent({loadSession:a.storage.loadSession,handleNewSession:a.storage.handleNewSession,loadSignedPreKey:a.storage.loadSignedPreKey,loadOneTimePreKey:a.storage.loadOneTimePreKey},a.regInfo,b,c,e)}function B(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(a.storage.loadSession(c,"getParticipantInfo"));case 2:d=e.sent;return e.abrupt("return",d==null?void 0:d.remote);case 4:case"end":return e.stop()}},null,this)}function C(a){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:k.next=2;return b("regeneratorRuntime").awrap(a.storage.getLastPreKeyGenerationId());case 2:g=k.sent;h=((e=g==null?void 0:g.lastPreKeyId)!=null?e:0)+1;i=d("WASignalKeys").makePreKeys(h,1)[0];k.next=7;return b("regeneratorRuntime").awrap(a.storage.saveOneTimePreKey({keyId:i.plainObject.id,encoded:i.record}));case 7:j=k.sent;if(!j.success){k.next=10;break}return k.abrupt("return",i.plainObject);case 10:throw c("WAErr")("Cannot save one time prekey: "+j.error+", LastPreKeyId: "+((f=g==null?void 0:g.lastPreKeyId)!=null?f:0));case 11:case"end":return k.stop()}},null,this)}function D(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c===void 0&&(c=d("WAGlobals").getConfig().maxPrekeysToUpload());h.next=3;return b("regeneratorRuntime").awrap(a.storage.getLastPreKeyGenerationId());case 3:f=h.sent;g=d("WASignalKeys").makePreKeys(((e=f==null?void 0:f.lastPreKeyId)!=null?e:0)+1,c);return h.abrupt("return",a.storage.savePreKeysGeneration(g.map(function(a){var b=a.plainObject;a=a.record;return{keyId:b.id,encoded:a}})));case 6:case"end":return h.stop()}},null,this)}function E(a){return a.storage.loadLatestSignedPreKey().then(function(b){if(b.success===!1){var e;u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(k(),b==null?void 0:(e=b.payload)==null?void 0:e.toString());throw c("WAErr")("Failed to generate signed prekey: "+((e=b==null?void 0:(e=b.payload)==null?void 0:e.message)!=null?e:""))}e=b.value;e=d("WASignalSignatures").deserializeSignedPreKey(e);if(e==null){u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(j(),b);throw c("WAErr")("failed to deserialize signed prekey")}return F(a,e.id+1)})}function F(a,b){var e=d("WASignalSignatures").makeSignedPreKey(b,d("WATimeUtils").unixTimeMs(),a.regInfo.staticKeyPair);b=d("WASignalSignatures").serializeSignedPreKeyForPrivateStorage(e);return a.storage.saveSignedPreKeyIfNew(e.id,b).then(function(a){if(a.type==="success")return d("WAResultOrError").makeResult(e);else{a.type;return d("WAResultOrError").makeResult(a.key)}}).then(function(a){if(!a.success){var b;u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(i(),a);throw c("WAErr")("Unexpected error when generateSignedPreKeyWithId: "+((b=a==null?void 0:(b=a.payload)==null?void 0:b.message)!=null?b:a.error))}return a.value})}function G(a,b,c,e){return d("WACryptoLibrary").encryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function H(a,b,c,e,f){return d("WACryptoLibrary").decryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e,f)}function I(a,b,c,e){return d("WACryptoLibrary").saveSenderKeySession({loadSenderKeySession:d("WAGlobals").getConfig().useUpdatedSenderKeySession()?a.storage.loadSenderKeySession:void 0,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function J(a,c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(C(a));case 2:f=g.sent;return g.abrupt("return",d("WACryptoLibrary").rotateGroupSenderKey({saveSenderKeySession:a.storage.saveSenderKeySession},c,e,f.keyPair));case 4:case"end":return g.stop()}},null,this)}function K(a){return(h||(h=b("Promise"))).resolve().then(function(){return{regId:d("WASignalOther").makeRegistrationId(a),staticKeyPair:d("WASignalKeys").makeKeyPair(),authKeyPair:d("WASignalKeys").makeKeyPair()}})}function L(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,d("WASignalSessions").serializeSession(a))}function M(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,a,d("WASignalSessions").parseSessionFromRecord)}function N(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,d("WASignalGroupSession").serializeSession(a))}function O(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,a,d("WASignalGroupSession").parseSessionFromRecord)}function P(a){return a}function Q(a,b){return a+"|"+b}function R(a){a=a.split("|");if(a.length!==2)throw c("WAErr")("Incorrect ComplexSenderKey");return{groupId:d("WAJids").unsafeCoerceToGroupJid(a[0]),deviceId:d("WAJids").unsafeCoerceToDeviceJid(a[1])}}g.DEFAULT_SESSION_REQUEST=v;g.cryptoManagerFlushable=a;g.initCryptoManager=e;g.getSessionForRecipient=w;g.establishOutgoingSession=f;g.ensureSessionsExists=x;g.bulkEncryptContent=y;g.encryptContent=z;g.decryptContent=A;g.getParticipantInfo=B;g.generateOneTimePreKey=C;g.generatePreKeys=D;g.generateSignedPreKey=E;g.generateSignedPreKeyWithId=F;g.encryptGroupContent=G;g.decryptGroupContent=H;g.saveSenderKeySession=I;g.rotateGroupSenderKey=J;g.generateRegistrationInfo=K;g.encodeSession=L;g.decodeSession=M;g.encodeSenderKeySession=N;g.decodeSenderKeySession=O;g.castToPreKeyGenerationId=P;g.encodeSenderKey=Q;g.decodeSenderKey=R}),98);
__d("WAGetKeysForUpload",["WALoggerTag","WAResultOrError","WASignalKeys","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS([c("WALoggerTag").PrekeyGenerateAndUpload,c("WALoggerTag").SignedPrekey]);function a(a,b){return a.storage.loadPreKeys(b).then(function(b){var c=b.preKeys;b=b.signedPreKey;var e=[];c.forEach(function(a){a=d("WASignalKeys").deserializePreKey(a);a==null?i.ERROR(h()):e.push(a)});return d("WAResultOrError").makeResult({regInfo:a.regInfo,keyType:d("WASignalKeys").KEY_TYPE,preKeys:e,signedPreKey:b})})}g.getKeysForUpload=a}),98);
__d("WAMakeSignedPreKeyMixin",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)},c={anyElementValue:a.keyPair.publicKey};a=a.signature;return{keyIDMixinArgs:b,keyDataMixinArgs:c,signatureElementValue:a}}g.makeSignedPreKeyMixin=a}),98);
__d("WARetryUtils",[],(function(a,b,c,d,e,f){"use strict";a={algo:{type:"adjust",backoff:{type:"fibonacci",first:1,second:1},toMs:function(a){return(9+a)*1e3}},max:62e4};f.FIBONACCI_BACKOFF=a}),66);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureBadRequestMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureFallbackMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureInternalServerErrorMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"violation");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"reason");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"max");if(!e.success)return e;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"length");return!b.success?b:d("WAResultOrError").makeResult({text:a.value,violationReason:c.value,violationMax:e.value,violationLength:b.value})}g.parseSetVnameFailureNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysVnameFailures",["WAResultOrError","WASmaxInPreKeysSetVnameFailureBadRequestMixin","WASmaxInPreKeysSetVnameFailureFallbackMixin","WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin","WASmaxInPreKeysSetVnameFailureNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin").parseSetVnameFailureNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysSetVnameFailureBadRequestMixin").parseSetVnameFailureBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureBadRequest",value:c.value});var e=d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin").parseSetVnameFailureInternalServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureInternalServerError",value:e.value});var f=d("WASmaxInPreKeysSetVnameFailureFallbackMixin").parseSetVnameFailureFallbackMixin(a);return f.success?d("WAResultOrError").makeResult({name:"SetVnameFailureFallback",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["VnameFailureNotAcceptable","VnameFailureBadRequest","VnameFailureInternalServerError","VnameFailureFallback"],[b,c,e,f])}g.parseVnameFailures=a}),98);
__d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysVnameFailures","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"error");if(!e.success)return e;var f=d("WASmaxParseUtils").attrString(c.value,"text");if(!f.success)return f;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,c.value,"code",207);if(!c.success)return c;var g=d("WASmaxParseUtils").attrIntRange(e.value,"code",400,599);if(!g.success)return g;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysVnameFailures").parseVnameFailures(e.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:f.value,errorCode:c.value,errorErrorCode:g.value},a.value,{errorErrorVnameFailures:b.value}))}g.parseSetResponsePreKeySuccessVnameFailure=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysRequestErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorFallbackClient"],[b,c])}g.parseRequestErrors=a}),98);
__d("WASmaxInPreKeysSetResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseSetResponseRequestError=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[b,c])}g.parseServerErrors=a}),98);
__d("WASmaxInPreKeysSetResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseSetResponseServerError=a}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInPreKeysSetResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetResponseSuccess=a}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientRequestMixin=a}),98);
__d("WASmaxOutPreKeysKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutPreKeysKeyTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("type",null,new Uint8Array([5])));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyTypeMixin=a}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return null;else return a(b)}function b(a,b){if(b==null)return null;else if(b)return a()}function c(a,b){if(b)for(var c=1;c<b.length;c++)if(!d("WADeepEquals").deepEqual(b[c],b[0]))throw new Error("expected all homogeneous children to be equal, but they were not");c=h(a,b,0,Infinity);return c}function e(a,b){return i(a,b,0,Infinity)}function h(a,b,c,d){if(b==null){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}var e=b.length;if(e<c)throw new Error("expected at least "+c+" children, but found "+e);else if(e>d)throw new Error("expected at most "+d+" children, but found "+e);return b.map(function(b){return a(b)})}function i(a,b,c,d){if(b===0){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}if(b<c)throw new Error("expected at least "+c+" children, but found "+b);else if(b>d)throw new Error("expected at most "+d+" children, but found "+b);c=[];for(d=0;d<b;d++)c.push(a());return c}g.OPTIONAL_CHILD=a;g.HAS_OPTIONAL_CHILD=b;g.HOMOGENEOUS_CHILD=c;g.HOMOGENEOUS_CHILD_COUNT=e;g.REPEATED_CHILD=h;g.REPEATED_CHILD_COUNT=i}),98);
__d("WASmaxOutPreKeysKeyIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.idElementValue;a=d("WASmaxJsx").smax("id",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyIDMixin=a}),98);
__d("WASmaxOutPreKeysPreKeyListMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.keyIDMixinArgs;a=a.keyDataMixinArgs;b=d("WASmaxJsx").smax("key",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(d("WASmaxJsx").smax("id",null),b),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("value",null),a));return b}function i(a){a=a.keyArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("list",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,2e4)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePreKeyListListKey=h;g.mergePreKeyListMixin=a}),98);
__d("WASmaxOutPreKeysRegistrationIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.registrationElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("registration",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRegistrationIDMixin=a}),98);
__d("WASmaxOutPreKeysRequestPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.paddingElementValue;a=d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("padding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestPaddingMixin=a}),98);
__d("WASmaxOutPreKeysSignedPreKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.keyIDMixinArgs,e=a.keyDataMixinArgs;a=a.signatureElementValue;c=(b=d("WASmaxJsx")).smax("smax$any",null,b.smax("skey",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(b.smax("id",null),c),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(b.smax("value",null),e),b.smax("signature",null,a)));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSignedPreKeyMixin=a}),98);
__d("WASmaxOutPreKeysVerifiedNameMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.verifiedNameElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("verified_name",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyMixin","WASmaxOutPreKeysKeyTypeMixin","WASmaxOutPreKeysPreKeyListMixin","WASmaxOutPreKeysRegistrationIDMixin","WASmaxOutPreKeysRequestPaddingMixin","WASmaxOutPreKeysSignedPreKeyMixin","WASmaxOutPreKeysVerifiedNameMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.verifiedNameMixinArgs,c=a.requestPaddingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysRequestPaddingMixin").mergeRequestPaddingMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysVerifiedNameMixin").mergeVerifiedNameMixin,d("WASmaxOutPreKeysKeyTypeMixin").mergeKeyTypeMixin(d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxOutPreKeysPreKeyListMixin").mergePreKeyListMixin(d("WASmaxOutPreKeysIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxOutPreKeysRegistrationIDMixin").mergeRegistrationIDMixin(d("WASmaxJsx").smax("iq",null),a),a),a),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyBundleMixin=a}),98);
__d("WASmaxOutPreKeysSetRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysIdentityKeyBundleMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"})),a);return a}g.makeSetRequest=a}),98);
__d("WASmaxParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,"SmaxParsingFailure: "+b)||this;c.name="SmaxParsingFailure";c.reason=b;return c}var c=b.prototype;c.toString=function(){return"SmaxParsingFailure: "+this.reason};return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxParsingFailure=a}),66);
__d("WASmaxRpcUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Object.keys(b).map(function(a){var c=a==="Request"?"<request>":'<response name="'+a+'">';return"Tried "+c+", but failed with "+b[a].error+"."}).join(" ");return'Failed to parse incoming stanza of <rpc name="'+a+'">. '+c}f.errorMessageRpcParsing=a}),66);
__d("WASmaxPreKeysSetRPC",["WAComms","WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure","WASmaxInPreKeysSetResponseRequestError","WASmaxInPreKeysSetResponseServerError","WASmaxInPreKeysSetResponseSuccess","WASmaxOutPreKeysSetRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutPreKeysSetRequest").makeSetRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInPreKeysSetResponseSuccess").parseSetResponseSuccess(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"SetResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure").parseSetResponsePreKeySuccessVnameFailure(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"SetResponsePreKeySuccessVnameFailure",value:h.value});case 10:i=d("WASmaxInPreKeysSetResponseRequestError").parseSetResponseRequestError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"SetResponseRequestError",value:i.value});case 13:j=d("WASmaxInPreKeysSetResponseServerError").parseSetResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"SetResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Set",{Success:g,PreKeySuccessVnameFailure:h,RequestError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendSetRPC=a}),98);
__d("WAGenerateAndUploadPreKeysProtocol",["WACryptoManager","WAGetKeysForUpload","WAGlobals","WAMakeSignedPreKeyMixin","WAPromiseRetryLoop","WAResultOrError","WARetryUtils","WASmaxPreKeysSetRPC","WATagsLogger","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got unexpected error: ",", will retry after backoff"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got Malformed upload keys IQ on upload pre keys attempt"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Keys are successfully uploaded"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempt to upload keys"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate prekeys with error "," details: ","}"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["About to upload pre keys"]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["generateAndUploadPreKeysProtocol"]);function a(){var a,c,e,f,g,p,q,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.cryptoManager;f.next=3;return b("regeneratorRuntime").awrap(d("WACryptoManager").generatePreKeys(c));case 3:e=f.sent;if(e.success){f.next=6;break}return f.abrupt("return",e);case 6:n.LOG(m()).devConsole("generation "+e.value);return f.abrupt("return",d("WAGetKeysForUpload").getKeysForUpload(c,e.value));case 8:case"end":return f.stop()}},null,this)},{operationType:"generate_prekeys",flush:!0,afterInit:!0}));case 2:a=t.sent;if(!(a.success===!1)){t.next=6;break}n.ERROR(l(),a.error,(c=(e=a.payload)==null?void 0:e.toString())!=null?c:"none");return t.abrupt("return",d("WAResultOrError").makeError("generate-prekey-error",a.payload));case 6:f=a.value,g=f.regInfo,p=f.preKeys,q=f.signedPreKey;r=babelHelpers["extends"]({registrationElementValue:d("WAWap").BIG_ENDIAN_CONTENT(g.regId),anyElementValue:g.staticKeyPair.publicKey,keyArgs:p.map(o)},d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(q));s=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"uploadKeys",timer:d("WARetryUtils").FIBONACCI_BACKOFF,code:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:n.LOG(k());e.next=3;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysSetRPC").sendSetRPC(r));case 3:c=e.sent;e.t0=c.name;e.next=e.t0==="SetResponseSuccess"?7:e.t0==="SetResponseRequestError"?10:13;break;case 7:n.LOG(j());a(d("WAResultOrError").makeResult({preKeys:p}));return e.abrupt("return");case 10:n.WARN(i());a(d("WAResultOrError").makeError("request-error"));return e.abrupt("return");case 13:c.name,n.WARN(h(),c.name);case 15:case"end":return e.stop()}},null,this)}});s.start();return t.abrupt("return",s.promise());case 11:case"end":return t.stop()}},null,this)}function o(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)};a={anyElementValue:a.keyPair.publicKey};return{keyIDMixinArgs:b,keyDataMixinArgs:a}}g.generateAndUploadPreKeysProtocol=a}),98);
__d("WAGenerateAndUploadPreKeys",["WABridge","WAErr","WAGenerateAndUploadPreKeysProtocol","WALoggerTag","WAOdsEnums","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate and upload prekeys with error ",": ","}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["About to generate and upload pre keys with reason: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([c("WALoggerTag").PrekeyGenerateAndUpload,c("WALoggerTag").SignedPrekey]);function a(a,b){a=b.reason;j.LOG(i(),a);return d("WAGenerateAndUploadPreKeysProtocol").generateAndUploadPreKeysProtocol().then(function(a){if(a.success){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"success",amount:a.value.preKeys.length},!0);return}var b=a.error;if(b==="request-error"){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"malformed"},!0);throw c("WAErr")("Malformed upload keys IQ")}b;j.ERROR(h(),b,(b=a.payload)==null?void 0:b.message)})}g.generateAndUploadPreKeys=a}),98);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";c={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function h(){return d("WAGlobals").getDependencies().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function b(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})})}g.FAILURE_CODES=c;g.clearRegistrationAndTempData=h;g.deregisterPhone=a;g.reregisterPhone=b}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetchDigest=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetchDigest:b.value}))}g.parseFetchDigestResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchDigestResponseServerError=a}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"type");if(!a.success)return a;a=d("WASmaxParseUtils").contentLiteralBytes(a.value,new Uint8Array([5]));return!a.success?a:d("WAResultOrError").makeResult({typeElementValue:a.value})}g.parseKeyTypeMixin=a}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"hash");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,20,20);return!a.success?a:d("WAResultOrError").makeResult({hashElementValue:a.value})}g.parseKeysHashMixin=a}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,3,3);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseKeyIDMixin=a}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(a);return!b.success?b:b}function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!a.success)return a;a=d("WASmaxParseUtils").mapChildrenWithTag(a.value,"id",0,2e4,h);return!a.success?a:d("WAResultOrError").makeResult({listId:a.value})}g.parsePreKeyIDListListId=h;g.parsePreKeyIDListMixin=a}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"registration");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,4,4);return!a.success?a:d("WAResultOrError").makeResult({registrationElementValue:a.value})}g.parseRegistrationIDMixin=a}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"skey");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!c.success)return c;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"signature");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;c=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(c.value);return!c.success?c:d("WAResultOrError").makeResult({skeySignatureElementValue:a.value,skeyIdKeyIDMixin:b.value,skeyValueKeyDataMixin:c.value})}g.parseSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!b.success)return b;var c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a);a=d("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,c.value,e.value,f.value,{keyTypeMixin:g.success?g.value:null},a.value))}g.parseIdentityDigestBundleMixin=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!c.success)return c;var e=d("WASmaxParseReference").optionalAttrStringFromReference(b,["digest","identity_type"]);if(!e.success)return e;e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"identity_type",e.value);if(!e.success)return e;c=d("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({hasDigestIdentityType:e.value!=null,digestIdentityDigestBundleMixin:c.value},a.value))}g.parseFetchDigestResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("digest",null)));return a}g.makeFetchDigestRequest=a}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:c=d("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest();i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=i.sent;f=d("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(e,c);if(!f.success){i.next=7;break}return i.abrupt("return",{name:"FetchDigestResponseSuccess",value:f.value});case 7:g=d("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(e,c);if(!g.success){i.next=10;break}return i.abrupt("return",{name:"FetchDigestResponseRequestError",value:g.value});case 10:h=d("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(e,c);if(!h.success){i.next=13;break}return i.abrupt("return",{name:"FetchDigestResponseServerError",value:h.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:f,RequestError:g,ServerError:h}));case 14:case"end":return i.stop()}},null,this)}g.sendFetchDigestRPC=a}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function a(a){return d("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(b){switch(b.name){case"FetchDigestResponseServerError":var c=b.value.errorServerErrors.name;j.ERROR(i(),b.name,c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchDigestResponseRequestError":c=b.value.errorRequestErrorsFetchDigest.name;j.ERROR(h(),b.name,c);return d("WAResultOrError").makeError({type:"request-error",payload:c});default:b.name;c=k(b.value.digestIdentityDigestBundleMixin);return l(c,a).then(function(a){return a==="ok"?d("WAResultOrError").makeResult():d("WAResultOrError").makeError({type:"compare-error",payload:a})})}})}function k(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),e=a.listId.map(function(a){return d("WASignalKeys").castToPreKeyId(d("WAParsableXmlNode").convertBytesToUint(a.elementValue,3))});a=a.hashElementValue;return{regId:b,skeyId:c.id,preKeyIds:e,hash:a}}function l(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(a.regId!==c.regInfo.regId)){i.next=2;break}return i.abrupt("return","RegIdMismatch");case 2:if(!(a.skeyId!==c.signedPreKey.id)){i.next=4;break}return i.abrupt("return","SignedPreKeyIdMismatch");case 4:e=new Map();c.preKeys.forEach(function(a){return e.set(a.id,a)});f=a.preKeyIds.some(function(a){return!e.has(a)});if(!f){i.next=9;break}return i.abrupt("return","UnknownPreKey");case 9:g=a.preKeyIds.map(function(a){return e.get(a)}).filter(Boolean);i.next=12;return b("regeneratorRuntime").awrap(m(c,g));case 12:h=i.sent;if(d("WACryptoUtils").uint8ArraysEqual(h,a.hash)){i.next=15;break}return i.abrupt("return","HashMismatch");case 15:return i.abrupt("return","ok");case 16:case"end":return i.stop()}},null,this)}function m(a,b){var c=new(d("WABinary").Binary)();c.writeByteArray(a.regInfo.staticKeyPair.publicKey);c.writeByteArray(a.signedPreKey.keyPair.publicKey);c.writeByteArray(a.signedPreKey.signature);b.forEach(function(a){c.writeByteArray(a.keyPair.publicKey)});return d("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",c.readByteArray()).then(function(a){return new Uint8Array(a)})}g.requestPreKeyDigestProtocol=a}),98);
__d("WARequestPreKeyDigest",["WABridge","WAErr","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""]);i=function(){return a};return a}function j(a){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(a(function(a){a=a.cryptoManager;return d("WAGetKeysForUpload").getKeysForUpload(a)}));case 2:e=g.sent;if(!(e.success===!1)){g.next=6;break}d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});throw c("WAErr")("Error while loading keys: "+e.error);case 6:g.next=8;return b("regeneratorRuntime").awrap(d("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(e.value));case 8:f=g.sent;if(!(f.success===!1)){g.next=16;break}d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});if(!(f.error.type==="compare-error")){g.next=15;break}d("WALogger").ERROR(i(),f.error.payload);d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"prekey digest comparison failed"})["catch"](function(a){d("WALogger").ERROR(h(),a)});return g.abrupt("return");case 15:throw c("WAErr")("Error while requesting key digest: "+f.error.type+" "+f.error.payload);case 16:f.success,d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"});case 18:case"end":return g.stop()}},null,this)}function a(a){return j(function(a){return d("WAGlobals").getWaOneQueue().enqueue(a,{operationType:"request_prekey_digest",flush:!1})})}g.requestPreKeyDigestFn=j;g.requestPreKeyDigest=a}),98);/*FB_PKG_DELIM*/
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("core-util-is-1.0.2",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){function a(a){return Array.isArray?Array.isArray(a):p(a)==="[object Array]"}g.isArray=a;function b(a){return typeof a==="boolean"}g.isBoolean=b;function c(a){return a===null}g.isNull=c;function d(a){return a==null}g.isNullOrUndefined=d;function e(a){return typeof a==="number"}g.isNumber=e;function f(a){return typeof a==="string"}g.isString=f;function h(a){return typeof a==="symbol"}g.isSymbol=h;function i(a){return a===void 0}g.isUndefined=i;function j(a){return p(a)==="[object RegExp]"}g.isRegExp=j;function k(a){return typeof a==="object"&&a!==null}g.isObject=k;function l(a){return p(a)==="[object Date]"}g.isDate=l;function m(a){return p(a)==="[object Error]"||a instanceof Error}g.isError=m;function n(a){return typeof a==="function"}g.isFunction=n;function o(a){return a===null||typeof a==="boolean"||typeof a==="number"||typeof a==="string"||typeof a==="symbol"||typeof a==="undefined"}g.isPrimitive=o;g.isBuffer=Buffer.isBuffer;function p(a){return Object.prototype.toString.call(a)}}var j=!1;function k(){j||(j=!0,i());return h.exports}function a(a){switch(a){case void 0:return k()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("file-saver-2.0.2",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){(function(a,b){"undefined"!=typeof g?b():(b(),a.FileSaver={exports:{}}.exports)})(this,function(){function b(b,a){return"undefined"==typeof a?a={autoBom:!1}:"object"!=typeof a&&(!1,a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(b.type)?new Blob(["\ufeff",b],{type:b.type}):b}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){},d.send()}function d(b){var a=new XMLHttpRequest;a.open("HEAD",b,!1);try{a.send()}catch(a){}return 200<=a.status&&299>=a.status}function e(b){try{b.dispatchEvent(new MouseEvent("click"))}catch(c){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),b.dispatchEvent(a)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a&&a.global===a?a:void 0,g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype?function(a,b,g){var h=f.URL||f.webkitURL,i=document.createElement("a");b=b||a.name||"download",i.download=b,i.rel="noopener","string"==typeof a?(i.href=a,i.origin===location.origin?e(i):d(i.href)?c(a,b,g):e(i,i.target="_blank")):(i.href=h.createObjectURL(a),setTimeout(function(){h.revokeObjectURL(i.href)},4e4),setTimeout(function(){e(i)},0))}:"msSaveOrOpenBlob"in navigator?function(a,f,g){if(f=f||a.name||"download","string"!=typeof a)navigator.msSaveOrOpenBlob(b(a,g),f);else if(d(a))c(a,f,g);else{var h=document.createElement("a");h.href=a,h.target="_blank",setTimeout(function(){e(h)})}}:function(e,a,b,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),"string"==typeof e)return c(e,a,b);a="application/octet-stream"===e.type;b=/constructor/i.test(f.HTMLElement)||f.safari;var g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||a&&b)&&"object"==typeof FileReader){var h=new FileReader;h.onloadend=function(){var a=h.result;a=g?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=a:location=a,d=null},h.readAsDataURL(e)}else{var i=f.URL||f.webkitURL,j=i.createObjectURL(e);d?d.location=j:location.href=j,d=null,setTimeout(function(){i.revokeObjectURL(j)},4e4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof h&&(h.exports=g)})}var j=!1;function k(){j||(j=!0,i());return h.exports}function b(a){switch(a){case void 0:return k()}}e.exports=b}),null);
__d("file-saver",["file-saver-2.0.2"],(function(a,b,c,d,e,f){e.exports=b("file-saver-2.0.2")()}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("immediate-3.0.6",[],(function(a,b,c,d,e,f){"use strict";c={};var g={exports:c};function h(){var b=a.MutationObserver||a.WebKitMutationObserver,c;if(process.browser)if(b){var d=0;b=new b(j);var e=a.document.createTextNode("");b.observe(e,{characterData:!0});c=function(){e.data=d=++d%2}}else if(!a.setImmediate&&typeof a.MessageChannel!=="undefined"){var f=new a.MessageChannel();f.port1.onmessage=j;c=function(){f.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?c=function(){var b=a.document.createElement("script");b.onreadystatechange=function(){j(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null};a.document.documentElement.appendChild(b)}:c=function(){setTimeout(j,0)};else c=function(){process.nextTick(j)};var h,i=[];function j(){h=!0;var a,b,c=i.length;while(c){b=i;i=[];a=-1;while(++a<c)b[a]();c=i.length}h=!1}g.exports=k;function k(a){i.push(a)===1&&!h&&c()}}var i=!1;function j(){i||(i=!0,h());return g.exports}function b(a){switch(a){case void 0:return j()}}e.exports=b}),null);
/**
 * License: https://www.facebook.com/legal/license/Hnt8PzozZpk/
 */
__d("inherits-2.0.3",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){typeof Object.create==="function"?g.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:g.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype;a.prototype=new c();a.prototype.constructor=a}}var i=!1;function j(){i||(i=!0,h());return g.exports}c={};var k={exports:c};function l(){try{var a={};if(typeof a.inherits!=="function")throw"";k.exports=a.inherits}catch(a){k.exports=j()}}var m=!1;function n(){m||(m=!0,l());return k.exports}function a(a){switch(a){case void 0:return n()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("isarray-1.0.0",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){var a={}.toString;g.exports=Array.isArray||function(b){return a.call(b)=="[object Array]"}}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("lie-3.3.0",["immediate-3.0.6"],(function(a,b,c,d,e,f){"use strict";function a(a){return a&&typeof a==="object"&&"default"in a?a["default"]:a}var g=a(b("immediate-3.0.6"));d={};var h={exports:d};function i(){var a=g();function b(){}var c={},d=["REJECTED"],e=["FULFILLED"],f=["PENDING"];if(!process.browser)var i=["UNHANDLED"];h.exports=j;function j(a){if(typeof a!=="function")throw new TypeError("resolver must be a function");this.state=f;this.queue=[];this.outcome=void 0;process.browser||(this.handled=i);a!==b&&n(this,a)}j.prototype["finally"]=function(c){if(typeof c!=="function")return this;var d=this.constructor;return this.then(a,b);function a(a){function b(){return a}return d.resolve(c()).then(b)}function b(a){function b(){throw a}return d.resolve(c()).then(b)}};j.prototype["catch"]=function(a){return this.then(null,a)};j.prototype.then=function(a,c){if(typeof a!=="function"&&this.state===e||typeof c!=="function"&&this.state===d)return this;var g=new this.constructor(b);process.browser||this.handled===i&&(this.handled=null);if(this.state!==f){var h=this.state===e?a:c;l(g,h,this.outcome)}else this.queue.push(new k(g,a,c));return g};function k(a,b,c){this.promise=a,typeof b==="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof c==="function"&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}k.prototype.callFulfilled=function(a){c.resolve(this.promise,a)};k.prototype.otherCallFulfilled=function(a){l(this.promise,this.onFulfilled,a)};k.prototype.callRejected=function(a){c.reject(this.promise,a)};k.prototype.otherCallRejected=function(a){l(this.promise,this.onRejected,a)};function l(b,d,e){a(function(){var a;try{a=d(e)}catch(a){return c.reject(b,a)}a===b?c.reject(b,new TypeError("Cannot resolve promise with itself")):c.resolve(b,a)})}c.resolve=function(a,b){var d=o(m,b);if(d.status==="error")return c.reject(a,d.value);d=d.value;if(d)n(a,d);else{a.state=e;a.outcome=b;d=-1;var f=a.queue.length;while(++d<f)a.queue[d].callFulfilled(b)}return a};c.reject=function(b,c){b.state=d;b.outcome=c;process.browser||b.handled===i&&a(function(){b.handled===i&&process.emit("unhandledRejection",c,b)});var e=-1,f=b.queue.length;while(++e<f)b.queue[e].callRejected(c);return b};function m(a){var b=a&&a.then;if(a&&(typeof a==="object"||typeof a==="function")&&typeof b==="function")return function(){b.apply(a,arguments)}}function n(a,b){var d=!1;function e(b){if(d)return;d=!0;c.reject(a,b)}function f(b){if(d)return;d=!0;c.resolve(a,b)}function g(){b(f,e)}g=o(g);g.status==="error"&&e(g.value)}function o(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}j.resolve=p;function p(a){return a instanceof this?a:c.resolve(new this(b),a)}j.reject=q;function q(a){var d=new this(b);return c.reject(d,a)}j.all=r;function r(a){var d=this;if(Object.prototype.toString.call(a)!=="[object Array]")return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);var g=new Array(e),h=0,i=-1,j=new this(b);while(++i<e)k(a[i],i);return j;function k(b,a){d.resolve(b).then(i,function(a){f||(f=!0,c.reject(j,a))});function i(b){g[a]=b,++h===e&&!f&&(f=!0,c.resolve(j,g))}}}j.race=s;function s(a){var d=this;if(Object.prototype.toString.call(a)!=="[object Array]")return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);var g=-1,h=new this(b);while(++g<e)i(a[g]);return h;function i(a){d.resolve(a).then(function(a){f||(f=!0,c.resolve(h,a))},function(a){f||(f=!0,c.reject(h,a))})}}}var j=!1;function k(){j||(j=!0,i());return h.exports}function c(a){switch(a){case void 0:return k()}}e.exports=c}),null);
/**
 * License: https://www.facebook.com/legal/license/cr2jmG-CdKo/
 */
__d("pako-1.0.8",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}g.assign=function(a){var c=Array.prototype.slice.call(arguments,1);while(c.length){var d=c.shift();if(!d)continue;if(typeof d!=="object")throw new TypeError(d+"must be non-object");for(var e in d)b(d,e)&&(a[e]=d[e])}return a};g.shrinkBuf=function(a,b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a};var c={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray){a.set(b.subarray(c,c+d),e);return}for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f;d=0;for(b=0,c=a.length;b<c;b++)d+=a[b].length;d=new Uint8Array(d);e=0;for(b=0,c=a.length;b<c;b++)f=a[b],d.set(f,e),e+=f.length;return d}},d={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};g.setTyped=function(a){a?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,c)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,d))};g.setTyped(a)}var j=!1;function k(){j||(j=!0,i());return h.exports}var l={},m={exports:l};function n(){var a=k(),b=4,c=0,d=1,e=2;function f(a){var b=a.length;while(--b>=0)a[b]=0}var g=0,h=1,i=2,j=3,m=258,n=29,o=256,p=o+1+n,q=30,r=19,aa=2*p+1,s=15,t=16,u=7,v=256,w=16,x=17,y=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ba=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ca=512,C=new Array((p+2)*2);f(C);var da=new Array(q*2);f(da);var D=new Array(ca);f(D);var ea=new Array(m-j+1);f(ea);var fa=new Array(n);f(fa);var E=new Array(q);f(E);function ga(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}var ha,F,G;function H(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function ia(a){return a<256?D[a]:D[256+(a>>>7)]}function ja(a,b){a.pending_buf[a.pending++]=b&255,a.pending_buf[a.pending++]=b>>>8&255}function I(a,b,c){a.bi_valid>t-c?(a.bi_buf|=b<<a.bi_valid&65535,ja(a,a.bi_buf),a.bi_buf=b>>t-a.bi_valid,a.bi_valid+=c-t):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function J(a,b,c){I(a,c[b*2],c[b*2+1])}function ka(a,b){var c=0;do c|=a&1,a>>>=1,c<<=1;while(--b>0);return c>>>1}function la(a){a.bi_valid===16?(ja(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}function ma(a,b){var c=b.dyn_tree,d=b.max_code,e=b.stat_desc.static_tree,f=b.stat_desc.has_stree,g=b.stat_desc.extra_bits,h=b.stat_desc.extra_base;b=b.stat_desc.max_length;var i,j,k,l,m,n=0;for(k=0;k<=s;k++)a.bl_count[k]=0;c[a.heap[a.heap_max]*2+1]=0;for(i=a.heap_max+1;i<aa;i++){j=a.heap[i];k=c[c[j*2+1]*2+1]+1;k>b&&(k=b,n++);c[j*2+1]=k;if(j>d)continue;a.bl_count[k]++;l=0;j>=h&&(l=g[j-h]);m=c[j*2];a.opt_len+=m*(k+l);f&&(a.static_len+=m*(e[j*2+1]+l))}if(n===0)return;do{k=b-1;while(a.bl_count[k]===0)k--;a.bl_count[k]--;a.bl_count[k+1]+=2;a.bl_count[b]--;n-=2}while(n>0);for(k=b;k!==0;k--){j=a.bl_count[k];while(j!==0){m=a.heap[--i];if(m>d)continue;c[m*2+1]!==k&&(a.opt_len+=(k-c[m*2+1])*c[m*2],c[m*2+1]=k);j--}}}function na(a,b,c){var d=new Array(s+1),e=0,f;for(f=1;f<=s;f++)d[f]=e=e+c[f-1]<<1;for(f=0;f<=b;f++){c=a[f*2+1];if(c===0)continue;a[f*2]=ka(d[c]++,c)}}function K(){var a,b,c,d=new Array(s+1);b=0;for(c=0;c<n-1;c++){fa[c]=b;for(a=0;a<1<<z[c];a++)ea[b++]=c}ea[b-1]=c;b=0;for(c=0;c<16;c++){E[c]=b;for(a=0;a<1<<A[c];a++)D[b++]=c}b>>=7;for(;c<q;c++){E[c]=b<<7;for(a=0;a<1<<A[c]-7;a++)D[256+b++]=c}for(c=0;c<=s;c++)d[c]=0;a=0;while(a<=143)C[a*2+1]=8,a++,d[8]++;while(a<=255)C[a*2+1]=9,a++,d[9]++;while(a<=279)C[a*2+1]=7,a++,d[7]++;while(a<=287)C[a*2+1]=8,a++,d[8]++;na(C,p+1,d);for(a=0;a<q;a++)da[a*2+1]=5,da[a*2]=ka(a,5);ha=new ga(C,z,o+1,p,s);F=new ga(da,A,0,q,s);G=new ga(new Array(0),B,0,r,u)}function oa(a){var b;for(b=0;b<p;b++)a.dyn_ltree[b*2]=0;for(b=0;b<q;b++)a.dyn_dtree[b*2]=0;for(b=0;b<r;b++)a.bl_tree[b*2]=0;a.dyn_ltree[v*2]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function L(a){a.bi_valid>8?ja(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function pa(b,c,d,e){L(b),e&&(ja(b,d),ja(b,~d)),a.arraySet(b.pending_buf,b.window,c,d,b.pending),b.pending+=d}function qa(a,b,c,d){var e=b*2,f=c*2;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function M(a,b,c){var d=a.heap[c],e=c<<1;while(e<=a.heap_len){e<a.heap_len&&qa(b,a.heap[e+1],a.heap[e],a.depth)&&e++;if(qa(b,d,a.heap[e],a.depth))break;a.heap[c]=a.heap[e];c=e;e<<=1}a.heap[c]=d}function ra(a,b,c){var d,e,f=0,g,h;if(a.last_lit!==0)do d=a.pending_buf[a.d_buf+f*2]<<8|a.pending_buf[a.d_buf+f*2+1],e=a.pending_buf[a.l_buf+f],f++,d===0?J(a,e,b):(g=ea[e],J(a,g+o+1,b),h=z[g],h!==0&&(e-=fa[g],I(a,e,h)),d--,g=ia(d),J(a,g,c),h=A[g],h!==0&&(d-=E[g],I(a,d,h)));while(f<a.last_lit);J(a,v,b)}function N(a,b){var c=b.dyn_tree,d=b.stat_desc.static_tree,e=b.stat_desc.has_stree,f=b.stat_desc.elems,g,h=-1,i;a.heap_len=0;a.heap_max=aa;for(g=0;g<f;g++)c[g*2]!==0?(a.heap[++a.heap_len]=h=g,a.depth[g]=0):c[g*2+1]=0;while(a.heap_len<2)i=a.heap[++a.heap_len]=h<2?++h:0,c[i*2]=1,a.depth[i]=0,a.opt_len--,e&&(a.static_len-=d[i*2+1]);b.max_code=h;for(g=a.heap_len>>1;g>=1;g--)M(a,c,g);i=f;do g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],M(a,c,1),e=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=e,c[i*2]=c[g*2]+c[e*2],a.depth[i]=(a.depth[g]>=a.depth[e]?a.depth[g]:a.depth[e])+1,c[g*2+1]=c[e*2+1]=i,a.heap[1]=i++,M(a,c,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1];ma(a,b);na(c,h,a.bl_count)}function O(a,b,c){var d,e=-1,f,g=b[0*2+1],h=0,i=7,j=4;g===0&&(i=138,j=3);b[(c+1)*2+1]=65535;for(d=0;d<=c;d++){f=g;g=b[(d+1)*2+1];if(++h<i&&f===g)continue;else h<j?a.bl_tree[f*2]+=h:f!==0?(f!==e&&a.bl_tree[f*2]++,a.bl_tree[w*2]++):h<=10?a.bl_tree[x*2]++:a.bl_tree[y*2]++;h=0;e=f;g===0?(i=138,j=3):f===g?(i=6,j=3):(i=7,j=4)}}function P(a,b,c){var d,e=-1,f,g=b[0*2+1],h=0,i=7,j=4;g===0&&(i=138,j=3);for(d=0;d<=c;d++){f=g;g=b[(d+1)*2+1];if(++h<i&&f===g)continue;else if(h<j)do J(a,f,a.bl_tree);while(--h!==0);else f!==0?(f!==e&&(J(a,f,a.bl_tree),h--),J(a,w,a.bl_tree),I(a,h-3,2)):h<=10?(J(a,x,a.bl_tree),I(a,h-3,3)):(J(a,y,a.bl_tree),I(a,h-11,7));h=0;e=f;g===0?(i=138,j=3):f===g?(i=6,j=3):(i=7,j=4)}}function Q(a){var b;O(a,a.dyn_ltree,a.l_desc.max_code);O(a,a.dyn_dtree,a.d_desc.max_code);N(a,a.bl_desc);for(b=r-1;b>=3;b--)if(a.bl_tree[ba[b]*2+1]!==0)break;a.opt_len+=3*(b+1)+5+5+4;return b}function sa(a,b,c,d){var e;I(a,b-257,5);I(a,c-1,5);I(a,d-4,4);for(e=0;e<d;e++)I(a,a.bl_tree[ba[e]*2+1],3);P(a,a.dyn_ltree,b-1);P(a,a.dyn_dtree,c-1)}function R(a){var b=4093624447,e;for(e=0;e<=31;e++,b>>>=1)if(b&1&&a.dyn_ltree[e*2]!==0)return c;if(a.dyn_ltree[9*2]!==0||a.dyn_ltree[10*2]!==0||a.dyn_ltree[13*2]!==0)return d;for(e=32;e<o;e++)if(a.dyn_ltree[e*2]!==0)return d;return c}var ta=!1;function S(a){ta||(K(),ta=!0),a.l_desc=new H(a.dyn_ltree,ha),a.d_desc=new H(a.dyn_dtree,F),a.bl_desc=new H(a.bl_tree,G),a.bi_buf=0,a.bi_valid=0,oa(a)}function T(a,b,c,d){I(a,(g<<1)+(d?1:0),3),pa(a,b,c,!0)}function U(a){I(a,h<<1,3),J(a,v,C),la(a)}function V(a,c,d,f){var g,j,k=0;a.level>0?(a.strm.data_type===e&&(a.strm.data_type=R(a)),N(a,a.l_desc),N(a,a.d_desc),k=Q(a),g=a.opt_len+3+7>>>3,j=a.static_len+3+7>>>3,j<=g&&(g=j)):g=j=d+5;d+4<=g&&c!==-1?T(a,c,d,f):a.strategy===b||j===g?(I(a,(h<<1)+(f?1:0),3),ra(a,C,da)):(I(a,(i<<1)+(f?1:0),3),sa(a,a.l_desc.max_code+1,a.d_desc.max_code+1,k+1),ra(a,a.dyn_ltree,a.dyn_dtree));oa(a);f&&L(a)}function W(a,b,c){a.pending_buf[a.d_buf+a.last_lit*2]=b>>>8&255;a.pending_buf[a.d_buf+a.last_lit*2+1]=b&255;a.pending_buf[a.l_buf+a.last_lit]=c&255;a.last_lit++;b===0?a.dyn_ltree[c*2]++:(a.matches++,b--,a.dyn_ltree[(ea[c]+o+1)*2]++,a.dyn_dtree[ia(b)*2]++);return a.last_lit===a.lit_bufsize-1}l._tr_init=S;l._tr_stored_block=T;l._tr_flush_block=V;l._tr_tally=W;l._tr_align=U}var o=!1;function p(){o||(o=!0,n());return m.exports}b={};var q={exports:b};function r(){function a(a,b,c,d){var e=a&65535|0;a=a>>>16&65535|0;var f;while(c!==0){f=c>2e3?2e3:c;c-=f;do e=e+b[d++]|0,a=a+e|0;while(--f);e%=65521;a%=65521}return e|a<<16|0}q.exports=a}var aa=!1;function s(){aa||(aa=!0,r());return q.exports}c={};var t={exports:c};function u(){function a(){var a,b=[];for(var c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}var b=a();function c(a,c,d,e){var f=b;d=e+d;a^=-1;for(e=e;e<d;e++)a=a>>>8^f[(a^c[e])&255];return a^-1}t.exports=c}var v=!1;function w(){v||(v=!0,u());return t.exports}d={};var x={exports:d};function y(){x.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}var z=!1;function A(){z||(z=!0,y());return x.exports}var B={},ba={exports:B};function ca(){var a=k(),b=p(),c=s(),d=w(),e=A(),f=0,g=1,h=3,i=4,j=5,l=0,m=1,n=-2,o=-3,q=-5,r=-1,aa=1,t=2,u=3,v=4,x=0,y=2,z=8,ba=9,ca=15,C=8,da=29,D=256,ea=D+1+da,fa=30,E=19,ga=2*ea+1,ha=15,F=3,G=258,H=G+F+1,ia=32,ja=42,I=69,J=73,ka=91,la=103,ma=113,na=666,K=1,oa=2,L=3,pa=4,qa=3;function M(a,b){a.msg=e[b];return b}function ra(a){return(a<<1)-(a>4?9:0)}function N(a){var b=a.length;while(--b>=0)a[b]=0}function O(b){var c=b.state,d=c.pending;d>b.avail_out&&(d=b.avail_out);if(d===0)return;a.arraySet(b.output,c.pending_buf,c.pending_out,d,b.next_out);b.next_out+=d;c.pending_out+=d;b.total_out+=d;b.avail_out-=d;c.pending-=d;c.pending===0&&(c.pending_out=0)}function P(a,c){b._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,c),a.block_start=a.strstart,O(a.strm)}function Q(a,b){a.pending_buf[a.pending++]=b}function sa(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=b&255}function R(b,e,f,g){var h=b.avail_in;h>g&&(h=g);if(h===0)return 0;b.avail_in-=h;a.arraySet(e,b.input,b.next_in,h,f);b.state.wrap===1?b.adler=c(b.adler,e,h,f):b.state.wrap===2&&(b.adler=d(b.adler,e,h,f));b.next_in+=h;b.total_in+=h;return h}function ta(a,b){var c=a.max_chain_length,d=a.strstart,e,f=a.prev_length,g=a.nice_match,h=a.strstart>a.w_size-H?a.strstart-(a.w_size-H):0,i=a.window,j=a.w_mask,k=a.prev,l=a.strstart+G,m=i[d+f-1],n=i[d+f];a.prev_length>=a.good_match&&(c>>=2);g>a.lookahead&&(g=a.lookahead);do{e=b;if(i[e+f]!==n||i[e+f-1]!==m||i[e]!==i[d]||i[++e]!==i[d+1])continue;d+=2;e++;do;while(i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&d<l);e=G-(l-d);d=l-G;if(e>f){a.match_start=b;f=e;if(e>=g)break;m=i[d+f-1];n=i[d+f]}}while((b=k[b&j])>h&&--c!==0);return f<=a.lookahead?f:a.lookahead}function S(b){var c=b.w_size,d,e,f,g;do{g=b.window_size-b.lookahead-b.strstart;if(b.strstart>=c+(c-H)){a.arraySet(b.window,b.window,c,c,0);b.match_start-=c;b.strstart-=c;b.block_start-=c;e=b.hash_size;d=e;do f=b.head[--d],b.head[d]=f>=c?f-c:0;while(--e);e=c;d=e;do f=b.prev[--d],b.prev[d]=f>=c?f-c:0;while(--e);g+=c}if(b.strm.avail_in===0)break;e=R(b.strm,b.window,b.strstart+b.lookahead,g);b.lookahead+=e;if(b.lookahead+b.insert>=F){f=b.strstart-b.insert;b.ins_h=b.window[f];b.ins_h=(b.ins_h<<b.hash_shift^b.window[f+1])&b.hash_mask;while(b.insert){b.ins_h=(b.ins_h<<b.hash_shift^b.window[f+F-1])&b.hash_mask;b.prev[f&b.w_mask]=b.head[b.ins_h];b.head[b.ins_h]=f;f++;b.insert--;if(b.lookahead+b.insert<F)break}}}while(b.lookahead<H&&b.strm.avail_in!==0)}function T(a,b){var c=65535;c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);for(;;){if(a.lookahead<=1){S(a);if(a.lookahead===0&&b===f)return K;if(a.lookahead===0)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+c;if(a.strstart===0||a.strstart>=d){a.lookahead=a.strstart-d;a.strstart=d;P(a,!1);if(a.strm.avail_out===0)return K}if(a.strstart-a.block_start>=a.w_size-H){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=0;if(b===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.strstart>a.block_start){P(a,!1);if(a.strm.avail_out===0)return K}return K}function U(a,c){var d;for(;;){if(a.lookahead<H){S(a);if(a.lookahead<H&&c===f)return K;if(a.lookahead===0)break}d=0;a.lookahead>=F&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);d!==0&&a.strstart-d<=a.w_size-H&&(a.match_length=ta(a,d));if(a.match_length>=F){d=b._tr_tally(a,a.strstart-a.match_start,a.match_length-F);a.lookahead-=a.match_length;if(a.match_length<=a.max_lazy_match&&a.lookahead>=F){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(--a.match_length!==0);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask}else d=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=a.strstart<F-1?a.strstart:F-1;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function V(a,c){var d,e;for(;;){if(a.lookahead<H){S(a);if(a.lookahead<H&&c===f)return K;if(a.lookahead===0)break}d=0;a.lookahead>=F&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);a.prev_length=a.match_length;a.prev_match=a.match_start;a.match_length=F-1;d!==0&&a.prev_length<a.max_lazy_match&&a.strstart-d<=a.w_size-H&&(a.match_length=ta(a,d),a.match_length<=5&&(a.strategy===aa||a.match_length===F&&a.strstart-a.match_start>4096)&&(a.match_length=F-1));if(a.prev_length>=F&&a.match_length<=a.prev_length){d=a.strstart+a.lookahead-F;e=b._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-F);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=d&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(--a.prev_length!==0);a.match_available=0;a.match_length=F-1;a.strstart++;if(e){P(a,!1);if(a.strm.avail_out===0)return K}}else if(a.match_available){e=b._tr_tally(a,0,a.window[a.strstart-1]);e&&P(a,!1);a.strstart++;a.lookahead--;if(a.strm.avail_out===0)return K}else a.match_available=1,a.strstart++,a.lookahead--}a.match_available&&(b._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0);a.insert=a.strstart<F-1?a.strstart:F-1;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function W(a,c){var d,e,g,h=a.window;for(;;){if(a.lookahead<=G){S(a);if(a.lookahead<=G&&c===f)return K;if(a.lookahead===0)break}a.match_length=0;if(a.lookahead>=F&&a.strstart>0){e=a.strstart-1;d=h[e];if(d===h[++e]&&d===h[++e]&&d===h[++e]){g=a.strstart+G;do;while(d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&e<g);a.match_length=G-(g-e);a.match_length>a.lookahead&&(a.match_length=a.lookahead)}}a.match_length>=F?(d=b._tr_tally(a,1,a.match_length-F),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(d=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++);if(d){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=0;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function X(a,c){var d;for(;;){if(a.lookahead===0){S(a);if(a.lookahead===0){if(c===f)return K;break}}a.match_length=0;d=b._tr_tally(a,0,a.window[a.strstart]);a.lookahead--;a.strstart++;if(d){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=0;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function ua(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}var va;va=[new ua(0,0,0,0,T),new ua(4,4,8,4,U),new ua(4,5,16,8,U),new ua(4,6,32,32,U),new ua(4,4,16,16,V),new ua(8,16,32,32,V),new ua(8,16,128,128,V),new ua(8,32,128,256,V),new ua(32,128,258,1024,V),new ua(32,258,258,4096,V)];function wa(a){a.window_size=2*a.w_size,N(a.head),a.max_lazy_match=va[a.level].max_lazy,a.good_match=va[a.level].good_length,a.nice_match=va[a.level].nice_length,a.max_chain_length=va[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=F-1,a.match_available=0,a.ins_h=0}function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(ga*2),this.dyn_dtree=new a.Buf16((2*fa+1)*2),this.bl_tree=new a.Buf16((2*E+1)*2),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(ha+1),this.heap=new a.Buf16(2*ea+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*ea+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function xa(a){var c;if(!a||!a.state)return M(a,n);a.total_in=a.total_out=0;a.data_type=y;c=a.state;c.pending=0;c.pending_out=0;c.wrap<0&&(c.wrap=-c.wrap);c.status=c.wrap?ja:ma;a.adler=c.wrap===2?0:1;c.last_flush=f;b._tr_init(c);return l}function Z(a){var b=xa(a);b===l&&wa(a.state);return b}function $(a,b){if(!a||!a.state)return n;if(a.state.wrap!==2)return n;a.state.gzhead=b;return l}function ya(b,c,d,e,f,g){if(!b)return n;var h=1;c===r&&(c=6);e<0?(h=0,e=-e):e>15&&(h=2,e-=16);if(f<1||f>ba||d!==z||e<8||e>15||c<0||c>9||g<0||g>v)return M(b,n);e===8&&(e=9);var i=new Y();b.state=i;i.strm=b;i.wrap=h;i.gzhead=null;i.w_bits=e;i.w_size=1<<i.w_bits;i.w_mask=i.w_size-1;i.hash_bits=f+7;i.hash_size=1<<i.hash_bits;i.hash_mask=i.hash_size-1;i.hash_shift=~~((i.hash_bits+F-1)/F);i.window=new a.Buf8(i.w_size*2);i.head=new a.Buf16(i.hash_size);i.prev=new a.Buf16(i.w_size);i.lit_bufsize=1<<f+6;i.pending_buf_size=i.lit_bufsize*4;i.pending_buf=new a.Buf8(i.pending_buf_size);i.d_buf=1*i.lit_bufsize;i.l_buf=(1+2)*i.lit_bufsize;i.level=c;i.strategy=g;i.method=d;return Z(b)}function za(a,b){return ya(a,b,z,ca,C,x)}function Aa(a,c){var e,k;if(!a||!a.state||c>j||c<0)return a?M(a,n):n;k=a.state;if(!a.output||!a.input&&a.avail_in!==0||k.status===na&&c!==i)return M(a,a.avail_out===0?q:n);k.strm=a;e=k.last_flush;k.last_flush=c;if(k.status===ja)if(k.wrap===2)a.adler=0,Q(k,31),Q(k,139),Q(k,8),!k.gzhead?(Q(k,0),Q(k,0),Q(k,0),Q(k,0),Q(k,0),Q(k,k.level===9?2:k.strategy>=t||k.level<2?4:0),Q(k,qa),k.status=ma):(Q(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Q(k,k.gzhead.time&255),Q(k,k.gzhead.time>>8&255),Q(k,k.gzhead.time>>16&255),Q(k,k.gzhead.time>>24&255),Q(k,k.level===9?2:k.strategy>=t||k.level<2?4:0),Q(k,k.gzhead.os&255),k.gzhead.extra&&k.gzhead.extra.length&&(Q(k,k.gzhead.extra.length&255),Q(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(a.adler=d(a.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=I);else{var o=z+(k.w_bits-8<<4)<<8,p;k.strategy>=t||k.level<2?p=0:k.level<6?p=1:k.level===6?p=2:p=3;o|=p<<6;k.strstart!==0&&(o|=ia);o+=31-o%31;k.status=ma;sa(k,o);k.strstart!==0&&(sa(k,a.adler>>>16),sa(k,a.adler&65535));a.adler=1}if(k.status===I)if(k.gzhead.extra){p=k.pending;while(k.gzindex<(k.gzhead.extra.length&65535)){if(k.pending===k.pending_buf_size){k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));O(a);p=k.pending;if(k.pending===k.pending_buf_size)break}Q(k,k.gzhead.extra[k.gzindex]&255);k.gzindex++}k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=J)}else k.status=J;if(k.status===J)if(k.gzhead.name){p=k.pending;do{if(k.pending===k.pending_buf_size){k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));O(a);p=k.pending;if(k.pending===k.pending_buf_size){o=1;break}}k.gzindex<k.gzhead.name.length?o=k.gzhead.name.charCodeAt(k.gzindex++)&255:o=0;Q(k,o)}while(o!==0);k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));o===0&&(k.gzindex=0,k.status=ka)}else k.status=ka;if(k.status===ka)if(k.gzhead.comment){p=k.pending;do{if(k.pending===k.pending_buf_size){k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));O(a);p=k.pending;if(k.pending===k.pending_buf_size){o=1;break}}k.gzindex<k.gzhead.comment.length?o=k.gzhead.comment.charCodeAt(k.gzindex++)&255:o=0;Q(k,o)}while(o!==0);k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));o===0&&(k.status=la)}else k.status=la;k.status===la&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&O(a),k.pending+2<=k.pending_buf_size&&(Q(k,a.adler&255),Q(k,a.adler>>8&255),a.adler=0,k.status=ma)):k.status=ma);if(k.pending!==0){O(a);if(a.avail_out===0){k.last_flush=-1;return l}}else if(a.avail_in===0&&ra(c)<=ra(e)&&c!==i)return M(a,q);if(k.status===na&&a.avail_in!==0)return M(a,q);if(a.avail_in!==0||k.lookahead!==0||c!==f&&k.status!==na){p=k.strategy===t?X(k,c):k.strategy===u?W(k,c):va[k.level].func(k,c);(p===L||p===pa)&&(k.status=na);if(p===K||p===L){a.avail_out===0&&(k.last_flush=-1);return l}if(p===oa){c===g?b._tr_align(k):c!==j&&(b._tr_stored_block(k,0,0,!1),c===h&&(N(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0)));O(a);if(a.avail_out===0){k.last_flush=-1;return l}}}if(c!==i)return l;if(k.wrap<=0)return m;k.wrap===2?(Q(k,a.adler&255),Q(k,a.adler>>8&255),Q(k,a.adler>>16&255),Q(k,a.adler>>24&255),Q(k,a.total_in&255),Q(k,a.total_in>>8&255),Q(k,a.total_in>>16&255),Q(k,a.total_in>>24&255)):(sa(k,a.adler>>>16),sa(k,a.adler&65535));O(a);k.wrap>0&&(k.wrap=-k.wrap);return k.pending!==0?l:m}function Ba(a){var b;if(!a||!a.state)return n;b=a.state.status;if(b!==ja&&b!==I&&b!==J&&b!==ka&&b!==la&&b!==ma&&b!==na)return M(a,n);a.state=null;return b===ma?M(a,o):l}function Ca(b,d){var e=d.length,f,g,h,i,j;if(!b||!b.state)return n;f=b.state;g=f.wrap;if(g===2||g===1&&f.status!==ja||f.lookahead)return n;g===1&&(b.adler=c(b.adler,d,e,0));f.wrap=0;e>=f.w_size&&(g===0&&(N(f.head),f.strstart=0,f.block_start=0,f.insert=0),j=new a.Buf8(f.w_size),a.arraySet(j,d,e-f.w_size,f.w_size,0),d=j,e=f.w_size);j=b.avail_in;h=b.next_in;i=b.input;b.avail_in=e;b.next_in=0;b.input=d;S(f);while(f.lookahead>=F){e=f.strstart;d=f.lookahead-(F-1);do f.ins_h=(f.ins_h<<f.hash_shift^f.window[e+F-1])&f.hash_mask,f.prev[e&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=e,e++;while(--d);f.strstart=e;f.lookahead=F-1;S(f)}f.strstart+=f.lookahead;f.block_start=f.strstart;f.insert=f.lookahead;f.lookahead=0;f.match_length=f.prev_length=F-1;f.match_available=0;b.next_in=h;b.input=i;b.avail_in=j;f.wrap=g;return l}B.deflateInit=za;B.deflateInit2=ya;B.deflateReset=Z;B.deflateResetKeep=xa;B.deflateSetHeader=$;B.deflate=Aa;B.deflateEnd=Ba;B.deflateSetDictionary=Ca;B.deflateInfo="pako deflate (from Nodeca project)"}var C=!1;function da(){C||(C=!0,ca());return ba.exports}var D={},ea={exports:D};function fa(){var a=k(),b=!0,c=!0;try{String.fromCharCode.apply(null,[0])}catch(a){b=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){c=!1}var d=new a.Buf8(256);for(var e=0;e<256;e++)d[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;d[254]=d[254]=1;D.string2buf=function(b){var c,d,e,f,g,h=b.length,i=0;for(f=0;f<h;f++)d=b.charCodeAt(f),(d&64512)===55296&&f+1<h&&(e=b.charCodeAt(f+1),(e&64512)===56320&&(d=65536+(d-55296<<10)+(e-56320),f++)),i+=d<128?1:d<2048?2:d<65536?3:4;c=new a.Buf8(i);for(g=0,f=0;g<i;f++)d=b.charCodeAt(f),(d&64512)===55296&&f+1<h&&(e=b.charCodeAt(f+1),(e&64512)===56320&&(d=65536+(d-55296<<10)+(e-56320),f++)),d<128?c[g++]=d:d<2048?(c[g++]=192|d>>>6,c[g++]=128|d&63):d<65536?(c[g++]=224|d>>>12,c[g++]=128|d>>>6&63,c[g++]=128|d&63):(c[g++]=240|d>>>18,c[g++]=128|d>>>12&63,c[g++]=128|d>>>6&63,c[g++]=128|d&63);return c};function f(d,e){if(e<65534&&(d.subarray&&c||!d.subarray&&b))return String.fromCharCode.apply(null,a.shrinkBuf(d,e));var f="";for(var g=0;g<e;g++)f+=String.fromCharCode(d[g]);return f}D.buf2binstring=function(a){return f(a,a.length)};D.binstring2buf=function(b){var c=new a.Buf8(b.length);for(var d=0,e=c.length;d<e;d++)c[d]=b.charCodeAt(d);return c};D.buf2string=function(a,b){var c,e,g,h;b=b||a.length;var i=new Array(b*2);for(e=0,c=0;c<b;){g=a[c++];if(g<128){i[e++]=g;continue}h=d[g];if(h>4){i[e++]=65533;c+=h-1;continue}g&=h===2?31:h===3?15:7;while(h>1&&c<b)g=g<<6|a[c++]&63,h--;if(h>1){i[e++]=65533;continue}g<65536?i[e++]=g:(g-=65536,i[e++]=55296|g>>10&1023,i[e++]=56320|g&1023)}return f(i,e)};D.utf8border=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);c=b-1;while(c>=0&&(a[c]&192)===128)c--;if(c<0)return b;return c===0?b:c+d[a[c]]>b?c:b}}var E=!1;function ga(){E||(E=!0,fa());return ea.exports}f={};var ha={exports:f};function F(){function a(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}ha.exports=a}var G=!1;function H(){G||(G=!0,F());return ha.exports}var ia={},ja={exports:ia};function I(){var a=da(),b=k(),c=ga(),d=A(),e=H(),f=Object.prototype.toString,g=0,h=4,i=0,j=1,l=2,m=-1,n=0,o=8;function p(g){if(!(this instanceof p))return new p(g);this.options=b.assign({level:m,method:o,chunkSize:16384,windowBits:15,memLevel:8,strategy:n,to:""},g||{});g=this.options;g.raw&&g.windowBits>0?g.windowBits=-g.windowBits:g.gzip&&g.windowBits>0&&g.windowBits<16&&(g.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new e();this.strm.avail_out=0;var h=a.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(h!==i)throw new Error(d[h]);g.header&&a.deflateSetHeader(this.strm,g.header);if(g.dictionary){var j;typeof g.dictionary==="string"?j=c.string2buf(g.dictionary):f.call(g.dictionary)==="[object ArrayBuffer]"?j=new Uint8Array(g.dictionary):j=g.dictionary;h=a.deflateSetDictionary(this.strm,j);if(h!==i)throw new Error(d[h]);this._dict_set=!0}}p.prototype.push=function(d,e){var k=this.strm,m=this.options.chunkSize;if(this.ended)return!1;e=e===~~e?e:e===!0?h:g;typeof d==="string"?k.input=c.string2buf(d):f.call(d)==="[object ArrayBuffer]"?k.input=new Uint8Array(d):k.input=d;k.next_in=0;k.avail_in=k.input.length;do{k.avail_out===0&&(k.output=new b.Buf8(m),k.next_out=0,k.avail_out=m);d=a.deflate(k,e);if(d!==j&&d!==i){this.onEnd(d);this.ended=!0;return!1}(k.avail_out===0||k.avail_in===0&&(e===h||e===l))&&(this.options.to==="string"?this.onData(c.buf2binstring(b.shrinkBuf(k.output,k.next_out))):this.onData(b.shrinkBuf(k.output,k.next_out)))}while((k.avail_in>0||k.avail_out===0)&&d!==j);if(e===h){d=a.deflateEnd(this.strm);this.onEnd(d);this.ended=!0;return d===i}if(e===l){this.onEnd(i);k.avail_out=0;return!0}return!0};p.prototype.onData=function(a){this.chunks.push(a)};p.prototype.onEnd=function(a){a===i&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function q(a,b){b=new p(b);b.push(a,!0);if(b.err)throw b.msg||d[b.err];return b.result}function r(a,b){b=b||{};b.raw=!0;return q(a,b)}function aa(a,b){b=b||{};b.gzip=!0;return q(a,b)}ia.Deflate=p;ia.deflate=q;ia.deflateRaw=r;ia.gzip=aa}var J=!1;function ka(){J||(J=!0,I());return ja.exports}b={};var la={exports:b};function ma(){var a=30,b=12;la.exports=function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,aa,s,t,u,v,w,x,y,z,A;e=c.state;f=c.next_in;z=c.input;g=f+(c.avail_in-5);h=c.next_out;A=c.output;d=h-(d-c.avail_out);i=h+(c.avail_out-257);j=e.dmax;k=e.wsize;l=e.whave;m=e.wnext;n=e.window;o=e.hold;p=e.bits;q=e.lencode;r=e.distcode;aa=(1<<e.lenbits)-1;s=(1<<e.distbits)-1;top:do{p<15&&(o+=z[f++]<<p,p+=8,o+=z[f++]<<p,p+=8);t=q[o&aa];dolen:for(;;){u=t>>>24;o>>>=u;p-=u;u=t>>>16&255;if(u===0)A[h++]=t&65535;else if(u&16){v=t&65535;u&=15;u&&(p<u&&(o+=z[f++]<<p,p+=8),v+=o&(1<<u)-1,o>>>=u,p-=u);p<15&&(o+=z[f++]<<p,p+=8,o+=z[f++]<<p,p+=8);t=r[o&s];dodist:for(;;){u=t>>>24;o>>>=u;p-=u;u=t>>>16&255;if(u&16){w=t&65535;u&=15;p<u&&(o+=z[f++]<<p,p+=8,p<u&&(o+=z[f++]<<p,p+=8));w+=o&(1<<u)-1;if(w>j){c.msg="invalid distance too far back";e.mode=a;break top}o>>>=u;p-=u;u=h-d;if(w>u){u=w-u;if(u>l&&e.sane){c.msg="invalid distance too far back";e.mode=a;break top}x=0;y=n;if(m===0){x+=k-u;if(u<v){v-=u;do A[h++]=n[x++];while(--u);x=h-w;y=A}}else if(m<u){x+=k+m-u;u-=m;if(u<v){v-=u;do A[h++]=n[x++];while(--u);x=0;if(m<v){u=m;v-=u;do A[h++]=n[x++];while(--u);x=h-w;y=A}}}else{x+=m-u;if(u<v){v-=u;do A[h++]=n[x++];while(--u);x=h-w;y=A}}while(v>2)A[h++]=y[x++],A[h++]=y[x++],A[h++]=y[x++],v-=3;v&&(A[h++]=y[x++],v>1&&(A[h++]=y[x++]))}else{x=h-w;do A[h++]=A[x++],A[h++]=A[x++],A[h++]=A[x++],v-=3;while(v>2);v&&(A[h++]=A[x++],v>1&&(A[h++]=A[x++]))}}else if((u&64)===0){t=r[(t&65535)+(o&(1<<u)-1)];continue dodist}else{c.msg="invalid distance code";e.mode=a;break top}break}}else if((u&64)===0){t=q[(t&65535)+(o&(1<<u)-1)];continue dolen}else if(u&32){e.mode=b;break top}else{c.msg="invalid literal/length code";e.mode=a;break top}break}}while(f<g&&h<i);v=p>>3;f-=v;p-=v<<3;o&=(1<<p)-1;c.next_in=f;c.next_out=h;c.avail_in=f<g?5+(g-f):5-(f-g);c.avail_out=h<i?257+(i-h):257-(h-i);e.hold=o;e.bits=p;return}}var na=!1;function K(){na||(na=!0,ma());return la.exports}c={};var oa={exports:c};function L(){var a=k(),b=15,c=852,d=592,e=0,f=1,g=2,h=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];oa.exports=function(k,m,n,o,p,q,r,aa){var s=aa.bits,t,u,v,w,x,y,z,A,B,ba,ca,C,da,D,ea=0,fa,E=new a.Buf16(b+1),ga=new a.Buf16(b+1),ha=0,F,G,H;for(t=0;t<=b;t++)E[t]=0;for(u=0;u<o;u++)E[m[n+u]]++;s=s;for(w=b;w>=1;w--)if(E[w]!==0)break;s>w&&(s=w);if(w===0){p[q++]=1<<24|64<<16|0;p[q++]=1<<24|64<<16|0;aa.bits=1;return 0}for(v=1;v<w;v++)if(E[v]!==0)break;s<v&&(s=v);z=1;for(t=1;t<=b;t++){z<<=1;z-=E[t];if(z<0)return-1}if(z>0&&(k===e||w!==1))return-1;ga[1]=0;for(t=1;t<b;t++)ga[t+1]=ga[t]+E[t];for(u=0;u<o;u++)m[n+u]!==0&&(r[ga[m[n+u]]++]=u);k===e?(ga=o=r,fa=19):k===f?(ga=h,ea-=257,o=i,ha-=257,fa=256):(ga=j,o=l,fa=-1);B=0;u=0;t=v;D=q;x=s;y=0;C=-1;A=1<<s;da=A-1;if(k===f&&A>c||k===g&&A>d)return 1;for(;;){F=t-y;r[u]<fa?(G=0,H=r[u]):r[u]>fa?(G=o[ha+r[u]],H=ga[ea+r[u]]):(G=32+64,H=0);ba=1<<t-y;ca=1<<x;v=ca;do ca-=ba,p[D+(B>>y)+ca]=F<<24|G<<16|H|0;while(ca!==0);ba=1<<t-1;while(B&ba)ba>>=1;ba!==0?(B&=ba-1,B+=ba):B=0;u++;if(--E[t]===0){if(t===w)break;t=m[n+r[u]]}if(t>s&&(B&da)!==C){y===0&&(y=s);D+=v;x=t-y;z=1<<x;while(x+y<w){z-=E[x+y];if(z<=0)break;x++;z<<=1}A+=1<<x;if(k===f&&A>c||k===g&&A>d)return 1;C=B&da;p[C]=s<<24|x<<16|D-q|0}}B!==0&&(p[D+B]=t-y<<24|64<<16|0);aa.bits=s;return 0}}var pa=!1;function qa(){pa||(pa=!0,L());return oa.exports}var M={},ra={exports:M};function N(){var a=k(),b=s(),c=w(),d=K(),e=qa(),f=0,g=1,h=2,i=4,j=5,l=6,m=0,n=1,o=2,p=-2,q=-3,r=-4,aa=-5,t=8,u=1,v=2,x=3,y=4,z=5,A=6,B=7,ba=8,ca=9,C=10,da=11,D=12,ea=13,fa=14,E=15,ga=16,ha=17,F=18,G=19,H=20,ia=21,ja=22,I=23,J=24,ka=25,la=26,ma=27,na=28,oa=29,L=30,pa=31,ra=32,N=852,O=592,P=15,Q=P;function sa(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function R(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ta(b){var c;if(!b||!b.state)return p;c=b.state;b.total_in=b.total_out=c.total=0;b.msg="";c.wrap&&(b.adler=c.wrap&1);c.mode=u;c.last=0;c.havedict=0;c.dmax=32768;c.head=null;c.hold=0;c.bits=0;c.lencode=c.lendyn=new a.Buf32(N);c.distcode=c.distdyn=new a.Buf32(O);c.sane=1;c.back=-1;return m}function S(a){var b;if(!a||!a.state)return p;b=a.state;b.wsize=0;b.whave=0;b.wnext=0;return ta(a)}function T(a,b){var c,d;if(!a||!a.state)return p;d=a.state;b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15));if(b&&(b<8||b>15))return p;d.window!==null&&d.wbits!==b&&(d.window=null);d.wrap=c;d.wbits=b;return S(a)}function U(a,b){var c;if(!a)return p;c=new R();a.state=c;c.window=null;c=T(a,b);c!==m&&(a.state=null);return c}function V(a){return U(a,Q)}var W=!0,X,ua;function va(b){if(W){var c;X=new a.Buf32(512);ua=new a.Buf32(32);c=0;while(c<144)b.lens[c++]=8;while(c<256)b.lens[c++]=9;while(c<280)b.lens[c++]=7;while(c<288)b.lens[c++]=8;e(g,b.lens,0,288,X,0,b.work,{bits:9});c=0;while(c<32)b.lens[c++]=5;e(h,b.lens,0,32,ua,0,b.work,{bits:5});W=!1}b.lencode=X;b.lenbits=9;b.distcode=ua;b.distbits=5}function wa(b,c,d,e){var f;b=b.state;b.window===null&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new a.Buf8(b.wsize));e>=b.wsize?(a.arraySet(b.window,c,d-b.wsize,b.wsize,0),b.wnext=0,b.whave=b.wsize):(f=b.wsize-b.wnext,f>e&&(f=e),a.arraySet(b.window,c,d-e,f,b.wnext),e-=f,e?(a.arraySet(b.window,c,d-e,e,0),b.wnext=e,b.whave=b.wsize):(b.wnext+=f,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=f)));return 0}function Y(k,s){var w,K,qa,M,N,O,P,Q,R,ta,S,T,U,V,W,X,ua,Y,xa,Z=new a.Buf8(4),$,ya,za=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return p;w=k.state;w.mode===D&&(w.mode=ea);N=k.next_out;qa=k.output;P=k.avail_out;M=k.next_in;K=k.input;O=k.avail_in;Q=w.hold;R=w.bits;ta=O;S=P;xa=m;inf_leave:for(;;)switch(w.mode){case u:if(w.wrap===0){w.mode=ea;break}while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(w.wrap&2&&Q===35615){w.check=0;Z[0]=Q&255;Z[1]=Q>>>8&255;w.check=c(w.check,Z,2,0);Q=0;R=0;w.mode=v;break}w.flags=0;w.head&&(w.head.done=!1);if(!(w.wrap&1)||(((Q&255)<<8)+(Q>>8))%31){k.msg="incorrect header check";w.mode=L;break}if((Q&15)!==t){k.msg="unknown compression method";w.mode=L;break}Q>>>=4;R-=4;Y=(Q&15)+8;if(w.wbits===0)w.wbits=Y;else if(Y>w.wbits){k.msg="invalid window size";w.mode=L;break}w.dmax=1<<Y;k.adler=w.check=1;w.mode=Q&512?C:D;Q=0;R=0;break;case v:while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.flags=Q;if((w.flags&255)!==t){k.msg="unknown compression method";w.mode=L;break}if(w.flags&57344){k.msg="unknown header flags set";w.mode=L;break}w.head&&(w.head.text=Q>>8&1);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,w.check=c(w.check,Z,2,0));Q=0;R=0;w.mode=x;case x:while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.head&&(w.head.time=Q);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,Z[2]=Q>>>16&255,Z[3]=Q>>>24&255,w.check=c(w.check,Z,4,0));Q=0;R=0;w.mode=y;case y:while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.head&&(w.head.xflags=Q&255,w.head.os=Q>>8);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,w.check=c(w.check,Z,2,0));Q=0;R=0;w.mode=z;case z:if(w.flags&1024){while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.length=Q;w.head&&(w.head.extra_len=Q);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,w.check=c(w.check,Z,2,0));Q=0;R=0}else w.head&&(w.head.extra=null);w.mode=A;case A:if(w.flags&1024){T=w.length;T>O&&(T=O);T&&(w.head&&(Y=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),a.arraySet(w.head.extra,K,M,T,Y)),w.flags&512&&(w.check=c(w.check,K,T,M)),O-=T,M+=T,w.length-=T);if(w.length)break inf_leave}w.length=0;w.mode=B;case B:if(w.flags&2048){if(O===0)break inf_leave;T=0;do Y=K[M+T++],w.head&&Y&&w.length<65536&&(w.head.name+=String.fromCharCode(Y));while(Y&&T<O);w.flags&512&&(w.check=c(w.check,K,T,M));O-=T;M+=T;if(Y)break inf_leave}else w.head&&(w.head.name=null);w.length=0;w.mode=ba;case ba:if(w.flags&4096){if(O===0)break inf_leave;T=0;do Y=K[M+T++],w.head&&Y&&w.length<65536&&(w.head.comment+=String.fromCharCode(Y));while(Y&&T<O);w.flags&512&&(w.check=c(w.check,K,T,M));O-=T;M+=T;if(Y)break inf_leave}else w.head&&(w.head.comment=null);w.mode=ca;case ca:if(w.flags&512){while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(Q!==(w.check&65535)){k.msg="header crc mismatch";w.mode=L;break}Q=0;R=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0);k.adler=w.check=0;w.mode=D;break;case C:while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}k.adler=w.check=sa(Q);Q=0;R=0;w.mode=da;case da:if(w.havedict===0){k.next_out=N;k.avail_out=P;k.next_in=M;k.avail_in=O;w.hold=Q;w.bits=R;return o}k.adler=w.check=1;w.mode=D;case D:if(s===j||s===l)break inf_leave;case ea:if(w.last){Q>>>=R&7;R-=R&7;w.mode=ma;break}while(R<3){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.last=Q&1;Q>>>=1;R-=1;switch(Q&3){case 0:w.mode=fa;break;case 1:va(w);w.mode=H;if(s===l){Q>>>=2;R-=2;break inf_leave}break;case 2:w.mode=ha;break;case 3:k.msg="invalid block type",w.mode=L}Q>>>=2;R-=2;break;case fa:Q>>>=R&7;R-=R&7;while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if((Q&65535)!==(Q>>>16^65535)){k.msg="invalid stored block lengths";w.mode=L;break}w.length=Q&65535;Q=0;R=0;w.mode=E;if(s===l)break inf_leave;case E:w.mode=ga;case ga:T=w.length;if(T){T>O&&(T=O);T>P&&(T=P);if(T===0)break inf_leave;a.arraySet(qa,K,M,T,N);O-=T;M+=T;P-=T;N+=T;w.length-=T;break}w.mode=D;break;case ha:while(R<14){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.nlen=(Q&31)+257;Q>>>=5;R-=5;w.ndist=(Q&31)+1;Q>>>=5;R-=5;w.ncode=(Q&15)+4;Q>>>=4;R-=4;if(w.nlen>286||w.ndist>30){k.msg="too many length or distance symbols";w.mode=L;break}w.have=0;w.mode=F;case F:while(w.have<w.ncode){while(R<3){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.lens[za[w.have++]]=Q&7;Q>>>=3;R-=3}while(w.have<19)w.lens[za[w.have++]]=0;w.lencode=w.lendyn;w.lenbits=7;$={bits:w.lenbits};xa=e(f,w.lens,0,19,w.lencode,0,w.work,$);w.lenbits=$.bits;if(xa){k.msg="invalid code lengths set";w.mode=L;break}w.have=0;w.mode=G;case G:while(w.have<w.nlen+w.ndist){for(;;){U=w.lencode[Q&(1<<w.lenbits)-1];V=U>>>24;W=U>>>16&255;X=U&65535;if(V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(X<16)Q>>>=V,R-=V,w.lens[w.have++]=X;else{if(X===16){ya=V+2;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=V;R-=V;if(w.have===0){k.msg="invalid bit length repeat";w.mode=L;break}Y=w.lens[w.have-1];T=3+(Q&3);Q>>>=2;R-=2}else if(X===17){ya=V+3;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=V;R-=V;Y=0;T=3+(Q&7);Q>>>=3;R-=3}else{ya=V+7;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=V;R-=V;Y=0;T=11+(Q&127);Q>>>=7;R-=7}if(w.have+T>w.nlen+w.ndist){k.msg="invalid bit length repeat";w.mode=L;break}while(T--)w.lens[w.have++]=Y}}if(w.mode===L)break;if(w.lens[256]===0){k.msg="invalid code -- missing end-of-block";w.mode=L;break}w.lenbits=9;$={bits:w.lenbits};xa=e(g,w.lens,0,w.nlen,w.lencode,0,w.work,$);w.lenbits=$.bits;if(xa){k.msg="invalid literal/lengths set";w.mode=L;break}w.distbits=6;w.distcode=w.distdyn;$={bits:w.distbits};xa=e(h,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,$);w.distbits=$.bits;if(xa){k.msg="invalid distances set";w.mode=L;break}w.mode=H;if(s===l)break inf_leave;case H:w.mode=ia;case ia:if(O>=6&&P>=258){k.next_out=N;k.avail_out=P;k.next_in=M;k.avail_in=O;w.hold=Q;w.bits=R;d(k,S);N=k.next_out;qa=k.output;P=k.avail_out;M=k.next_in;K=k.input;O=k.avail_in;Q=w.hold;R=w.bits;w.mode===D&&(w.back=-1);break}w.back=0;for(;;){U=w.lencode[Q&(1<<w.lenbits)-1];V=U>>>24;W=U>>>16&255;X=U&65535;if(V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(W&&(W&240)===0){Y=V;$=W;ua=X;for(;;){U=w.lencode[ua+((Q&(1<<Y+$)-1)>>Y)];V=U>>>24;W=U>>>16&255;X=U&65535;if(Y+V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=Y;R-=Y;w.back+=Y}Q>>>=V;R-=V;w.back+=V;w.length=X;if(W===0){w.mode=la;break}if(W&32){w.back=-1;w.mode=D;break}if(W&64){k.msg="invalid literal/length code";w.mode=L;break}w.extra=W&15;w.mode=ja;case ja:if(w.extra){ya=w.extra;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.length+=Q&(1<<w.extra)-1;Q>>>=w.extra;R-=w.extra;w.back+=w.extra}w.was=w.length;w.mode=I;case I:for(;;){U=w.distcode[Q&(1<<w.distbits)-1];V=U>>>24;W=U>>>16&255;X=U&65535;if(V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if((W&240)===0){Y=V;$=W;ua=X;for(;;){U=w.distcode[ua+((Q&(1<<Y+$)-1)>>Y)];V=U>>>24;W=U>>>16&255;X=U&65535;if(Y+V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=Y;R-=Y;w.back+=Y}Q>>>=V;R-=V;w.back+=V;if(W&64){k.msg="invalid distance code";w.mode=L;break}w.offset=X;w.extra=W&15;w.mode=J;case J:if(w.extra){ya=w.extra;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.offset+=Q&(1<<w.extra)-1;Q>>>=w.extra;R-=w.extra;w.back+=w.extra}if(w.offset>w.dmax){k.msg="invalid distance too far back";w.mode=L;break}w.mode=ka;case ka:if(P===0)break inf_leave;T=S-P;if(w.offset>T){T=w.offset-T;if(T>w.whave&&w.sane){k.msg="invalid distance too far back";w.mode=L;break}T>w.wnext?(T-=w.wnext,U=w.wsize-T):U=w.wnext-T;T>w.length&&(T=w.length);$=w.window}else $=qa,U=N-w.offset,T=w.length;T>P&&(T=P);P-=T;w.length-=T;do qa[N++]=$[U++];while(--T);w.length===0&&(w.mode=ia);break;case la:if(P===0)break inf_leave;qa[N++]=w.length;P--;w.mode=ia;break;case ma:if(w.wrap){while(R<32){if(O===0)break inf_leave;O--;Q|=K[M++]<<R;R+=8}S-=P;k.total_out+=S;w.total+=S;S&&(k.adler=w.check=w.flags?c(w.check,qa,S,N-S):b(w.check,qa,S,N-S));S=P;if((w.flags?Q:sa(Q))!==w.check){k.msg="incorrect data check";w.mode=L;break}Q=0;R=0}w.mode=na;case na:if(w.wrap&&w.flags){while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(Q!==(w.total&4294967295)){k.msg="incorrect length check";w.mode=L;break}Q=0;R=0}w.mode=oa;case oa:xa=n;break inf_leave;case L:xa=q;break inf_leave;case pa:return r;case ra:default:return p}k.next_out=N;k.avail_out=P;k.next_in=M;k.avail_in=O;w.hold=Q;w.bits=R;if((w.wsize||S!==k.avail_out&&w.mode<L&&(w.mode<ma||s!==i))&&wa(k,k.output,k.next_out,S-k.avail_out)){w.mode=pa;return r}ta-=k.avail_in;S-=k.avail_out;k.total_in+=ta;k.total_out+=S;w.total+=S;w.wrap&&S&&(k.adler=w.check=w.flags?c(w.check,qa,S,k.next_out-S):b(w.check,qa,S,k.next_out-S));k.data_type=w.bits+(w.last?64:0)+(w.mode===D?128:0)+(w.mode===H||w.mode===E?256:0);(ta===0&&S===0||s===i)&&xa===m&&(xa=aa);return xa}function xa(a){if(!a||!a.state)return p;var b=a.state;b.window&&(b.window=null);a.state=null;return m}function Z(a,b){if(!a||!a.state)return p;a=a.state;if((a.wrap&2)===0)return p;a.head=b;b.done=!1;return m}function $(a,c){var d=c.length,e,f;if(!a||!a.state)return p;e=a.state;if(e.wrap!==0&&e.mode!==da)return p;if(e.mode===da){f=1;f=b(f,c,d,0);if(f!==e.check)return q}f=wa(a,c,d,d);if(f){e.mode=pa;return r}e.havedict=1;return m}M.inflateReset=S;M.inflateReset2=T;M.inflateResetKeep=ta;M.inflateInit=V;M.inflateInit2=U;M.inflate=Y;M.inflateEnd=xa;M.inflateGetHeader=Z;M.inflateSetDictionary=$;M.inflateInfo="pako inflate (from Nodeca project)"}var O=!1;function P(){O||(O=!0,N());return ra.exports}d={};var Q={exports:d};function sa(){Q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}var R=!1;function ta(){R||(R=!0,sa());return Q.exports}f={};var S={exports:f};function T(){function a(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}S.exports=a}var U=!1;function V(){U||(U=!0,T());return S.exports}var W={},X={exports:W};function ua(){var a=P(),b=k(),c=ga(),d=ta(),e=A(),f=H(),g=V(),h=Object.prototype.toString;function i(j){if(!(this instanceof i))return new i(j);this.options=b.assign({chunkSize:16384,windowBits:0,to:""},j||{});var k=this.options;k.raw&&k.windowBits>=0&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15));k.windowBits>=0&&k.windowBits<16&&!(j&&j.windowBits)&&(k.windowBits+=32);k.windowBits>15&&k.windowBits<48&&((k.windowBits&15)===0&&(k.windowBits|=15));this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new f();this.strm.avail_out=0;j=a.inflateInit2(this.strm,k.windowBits);if(j!==d.Z_OK)throw new Error(e[j]);this.header=new g();a.inflateGetHeader(this.strm,this.header);if(k.dictionary){typeof k.dictionary==="string"?k.dictionary=c.string2buf(k.dictionary):h.call(k.dictionary)==="[object ArrayBuffer]"&&(k.dictionary=new Uint8Array(k.dictionary));if(k.raw){j=a.inflateSetDictionary(this.strm,k.dictionary);if(j!==d.Z_OK)throw new Error(e[j])}}}i.prototype.push=function(e,f){var g=this.strm,i=this.options.chunkSize,j=this.options.dictionary,k,l,m,n=!1;if(this.ended)return!1;f=f===~~f?f:f===!0?d.Z_FINISH:d.Z_NO_FLUSH;typeof e==="string"?g.input=c.binstring2buf(e):h.call(e)==="[object ArrayBuffer]"?g.input=new Uint8Array(e):g.input=e;g.next_in=0;g.avail_in=g.input.length;do{g.avail_out===0&&(g.output=new b.Buf8(i),g.next_out=0,g.avail_out=i);e=a.inflate(g,d.Z_NO_FLUSH);e===d.Z_NEED_DICT&&j&&(e=a.inflateSetDictionary(this.strm,j));e===d.Z_BUF_ERROR&&n===!0&&(e=d.Z_OK,n=!1);if(e!==d.Z_STREAM_END&&e!==d.Z_OK){this.onEnd(e);this.ended=!0;return!1}g.next_out&&((g.avail_out===0||e===d.Z_STREAM_END||g.avail_in===0&&(f===d.Z_FINISH||f===d.Z_SYNC_FLUSH))&&(this.options.to==="string"?(k=c.utf8border(g.output,g.next_out),l=g.next_out-k,m=c.buf2string(g.output,k),g.next_out=l,g.avail_out=i-l,l&&b.arraySet(g.output,g.output,k,l,0),this.onData(m)):this.onData(b.shrinkBuf(g.output,g.next_out))));g.avail_in===0&&g.avail_out===0&&(n=!0)}while((g.avail_in>0||g.avail_out===0)&&e!==d.Z_STREAM_END);e===d.Z_STREAM_END&&(f=d.Z_FINISH);if(f===d.Z_FINISH){e=a.inflateEnd(this.strm);this.onEnd(e);this.ended=!0;return e===d.Z_OK}if(f===d.Z_SYNC_FLUSH){this.onEnd(d.Z_OK);g.avail_out=0;return!0}return!0};i.prototype.onData=function(a){this.chunks.push(a)};i.prototype.onEnd=function(a){a===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function j(a,b){b=new i(b);b.push(a,!0);if(b.err)throw b.msg||e[b.err];return b.result}function l(a,b){b=b||{};b.raw=!0;return j(a,b)}W.Inflate=i;W.inflate=j;W.inflateRaw=l;W.ungzip=j}var va=!1;function wa(){va||(va=!0,ua());return X.exports}b={};var Y={exports:b};function xa(){var a=k().assign,b=ka(),c=wa(),d=ta(),e={};a(e,b,c,d);Y.exports=e}var Z=!1;function $(){Z||(Z=!0,xa());return Y.exports}function a(a){switch(a){case void 0:return $()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("process-nextick-args-2.0.0",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?g.exports={nextTick:a}:g.exports=process;function a(a,b,c,d){if(typeof a!=="function")throw new TypeError('"callback" argument must be a function');var e=arguments.length,f,g;switch(e){case 0:case 1:return process.nextTick(a);case 2:return process.nextTick(function(){a.call(null,b)});case 3:return process.nextTick(function(){a.call(null,b,c)});case 4:return process.nextTick(function(){a.call(null,b,c,d)});default:f=new Array(e-1);g=0;while(g<f.length)f[g++]=arguments[g];return process.nextTick(function(){a.apply(null,f)})}}}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("safe-buffer-5.1.2",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a={},b=a.Buffer;function c(a,b){for(var c in a)b[c]=a[c]}b.from&&b.alloc&&b.allocUnsafe&&b.allocUnsafeSlow?h.exports=a:(c(a,g),g.Buffer=d);function d(a,c,d){return b(a,c,d)}c(b,d);d.from=function(a,c,d){if(typeof a==="number")throw new TypeError("Argument must not be a number");return b(a,c,d)};d.alloc=function(a,c,d){if(typeof a!=="number")throw new TypeError("Argument must be a number");a=b(a);c!==void 0?typeof d==="string"?a.fill(c,d):a.fill(c):a.fill(0);return a};d.allocUnsafe=function(a){if(typeof a!=="number")throw new TypeError("Argument must be a number");return b(a)};d.allocUnsafeSlow=function(b){if(typeof b!=="number")throw new TypeError("Argument must be a number");return a.SlowBuffer(b)}}var j=!1;function k(){j||(j=!0,i());return h.exports}function a(a){switch(a){case void 0:return k()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("util-deprecate-1.0.2",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){g.exports={}.deprecate}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("readable-stream-2.3.6",["safe-buffer-5.1.2","process-nextick-args-2.0.0","core-util-is-1.0.2","inherits-2.0.3","util-deprecate-1.0.2","isarray-1.0.0"],(function(a,b,c,d,e,f){"use strict";function c(a){return a&&typeof a==="object"&&"default"in a?a["default"]:a}var g=c(b("safe-buffer-5.1.2")),h=c(b("process-nextick-args-2.0.0")),i=c(b("core-util-is-1.0.2")),j=c(b("inherits-2.0.3")),k=c(b("util-deprecate-1.0.2")),l=c(b("isarray-1.0.0"));c={};var m={exports:c};function n(){m.exports={}}var o=!1;function p(){o||(o=!0,n());return m.exports}b={};var q={exports:b};function r(){function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var b=g().Buffer,c={};function d(a,b,c){a.copy(b,c)}q.exports=function(){function c(){a(this,c),this.head=null,this.tail=null,this.length=0}c.prototype.push=function(a){a={data:a,next:null};this.length>0?this.tail.next=a:this.head=a;this.tail=a;++this.length};c.prototype.unshift=function(a){a={data:a,next:this.head};this.length===0&&(this.tail=a);this.head=a;++this.length};c.prototype.shift=function(){if(this.length===0)return;var a=this.head.data;this.length===1?this.head=this.tail=null:this.head=this.head.next;--this.length;return a};c.prototype.clear=function(){this.head=this.tail=null,this.length=0};c.prototype.join=function(a){if(this.length===0)return"";var b=this.head,c=""+b.data;while(b=b.next)c+=a+b.data;return c};c.prototype.concat=function(a){if(this.length===0)return b.alloc(0);if(this.length===1)return this.head.data;a=b.allocUnsafe(a>>>0);var c=this.head,e=0;while(c)d(c.data,a,e),e+=c.data.length,c=c.next;return a};return c}();c&&c.inspect&&c.inspect.custom&&(q.exports.prototype[c.inspect.custom]=function(){var a=c.inspect({length:this.length});return this.constructor.name+" "+a})}var s=!1;function t(){s||(s=!0,r());return q.exports}c={};var u={exports:c};function v(){var a=h();function b(b,c){var e=this,f=this._readableState&&this._readableState.destroyed,g=this._writableState&&this._writableState.destroyed;if(f||g){c?c(b):b&&(!this._writableState||!this._writableState.errorEmitted)&&a.nextTick(d,this,b);return this}this._readableState&&(this._readableState.destroyed=!0);this._writableState&&(this._writableState.destroyed=!0);this._destroy(b||null,function(b){!c&&b?(a.nextTick(d,e,b),e._writableState&&(e._writableState.errorEmitted=!0)):c&&c(b)});return this}function c(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function d(a,b){a.emit("error",b)}u.exports={destroy:b,undestroy:c}}var w=!1;function x(){w||(w=!0,v());return u.exports}b={};var y={exports:b};function z(){var b=h();y.exports=w;function c(a){var b=this;this.next=null;this.entry=null;this.finish=function(){Q(b,a)}}var d=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:b.nextTick,e;w.WritableState=u;var f=i();f.inherits=j();var l={deprecate:k()},m=p(),n=g().Buffer,o=a.Uint8Array||function(){};function q(a){return n.from(a)}function r(a){return n.isBuffer(a)||a instanceof o}var s=x();f.inherits(w,m);function t(){}function u(a,b){e=e||F();a=a||{};var d=b instanceof e;this.objectMode=!!a.objectMode;d&&(this.objectMode=this.objectMode||!!a.writableObjectMode);var f=a.highWaterMark,g=a.writableHighWaterMark,h=this.objectMode?16:16*1024;f||f===0?this.highWaterMark=f:d&&(g||g===0)?this.highWaterMark=g:this.highWaterMark=h;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=!1;this.needDrain=!1;this.ending=!1;this.ended=!1;this.finished=!1;this.destroyed=!1;f=a.decodeStrings===!1;this.decodeStrings=!f;this.defaultEncoding=a.defaultEncoding||"utf8";this.length=0;this.writing=!1;this.corked=0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(a){H(b,a)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=!1;this.errorEmitted=!1;this.bufferedRequestCount=0;this.corkedRequestsFree=new c(this)}u.prototype.getBuffer=function(){var a=this.bufferedRequest,b=[];while(a)b.push(a),a=a.next;return b};(function(){try{Object.defineProperty(u.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(a){}})();var v;typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"?(v=Function.prototype[Symbol.hasInstance],Object.defineProperty(w,Symbol.hasInstance,{value:function(a){if(v.call(this,a))return!0;return this!==w?!1:a&&a._writableState instanceof u}})):v=function(a){return a instanceof this};function w(a){e=e||F();if(!v.call(w,this)&&!(this instanceof e))return new w(a);this._writableState=new u(a,this);this.writable=!0;a&&(typeof a.write==="function"&&(this._write=a.write),typeof a.writev==="function"&&(this._writev=a.writev),typeof a.destroy==="function"&&(this._destroy=a.destroy),typeof a["final"]==="function"&&(this._final=a["final"]));m.call(this)}w.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function z(a,c){var d=new Error("write after end");a.emit("error",d);b.nextTick(c,d)}function A(a,c,d,e){var f=!0,g=!1;d===null?g=new TypeError("May not write null values to stream"):typeof d!=="string"&&d!==void 0&&!c.objectMode&&(g=new TypeError("Invalid non-string/buffer chunk"));g&&(a.emit("error",g),b.nextTick(e,g),f=!1);return f}w.prototype.write=function(a,b,c){var d=this._writableState,e=!1,f=!d.objectMode&&r(a);f&&!n.isBuffer(a)&&(a=q(a));typeof b==="function"&&(c=b,b=null);f?b="buffer":b||(b=d.defaultEncoding);typeof c!=="function"&&(c=t);d.ended?z(this,c):(f||A(this,d,a,c))&&(d.pendingcb++,e=C(this,d,f,a,b,c));return e};w.prototype.cork=function(){var a=this._writableState;a.corked++};w.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,!a.writing&&!a.corked&&!a.finished&&!a.bufferProcessing&&a.bufferedRequest&&K(this,a))};w.prototype.setDefaultEncoding=function(a){typeof a==="string"&&(a=a.toLowerCase());if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);this._writableState.defaultEncoding=a;return this};function B(a,b,c){!a.objectMode&&a.decodeStrings!==!1&&typeof b==="string"&&(b=n.from(b,c));return b}Object.defineProperty(w.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function C(a,b,c,d,e,f){if(!c){var g=B(b,d,e);d!==g&&(c=!0,e="buffer",d=g)}g=b.objectMode?1:d.length;b.length+=g;var h=b.length<b.highWaterMark;h||(b.needDrain=!0);if(b.writing||b.corked){var i=b.lastBufferedRequest;b.lastBufferedRequest={chunk:d,encoding:e,isBuf:c,callback:f,next:null};i?i.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest;b.bufferedRequestCount+=1}else D(a,b,!1,g,d,e,f);return h}function D(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function E(a,c,d,e,f){--c.pendingcb,d?(b.nextTick(f,e),b.nextTick(O,a,c),a._writableState.errorEmitted=!0,a.emit("error",e)):(f(e),a._writableState.errorEmitted=!0,a.emit("error",e),O(a,c))}function G(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function H(a,b){var c=a._writableState,e=c.sync,f=c.writecb;G(c);if(b)E(a,c,e,b,f);else{b=L(c);!b&&!c.corked&&!c.bufferProcessing&&c.bufferedRequest&&K(a,c);e?d(I,a,c,b,f):I(a,c,b,f)}}function I(a,b,c,d){c||J(a,b),b.pendingcb--,d(),O(a,b)}function J(a,b){b.length===0&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function K(a,b){b.bufferProcessing=!0;var d=b.bufferedRequest;if(a._writev&&d&&d.next){var e=b.bufferedRequestCount;e=new Array(e);var f=b.corkedRequestsFree;f.entry=d;var g=0,h=!0;while(d)e[g]=d,d.isBuf||(h=!1),d=d.next,g+=1;e.allBuffers=h;D(a,b,!0,b.length,e,"",f.finish);b.pendingcb++;b.lastBufferedRequest=null;f.next?(b.corkedRequestsFree=f.next,f.next=null):b.corkedRequestsFree=new c(b);b.bufferedRequestCount=0}else{while(d){g=d.chunk;h=d.encoding;e=d.callback;f=b.objectMode?1:g.length;D(a,b,!1,f,g,h,e);d=d.next;b.bufferedRequestCount--;if(b.writing)break}d===null&&(b.lastBufferedRequest=null)}b.bufferedRequest=d;b.bufferProcessing=!1}w.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))};w.prototype._writev=null;w.prototype.end=function(a,b,c){var d=this._writableState;typeof a==="function"?(c=a,a=null,b=null):typeof b==="function"&&(c=b,b=null);a!==null&&a!==void 0&&this.write(a,b);d.corked&&(d.corked=1,this.uncork());!d.ending&&!d.finished&&P(this,d,c)};function L(a){return a.ending&&a.length===0&&a.bufferedRequest===null&&!a.finished&&!a.writing}function M(a,b){a._final(function(c){b.pendingcb--,c&&a.emit("error",c),b.prefinished=!0,a.emit("prefinish"),O(a,b)})}function N(a,c){!c.prefinished&&!c.finalCalled&&(typeof a._final==="function"?(c.pendingcb++,c.finalCalled=!0,b.nextTick(M,a,c)):(c.prefinished=!0,a.emit("prefinish")))}function O(a,b){var c=L(b);c&&(N(a,b),b.pendingcb===0&&(b.finished=!0,a.emit("finish")));return c}function P(a,c,d){c.ending=!0,O(a,c),d&&(c.finished?b.nextTick(d):a.once("finish",d)),c.ended=!0,a.writable=!1}function Q(a,b,c){var d=a.entry;a.entry=null;while(d){var e=d.callback;b.pendingcb--;e(c);d=d.next}b.corkedRequestsFree?b.corkedRequestsFree.next=a:b.corkedRequestsFree=a}Object.defineProperty(w.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(a){if(!this._writableState)return;this._writableState.destroyed=a}});w.prototype.destroy=s.destroy;w.prototype._undestroy=s.undestroy;w.prototype._destroy=function(a,b){this.end(),b(a)}}var A=!1;function B(){A||(A=!0,z());return y.exports}c={};var C={exports:c};function D(){var a=h(),b=Object.keys||function(a){var b=[];for(a in a)b.push(a);return b};C.exports=g;var c=i();c.inherits=j();var d=O(),e=B();c.inherits(g,d);c=b(e.prototype);for(b=0;b<c.length;b++){var f=c[b];g.prototype[f]||(g.prototype[f]=e.prototype[f])}function g(a){if(!(this instanceof g))return new g(a);d.call(this,a);e.call(this,a);a&&a.readable===!1&&(this.readable=!1);a&&a.writable===!1&&(this.writable=!1);this.allowHalfOpen=!0;a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1);this.once("end",k)}Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function k(){if(this.allowHalfOpen||this._writableState.ended)return;a.nextTick(l,this)}function l(a){a.end()}Object.defineProperty(g.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(a){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=a;this._writableState.destroyed=a}});g.prototype._destroy=function(b,c){this.push(null),this.end(),a.nextTick(c,b)}}var E=!1;function F(){E||(E=!0,D());return C.exports}var G={},H={exports:G};function I(){var a=g().Buffer,b=a.isEncoding||function(a){a=""+a;switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function c(a){if(!a)return"utf8";var b;while(!0)switch(a){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return a;default:if(b)return;a=(""+a).toLowerCase();b=!0}}function d(d){var e=c(d);if(typeof e!=="string"&&(a.isEncoding===b||!b(d)))throw new Error("Unknown encoding: "+d);return e||d}G.StringDecoder=e;function e(b){this.encoding=d(b);var c;switch(this.encoding){case"utf16le":this.text=m;this.end=n;c=4;break;case"utf8":this.fillLast=j;c=4;break;case"base64":this.text=o;this.end=p;c=3;break;default:this.write=q;this.end=r;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=a.allocUnsafe(c)}e.prototype.write=function(a){if(a.length===0)return"";var b,c;if(this.lastNeed){b=this.fillLast(a);if(b===void 0)return"";c=this.lastNeed;this.lastNeed=0}else c=0;return c<a.length?b?b+this.text(a,c):this.text(a,c):b||""};e.prototype.end=l;e.prototype.text=k;e.prototype.fillLast=function(a){if(this.lastNeed<=a.length){a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,a.length);this.lastNeed-=a.length};function f(a){if(a<=127)return 0;else if(a>>5===6)return 2;else if(a>>4===14)return 3;else if(a>>3===30)return 4;return a>>6===2?-1:-2}function h(a,b,c){var d=b.length-1;if(d<c)return 0;var e=f(b[d]);if(e>=0){e>0&&(a.lastNeed=e-1);return e}if(--d<c||e===-2)return 0;e=f(b[d]);if(e>=0){e>0&&(a.lastNeed=e-2);return e}if(--d<c||e===-2)return 0;e=f(b[d]);if(e>=0){e>0&&(e===2?e=0:a.lastNeed=e-3);return e}return 0}function i(a,b,c){if((b[0]&192)!==128){a.lastNeed=0;return"\ufffd"}if(a.lastNeed>1&&b.length>1){if((b[1]&192)!==128){a.lastNeed=1;return"\ufffd"}if(a.lastNeed>2&&b.length>2&&(b[2]&192)!==128){a.lastNeed=2;return"\ufffd"}}}function j(a){var b=this.lastTotal-this.lastNeed,c=i(this,a,b);if(c!==void 0)return c;if(this.lastNeed<=a.length){a.copy(this.lastChar,b,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}a.copy(this.lastChar,b,0,a.length);this.lastNeed-=a.length}function k(a,b){var c=h(this,a,b);if(!this.lastNeed)return a.toString("utf8",b);this.lastTotal=c;c=a.length-(c-this.lastNeed);a.copy(this.lastChar,0,c);return a.toString("utf8",b,c)}function l(a){a=a&&a.length?this.write(a):"";return this.lastNeed?a+"\ufffd":a}function m(a,b){if((a.length-b)%2===0){var c=a.toString("utf16le",b);if(c){var d=c.charCodeAt(c.length-1);if(d>=55296&&d<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=a[a.length-2];this.lastChar[1]=a[a.length-1];return c.slice(0,-1)}}return c}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=a[a.length-1];return a.toString("utf16le",b,a.length-1)}function n(a){a=a&&a.length?this.write(a):"";if(this.lastNeed){var b=this.lastTotal-this.lastNeed;return a+this.lastChar.toString("utf16le",0,b)}return a}function o(a,b){var c=(a.length-b)%3;if(c===0)return a.toString("base64",b);this.lastNeed=3-c;this.lastTotal=3;c===1?this.lastChar[0]=a[a.length-1]:(this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1]);return a.toString("base64",b,a.length-c)}function p(a){a=a&&a.length?this.write(a):"";return this.lastNeed?a+this.lastChar.toString("base64",0,3-this.lastNeed):a}function q(a){return a.toString(this.encoding)}function r(a){return a&&a.length?this.write(a):""}}var J=!1;function K(){J||(J=!0,I());return H.exports}b={};var L={exports:b};function M(){var b=h();L.exports=A;var c=l(),d;A.ReadableState=z;var e=function(a,b){return a.listeners(b).length},f=p(),k=g().Buffer,m=a.Uint8Array||function(){};function n(a){return k.from(a)}function o(a){return k.isBuffer(a)||a instanceof m}var q=i();q.inherits=j();var r={},s=void 0;r&&r.debuglog?s=r.debuglog("stream"):s=function(){};var u=t();r=x();var v;q.inherits(A,f);var w=["error","close","destroy","pause","resume"];function y(a,b,d){if(typeof a.prependListener==="function")return a.prependListener(b,d);!a._events||!a._events[b]?a.on(b,d):c(a._events[b])?a._events[b].unshift(d):a._events[b]=[d,a._events[b]]}function z(a,b){d=d||F();a=a||{};b=b instanceof d;this.objectMode=!!a.objectMode;b&&(this.objectMode=this.objectMode||!!a.readableObjectMode);var c=a.highWaterMark,e=a.readableHighWaterMark,f=this.objectMode?16:16*1024;c||c===0?this.highWaterMark=c:b&&(e||e===0)?this.highWaterMark=e:this.highWaterMark=f;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new u();this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=!1;this.endEmitted=!1;this.reading=!1;this.sync=!0;this.needReadable=!1;this.emittedReadable=!1;this.readableListening=!1;this.resumeScheduled=!1;this.destroyed=!1;this.defaultEncoding=a.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=!1;this.decoder=null;this.encoding=null;a.encoding&&(v||(v=K("/").StringDecoder),this.decoder=new v(a.encoding),this.encoding=a.encoding)}function A(a){d=d||F();if(!(this instanceof A))return new A(a);this._readableState=new z(a,this);this.readable=!0;a&&(typeof a.read==="function"&&(this._read=a.read),typeof a.destroy==="function"&&(this._destroy=a.destroy));f.call(this)}Object.defineProperty(A.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(a){if(!this._readableState)return;this._readableState.destroyed=a}});A.prototype.destroy=r.destroy;A.prototype._undestroy=r.undestroy;A.prototype._destroy=function(a,b){this.push(null),b(a)};A.prototype.push=function(a,b){var c=this._readableState,d;!c.objectMode?typeof a==="string"&&(b=b||c.defaultEncoding,b!==c.encoding&&(a=k.from(a,b),b=""),d=!0):d=!0;return B(this,a,b,!1,d)};A.prototype.unshift=function(a){return B(this,a,null,!0,!1)};function B(a,b,c,d,e){var f=a._readableState;if(b===null)f.reading=!1,J(a,f);else{var g;e||(g=D(f,b));g?a.emit("error",g):f.objectMode||b&&b.length>0?(typeof b!=="string"&&!f.objectMode&&Object.getPrototypeOf(b)!==k.prototype&&(b=n(b)),d?f.endEmitted?a.emit("error",new Error("stream.unshift() after end event")):C(a,f,b,!0):f.ended?a.emit("error",new Error("stream.push() after EOF")):(f.reading=!1,f.decoder&&!c?(b=f.decoder.write(b),f.objectMode||b.length!==0?C(a,f,b,!1):O(a,f)):C(a,f,b,!1))):d||(f.reading=!1)}return E(f)}function C(a,b,c,d){b.flowing&&b.length===0&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,d?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&M(a)),O(a,b)}function D(a,b){var c;!o(b)&&typeof b!=="string"&&b!==void 0&&!a.objectMode&&(c=new TypeError("Invalid non-string/buffer chunk"));return c}function E(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||a.length===0)}A.prototype.isPaused=function(){return this._readableState.flowing===!1};A.prototype.setEncoding=function(a){v||(v=K("/").StringDecoder);this._readableState.decoder=new v(a);this._readableState.encoding=a;return this};var G=8388608;function H(a){a>=G?a=G:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++);return a}function I(a,b){if(a<=0||b.length===0&&b.ended)return 0;if(b.objectMode)return 1;if(a!==a)if(b.flowing&&b.length)return b.buffer.head.data.length;else return b.length;a>b.highWaterMark&&(b.highWaterMark=H(a));if(a<=b.length)return a;if(!b.ended){b.needReadable=!0;return 0}return b.length}A.prototype.read=function(a){s("read",a);a=parseInt(a,10);var b=this._readableState,c=a;a!==0&&(b.emittedReadable=!1);if(a===0&&b.needReadable&&(b.length>=b.highWaterMark||b.ended)){s("read: emitReadable",b.length,b.ended);b.length===0&&b.ended?Z(this):M(this);return null}a=I(a,b);if(a===0&&b.ended){b.length===0&&Z(this);return null}var d=b.needReadable;s("need readable",d);(b.length===0||b.length-a<b.highWaterMark)&&(d=!0,s("length less than watermark",d));b.ended||b.reading?(d=!1,s("reading or ended",d)):d&&(s("do read"),b.reading=!0,b.sync=!0,b.length===0&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=I(c,b)));a>0?d=V(a,b):d=null;d===null?(b.needReadable=!0,a=0):b.length-=a;b.length===0&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&Z(this));d!==null&&this.emit("data",d);return d};function J(a,b){if(b.ended)return;if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0;M(a)}function M(a){var c=a._readableState;c.needReadable=!1;c.emittedReadable||(s("emitReadable",c.flowing),c.emittedReadable=!0,c.sync?b.nextTick(N,a):N(a))}function N(a){s("emit readable"),a.emit("readable"),U(a)}function O(a,c){c.readingMore||(c.readingMore=!0,b.nextTick(P,a,c))}function P(a,b){var c=b.length;while(!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark){s("maybeReadMore read 0");a.read(0);if(c===b.length)break;else c=b.length}b.readingMore=!1}A.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))};A.prototype.pipe=function(a,c){var d=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=a;break;case 1:f.pipes=[f.pipes,a];break;default:f.pipes.push(a);break}f.pipesCount+=1;s("pipe count=%d opts=%j",f.pipesCount,c);c=(!c||c.end!==!1)&&a!==process.stdout&&a!==process.stderr;c=c?h:q;f.endEmitted?b.nextTick(c):d.once("end",c);a.on("unpipe",g);function g(a,b){s("onunpipe"),a===d&&(b&&b.hasUnpiped===!1&&(b.hasUnpiped=!0,k()))}function h(){s("onend"),a.end()}var i=Q(d);a.on("drain",i);var j=!1;function k(){s("cleanup"),a.removeListener("close",o),a.removeListener("finish",p),a.removeListener("drain",i),a.removeListener("error",n),a.removeListener("unpipe",g),d.removeListener("end",h),d.removeListener("end",q),d.removeListener("data",m),j=!0,f.awaitDrain&&(!a._writableState||a._writableState.needDrain)&&i()}var l=!1;d.on("data",m);function m(b){s("ondata");l=!1;b=a.write(b);!1===b&&!l&&((f.pipesCount===1&&f.pipes===a||f.pipesCount>1&&aa(f.pipes,a)!==-1)&&!j&&(s("false write response, pause",d._readableState.awaitDrain),d._readableState.awaitDrain++,l=!0),d.pause())}function n(b){s("onerror",b),q(),a.removeListener("error",n),e(a,"error")===0&&a.emit("error",b)}y(a,"error",n);function o(){a.removeListener("finish",p),q()}a.once("close",o);function p(){s("onfinish"),a.removeListener("close",o),q()}a.once("finish",p);function q(){s("unpipe"),d.unpipe(a)}a.emit("pipe",d);f.flowing||(s("pipe resume"),d.resume());return a};function Q(a){return function(){var b=a._readableState;s("pipeOnDrain",b.awaitDrain);b.awaitDrain&&b.awaitDrain--;b.awaitDrain===0&&e(a,"data")&&(b.flowing=!0,U(a))}}A.prototype.unpipe=function(a){var b=this._readableState,c={hasUnpiped:!1};if(b.pipesCount===0)return this;if(b.pipesCount===1){if(a&&a!==b.pipes)return this;a||(a=b.pipes);b.pipes=null;b.pipesCount=0;b.flowing=!1;a&&a.emit("unpipe",this,c);return this}if(!a){var d=b.pipes,e=b.pipesCount;b.pipes=null;b.pipesCount=0;b.flowing=!1;for(var f=0;f<e;f++)d[f].emit("unpipe",this,c);return this}d=aa(b.pipes,a);if(d===-1)return this;b.pipes.splice(d,1);b.pipesCount-=1;b.pipesCount===1&&(b.pipes=b.pipes[0]);a.emit("unpipe",this,c);return this};A.prototype.on=function(a,c){c=f.prototype.on.call(this,a,c);if(a==="data")this._readableState.flowing!==!1&&this.resume();else if(a==="readable"){a=this._readableState;!a.endEmitted&&!a.readableListening&&(a.readableListening=a.needReadable=!0,a.emittedReadable=!1,!a.reading?b.nextTick(R,this):a.length&&M(this))}return c};A.prototype.addListener=A.prototype.on;function R(a){s("readable nexttick read 0"),a.read(0)}A.prototype.resume=function(){var a=this._readableState;a.flowing||(s("resume"),a.flowing=!0,S(this,a));return this};function S(a,c){c.resumeScheduled||(c.resumeScheduled=!0,b.nextTick(T,a,c))}function T(a,b){b.reading||(s("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),U(a),b.flowing&&!b.reading&&a.read(0)}A.prototype.pause=function(){s("call pause flowing=%j",this._readableState.flowing);!1!==this._readableState.flowing&&(s("pause"),this._readableState.flowing=!1,this.emit("pause"));return this};function U(a){var b=a._readableState;s("flow",b.flowing);while(b.flowing&&a.read()!==null);}A.prototype.wrap=function(a){var b=this,c=this._readableState,d=!1;a.on("end",function(){s("wrapped end");if(c.decoder&&!c.ended){var a=c.decoder.end();a&&a.length&&b.push(a)}b.push(null)});a.on("data",function(e){s("wrapped data");c.decoder&&(e=c.decoder.write(e));if(c.objectMode&&(e===null||e===void 0))return;else if(!c.objectMode&&(!e||!e.length))return;e=b.push(e);e||(d=!0,a.pause())});for(var e in a)this[e]===void 0&&typeof a[e]==="function"&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));for(e=0;e<w.length;e++)a.on(w[e],this.emit.bind(this,w[e]));this._read=function(b){s("wrapped _read",b),d&&(d=!1,a.resume())};return this};Object.defineProperty(A.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});A._fromList=V;function V(a,b){if(b.length===0)return null;var c;b.objectMode?c=b.buffer.shift():!a||a>=b.length?(b.decoder?c=b.buffer.join(""):b.buffer.length===1?c=b.buffer.head.data:c=b.buffer.concat(b.length),b.buffer.clear()):c=W(a,b.buffer,b.decoder);return c}function W(a,b,c){var d;a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):a===b.head.data.length?d=b.shift():d=c?X(a,b):Y(a,b);return d}function X(a,b){var c=b.head,d=1,e=c.data;a-=e.length;while(c=c.next){var f=c.data,g=a>f.length?f.length:a;g===f.length?e+=f:e+=f.slice(0,a);a-=g;if(a===0){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}b.length-=d;return e}function Y(a,b){var c=k.allocUnsafe(a),d=b.head,e=1;d.data.copy(c);a-=d.data.length;while(d=d.next){var f=d.data,g=a>f.length?f.length:a;f.copy(c,c.length-a,0,g);a-=g;if(a===0){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}b.length-=e;return c}function Z(a){var c=a._readableState;if(c.length>0)throw new Error('"endReadable()" called on non-empty stream');c.endEmitted||(c.ended=!0,b.nextTick($,c,a))}function $(a,b){!a.endEmitted&&a.length===0&&(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function aa(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}}var N=!1;function O(){N||(N=!0,M());return L.exports}c={};var P={exports:c};function Q(){P.exports=d;var a=F(),b=i();b.inherits=j();b.inherits(d,a);function c(a,b){var c=this._transformState;c.transforming=!1;var d=c.writecb;if(!d)return this.emit("error",new Error("write callback called multiple times"));c.writechunk=null;c.writecb=null;b!=null&&this.push(b);d(a);c=this._readableState;c.reading=!1;(c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}function d(b){if(!(this instanceof d))return new d(b);a.call(this,b);this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=!0;this._readableState.sync=!1;b&&(typeof b.transform==="function"&&(this._transform=b.transform),typeof b.flush==="function"&&(this._flush=b.flush));this.on("prefinish",e)}function e(){var a=this;typeof this._flush==="function"?this._flush(function(b,c){f(a,b,c)}):f(this,null,null)}d.prototype.push=function(b,c){this._transformState.needTransform=!1;return a.prototype.push.call(this,b,c)};d.prototype._transform=function(a,b,c){throw new Error("_transform() is not implemented")};d.prototype._write=function(a,b,c){var d=this._transformState;d.writecb=c;d.writechunk=a;d.writeencoding=b;if(!d.transforming){c=this._readableState;(d.needTransform||c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}};d.prototype._read=function(a){a=this._transformState;a.writechunk!==null&&a.writecb&&!a.transforming?(a.transforming=!0,this._transform(a.writechunk,a.writeencoding,a.afterTransform)):a.needTransform=!0};d.prototype._destroy=function(b,c){var d=this;a.prototype._destroy.call(this,b,function(a){c(a),d.emit("close")})};function f(a,b,c){if(b)return a.emit("error",b);c!=null&&a.push(c);if(a._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(a._transformState.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}}var R=!1;function S(){R||(R=!0,Q());return P.exports}b={};var T={exports:b};function U(){T.exports=c;var a=S(),b=i();b.inherits=j();b.inherits(c,a);function c(b){if(!(this instanceof c))return new c(b);a.call(this,b)}c.prototype._transform=function(a,b,c){c(null,a)}}var V=!1;function W(){V||(V=!0,U());return T.exports}d={};var X={exports:d};function Y(){var a={};process.env.READABLE_STREAM==="disable"&&a?(X.exports=a,d=X.exports=a.Readable,d.Readable=a.Readable,d.Writable=a.Writable,d.Duplex=a.Duplex,d.Transform=a.Transform,d.PassThrough=a.PassThrough,d.Stream=a):(d=X.exports=O(),d.Stream=a||d,d.Readable=d,d.Writable=B(),d.Duplex=F(),d.Transform=S(),d.PassThrough=W())}var Z=!1;function $(){Z||(Z=!0,Y());return X.exports}function f(a){switch(a){case void 0:return $()}}e.exports=f}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("set-immediate-shim-1.0.1",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){g.exports=typeof setImmediate==="function"?setImmediate:function(){var a=[].slice.apply(arguments);a.splice(1,0,0);setTimeout.apply(null,a)}}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/cr2jmG-CdKo/
 */
__d("jszip-3.2.0",["readable-stream-2.3.6","set-immediate-shim-1.0.1","lie-3.3.0","pako-1.0.8"],(function(a,b,c,d,e,f){"use strict";var g=b("readable-stream-2.3.6"),h=b("set-immediate-shim-1.0.1"),i=b("lie-3.3.0"),j=b("pako-1.0.8"),k={},l={exports:k};function m(){k.base64=!0;k.array=!0;k.string=!0;k.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";k.nodebuffer=typeof Buffer!=="undefined";k.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined")k.blob=!1;else{var a=new ArrayBuffer(0);try{k.blob=new Blob([a],{type:"application/zip"}).size===0}catch(c){try{var b=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;b=new b();b.append(a);k.blob=b.getBlob("application/zip").size===0}catch(a){k.blob=!1}}}try{k.nodestream=!!g().Readable}catch(a){k.nodestream=!1}}var n=!1;function o(){n||(n=!0,m());return l.exports}var p={},q={exports:p};function r(){var a=E(),b=o(),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";p.encode=function(b){var d=[],e,f,g,h,i=0,j=b.length,k=j,l=a.getTypeOf(b)!=="string";while(i<b.length)k=j-i,!l?(e=b.charCodeAt(i++),f=i<j?b.charCodeAt(i++):0,g=i<j?b.charCodeAt(i++):0):(e=b[i++],f=i<j?b[i++]:0,g=i<j?b[i++]:0),h=e>>2,e=(e&3)<<4|f>>4,f=k>1?(f&15)<<2|g>>6:64,g=k>2?g&63:64,d.push(c.charAt(h)+c.charAt(e)+c.charAt(f)+c.charAt(g));return d.join("")};p.decode=function(a){var d,e,f,g,h=0,i=0,j="data:";if(a.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j=a.length*3/4;a.charAt(a.length-1)===c.charAt(64)&&j--;a.charAt(a.length-2)===c.charAt(64)&&j--;if(j%1!==0)throw new Error("Invalid base64 input, bad content length.");var k;b.uint8array?k=new Uint8Array(j|0):k=new Array(j|0);while(h<a.length)j=c.indexOf(a.charAt(h++)),e=c.indexOf(a.charAt(h++)),f=c.indexOf(a.charAt(h++)),g=c.indexOf(a.charAt(h++)),j=j<<2|e>>4,e=(e&15)<<4|f>>2,d=(f&3)<<6|g,k[i++]=j,f!==64&&(k[i++]=e),g!==64&&(k[i++]=d);return k}}var s=!1;function t(){s||(s=!0,r());return q.exports}c={};var u={exports:c};function v(){u.exports={isNode:typeof Buffer!=="undefined",newBufferFrom:function(a,b){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,b);else{if(typeof a==="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,b)}},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);else{a=new Buffer(a);a.fill(0);return a}},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on==="function"&&typeof a.pause==="function"&&typeof a.resume==="function"}}}var w=!1;function x(){w||(w=!0,v());return u.exports}d={};var y={exports:d};function z(){var a;typeof Promise!=="undefined"?a=Promise:a=i();y.exports={Promise:a}}var A=!1;function B(){A||(A=!0,z());return y.exports}var C={},aa={exports:C};function ba(){var a=o(),b=t(),c=x(),d=h(),e=B();function f(b){var c;a.uint8array?c=new Uint8Array(b.length):c=new Array(b.length);return i(b,c)}C.newBlob=function(a,b){C.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var c=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;c=new c();c.append(a);return c.getBlob(b)}catch(a){throw new Error("Bug : can't construct the Blob.")}}};function g(a){return a}function i(a,b){for(var c=0;c<a.length;++c)b[c]=a.charCodeAt(c)&255;return b}var j={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);while(e<f)b==="array"||b==="nodebuffer"?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){var b="";for(var c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(a){return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,c.allocBuffer(1)).length===1}catch(a){return!1}}()}};function k(a){var b=65536,c=C.getTypeOf(a),d=!0;c==="uint8array"?d=j.applyCanBeUsed.uint8array:c==="nodebuffer"&&(d=j.applyCanBeUsed.nodebuffer);if(d)while(b>1)try{return j.stringifyByChunk(a,c,b)}catch(a){b=Math.floor(b/2)}return j.stringifyByChar(a)}C.applyFromCharCode=k;function l(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var m={};m.string={string:g,array:function(a){return i(a,new Array(a.length))},arraybuffer:function(a){return m.string.uint8array(a).buffer},uint8array:function(a){return i(a,new Uint8Array(a.length))},nodebuffer:function(a){return i(a,c.allocBuffer(a.length))}};m.array={string:k,array:g,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return c.newBufferFrom(a)}};m.arraybuffer={string:function(a){return k(new Uint8Array(a))},array:function(a){return l(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:g,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return c.newBufferFrom(new Uint8Array(a))}};m.uint8array={string:k,array:function(a){return l(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:g,nodebuffer:function(a){return c.newBufferFrom(a)}};m.nodebuffer={string:k,array:function(a){return l(a,new Array(a.length))},arraybuffer:function(a){return m.nodebuffer.uint8array(a).buffer},uint8array:function(a){return l(a,new Uint8Array(a.length))},nodebuffer:g};C.transformTo=function(a,b){b||(b="");if(!a)return b;C.checkSupport(a);var c=C.getTypeOf(b);c=m[c][a](b);return c};C.getTypeOf=function(b){if(typeof b==="string")return"string";if(Object.prototype.toString.call(b)==="[object Array]")return"array";if(a.nodebuffer&&c.isBuffer(b))return"nodebuffer";if(a.uint8array&&b instanceof Uint8Array)return"uint8array";if(a.arraybuffer&&b instanceof ArrayBuffer)return"arraybuffer"};C.checkSupport=function(b){var c=a[b.toLowerCase()];if(!c)throw new Error(b+" is not supported by this platform")};C.MAX_VALUE_16BITS=65535;C.MAX_VALUE_32BITS=-1;C.pretty=function(a){var b="",c,d;for(d=0;d<(a||"").length;d++)c=a.charCodeAt(d),b+="\\x"+(c<16?"0":"")+c.toString(16).toUpperCase();return b};C.delay=function(a,b,c){d(function(){a.apply(c||null,b||[])})};C.inherits=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c()};C.extend=function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&typeof a[c]==="undefined"&&(a[c]=arguments[b][c]);return a};C.prepareContent=function(c,d,g,h,i){d=e.Promise.resolve(d).then(function(b){var c=a.blob&&(b instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b))!==-1);if(c&&typeof FileReader!=="undefined")return new e.Promise(function(a,c){var d=new FileReader();d.onload=function(b){a(b.target.result)};d.onerror=function(a){c(a.target.error)};d.readAsArrayBuffer(b)});else return b});return d.then(function(a){var d=C.getTypeOf(a);if(!d)return e.Promise.reject(new Error("Can't read the data of '"+c+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));d==="arraybuffer"?a=C.transformTo("uint8array",a):d==="string"&&(i?a=b.decode(a):g&&(h!==!0&&(a=f(a))));return a})}}var D=!1;function E(){D||(D=!0,ba());return aa.exports}f={};var F={exports:f};function ca(){function a(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){if(this.isFinished)return!1;this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp());return!0},on:function(a,b){this._listeners[a].push(b);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo;this.mergeStreamInfo();this.previous=a;var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.end()});a.on("error",function(a){b.error(a)});return this},pause:function(){if(this.isPaused||this.isFinished)return!1;this.isPaused=!0;this.previous&&this.previous.pause();return!0},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;this.generatedError&&(this.error(this.generatedError),a=!0);this.previous&&this.previous.resume();return!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){this.extraStreamInfo[a]=b;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(a))continue;this.streamInfo[a]=this.extraStreamInfo[a]}},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;if(this.previous)return this.previous+" -> "+a;else return a}};F.exports=a}var G=!1;function H(){G||(G=!0,ca());return F.exports}var I={},da={exports:I};function ea(){var a=E(),b=o(),c=x(),d=H(),e=new Array(256);for(var f=0;f<256;f++)e[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;e[254]=e[254]=1;var g=function(c){var d,e,f,g,a,h=c.length,i=0;for(g=0;g<h;g++)e=c.charCodeAt(g),(e&64512)===55296&&g+1<h&&(f=c.charCodeAt(g+1),(f&64512)===56320&&(e=65536+(e-55296<<10)+(f-56320),g++)),i+=e<128?1:e<2048?2:e<65536?3:4;b.uint8array?d=new Uint8Array(i):d=new Array(i);for(a=0,g=0;a<i;g++)e=c.charCodeAt(g),(e&64512)===55296&&g+1<h&&(f=c.charCodeAt(g+1),(f&64512)===56320&&(e=65536+(e-55296<<10)+(f-56320),g++)),e<128?d[a++]=e:e<2048?(d[a++]=192|e>>>6,d[a++]=128|e&63):e<65536?(d[a++]=224|e>>>12,d[a++]=128|e>>>6&63,d[a++]=128|e&63):(d[a++]=240|e>>>18,d[a++]=128|e>>>12&63,d[a++]=128|e>>>6&63,d[a++]=128|e&63);return d},h=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);c=b-1;while(c>=0&&(a[c]&192)===128)c--;if(c<0)return b;return c===0?b:c+e[a[c]]>b?c:b},i=function(c){var b,d,f,g,h=c.length,i=new Array(h*2);for(d=0,b=0;b<h;){f=c[b++];if(f<128){i[d++]=f;continue}g=e[f];if(g>4){i[d++]=65533;b+=g-1;continue}f&=g===2?31:g===3?15:7;while(g>1&&b<h)f=f<<6|c[b++]&63,g--;if(g>1){i[d++]=65533;continue}f<65536?i[d++]=f:(f-=65536,i[d++]=55296|f>>10&1023,i[d++]=56320|f&1023)}i.length!==d&&(i.subarray?i=i.subarray(0,d):i.length=d);return a.applyFromCharCode(i)};I.utf8encode=function(a){return b.nodebuffer?c.newBufferFrom(a,"utf-8"):g(a)};I.utf8decode=function(c){if(b.nodebuffer)return a.transformTo("nodebuffer",c).toString("utf-8");c=a.transformTo(b.uint8array?"uint8array":"array",c);return i(c)};function j(){d.call(this,"utf-8 decode"),this.leftOver=null}a.inherits(j,d);j.prototype.processChunk=function(c){var d=a.transformTo(b.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(b.uint8array){var e=d;d=new Uint8Array(e.length+this.leftOver.length);d.set(this.leftOver,0);d.set(e,this.leftOver.length)}else d=this.leftOver.concat(d);this.leftOver=null}e=h(d);var f=d;e!==d.length&&(b.uint8array?(f=d.subarray(0,e),this.leftOver=d.subarray(e,d.length)):(f=d.slice(0,e),this.leftOver=d.slice(e,d.length)));this.push({data:I.utf8decode(f),meta:c.meta})};j.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:I.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};I.Utf8DecodeWorker=j;function k(){d.call(this,"utf-8 encode")}a.inherits(k,d);k.prototype.processChunk=function(a){this.push({data:I.utf8encode(a.data),meta:a.meta})};I.Utf8EncodeWorker=k}var J=!1;function K(){J||(J=!0,ea());return da.exports}b={};var L={exports:b};function fa(){var a=H(),b=E();function c(b){a.call(this,"ConvertWorker to "+b),this.destType=b}b.inherits(c,a);c.prototype.processChunk=function(a){this.push({data:b.transformTo(this.destType,a.data),meta:a.meta})};L.exports=c}var M=!1;function ga(){M||(M=!0,fa());return L.exports}c={};var N={exports:c};function ha(){var a=g().Readable,b=E();b.inherits(c,a);function c(b,c,d){a.call(this,c);this._helper=b;var e=this;b.on("data",function(a,b){e.push(a)||e._helper.pause(),d&&d(b)}).on("error",function(a){e.emit("error",a)}).on("end",function(){e.push(null)})}c.prototype._read=function(){this._helper.resume()};N.exports=c}var O=!1;function ia(){O||(O=!0,ha());return N.exports}d={};var P={exports:d};function ja(){var a=E(),b=ga(),c=H(),d=t(),e=o(),f=B(),g=null;if(e.nodestream)try{g=ia()}catch(a){}function h(b,c,e){switch(b){case"blob":return a.newBlob(a.transformTo("arraybuffer",c),e);case"base64":return d.encode(c);default:return a.transformTo(b,c)}}function i(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":e=new Uint8Array(f);for(c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function j(a,b){return new f.Promise(function(c,d){var e=[],f=a._internalType,g=a._outputType,j=a._mimeType;a.on("data",function(a,c){e.push(a),b&&b(c)}).on("error",function(a){e=[],d(a)}).on("end",function(){try{var a=h(g,i(f,e),j);c(a)}catch(a){d(a)}e=[]}).resume()})}function k(d,e,f){var g=e;switch(e){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string";break}try{this._internalType=g,this._outputType=e,this._mimeType=f,a.checkSupport(g),this._worker=d.pipe(new b(g)),d.lock()}catch(a){this._worker=new c("error"),this._worker.error(a)}}k.prototype={accumulate:function(a){return j(this,a)},on:function(b,c){var d=this;b==="data"?this._worker.on(b,function(a){c.call(d,a.data,a.meta)}):this._worker.on(b,function(){a.delay(c,arguments,d)});return this},resume:function(){a.delay(this._worker.resume,[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(b){a.checkSupport("nodestream");if(this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},b)}};P.exports=k}var Q=!1;function R(){Q||(Q=!0,ja());return P.exports}var S={},ka={exports:S};function la(){S.base64=!1,S.binary=!1,S.dir=!1,S.createFolders=!0,S.date=null,S.compression=null,S.compressionOptions=null,S.comment=null,S.unixPermissions=null,S.dosPermissions=null}var T=!1;function U(){T||(T=!0,la());return ka.exports}f={};var V={exports:f};function ma(){var a=E(),b=H(),c=16*1024;function d(c){b.call(this,"DataWorker");var d=this;this.dataIsReady=!1;this.index=0;this.max=0;this.data=null;this.type="";this._tickScheduled=!1;c.then(function(b){d.dataIsReady=!0,d.data=b,d.max=b&&b.length||0,d.type=a.getTypeOf(b),d.isPaused||d._tickAndRepeat()},function(a){d.error(a)})}a.inherits(d,b);d.prototype.cleanUp=function(){b.prototype.cleanUp.call(this),this.data=null};d.prototype.resume=function(){if(!b.prototype.resume.call(this))return!1;!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this));return!0};d.prototype._tickAndRepeat=function(){this._tickScheduled=!1;if(this.isPaused||this.isFinished)return;this._tick();this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)};d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=c,b=null;a=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();else{switch(this.type){case"string":b=this.data.substring(this.index,a);break;case"uint8array":b=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":b=this.data.slice(this.index,a);break}this.index=a;return this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})}};V.exports=d}var na=!1;function oa(){na||(na=!0,ma());return V.exports}b={};var pa={exports:b};function qa(){var a=E(),b=H();function c(a){b.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}a.inherits(c,b);c.prototype.processChunk=function(a){if(a){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+a.data.length}b.prototype.processChunk.call(this,a)};pa.exports=c}var ra=!1;function sa(){ra||(ra=!0,qa());return pa.exports}c={};var ta={exports:c};function ua(){var a=E();function b(){var a,b=[];for(var c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}var c=b();function d(a,b,d,e){var f=c;d=e+d;a=a^-1;for(e=e;e<d;e++)a=a>>>8^f[(a^b[e])&255];return a^-1}function e(a,b,d,e){var f=c;d=e+d;a=a^-1;for(e=e;e<d;e++)a=a>>>8^f[(a^b.charCodeAt(e))&255];return a^-1}ta.exports=function(b,c){if(typeof b==="undefined"||!b.length)return 0;var f=a.getTypeOf(b)!=="string";if(f)return d(c|0,b,b.length,0);else return e(c|0,b,b.length,0)}}var va=!1;function W(){va||(va=!0,ua());return ta.exports}d={};var wa={exports:d};function xa(){var a=H(),b=W(),c=E();function d(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}c.inherits(d,a);d.prototype.processChunk=function(a){this.streamInfo.crc32=b(a.data,this.streamInfo.crc32||0),this.push(a)};wa.exports=d}var ya=!1;function za(){ya||(ya=!0,xa());return wa.exports}f={};var Aa={exports:f};function Ba(){var a=B(),b=oa(),c=sa(),d=za(),c=sa();function e(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}e.prototype={getContentWorker:function(){var d=new b(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),e=this;d.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")});return d},getCompressedWorker:function(){return new b(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};e.createWorkerFrom=function(a,b,e){return a.pipe(new d()).pipe(new c("uncompressedSize")).pipe(b.compressWorker(e)).pipe(new c("compressedSize")).withStreamInfo("compression",b)};Aa.exports=e}var Ca=!1;function X(){Ca||(Ca=!0,Ba());return Aa.exports}b={};var Da={exports:b};function Ea(){var a=R(),b=oa(),c=K(),d=X(),e=H(),f=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};f.prototype={internalStream:function(b){var d=null,f="string";try{if(!b)throw new Error("No output type specified.");f=b.toLowerCase();b=f==="string"||f==="text";(f==="binarystring"||f==="text")&&(f="string");d=this._decompressWorker();var g=!this._dataBinary;g&&!b&&(d=d.pipe(new c.Utf8EncodeWorker()));!g&&b&&(d=d.pipe(new c.Utf8DecodeWorker()))}catch(a){d=new e("error"),d.error(a)}return new a(d,f,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof d&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();else{var e=this._decompressWorker();this._dataBinary||(e=e.pipe(new c.Utf8EncodeWorker()));return d.createWorkerFrom(e,a,b)}},_decompressWorker:function(){if(this._data instanceof d)return this._data.getContentWorker();else if(this._data instanceof e)return this._data;else return new b(this._data)}};var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var i=0;i<g.length;i++)f.prototype[g[i]]=h;Da.exports=f}var Fa=!1;function Ga(){Fa||(Fa=!0,Ea());return Da.exports}var Y={},Ha={exports:Y};function Ia(){var a=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined",b=j(),c=E(),d=H(),e=a?"uint8array":"array";Y.magic="\b\0";function f(a,b){d.call(this,"FlateWorker/"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}c.inherits(f,d);f.prototype.processChunk=function(a){this.meta=a.meta,this._pako===null&&this._createPako(),this._pako.push(c.transformTo(e,a.data),!1)};f.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)};f.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null};f.prototype._createPako=function(){this._pako=new b[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}};Y.compressWorker=function(a){return new f("Deflate",a)};Y.uncompressWorker=function(){return new f("Inflate",{})}}var Ja=!1;function Ka(){Ja||(Ja=!0,Ia());return Ha.exports}var Z={},La={exports:Z};function Ma(){var a=H();Z.STORE={magic:"\0\0",compressWorker:function(b){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}};Z.DEFLATE=Ka()}var Na=!1;function Oa(){Na||(Na=!0,Ma());return La.exports}var $={},Pa={exports:$};function Qa(){$.LOCAL_FILE_HEADER="PK\x03\x04",$.CENTRAL_FILE_HEADER="PK\x01\x02",$.CENTRAL_DIRECTORY_END="PK\x05\x06",$.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",$.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",$.DATA_DESCRIPTOR="PK\x07\b"}var Ra=!1;function Sa(){Ra||(Ra=!0,Qa());return Pa.exports}c={};var Ta={exports:c};function Ua(){var a=E(),b=H(),c=K(),d=W(),e=Sa(),f=function(a,b){var c="",d;for(d=0;d<b;d++)c+=String.fromCharCode(a&255),a=a>>>8;return c},g=function(a,b){var c=a;a||(c=b?16893:33204);return(c&65535)<<16},h=function(a,b){return(a||0)&63},i=function(b,i,j,k,l,m){var n=b.file,o=b.compression,p=m!==c.utf8encode,q=a.transformTo("string",m(n.name)),r=a.transformTo("string",c.utf8encode(n.name)),s=n.comment;m=a.transformTo("string",m(s));var t=a.transformTo("string",c.utf8encode(s)),u=r.length!==n.name.length;s=t.length!==s.length;var v="",w="",x="",y=n.dir,z=n.date,A={crc32:0,compressedSize:0,uncompressedSize:0};(!i||j)&&(A.crc32=b.crc32,A.compressedSize=b.compressedSize,A.uncompressedSize=b.uncompressedSize);j=0;i&&(j|=8);!p&&(u||s)&&(j|=2048);b=0;i=0;y&&(b|=16);l==="UNIX"?(i=798,b|=g(n.unixPermissions,y)):(i=20,b|=h(n.dosPermissions));p=z.getUTCHours();p=p<<6;p=p|z.getUTCMinutes();p=p<<5;p=p|z.getUTCSeconds()/2;l=z.getUTCFullYear()-1980;l=l<<4;l=l|z.getUTCMonth()+1;l=l<<5;l=l|z.getUTCDate();u&&(w=f(1,1)+f(d(q),4)+r,v+="up"+f(w.length,2)+w);s&&(x=f(1,1)+f(d(m),4)+t,v+="uc"+f(x.length,2)+x);y="";y+="\n\0";y+=f(j,2);y+=o.magic;y+=f(p,2);y+=f(l,2);y+=f(A.crc32,4);y+=f(A.compressedSize,4);y+=f(A.uncompressedSize,4);y+=f(q.length,2);y+=f(v.length,2);n=e.LOCAL_FILE_HEADER+y+q+v;z=e.CENTRAL_FILE_HEADER+f(i,2)+y+f(m.length,2)+"\0\0\0\0"+f(b,4)+f(k,4)+q+v+m;return{fileRecord:n,dirRecord:z}},j=function(b,c,d,g,h){h=a.transformTo("string",h(g));g=e.CENTRAL_DIRECTORY_END+"\0\0\0\0"+f(b,2)+f(b,2)+f(c,4)+f(d,4)+f(h.length,2)+h;return g},k=function(a){a=e.DATA_DESCRIPTOR+f(a.crc32,4)+f(a.compressedSize,4)+f(a.uncompressedSize,4);return a};function l(a,c,d,e){b.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=c,this.zipPlatform=d,this.encodeFileName=e,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(l,b);l.prototype.push=function(a){var c=a.meta.percent||0,d=this.entriesCount,e=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,b.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:d?(c+100*(d-e-1))/d:100}}))};l.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten;this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){a=i(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:a.fileRecord,meta:{percent:0}})}else this.accumulate=!0};l.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=i(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(c.dirRecord);if(b)this.push({data:k(a),meta:{percent:100}});else{this.push({data:c.fileRecord,meta:{percent:0}});while(this.contentBuffer.length)this.push(this.contentBuffer.shift())}this.currentFile=null};l.prototype.flush=function(){var a=this.bytesWritten;for(var b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});b=this.bytesWritten-a;b=j(this.dirRecords.length,b,a,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})};l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()};l.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()});a.on("error",function(a){b.error(a)});return this};l.prototype.resume=function(){if(!b.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length){this.prepareNextSource();return!0}if(!this.previous&&!this._sources.length&&!this.generatedError){this.end();return!0}};l.prototype.error=function(a){var c=this._sources;if(!b.prototype.error.call(this,a))return!1;for(var d=0;d<c.length;d++)try{c[d].error(a)}catch(a){}return!0};l.prototype.lock=function(){b.prototype.lock.call(this);var a=this._sources;for(var c=0;c<a.length;c++)a[c].lock()};Ta.exports=l}var Va=!1;function Wa(){Va||(Va=!0,Ua());return Ta.exports}var Xa={},Ya={exports:Xa};function Za(){var a=Oa(),b=Wa(),c=function(b,c){b=b||c;c=a[b];if(!c)throw new Error(b+" is not a valid compression method !");return c};Xa.generateWorker=function(a,d,e){var f=new b(d.streamFiles,e,d.platform,d.encodeFileName),g=0;try{a.forEach(function(a,b){g++;var e=c(b.options.compression,d.compression),h=b.options.compressionOptions||d.compressionOptions||{},i=b.dir,j=b.date;b._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(f)}),f.entriesCount=g}catch(a){f.error(a)}return f}}var $a=!1;function ab(){$a||($a=!0,Za());return Ya.exports}d={};var bb={exports:d};function cb(){var a=E(),b=H();function c(a,c){b.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(c)}a.inherits(c,b);c.prototype._bindStream=function(a){var b=this;this._stream=a;a.pause();a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})};c.prototype.pause=function(){if(!b.prototype.pause.call(this))return!1;this._stream.pause();return!0};c.prototype.resume=function(){if(!b.prototype.resume.call(this))return!1;this._upstreamEnded?this.end():this._stream.resume();return!0};bb.exports=c}var db=!1;function eb(){db||(db=!0,cb());return bb.exports}f={};var fb={exports:f};function gb(){var a=K(),b=E(),c=H(),d=R(),e=U(),f=X(),g=Ga(),h=ab(),i=x(),j=eb(),k=function(a,d,h){var k=b.getTypeOf(d),o,p=b.extend(h||{},e);p.date=p.date||new Date();p.compression!==null&&(p.compression=p.compression.toUpperCase());typeof p.unixPermissions==="string"&&(p.unixPermissions=parseInt(p.unixPermissions,8));p.unixPermissions&&p.unixPermissions&16384&&(p.dir=!0);p.dosPermissions&&p.dosPermissions&16&&(p.dir=!0);p.dir&&(a=m(a));p.createFolders&&(o=l(a))&&n.call(this,o,!0);var q=k==="string"&&p.binary===!1&&p.base64===!1;(!h||typeof h.binary==="undefined")&&(p.binary=!q);h=d instanceof f&&d.uncompressedSize===0;(h||p.dir||!d||d.length===0)&&(p.base64=!1,p.binary=!0,d="",p.compression="STORE",k="string");d instanceof f||d instanceof c?q=d:i.isNode&&i.isStream(d)?q=new j(a,d):q=b.prepareContent(a,d,p.binary,p.optimizedBinaryString,p.base64);h=new g(a,q,p);this.files[a]=h},l=function(a){a.slice(-1)==="/"&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},m=function(a){a.slice(-1)!=="/"&&(a+="/");return a},n=function(a,b){b=typeof b!=="undefined"?b:e.createFolders;a=m(a);this.files[a]||k.call(this,a,null,{dir:!0,createFolders:b});return this.files[a]};function o(a){return Object.prototype.toString.call(a)==="[object RegExp]"}var p={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files){if(!this.files.hasOwnProperty(b))continue;d=this.files[b];c=b.slice(this.root.length,b.length);c&&b.slice(0,this.root.length)===this.root&&a(c,d)}},filter:function(a){var b=[];this.forEach(function(c,d){a(c,d)&&b.push(d)});return b},file:function(a,b,c){if(arguments.length===1)if(o(a)){var d=a;return this.filter(function(a,b){return!b.dir&&d.test(a)})}else{var e=this.files[this.root+a];if(e&&!e.dir)return e;else return null}else a=this.root+a,k.call(this,a,b,c);return this},folder:function(a){if(!a)return this;if(o(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a;b=n.call(this,b);var c=this.clone();c.root=b.name;return c},remove:function(a){a=this.root+a;var b=this.files[a];b||(a.slice(-1)!=="/"&&(a+="/"),b=this.files[a]);if(b&&!b.dir)delete this.files[a];else{b=this.filter(function(c,b){return b.name.slice(0,a.length)===a});for(var c=0;c<b.length;c++)delete this.files[b[c].name]}return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var f,g={};try{g=b.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode});g.type=g.type.toLowerCase();g.compression=g.compression.toUpperCase();g.type==="binarystring"&&(g.type="string");if(!g.type)throw new Error("No output type specified.");b.checkSupport(g.type);(g.platform==="darwin"||g.platform==="freebsd"||g.platform==="linux"||g.platform==="sunos")&&(g.platform="UNIX");g.platform==="win32"&&(g.platform="DOS");e=g.comment||this.comment||"";f=h.generateWorker(this,g,e)}catch(a){f=new c("error"),f.error(a)}return new d(f,g.type||"string",g.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){a=a||{};a.type||(a.type="nodebuffer");return this.generateInternalStream(a).toNodejsStream(b)}};fb.exports=p}var hb=!1;function ib(){hb||(hb=!0,gb());return fb.exports}b={};var jb={exports:b};function kb(){var a=E();function b(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}b.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b=0,c;this.checkOffset(a);for(c=this.index+a-1;c>=this.index;c--)b=(b<<8)+this.byteAt(c);this.index+=a;return b},readString:function(b){return a.transformTo("string",this.readData(b))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}};jb.exports=b}var lb=!1;function mb(){lb||(lb=!0,kb());return jb.exports}c={};var nb={exports:c};function ob(){var a=mb(),b=E();function c(b){a.call(this,b);for(var c=0;c<this.data.length;c++)b[c]=b[c]&255}b.inherits(c,a);c.prototype.byteAt=function(a){return this.data[this.zero+a]};c.prototype.lastIndexOfSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2);a=a.charCodeAt(3);for(var e=this.length-4;e>=0;--e)if(this.data[e]===b&&this.data[e+1]===c&&this.data[e+2]===d&&this.data[e+3]===a)return e-this.zero;return-1};c.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2);a=a.charCodeAt(3);var e=this.readData(4);return b===e[0]&&c===e[1]&&d===e[2]&&a===e[3]};c.prototype.readData=function(a){this.checkOffset(a);if(a===0)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};nb.exports=c}var pb=!1;function qb(){pb||(pb=!0,ob());return nb.exports}d={};var rb={exports:d};function sb(){var a=mb(),b=E();function c(b){a.call(this,b)}b.inherits(c,a);c.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)};c.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero};c.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b};c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};rb.exports=c}var tb=!1;function ub(){tb||(tb=!0,sb());return rb.exports}f={};var vb={exports:f};function wb(){var a=qb(),b=E();function c(b){a.call(this,b)}b.inherits(c,a);c.prototype.readData=function(a){this.checkOffset(a);if(a===0)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};vb.exports=c}var xb=!1;function yb(){xb||(xb=!0,wb());return vb.exports}b={};var zb={exports:b};function Ab(){var a=yb(),b=E();function c(b){a.call(this,b)}b.inherits(c,a);c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};zb.exports=c}var Bb=!1;function Cb(){Bb||(Bb=!0,Ab());return zb.exports}c={};var Db={exports:c};function Eb(){var a=E(),b=o(),c=qb(),d=ub(),e=Cb(),f=yb();Db.exports=function(g){var h=a.getTypeOf(g);a.checkSupport(h);if(h==="string"&&!b.uint8array)return new d(g);if(h==="nodebuffer")return new e(g);return b.uint8array?new f(a.transformTo("uint8array",g)):new c(a.transformTo("array",g))}}var Fb=!1;function Gb(){Fb||(Fb=!0,Eb());return Db.exports}d={};var Hb={exports:d};function Ib(){var a=Gb(),b=E(),c=X(),d=W(),e=K(),f=Oa(),g=o(),h=0,i=3,j=function(a){for(var b in f){if(!f.hasOwnProperty(b))continue;if(f[b].magic===a)return f[b]}return null};function k(a,b){this.options=a,this.loadOptions=b}k.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(a){var d;a.skip(22);this.fileNameLength=a.readInt(2);d=a.readInt(2);this.fileName=a.readData(this.fileNameLength);a.skip(d);if(this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");d=j(this.compressionMethod);if(d===null)throw new Error("Corrupted zip : compression "+b.pretty(this.compressionMethod)+" unknown (inner file : "+b.transformTo("string",this.fileName)+")");this.decompressed=new c(this.compressedSize,this.uncompressedSize,this.crc32,d,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2);a.skip(2);this.bitFlag=a.readInt(2);this.compressionMethod=a.readString(2);this.date=a.readDate();this.crc32=a.readInt(4);this.compressedSize=a.readInt(4);this.uncompressedSize=a.readInt(4);var b=a.readInt(2);this.extraFieldsLength=a.readInt(2);this.fileCommentLength=a.readInt(2);this.diskNumberStart=a.readInt(2);this.internalFileAttributes=a.readInt(2);this.externalFileAttributes=a.readInt(4);this.localHeaderOffset=a.readInt(4);if(this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b);this.readExtraFields(a);this.parseZIP64ExtraField(a);this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null;this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?!0:!1;a===h&&(this.dosPermissions=this.externalFileAttributes&63);a===i&&(this.unixPermissions=this.externalFileAttributes>>16&65535);!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(c){if(!this.extraFields[1])return;c=a(this.extraFields[1].value);this.uncompressedSize===b.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8));this.compressedSize===b.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8));this.localHeaderOffset===b.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8));this.diskNumberStart===b.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))},readExtraFields:function(a){var b=a.index+this.extraFieldsLength,c,d,e;this.extraFields||(this.extraFields={});while(a.index<b)c=a.readInt(2),d=a.readInt(2),e=a.readData(d),this.extraFields[c]={id:c,length:d,value:e}},handleUTF8:function(){var a=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=e.utf8decode(this.fileName),this.fileCommentStr=e.utf8decode(this.fileComment);else{var c=this.findExtraFieldUnicodePath();if(c!==null)this.fileNameStr=c;else{c=b.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}c=this.findExtraFieldUnicodeComment();if(c!==null)this.fileCommentStr=c;else{c=b.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(c)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var c=a(b.value);if(c.readInt(1)!==1)return null;return d(this.fileName)!==c.readInt(4)?null:e.utf8decode(c.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var c=a(b.value);if(c.readInt(1)!==1)return null;return d(this.fileComment)!==c.readInt(4)?null:e.utf8decode(c.readData(b.length-5))}return null}};Hb.exports=k}var Jb=!1;function Kb(){Jb||(Jb=!0,Ib());return Hb.exports}f={};var Lb={exports:f};function Mb(){var a=Gb(),b=E(),c=Sa(),d=Kb();K();var e=o();function f(a){this.files=[],this.loadOptions=a}f.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var c=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+b.pretty(c)+", expected "+b.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);a=this.reader.readString(4);a=a===b;this.reader.setIndex(c);return a},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),c=e.uint8array?"uint8array":"array";c=b.transformTo(c,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var a=this.zip64EndOfCentralSize-44,b=0,c,d,e;while(b<a)c=this.reader.readInt(2),d=this.reader.readInt(4),e=this.reader.readData(d),this.zip64ExtensibleData[c]={id:c,length:d,value:e}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;this.reader.setIndex(this.centralDirOffset);while(this.reader.readAndCheckSignature(c.CENTRAL_FILE_HEADER))a=new d({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&(this.centralDirRecords!==0&&this.files.length===0))throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(a<0){var d=!this.isSignature(0,c.LOCAL_FILE_HEADER);if(d)throw new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");else throw new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(a);d=a;this.checkSignature(c.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===b.MAX_VALUE_16BITS||this.diskWithCentralDirStart===b.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===b.MAX_VALUE_16BITS||this.centralDirRecords===b.MAX_VALUE_16BITS||this.centralDirSize===b.MAX_VALUE_32BITS||this.centralDirOffset===b.MAX_VALUE_32BITS){this.zip64=!0;a=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(a<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");this.reader.setIndex(a);this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,c.ZIP64_CENTRAL_DIRECTORY_END)){this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_END);if(this.relativeOffsetEndOfZip64CentralDir<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory")}this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a+=20,a+=12+this.zip64EndOfCentralSize);a=d-a;if(a>0)this.isSignature(d,c.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(a<0)throw new Error("Corrupted zip: missing "+Math.abs(a)+" bytes.")},prepareReader:function(b){this.reader=a(b)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};Lb.exports=f}var Nb=!1;function Ob(){Nb||(Nb=!0,Mb());return Lb.exports}b={};var Pb={exports:b};function Qb(){var a=E(),b=B(),c=K(),a=E(),d=Ob(),e=za(),f=x();function g(a){return new b.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new e());d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}Pb.exports=function(e,h){var i=this;h=a.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:c.utf8decode});return f.isNode&&f.isStream(e)?b.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",e,!0,h.optimizedBinaryString,h.base64).then(function(a){var b=new d(h);b.load(a);return b}).then(function(a){var c=[b.Promise.resolve(a)];a=a.files;if(h.checkCRC32)for(var d=0;d<a.length;d++)c.push(g(a[d]));return b.Promise.all(c)}).then(function(a){a=a.shift();var b=a.files;for(var c=0;c<b.length;c++){var d=b[c];i.file(d.fileNameStr,d.decompressed,{binary:!0,optimizedBinaryString:!0,date:d.date,dir:d.dir,comment:d.fileCommentStr.length?d.fileCommentStr:null,unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions,createFolders:h.createFolders})}a.zipComment.length&&(i.comment=a.zipComment);return i})}}var Rb=!1;function Sb(){Rb||(Rb=!0,Qb());return Pb.exports}c={};var Tb={exports:c};function Ub(){function a(){if(!(this instanceof a))return new a();if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var b=new a();for(var c in this)typeof this[c]!=="function"&&(b[c]=this[c]);return b}}a.prototype=ib();a.prototype.loadAsync=Sb();a.support=o();a.defaults=U();a.version="3.2.0";a.loadAsync=function(b,c){return new a().loadAsync(b,c)};a.external=B();Tb.exports=a}var Vb=!1;function Wb(){Vb||(Vb=!0,Ub());return Tb.exports}function a(a){switch(a){case void 0:return Wb()}}e.exports=a}),null);
__d("jszip",["jszip-3.2.0"],(function(a,b,c,d,e,f){e.exports=b("jszip-3.2.0")()}),null);/*FB_PKG_DELIM*/
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={};a.internalSpec={externalId:[1,(d=d("WAProtoConst")).TYPES.STRING],author:[2,d.TYPES.STRING],chat:[3,d.TYPES.STRING]};b.internalSpec={fromMe:[1,d.TYPES.BOOL],id:[2,d.TYPES.STRING]};c.internalSpec={key:[1,d.TYPES.MESSAGE,b],ts:[2,d.TYPES.INT64]};e.internalSpec={lastMessageTimestamp:[1,d.TYPES.INT64],lastSystemMessageTimestamp:[2,d.TYPES.INT64],messages:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c]};f.internalSpec={type:[1,d.TYPES.STRING],chatJid:[2,d.TYPES.STRING],archived:[3,d.TYPES.BOOL],ts:[4,d.TYPES.INT64],messageRange:[5,d.TYPES.MESSAGE,e],read:[6,d.TYPES.BOOL]};h.internalSpec={type:[1,d.TYPES.STRING],protocolMsgId:[2,d.TYPES.MESSAGE,a]};i.internalSpec={chatAction:[1,d.TYPES.MESSAGE,f],messageAction:[2,d.TYPES.MESSAGE,h],__oneofs__:{action:["chatAction","messageAction"]}};j.internalSpec={actions:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};k.internalSpec={id:[1,d.TYPES.UINT64],anonId:[2,d.TYPES.BYTES],rootKey:[3,d.TYPES.BYTES],status:[4,d.TYPES.INT32]};l.internalSpec={backupId:[1,d.TYPES.UINT64],serverDataId:[2,d.TYPES.UINT64],epoch:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,k],tempOcmfClientState:[4,d.TYPES.BYTES],mailboxRootKey:[5,d.TYPES.BYTES],obliviousValidationToken:[6,d.TYPES.BYTES]};m.internalSpec={currentIndex:[1,d.TYPES.UINT32],deviceIndexes:[2,d.FLAGS.REPEATED|d.TYPES.UINT32],rawId:[3,d.TYPES.UINT32]};n.internalSpec={keyId:[1,d.TYPES.BYTES],keyData:[2,d.TYPES.BYTES],keyEpoch:[3,d.TYPES.UINT32],timestamp:[4,d.TYPES.INT64],fingerprint:[5,d.TYPES.MESSAGE,m]};o.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,n],orphanKeys:[2,d.FLAGS.REPEATED|d.TYPES.BYTES]};p.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};q.internalSpec={type:[1,d.TYPES.STRING],actions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],encryptedBackupsSecrets:[3,d.TYPES.MESSAGE,l],syncKeyShare:[4,d.TYPES.MESSAGE,o],syncKeyRequest:[5,d.TYPES.MESSAGE,p]};r.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};s.internalSpec={externalId:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64],contents:[3,d.TYPES.MESSAGE,q],permittedIdentitiesPerDevice:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,r],ack:[5,d.TYPES.INT32],appDataId:[6,d.TYPES.INT32],recipientDevices:[7,d.FLAGS.REPEATED|d.TYPES.STRING],sendPartial:[8,d.TYPES.BOOL]};g.ProtocolMsgIdSpec=a;g.MetaSyncMessageKeyProtoSpec=b;g.MetaSyncMessageProtoSpec=c;g.MetaSyncMessageRangeProtoSpec=e;g.MetaSyncChatActionProtoSpec=f;g.MetaSyncMessageActionProtoSpec=h;g.MetaSyncActionProtoSpec=i;g.MetaSyncAppDataProtoSpec=j;g.EncryptedBackupsSecretsEpochProtoSpec=k;g.EncryptedBackupsSecretsProtoSpec=l;g.FingerprintProtoSpec=m;g.SyncKeyDataProtoSpec=n;g.SyncKeyShareProtoSpec=o;g.SyncKeyRequestProtoSpec=p;g.AppDataProtoSpec=q;g.IdentitiesPerDeviceProtoSpec=r;g.AppDataTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={msgTypeVersion:[1,(c=d("WAProtoConst")).TYPES.INT32],hmacKey:[2,c.TYPES.BYTES],allowSecurityAlert:[3,c.TYPES.BOOL],hotlikeSticker:[4,c.TYPES.BYTES],isBackfilledForOccamadillo:[5,c.TYPES.BOOL],allowSecurityAlertForSelf:[11,c.TYPES.BOOL],hasMigratedFromDexie:[12,c.TYPES.BOOL],restoreMigrationAttempts:[13,c.TYPES.INT32],deviceJid:[14,c.TYPES.STRING],restoreToDexieMigrationComplete:[15,c.TYPES.BOOL]};b.internalSpec={key:[1,c.TYPES.STRING],value:[2,c.TYPES.MESSAGE,a]};g.DbAppMetaValuesProtoSpec=a;g.AppMetaTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={collection:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.INT32],state:[3,b.TYPES.STRING],finiteFailureStartTime:[4,b.TYPES.INT64],ltHash:[5,b.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,b.TYPES.BOOL],isCollectionLthashInconsistent:[7,b.TYPES.BOOL]};g.CollectionVersionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};a.internalSpec={ephemeralExpirationInSec:[1,(d=d("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,d.TYPES.INT64]};b.internalSpec={syncResponseRetries:[1,d.TYPES.INT32],syncResponseSentTs:[2,d.TYPES.INT64]};c.internalSpec={sequence:[1,d.TYPES.INT64],timestamp:[2,d.TYPES.INT64],devices:[3,d.FLAGS.REPEATED|d.TYPES.BYTES],signingDeviceIndex:[4,d.TYPES.INT64],dirty:[5,d.TYPES.BOOL]};e.internalSpec={timeBucket:[1,d.TYPES.INT64],alert:[2,d.TYPES.BOOL]};f.internalSpec={contactJid:[1,d.TYPES.STRING],dhash:[3,d.TYPES.STRING],nameForSearch:[4,d.TYPES.STRING],ephemeralSetting:[5,d.TYPES.MESSAGE,a],isBlocked:[6,d.TYPES.BOOL],lastSyncTs:[7,d.TYPES.INT64],icdcInfo:[8,d.TYPES.MESSAGE,c],ephemeralSyncResponseBackoffInfo:[9,d.TYPES.MESSAGE,b],icdcFails:[10,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],relationship:[11,d.TYPES.INT32],isRestricted:[12,d.TYPES.BOOL]};g.EphemeralSettingProtoSpec=a;g.EphemeralSyncResponseBackoffInfoSpec=b;g.ICDCInfoProtoSpec=c;g.ICDCCheckFailSpec=e;g.ContactsTableSchemaProtoSpec=f}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],chat:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reason:[4,b.TYPES.STRING]};g.DeletedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={action:[1,(b=d("WAProtoConst")).TYPES.STRING],isArchived:[2,b.TYPES.BOOL],deviceChangeAlertsId:[3,b.TYPES.INT64],location:[4,b.TYPES.STRING],model:[5,b.TYPES.STRING],ts:[6,b.TYPES.INT64],loggedOut:[7,b.TYPES.BOOL],deviceJid:[8,b.TYPES.STRING],identity:[9,b.TYPES.BYTES],platform:[10,b.TYPES.STRING],latitude:[11,b.TYPES.STRING],longitude:[12,b.TYPES.STRING],isConfirmed:[13,b.TYPES.BOOL],isNotified:[14,b.TYPES.BOOL]};g.DeviceChangeAlertsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={BACKUP_RESTORE:0,E2E_DYI:1};b={};b.internalSpec={batchId:[1,(c=d("WAProtoConst")).TYPES.INT32],numMessages:[2,c.TYPES.INT32],oldestTs:[3,c.TYPES.INT64],threadId:[4,c.TYPES.STRING],isThread:[5,c.TYPES.BOOL],numMessagesRestored:[6,c.TYPES.INT32],qplInstanceKeyForThread:[7,c.TYPES.INT64],qplFlowDescriptor:[8,c.TYPES.ENUM,a],qplInstanceKeyE2E:[9,c.TYPES.INT64],numThreadsRestored:[10,c.TYPES.INT64]};g.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=a;g.DyiBatchTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={rangeId:[1,(b=d("WAProtoConst")).TYPES.UINT32],threadJid:[2,b.TYPES.STRING],minMsgExternalId:[3,b.TYPES.STRING],maxMsgExternalId:[4,b.TYPES.STRING],minMsgSortOrderMs:[5,b.TYPES.UINT64],maxMsgSortOrderMs:[6,b.TYPES.UINT64]};g.EBMsgRangesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={},l={},m={};a.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,h.FLAGS.REPEATED|h.TYPES.STRING],adminType:[3,h.TYPES.STRING],obsoleteExpiration:[4,h.TYPES.INT32],obsoleteTs:[5,h.TYPES.INT64],subtype:[6,h.TYPES.STRING],protobuf:[7,h.TYPES.BYTES],screenshotActionType:[8,h.TYPES.INT32],authorName:[9,h.TYPES.STRING],version:[10,h.TYPES.INT32],mentionedJids:[11,h.FLAGS.REPEATED|h.TYPES.STRING]};b.internalSpec={frankingTag:[1,h.TYPES.BYTES],frankingVersion:[2,h.TYPES.INT32],reportingContent:[3,h.TYPES.BYTES],reportingTag:[4,h.TYPES.BYTES],frankingKey:[5,h.TYPES.BYTES]};c.internalSpec={remoteJid:[1,h.TYPES.STRING],content:[2,h.TYPES.MESSAGE,l]};e.internalSpec={duration:[1,h.TYPES.INT32],width:[2,h.TYPES.INT32],height:[3,h.TYPES.INT32],mimetype:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],jpegThumbnailHeight:[6,h.TYPES.INT32],jpegThumbnailWidth:[7,h.TYPES.INT32]};f.internalSpec={width:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],jpegThumbnail:[3,h.TYPES.BYTES],jpegThumbnailHeight:[4,h.TYPES.INT32],jpegThumbnailWidth:[5,h.TYPES.INT32]};i.internalSpec={duration:[1,h.TYPES.INT32],mimetype:[2,h.TYPES.STRING],played:[3,h.TYPES.BOOL]};j.internalSpec={filename:[1,h.TYPES.STRING],mimetype:[2,h.TYPES.STRING]};k.internalSpec={mediaType:[1,h.TYPES.STRING],plaintextHash:[2,h.TYPES.STRING],size:[3,h.TYPES.INT32],ts:[4,h.TYPES.INT64],mediaEntry:[5,h.TYPES.BYTES],validatedVideoInfo:[6,h.TYPES.MESSAGE,e],validatedImageInfo:[7,h.TYPES.MESSAGE,f],validatedAudioInfo:[8,h.TYPES.MESSAGE,i],validatedDocumentFileInfo:[9,h.TYPES.MESSAGE,j]};l.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],author:[4,h.TYPES.STRING],msgContent:[5,h.TYPES.MESSAGE,a],obsoleteMedia:[6,h.TYPES.MESSAGE,k],msgId:[7,h.TYPES.STRING],mediaId:[8,h.TYPES.INT32],sourceId:[9,h.TYPES.STRING],xmaMessageType:[10,h.TYPES.INT32],specialTextSize:[11,h.TYPES.INT32]};m.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],msgId:[4,h.TYPES.STRING],author:[5,h.TYPES.STRING],ack:[6,h.TYPES.INT32],resendCount:[7,h.TYPES.INT32],msgContent:[8,h.TYPES.MESSAGE,a],altIndex:[9,h.TYPES.STRING],forwardingScore:[10,h.TYPES.INT32],quote:[11,h.TYPES.MESSAGE,c],messageExpirationTs:[12,h.TYPES.INT64],ephemeralSetting:[13,h.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,h.TYPES.STRING],isForwarded:[15,h.TYPES.BOOL],originalTs:[17,h.TYPES.INT64],sortOrderMs:[18,h.TYPES.INT64],reportingMeta:[19,h.TYPES.MESSAGE,b],messageDeleteTs:[20,h.TYPES.INT64],ephemeralCounterStarted:[21,h.TYPES.BOOL],quoteExternalId:[22,h.TYPES.STRING],unsendMsgContentDeleteTs:[23,h.TYPES.INT64],rowId:[24,h.TYPES.INT32],thread:[25,h.TYPES.INT32],mediaId:[26,h.TYPES.INT32],ephemeralMsgDisappeared:[27,h.TYPES.BOOL],threadJid:[28,h.TYPES.STRING],xmaId:[29,h.TYPES.INT32],specialTextSize:[30,h.TYPES.INT32],xmaMessageType:[31,h.TYPES.INT32],isExpiredXmaMsg:[32,h.TYPES.BOOL],ravenEphemeralType:[33,h.TYPES.INT32],ravenEphemeralMediaState:[34,h.TYPES.INT32],editCount:[35,h.TYPES.INT32],groupId:[36,h.TYPES.STRING],groupIndex:[37,h.TYPES.INT64],groupSize:[38,h.TYPES.INT64]};g.MsgContentProtoSpec=a;g.ReportingMetaProtoSpec=b;g.DbQuotedMsgProtoSpec=c;g.VideoMsgContentProtoSpec=e;g.ImageMsgContentProtoSpec=f;g.AudioMsgContentProtoSpec=i;g.DocumentFileMsgContentProtoSpec=j;g.QuotedDbMediaProtoSpec=k;g.DbQuotedMsgContentProtoSpec=l;g.MessagesTableSchemaProtoSpec=m}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,b.TYPES.INT32],editTs:[3,b.TYPES.INT64],msgContent:[4,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,b.TYPES.STRING],specialTextSize:[6,b.TYPES.INT32],threadJid:[7,b.TYPES.STRING],editExternalId:[8,b.TYPES.STRING],sendStatus:[9,b.TYPES.INT32]};g.EditMsgHistoryTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadId:[2,b.TYPES.INT32],creator:[3,b.TYPES.STRING],creationTs:[4,b.TYPES.INT64],name:[5,b.TYPES.STRING],nameOwner:[6,b.TYPES.STRING],nameTs:[7,b.TYPES.INT64],msgExpiration:[8,b.TYPES.INT32],participantVersion:[9,b.TYPES.STRING],inviter:[10,b.TYPES.STRING],memberAddMode:[11,b.TYPES.STRING]};g.GroupInfoSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={inviterJid:[1,(b=d("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,b.TYPES.STRING],inviteCode:[3,b.TYPES.STRING],inviteExpirationTs:[4,b.TYPES.INT64],caption:[5,b.TYPES.STRING]};g.GroupInvitesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={};a.internalSpec={plaintextHash:[1,(d=d("WAProtoConst")).TYPES.STRING],blobData:[2,d.TYPES.BYTES],mimetype:[3,d.TYPES.STRING],hashedPlaintextHash:[4,d.TYPES.STRING],chunkId:[5,d.TYPES.INT32]};b.internalSpec={mediaBackupId:[1,d.TYPES.INT32],mediaId:[2,d.TYPES.INT32],objectId:[3,d.TYPES.STRING],msgId:[4,d.TYPES.STRING],fbid:[5,d.TYPES.STRING]};c.internalSpec={msgId:[1,d.TYPES.STRING],mediaEntryData:[2,d.TYPES.BYTES]};e.internalSpec={duration:[1,d.TYPES.UINT32],width:[2,d.TYPES.UINT32],height:[3,d.TYPES.UINT32],mimetype:[4,d.TYPES.STRING],jpegThumbnail:[5,d.TYPES.BYTES],jpegThumbnailHeight:[6,d.TYPES.UINT32],jpegThumbnailWidth:[7,d.TYPES.UINT32],thumbnailPlaintextHash:[8,d.TYPES.STRING]};f.internalSpec={width:[1,d.TYPES.UINT32],height:[2,d.TYPES.UINT32],jpegThumbnail:[3,d.TYPES.BYTES],jpegThumbnailHeight:[4,d.TYPES.UINT32],jpegThumbnailWidth:[5,d.TYPES.UINT32],thumbnailPlaintextHash:[6,d.TYPES.STRING]};h.internalSpec={duration:[1,d.TYPES.UINT32],mimetype:[2,d.TYPES.STRING],played:[3,d.TYPES.BOOL]};i.internalSpec={filename:[1,d.TYPES.STRING],mimetype:[2,d.TYPES.STRING]};j.internalSpec={mediaType:[1,d.TYPES.STRING],plaintextHash:[2,d.TYPES.STRING],size:[3,d.TYPES.UINT64],mediaEntries:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],ts:[5,d.TYPES.INT64],validatedVideoInfo:[6,d.TYPES.MESSAGE,e],validatedImageInfo:[7,d.TYPES.MESSAGE,f],validatedAudioInfo:[8,d.TYPES.MESSAGE,h],hashedPlaintextHash:[9,d.TYPES.STRING],mediaId:[10,d.TYPES.INT32],msgIds:[11,d.FLAGS.REPEATED|d.TYPES.STRING],objectId:[12,d.TYPES.STRING],fbid:[13,d.TYPES.STRING],validatedDocumentFileInfo:[14,d.TYPES.MESSAGE,i]};g.ChunkTableSchemaProtoSpec=a;g.MediaBackupSchemaProtoSpec=b;g.MediaEntriesProtoSpec=c;g.VideoMsgContentProtoSpec=e;g.ImageMsgContentProtoSpec=f;g.AudioMsgContentProtoSpec=h;g.DocumentFileMsgContentProtoSpec=i;g.MediaTableSchemaProtoSpec=j}),98);
__d("MAWArmadilloMetaRowTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={};a.internalSpec={encryptedSerializedCat:[1,(d=d("WAProtoConst")).TYPES.STRING],expirationTimeInSeconds:[2,d.TYPES.INT32]};b.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};c.internalSpec={intValue:[1,d.TYPES.INT32],strValue:[2,d.TYPES.STRING],boolValue:[3,d.TYPES.BOOL],__oneofs__:{value:["intValue","strValue","boolValue"]}};e.internalSpec={name:[1,d.TYPES.STRING],value:[2,d.TYPES.MESSAGE,c]};f.internalSpec={expoKey:[1,d.TYPES.INT32],value:[2,d.TYPES.STRING]};h.internalSpec={abKey:[1,d.TYPES.STRING],abHash:[2,d.TYPES.STRING],lastSyncTime:[3,d.TYPES.INT64],expoKeyStr:[4,d.TYPES.STRING],refresh:[5,d.TYPES.INT64],internalExpoKeys:[6,d.FLAGS.REPEATED|d.TYPES.STRING],propExpoKeys:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f],propValues:[8,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e]};i.internalSpec={key:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],notAfter:[2,d.FLAGS.REQUIRED|d.TYPES.INT32],notBefore:[3,d.FLAGS.REQUIRED|d.TYPES.INT32]};j.internalSpec={leaf:[1,d.TYPES.MESSAGE,i],intermediate:[2,d.TYPES.MESSAGE,i]};k.internalSpec={cat:[1,d.TYPES.MESSAGE,a],deviceUUID:[2,d.TYPES.STRING],regId:[3,d.TYPES.INT32],identityKeyPair:[4,d.TYPES.MESSAGE,b],fbid:[5,d.TYPES.STRING],deviceId:[6,d.TYPES.INT32],lastSignedPrekeyId:[7,d.TYPES.INT32],lastPrekeyId:[8,d.TYPES.INT32],lastPrekeyGenerationId:[9,d.TYPES.INT32],edgeInfo:[10,d.TYPES.BYTES],clockSkew:[11,d.TYPES.INT32],msgrDeviceId:[12,d.TYPES.STRING],abProps:[13,d.TYPES.MESSAGE,h],registrationVersion:[14,d.TYPES.INT32],authKeyPair:[15,d.TYPES.MESSAGE,b],certificateChain:[16,d.TYPES.MESSAGE,j],lastSessionDeviceWasLinkedTo:[17,d.TYPES.STRING],restoreMigrationAttempts:[18,d.TYPES.INT32],__oneofs__:{value:["cat","deviceUUID","regId","identityKeyPair","fbid","deviceId","lastSignedPrekeyId","lastPrekeyId","lastPrekeyGenerationId","edgeInfo","clockSkew","msgrDeviceId","abProps","registrationVersion","authKeyPair","certificateChain","lastSessionDeviceWasLinkedTo","restoreMigrationAttempts"]}};l.internalSpec={key:[1,d.TYPES.STRING],value:[2,d.TYPES.MESSAGE,k]};g.ValidCatProtoSpec=a;g.KeyPairProtoSpec=b;g.AbPropTypeSpec=c;g.AbPropValueSpec=e;g.ExpoKeyMapSpec=f;g.AbPropsConfigSpec=h;g.CertificateDetailsSpec=i;g.CertificateChainSpec=j;g.ValueProtoSpec=k;g.MetaRowTableSchemaProtoSpec=l}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={deviceId:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceResponse:[2,c.TYPES.BOOL]};b.internalSpec={keyHex:[1,c.TYPES.STRING],keyId:[2,c.TYPES.BYTES],timestamp:[3,c.TYPES.INT64],deviceResponses:[4,c.FLAGS.REPEATED|c.TYPES.MESSAGE,a]};g.DeviceResponseSpec=a;g.MissingKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={id:[1,(b=d("WAProtoConst")).TYPES.STRING],userJid:[2,b.TYPES.STRING],deliveredWatermarkTs:[3,b.TYPES.INT64],lastReadWatermarkTs:[4,b.TYPES.INT64],type:[5,b.TYPES.STRING],addressable:[6,b.TYPES.BOOL],lastReadActionTs:[7,b.TYPES.INT64],threadId:[9,b.TYPES.INT32],threadJid:[10,b.TYPES.STRING]};g.ParticipantsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={SET:0,REMOVE:1};b={};b.internalSpec={id:[1,(c=d("WAProtoConst")).TYPES.INT32],collection:[2,c.TYPES.STRING],index:[3,c.TYPES.STRING],binarySyncAction:[4,c.TYPES.BYTES],version:[5,c.TYPES.INT32],operation:[6,c.TYPES.ENUM,a],timestamp:[7,c.TYPES.INT64],action:[8,c.TYPES.STRING]};g.SYNCD_MUTATION_SYNCD_OPERATION=a;g.PendingMutationsTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],senderKeyId:[2,b.TYPES.INT32],rotateSenderKey:[4,b.TYPES.BOOL],senderKeyTs:[5,b.TYPES.INT64],hasSenderKey:[6,b.FLAGS.REPEATED|b.TYPES.STRING]};g.PersonalSenderKeyStatusTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={ack:[1,(b=d("WAProtoConst")).TYPES.INT32],author:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reactionId:[4,b.TYPES.STRING],reactToExternalId:[5,b.TYPES.STRING],reactToAuthor:[6,b.TYPES.STRING],reactToMsgId:[7,b.TYPES.STRING],threadJid:[8,b.TYPES.STRING],reaction:[9,b.TYPES.STRING],groupingKey:[10,b.TYPES.STRING],ts:[11,b.TYPES.INT64],rowId:[12,b.TYPES.INT32],senderTimestampMs:[13,b.TYPES.INT64]};g.ReactionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={};a.internalSpec={deliveredTs:[1,(d=d("WAProtoConst")).TYPES.INT64],readTs:[2,d.TYPES.INT64]};b.internalSpec={userJid:[1,d.TYPES.STRING],dbUserStatusTs:[2,d.TYPES.MESSAGE,a]};c.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};e.internalSpec={deviceJid:[1,d.TYPES.STRING],count:[2,d.TYPES.INT32]};f.internalSpec={msgId:[1,d.TYPES.STRING],statusTsPerUser:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,b],permittedIdentitiesPerDevice:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],recipientDevices:[4,d.FLAGS.REPEATED|d.TYPES.STRING],retryCountsPerDevice:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],waMsgId:[6,d.TYPES.STRING]};h.internalSpec={device:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64]};i.internalSpec={pendingReceiptId:[1,d.TYPES.STRING],thread:[2,d.TYPES.STRING],externalId:[3,d.TYPES.STRING],author:[4,d.TYPES.STRING],deliveryReceipts:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h],readReceipts:[6,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h]};g.DbUserStatusTsProtoSpec=a;g.StatusTsPerUserProtoSpec=b;g.IdentitiesPerDeviceProtoSpec=c;g.RetryCountPerDeviceProtoSpec=e;g.ReceiptsTableSchemaProtoSpec=f;g.ReceiptsSpec=h;g.PendingReceiptsTableSchemaProtoSpec=i}),98);
__d("MAWArmadilloSignalTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={};a.internalSpec={deviceJid:[1,(d=d("WAProtoConst")).TYPES.STRING],identity:[2,d.TYPES.BYTES],firstSeenTs:[3,d.TYPES.INT64],deviceName:[4,d.TYPES.STRING],platform:[5,d.TYPES.STRING],userJid:[6,d.TYPES.STRING]};b.internalSpec={keyId:[1,d.TYPES.INT32],encoded:[2,d.TYPES.BYTES],isDeleted:[3,d.TYPES.BOOL]};c.internalSpec={generationId:[1,d.TYPES.INT32],startingId:[2,d.TYPES.INT32],endingId:[3,d.TYPES.INT32],createdTs:[4,d.TYPES.INT64]};e.internalSpec={id:[1,d.TYPES.STRING],session:[2,d.TYPES.BYTES]};f.internalSpec={keyId:[1,d.TYPES.INT32],encoded:[2,d.TYPES.BYTES]};h.internalSpec={id:[1,d.TYPES.STRING],groupJid:[2,d.TYPES.STRING],userJid:[3,d.TYPES.STRING],deviceId:[4,d.TYPES.INT32],record:[5,d.TYPES.BYTES]};g.IdentityTableSchemaProtoSpec=a;g.PrekeyTableSchemaProtoSpec=b;g.PrekeyGenerationTableSchemaProtoSpec=c;g.SessionTableSchemaProtoSpec=e;g.SignedPrekeyTableSchemaProtoSpec=f;g.SenderKeySessionsTableSchemaProtoSpec=h}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={index:[1,(b=d("WAProtoConst")).TYPES.STRING],binarySyncData:[2,b.TYPES.BYTES],actionState:[3,b.TYPES.STRING],version:[4,b.TYPES.INT32],keyId:[5,b.TYPES.BYTES],modelId:[6,b.TYPES.STRING],modelType:[7,b.TYPES.STRING],indexMac:[8,b.TYPES.BYTES],valueMac:[9,b.TYPES.BYTES],collection:[10,b.TYPES.STRING],timestamp:[11,b.TYPES.INT64],action:[12,b.TYPES.STRING]};g.SyncActionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={currentIndex:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,c.FLAGS.REPEATED|c.TYPES.INT32],rawId:[3,c.TYPES.INT64]};b.internalSpec={id:[1,c.TYPES.BYTES],keyId:[2,c.TYPES.BYTES],keyData:[3,c.TYPES.BYTES],keyEpoch:[4,c.TYPES.INT64],timestamp:[5,c.TYPES.INT64],fingerprint:[6,c.TYPES.MESSAGE,a]};g.SyncKeyFingerprintSpec=a;g.SyncKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={taskName:[1,d("WAProtoConst").TYPES.STRING],scheduledTime:[2,d("WAProtoConst").TYPES.INT64]};g.TasksTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={jid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadOrder:[2,b.TYPES.STRING],folder:[4,b.TYPES.INT32],newestMsg:[5,b.TYPES.STRING],oldestMsg:[6,b.TYPES.STRING],lastReadMsg:[7,b.TYPES.STRING],lastReadMsgReceiptSent:[8,b.TYPES.STRING],lastReadMsgTs:[9,b.TYPES.INT64],newestMsgTs:[10,b.TYPES.INT64],muteExpireTimeMs:[11,b.TYPES.INT64],muteCallsExpireTimeMs:[12,b.TYPES.INT64],archived:[13,b.TYPES.BOOL],cannotReplyReason:[14,b.TYPES.STRING],chatId:[15,b.TYPES.INT32],optimisticThreadKey:[16,b.TYPES.STRING],isMigratedLocally:[17,b.TYPES.BOOL],snippetMsg:[18,b.TYPES.STRING],deduplicationKey:[19,b.TYPES.STRING],authoritativeThreadKey:[20,b.TYPES.STRING],snippetMsgTs:[21,b.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,b.TYPES.BOOL]};g.ThreadsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={type:[1,(b=d("WAProtoConst")).TYPES.STRING],ts:[2,b.TYPES.INT64],externalId:[3,b.TYPES.STRING],msgId:[4,b.TYPES.STRING],author:[5,b.TYPES.STRING],ack:[6,b.TYPES.INT32],resendCount:[7,b.TYPES.INT32],ephemeralSetting:[8,b.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,b.TYPES.INT64],rowId:[10,b.TYPES.INT32],thread:[11,b.TYPES.INT32],mediaId:[12,b.TYPES.INT32],msgContent:[13,b.TYPES.STRING],threadJid:[14,b.TYPES.STRING],reportingMeta:[15,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,b.TYPES.STRING],groupName:[17,b.TYPES.STRING],quote:[18,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,b.TYPES.INT32],sortOrderMs:[20,b.TYPES.INT64]};g.UnrenderedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={associatedMessageId:[1,(c=d("WAProtoConst")).TYPES.STRING],author:[2,c.TYPES.STRING],ctas:[3,c.FLAGS.REPEATED|c.TYPES.MESSAGE,b],defaultCTA:[4,c.TYPES.MESSAGE,b],defaultPreviewMediaId:[5,c.TYPES.INT32],externalId:[6,c.TYPES.STRING],faviconMediaId:[7,c.TYPES.INT32],headerMediaId:[8,c.TYPES.INT32],headerTitle:[9,c.TYPES.STRING],isTombstoned:[10,c.TYPES.BOOL],maxSubtitleNumOfLines:[11,c.TYPES.INT32],maxTitleNumOfLines:[12,c.TYPES.INT32],msgId:[13,c.TYPES.STRING],overlayDescription:[14,c.TYPES.STRING],overlayIconGlyph:[15,c.TYPES.INT32],overlayTitle:[16,c.TYPES.STRING],previewMediaIds:[17,c.FLAGS.REPEATED|c.TYPES.INT32],subtitleText:[18,c.TYPES.STRING],targetExpiringAtSec:[19,c.TYPES.INT64],targetId:[20,c.TYPES.STRING],targetType:[21,c.TYPES.INT32],targetUsername:[22,c.TYPES.STRING],threadJid:[23,c.TYPES.STRING],titleText:[24,c.TYPES.STRING],xmaId:[25,c.TYPES.INT32],xmaLayoutType:[26,c.TYPES.INT32]};b.internalSpec={buttonType:[1,c.TYPES.INT32],title:[2,c.TYPES.STRING],actionUrl:[3,c.TYPES.STRING],nativeUrl:[4,c.TYPES.STRING],ctaType:[5,c.TYPES.STRING]};g.XMATableSchemaProtoSpec=a;g.CTAProtoSpec=b}),98);
__d("MAWDBRestoreConfig",["ReStoreDbConfigStore"],(function(a,b,c,d,e,f,g){"use strict";var h={lockVersion:9,name:d("ReStoreDbConfigStore").DB_CONFIG_KEY};function a(){return{defaultConfig:h,isEqual:function(a){return(a==null?void 0:a.lockVersion)==null?!1:(a==null?void 0:a.lockVersion)===h.lockVersion}}}g.createConfig=a}),98);
__d("MAWDataSyncQueue",["MAWQplProxy","Promise","WALogger","asyncToGeneratorRuntime","qex","qpl","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""]);i=function(){return a};return a}var j=c("qex")._("853")||1e3;a=c("qex")._("855")||1e3;e=function(){m=!1;return r({isUnloading:!0})};var k=[],l=[],m=!1,n=[],o=function(){var a,b=k.splice(0,k.length);(a=l).push.apply(a,b)},p=function(){return l.splice(0,j)},q=function a(c,e){var f=p();if(f.length===0)return;c.addPoint("processing_batch");return(h||(h=b("Promise"))).all(n.map(function(a,b){return a(f,e)["catch"](function(a){d("WALogger").ERROR(i(),b,a)})})).then(function(){return a(c,e)})},r=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(m)return;m=!0;var b=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056849784,"272"));b.addPoint("processing_queue",{"int":{queueSize:k.length}});o();try{yield q(b,a),b.endSuccess()}catch(a){b.endFail("handler_failed_execution");throw a}finally{m=!1,k.length>0&&s()}});return function(b){return a.apply(this,arguments)}}(),s=c("throttle")(r,a);f=function(a,b){k.push({type:a,value:b}),s()};a=function(a){n.some(function(b){return b===a})||n.push(a)};var t=function(){n=[]},u=function(){k=[],l=[]},v=function(){return k};g.forceFlushDataSyncQueue=e;g.addSyncItem=f;g.registerDataSyncCallback=a;g.clearDataSyncCallbacks=t;g.clearDataSyncQueue_FOR_TESTING_ONLY=u;g.getDataSyncQueue_FOR_TESTING_ONLY=v}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(["contacts","groupInfo","messages","participants","threads","reactions","dyiBatch","xma","pendingStanzas"]);function i(a,b){var c=a.table(b);return!h.has(b)?c:babelHelpers["extends"]({},c,{mutate:function(a){return c.mutate(a).then(function(c){if(a.type==="delete"){a.keys.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b})});return c}else c.results!=null?c.results.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b,values:a.values})}):c.lastResult!=null&&d("MAWDataSyncQueue").addSyncItem(a.type,{key:c.lastResult,tableName:b,values:a.values});return c})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return i(a,b)}})}catch(b){c("FBLogger")("maw_db").catching(b).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers");return a}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}g.getDataSyncMiddleware=a}),98);
__d("MAWDbAppMeta",[],(function(a,b,c,d,e,f){"use strict";a={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};f.AppMetaKeysEnum=a}),66);
__d("MAWDbParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a+"_"+b}f.craftParticipantId=a}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+b}g.craftThreadOrder=a}),98);
__d("MAWDexieTable",["Promise","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(a)}function a(a){return a.reduce(function(a,b,c){return a.then(function(a){return b(c).then(function(b){a.push(b);return a})})},n([]))}function e(a){return c("dexie_maw").Promise.all(a)}function f(a){return c("dexie_maw").Promise.allSettled(a)}function j(a){return c("dexie_maw").Promise.PSD[a]}function k(a,b){c("dexie_maw").Promise.PSD[a]=b}function l(a){c("dexie_maw").Promise.PSD[a]=void 0}var m=function(){function a(a,b,d,e){d===void 0&&(d=!0);e=new(c("dexie_maw"))(a,babelHelpers["extends"]({chromeTransactionDurability:"relaxed"},e));b(e);this.name=a;this.stores=e;d&&this.open()}var b=a.prototype;b.open=function(){this.stores.open()};b.close=function(){this.stores.close()};b.transact=function(a,b,c){var d=this;return i(this.stores.transaction(a,b.map(function(a){return d.stores[a]}),function(){return c()}))};babelHelpers.createClass(a,[{key:"tables",get:function(){return this.stores.tables}}]);return a}();function n(a){return c("dexie_maw").Promise.resolve(a)}function o(a){return c("dexie_maw").waitFor(a)}g.DEXIE_MIN_KEY=d("dexie_maw").Dexie.minKey;g.DEXIE_MAX_KEY=d("dexie_maw").Dexie.maxKey;g.undexify=i;g.dexieSequentialAll=a;g.dexieAll=e;g.dexieAllSettled=f;g.getDexiePSDItem=j;g.setDexiePSDItem=k;g.clearDexiePSDItem=l;g.DexieTable=m;g.dexieResolve=n;g.dexieExpensiveAwait=o}),98);
__d("WADbSignal",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){return a+"_"+b+"_"+c}b={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion"};({msgrDeviceId:"msgrDeviceId"});f.buildSenderKeySessionId=a;f.MetaKeysEnum=b}),66);
__d("MAWDbSchema.dexie",["MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","MAWWaitForBackendSetup","WADbSignal","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","dexie_maw","gkx","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""]);i=function(){return a};return a}a=function(a){var b=function(a){var b;b=(b=a.quote)==null?void 0:b.content;return a.quoteExternalId!=null&&(b==null?void 0:b.media)!=null};return a.messages.where("quoteExternalId").between(d("WAStanzaUtils").toStanzaId("0"),d("WAStanzaUtils").toStanzaId("["),!0,!0).filter(b).toArray()["catch"](function(){return a.messages.filter(b).toArray()}).then(function(b){var c=new Set(b.map(function(a){a=(a=a.quote)==null?void 0:a.content;return a==null?void 0:(a=a.media)==null?void 0:a.plaintextHash}).filter(Boolean)),d=b.map(function(a){a=a.msgId;return a});return a.media.filter(function(a){a=a.plaintextHash;return c.has(a)}).toArray().then(function(b){var c=new Map(b.map(function(a){var b=a.mediaId;a=a.plaintextHash;return[a,b]}));return a.messages.where("msgId").anyOf(d).modify(function(a){var b;b=(b=a.quote)==null?void 0:b.content;a.quote.content.mediaId=c.get(b.media.plaintextHash);delete a.quote.content.media})})})};b=function(a){return a.groupInfo.toCollection().modify(function(a){typeof a.inviter==="number"&&delete a.inviter})};e=function(a){return a.meta.get(d("WADbSignal").MetaKeysEnum.deviceId).then(function(b){var c;if((b==null?void 0:(c=b.value)==null?void 0:c.deviceId)!=null&&typeof b.value.deviceId!=="number")return a.meta.clear()})};f=function(a){return a.threads.filter(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(){return!1},user:function(){return a.oldestMsg!=null}})}).toArray().then(function(b){var c=[];b.forEach(function(a){c.push(a.oldestMsg),c.push(a.newestMsg)});return a.messages.where("msgId").anyOf(c.filter(Boolean)).toArray().then(function(c){var e=new Map(),f=[],g=[];c.forEach(function(a){e.set(a.msgId,a)});b.forEach(function(b){var c=e.get(b.oldestMsg),h=e.get(b.newestMsg);(c==null?void 0:c.type)==="Admin"&&(h==null?void 0:h.type)==="Admin"&&(c.msgId===h.msgId?g.push(b.chatId):f.push(b));return d("MAWDexieTable").dexieAll(f.map(function(b){return a.messages.where("thread").equals(b.chatId).toArray()})).then(function(b){b.forEach(function(a){if(a.length===0)return;var b=a[0].thread;a=a.filter(function(a){return a.type!=="Admin"});if(a.length>0)return;g.push(b)});return d("MAWDexieTable").dexieAll([a.threads.bulkDelete(g),a.messages.where("thread").anyOf(g)["delete"]()])})})})})};var j=function(a){return a.unrenderedMessages.toCollection().modify(function(a){if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var b=a.messageDeleteForMeTs;a.messageDeleteForMeTs=b}})},k=function(a){var b=0,e=0,f=c("dexie_maw").currentTransaction;if(f==null)throw c("unrecoverableViolation")("transaction does not exist","maw_db");f.on("complete",function(){c("promiseDone")(d("MAWWaitForBackendSetup").waitForBackendSetup("DB upgrade to V31").then(function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})}))});f.on("complete",function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})});return a.threads.toArray().then(function(c){var f=c.reduce(function(a,b){b!=null&&a.set(b.chatId,b);return a},new Map());return d("MAWDexieTable").dexieAll([a.messages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1}),a.unrenderedMessages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1})])})},l=function(a){return a.isDualSend.toCollection().modify(function(a){a.version==null&&(a.version=1)})},m=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(a.altIndex=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.thread))})},n=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},o=function(a){return a.threads.toCollection().modify(function(a){a.folder==null&&(a.folder=d("MAWFolderTypes").FOLDER_ID.INBOX)})},p=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},q=function(a){return a.personalSenderKeyStatuses.toCollection().modify(function(a){a.rotateSenderKey=!0,a.hasSenderKey=new Set()})},r=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&a.sortOrderMs!=null&&a.sortOrderMs>0&&(a.sortOrderMs=0)})},s=function(a){return a.messages.toCollection().modify(function(a){!(a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&a.sortOrderMs!=null&&a.sortOrderMs<1661204086&&(a.sortOrderMs=d("MAWDbMsg").getCanonicalTsFromMsg(a)*1e3)})},t=function(a){return a.threads.filter(function(a){return a.isMigratedLocally===!0&&a.newestMsg!=null}).toArray().then(function(b){var c=b.map(function(a){return a.chatId}),e=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,0],[b.chatId,Number.MAX_VALUE]).last().then(function(a){a!=null&&e.set(a.thread,a.msgId)})})).then(function(){return a.threads.where("chatId").anyOf(c).modify(function(a){var b=e.get(a.chatId);b!=null&&(a.newestMsg=b)})})})},u=function(a){return a.identity.toCollection().modify(function(a){a.userJid=d("WAJids").extractUserJid(a.deviceJid)})},v=function(a){return a.threads.toCollection().modify(function(a){a.lastReadMsgTs!=null&&a.lastReadMsgTs<d("WATimeUtils").MAX_INT&&(a.lastReadMsgTs=d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs));if(a.newestMsgTs!=null&&a.newestMsgTs<d("WATimeUtils").MAX_INT){var b=d("MAWTimeUtils").ensureValidMillisTime(a.newestMsgTs);a.newestMsgTs=b;b!=null&&(a.threadOrder=d("MAWDbThread").craftThreadOrder(b,a.jid))}})},w=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(a.altIndex=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(a.thread))})},x=function(a){return a.meta.get(d("WADbSignal").MetaKeysEnum.fbid).then(function(b){var c;if((b==null?void 0:(c=b.value)==null?void 0:c.fbid)!=null&&b.value.fbid==="0")return a.meta.clear()})},y=function(a){return a.prekey.filter(function(a){return a.isDeleted===!0})["delete"]()},z=function(a){return c("gkx")("23905")?a.meta.clear():d("MAWDexieTable").dexieResolve()},A=function(a){return a.participants.toCollection().modify(function(a){var b;if(a==null||((b=a.userJid)==null?void 0:b.indexOf("@msgr@msgr"))===!1)return;a.id=a.id.replace("@msgr@msgr","@msgr");a.userJid=a.userJid.replace("@msgr@msgr","@msgr")}).then(function(){})},B=function(a){var b=a.threads.filter(function(a){return a.snippetMsg!=null&&a.snippetMsgTs==null});return b.toArray().then(function(c){var e=c.reduce(function(a,b){b!=null&&b.snippetMsg!=null&&a.set(b.jid,b.snippetMsg);return a},new Map());c=Array.from(e.values());return a.messages.where("msgId").anyOf(c).toArray().then(function(a){var c=a.reduce(function(a,b){b!=null&&b.serverTs!=null&&a.set(b.msgId,b.serverTs);return a},new Map());b.modify(function(a){var b=e.get(a.jid);if(b!=null){b=c.get(b);b!=null&&(a.snippetMsgTs=d("WATimeUtils").castUnixTimeToMillisTime(b))}})})})},C=function(a){return a.threads.toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.participants.where("threadId").equals(b.chatId).modify(function(a){a.threadJid=(a=a.threadJid)!=null?a:b.jid})}))})},D=C,E=function(a){var b=[];return a.groupInvites.toArray().then(function(c){var d=c.map(function(a){return a.invitedParticipantId});return a.participants.bulkGet(d).then(function(d){d.forEach(function(a,d){if(a==null){a=c[d];b.push(a)}});var e=d.filter(Boolean);return a.groupInvites.bulkPut(c.map(function(a){var c=e.find(function(b){return b.id===a.invitedParticipantId});if(c!=null){a.inviteeJid=c.userJid;a.threadJid=c.threadJid;return babelHelpers["extends"]({},a,{inviteeJid:c.userJid,threadJid:c.threadJid})}else{b.push(a);return a}}))})}).then(function(){return a.groupInvites.bulkDelete(b.map(function(a){return[a.invitedParticipantId,a.inviterJid]}))})},F=function(a){var b=new Map();return a.receipts.toArray().then(function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){return a.messages.get({msgId:c.msgId}).then(function(e){if(e==null)return a.receipts["delete"](c.msgId).then(function(){});else{var f=d("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId});if(b.has(f)){var g;g=(g=b.get(f))!=null?g:1;b.set(f,g);d("WALogger").ERROR(i(),g);return a.receipts["delete"](c.msgId).then(function(){})}else{b.set(f,1);return a.receipts.where("msgId").equals(e.msgId).modify(function(a){a.waMsgId=f}).then(function(){})}}})}))})},G=function(a){var b=[];return a.contacts.toArray().then(function(c){for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;b.push({ephemeralSetting:f.ephemeralSetting,ephemeralSyncResponseBackoffInfo:f.ephemeralSyncResponseBackoffInfo,userJid:f.contactJid})}return a.ephemeralSettings.bulkPut(b)})},H=function(a){return a.participants.toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{id:d("MAWDbParticipant").craftParticipantId(a.threadJid,a.userJid)})});b=b.map(function(a){return a.id});return a.participants.bulkDelete(b).then(function(){a.participants.bulkPut(c)})})};a=new Map([[(h=d("MAWDbVersionList")).VERSION.V26,a],[h.VERSION.V27,b],[h.VERSION.V28,e],[h.VERSION.V29,f],[h.VERSION.V30,j],[h.VERSION.V31,k],[h.VERSION.V43,l],[h.VERSION.V44,m],[h.VERSION.V45,n],[h.VERSION.V46,o],[h.VERSION.V47,p],[h.VERSION.V53,q],[h.VERSION.V54,r],[h.VERSION.V55,s],[h.VERSION.V56,t],[h.VERSION.V57,u],[h.VERSION.V58,v],[h.VERSION.V60,w],[h.VERSION.V66,x],[h.VERSION.V68,y],[h.VERSION.V71,z],[h.VERSION.V72,A],[h.VERSION.V82,B],[h.VERSION.V85,C],[h.VERSION.V87,D],[h.VERSION.V90,E],[h.VERSION.V91,F],[h.VERSION.V101,G],[h.VERSION.V104,H]]);g.dbUpgrades=a}),98);
__d("MAWDbSchemaReStoreDexieUtils",["MAWDbSchema","MAWDbSchema.dexie","err","sortBy"],(function(a,b,c,d,e,f,g){"use strict";var h=c("sortBy")(Array.from(new Set([].concat(Array.from(d("MAWDbSchema").dbSchema.keys()),Array.from(d("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(a){return{schema:d("MAWDbSchema").dbSchema.get(a),upgrade:d("MAWDbSchema.dexie").dbUpgrades.get(a),version:a}}),function(a){a=a.version;return a}),i=function(a,b){return Array.from(a.filter(function(a){return a.version<=b&&a.schema!=null}).reduce(function(a,b){(b=b.schema)==null?void 0:b.forEach(function(b){a.set(b.name,b)});return a},new Map()).values())},j=function(a,b){return i(a,b).reduce(function(a,b){var d=b.autoIncrement,e=b.dexieOnly_primaryKeyUnique,f=b.name,g=b.primaryKey,h=b.removed;f=f.replace(/^e2ee_/,"");if(h===!0){a[f]=null;return a}if(d&&e===!0)throw c("err")("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(b));h=d?"++":"";d=e===!0?"&":"";e=""+(g.length>1?"[":"")+g.join("+")+(g.length>1?"]":"");g=Object.values(b.indexes).map(function(a){var b=a.columns,c=!(a.unique===!1),d=b.length>1;a=a.multiEntry_DO_NOT_USE===!0;c=c&&!a?"&":"";a=a?"*":"";c=""+c+a;return""+c+(d?"[":"")+b.join("+")+(d?"]":"")}).join(",");a[f]=[""+h+d+e,g].filter(Boolean).join(",");return a},{})};a=function(a){return j(h,a)};g.MAW_DB_VERSION_CHANGES=h;g.getDexieSchemaForVersion=j;g.getCompleteDexieSchemaForVersion=a}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWGetDbVersion","MAWIndexedDbMetadata","MAWReStoreDbSetup","MAWRestoreDbState","Promise","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["DB","VERSION"]);e=d("MAWGetDbVersion").getArmadilloDbVersion();f=d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,e>0?e:Infinity));function o(a,b){var c=b.schema,d=b.upgrade;b=b.version;c!=null&&d!=null?a.version(b).stores(c).upgrade(d):c!=null?a.version(b).stores(c):d!=null?a.version(b).upgrade(d):a.version(b);return b}function p(a){return new(h||(h=b("Promise")))(function(b){if(!indexedDB){b();return}var c=indexedDB.open(a);c.onupgradeneeded=function(a){a.target.transaction.abort();a=a.target.result;a==null?void 0:a.close();b()};c.onsuccess=function(a){a=a.target.result;var c=a==null?void 0:a.version;a==null?void 0:a.close();c!=null?b(c/10):b()};c.onerror=function(){b()}})}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a){a=(yield d("MAWReStoreDbSetup").getDB());return a.getCustomMigrationVersion()}else return(h||(h=b("Promise"))).resolve(null)});return r.apply(this,arguments)}function a(){var a=d("MAWCurrentUser").getID();return d("MAWRestoreDbState").isUsingShim().then(function(b){if(b)return q(b);else return p(d("MAWIndexedDbMetadata").dbName(a))})}function s(a,b){if(a.upgrade!=null||b.upgrade!=null)return!0;a=Object.keys((a==null?void 0:a.schema)||{});b=Object.keys((b==null?void 0:b.schema)||{});a=[].concat(a,b);b=new Set(a);return b.size!==a.length}function t(a){return a.reduce(function(a,b,c){if(c===0)return[babelHelpers["extends"]({},b,{schema:d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(b.version)})];c=a[a.length-1];b=babelHelpers["extends"]({},b,{schema:b.schema!=null?d("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([b],b.version):null});if(s(c,b)){a.push(b);return a}a.splice(a.length-1,1,babelHelpers["extends"]({},c,b,{schema:babelHelpers["extends"]({},c==null?void 0:c.schema,b==null?void 0:b.schema)}));return a},[])}function c(a,b,c){var e=c!=null?c:d("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:d("MAWGetDbVersion").getArmadilloDbVersion();n.LOG(m(),b,e);e==null&&n.WARN(l());if(b!=null&&b>e){n.WARN(k());a.version(b);return b}c=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return b==null||a>b}).filter(function(a){a=a.version;return e==null||e>=a});var f=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return e==null||e>=a});if(c.length===0||c.length===f.length){n.LOG(j());f=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version;f=Math.min(e!=null&&e>0?e:f,f);a.version(f).stores(d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(f));return f}f=t(c);n.LOG(i(),f.length,c[0].version,c[c.length-1].version);var g=0;f.forEach(function(b){g=Math.max((b=o(a,b))!=null?b:0,(b=g)!=null?b:0)});return g}g.CURRENT_MAW_STORES=f;g.getDexieDbVersion=p;g.getRestoreDbVersion=q;g.getDBVersion=a;g.updateDB=c}),98);
__d("ReStoreIDBFactory",["invariant","Deferred","I64","IndexedDbPolyfills","ReStoreKeyComparer","err","isPromise","nullthrows","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l="e2ee_",m=new MessageChannel(),n=[];m.port1.onmessage=function(){var a=n.pop();a()};function o(a){n.push(a),m.port2.postMessage({})}function p(a){var b=new Map();function c(a){if(typeof a!=="object"||a===null)return a;if(b.has(a))return b.get(a);var d;if(Array.isArray(a)){d=[];b.set(a,d);for(var e of a)d.push(c(e))}else if(a instanceof Set){d=new Set();b.set(a,d);for(e of a)d.add(c(e))}else if(a instanceof Map){d=new Map();b.set(a,d);for(e of a){var f=e[0],g=e[1];d.set(c(f),c(g))}}else if(a instanceof ArrayBuffer)d=new ArrayBuffer(a.byteLength),new Uint8Array(d).set(new Uint8Array(a));else if(a instanceof Uint8Array){f=c(a.buffer);d=new Uint8Array(f,a.byteOffset,a.length)}else d={};b.set(a,d);for(g of Object.keys(a))d[g]=c(a[g]);return d}return c(a)}function q(a,b){function d(b){if(b.done)return b.value;if(!(k||(k=c("isPromise")))(b.value))throw c("unrecoverableViolation")("expected promise","messenger_web_product");return b.value.then(function(b){return d(a.next(b))})}return d(a.next(b))}function* r(a){return(k||(k=c("isPromise")))(a)?yield a:a}function s(a,b){a=[].concat(a);b!==-1&&(a[b]=(i||(i=d("I64"))).to_float(c("nullthrows")(i.cast(a[b]),"Expected autoincrementing field to be an I64")));return a.length===1?a[0]:a}function t(a,b){a=Array.isArray(a)?a:[a];return a.map(function(a,c){if(a===-Infinity)return void 0;if(Array.isArray(a)&&a.length===0)return(j||(j=d("ReStoreKeyComparer"))).MAX_KEY;if(Array.isArray(a)&&a.length===1&&Array.isArray(a[0])&&a[0].length===0)return(j||(j=d("ReStoreKeyComparer"))).MAX_KEY;return c===b&&typeof a==="number"?(i||(i=d("I64"))).of_float(a):a})}function u(a,b,e){var f=a.indexes,g=a.primaryKeyIds;g=e==null?g:f[e];f=g.map(function(f){if(b[f]!==void 0||e!=null){var g=b[f];if(a.autoIncrement&&f===a.primaryKeyIds[0]){g=(i||(i=d("I64"))).cast(g);if(g==null)throw c("unrecoverableViolation")("expected auto-incrementing field to be an i64","maw_db");g=i.to_float(g)}return g}throw c("unrecoverableViolation")("primary key must be defined on object","maw_db")});return f.length===1?f[0]:f}var v=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.continue=function(a){this.$1(a)};b.advance=function(a){this.$2(a)};return a}(),w=function(){function a(a,b,c,d){this.$1=a,this.$2=b,this.$3=c,this.$4=d}var b=a.prototype;b.openCursor=function(a,b){var c=this;return A(a,b,function(a){return a[c.$3].index(c.$1)},this.$4,this.$2,this.$1)};b.count=function(a){var b=this.$2.autoIncrement?this.$2.indexes[this.$1].indexOf(this.$2.primaryKeyIds[0]):-1,c=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),function(d){return q(function*(){var e=new WeakMap();e=(yield* r(d[c.$3].index(c.$1).keys(e,"asc",z(a,b))));var f=0,g=(yield* r(e.next()));while(!g.done)f++,g=(yield* r(e.next()));return f}())})};babelHelpers.createClass(a,[{key:"keyPath",get:function(){return this.$2.indexes[this.$1].length===1?this.$2.indexes[this.$1][0]:this.$2.indexes[this.$1]}},{key:"name",get:function(){return this.$1}}]);return a}();function x(a,b){if(b==null)return a;var e=c("nullthrows")((i||(i=d("I64"))).cast(a[b]),"expected auto-increment field to be an I64");a[b]=i.to_float(e);return a}function y(a,b){if(b==null||a[b]==null)return babelHelpers.extends({},a);typeof a[b]==="number"||h(0,72542);a[b]=(i||(i=d("I64"))).of_float(a[b]);return a}function z(a,b){var c;a!=null&&(c={},a.lower!==void 0&&(a.lowerOpen?c.gt=t(a.lower,b):c.gte=t(a.lower,b)),a.upper!==void 0&&(a.upperOpen?c.lt=t(a.upper,b):c.lte=t(a.upper,b)));return c}function A(a,b,e,f,g,h){var i=g.autoIncrement?h==null?0:g.indexes[h].indexOf(g.primaryKeyIds[0]):-1,k=g.autoIncrement?g.primaryKeyIds[0]:null,l="asc";if(b==="prev")l="desc";else if(b!==void 0&&b!=="next")throw c("err")("Unsupported direction:"+b);var m=new WeakMap(),n=new(d("IndexedDbPolyfills").IDBRequest)(),o,w=new v(C,B);n.result=w;function y(b){var c;o=(c=o)!=null?c:e(b).entries(m,l,z(a,i));return o}function A(a){var b=s(a.value[0],i);w.primaryKey=u(g,a.value[1]);w.key=b;w.value=x(p(a.value[1]),k);return w}function B(a){f(n,function(b){return q(function*(){var c=y(b),d=(yield* r(c.next()));for(var e=0;e<a-1&&!d.done;e++)d=(yield* r(c.next()));if(!d.done)return A(d)}())})}function C(a){var b;a!=null&&(b=t(a,i));f(n,function(a){return q(function*(){var c=y(a),e=(yield* r(c.next(b))),f=function*(){var a=e.value[0];for(var b=0;b<a.length;b++){var f=a.slice(0,b);if(l==="asc"){if(a[b]==null){if(b===a.length-1)e=(yield* r(c.next()));else{var g=[].concat(f,[void 0,(j||(j=d("ReStoreKeyComparer"))).MAX_KEY]);e=(yield* r(c.next(g)))}if(e.done)return"break|outer";a=e.value[0];if(!f.every(function(b,c){return(j||(j=d("ReStoreKeyComparer"))).compareValue(b,a[c])===0}))return"continue|outer"}}else if(a[b]==null){e=(yield* r(c.next(f)));return"continue|outer"}}return"break"};outer:while(!e.done){var g=(yield* f());switch(g){case"break|outer":break outer;case"continue|outer":continue outer;case"break":break outer}}if(!e.done)return A(e)}())})}C();return n}var B=function(){function a(a,b,c){this.$1=a,this.$2=b,this.$3=this.$1.getTableData().tableNames[this.$2],this.$4=c}var b=a.prototype;b.index=function(a){return new w(a,this.$3,this.$2,this.$4)};b.get=function(a){var b=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),function(c){return q(function*(){var d;d=(yield* r((d=c[b.$2]).get.apply(d,t(a,b.$3.autoIncrement?0:-1))));return d==null?d:x(p(d),b.$3.autoIncrement?b.$3.primaryKeyIds[0]:null)}())})};b.clear=function(){var a=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(b){var c=b[a.$2].entries(new WeakMap()),d=await c.next();while(!d.done){var e;await (e=b[a.$2]).delete.apply(e,d.value[0]);d=await c.next()}})};b.put=function(a,b){var c=this,e=y(p(a),this.$3.autoIncrement?this.$3.primaryKeyIds[0]:null);b==null||h(0,72438);return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(a){var b=c.$3.autoIncrement?0:-1;return s(await a[c.$2].put(e),b)})};b.add=function(a,b){var c=this,e=y(p(a),this.$3.autoIncrement?this.$3.primaryKeyIds[0]:null);b==null||h(0,72437);return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(a){var b=c.$3.autoIncrement?0:-1;return s(await a[c.$2].add(e),b)})};b.delete=function(a){var b=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),async function(c){if(a instanceof IDBKeyRange){var d=new WeakMap(),e=b.$3.autoIncrement?0:-1;d=await c[b.$2].entries(d,"asc",z(a,e));e=await d.next();while(!e.done){var f;await (f=c[b.$2]).delete.apply(f,e.value[0]);e=await d.next()}}else{await (f=c[b.$2]).delete.apply(f,t(a,b.$3.autoIncrement?0:-1))}return void 0})};b.openCursor=function(a,b){var c=this;return A(a,b,function(a){return a[c.$2]},this.$4,this.$3)};b.count=function(a){var b=this.$3.autoIncrement?0:-1,c=this;return this.$4(new(d("IndexedDbPolyfills").IDBRequest)(),function(d){return q(function*(){var e=new WeakMap();e=(yield* r(d[c.$2].keys(e,"asc",z(a,b))));var f=0,g=(yield* r(e.next()));while(!g.done)f++,g=(yield* r(e.next()));return f}())})};b.createIndex=function(a,b){};b.deleteIndex=function(a){};babelHelpers.createClass(a,[{key:"indexNames",get:function(){return Object.keys(this.$3.indexes)}},{key:"name",get:function(){return this.$2.substr(l.length)}},{key:"autoIncrement",get:function(){return this.$3.autoIncrement}},{key:"keyPath",get:function(){return this.$3.primaryKeyIds.length===1?this.$3.primaryKeyIds[0]:this.$3.primaryKeyIds}}]);return a}(),C=function(b){babelHelpers.inheritsLoose(a,b);function a(a,d,e,f){var g;g=b.call(this)||this;g.$ReStoreIDBTransaction$p_5=[];g.$ReStoreIDBTransaction$p_6=new(c("Deferred"))();g.state="active";g.oncomplete=null;g.onerror=null;g.$ReStoreIDBTransaction$p_1=a;g.$ReStoreIDBTransaction$p_4=d;g.$ReStoreIDBTransaction$p_3=e;g.$ReStoreIDBTransaction$p_2=f;c("promiseDone")(g.$ReStoreIDBTransaction$p_1.runInTransaction(function(a){g.$ReStoreIDBTransaction$p_6.resolve(a);return new Promise(function(b,d){var e=async function e(){var f=[].concat(g.$ReStoreIDBTransaction$p_5);if(g.state==="finished"){d(c("err")("Transaction aborted"));throw c("err")("Transaction aborted")}if(!f.length){g.state="committing";return b()}try{g.state="inactive";var h=[];for(var i of f){i[0];var j=i[1];try{j=j(a);j={status:"fulfilled",value:(k||(k=c("isPromise")))(j)?await j:j}}catch(a){j={reason:a,status:"rejected"}}h.push(j)}g.state="active";g.$ReStoreIDBTransaction$p_5=[];for(j=0;j<h.length;j++){i=h[j];var l=f[j];l=l[0];i.status==="fulfilled"?(l.result=i.value,l.emit("success",{target:l})):(l.error=i.reason,l.emit("error",{target:l}))}}catch(a){return d(a)}o(function(){return void e()})};o(function(){return void e()})})},f==="versionchange"?"readwrite":f),function(){g.state="finished",g.emit("complete"),g.$ReStoreIDBTransaction$p_6=new(c("Deferred"))()},function(){g.state="finished",g.emit("error"),g.$ReStoreIDBTransaction$p_6=new(c("Deferred"))()});return g}var e=a.prototype;e.objectStore=function(a){var b=this;if(!this.$ReStoreIDBTransaction$p_3.has(a))throw c("err")("Invalid object store name "+a);return new B(this.$ReStoreIDBTransaction$p_1,l+a,function(a,d){if(b.state!=="active")throw c("err")("Cannot make request against inactive transaction.");b.$ReStoreIDBTransaction$p_5.push([a,d]);return a})};e.abort=function(){this.state="finished"};e.enqueueAdditionalWork=function(a){this.$ReStoreIDBTransaction$p_5.push([new(d("IndexedDbPolyfills").IDBRequest)(),a])};babelHelpers.createClass(a,[{key:"db",get:function(){return this.$ReStoreIDBTransaction$p_4}},{key:"transaction",get:function(){return this.$ReStoreIDBTransaction$p_6.getPromise()}}]);return a}(d("IndexedDbPolyfills").IDBRequest),D=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.transaction=function(a,b,c){return new C(this.$1,this,new Set(Array.isArray(a)?a:[a]),b)};b.createObjectStore=function(a){return{createIndex:function(a,b,c){}}};b.deleteObjectStore=function(a){};b.close=function(){this.$1.closeDb==null?void 0:this.$1.closeDb()};babelHelpers.createClass(a,[{key:"objectStoreNames",get:function(){var a=Object.keys(this.$1.getTableData().tableNames).filter(function(a){return a.startsWith(l)}).map(function(a){return a.substr(l.length)});a.contains=function(b){return a.find(function(a){return a===b})!=null};return a}},{key:"name",get:function(){return this.$2}}]);return a}();b=function(){function a(a){this.$1=a}var b=a.prototype;b.open=function(a,b){var c=new(d("IndexedDbPolyfills").IDBRequest)();c.result=new D(this.$1,a);o(function(){return c.emit("success")});return c};b.cmp=function(a,b){return indexedDB.cmp(a,b)};return a}();e=function(){function b(){}b.bound=function(c,d,e,f){if(Array.isArray(c)&&c[0]===void 0)return b.upperBound(d,f);return Array.isArray(d)&&d[0]===void 0?b.lowerBound(c,e):a.IDBKeyRange.bound(c,d,e,f)};b.lowerBound=function(b,c){if(Array.isArray(b)&&b[0]===null)return null;return Array.isArray(b)&&b[0]===void 0?null:a.IDBKeyRange.lowerBound(b,c)};b.upperBound=function(b,c){if(Array.isArray(b)&&b[0]===null)return null;return Array.isArray(b)&&b[0]===void 0?null:a.IDBKeyRange.upperBound(b,c)};return b}();self.setImmediate2=o;g.structuredClone=p;g.ReStoreIDBTransaction=C;g.ReStoreIDBDatabase=D;g.ReStoreIDBFactory=b;g.ReStoreIDBKeyRange=e}),98);
__d("ReStoreLegacyEARMigration",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var d="messenger_web_encryption_v1_"+c,e=(yield new(g||(g=b("Promise")))(function(a){var b=indexedDB.open(d);b.onupgradeneeded=function(b){b.target.transaction.abort(),a()};b.onsuccess=function(b){b=b.target.result;return a(b)}}));if(e==null)return;var f=(yield new g(function(a){var b=e.transaction(["browserEncryptionMetaV2"]).objectStore("browserEncryptionMetaV2").getAll();b.onsuccess=function(b){b=b.target.result;return a(b)}})),h=(yield new g(function(b){var c=indexedDB.open(a);c.onupgradeneeded=function(a){a.target.transaction.abort(),b()};c.onsuccess=function(a){a=a.target.result;return b(a)}}));if(h==null)return;h.close();if(h.objectStoreNames.contains("browserEncryptionMeta"))return;c=(yield new g(function(b){var c=indexedDB.open(a,h.version+1);c.onupgradeneeded=function(a){a=a.target;var b=a.result;a=a.transaction;b.createObjectStore("browserEncryptionMeta");for(b of f){b.id;var c=b.version,d=babelHelpers.objectWithoutPropertiesLoose(b,["id","version"]);a.objectStore("browserEncryptionMeta").put(d,c)}};c.onsuccess=function(a){a=a.target.result;return b(a)}}));c.close();e.close()});return h.apply(this,arguments)}f.migrateEARData=a}),66);
__d("createReStoreIndexedDbPersistenceWithoutLocks",["ClientConsistency","CurrentMessengerUser","Deferred","ExecutionEnvironment","FBLogger","LSPlatformErrorChannel","MAWCryptoConsts","MAWKeychainNaClCrypto","MAWODSProxy","ReStoreBinaryEncoding","ReStoreDbClosedError","ReStoreDbConfigStore","ReStoreDbVersionChange","ReStoreDecryptionFailure","ReStoreEARInit","ReStoreEARSetupFailure","ReStoreErrorAction","ReStoreIndexedDbClosedEvent","ReStorePersistence","WAExceededStorageQuota","WAOdsEnums","err","gkx","pageID","promiseDone","promiseFromRequest","tweetnacl","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4096,j=d("CurrentMessengerUser").getIDorEIMU(),k=new Set([d("ReStoreDbConfigStore").CONFIG_STORE_NAME]),l=new(d("ReStoreBinaryEncoding").Encoder)(),m=new(d("ReStoreBinaryEncoding").Decoder)();function n(a,b,e){if(a==null)return null;var f=new Uint8Array(a);try{f=f[1];e=d("ReStoreEARInit").getDbEncryptionKey(e,f);e=e.key;var g=3;a=d("tweetnacl").secretbox.open(new Uint8Array(a,g+d("tweetnacl").secretbox.nonceLength),new Uint8Array(a,g,d("tweetnacl").secretbox.nonceLength),new Uint8Array(e));if(a==null){throw new(d("MAWKeychainNaClCrypto").EARDecryptionError)("Encrypted ReStore-no-locks was unable to decrypt an entity. Attempting to use key version : "+((g=f)!=null?g:"non-provided")+".")}return m.decode(a)}catch(a){c("LSPlatformErrorChannel").emit(new(d("ReStoreDecryptionFailure").ReStoreDecryptionFailure)(a.message,b));throw new(d("ReStoreDecryptionFailure").ReStoreDecryptionFailure)(a.message,b)}}function o(a,b,e){if(a==null)return a;try{e=d("ReStoreEARInit").getDbEncryptionKey(e,e.latestVersion);var f=e.key;e=e.version;e=new Uint8Array([0,e,d("MAWCryptoConsts").CIPHER_ID]);var g=d("tweetnacl").randomBytes(d("tweetnacl").secretbox.nonceLength);a=d("tweetnacl").secretbox(l.encode(a),g,new Uint8Array(f));f=new Uint8Array(e.length+g.length+a.length);f.set(e);f.set(g,e.length);f.set(a,e.length+g.length);return f.buffer}catch(a){throw c("err")(a.message+" - Encrypted LSDB was unable to encrypt an entity for table "+b)}}function p(a){for(a of a.values())if(a.size!==0)return!1;return!0}function q(a,b){var c=[];a=new Set(a);for(var d of a)b.objectStoreNames.contains(d)||c.push(d);d=[];for(var e=0;e<b.objectStoreNames.length;e++){var f=b.objectStoreNames[e];!a.has(f)&&!k.has(f)&&d.push(f)}if(c.length!==0||d.length!==0)return[c,d]}function r(a,b,c,d){d===void 0&&(d={});if(c==null){b.debug("Schema doesn't have changes to apply");return}b.debug("Schema has changes to apply");b=c[0];c=c[1];b.forEach(function(b){a.objectStoreNames.contains(b)||(d[b]!=null?d[b](a):a.createObjectStore(b,{autoIncrement:!0}))});c.forEach(function(b){a.objectStoreNames.contains(b)&&a.deleteObjectStore(b)})}function s(a,b,e,f,g,i){function j(a){e(new(c("ReStoreIndexedDbClosedEvent"))(a.target,new(d("ReStoreDbVersionChange").ReStoreDbVersionChange)())),g.debug("DB onversionchange TABID="+c("pageID")),c("FBLogger")("maw_db").info("[pdb] onversionchange inWorker=%s",String((h||(h=c("ExecutionEnvironment"))).isInWorker)),f.endFail("version_change"),c("LSPlatformErrorChannel").emit(new(d("ReStoreDbVersionChange").ReStoreDbVersionChange)())}return new Promise(function(d,e){var g=indexedDB.open(a,i);g.onupgradeneeded=function(a){a=a.target;var c=a.result;a=a.transaction;b(c,a)};g.onerror=function(a){f.endFail("failed_to_open_pdb"),e(c("unrecoverableViolation")("Failed to open db","maw_db",{error:a.target.error}))};g.onsuccess=function(a){a=a.target.result;a.addEventListener("versionchange",j);d(a)}})}async function t(a,b,e,f,g,i,j){var k=[].concat(b,[d("ReStoreEARInit").EAR_STORE_NAME]),l=(b={},b[d("ReStoreEARInit").EAR_STORE_NAME]=d("ReStoreEARInit").createEARStore,b),m;try{g.addPoint("generate_ear_key_default_start"),m=await d("ReStoreEARInit").generateKeyWithDefaultVersion(),g.addPoint("generate_ear_key_default_end")}catch(a){g.addPoint("generate_ear_key_default_failed"),c("FBLogger")("maw_db").catching(a).mustfix("EAR generateKeyWithDefaultVersion failed")}function n(b,a){g.addAnnotations({bool:{dbEmpty:!0}});d("ReStoreDbConfigStore").createDbConfig(b,f.defaultConfig);for(var c of k)l[c]!=null?l[c](b):b.createObjectStore(c,{autoIncrement:!0});if(m!=null){b=m;c=b.version;b=babelHelpers.objectWithoutPropertiesLoose(b,["version"]);d("ReStoreEARInit").storeEARKey(a,c,b)}}g.addPoint("idb_open_start");b=await s(a,n,e,g,i);g.addPoint("idb_open_end");var o=b.transaction(d("ReStoreDbConfigStore").CONFIG_STORE_NAME,"readonly");o=await Promise.all([d("ReStoreDbConfigStore").detectConfigMismatch(o,f),d("ReStoreDbConfigStore").readCorruptionFailuresFromConfig(o).then(function(a){return(a=a==null?void 0:a.value)!=null?a:0})]);var p=o[0];o=o[1];var t=o>0;t&&(c("FBLogger")("maw_db").info("[pdb] opening corrupted db failures=%s inWorker=%s",String(o),String((h||(h=c("ExecutionEnvironment"))).isInWorker)),i.debug("DB corrupted, deleting db"));p&&i.debug("DB config mismatch, deleting db");g.addAnnotations({bool:{configMismatch:p,dbCorruptionOccured:t}});if(p||t)b.close(),g.addPoint("delete_db_start"),await c("promiseFromRequest")(indexedDB.deleteDatabase(a)),g.addPoint("delete_db_end"),g.addPoint("reopen_db_start"),b=await s(a,n,e,g,i),g.addPoint("reopen_db_end");else{var u=q(k,b),v=await d("ReStoreEARInit").generateEARKey(b,g);(u!=null||v!=null)&&(i.debug("Schema mismatch, bumping db version"),b.close(),g.addPoint("mismatch_start"),b=await s(a,function(a,b){r(a,i,u,l);if(v!=null){a=v.version;var c=babelHelpers.objectWithoutPropertiesLoose(v,["version"]);d("ReStoreEARInit").storeEARKey(b,a,c)}},e,g,i,b.version+1),g.addPoint("mismatch_end"))}try{g.addPoint("ear_keys_init_start"),await d("ReStoreEARInit").initEAR(b,j),g.addPoint("ear_keys_init_end")}catch(f){g.addPoint("ear_keys_init_failed");b.close();c("FBLogger")("maw_db").catching(f).mustfix("EAR failed to init as part of ReStore");c("promiseDone")(c("promiseFromRequest")(indexedDB.deleteDatabase(a)),function(a){},function(a){return c("FBLogger")("maw_db").catching(a).warn("Failed to delete DB")});e(new(c("ReStoreIndexedDbClosedEvent"))(b,new(d("ReStoreEARSetupFailure").ReStoreEARSetupFailure)("Failed to setup EAR in Restore")));throw new(d("ReStoreEARSetupFailure").ReStoreEARSetupFailure)("Failed to setup EAR in Restore")}return b}function a(a,b,e,f,g,h){var k=Object.keys(b.tableNames),l={accountKey:null,databaseEncryptionKeys:new Map(),latestVersion:d("MAWCryptoConsts").VERSION},m=f.logHistory,q=f.userFlow;b=j+"-"+a;var r=!0,u,v=[],w=null,x=Promise.resolve();m.debug("shim DB is ON");q.addPoint("init_idb_start");var y=new Map(),z=new Promise(function(b,d){c("promiseDone")(x=x.then(async function(){try{var c=await t(a,k,A,e,q,m,l);b(c)}catch(a){d(a)}}),function(a){},function(a){return c("FBLogger")("maw_db").catching(a).warn("[pdb] dbLock idbPromise issue")})});c("promiseDone")(z.then(function(){q.addPoint("init_idb_end")}));function A(a){a instanceof c("ReStoreIndexedDbClosedEvent")&&(a.idb.close(),y.clear(),r=!1),h==null?void 0:h(a)}function B(a,b,c){c=a.transaction(c!=null&&c.length>0?c:a.objectStoreNames,b,{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(c);return c}function C(a){var b=y.get(a);b==null&&(b=new Map(),y.set(a,b));return b}function D(){if(w)return;w=new Promise(async function(a){var b;try{var d=async function(){if(u==null){var a;b=(a=b)!=null?a:await z;var d=B(b,v.some(function(a){return a.writemode==="readwrite"||a.expectingWrite})?"readwrite":"readonly");d.onabort=function(){u===d&&(u=null)};u=d}var e=u;a=[];for(var f of v){if(f.writemode==="readwrite"){e.mode==="readwrite"&&a.push(f);u=null;break}a.push(f)}v.splice(0,a.length);a.length&&await Promise.all(a.map(function(a){a=a.thunk;return a(e)}));c("gkx")("116")&&!v.length&&u!=null&&await c("promiseFromRequest")(u.objectStore(u.objectStoreNames[0]).get(""))};while(v.length)await d();(d=u)==null?void 0:d.commit==null?void 0:d.commit()}finally{u=null,a(),w=null}})}function E(a,b,c){c===void 0&&(c=!1);return new Promise(function(d,e){v.push({expectingWrite:c,thunk:async function(b){var c;try{c=await a(b)}catch(a){e(a);return}d(c)},writemode:b}),D()})}function F(){if(!r)return;c("promiseDone")(z,async function(a){var b;a=B(a,"readwrite");b=(b=(b=await d("ReStoreDbConfigStore").readCorruptionFailuresFromConfig(a))==null?void 0:b.value)!=null?b:0;await d("ReStoreDbConfigStore").writeCorruptionFailuresToConfig(a,b)})}function G(){c("promiseDone")(z,function(a){A(new(c("ReStoreIndexedDbClosedEvent"))(a))})}function H(){if(!r)throw new(c("ReStoreDbClosedError"))()}async function I(a){await z;H();var b=c("ClientConsistency").getAdditionalRevisions();b.size>0&&(c("FBLogger")("maw_db").info("[pdb] js mismatch detected"),d("ReStoreErrorAction").softRefresh());return new Promise(function(b,d){c("promiseDone")(x=x.then(async function(){try{var c=await a(),e=c[0];c[1];c=await e();b(c)}catch(a){d(a)}}),function(a){},function(a){return c("FBLogger")("maw_db").catching(a).warn("[pdb] dbLock runExclusively issue")})})}return{clearCache:function(){y.clear()},close:G,flush:async function(b,f){f=f.upgrade;if(!r)return;async function h(a){var c=new Promise(function(b,c){a.oncomplete=function(a){b(a.target.result)},a.onerror=a.onabort=function(){y.clear(),c(a.error)}});for(var e of b){var f=e[0],g=e[1],h=a.objectStore(f);for(g of g){var i=g[0],j=g[1];if(j===d("ReStorePersistence").sentinelDeleted)h.delete(i);else{j=o(j,f,l);h.put(j,i)}}}a.commit!=null&&a.commit();await c}function i(){Array.from(b).forEach(function(a){var b=a[0];a=a[1];var c=C(b);Array.from(a).forEach(function(a){var b=a[0];a=a[1];a===d("ReStorePersistence").sentinelDeleted?c.delete(b):c.set(b,a)})})}if(p(b))return;var j=await z;if(f===!0){c("FBLogger")("maw_db").info("[pdb] Updating IDB version, fromVersion: %s, non-empty tables: %s",j.version,Array.from(b.entries()).filter(function(a){a[0];a=a[1];return a.size>0}).map(function(a){a=a[0];return a}).sort().toString());await w;(f=u)==null?void 0:f.abort();j.close();y.clear();z=async function(){var b=new(c("Deferred"))(),d=await s(a,function(a,d){i(),c("promiseDone")(h(d),function(){b.resolve()},function(){b.reject("Failed to complete db flush")})},A,q,m,j.version+1);await b.getPromise();return d}();await z;return}if(b.size===0)return;i();f=Array.from(b.keys());f.push(d("ReStoreDbConfigStore").CONFIG_STORE_NAME);try{await h(B(j,"readwrite",f))}catch(b){if((b==null?void 0:b.name)==="InvalidStateError"&&(g==null?void 0:g.reOpenDbOnInvalidState)===!0)d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.PQ_MIGRATION,key:"invalid_state"}),A(new(c("ReStoreIndexedDbClosedEvent"))(j)),z=t(a,k,A,e,q,m,l),await h(B(await z,"readwrite",f)),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.PQ_MIGRATION,key:"invalid_state_fixed"});else throw b}},get:function(a,b,d){var e=C(b);if(e.has(d))return e.get(d);else{if(!r)return new Promise(function(){});var f=E(function(a){return c("promiseFromRequest")(a.objectStore(b).get(d))},"readonly").then(function(a){var c=e.get(d);if(c!==f)return c;c=n(a,b,l);e.set(d,c);return c});e.set(d,f);return f}},isClosed:function(){return!r},logError:function(a,b,d,e){if(d==="dbCorruption"){b==="readwrite"&&F();throw c("FBLogger")("maw_db").mustfixThrow("Got unexpected undefined in pdb, mode: %s, table: %s, id: %s, deletedInThisTxn: %s",b,a,(d=e==null?void 0:e.id)!=null?d:"",(b=e==null?void 0:e.deletedInThisTxn)!=null?b:"")}},queueCommitWork:function(a){return a()},runExclusively:I,shouldApplySync:function(){return!1},shouldInline:function(a,b){return d("ReStoreBinaryEncoding").estimateSize(b)<i},shouldSync:function(a,b){return!1},types:["indexeddb"],uniqueId:b}}a.schemaDiff=q;a.applyChanges=r;g.default=a}),98);
__d("MAWRestoreSchemaIndexedDB",["BrowserLockManager","IndexedDbPolyfills","LSClientSchemaType","LSPlatformLsInitLog","LSReStoreQplLogger","LSReStoreWrapper","MAWCurrentUser","MAWDBRestoreConfig","MAWDbSchema.restore","MAWDbVersion","MAWGetDbVersion","MAWIndexedDbMetadata","MAWQplProxy","MessengerLogHistory","Promise","ReStoreHashSchemaProvider","ReStoreIDBFactory","ReStoreLegacyEARMigration","ReStoreMetadata","WATagsLogger","asyncToGeneratorRuntime","createReStoreIndexedDbPersistence","createReStoreIndexedDbPersistenceWithoutLocks","dexie_maw","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating shimmed DB from "," to ",""]);i=function(){return a};return a}var j,k=d("WATagsLogger").TAGS(["DBInit","DBSetup","ReStore"]),l={};function a(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(j==null){var a=new(c("ReStoreHashSchemaProvider"))(d("LSClientSchemaType").MAW_SCHEMA_NAME,d("ReStoreMetadata").getBuildTableData(l)([d("MAWDbSchema.restore").clientSchema.map(function(a,b){return babelHelpers["extends"]({},a,{id:(b+1).toString()})})])),e=d("MAWGetDbVersion").getArmadilloDbVersion();yield d("ReStoreLegacyEARMigration").migrateEARData(d("MAWIndexedDbMetadata").restoreDbName2(d("MAWCurrentUser").getID()),d("MAWCurrentUser").getID());var f=c("BrowserLockManager")!=null?c("createReStoreIndexedDbPersistence")(d("MAWIndexedDbMetadata").restoreDbName2(d("MAWCurrentUser").getID()),a,d("MAWDBRestoreConfig").createConfig(),{logHistory:d("MessengerLogHistory").getInstance("db_init"),transactionLockQplLogger:d("LSReStoreQplLogger").createQplLogger(c("qpl")._(25303045,"817")),userFlow:d("LSPlatformLsInitLog").lsInitLogger}):c("createReStoreIndexedDbPersistenceWithoutLocks")(d("MAWIndexedDbMetadata").restoreDbName2(d("MAWCurrentUser").getID()),a,d("MAWDBRestoreConfig").createConfig(),{logHistory:d("MessengerLogHistory").getInstance("db_init"),userFlow:d("LSPlatformLsInitLog").lsInitLogger});j=d("LSReStoreWrapper").createLSReStore(f,a,void 0,{migration:function(a,f){var g;d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",(g=a)!=null?g:0);return new(h||(h=b("Promise")))(function(g,l){var m={open:function(){var c=new(d("IndexedDbPolyfills").IDBRequest)(),i=new(d("ReStoreIDBFactory").ReStoreIDBDatabase)(j,""),k=new(d("ReStoreIDBFactory").ReStoreIDBTransaction)(babelHelpers["extends"]({},j,{runInTransaction:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;try{b=(yield a(f))}catch(a){l(a);throw a}g();return b});function c(b){return a.apply(this,arguments)}return c}()}),i,new Set(i.objectStoreNames),"versionchange");c.result=i;c.transaction=k;void b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).resolve(),c.emit("upgradeneeded",{newVersion:e,oldVersion:a,target:{result:i,transaction:k}})})();return c}};m=new(c("dexie_maw"))("",{IDBKeyRange:d("ReStoreIDBFactory").ReStoreIDBKeyRange,chromeTransactionDurability:"relaxed",enableDataSyncMiddleware:!0,indexedDB:m,shimEnabled:!0});k.LOG(i(),a,e);var n=d("MAWDbVersion").updateDB(m,a,e);d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",a!==n);m.open()})},targetVersion:e})}return j});return m.apply(this,arguments)}function e(){var a;(a=j)==null?void 0:a.closeDb==null?void 0:a.closeDb();j=null}g.createDB=a;g.closeDB=e}),98);
__d("MAWGetReStoreDBError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.message=b;c.name="MAWGetReStoreDBError";return c}return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("MAWReStoreDbSetup",["IGDInstamadilloUtils","MAWGetReStoreDBError","MAWRestoreDbState","MAWRestoreSchemaIndexedDB","asyncToGeneratorRuntime","cr:2924","cr:3535","cr:4561","cr:7254","err","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;h=(h=(h=b("cr:3535"))!=null?h:b("cr:7254"))!=null?h:b("cr:2924");var i=d("MAWRestoreDbState").getTargetDbState()==="restore"||c("gkx")("23906")||c("qex")._("736")===!0?d("MAWRestoreSchemaIndexedDB").createDB:null;if(h!=null&&b("cr:4561")!=null){var j=h;h=babelHelpers["extends"]({},h,{createDB:function(){return j.createDB(void 0,[b("cr:4561")])}})}var k=(h=(h=h)==null?void 0:h.createDB)!=null?h:i,l;function a(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l);a==null?void 0:a.closeDb==null?void 0:a.closeDb();l=null});return m.apply(this,arguments)}function e(){if(k==null)throw c("err")("Unexpected invocation of OneDB: "+d("IGDInstamadilloUtils").getE2EEGatingStateAsString());l==null&&(l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield k());yield a.runInTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){}),"readwrite",void 0,void 0,f.id+":65");return a}catch(a){throw new(c("MAWGetReStoreDBError"))("Failed to get ReStore DB: "+a)}})());return l}g.closeDB=a;g.getDB=e}),98);
__d("MAWDexieError",[],(function(a,b,c,d,e,f){"use strict";a="ModifyError";b="BulkError";c="OpenFailedError";d="VersionChangeError";e="SchemaError";var g="UpgradeError",h="InvalidTableError",i="MissingAPIError",j="NoSuchDatabaseError",k="InvalidArgumentError",l="SubTransactionError",m="UnsupportedError",n="InternalError",o="DatabaseClosedError",p="PrematureCommitError",q="ForeignAwaitError",r="UnknownError",s="ConstraintError",t="DataError",u="TransactionInactiveError",v="ReadOnlyError",w="VersionError",x="NotFoundError",y="InvalidStateError",z="InvalidAccessError",A="AbortError",B="TimeoutError",C="QuotaExceededError",D="SyntaxError",E="DataCloneError";A={AbortError:A,BulkError:b,ConstraintError:s,DatabaseClosedError:o,DataCloneError:E,DataError:t,ForeignAwaitError:q,InternalError:n,InvalidAccessError:z,InvalidArgumentError:k,InvalidStateError:y,InvalidTableError:h,MissingAPIError:i,ModifyError:a,NoSuchDatabaseError:j,NotFoundError:x,OpenFailedError:c,PrematureCommitError:p,QuotaExceededError:C,ReadOnlyError:v,SchemaError:e,SubTransactionError:l,SyntaxError:D,TimeoutError:B,TransactionInactiveError:u,UnknownError:r,UnsupportedError:m,UpgradeError:g,VersionChangeError:d,VersionError:w};f.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null;function j(a){var b=new Set(Object.keys(d("MAWDexieError").DEXIE_ERROR));b.has(a.reason)&&h!=null&&(h.endFail(a.reason),i!=null&&(i(),i=null))}b=function(b,c){h=b;i=c;a.addEventListener("unhandledrejection",j);return function(){return a.removeEventListener("unhandledrejection",j)}};g.trackDbSetupFailure=b}),98);
__d("MAWDbFactory",["Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","Promise","WAWorkerGlobalScope","asyncToGeneratorRuntime","err","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB setup complete, marking as ready"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Current version: ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"]);o=function(){return a};return a}function a(a,e){var f=null,g=new(c("Deferred"))(),p=!1,q=!1,r;function s(){g=new(c("Deferred"))(),r==null?void 0:r(),p=!1,q=!1}function t(){return q}function u(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,h,t){var u=h.dbStateCallback,v=h.middleware,w=h.schemaUpgradePromise;h=babelHelpers.objectWithoutPropertiesLoose(h,["dbStateCallback","middleware","schemaUpgradePromise"]);var x=d("MAWCurrentUser").getID();if(f!=null)return;q=!0;if(p)return g.getPromise();a.LOG(o());p=!0;r=d("MAWIDbSetupQplEventListener").trackDbSetupFailure(e,function(){g.reject("DB setup failed"),s()});var y=d("MAWIndexedDbMetadata").dbName(x);u==null?void 0:u(y,d("MAWLowLevelApiTypes").DatabaseState.Initializing);var z=(yield d("MAWDbVersion").getDexieDbVersion(y));x=(x=t)!=null?x:d("MAWGetDbVersion").getArmadilloDbVersion();a.LOG(n(),z);if(w&&(z||0)<x){a.LOG(m());try{yield w}catch(a){throw c("err")("Worker startup promise rejected, schema upgrade failed.")}var A=(yield d("MAWDbVersion").getDexieDbVersion(y));if(A!==x)throw c("err")("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",z,x,A);z=A}else{d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",(x=z)!=null?x:0);d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"useSentBytesCache",c("gkx")("33008")?1:0)}var B=function(b){var f;b=d("MAWDbVersion").updateDB(b,z,t);w||d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",z!==b);a.LOG(l(),b,z,(f=t)!=null?f:"<latest>");e.addPoint("database_version_upgraded ",{"int":{dbVersion:b}});return b};f=new(d("MAWDexieTable").DexieTable)(y,function(c){v.forEach(function(a){c.use(a(b))});var f=B(c);c.on("blocked",function(){a.ERROR(k()),u==null?void 0:u(y,d("MAWLowLevelApiTypes").DatabaseState.Error),g.reject("DB Open blocked"),e.endFail("db_blocked"),s()});c.on("ready",function(b){a.LOG(j());u==null?void 0:u(y,d("MAWLowLevelApiTypes").DatabaseState.Open);p=!1;if(b==null){a.ERROR(i());g.reject("DB is null");e.endFail("db_null");s();return}r==null?void 0:r();g.resolve();e.endSuccess({"int":{dbVersion:f}})});c.on("versionchange",function(){u==null?void 0:u(y,d("MAWLowLevelApiTypes").DatabaseState.Upgrading);var a=f!=null?f-1:0;e.addPoint("database_version_upgraded ",{"int":{prev_db_version:a}});(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:a.reload==null?void 0:a.reload()})},void 0,h);return g.getPromise()});return v.apply(this,arguments)}function w(a){if(f==null){throw c("err")('IndexDB has not been initialized before executing "'+((a=a)!=null?a:"unnamed")+'"')}return f}function x(a){if(f!=null&&!p)return(h||(h=b("Promise"))).resolve(f);g=g||new(c("Deferred"))();return g.getPromise().then(function(){return w(a)})}function y(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield x());a!=null&&(a.close(),f=null);s()});return z.apply(this,arguments)}function A(){f=null,s()}function B(a){c("promiseDone")(y());a=d("MAWIndexedDbMetadata").dbName((a=a)!=null?a:d("MAWCurrentUser").getID());c("promiseDone")(d("MAWIndexedDBDeletion").deleteDB(a,"maw"))}return{closeDB:y,deleteDb:B,getDB:x,getDBExn:w,makeDB:u,reset_singleton_INTERNAL_ONLY:A,setupPromise:function(){return g.getPromise()},willSetupDB:t}}g.makeIDBFactory=a}),98);
__d("MAWIndexedDbUI",["MAWDbFactory","MAWDbMutationMiddleware","MAWSendQplToServer","MAWTransactor","WATagsLogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a===void 0&&(a=d("WATagsLogger").TAGS(["DB on UI"]));b===void 0&&(b=d("MAWSendQplToServer").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:"idb"}}));var e=d("MAWDbFactory").makeIDBFactory(a,b);return{closeDB:e.closeDB,deleteDb:e.deleteDb,getDB:e.getDB,makeDB:function(a,b,c){return e.makeDB(a,{middleware:[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware],schemaUpgradePromise:b},c)},reset_singleton_INTERNAL_ONLY:e.reset_singleton_INTERNAL_ONLY}}b=a();e=b.makeDB;f=b.closeDB;var h=b.getDB,i=b.deleteDb;b=b.reset_singleton_INTERNAL_ONLY;var j=h("MawDbInUISingleton");g.makeMsgrTransactor=d("MAWTransactor").makeMsgrUITransactor;g.makeMAWIndexedDBFactory=a;g.makeDB=e;g.closeDB=f;g.getDB=h;g.deleteDb=i;g.reset_singleton_INTERNAL_ONLY=b;g.MawDbInUISingleton=j}),98);
__d("MAWIDbSetupQpl",["MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:"idb"}});b=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:"shim_idb"}});e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:"fts_idb"}});g.idbSetupQpl=a;g.shimIdbSetupQpl=b;g.ftsIdbSetupQpl=e}),98);
__d("MAWIndexedDb",["FBLogger","MAWBridge","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbMutationValidator","MAWDbSchema","MAWGetWorkerStatusApi","MAWIDbSetupQpl","MAWTransactor","WATagsLogger","cr:4773","dexie_maw","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[afterTransaction] afterTransactionForThreadEvent called outside of dexie transaction"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[afterTransaction] called outside of dexie transaction"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[afterTransactionEffect] called outside of dexie transaction"]);j=function(){return a};return a}function a(b,c){b===void 0&&(b=d("WATagsLogger").TAGS(["DB"]));c===void 0&&(c=d("MAWIDbSetupQpl").idbSetupQpl);var e=d("MAWDbFactory").makeIDBFactory(b,c);function a(a){return e.setupPromise().then(function(){return e.getDBExn(a)})}return babelHelpers["extends"]({},e,{getSignalDB:a,makeDB:function(a,b,c){var f=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];b.enableDataSyncMiddleware&&f.push(d("MAWDataSyncMiddleware").getDataSyncMiddleware);b.enableMutationValidator===!0&&f.push(d("MAWDbMutationValidator").getMutationValidatorMiddleware);return e.makeDB(a,{dbStateCallback:d("MAWGetWorkerStatusApi").setDatabaseStatus,middleware:f},c)}})}var k=a(),l=k.willSetupDB,m=k.makeDB,n=k.closeDB,o=k.getDBExn,p=k.getSignalDB,q=k.getDB,r=function(a){return k.reset_singleton_INTERNAL_ONLY()},s=k.deleteDb,t=new WeakMap(),u=new WeakMap(),v=d("WATagsLogger").TAGS(["DB"]);function e(a){var b=c("dexie_maw").currentTransaction;if(b==null){v.ERROR(j());throw c("unrecoverableViolation")("afterTransactionEffect called outside of dexie transaction","maw_db")}if(typeof a!=="function")return;var d=t.get(b)||[];d.push(a);t.set(b,d);d.length===1&&b.on("complete",function(){var a=t.get(b)||[];a.forEach(function(a){a()});t["delete"](b)})}function w(a){var b=c("dexie_maw").currentTransaction;if(b==null){v.ERROR(i());throw c("unrecoverableViolation")("afterTransaction called outside of dexie transaction","maw_db")}var e=u.get(b);if(e!=null)e.push(a);else{var f=[a];u.set(b,f);b.on("complete",function(){u["delete"](b),d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:f})})}}var x=new Set(["MsgUpdated","NewMsg","NewMsgs","MsgsLoaded","UpsertReaction","DeleteReaction","DropAllSecureThreads","XMAShareExpired","ParticipantUpdated","ParticipantsUpdated","ParticipantRemoved","MsgRangeLoaded","UpdateMessageRange","UpdateMinMessage","DeleteMessageRangesV2","DeleteMessages","DeleteMessagesOfThread","NewMedia","NewMediaRange","ReceivedReceipt","MediaExpired","ThreadHidden","ThreadHiddenV2","GroupInviteUpdate","DeleteGroupInvite","NewXMA","EditMsgHistoryAdded","ThreadUpdated","GroupInviteLoaded","ThreadTimestampsUpdated"]);function f(a){if(a.tag==="ThreadUpdated")try{var d=a.value.snippetContactIDs;d!=null&&d.some(function(a){return a==="Facebook User"})&&(c("FBLogger")("messenger_e2ee_web").mustfix('Something is still setting a contact id as "Facebook User"'),a.value=babelHelpers["extends"]({},a.value,{snippetContactIDs:d.map(function(a){return a==="Facebook User"?"0":a})}))}catch(a){}if(b("cr:4773")!=null){if(x.has(a.tag))return;w(a)}else w(a)}function y(a,b){var e=c("dexie_maw").currentTransaction;if(e==null){v.ERROR(h());throw c("unrecoverableViolation")("afterTransactionForThreadEvent called outside of dexie transaction","maw_db")}e.on("complete",function(){d("MAWBridge").getBridge().fireAndForget("threadEvent",b,a)})}g.TABLES_TO_ENCRYPT=d("MAWDbSchema").TABLES_TO_ENCRYPT;g.makeMsgrTransactor=d("MAWTransactor").makeMsgrTransactor;g.makeMAWIndexedDBFactory=a;g.willSetupDB=l;g.makeDB=m;g.closeDB=n;g.getDBExn=o;g.getSignalDB=p;g.getDB=q;g.setDB_INTERNAL_USE_ONLY=r;g.deleteDb=s;g.afterTransactionEffect=e;g.afterTransaction=f;g.afterTransactionThreadEvent=y}),98);
__d("MAWShimIndexedDb",["Deferred","MAWCurrentUser","MAWDataSyncMiddleware","MAWDbMutationMiddleware","MAWDbMutationValidator","MAWDbVersion","MAWDexieTable","MAWGetWorkerStatusApi","MAWIDbSetupQpl","MAWIDbSetupQplEventListener","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MWLSIndexedDBName","Promise","WATagsLogger","WAWorkerGlobalScope","asyncToGeneratorRuntime","err","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB setup complete, marking as ready"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"]);l=function(){return a};return a}var m=null,n=new(c("Deferred"))(),o=!1,p=!1,q=d("WATagsLogger").TAGS(["ShimDB"]);function r(){n=null,o=!1}function a(){return p}function e(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.enableDataSyncMiddleware,f=e===void 0?!0:e,g=a.enableMutationValidator;e=babelHelpers.objectWithoutPropertiesLoose(a,["enableDataSyncMiddleware","enableMutationValidator"]);p=!0;a=d("MAWCurrentUser").getID();if(m!=null)return;if(o){var h;return(h=n)==null?void 0:h.getPromise()}q.LOG(l());o=!0;n=(h=n)!=null?h:new(c("Deferred"))();d("MAWIDbSetupQplEventListener").trackDbSetupFailure(d("MAWIDbSetupQpl").shimIdbSetupQpl,function(){var a;(a=n)==null?void 0:a.reject("Shim DB setup failed");r()});var s=c("qex")._("1210")?d("MWLSIndexedDBName").dbName():d("MAWIndexedDbMetadata").restoreDbName2(a);d("MAWGetWorkerStatusApi").setDatabaseStatus(s,d("MAWLowLevelApiTypes").DatabaseState.Initializing);var t=(yield d("MAWDbVersion").getDexieDbVersion(s));m=new(d("MAWDexieTable").DexieTable)(s,function(a){f&&a.use(d("MAWDataSyncMiddleware").getDataSyncMiddleware());a.use(d("MAWDbMutationMiddleware").getMAWVaultMiddleware());g===!0&&a.use(d("MAWDbMutationValidator").getMutationValidatorMiddleware());var c=d("MAWDbVersion").updateDB(a,t,b);a.on("blocked",function(){var a;q.ERROR(k());d("MAWGetWorkerStatusApi").setDatabaseStatus(s,d("MAWLowLevelApiTypes").DatabaseState.Error);(a=n)==null?void 0:a.reject("Shim DB Open blocked");r()});a.on("ready",function(a){var b;q.LOG(j());d("MAWGetWorkerStatusApi").setDatabaseStatus(s,d("MAWLowLevelApiTypes").DatabaseState.Open);(b=n)==null?void 0:b.resolve();r();if(a==null){q.ERROR(i());return}d("MAWIDbSetupQpl").shimIdbSetupQpl.endSuccess({"int":{dbVersion:c}})});a.on("versionchange",function(){d("MAWGetWorkerStatusApi").setDatabaseStatus(s,d("MAWLowLevelApiTypes").DatabaseState.Upgrading);var a=c!=null?c-1:0;d("MAWIDbSetupQpl").shimIdbSetupQpl.addPoint("database_version_upgraded ",{"int":{prev_db_version:a}});(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:a.reload==null?void 0:a.reload()})},void 0,e);return(h=n)==null?void 0:h.getPromise()});return s.apply(this,arguments)}function t(a){if(m==null){throw c("err")('IndexDB has not been initialized before executing "'+((a=a)!=null?a:"unnamed")+'"')}return m}function f(a){if(m!=null&&!o)return(h||(h=b("Promise"))).resolve(m);n=n||new(c("Deferred"))();return n.getPromise().then(function(){return t(a)})}function u(a){m=a,r()}function v(){m!=null&&(m.close(),m=null)}g.willSetupDB=a;g.makeShimDB=e;g.getShimDBExn=t;g.getShimDB=f;g.setDB_INTERNAL_USE_ONLY=u;g.closeShimDB=v}),98);
__d("MAWLLAMigrationUtils",["MAWRestoreDbState","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";b=c("justknobx")._("652");var h=1/Math.max(b,10);e=1/(5*b);f=1/(10*b);var i=new Map([["setClockSkew",f],["getRoutingInfo",e],["unknown",f],["FTS",f]]);b=15e3;function a(a,b,e){b===void 0&&(b=!1);e===void 0&&(e={});var f=i.get(a)||h;return a==="debug"||a==="test"?[]:c("gkx")("23956")&&Math.random()<f?[c("qpl")._(1056839327,"560"),babelHelpers["extends"]({bool:{isUsingShim:d("MAWRestoreDbState").isUsingShim_LOGGING_ONLY(),newLLA:b},string:{transactor:a}},e)]:[]}g.QPL_TRANSACTION_TIMEOUT_MS=b;g.getTransactorQPLParam=a}),98);
__d("MAWTransactor",["FBLogger","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWRestoreDbState","MAWShimIndexedDb","MAWTransactionMode","WAExceededStorageQuota","asyncToGeneratorRuntime","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";var h=["MWPTransactor"],i=c("FBLogger")("messenger_e2ee_web");function j(a,b,d,e,f,g){e!=null&&c("dexie_maw").currentTransaction!=null&&e.endFail("invoked_in_nested_transaction");if(c("dexie_maw").currentTransaction!=null)throw i.mustfixThrow("makeMsgrTransactor %s cannot be called within another transaction",f);return a.transact(b,d,g)}function k(a){a=d("MAWLLAMigrationUtils").getTransactorQPLParam(a);a=a.length===2?a:[null,void 0];var b=a[0];a=a[1];return b!=null?d("MAWQplProxy").startQplUserFlow(b,a,void 0,d("MAWLLAMigrationUtils").QPL_TRANSACTION_TIMEOUT_MS):null}var l=function(a){return d("MAWRestoreDbState").isUsingShim().then(function(b){return b?d("MAWShimIndexedDb").getShimDB(a):d("MAWIndexedDb").getDB(a)})};function a(a,b,c){return o(a,b,l,c)}function e(a,b,c){return o(a,b,d("MAWIndexedDbUI").getDB,c)}var m=0,n=new Map();function o(a,b,c,e){var f=Object.keys(a),g=f.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];var o=k(b);o!=null&&o.addAnnotations({string:{mode:g===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{maybeLockedOn:Array.from(n.values()),stores:f}});return c(b).then(function(a){o==null?void 0:o.addPoint("lock_wait_start");return j(a,g,f,o,b,function(){m+=1;var c=m;n.set(c,b);var g=o!=null?a.stores[f[0]].get("").then(function(){o==null?void 0:o.addPoint("lock_wait_end"),o==null?void 0:o.addPoint("transaction_opened"),o==null?void 0:o.addPoint("transactor_execution_start")}):d("MAWDexieTable").dexieResolve();return g.then(function(){return e(a.stores).apply(void 0,i)}).then(function(a){n["delete"](c);o==null?void 0:o.addPoint("transactor_execution_end");o==null?void 0:o.endSuccess();return a})["catch"](function(a){n["delete"](c);d("WAExceededStorageQuota").checkQuotaExceededError(a);o==null?void 0:o.markError("transaction_error",null,a);if(a instanceof Error){var e=a,f=typeof (e==null?void 0:e.stack)==="string"?e.stack:typeof (e==null?void 0:e.stack);e=typeof (e==null?void 0:e.message)==="string"?e.message:typeof (e==null?void 0:e.message);o==null?void 0:o.addAnnotations({string:{errMessage:e,errStack:f}})}o==null?void 0:o.endFail("transaction_fail");e=d("MAWErrorObject").getErrorObject(a);throw p(e).mustfixThrow("[%s] Error performing %s transaction",h.join("|"),(f=b)!=null?f:"")})})})["catch"](function(a){d("WAExceededStorageQuota").checkQuotaExceededError(a);o==null?void 0:o.endFail("transaction_fail");a=d("MAWErrorObject").getErrorObject(a);throw p(a).mustfixThrow("[%s] Error performing %s transaction",h.join("|"),(a=b)!=null?a:"")})}}function p(a){if(a)return i.catching(a);else return i}function f(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("dexie_maw").currentTransaction==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("Cannot use runInLSDB outside of a MAW transaction");var b=c("dexie_maw").currentTransaction.idbtrans;b=(yield b.transaction);return a(b)});return q.apply(this,arguments)}g.makeMsgrTransactor=a;g.makeMsgrUITransactor=e;g.runInLSDB=f}),98);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(c("qex")._("507")===!0)return!0;else return c("isInstamadillo")()}g["default"]=a}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){if(!c("gkx")("23909")&&!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")))return a;a=babelHelpers["extends"]({},a);a=d("MAWVaultDb").unvaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS);a=d("MAWDbObjEncryption").encryptDbObj(a,b,e);return a}function b(a,b){return!c("gkx")("23909")?a:d("MAWVaultDb").unvaultDbRow(babelHelpers["extends"]({},a),b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function e(a,b,e){a=d("MAWDbObjEncryption").decryptDbObj(babelHelpers["extends"]({},a),b,e);return!c("gkx")("23909")?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function f(a,b){if(a==null)return void 0;return!c("gkx")("23909")?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}g.mutateValue=a;g.mutateVaultedValue=b;g.getValue=e;g.getVaultedValue=f}),98);
__d("MAWDbMutationValidator",["FBLogger","MAWIndexedDb","MAWMessageHasUniqueExternalIdValidator","MAWODSProxy","MAWParticipantMatchOneOnOneThreadValidator","MAWReactionHasUniqueProtocolMsgIdValidator","Promise","Random","WAOdsEnums","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[d("MAWMessageHasUniqueExternalIdValidator").MAWMessageHasUniqueExternalIdValidator,d("MAWParticipantMatchOneOnOneThreadValidator").MAWParticipantMatchOneOnOneThreadValidator,d("MAWReactionHasUniqueProtocolMsgIdValidator").MAWReactionHasUniqueProtocolMsgIdValidator],j=c("justknobx")._("2610");function k(a,e){var f=a.table(e),g=i.filter(function(a){return a.table===e});return g.length===0?f:babelHelpers["extends"]({},f,{mutate:function(a){return f.mutate(a).then(function(e){if(d("Random").coinflip(j)){var f=g.filter(function(b){b=b.type;return b.includes(a.type)});d("MAWIndexedDb").afterTransactionEffect(function(){var a=f.flatMap(function(a){var b=a.description,c=a.isValid;return((a=e.results)!=null?a:[]).map(function(a){return c(a).then(function(a){return babelHelpers["extends"]({validatorName:b},a)})})});c("promiseDone")((h||(h=b("Promise"))).all(a).then(function(a){a.forEach(function(a){switch(a.result){case"valid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:a.validatorName+".valid"});break;case"invalid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:a.validatorName+".invalid"});c("FBLogger")("maw_mutation_validator").mustfix("Validator %s failed with description: %s",a.validatorName,a.description);break;case"skipped":break}})}))})}return e})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return k(a,b)}})}catch(b){c("FBLogger")("maw_db").catching(b).mustfix("Error applying Mutation Validator Middleware");return a}},name:"MAWMutationValidatorMiddleware",stack:"dbcore"}}g.getMutationValidatorMiddleware=a}),98);
__d("lruMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=a.limit;a=a.entries;this.size=0;this.limit=b;this.oldest=this.newest=void 0;this.$1=new Map();a!=null&&(this.assign(a),b<1&&(this.limit=this.size))}var b=a.prototype;b.assign=function(a){var b=this,c=null,d=this.limit||Number.MAX_VALUE;this.$1.clear();a.forEach(function(a){a=new g(a.key,a.value);b.$1.set(a.key,a);c==null?b.oldest=a:(c.next=a,a.prev=c);c=a;if(d--==0)throw new Error("Tried to init with more entries than the limit")});this.newest=c;this.size=this.$1.size};b.$2=function(a){if(a===this.newest)return;a.next&&(a===this.oldest&&(this.oldest=a.next),a.next.prev=a.prev);a.prev&&(a.prev.next=a.next);a.next=void 0;a.prev=this.newest;this.newest&&(this.newest.next=a);this.newest=a};b.get=function(a){a=this.$1.get(a);if(!a)return null;this.$2(a);return a.value};b.set=function(a,b){var c=this.$1.get(a);if(c){c.value=b;this.$2(c);return this}this.$1.set(a,c=new g(a,b));this.newest?(this.newest.next=c,c.prev=this.newest):this.oldest=c;this.newest=c;++this.size;this.size>this.limit&&this.$3();return this};b.$3=function(){var a=this.oldest;if(a){this.oldest!=null?(this.oldest=this.oldest.next,this.oldest!=null&&(this.oldest.prev=void 0)):(this.oldest=void 0,this.newest=void 0);a.next=a.prev=void 0;this.$1["delete"](a.key);--this.size;return[a.key,a.value]}};b.clear=function(){this.oldest=this.newest=void 0,this.size=0,this.$1.clear()};b.toJSON=function(){var a=new Array(this.size),b=0,c=this.oldest;while(c)a[b++]={key:c.key,value:c.value},c=c.next;return a};return a}();var g=function(a,b){this.key=a,this.value=b,this.next=void 0,this.prev=void 0};f["default"]=a}),66);
__d("MAWMessageHasUniqueExternalIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils","lruMap"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("lruMap"))({limit:50});function a(a,b){a.forEach(function(a){h.set(a,b)})}b=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageWithUniqueExternalIdValidator",function(a){return function(b){return a.messages.get(b).then(function(c){var e=c==null?void 0:c.externalId;return e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.messages.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===(c==null?void 0:c.author)&&a.threadJid===(c==null?void 0:c.threadJid)}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else{return{description:"Message has duplicate externalId. Source: "+((a=h.get(e))!=null?a:"unknown"),key:b,result:"invalid"}}})})}});e={description:"MAWMessageHasUniqueExternalIdValidator",isValid:b,table:"messages",type:["add"]};g.logMessageAddSource=a;g.MAWMessageHasUniqueExternalIdValidator=e}),98);
__d("MAWParticipantMatchOneOnOneThreadValidator",["MAWIndexedDb","MAWTransactionMode","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"isParticipantMatchingOneOnOneThreadValidator",function(a){return function(b){return a.participants.get(b).then(function(a){return a==null?{key:b,result:"skipped"}:d("WAJids").switchOnMsgrChatJidType(a.threadJid,{group:function(){return{key:b,result:"skipped"}},user:function(c){return a.userJid!==c&&a.userJid!==d("WAGlobals").getMyUserJid()?{description:"Participants added to 1:1 thread is neither self or the other user",key:b,result:"invalid"}:{key:b,result:"valid"}}})})}});b={description:"MAWParticipantMatchOneOnOneThreadValidator",isValid:a,table:"participants",type:["add","put"]};g.MAWParticipantMatchOneOnOneThreadValidator=b}),98);
__d("MAWReactionHasUniqueProtocolMsgIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY},"isReactionWithUniqueProtocolMsgIdValidator",function(a){return function(b){return a.reactions.get(b).then(function(c){var e=c==null?void 0:c.externalId;return e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.reactions.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===(c==null?void 0:c.author)&&a.threadJid===(c==null?void 0:c.threadJid)}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else return{description:"Reaction has duplicate protocolMsgId",key:b,result:"invalid"}})})}});b={description:"MAWReactionHasUniqueProtocolMsgIdValidator",isValid:a,table:"reactions",type:["add","put"]};g.MAWReactionHasUniqueProtocolMsgIdValidator=b}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{create:function(b){return babelHelpers["extends"]({},b,{table:function(e){var f=b.table(e);try{return babelHelpers["extends"]({},f,{get:function(b){return f.get(b).then(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})},getMany:function(b){return f.getMany(b).then(function(b){return b.map(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})})},mutate:function(b){var c=null;switch(b.type){case"add":case"put":c=b.values.map(function(b){return d("MAWDbMiddlewareMutations").mutateValue(b,e,a)});break;case"delete":break;case"deleteRange":break}if(b.type==="delete"||b.type==="deleteRange"||c==null)return f.mutate(b);b.values=c;return f.mutate(b).then(function(a){return a})},openCursor:function(b){return f.openCursor(b).then(function(b){return b==null||b.value==null?b:h(b,e,a)})},query:function(b){return f.query(b).then(function(b){if(b.result.length===0||typeof b.result[0]!=="object")return b;var c=b.result.map(function(b){return d("MAWDbMiddlewareMutations").getValue(b,e,a)});b.result=c;return b})}})}catch(a){c("FBLogger")("maw_ear").catching(a).mustfix("Error applying MAWDbMiddleware");return f}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function b(){return{create:function(a){return babelHelpers["extends"]({},a,{table:function(b){var e=a.table(b);try{return babelHelpers["extends"]({},e,{get:function(a){return e.get(a).then(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})},getMany:function(a){return e.getMany(a).then(function(a){return a.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})},mutate:function(a){if(a.type==="delete"||a.type==="deleteRange")return e.mutate(a);a.values=a.values.map(function(a){return d("MAWDbMiddlewareMutations").mutateVaultedValue(a,b)});return e.mutate(a)},openCursor:function(a){return e.openCursor(a).then(function(a){return a==null||a.value==null?a:i(a,b)})},query:function(a){return e.query(a).then(function(a){return a.result.length===0||typeof a.result[0]!=="object"?a:babelHelpers["extends"]({},a,{result:a.result.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})})}})}catch(a){c("FBLogger")("maw_ear").catching(a).mustfix("Error applying MAWDbMiddleware");return e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function h(a,b,c){var e;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(f){return a.start(function(){e=d("MAWDbMiddlewareMutations").getValue(a.value,b,c);try{a.value=e}catch(a){}f()})}},value:{get:function(){return e}}})}function i(a,b){var c;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(e){return a.start(function(){c=d("MAWDbMiddlewareMutations").getVaultedValue(a.value,b);try{a.value=c}catch(a){}e()})}},value:{get:function(){return c}}})}g.getMAWDbMutationMiddleware=a;g.getMAWVaultMiddleware=b}),98);
__d("MAWXMACTAUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.actionUrl,c=a.buttonType,d=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,nativeUrl:d,title:a}}function b(a){var b=a.actionUrl,c=a.buttonType,d=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,nativeUrl:d,title:a}}f.toMAWCTAEncode=a;f.fromMAWCTAEncode=b}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({SET:0,REMOVE:1});c={};e={};f={};b={};var h={},i={},j={},k={},l={},m={},n={};c.internalSpec={version:[1,(d=d("WAProtoConst")).TYPES.UINT64]};e.internalSpec={code:[1,d.TYPES.UINT64],text:[2,d.TYPES.STRING]};f.internalSpec={blob:[1,d.TYPES.BYTES]};b.internalSpec={blob:[1,d.TYPES.BYTES]};h.internalSpec={id:[1,d.TYPES.BYTES]};i.internalSpec={index:[1,d.TYPES.MESSAGE,f],value:[2,d.TYPES.MESSAGE,b],keyId:[3,d.TYPES.MESSAGE,h]};j.internalSpec={mediaKey:[1,d.TYPES.BYTES],directPath:[2,d.TYPES.STRING],handle:[3,d.TYPES.STRING],fileSizeBytes:[4,d.TYPES.UINT64],fileSha256:[5,d.TYPES.BYTES],fileEncSha256:[6,d.TYPES.BYTES]};k.internalSpec={version:[1,d.TYPES.MESSAGE,c],records:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],mac:[3,d.TYPES.BYTES],keyId:[4,d.TYPES.MESSAGE,h]};l.internalSpec={mutations:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};m.internalSpec={operation:[1,d.TYPES.ENUM,a],record:[2,d.TYPES.MESSAGE,i]};n.internalSpec={version:[1,d.TYPES.MESSAGE,c],mutations:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m],externalMutations:[3,d.TYPES.MESSAGE,j],snapshotMac:[4,d.TYPES.BYTES],patchMac:[5,d.TYPES.BYTES],keyId:[6,d.TYPES.MESSAGE,h],exitCode:[7,d.TYPES.MESSAGE,e],deviceIndex:[8,d.TYPES.UINT32],clientDebugData:[9,d.TYPES.BYTES]};g.SyncdMutation$SyncdOperation=a;g.SyncdVersionSpec=c;g.ExitCodeSpec=e;g.SyncdIndexSpec=f;g.SyncdValueSpec=b;g.KeyIdSpec=h;g.SyncdRecordSpec=i;g.ExternalBlobReferenceSpec=j;g.SyncdSnapshotSpec=k;g.SyncdMutationsSpec=l;g.SyncdMutationSpec=m;g.SyncdPatchSpec=n}),98);
__d("MAWDbObjDecode",["MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloContactsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMetaRowTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloSignalTablesSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WAServerSync.pb","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){var h={appData:function(a){return J(a)},appMeta:function(a){return K(a)},browserEncryptionMeta:function(a){throw c("err")("unexpected table for decryption")},chunk:function(a){return L(a)},collectionVersions:function(a){return U(a)},contacts:function(a){return E(a)},danglingQueue:function(a){throw c("err")("unexpected table for decryption")},deletedMessages:function(a){return n(a)},deviceChangeAlerts:function(a){return i(a)},dualSendMedia:function(a){throw c("err")("unexpected table for decryption")},dyiBatch:function(a){return P(a)},ebMessageRestoreTasks:function(a){throw c("err")("unexpected table for decryption")},ebMsgRanges:function(a){return Q(a)},ebRestoreQueue:function(a){throw c("err")("unexpected table for decryption")},ebUploadQueue:function(a){throw c("err")("unexpected table for decryption")},editMsgHistory:function(a){return X(a)},ephemeralSettings:function(a){throw c("err")("unexpected table for decryption")},existingUsers:function(a){throw c("err")("unexpected table for decryption")},ftsBackloggedMessages:function(a){throw c("err")("unexpected table for decryption")},ftsEncryptionMeta:function(a){throw c("err")("unexpected table for decryption")},ftsIndexV3:function(a){throw c("err")("unexpected table for decryption")},ftsPurgeBacklog:function(a){throw c("err")("unexpected table for decryption")},ftsPurgeThreadBacklog:function(a){throw c("err")("unexpected table for decryption")},groupInfo:function(a){return q(a)},groupInvites:function(a){return G(a)},historySyncQRCodeData:function(a){throw c("err")("unexpected table for decryption")},historySyncQRCodeSecretKey:function(a){throw c("err")("unexpected table for decryption")},identity:function(a){return t(a)},igMessageAuxiliaryInfo:function(a){throw c("err")("unexpected table for decryption")},isDualSend:function(a){throw c("err")("unexpected table for decryption")},jobs:function(a){throw c("err")("unexpected table for decryption")},media:function(a){return N(a)},mediaBackup:function(a){return M(a)},mediaKeys:function(a){throw c("err")("unexpected table for decryption")},messages:function(a){return m(a)},meta:function(a){return s(a)},missingKeys:function(a){return S(a)},participants:function(a){return F(a)},pendingMessageStanzaQueue:function(a){throw c("err")("unexpected table for decryption")},pendingMutations:function(a){return T(a)},pendingReceipts:function(a){return C(a)},pendingStanzas:function(a){throw c("err")("unexpected table for decryption")},personalSenderKeyStatuses:function(a){return I(a)},prekey:function(a){return u(a)},prekeyGeneration:function(a){return v(a)},reactions:function(a){return O(a)},receipts:function(a){return B(a)},senderKeySessions:function(a){return y(a)},sentBytesCache:function(a){throw c("err")("unexpected table for decryption")},session:function(a){return w(a)},signedPrekey:function(a){return x(a)},staleQueue:function(a){throw c("err")("unexpected table for decryption")},stanzaQueue:function(a){throw c("err")("unexpected table for decryption")},syncActions:function(a){return R(a)},syncKeys:function(a){return V(a)},tasks:function(a){return H(a)},threads:function(a){return D(a)},unrenderedMessages:function(a){return o(a)},xma:function(a){return W(a)}};function a(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("err")("not a valid table name");return b}function i(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a);return{action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts}}function j(a){a=a.quote;var b;if(a!=null){if(a.content==null)throw c("err")("QuotedMsgContent missing upon decoding");var d=a.content,e=d.author,f=d.externalId,g=d.mediaId,h=d.msgContent,i=d.msgId,j=d.sourceId,k=d.specialTextSize,l=d.ts,m=d.type;d=d.xmaMessageType;b={content:babelHelpers["extends"]({},a.content,{author:e,externalId:f,mediaId:g,msgContent:h,msgId:i,sourceId:j,specialTextSize:k,ts:l,type:m,xmaMessageType:d}),remoteJid:a.remoteJid}}return b}function k(a){if(a==null)return a;else return new Uint8Array(a)}function l(a){if(a==null||a.length===0)return new Set();else return new Set(a)}function m(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,a);var b=a.msgContent;if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(b==null)throw c("err")("MsgContent missing upon decoding futureproof message");b.subtype=b.subtype}var e=j(a),f=p(a.reportingMeta);return babelHelpers["extends"]({},a,{msgContent:b,quote:e,reportingMeta:f})}function n(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a);return babelHelpers["extends"]({},a)}function o(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,a);var b=j(a),c=p(a.reportingMeta);return babelHelpers["extends"]({},a,{quote:b,reportingMeta:c})}function p(a){if(a==null)return;return{frankingKey:a.frankingKey!=null?new Uint8Array(a.frankingKey):a.frankingKey,frankingTag:a.frankingTag!=null?new Uint8Array(a.frankingTag):a.frankingTag,frankingVersion:a.frankingVersion,reportingContent:a.reportingContent,reportingTag:a.reportingTag!=null?new Uint8Array(a.reportingTag):a.reportingTag}}function q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a);return{creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a,b){var d;a=a;if(a==null)d=a;else{var e=a.privateKey;a=a.publicKey;if(e==null||a==null)throw c("err")("Decoding "+b+" private or public key missing");d={privateKey:new Uint8Array(e),publicKey:new Uint8Array(a)}}return d}function s(a){var b,c,e,f;a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMetaRowTableSchema.pb").MetaRowTableSchemaProtoSpec,a);b=(b=a.value)==null?void 0:b.cat;if(b==null)b=b;else{var g;b={encrypted_serialized_cat:(g=a.value)==null?void 0:(g=g.cat)==null?void 0:g.encryptedSerializedCat,expiration_time_in_seconds:(g=a.value)==null?void 0:(g=g.cat)==null?void 0:g.expirationTimeInSeconds}}g=(g=a.value)==null?void 0:g.edgeInfo;g=k(g);c=r((c=a.value)==null?void 0:c.identityKeyPair,"identityKeyPair");e=r((e=a.value)==null?void 0:e.authKeyPair,"authKeyPair");return{value:{abProps:(f=a.value)==null?void 0:f.abProps,authKeyPair:e,cat:b,certificateChain:(f=a.value)==null?void 0:f.certificateChain,clockSkew:(e=a.value)==null?void 0:e.clockSkew,deviceId:(b=a.value)==null?void 0:b.deviceId,deviceUUID:(f=a.value)==null?void 0:f.deviceUUID,edgeInfo:g,fbid:(e=a.value)==null?void 0:e.fbid,identityKeyPair:c,lastPrekeyGenerationId:(b=a.value)==null?void 0:b.lastPrekeyGenerationId,lastPrekeyId:(f=a.value)==null?void 0:f.lastPrekeyId,lastSessionDeviceWasLinkedTo:(g=a.value)==null?void 0:g.lastSessionDeviceWasLinkedTo,lastSignedPrekeyId:(e=a.value)==null?void 0:e.lastSignedPrekeyId,regId:(c=a.value)==null?void 0:c.regId,registrationVersion:(b=a.value)==null?void 0:b.registrationVersion,restoreMigrationAttempts:(f=a.value)==null?void 0:f.restoreMigrationAttempts}}}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").IdentityTableSchemaProtoSpec,a);var b=a.identity,c=a.firstSeenTs;b=k(b);return{deviceName:a.deviceName,firstSeenTs:c,identity:b,platform:a.platform}}function u(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyTableSchemaProtoSpec,a);var b=a.encoded;b=k(b);return{encoded:b,isDeleted:a.isDeleted}}function v(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyGenerationTableSchemaProtoSpec,a)}function w(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SessionTableSchemaProtoSpec,a);a=a.session;a=k(a);return{session:a}}function x(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SignedPrekeyTableSchemaProtoSpec,a);a=a.encoded;a=k(a);return{encoded:a}}function y(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SenderKeySessionsTableSchemaProtoSpec,a);var b=a.record;b=k(b);return{deviceId:a.deviceId,record:b}}function z(a){if(a.length===0)return null;else return new Map(a.map(function(a){var b=a.deviceJid;if(b==null||a.serializedPubKey==null)throw c("err")("Expected deviceJid or serializedPubKey are missing ");var d=new Uint8Array(a.serializedPubKey);a=k(a.baseKey);a={baseKey:a,pubKey:d};return[b,a]}))}function A(a){if(a==null)return null;else return new Map(a.map(function(a){if(a.deviceJid==null)throw c("err")("Expected deviceJID is missing ");return[a.deviceJid,(a=a.count)!=null?a:0]}))}function B(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,a);var b=a.recipientDevices;b=l(b);return{permittedIdentitiesPerDevice:z(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:A(a.retryCountsPerDevice)}}function C(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a)}function D(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a);return{archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,muteCallsExpireTimeMs:a.muteCallsExpireTimeMs,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs}}function E(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloContactsTableSchema.pb").ContactsTableSchemaProtoSpec,a);var b=a.icdcInfo,c;b!=null&&(c={devices:b.devices.map(function(a){return new Uint8Array(a)}),dirty:b.dirty,sequence:b.sequence,signingDeviceIndex:b.signingDeviceIndex,timestamp:b.timestamp});return{dhash:a.dhash,ephemeralSetting:a.ephemeralSetting,ephemeralSyncResponseBackoffInfo:a.ephemeralSyncResponseBackoffInfo,icdcFails:a.icdcFails,icdcInfo:c,isBlocked:a.isBlocked,isRestricted:a.isRestricted,lastSyncTs:a.lastSyncTs,nameForSearch:a.nameForSearch,relationship:a.relationship}}function F(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a)}function G(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a)}function H(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a)}function I(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,a);var b=a.hasSenderKey;b=l(b);return{hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs}}function J(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,a);return{ack:a.ack,contents:a.contents,permittedIdentitiesPerDevice:z(a.permittedIdentitiesPerDevice),recipientDevices:new Set(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts}}function K(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a)}function L(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a)}function M(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a)}function N(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,a);var b,e=a.mediaEntries;e==null?b=new Map():b=new Map(e.map(function(a){if(a.msgId==null||a.mediaEntryData==null)throw c("err")("Expected msgId or mediaEntryData are missing ");return[a.msgId,new Uint8Array(a.mediaEntryData)]}));return{mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedVideoInfo:a.validatedVideoInfo}}function O(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a);return{ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs,ts:a.ts}}function P(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a);return{isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId}}function Q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a);return{maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs}}function R(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,a);return{binarySyncData:a.binarySyncData,keyId:a.keyId,timestamp:a.timestamp,valueMac:a.valueMac,version:a.version}}function S(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,a);var b;a.deviceResponses==null?b=new Map():b=new Map(a.deviceResponses.map(function(a){if(a.deviceId==null)throw c("err")("Expected deviceId is missing");else return[a.deviceId,a.deviceResponse]}));return{deviceResponses:b,keyId:a.keyId,timestamp:a.timestamp}}function T(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,a);var b;switch(a.operation){case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw c("err")("operation missing when decoding PendingMutation")}return{binarySyncAction:a.binarySyncAction,operation:b,timestamp:a.timestamp,version:a.version}}function U(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,a);return{finiteFailureStartTime:a.finiteFailureStartTime,isCollectionInMacMismatchFatal:a.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:a.isCollectionLthashInconsistent,ltHash:a.ltHash,state:a.state,version:a.version}}function V(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,a);return{fingerprint:a.fingerprint,keyData:a.keyData,timestamp:a.timestamp}}function W(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,a);return{author:a.author,ctas:a.ctas.map(function(a){return d("MAWXMACTAUtil").fromMAWCTAEncode(a)}),defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").fromMAWCTAEncode(a.defaultCTA),headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType}}function X(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a);return{author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize}}g.decodeDbObj=a}),98);
__d("WASyncdKeyTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}f.toSyncKeyId=a;f.fromSyncKeyId=b;f.toSyncKeyData=c;f.fromSyncKeyData=d}),66);
__d("MAWDbObjEncode",["MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloContactsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMetaRowTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloSignalTablesSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h={appData:C,appMeta:D,browserEncryptionMeta:b,chunk:E,contacts:x,danglingQueue:b,deletedMessages:i,deviceChangeAlerts:a,dualSendMedia:b,dyiBatch:I,ebMessageRestoreTasks:b,ebMsgRanges:J,ebRestoreQueue:b,ebUploadQueue:b,editMsgHistory:L,ephemeralSettings:b,existingUsers:b,ftsBackloggedMessages:b,ftsEncryptionMeta:b,ftsIndexV3:b,ftsPurgeBacklog:b,ftsPurgeThreadBacklog:b,groupInfo:k,groupInvites:z,historySyncQRCodeData:b,historySyncQRCodeSecretKey:b,identity:m,igMessageAuxiliaryInfo:b,isDualSend:b,jobs:b,media:G,mediaBackup:F,mediaKeys:b,messages:f,meta:l,participants:y,pendingMessageStanzaQueue:b,pendingReceipts:v,pendingStanzas:b,personalSenderKeyStatuses:B,prekey:n,prekeyGeneration:o,reactions:H,receipts:u,senderKeySessions:r,sentBytesCache:b,session:p,signedPrekey:q,staleQueue:b,stanzaQueue:b,tasks:A,threads:w,unrenderedMessages:j,xma:K};function a(a){a={action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a).readByteArray()}}function b(a){throw c("err")("unexpected table for encryption")}function e(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("err")("not a valid table name");return b}function f(a){a.altIndex;a.externalId;a.messageDeleteTs;a.messageExpirationTs;a.msgId;a.quoteExternalId;a.revokedExternalId;a.rowId;a.serverTs;a.sortOrderMs;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,["altIndex","externalId","messageDeleteTs","messageExpirationTs","msgId","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"]);a=a;var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,sourceId:a.quote.content.sourceId,specialTextSize:a.quote.content.specialTextSize,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c=a.msgContent;a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(c={protobuf:a.msgContent.protobuf,subtype:a.msgContent.subtype});var e=a.ravenEphemeralType,f=a.ravenEphemeralMediaState;e=e!=null?e:null;f=f!=null?f:null;c={ack:a.ack,author:a.author,editCount:a.editCount,ephemeralCounterStarted:a.ephemeralCounterStarted,ephemeralMsgDisappeared:a.ephemeralMsgDisappeared,ephemeralSetting:a.ephemeralSetting,forwardingScore:a.forwardingScore,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isExpiredXmaMsg:a.isExpiredXmaMsg,isForwarded:a.isForwarded,mediaId:a.mediaId,msgContent:c,originalTs:a.originalTs,quote:b,ravenEphemeralMediaState:f,ravenEphemeralType:e,reportingMeta:a.reportingMeta,resendCount:a.resendCount,specialTextSize:a.specialTextSize,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,c).readByteArray()}}function i(a){a.author;a.chat;a.externalId;a.rowId;a=babelHelpers.objectWithoutPropertiesLoose(a,["author","chat","externalId","rowId"]);a={reason:String(a.reason)};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a).readByteArray()}}function j(a){var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,sourceId:a.quote.content.sourceId,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c={ack:a.ack,author:a.author,ephemeralSetting:a.ephemeralSetting,groupName:a.groupName,invitedParticipantUserJid:a.invitedParticipantUserJid,mediaId:a.mediaId,msgContent:a.msgContent,quote:b,reportingMeta:a.reportingMeta,resendCount:a.resendCount,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,c).readByteArray()}}function k(a){a={creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a).readByteArray()}}function l(a){var b=a.value.cat==null?a.value.cat:{encryptedSerializedCat:a.value.cat.encrypted_serialized_cat,expirationTimeInSeconds:a.value.cat.expiration_time_in_seconds};b={value:{abProps:a.value.abProps,authKeyPair:a.value.authKeyPair,cat:b,certificateChain:a.value.certificateChain,clockSkew:a.value.clockSkew,deviceId:a.value.deviceId,deviceUUID:a.value.deviceUUID,edgeInfo:a.value.edgeInfo,fbid:a.value.fbid,identityKeyPair:a.value.identityKeyPair,lastPrekeyGenerationId:a.value.lastPrekeyGenerationId,lastPrekeyId:a.value.lastPrekeyId,lastSessionDeviceWasLinkedTo:a.value.lastSessionDeviceWasLinkedTo,lastSignedPrekeyId:a.value.lastSignedPrekeyId,regId:a.value.regId,registrationVersion:a.value.registrationVersion}};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMetaRowTableSchema.pb").MetaRowTableSchemaProtoSpec,b).readByteArray()}}function m(a){a={deviceName:a.deviceName,firstSeenTs:a.firstSeenTs,identity:a.identity,platform:a.platform};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").IdentityTableSchemaProtoSpec,a).readByteArray()}}function n(a){a={encoded:a.encoded,isDeleted:a.isDeleted};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyTableSchemaProtoSpec,a).readByteArray()}}function o(a){a={createdTs:a.createdTs,endingId:a.endingId,startingId:a.startingId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").PrekeyGenerationTableSchemaProtoSpec,a).readByteArray()}}function p(a){a={session:a.session};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SessionTableSchemaProtoSpec,a).readByteArray()}}function q(a){a={encoded:a.encoded};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SignedPrekeyTableSchemaProtoSpec,a).readByteArray()}}function r(a){a={deviceId:a.deviceId,record:a.record};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloSignalTablesSchema.pb").SenderKeySessionsTableSchemaProtoSpec,a).readByteArray()}}function s(a){if(a==null)return a;else return Array.from(a,function(a){var b=a[0];a=a[1];return{baseKey:a.baseKey,deviceJid:b,serializedPubKey:a.pubKey}})}function t(a){if(a==null)return null;else return Array.from(a,function(a){var b=a[0];a=a[1];return{count:a,deviceJid:b}})}function u(a){var b=Array.from(a.recipientDevices);b={permittedIdentitiesPerDevice:s(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:t(a.retryCountsPerDevice)};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,b).readByteArray()}}function v(a){a={author:a.author,deliveryReceipts:a.deliveryReceipts,externalId:a.externalId,readReceipts:a.readReceipts,thread:a.thread};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a).readByteArray()}}function w(a){a={archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a).readByteArray()}}function x(a){a={dhash:a.dhash,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,lastSyncTs:a.lastSyncTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloContactsTableSchema.pb").ContactsTableSchemaProtoSpec,a).readByteArray()}}function y(a){a={addressable:a.addressable,deliveredWatermarkTs:a.deliveredWatermarkTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadWatermarkTs,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a).readByteArray()}}function z(a){a={caption:a.caption,inviteCode:a.inviteCode,inviteExpirationTs:a.inviteExpirationTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a).readByteArray()}}function A(a){a={scheduledTime:a.scheduledTime};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a).readByteArray()}}function B(a){var b=Array.from(a.hasSenderKey);b={hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,b).readByteArray()}}function C(a){var b;switch(a.contents.type){case"meta_sync":var e=[];for(var f=a.contents.actions,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;i.chatAction?e.push({chatAction:i.chatAction}):i.messageAction&&e.push({messageAction:i.messageAction})}b={actions:e,type:"meta_sync"};break;case"backups_secrets":b={encryptedBackupsSecrets:a.contents.encryptedBackupsSecrets,type:"backups_secrets"};break;case"sync_key_share":b={syncKeyShare:{keys:a.contents.syncKeyShare.keys,orphanKeys:(i=a.contents.syncKeyShare)==null?void 0:(h=i.orphanKeys)==null?void 0:h.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break;case"sync_key_request":b={syncKeyRequest:{keyIds:a.contents.syncKeyRequest.keyIds.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break;default:a.contents.type;throw c("err")("Unknown appdata type: "+a.contents.type)}g={ack:a.ack,contents:b,permittedIdentitiesPerDevice:s(a.permittedIdentitiesPerDevice),recipientDevices:Array.from(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts};return{encodedFields:g,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,g).readByteArray()}}function D(a){a={value:a.value};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a).readByteArray()}}function E(a){a={blobData:a.blobData,mimetype:a.mimetype,plaintextHash:a.plaintextHash};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a).readByteArray()}}function F(a){a={fbid:a.fbid};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a).readByteArray()}}function G(a){var b=Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return{mediaEntryData:a,msgId:b}});b={mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedVideoInfo:a.validatedVideoInfo};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,b).readByteArray()}}function H(a){a={ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a).readByteArray()}}function I(a){a={isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a).readByteArray()}}function J(a){a={maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a).readByteArray()}}function K(a){var b=a.ctas==null?[]:a.ctas.map(function(a){return d("MAWXMACTAUtil").toMAWCTAEncode(a)});b={author:a.author,ctas:b,defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").toMAWCTAEncode(a.defaultCTA),headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,b).readByteArray()}}function L(a){a={author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a).readByteArray()}}g.encodeDbObj=e}),98);
__d("MAWDbObjEncryption",["MAWBridge","MAWCryptoConsts","MAWDbObjDecode","MAWDbObjEncode","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWQplProxy","MWEARKeychainV3Errors","err","gkx","isEncryptionAtRestEnabled","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=1/1e3,i="_encryptedContent";function a(a,b,e){if(!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")===!0)||!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b))return a;var f=Math.random()<h;f=f?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25300256,"115")):null;try{var g=babelHelpers["extends"]({},a);e=e();var j=e.key;e=e.version;e=d("MAWKeychainUtil").makeAAD(e,d("MAWCryptoConsts").CIPHER_ID);var k=d("MAWDbObjEncode").encodeDbObj(a,b),l=k.encodedFields;k=k.proto;Object.keys(l).forEach(function(b){Object.prototype.hasOwnProperty.call(a,b)&&delete g[b]});l=d("MAWKeychainNaClCrypto").encrypt(j,k,e);g[i]=l;f==null?void 0:f.endSuccess();return g}catch(a){f==null?void 0:f.endFail("ear_encrypt_fail");throw c("err")(a.message+" - Encrypted dexie was unable to encrypt an entity for table "+b)}}function b(a,b,e){if(!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b)||!Object.prototype.hasOwnProperty.call(a,i))return a;var f=Math.random()<h;f=f?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313004,"118")):null;try{var g=a[i];a=babelHelpers["extends"]({},a);var j=d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(g);e=e(j);e=e.key;var k={};e=d("MAWKeychainNaClCrypto").decrypt(e,g,j);var l=d("MAWDbObjDecode").decodeDbObj(e,b);Object.keys(l).forEach(function(a){k[a]=l[a]});delete a[i];g=babelHelpers["extends"]({},a,k);f==null?void 0:f.endSuccess();return g}catch(a){f==null?void 0:f.endFail("ear_decrypt_fail");(a instanceof d("MAWKeychainNaClCrypto").EARDecryptionError||a instanceof d("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(d("MAWIndexedDb").deleteDb(),d("MAWBridge").getBridge().fireAndForget("event","earDecryptionFailure",{tableName:b}));throw c("err")(a.message+" - Encrypted dexie was unable to decrypt an entity for table "+b)}}g.ENCRYPTED_COLUMN_NAME=i;g.encryptDbObj=a;g.decryptDbObj=b}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(a){return a==null?void 0:a.value.msgTypeVersion})}function b(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function c(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function e(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:b}})}function f(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(a){return a==null?void 0:a.value.hmacKey})}function i(a,b){return a.appMeta.get({key:b})}function j(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:b}}).then(function(){})}function k(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:b}}).then(function(){})}function l(a){return i(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1})}function m(a){return i(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?a:!0})}function n(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:b}})}function o(a){return d("MAWDexieTable").dexieAll([m(a),l(a)]).then(function(a){var b=a[0];a=a[1];return{allowSecurityAlertForContact:a,allowSecurityAlertForSelf:b}})}g.MSG_TYPE_VERSION=(h=d("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion;g.ALLOW_SECURITY_ALERT_FOR_CONTACT=h.AppMetaKeysEnum.allowSecurityAlert;g.ALLOW_SECURITY_ALERT_FOR_SELF=h.AppMetaKeysEnum.allowSecurityAlertForSelf;g.HOT_LIKE=h.AppMetaKeysEnum.hotlikeSticker;g.getMsgTypeVersion=a;g.addMsgTypeVersion=b;g.updateMsgTypeVersion=c;g.addHMACKey=e;g.getHMACKey=f;g.getAppMetaValue=i;g.updateSecurityAlertValueForContact=j;g.updateSecurityAlertValueForSelf=k;g.getSecuritySettingForContact=l;g.getSecuritySettingForSelf=m;g.addHotLike=n;g.maybeBulkGetSecuritySetting=o}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return i(a).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})}function a(a,b){a=new TextEncoder().encode(a);b=new Uint8Array(b);a=c("tweetnacl-auth")(a,b);return d("WABase64").encodeB64UrlSafe(a)}function b(){return h().then(function(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(b){return function(){return d("MAWDbMsgTypeVersionTxns").getHMACKey(b).then(function(c){return c!=null?c:d("MAWDbMsgTypeVersionTxns").addHMACKey(b,a).then(function(){return a})})}})()})}function i(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}g.genHMACKey=h;g.hmacTweetNaCl=a;g.generateAndInsertHMACKey=b}),98);
__d("MAWMediaUtils",["MAWDbMedia","MAWDexieTable","MAWHMACKey","WAGlobals","WAHashUtils","WAMediaUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","err","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b="media");switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return b==="xma-media"?"xma-image":"image";case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case d("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case d("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case d("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw c("err")("get a wrong media file with type "+a)}}function h(a){try{return d("WAMediaUtils").blobToArrayBuffer(a).then(i)}catch(a){throw c("err")("Got "+a+" when convert the blob to Uint8Array")}}function i(a){return self.crypto.subtle.digest("SHA-256",a).then(function(a){return new Uint8Array(a)})}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a=d("WAHashUtils").toPlaintextHash(a);var b=k(a);return[a,b]});return j.apply(this,arguments)}function k(a){var b=d("WAGlobals").getHMACKey();return d("WAHashUtils").toHashedPlaintextHash(d("MAWHMACKey").hmacTweetNaCl(a,b))}function f(a){var b="preview-"+d("WATimeUtils").unixTime().toString()+".jpeg";return l(a,b,"image/jpeg")}function l(a,b,c){return new File([new Blob([new Uint8Array(a)],{type:c})],b,{type:c})}function m(a,b,e){var f=function(){return e!=null&&c("gkx")("3743")?d("MAWDexieTable").dexieResolve(e.filter(function(a){return a.type!==d("WAMsgType").REVOKED})):a.messages.where("msgId").anyOf(b.msgIds).filter(function(a){return a.type!==d("WAMsgType").REVOKED}).toArray()};return f().then(function(a){var e=a.map(function(a){return a.msgId});if(c("qex")._("1113")===!0){a=a.reduce(function(a,b){a[b.msgId]=d("WATimeUtils").castToMillisTime(b.sortOrderMs!=null?b.sortOrderMs:b.ts*1e3);return a},{});return babelHelpers["extends"]({},b,{messagesSortOrderMs:a,msgIds:e})}return babelHelpers["extends"]({},b,{msgIds:e})})}g.getServerMediaTypeFromMediaType=a;g.hashBlob=h;g.hashArrayBuffer=i;g.genBlobHashes=e;g.genHMACPlaintextHash=k;g.convertJpegThumbnailArrayBufferToFile=f;g.getBridgeMediaAnnotatedForDisplay=m}),98);
__d("MAWSupportedDocumentTypes",[],(function(a,b,c,d,e,f){"use strict";var g=["apk","pyc","7z","z","gz","xz","rar","zip","zipx","ace","arc","zpaq","quad","balz","cab","arj","lzh","uue","bz","bz2","bzip2","jar","iso","tar","ade","adp","air","app","application","bas","bat","chm","cmd","com","command","cpl","crt","dll","dmg","dpkg","exe","hlp","hta","inf","ins","isp","jnlp","js","jse","lib","lnk","lua","mde","msc","msi","msp","mst","ocx","pcd","pif","pkg","ps1","reg","scr","sct","sh","shb","shs","sys","term","url","vb","vbe","vbs","vxd","webarchive","wsc","wsf","wsh","xbap"];function a(a){if(a==null)return!1;a=a.includes(".")?a.split(".").pop():null;return a!=null&&!g.includes(a)}f.isAllowedType=a}),66);/*FB_PKG_DELIM*/
__d("WAAbPropsHelpers",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateExpoKeys: config_expo_key "," changed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateExpoKeys: deleting config_expo_key ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdatePropValues: deleting config ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseValue: unsure how to read ",""]);k=function(){return a};return a}var l=86400,m=600,n=604800;function a(a){return a==null?l:Math.max(m,Math.min(n,a))}function o(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c],e=d[0];d[1];d=d[2];if(typeof e!=="number")return;b.push({configName:c,configCode:e,configDefault:d})});return b}function b(a,b){a=a[b][0];return typeof a==="number"?a:null}function p(a,b){switch(typeof b){case"boolean":return a==="1";case"number":return parseFloat(a);case"string":return a;default:d("WALogger").WARN(k(),a);return null}}function c(a,b){var c=new Map();b.forEach(function(a){var b=a.configCode,d=a.configValue;a=a.configExpoKey;c.set(b,{configValue:d,configExpoKey:a})});var d={},e={};o(a).forEach(function(a){var b=a.configName,f=a.configCode;a=a.configDefault;var g=c.get(f);if(g==null)return;var h=g.configValue;g=g.configExpoKey;h=p(h,a);h!=null&&(d[b]=h);e[f]=g!=null?g:null});return{values:d,expoKeys:e}}function e(a,b,c){var e=babelHelpers["extends"]({},b,a),f={};Object.keys(e).forEach(function(a){if(c[a]==null){d("WALogger").LOG(j(),a);return}f[a]=e[a]});return f}function f(a,b,c){var e=babelHelpers["extends"]({},b,a),f={};a=o(c).map(function(a){return a.configCode});var g=new Set(a),j=new Set();Object.keys(e).forEach(function(a){a=parseInt(a,10);var c=b?b[a]:null;!g.has(a)?(d("WALogger").LOG(i(),a),c!=null&&c.trim()&&j.add(c)):(e[a]!==c&&(d("WALogger").LOG(h(),a),c!=null&&c.trim()&&j.add(c)),f[a]=e[a])});return{propExpoKeys:f,expoKeysToDelete:j}}function q(a,b){if(b==null)return;var c=b;a.forEach(function(a){c["delete"](a)});if(c.size===0)return;return{internalExpoKeys:c,expoKeyStr:Array.from(c).join(",")}}g.maybeUpdateRefresh=a;g.asAbList=o;g.asAbCode=b;g.parseAbProps=c;g.maybeUpdatePropValues=e;g.maybeUpdateExpoKeys=f;g.maybeUpdateInternalExpoKeys=q}),98);
__d("WAAbProps",["WAAbPropsHelpers","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h)return h;else throw c("WAErr")("abProps::"+a+" called before startAbProps")}function a(a,b){h==null&&(h={config:b,db:a})}function b(){return i("getHash").db.getHash()}function e(){return i("getRefreshSecs").db.getRefreshSecs().then(function(a){return d("WAAbPropsHelpers").maybeUpdateRefresh(a)})}function f(){return i("getConfig").config}function j(){return i("getAbProps").db.getAbProps()}function k(a){return i("getAbProps").db.setAbProps(a)}g.startAbProps=a;g.getHash=b;g.getRefreshSecs=e;g.getConfig=f;g.getAbProps=j;g.setAbProps=k}),98);
__d("WAAppData",[],(function(a,b,c,d,e,f){"use strict";a=1;b=2;f.EPOCH_STATUS_OPEN=a;f.EPOCH_STATUS_CLOSE=b}),66);
__d("WAArmadilloICDC.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={seq:[1,(c=d("WAProtoConst")).TYPES.INT32],timestamp:[2,c.TYPES.INT64],devices:[3,c.FLAGS.REPEATED|c.TYPES.BYTES],signingDeviceIndex:[4,c.TYPES.INT32]};b.internalSpec={details:[1,c.TYPES.BYTES],signature:[2,c.TYPES.BYTES]};g.ICDCIdentityListSpec=a;g.SignedICDCIdentityListSpec=b}),98);
__d("WAArrayChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d){c===void 0&&(c=!1);var e=0,f=[];while(e<a.length){var g=[],h=0;while(e<a.length){var i=a[e],j=d?d(i):1;if(!c&&h===0||h+j<=b)h+=j,g.push(i),e++;else{c&&j>b&&e++;break}}g.length>0&&f.push(g)}return f}f.chunk=a}),66);
__d("WACryptoPkcs7",["WACryptoDependencies","WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=new Uint8Array(1);do d("WACryptoDependencies").getCrypto().getRandomValues(b);while(b[0]===0);h(a,b[0])}function b(a){var b=new Uint8Array(1);d("WACryptoDependencies").getCrypto().getRandomValues(b);h(a,(b[0]&15)+1)}function h(a,b){for(var c=0;c<b;c++)a.writeUint8(b)}function e(a){if(a.length===0)throw c("WAErr")("unpadPkcs7 given empty bytes");var b=a[a.length-1];if(b>a.length)throw c("WAErr")("unpadPkcs7 given "+a.length+" bytes, but pad is "+b);return new Uint8Array(a.buffer,a.byteOffset,a.length-b)}g.writeRandomPad=a;g.writeRandomPadMax16=b;g.writePad=h;g.unpadPkcs7=e}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f=2);var g;b!=null&&(g={destinationJid:b});var h;a!=null&&(h={applicationPayload:{payload:a,version:f}});b=new(d("WABinary").Binary)();d("WACryptoPkcs7").writeRandomPadMax16(b);return{payload:h,protocol:{integral:{padding:b.readBuffer(),dsm:g},ancillary:{skdm:c==null?void 0:c,icdc:e==null?void 0:e}}}}g.asMessageTransport=a}),98);
__d("WABulkPutContactsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READWRITE},"bulkPutContacts",function(a){return function(b){b=b.map(function(a){return{contactJid:a.contactJid,dhash:a.dhash,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,lastSyncTs:a.lastSyncTs}});return a.contacts.bulkPut(b).then(function(){})}});g.bulkPutContacts=a}),98);
__d("WABulkPutMediaKeysApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({mediaKeys:d("MAWTransactionMode").READWRITE},"bulkPutMediaKeys",function(a){return function(b){return a.mediaKeys.bulkPut(b).then(function(){})}});g.bulkPutMediaKeys=a}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNoValidJIDMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetch=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetch:b.value}))}g.parseFetchKeyBundlesResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchKeyBundlesResponseServerError=a}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(a,b,c,d,e,f,g){b={validators:[(a=d("WAJids")).validateDeviceJid,a.validateDeviceJid],typeName:"DeviceJid|DeviceJid"};c={validators:[a.validateDeviceJid,a.validateDeviceJid,a.validateInteropDeviceJid,a.validateInteropDeviceJid],typeName:"DeviceJid|DeviceJid|InteropDeviceJid|InteropDeviceJid"};e={validators:[a.validateDeviceJid,a.validateDomainJid],typeName:"DeviceJid|DomainJid"};f={validators:[a.validateUserJid,a.validateUserJid],typeName:"UserJid|UserJid"};g.DEVICEJID_DEVICEJID=b;g.DEVICEJID_DEVICEJID_INTEROPDEVICEJID_INTEROPDEVICEJID=c;g.DEVICEJID_DOMAINJID=e;g.USERJID_USERJID=f}),98);
__d("WASmaxInPreKeysResponsePaddingMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"padding");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytesRange(b.value,0,524288);return!a.success?a:d("WAResultOrError").makeResult({paddingElementValue:a.value})}g.parseResponsePaddingMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",500,599);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorFallbackMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,b.value,"code",500);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorMixin=a}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"device-identity");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytes(a.value);return!a.success?a:d("WAResultOrError").makeResult({deviceIdentityElementValue:a.value})}g.parseDeviceIdentityMixin=a}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"key");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:d("WAResultOrError").makeResult({keyIdKeyIDMixin:b.value,keyValueKeyDataMixin:a.value})}g.parsePreKeyMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_cloud_api","true");if(!c.success)return c;var e=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a),g=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!g.success)return g;var h=d("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(a),i=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!i.success)return i;a=d("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({t:b.value,isCloudApi:c.value},e.value,{keyTypeMixin:f.success?f.value:null},g.value,{preKeyMixin:h.success?h.value:null},i.value,{deviceIdentityMixin:a.success?a.value:null}))}g.parseFetchKeyBundlesUserSuccessMixin=a}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:b.value});var c=d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:c.value});var e=d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(a);return e.success?d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserSuccess","UserError","UserErrorFallback"],[b,c,e])}g.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysEnums","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysResponsePaddingMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseJid").attrJidEnum(a,"jid",d("WASmaxInPreKeysEnums").DEVICEJID_DEVICEJID);if(!b.success)return b;a=d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!c.success)return c;b=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInPreKeysResponsePaddingMixin").parseResponsePaddingMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,1e5,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{responsePaddingMixin:a.success?a.value:null,listUser:c.value}))}g.parseFetchKeyBundlesResponseSuccessListUser=h;g.parseFetchKeyBundlesResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid;a=a.hasUserReasonIdentity;b=d("WASmaxJsx").smax("user",{jid:d("WAWap").JID(b),reason:d("WASmaxAttrs").OPTIONAL_LITERAL("identity",a)});return b}function a(a){a=a.userArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("key",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,1e5))));return a}g.makeFetchKeyBundlesRequestKeyUser=h;g.makeFetchKeyBundlesRequest=a}),98);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseRequestError",value:h.value});case 10:i=d("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:g,RequestError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendFetchKeyBundlesRPC=a}),98);
__d("WAFetchPreKeyBundlesProtocol",["WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchKeyBundlesRPC","WATagsLogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["RequestError: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ServerError: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetched prekey successfully"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["start fetching prekey of ","..."]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["fetchPreKeyBundlesProtocol"]);function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:l.LOG(k(),a.join(", "));n.next=3;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:a.map(function(a){return{userJid:a,hasUserReasonIdentity:!1}})}));case 3:c=n.sent;n.t0=c.name;n.next=n.t0==="FetchKeyBundlesResponseSuccess"?7:n.t0==="FetchKeyBundlesResponseServerError"?11:n.t0==="FetchKeyBundlesResponseRequestError"?14:17;break;case 7:l.LOG(j());e=new Map();c.value.listUser.map(function(a){var b=a.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;b.name==="FetchKeyBundlesUserSuccess"&&e.set(a.jid,m(b.value))});return n.abrupt("return",d("WAResultOrError").makeResult(e));case 11:f=c.value.errorServerErrors.name;l.WARN(i(),f);return n.abrupt("return",d("WAResultOrError").makeError({type:"server-error",payload:f}));case 14:g=c.value.errorRequestErrorsFetch.name;l.ERROR(h(),g);return n.abrupt("return",d("WAResultOrError").makeError({type:"request-error",payload:g}));case 17:case"end":return n.stop()}},null,this)}function m(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WASignalKeys").serializeIdentity(a.elementValue),e=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),f=a.preKeyMixin?n(a.preKeyMixin):null;a=d("WATimeUtils").castToUnixTime(a.t||0);return{keys:{regId:b,identity:c,oneTimeKey:f,signedKey:{id:e.id,signature:e.signature,publicKey:d("WASignalKeys").serializeIdentity(e.pubkey)}},timestamp:a}}function n(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.keyIdKeyIDMixin.elementValue,3),publicKey:d("WASignalKeys").serializeIdentity(a.keyValueKeyDataMixin.elementValue)}}g.fetchPreKeyBundlesProtocol=a}),98);
__d("WABulkRequestKeys",["WAFetchPreKeyBundlesProtocol","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WAFetchPreKeyBundlesProtocol").fetchPreKeyBundlesProtocol(a));case 2:c=e.sent;if(c.success){e.next=5;break}return e.abrupt("return",d("WAResultOrError").makeError("errRequestKeysParsingFailed"));case 5:return e.abrupt("return",d("WAResultOrError").makeResult(c.value));case 6:case"end":return e.stop()}},null,this)}g.bulkRequestKeys=a}),98);
__d("WADbIdentityTxns",["MAWDexieTable","WACryptoUtils","WAGlobals","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalidate dhash for ",""]);h=function(){return a};return a}function a(a,b){if(b==null)return void 0;a=d("WAJids").isAuthorMe(a)?d("WAGlobals").getMyUserJid():a;return d("WAJids").toDeviceJid(a,b)}function b(a,b){return i(a,b).then(function(a){return a.map(function(a){if(a==null)return;return{id:a.deviceJid,identity:a.identity}}).filter(Boolean)})}function c(a,b){return a.identity.bulkPut(b).then(function(){})}function e(a,b){return i(a,b).then(function(a){var c=new Map();for(var d=0;d<a.length;d++){var e=a[d],f=b[d];e!=null&&c.set(f,{pubKey:e.identity})}return c})}function i(a,b){return a.identity.bulkGet(b)}function j(a,b){return a.identity.where("userJid").equals(b).toArray()}function f(a,b){return a.identity.where("userJid").anyOf(b).toArray()}function k(a,b,c){var e=[],f=new Map();b.forEach(function(b){var d=j(a,b).then(function(a){var d=[];a.forEach(function(a){if(c!=null&&a.deviceJid===c)return;d.push(a)});d.length>0&&f.set(b,d)});e.push(d)});return d("MAWDexieTable").dexieAll(e).then(function(){return f})}function l(a,b){var c=b.find(function(a){return a.deviceJid===d("WAGlobals").getMyDeviceJid()});if(c!=null)return a.identity.get(c.deviceJid).then(function(a){if(a!=null&&!d("WACryptoUtils").uint8ArraysEqual(c.identity,a.identity))return!0;else return!1});else return d("MAWDexieTable").dexieResolve(!1)}function m(a,b){d("WALogger").DEV(h(),b);return a.contacts.bulkGet(b).then(function(b){b=b.filter(Boolean);b.forEach(function(a){a.dhash=null});return a.contacts.bulkPut(b)}).then(function(){})}g.getDeviceJid=a;g.bulkGetIdentities=b;g.bulkPutIdentities=c;g.getIdentitiesForDevices=e;g.bulkGetIdentityRows=i;g.getIdentitiesForUser=j;g.getIdentitiesForUsers=f;g.getIdentitiesForMultipleUsers=k;g.compareIdentityMismatch=l;g.invalidateDhash=m}),98);
__d("WAGetPrekeyIdsInRange",["WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";var h=16777215;function i(a){return a}function a(a,b){var c=[];a=i(a);var e=i(b);if(a<=e)for(var f=a;f<=b;f++)c.push(d("WASignalKeys").castToPreKeyId(f));else{for(b=a;b<h;b++)c.push(d("WASignalKeys").castToPreKeyId(b));for(f=1;f<=e;f++)c.push(d("WASignalKeys").castToPreKeyId(f))}return c}g.PRE_KEY_MAX_ID=h;g.getPrekeyIdsInRange=a}),98);
__d("WADbPrekeyTxns",["MAWDexieTable","WAErr","WAGetPrekeyIdsInRange"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.prekeyGeneration.get(b).then(function(b){if(b==null)throw c("WAErr")("Expected a prekey generation row");b=d("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(b.startingId,b.endingId);return h(a,b).then(function(a){return a.filter(Boolean).map(function(a){return a.encoded})})})}function b(a,b){return b.length===0?d("MAWDexieTable").dexieResolve():a.prekey.bulkDelete(b).then(function(){})}function h(a,b){return a.prekey.bulkGet(b)}function e(a,b){return a.prekeyGeneration.bulkGet(b)}g.getPrekeysForGeneration=a;g.bulkDeletePreKeys=b;g.getPrekeys=h;g.getPrekeyGenerations=e}),98);
__d("WADbSenderKeySessionTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.senderKeySessions.bulkPut(b).then(function(){})}function b(a,b){return a.senderKeySessions.where("groupJid").equals(b)["delete"]()}function c(a,b){return a.senderKeySessions.bulkGet(b)}f.bulkPutSenderKeySessions=a;f.deleteSenderKeysByGroupJid=b;f.getSenderKeySessionsBySenderKeySessionId=c}),66);
__d("WADbSessionTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.session.bulkPut(b).then(function(){})}function b(a,b){return a.session.bulkGet(b)}f.bulkSaveSessions=a;f.bulkGetSessions=b}),66);
__d("WABulkSaveSignalDataApi",["MAWDexieTable","MAWTransactionMode","WAArrayZip","WACryptoManager","WADbIdentityTxns","WADbPrekeyTxns","WADbSenderKeySessionTxns","WADbSessionTxns","WADbSignal","WADbTransactor","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("WADbTransactor").makeSignalTransactor({contacts:(a=d("MAWTransactionMode")).READWRITE,identity:a.READWRITE,prekey:a.READWRITE,senderKeySessions:a.READWRITE,session:a.READWRITE},"bulkSaveSignalData",function(a){return function(b){var c=b.dhashUpdate,e=b.icdcUpdate,f=b.identityRemove,g=b.identityUpdate,i=b.preKeyRemove,k=b.senderKeySessionUpdate,l=b.sessionRemove;b=b.sessionUpdate;b=b.map(function(a){var b=a.id;a=a.updated;return{id:b,session:d("WACryptoManager").encodeSession(a)}});var m=[],n=[];k.forEach(function(a){var b=a.author,c=a.groupId;a=a.updated;var e=d("WAJids").extractUserJid(b);b=d("WAJids").extractDeviceId(b);var f=d("WADbSignal").buildSenderKeySessionId(c,e,b);n.push({deviceId:b,groupJid:c,id:f,record:d("WACryptoManager").encodeSenderKeySession(a),userJid:e})});return d("MAWDexieTable").dexieAll([a.session.bulkDelete(l),a.identity.bulkDelete(f),j(a,e),d("WADbSessionTxns").bulkSaveSessions(a,b),d("WADbSenderKeySessionTxns").bulkPutSenderKeySessions(a,n),h(a,g,c),d("WADbPrekeyTxns").bulkDeletePreKeys(a,i.map(function(a){a=a.id;return a}))]).then(function(){return d("WAResultOrError").makeResult(m)})}});function h(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.map(function(a){var b=a.id;a=a.identity;return{deviceJid:b,identity:a,userJid:d("WAJids").extractUserJid(b)}});return d("MAWDexieTable").dexieAll([d("WADbIdentityTxns").bulkPutIdentities(a,b),d("WADbIdentityTxns").invalidateDhash(a,b.map(function(a){return a.userJid})).then(function(){return i(a,c)})]).then(function(){return[]})}function i(a,b){return b.length===0?d("MAWDexieTable").dexieResolve():a.contacts.bulkGet(b.map(function(a){a=a.id;return a})).then(function(a){return d("WAArrayZip").zip(b,a).map(function(a){var b=a[0].dhash;a=a[1];return a==null?null:babelHelpers["extends"]({},a,{dhash:b})})}).then(function(b){return a.contacts.bulkPut(b.filter(Boolean))})}function j(a,b){return b.length===0?d("MAWDexieTable").dexieResolve():a.contacts.bulkGet(b.map(function(a){a=a.id;return a})).then(function(a){return d("WAArrayZip").zip(b,a).map(function(a){var b=a[0].icdc;a=a[1];return a==null?null:babelHelpers["extends"]({},a,{icdcInfo:b})})}).then(function(b){return a.contacts.bulkPut(b.filter(Boolean))})}g.bulkSaveSignalData=b}),98);
__d("WACompareIdentity",["MAWODSProxy","WABase64","WACryptoUtils","WADbIdentityTxns","WADbSignal","WAJids","WALogger","WAOdsEnums","WASignalKeys","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got identity mismatch ",", "," in compare identity"]);h=function(){return a};return a}function a(a){return a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.fbid,d("WADbSignal").MetaKeysEnum.deviceId,d("WADbSignal").MetaKeysEnum.identityKeyPair]).then(function(b){var e=b[0],f=b[1];b=b[2];e=e==null?void 0:e.value.fbid;f=f==null?void 0:f.value.deviceId;var g=b==null?void 0:b.value.identityKeyPair;if(e!=null&&f!=null){b=d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(e),f);return d("WADbIdentityTxns").bulkGetIdentities(a,[b]).then(function(a){if(!(a.length===0)){a=a[0];if((g==null?void 0:g.publicKey)==null)return!0;if(!d("WACryptoUtils").serializedPubKeysEqual(a.identity,d("WASignalKeys").serializePubKey(g))){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"meta_identity_mismatch"});c("gkx")("23915")&&c("gkx")("23916")&&d("WALogger").ERROR(h(),d("WABase64").encodeB64(a.identity),d("WABase64").encodeB64(d("WASignalKeys").serializePubKey(g)));return!1}}return!0})}return!0})}g.compareIdentityDexie=a}),98);
__d("WAIdentityUtils",["WABinary","WACryptoDependencies","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.length===33&&a[0]===5;return b?a.slice(1):a}function i(a,b){for(var c=0;c<a.length&&c<b.length;++c)if(a[c]!==b[c])return a[c]-b[c];return a.length-b.length}function a(a){a=a.map(function(a){return h(a)});var b=new(d("WABinary").Binary)();a.sort(i).forEach(function(a){return b.writeByteArray(a)});a=d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",b.readByteArray());return a.then(function(a){a=new Uint8Array(a);return d("WASignalOther").sliceBytes(a,0,10)})}g.removeKeyTypeIfNeeded=h;g.computeIdentitiesHash=a}),98);
__d("WAICDCUtils",["WAArmadilloICDC.pb","WABase64","WABinary","WABridge","WACryptoDependencies","WACryptoEd25519","WACryptoUtils","WAErr","WAIdentityUtils","WAJids","WALogger","WAOdsEnums","WASignalKeys","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ICDC timestamp is negative. time: ",", closkSkew: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["signingDeviceIndex not found. This should never happen. ",". caller: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched missed signingDeviceIndex"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched timestamp between XML node and byte structure"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched sequence between XML node and byte structure"]);l=function(){return a};return a}function a(a,b,c,e){if(a!==e.details.seq){d("WALogger").ERROR(l());return null}if(c!==e.details.timestamp){d("WALogger").ERROR(k());return null}if(e.details.signingDeviceIndex==null){d("WALogger").ERROR(j());return null}var f=e.details.signingDeviceIndex;return{dirty:b,sequence:a,timestamp:c,signingDeviceIndex:f,devices:e.details.devices.map(function(a){return new Uint8Array(a)})}}function m(a){return a.signingDeviceIndex<0||a.signingDeviceIndex>=a.devices.length}function n(a,b){if(m(b))return null;var c=new Set(),e=new Set();b.devices.forEach(function(a){c.add(a.id),e.add(a.identity.toString())});var f=new Set(),g=new Set();a.devicesInfo.forEach(function(a){var b=d("WAJids").extractDeviceId(a.jid);a=d("WAIdentityUtils").removeKeyTypeIfNeeded(a.identity);(!c.has(b)||!e.has(a.toString()))&&(f.add(b),g.add(a.buffer))});return{seq:b.sequence,signingDevice:d("WAIdentityUtils").removeKeyTypeIfNeeded(b.devices[b.signingDeviceIndex].identity).buffer,unknownDevices:Array.from(g),unknownDeviceIds:Array.from(f)}}function b(a,b,c){var d=new Map();c.forEach(function(a){d.set(a.user,a)});c=d.get(a.user);var e=void 0;c!=null&&(e=n(a,c));var f=[],g=[];b.forEach(function(a){var b=d.get(a.user);if(b!=null){b=n(a,b);b!=null&&f.push(b)}g.push(a.user)});return{senderIdentity:(a=e)!=null?a:void 0,recipientIdentities:f,recipientUserJids:g}}function e(a,b,c){if(a==null){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"missing_icdc_payload"});return{action:"none"}}else if(b==null||a.seq==null||a.signingDevice==null){b==null&&d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.missing_stored_icdc"});(a.seq==null||a.signingDevice==null)&&d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.invalid_icdc_payload"});return{action:"error",failureTs:d("WATimeUtils").unixTime(),sync:!0}}var e=a.seq,f=a.signingDevice;if(e===b.sequence){var g=new Set();c.forEach(function(a){return g.add(d("WAIdentityUtils").removeKeyTypeIfNeeded(a).toString())});e=!g.has(new Uint8Array(f).toString());b=a.unknownDevices.some(function(a){return!g.has(new Uint8Array(a).toString())});if(e||b){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.unknow_device"});return{action:"error",failureTs:d("WATimeUtils").unixTime(),sync:!0}}}else{d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ICDC,key:"error.incorrect_seq"});return{action:"error",failureTs:d("WATimeUtils").unixTime(),sync:!0}}return{action:"none"}}function f(a){a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,a);var b=a.signature;a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,a.details);return{signature:b,details:a}}function o(a){return a.map(function(a){return d("WASignalKeys").serializeIdentity(new Uint8Array(d("WABase64").decodeB64UrlSafe(a)))})}function p(a,b,e,f,g){var j=d("WAIdentityUtils").removeKeyTypeIfNeeded(a.publicKey);e=e.map(function(a){return d("WAIdentityUtils").removeKeyTypeIfNeeded(a)});var k=e.findIndex(function(a){return d("WACryptoUtils").uint8ArraysEqual(a,j)});if(k===-1){d("WALogger").ERROR(i(),f,g);throw c("WAErr")("signingDeviceIndex not found")}f=b==null?1:b+1;g=d("WATimeUtils").unixTime();g<0&&d("WALogger").ERROR(h(),Date.now(),d("WATimeUtils").getClockSkew());b={seq:f,timestamp:g,devices:e,signingDeviceIndex:k};f=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,b).readBuffer();g=q(a,d("WABinary").Binary.build(f).readByteArray());e={details:f,signature:g};k=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,e).readBuffer();return{icdcInfo:b,encodedSignedICDC:k}}function q(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);var e=new Uint8Array(64);d("WACryptoEd25519").hashSha512(e,b,b.length);e=d("WASignalSignatures").makeSignature(a,b,c);return d("WABinary").Binary.build(e).readBuffer()}var r=4*d("WATimeUtils").HOUR_SECONDS;function s(a){return a==null?!0:!d("WATimeUtils").happenedWithin(a,r)}g.validateAndPrepareICDCFromNotification=a;g.isICDCIndexInvalid=m;g.computeICDCParticipantDevices=b;g.validateICDCInfo=e;g.decodeICDCInfo=f;g.base64DeviceIdentitiesToSerializedPubKeys=o;g.computeICDCInfoForUpload=p;g.isLastSyncTsExpired=s}),98);
__d("WAComputeAndUploadICDCInfo",["WABase64","WADeprecatedSendIq","WADeprecatedWapParser","WAGetDevices","WAGlobals","WAICDCUtils","WAIdentityUtils","WALogger","WAPromiseBackoffs","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot update ICDC for user, because of "," server response"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed getting devices ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Loading identities fails with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo called ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("parseUploadICDCInfoResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")}),m=0;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=c.reason;var e=c.caller;c=c.sequence;d("WALogger").LOG(k(),c);var f;try{f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.cryptoManager;var b=(yield a.storage.loadIdentities(d("WAGlobals").getMyUserJid()));a=a.regInfo;return{regInfo:a,identities:Array.from(b.values())}});return function(b){return a.apply(this,arguments)}}(),{operationType:"icdc_load_identities",flush:!1,afterInit:!0}))}catch(a){d("WALogger").ERROR(j(),a.toString())}if(f==null)return;var g=f,n=g.regInfo;g=g.identities;n=d("WAICDCUtils").computeICDCInfoForUpload(n.staticKeyPair,c,g,a,e);var o=n.icdcInfo;c=n.encodedSignedICDC;a=(yield d("WAIdentityUtils").computeIdentitiesHash(g));e=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"fbid:devices"},d("WAWap").wap("icdc",{ihash:d("WAWap").CUSTOM_STRING(d("WABase64").encodeB64(a)),seq:d("WAWap").INT(o.seq),ts:d("WAWap").INT(o.timestamp)},c));n=(yield d("WADeprecatedSendIq").deprecatedSendIq(e,l));n.success?(m=0,yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.saveICDC(d("WAGlobals").getMyUserJid(),{sequence:o.seq,timestamp:o.timestamp,devices:o.devices,signingDeviceIndex:o.signingDeviceIndex,dirty:!1})},{operationType:"save_icdc",flush:!0,afterInit:!0})):(m+=1,n.errorCode===406||n.errorCode===500?setTimeout(function(){d("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"compute-Upload-icdc",users:new Set().add(d("WAGlobals").getMyUserJid())})["catch"](function(a){d("WALogger").ERROR(i(),a.toString())})},d("WAPromiseBackoffs").getDelay(m,{jitter:.1,max:3e4,algo:{type:"fibonacci",first:1e3,second:1e3}})):d("WALogger").WARN(h(),n.errorCode))});return function(b,c){return a.apply(this,arguments)}}();g.computeAndUploadICDCInfo=a}),98);
__d("WAGetDevices",["WADevicesState","WALogger","WAPushSafeTypes","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchAndSaveDevices: ",""]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAPushSafeTypes").unsafeNotNullable(b);b=a.users;var c=a.reason;a=a.ignoreDhash;a=a===void 0?!1:a;d("WALogger").LOG(h(),c);a&&d("WADevicesState").getDevicesState().reset(Array.from(b));yield d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(b),"getDevices job: "+c,a)});return i.apply(this,arguments)}g.getDevices=a}),98);
__d("WAHandleFbDeviceChangeNotificationProtocol",["WAICDCUtils","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.dhash}function b(a){var b;b=((b=a.iCDCDirtyMixin)==null?void 0:b.dirty)==="true";var c=d("WATimeUtils").castToUnixTime(a.ts),e=a.seq;a=d("WAICDCUtils").decodeICDCInfo(a.elementValue);e=d("WAICDCUtils").validateAndPrepareICDCFromNotification(e,b,c,a);return e==null?d("WAResultOrError").makeError("icdc-validation-failure"):d("WAResultOrError").makeResult(e)}g.parseDhash=a;g.parseICDCFromServer=b}),98);
__d("WALoadContactsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY},"loadContacts",function(a){return function(b){return a.contacts.bulkGet(b).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.contactJid,{contactJid:a.contactJid,dhash:a.dhash,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,lastSyncTs:a.lastSyncTs}]}))})}});g.loadContacts=a}),98);
__d("WASmaxInDevicesIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInDevicesNonRetryableIQErrorMixin",["WASmaxInDevicesIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);return!b.success?b:b}g.parseNonRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorMixin","WASmaxInDevicesIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInDevicesIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable"],[b,c])}g.parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInDevicesRetryableIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"backoff",0,86400);if(!b.success)return b;a=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({backoff:b.value,iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:a.value})}g.parseRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableIQErrorMixin").parseNonRetryableIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableIQError"],[b,c])}g.parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchResponseError=a}),98);
__d("WASmaxInDevicesIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInDevicesFetchNonRetryableUserErrorMixin",["WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return!b.success?b:b}g.parseFetchNonRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchRetryableUserErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:b.value})}g.parseFetchRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup",["WAResultOrError","WASmaxInDevicesFetchNonRetryableUserErrorMixin","WASmaxInDevicesFetchRetryableUserErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchRetryableUserErrorMixin").parseFetchRetryableUserErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchRetryableUserError",value:b.value});var c=d("WASmaxInDevicesFetchNonRetryableUserErrorMixin").parseFetchNonRetryableUserErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchNonRetryableUserError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableUserError","NonRetryableUserError"],[b,c])}g.parseFetchOrFetchNonRetryableUserErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseFailureMixin",["WAResultOrError","WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseJid").attrUserJid(a,"jid");if(!a.success)return a;b=d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup").parseFetchOrFetchNonRetryableUserErrorMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult({jid:a.value,errorFetchOrFetchNonRetryableUserErrorMixinGroup:b.value})}g.parseFetchUserResponseFailureMixin=a}),98);
__d("WASmaxInDevicesDeviceModelInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a){var b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(a,"model",i);return!a.success?a:d("WAResultOrError").makeResult({platform:b.value,model:a.value})}g.parseDeviceModelInfoPlatform=h;g.parseDeviceModelInfoModel=i;g.parseDeviceModelInfoMixin=a}),98);
__d("WASmaxInDevicesDhashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"dhash");return!a.success?a:d("WAResultOrError").makeResult({dhash:a.value})}g.parseDhashMixin=a}),98);
__d("WASmaxInDevicesKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInDevicesIdentityKeyMixin",["WASmaxInDevicesKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInDevicesKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInDevicesDeviceListMixin",["WAResultOrError","WASmaxInDevicesDeviceModelInfoMixin","WASmaxInDevicesDhashMixin","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!b.success)return b;var c=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;a=d("WASmaxInDevicesDeviceModelInfoMixin").parseDeviceModelInfoMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({id:b.value},c.value,{deviceModelInfoMixin:a.success?a.value:null}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDhashMixin").parseDhashMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(a,"device",0,25,h);return!a.success?a:d("WAResultOrError").makeResult({dhashMixin:b.success?b.value:null,device:a.value})}g.parseDeviceListDevice=h;g.parseDeviceListMixin=a}),98);
__d("WASmaxInDevicesICDCDirtyMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"dirty","true");return!b.success?b:d("WAResultOrError").makeResult({dirty:b.value})}g.parseICDCDirtyMixin=a}),98);
__d("WASmaxInDevicesICDCSeqMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrIntRange(a,"seq",0,2147483647);return!a.success?a:d("WAResultOrError").makeResult({seq:a.value})}g.parseICDCSeqMixin=a}),98);
__d("WASmaxInDevicesICDCSignedListMixin",["WAResultOrError","WASmaxInDevicesICDCSeqMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"ts",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").contentBytesRange(a,1,40072);if(!c.success)return c;a=d("WASmaxInDevicesICDCSeqMixin").parseICDCSeqMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({ts:b.value,elementValue:c.value},a.value))}g.parseICDCSignedListMixin=a}),98);
__d("WASmaxInDevicesICDCFromServerMixin",["WAResultOrError","WASmaxInDevicesICDCDirtyMixin","WASmaxInDevicesICDCSignedListMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCSignedListMixin").parseICDCSignedListMixin(a);if(!b.success)return b;a=d("WASmaxInDevicesICDCDirtyMixin").parseICDCDirtyMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{iCDCDirtyMixin:a.success?a.value:null}))}g.parseICDCFromServerMixin=a}),98);
__d("WASmaxInDevicesFetchUserResponseSuccessMixin",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"devices",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"icdc",i);if(!c.success)return c;a=d("WASmaxParseJid").attrUserJid(a,"jid");return!a.success?a:d("WAResultOrError").makeResult({jid:a.value,devices:b.value,icdc:c.value})}g.parseFetchUserResponseSuccessDevices=h;g.parseFetchUserResponseSuccessIcdc=i;g.parseFetchUserResponseSuccessMixin=a}),98);
__d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup",["WAResultOrError","WASmaxInDevicesFetchUserResponseFailureMixin","WASmaxInDevicesFetchUserResponseSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchUserResponseFailureMixin").parseFetchUserResponseFailureMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchUserResponseFailure",value:b.value});var c=d("WASmaxInDevicesFetchUserResponseSuccessMixin").parseFetchUserResponseSuccessMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchUserResponseSuccess",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserResponseFailure","UserResponseSuccess"],[b,c])}g.parseUserResponseFetchFailureOrFetchSuccessMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseMixin",["WAResultOrError","WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup").parseUserResponseFetchFailureOrFetchSuccessMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({userResponseFetchFailureOrFetchSuccessMixinGroup:b.value})}g.parseFetchUserResponseMixin=a}),98);
__d("WASmaxInDevicesIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInDevicesFetchResponseSuccess",["WAResultOrError","WASmaxInDevicesFetchUserResponseMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesFetchUserResponseMixin").parseFetchUserResponseMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"users");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{usersUser:b.value}))}g.parseFetchResponseSuccessUsersUser=h;g.parseFetchResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutDevicesDhashMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyDhash;a=d("WASmaxJsx").smax("smax$any",{dhash:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDhashMixin=a}),98);
__d("WASmaxOutDevicesICDCSeqMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySeq;a=d("WASmaxJsx").smax("smax$any",{seq:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeICDCSeqMixin=a}),98);
__d("WASmaxOutDevicesFetchRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutDevicesBaseIQGetRequestMixin","WASmaxOutDevicesDhashMixin","WASmaxOutDevicesICDCSeqMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid,c=a.dhashMixinArgs;a=a.iCDCSeqMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesICDCSeqMixin").mergeICDCSeqMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesDhashMixin").mergeDhashMixin,d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(b)}),c),a);return b}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeFetchRequestUsersUser=h;g.makeFetchRequest=a}),98);
__d("WASmaxDevicesFetchRPC",["WAComms","WASmaxInDevicesFetchResponseError","WASmaxInDevicesFetchResponseSuccess","WASmaxOutDevicesFetchRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDevicesFetchRequest").makeFetchRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDevicesFetchResponseSuccess").parseFetchResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"FetchResponseSuccess",value:g.value});case 7:h=d("WASmaxInDevicesFetchResponseError").parseFetchResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"FetchResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Fetch",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendFetchRPC=a}),98);
__d("WAFetchFbDevicesProtocol",["Promise","WAArrayChunk","WAErr","WAHandleFbDeviceChangeNotificationProtocol","WAJids","WALoadContactsApi","WAResultOrError","WASignalKeys","WASmaxDevicesFetchRPC","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=25;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(a.length===0)return new Map();var f=d("WAArrayChunk").chunk(a,i),g=e?new Map():yield d("WALoadContactsApi").loadContacts(a).then(function(b){var a=new Map();b.forEach(function(b){b&&b.dhash!=null&&a.set(b.contactJid,b.dhash)});return a}),j=new Map(a.map(function(a){return[a,d("WAResultOrError").makeResult({type:"dhash-match"})]}));return(h||(h=b("Promise"))).all(f.map(function(a){return d("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:a.map(function(a){var b=g.get(a);b=b!=null?{anyDhash:b}:null;return{userJid:a,dhashMixinArgs:b}})}).then(function(a){if(a.name==="FetchResponseError")throw c("WAErr")("Failed to fetch user devices");return a.value.usersUser.map(function(a){a=a.userResponseFetchFailureOrFetchSuccessMixinGroup;if(a.name==="FetchUserResponseFailure"){j.set(a.value.jid,d("WAResultOrError").makeError());return}a=a.value;var b=a.jid,c=a.devices;a=a.icdc;j.set(b,d("WAResultOrError").makeResult(k(b,c,a,d("WATimeUtils").unixTime())))})})})).then(function(){return j})});return j.apply(this,arguments)}function e(a){return Array.from(a.values()).flatMap(function(a){return a.success&&a.value.type!=="dhash-match"?[a.value]:[]})}function k(a,b,c,e){e===void 0&&(e=null);var f=[],g=null;if(b){f=b.device.map(function(a){var b;return{id:d("WAJids").interpretAsDeviceId(a.id),identity:d("WASignalKeys").serializeIdentity(a.elementValue),platform:(b=a.deviceModelInfoMixin)==null?void 0:(b=b.platform)==null?void 0:b.elementValue,model:(b=a.deviceModelInfoMixin)==null?void 0:(a=b.model)==null?void 0:a.elementValue}});g=(b=b.dhashMixin)==null?void 0:b.dhash}b=null;if(c){c=d("WAHandleFbDeviceChangeNotificationProtocol").parseICDCFromServer(c);b=c.success?c.value:null}return{jid:a,devices:f,lastSyncTs:d("WATimeUtils").unixTime(),dhash:g,icdcInfo:b,notificationTs:e}}g.fetchFbDevicesProtocol=a;g.extractUserDevicesInfo=e}),98);
__d("WAFetchAndSaveDevices",["Promise","WABulkPutContactsApi","WAComputeAndUploadICDCInfo","WAFetchFbDevicesProtocol","WAGlobals","WAICDCUtils","WALogger","WAPREList","WAPREMetrics","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["computeAndSaveICDC: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update user devices signal and DB"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDevices -> update devices signal"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users ",""]);l=function(){return a};return a}function a(a,b){b===void 0&&(b=!1);d("WALogger").LOG(l(),Array.from(a));var c=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.GET_DEVICES);return d("WAFetchFbDevicesProtocol").fetchFbDevicesProtocol(Array.from(a),b).then(function(a){d("WALogger").LOG(k());return m(d("WAFetchFbDevicesProtocol").extractUserDevicesInfo(a)).then(function(){c.addPoint("user_devices_signal_and_db_updated");return new Map(Array.from(a.keys()).map(function(a){return[a,d("WAResultOrError").makeResult()]}))})}).then(function(a){c.endSuccess();return a})["catch"](function(a){c.endFail("fail");throw a})}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var c=[];yield d("WAGlobals").getWaOneQueue().enqueue(function(e){var f=e.cryptoManager;d("WALogger").LOG(j());return(h||(h=b("Promise"))).all(a.map(function(a){var b;c.push({contactJid:a.jid,dhash:a.dhash,lastSyncTs:a.lastSyncTs,icdcInfo:(b=a.icdcInfo)!=null?b:void 0});return f.storage.updateUserDevicesInfo([a])}))},{operationType:"get_devices",flush:!0,afterInit:!0});yield d("WABulkPutContactsApi").bulkPutContacts(c);var e=d("WAGlobals").getMyUserJid(),f=a.find(function(a){return a.jid===e});if(f!=null){f=f.icdcInfo;if(f==null||d("WAICDCUtils").isICDCIndexInvalid(f)||(f==null?void 0:f.dirty)){var g;f==null?g="empty":f.dirty?g="dirty":g="invalidIndex";d("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo(null,{reason:g,caller:"get_devices",sequence:f==null?void 0:f.sequence})["catch"](function(a){d("WALogger").DEV(i(),a)})}}});return n.apply(this,arguments)}g.fetchAndSaveDevicesWithResults=a;g.updateUsersDevicesSignalAndDB=m}),98);
__d("WARPCAbortController",["Promise"],(function(a,b,c,d,e,f){"use strict";var g,h="rpc-timeout";function a(a,c){var d,e=new(g||(g=b("Promise")))(function(a,b){d=setTimeout(function(){b(h)},c)});return g.race([a,e])["finally"](function(){clearTimeout(d)})}f.RPC_TIMEOUT=h;f.rpcAbortController=a}),66);
__d("WAFetchFbDevicesProtocolV2",["Promise","WAArrayChunk","WAErr","WAHandleFbDeviceChangeNotificationProtocol","WAJids","WALoadContactsApi","WARPCAbortController","WASignalKeys","WASmaxDevicesFetchRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Timeout for fetchAndSaveDevices"]);j=function(){return a};return a}var k=25,l=1e4,m=d("WATagsLogger").TAGS(["wa-devices-protocol"]);function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(a.length===0)return new Map();var e=(yield o(a,c));c=d("WAArrayChunk").chunk(a.map(function(a){var b=e.get(a);b=b!=null?{anyDhash:b}:null;return{userJid:a,dhashMixinArgs:b}}),k);var f=new Map();yield (h||(h=b("Promise"))).allSettled(c.map(function(a){return q(f,a)}));return f});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b)return new Map();b=(yield d("WALoadContactsApi").loadContacts(a));var c=new Map();b.forEach(function(a){a&&a.dhash!=null&&c.set(a.contactJid,a.dhash)});return c});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{b=(yield d("WARPCAbortController").rpcAbortController(d("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:b}),l));if(b.name==="FetchResponseError")throw c("WAErr")("Failed to fetch user devices");return b.value.usersUser.map(function(b){b=b.userResponseFetchFailureOrFetchSuccessMixinGroup;if(b.name==="FetchUserResponseFailure")return;b=b.value;var c=b.jid,e=b.devices;b=b.icdc;a.set(c,s(c,e,b,d("WATimeUtils").unixTime()))})}catch(a){if(a===d("WARPCAbortController").RPC_TIMEOUT){m.ERROR(j());return}m.ERROR(i(),a)}});return r.apply(this,arguments)}function s(a,b,c,e){e===void 0&&(e=null);var f=[],g=null;if(b){f=b.device.map(function(a){var b;return{id:d("WAJids").interpretAsDeviceId(a.id),identity:d("WASignalKeys").serializeIdentity(a.elementValue),platform:(b=a.deviceModelInfoMixin)==null?void 0:(b=b.platform)==null?void 0:b.elementValue,model:(b=a.deviceModelInfoMixin)==null?void 0:(a=b.model)==null?void 0:a.elementValue}});g=(b=b.dhashMixin)==null?void 0:b.dhash}b=null;if(c){c=d("WAHandleFbDeviceChangeNotificationProtocol").parseICDCFromServer(c);b=c.success?c.value:null}return{jid:a,devices:f,lastSyncTs:d("WATimeUtils").unixTime(),dhash:g,icdcInfo:b,notificationTs:e}}g.fetchFbDevicesProtocol=a}),98);
__d("WADevicesState",["I64","Promise","WAErr","WAFetchAndSaveDevices","WAFetchFbDevicesProtocolV2","WAGlobals","WAJids","WALogger","WAPREList","WAPREMetrics","WAResolvable","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[S406998] Invalid userJid reason: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Timeout for fetchAndSaveDevices"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateDevicesSignalAndDB failed: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDevices -> update devices signal"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchFBDevicesProtocol failed: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users ",", reason: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[S406998] Invalid userJid reason: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse stanza id ",": ",""]);q=function(){return a};return a}var r=3e4,s=6e4,t=1e3*60*60,u=d("WATagsLogger").TAGS(["WADevicesState"]);function v(a){var b=6917529027641082e3,c=!1;try{c=(i||(i=d("I64"))).equal(i.and_(i.of_string(a),i.of_float(b)),i.of_float(b))}catch(b){d("WALogger").ERROR(q(),a,b)}return c}var w=function(){function a(){this.$1=new Map()}var c=a.prototype;c.$2=function(a){var b=this;setTimeout(function(){a.forEach(function(a){var c=a[0];a=a[1];a.resolveWasCalled()||(a.reject(),b.$1.get(c)===a&&b.$1["delete"](c))})},s);setTimeout(function(){a.forEach(function(a){var c=a[0];a=a[1];b.$1.get(c)===a&&b.$1["delete"](c)})},t)};c.waitForUserDevices=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=this;e===void 0&&(e=!1);var g=[];for(a of a)v(d("WAJids").userIdFromJid(a))?d("WALogger").ERROR(p(),c):g.push(a);var i=[],j=[];g.forEach(function(a){var b=f.$1.get(a);if(b==null){var c=new(d("WAResolvable").Resolvable)();i.push([a,c]);f.$1.set(a,c)}else j.push([a,b.promise])});this.$2(i);u.LOG(o(),Array.from(g),c);var k=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.GET_DEVICES,{string:{reason:c}});k.addPoint("fetch_start");var q=(yield d("WAFetchFbDevicesProtocolV2").fetchFbDevicesProtocol(i.map(function(a){a=a[0];return a}),e)["catch"](function(a){k.addPoint("fetch_fail");u.ERROR(n(),a);return new Map()}));k.addPoint("fetch_end");u.DEV(m());k.addPoint("signal_update_start");var r=(yield d("WAFetchAndSaveDevices").updateUsersDevicesSignalAndDB(Array.from(q.values())).then(function(){return!0})["catch"](function(a){u.ERROR(l(),a);return!1}));k.addPoint("signal_update_end");i.forEach(function(a){var b=a[0];a=a[1];if(!r){a.reject();f.$1["delete"](b);return}q.has(b)?a.resolve():(a.reject(),f.$1["delete"](b))});k.endSuccess();yield (h||(h=b("Promise"))).allSettled(j.map(function(a){a[0];a=a[1];return a}))});function c(b,c,d){return a.apply(this,arguments)}return c}();c.reset=function(a){var b=this;a.forEach(function(a){return b.$1["delete"](a)})};return a}(),x=function(){function e(a){this.$1=new Map(),this.$2=a}var f=e.prototype;f.waitForUserDevices=function(e,f,g){var i=this;g===void 0&&(g=!1);var j=new Map(),l=[];e.forEach(function(a){var b=i.$1.get(a);if(b==null){var c=new(d("WAResolvable").Resolvable)();j.set(a,c);i.$1.set(a,c.promise)}else l.push(b)});e=function(){var e;if(!d("WAGlobals").getConfig().shouldDeviceStateTimesout()){var f;return(f=i.$2).fetchAndSaveDevices.apply(f,arguments)}var g;return(h||(h=b("Promise"))).race([new h(function(b,e){g=a.setTimeout(function(){d("WALogger").ERROR(k()),e(c("WAErr")("Timeout for fetchAndSaveDevices"))},r)}),(e=i.$2).fetchAndSaveDevices.apply(e,arguments)]).then(function(b){a.clearTimeout(g);return b})};return(j.size>0?e(new Set(j.keys()),f,g):(h||(h=b("Promise"))).resolve(new Map())).then(function(a){for(var b of j){var c=b[0],d=b[1],e=a.get(c);(e==null?void 0:e.success)?d.resolve():(d.reject("Failed to fetch devices for user: "+c),i.$1["delete"](c))}})["catch"](function(a){for(var b of j){var c=b[0],d=b[1];d.reject(a);i.$1["delete"](c)}}).then(function(){return(h||(h=b("Promise"))).all([].concat(l,Array.from(j.values()).map(function(a){return a.promise}))).then(function(){})})};f.reset=function(a){var b=this;a.forEach(function(a){return b.$1["delete"](a)})};return e}(),y;function e(){y||(d("WAGlobals").getConfig().getDevicesV2()?y=new w():y=new x({fetchAndSaveDevices:function(a,b,c){for(var e of a)v(d("WAJids").userIdFromJid(e))&&d("WALogger").ERROR(j(),b);return d("WAFetchAndSaveDevices").fetchAndSaveDevicesWithResults(new Set(a),c)}}));return y}g.DeviceStateClassV2=w;g.DevicesStateClass=x;g.getDevicesState=e}),98);
__d("WAMultiDevice.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={};a.internalSpec={payload:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,d.TYPES.MESSAGE,b]};b.internalSpec={};c.internalSpec={applicationData:[1,d.TYPES.MESSAGE,e],signal:[2,d.TYPES.MESSAGE,m],__oneofs__:{payload:["applicationData","signal"]}};e.internalSpec={appStateSyncKeyShare:[1,d.TYPES.MESSAGE,h],appStateSyncKeyRequest:[2,d.TYPES.MESSAGE,f],__oneofs__:{applicationData:["appStateSyncKeyShare","appStateSyncKeyRequest"]}};f.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,l]};h.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};i.internalSpec={keyId:[1,d.TYPES.MESSAGE,l],keyData:[2,d.TYPES.MESSAGE,j]};j.internalSpec={keyData:[1,d.TYPES.BYTES],fingerprint:[2,d.TYPES.MESSAGE,k],timestamp:[3,d.TYPES.INT64]};k.internalSpec={rawId:[1,d.TYPES.UINT32],currentIndex:[2,d.TYPES.UINT32],deviceIndexes:[3,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.UINT32]};l.internalSpec={keyId:[1,d.TYPES.BYTES]};m.internalSpec={};g.MultiDeviceSpec=a;g.MultiDevice$MetadataSpec=b;g.MultiDevice$PayloadSpec=c;g.MultiDevice$ApplicationDataSpec=e;g.MultiDevice$ApplicationData$AppStateSyncKeyRequestMessageSpec=f;g.MultiDevice$ApplicationData$AppStateSyncKeyShareMessageSpec=h;g.MultiDevice$ApplicationData$AppStateSyncKeySpec=i;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyDataSpec=j;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprintSpec=k;g.MultiDevice$ApplicationData$AppStateSyncKeyIdSpec=l;g.MultiDevice$SignalSpec=m}),98);
__d("WAParseAppStateSyncKeyRequest",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];for(var a=a.keyIds,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;f.keyId!=null&&b.push(d("WASyncdKeyTypes").toSyncKeyId(f.keyId))}return{keyIds:b}}g.parseAppStateSyncKeyRequest=a}),98);
__d("WASyncdKeyManagementUtils",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint16(0)}function h(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint32(2)}function b(a){return h(a)+1}g.getKeyDeviceId=a;g.getKeyEpoch=h;g.generateNewKeyEpoch=b}),98);
__d("WAParseAppStateSyncKeyShare",["WALogger","WALongInt","WASyncdKeyManagementUtils","WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Key missing keyId"]);h=function(){return a};return a}function a(a){var b=[],c=[];for(var a=a.keys,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;f=i(f);f!=null&&(f.type==="orphan"?c.push(f.keyId):(f.type,b.push(f.keyData)))}return{keys:b,orphanKeys:c}}function i(a){var b,c,e,f,g,i;if(((b=a.keyId)==null?void 0:b.keyId)==null){d("WALogger").WARN(h());return null}b=d("WASyncdKeyTypes").toSyncKeyId(a.keyId.keyId);c=(c=a.keyData)==null?void 0:c.keyData;e=d("WALongInt").maybeNumberOrThrowIfTooLarge((e=a.keyData)==null?void 0:e.timestamp);f=(f=a.keyData)==null?void 0:(f=f.fingerprint)==null?void 0:f.currentIndex;g=(g=a.keyData)==null?void 0:(g=g.fingerprint)==null?void 0:g.deviceIndexes;i=(i=a.keyData)==null?void 0:(i=i.fingerprint)==null?void 0:i.rawId;return a.keyData==null||c==null||e==null||f==null||g==null||i==null?{keyId:b,type:"orphan"}:{keyData:{fingerprint:{currentIndex:f,deviceIndexes:g,rawId:i},keyData:d("WASyncdKeyTypes").toSyncKeyData(c),keyEpoch:d("WASyncdKeyManagementUtils").getKeyEpoch(b),keyId:b,timestamp:e},type:"key"}}g.parseAppStateSyncKeyShare=a}),98);
__d("WAConvertAppData",["WAAppData","WAArmadilloApplication.pb","WAErr","WAJids","WALogger","WAMultiDevice.pb","WAParseAppStateSyncKeyRequest","WAParseAppStateSyncKeyShare","WAStanzaUtils","WASyncdKeyTypes","WATimeUtils","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecrets"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["status in EncryptedBackupsSecretsEpoch has invalid value"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecretsEpoch"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["No participant in messageKey in message action when it is group chat and message is not fromMe: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing messageKey in message action: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing chatId in chat action: ",""]);u=function(){return a};return a}function v(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else{a.jidType;throw c("WAErr")("Incorrect jid type: "+a.jidType)}}function w(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="msgrDevice")return d("WAJids").extractUserJid(a.deviceJid);else{a.jidType;throw c("WAErr")("Incorrect jid type: "+a.jidType)}}function x(a){return a!=null?typeof a==="number"&&a>d("WATimeUtils").MAX_INT?d("WATimeUtils").castMilliSecondsToUnixTime(a):d("WATimeUtils").castLongIntToUnixTime(a):void 0}function y(a){return a==null?void 0:{lastMessageTimestamp:x(a.lastMessageTimestamp),lastSystemMessageTimestamp:x(a.lastSystemMessageTimestamp),messages:a.messages==null?[]:a.messages.map(function(a){return{key:a.key==null?void 0:{fromMe:a.key.fromMe,id:a.key.id},ts:x(a.timestamp)}})}}function z(a,b){var c=a.chatId;if(c==null){d("WALogger").WARN(u(),a);return null}if(a.chatArchive!=null){var e=a.chatArchive;e=y(e.messageRange);return{chatJid:v(c),messageRange:e,ts:b,type:"chat_archive"}}else if(a.chatDelete!=null){e=a.chatDelete;e=y(e.messageRange);return{chatJid:v(c),messageRange:e,ts:b,type:"chat_delete"}}else if(a.chatRead!=null){e=a.chatRead;var f=y(e.messageRange);return{chatJid:v(c),messageRange:f,read:e.read,ts:b,type:"chat_read"}}else{d("WALogger").WARN(t(),a);return null}}function A(a){var b=a.key,c=b==null?void 0:b.remoteJid,e=b==null?void 0:b.id,f=b==null?void 0:b.fromMe;if(b==null||c==null||f==null||e==null){d("WALogger").WARN(s(),a);return null}var g=v(c),h=d("WAJids").interpretAsGroupJid(g)!=null;if(h&&!f){if((b==null?void 0:b.participant)==null){d("WALogger").WARN(r(),a);return null}h=w(b.participant)}else f?h=d("WAJids").AUTHOR_ME:h=w(c);b={author:h,chat:g,externalId:d("WAStanzaUtils").toStanzaId(e)};if(a.messageDelete!=null)return{protocolMsgId:b,type:"delete_for_me"};else{d("WALogger").WARN(q(),a);return null}}function B(a){var b=[];for(var c=0;c<a.length;c++){var e=a[c],f=x(e.actionTimestamp);if(e.chatAction!=null){f=z(e.chatAction,f);f!=null&&b.push({chatAction:f})}else if(e.messageAction!=null){f=A(e.messageAction);f!=null&&b.push({messageAction:f})}else d("WALogger").WARN(p(),e)}return b}function C(a){var b=a.anonId,c=a.id,e=a.rootKey;a=a.status;if(a==null||c==null||b==null||e==null){d("WALogger").WARN(o());return null}var f;if(a===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN)f=d("WAAppData").EPOCH_STATUS_OPEN;else if(a===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE)f=d("WAAppData").EPOCH_STATUS_CLOSE;else{d("WALogger").WARN(n());return null}return{anonId:b,id:c,rootKey:e,status:f}}function D(a){var b=a.backupId,c=a.epoch,e=a.mailboxRootKey,f=a.obliviousValidationToken,g=a.serverDataId;a=a.tempOcmfClientState;if(b==null||g==null||a==null||e==null||f==null){d("WALogger").WARN(m());return null}return{backupId:b,epoch:c.map(C).reduce(function(a,b){if(b!=null)return a.concat([b]);else return a},[]),mailboxRootKey:e,obliviousValidationToken:f,serverDataId:g,tempOcmfClientState:a}}function E(a){var b;if(((b=a.applicationData)==null?void 0:(b=b.metadataSync)==null?void 0:b.actions)!=null){return{actions:B((b=a.applicationData)==null?void 0:(b=b.metadataSync)==null?void 0:b.actions),type:"meta_sync"}}else if(((b=a.signal)==null?void 0:b.encryptedBackupsSecrets)!=null){b=D(a.signal.encryptedBackupsSecrets);return b==null?null:{encryptedBackupsSecrets:b,type:"backups_secrets"}}else{d("WALogger").WARN(l(),a);return null}}function F(a){var b;if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare)!=null){return{syncKeyShare:d("WAParseAppStateSyncKeyShare").parseAppStateSyncKeyShare((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare),type:"sync_key_share"}}else if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest)!=null){return{syncKeyRequest:d("WAParseAppStateSyncKeyRequest").parseAppStateSyncKeyRequest((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest),type:"sync_key_request"}}else{d("WALogger").WARN(k(),a);return null}}function a(a){if(a.subprotocolType==="armadillo"){var b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,a.payload);if(b.payload==null)throw c("WAErr")("Appdata contains unparseable armadillo data.");return E(b.payload)}else if(a.subprotocolType==="multiDevice"){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMultiDevice.pb").MultiDeviceSpec,a.payload);if(b.payload==null)throw c("WAErr")("Appdata contains unparseable armadillo data.");return F(b.payload)}else throw c("WAErr")("Appdata contains unexpected message application: "+a.subprotocolType)}function G(a){return a==null?void 0:{lastMessageTimestamp:a.lastMessageTimestamp,lastSystemMessageTimestamp:a.lastSystemMessageTimestamp,messages:a.messages.map(function(a){return{key:a.key==null?void 0:{fromMe:a.key.fromMe,id:a.key.id},timestamp:a.ts}})}}function H(a){switch(a.type){case"meta_sync":return{payload:{applicationData:P(a)}};case"backups_secrets":return{payload:{signal:{encryptedBackupsSecrets:N(a.encryptedBackupsSecrets)}}};default:a.type;d("WALogger").WARN(j(),a.type);return{}}}function I(a){return{keyId:d("WASyncdKeyTypes").fromSyncKeyId(a)}}function J(a){return{keyData:{fingerprint:{currentIndex:a.fingerprint.currentIndex,deviceIndexes:a.fingerprint.deviceIndexes,rawId:a.fingerprint.rawId},keyData:d("WASyncdKeyTypes").fromSyncKeyData(a.keyData),timestamp:a.timestamp},keyId:I(a.keyId)}}function K(a){var b=a.keys.map(J);a=a.orphanKeys==null?[]:a.orphanKeys.map(function(a){return{keyId:I(a)}});b.push.apply(b,a);return{keys:b}}function L(a){return{keyIds:a.keyIds.map(I)}}function M(a){switch(a.type){case"sync_key_share":return{payload:{applicationData:{appStateSyncKeyShare:K(a.syncKeyShare)}}};case"sync_key_request":return{payload:{applicationData:{appStateSyncKeyRequest:L(a.syncKeyRequest)}}};default:a.type;d("WALogger").WARN(i(),a.type);return{}}}function b(a){var b;switch(a.type){case"meta_sync":case"backups_secrets":var c=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,H(a));b={armadillo:{payload:c.readByteArray(),version:1}};break;case"sync_key_share":case"sync_key_request":c=d("encodeProtobuf").encodeProtobuf(d("WAMultiDevice.pb").MultiDeviceSpec,M(a));b={multiDevice:{payload:c.readByteArray(),version:1}};break;default:a.type,d("WALogger").WARN(h(),a.type),b={}}return{payload:{subProtocol:b}}}function N(a){return{backupId:a.backupId,epoch:a.epoch.map(O),mailboxRootKey:a.mailboxRootKey,obliviousValidationToken:a.obliviousValidationToken,serverDataId:a.serverDataId,tempOcmfClientState:a.tempOcmfClientState}}function O(a){var b;a.status===d("WAAppData").EPOCH_STATUS_OPEN?b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN:a.status===d("WAAppData").EPOCH_STATUS_CLOSE&&(b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE);return{anonId:a.anonId,id:a.id,rootKey:a.rootKey,status:b}}function P(a){return{metadataSync:{actions:a.actions.map(function(a){if(a.chatAction)return{actionTimestamp:a.chatAction.ts,chatAction:Q(a.chatAction)};else return{messageAction:R(a.messageAction)}})}}}function Q(a){var b=G(a.messageRange),c=a.chatJid;switch(a.type){case"chat_archive":return{chatArchive:{archived:a.archived,messageRange:b},chatId:c};case"chat_delete":return{chatDelete:{messageRange:b},chatId:c};default:a.type;return{chatId:c,chatRead:{messageRange:b,read:a.read}}}}function R(a){if(a.type==="delete_for_me"){var b=a.protocolMsgId.chat,e=d("WAJids").interpretAsGroupJid(b)!=null;return{key:{fromMe:d("WAJids").isAuthorMe(a.protocolMsgId.author),id:a.protocolMsgId.externalId,participant:!d("WAJids").isAuthorMe(a.protocolMsgId.author)&&e?a.protocolMsgId.author:void 0,remoteJid:b},messageDelete:{}}}else throw c("WAErr")("No other available type")}g.parseArmadilloAppData=E;g.parseMultiDeviceAppData=F;g.parseAppData=a;g.convertArmadilloAppData=H;g.convertMultiDeviceAppData=M;g.convertAppData=b}),98);
__d("WATypedArraysConcat",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){c===void 0&&(c=0);c=b.reduce(function(a,b){return a+b.length},c);var d=new a(c),e=0;b.forEach(function(a){d.set(a,e),e+=a.length});return d}f.concatTypedArrays=a}),66);
__d("WACryptoAesCbc",["Promise","WABinary","WACryptoDependencies","WAErr","WATypedArraysCast","WATypedArraysConcat","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=16,j=1024,k=16,l=1024*1024,m=i*l;l=function(){function a(a,b,c,e){this.$4=null;this.$6=!1;this.$1=a;this.$2=b;this.$3=c;var f={name:"AES-CBC",iv:e};this.$5=d("WACryptoDependencies").getCrypto().subtle.importKey("raw",c,"AES-CBC",!1,[b]).then(function(a){return{algo:f,key:a}})}var b=a.prototype;b.append=function(a){var b=this;this.$7("append");var c=this.$4;if(c){c.writeByteArray(a);if(c.size()>j){var e=c.size()%i;e=c.readByteArray(c.size()-e);c.size()||(this.$4=null)}else e=null}else if(a.length>j){c=a.length%i;!c?e=a:(this.$4=new(d("WABinary").Binary)(a),e=this.$4.readByteArray(a.length-c))}else this.$4=new(d("WABinary").Binary)(a),e=null;var f=e;f&&(this.$5=this.$5.then(function(a){var c=a.key;a=a.algo;if(b.$2==="encrypt")return d("WACryptoDependencies").getCrypto().subtle.encrypt(a,c,f).then(function(a){b.$1.writeByteArray(new Uint8Array(a,0,a.byteLength-i));return new Uint8Array(a,a.byteLength-2*i,i)});else{var e=f.slice(-i);return d("WACryptoDependencies").getCrypto().subtle.decrypt(a,c,f).then(function(a){b.$1.writeBuffer(a);return e})}}).then(function(a){var c={name:"AES-CBC",iv:a};return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",b.$3,"AES-CBC",!1,[b.$2]).then(function(a){return{algo:c,key:a}})}));return this.$5.then(function(){})};b.finalize=function(a){var b=this;this.$7("finalize");var c;if(this.$4){var e=this.$4;a&&e.writeByteArray(a);c=e.readByteArray();this.$4=null}else a&&(c=a);if(c){var f=c;return this.$5.then(function(a){var c=a.algo;a=a.key;if(b.$2==="encrypt")return d("WACryptoDependencies").getCrypto().subtle.encrypt(c,a,f);else return d("WACryptoDependencies").getCrypto().subtle.decrypt(c,a,f)}).then(function(a){b.$1.writeBuffer(a)})}else return this.$5.then(function(){})};b.$7=function(a){if(this.$6)throw c("WAErr")("AesCbcStream."+a+" called after finalize")};return a}();function n(a){return{name:"AES-CBC",iv:d("WATypedArraysCast").castTypedArrays(Uint8Array,a)}}function o(a){return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",d("WATypedArraysCast").castTypedArrays(Uint8Array,a),"AES-CBC",!1,["encrypt"])}function p(a){if(a)return d("WATypedArraysCast").castTypedArrays(Uint8Array,a);a=new Uint8Array(k);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function q(a){a=a.byteLength;var b=i-a%i;return Number.isNaN(b)?a:a+b}function r(a,c,e){var f=n(c);return(h||(h=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.importKey("raw",d("WATypedArraysCast").castTypedArrays(Uint8Array,a),"AES-CBC",!1,["decrypt"])).then(function(a){return d("WACryptoDependencies").getCrypto().subtle.decrypt(f,a,e)})}function a(a,c){return(h||(h=b("Promise"))).resolve().then(function(){var b=c.slice(0,k),d=c.slice(k);return r(a,b,d)})}function e(a,c,e){return(h||(h=b("Promise"))).resolve().then(function(){var f=p(e),g=n(f);return(h||(h=b("Promise"))).resolve(o(a)).then(function(a){return d("WACryptoDependencies").getCrypto().subtle.encrypt(g,a,c)}).then(function(a){return d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[f,new Uint8Array(a)]).buffer})})}function f(a,d,e,f){var g,h,j,k,l,n,r,t,u,v,w,x,y;return b("regeneratorRuntime").async(function(z){while(1)switch(z.prev=z.next){case 0:f===void 0&&(f=m);if(!(f%i!==0)){z.next=3;break}throw c("WAErr")("chunkSize must be a multiple of "+i+", "+f+" received");case 3:z.next=5;return b("regeneratorRuntime").awrap(o(a));case 5:g=z.sent,h=new Uint8Array(d),j=Math.ceil(h.byteLength/f),k=p(e),l=new Uint8Array(q(h)+k.byteLength),l.set(k),(n=0,r=k);case 12:if(!(n<j)){z.next=26;break}u=n===j-1;v=n*f;t=h.subarray(v,v+f);z.next=18;return b("regeneratorRuntime").awrap(s(u,t,r,g));case 18:w=z.sent,x=w.encryptedChunk,y=w.nextIv,l.set(x,k.byteLength+n*f),r=y;case 23:n++;z.next=12;break;case 26:return z.abrupt("return",l.buffer);case 27:case"end":return z.stop()}},null,this)}function s(a,c,e,f){var g,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.encrypt(n(e),f,c).then(function(b){return a?new Uint8Array(b):new Uint8Array(b).subarray(0,-i)}));case 2:g=j.sent;h=g.slice(-i);return j.abrupt("return",{encryptedChunk:g,nextIv:h});case 5:case"end":return j.stop()}},null,this)}g.AES_CBC_BLOCK_SIZE=i;g.AesCbcStream=l;g.importRawKey=o;g.getIv=p;g.aesCbcDecrypt=r;g.aesCbcDecryptSplit=a;g.aesCbcEncrypt=e;g.aesCbcEncryptWithChunking=f;g.aesCbcEncryptChunk=s}),98);
__d("WADeletePreKeyGenerationsApi",["MAWDexieTable","MAWTransactionMode","WADbPrekeyTxns","WADbTransactor","WAGetPrekeyIdsInRange","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to delete non-existent prekey generation"]);h=function(){return a};return a}a=d("WADbTransactor").makeSignalTransactor({prekey:d("MAWTransactionMode").READWRITE,prekeyGeneration:d("MAWTransactionMode").READWRITE},"deletePreKeyGenerations",function(a){return function(b){return a.prekeyGeneration.bulkGet(b).then(function(c){var e=[];c.forEach(function(a){if(a==null){d("WALogger").WARN(h());return}d("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(a.startingId,a.endingId).forEach(function(a){e.push(a)})});c=a.prekeyGeneration.bulkDelete(b);var f=d("WADbPrekeyTxns").bulkDeletePreKeys(a,e);return d("MAWDexieTable").dexieAll([c,f]).then(function(){})})}});g.deletePreKeyGenerations=a}),98);
__d("WADbMetaTxns",["MAWTransactionMode","WADbSignal","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE},"saveCAT",function(a){return function(b){return a.meta.put({key:d("WADbSignal").MetaKeysEnum.cat,value:{cat:b}}).then(function(){return b})}});function a(a){return a.meta.get(d("WADbSignal").MetaKeysEnum.deviceUUID).then(function(a){return{deviceUUID:a==null?void 0:a.value.deviceUUID}})}function b(a){return a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,d("WADbSignal").MetaKeysEnum.identityKeyPair]).then(function(a){var b=a[0];a=a[1];b=b==null?void 0:b.value.lastSignedPrekeyId;a=a==null?void 0:a.value.identityKeyPair;return{identityPair:a,keyId:b}})}function c(a){return a.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyId).then(function(a){return a==null?void 0:a.value.lastPrekeyId})}function e(a){return a.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(a){return a==null?void 0:a.value.lastPrekeyGenerationId})}function f(a){return a.meta.toArray()}g.saveCAT=h;g.getPushMetaData=a;g.maybeGetLastSignedPrekeyIdAndIdentity=b;g.maybeGetLastPrekeyId=c;g.maybeGetLastPrekeyGenerationId=e;g.getAllMeta=f}),98);
__d("WAGetLastPreKeyGenerationIdApi",["MAWDexieTable","MAWTransactionMode","WADbMetaTxns","WADbTransactor","WAErr"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READONLY},"getLastPreKeyGenerationId",function(a){return function(){var b=d("WADbMetaTxns").maybeGetLastPrekeyId(a),e=d("WADbMetaTxns").maybeGetLastPrekeyGenerationId(a);return d("MAWDexieTable").dexieAll([b,e]).then(function(a){var b=a[0];a=a[1];if(b==null&&a!=null||b!=null&&a==null)throw c("WAErr")("Last prekey id and Last prekey generation id should both be non-null");if(b!=null&&a!=null)return{lastGenerationId:a,lastPreKeyId:b};else return null})}});g.getLastPreKeyGenerationId=a}),98);
__d("WAGetPreKeyGenerationsTimestampsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({prekeyGeneration:d("MAWTransactionMode").READONLY},"getPreKeyGenerationsTimestamps",function(a){return function(){return a.prekeyGeneration.toArray().then(function(a){return a.map(function(a){return{id:a.generationId,timestamp:a.createdTs}})})}});g.getPreKeyGenerationsTimestamps=a}),98);
__d("WALoadICDCApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY},"loadICDC",function(a){return function(b){return a.contacts.get(b).then(function(a){return(a=a==null?void 0:a.icdcInfo)!=null?a:null})}});g.loadICDC=a}),98);
__d("WALoadIdentitiesApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({identity:d("MAWTransactionMode").READONLY},"loadIdentities",function(a){return function(b){return a.identity.where("userJid").equals(b).toArray().then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.deviceJid,a.identity]}))})}});b=d("WADbTransactor").makeSignalTransactor({identity:d("MAWTransactionMode").READONLY},"bulkLoadIdentities",function(a){return function(b){return a.identity.where("userJid").anyOf(b).toArray().then(function(a){return a.filter(Boolean).reduce(function(a,b){var c=a.get(b.userJid);c==null&&(c=new Map());c.set(b.deviceJid,b.identity);a.set(b.userJid,c);return a},new Map())})}});g.loadIdentities=a;g.bulkLoadIdentities=b}),98);
__d("WALoadLastSyncTsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY},"loadLastSyncTs",function(a){return function(b){return a.contacts.get(b).then(function(a){return(a=a==null?void 0:a.lastSyncTs)!=null?a:null})}});g.loadLastSyncTs=a}),98);
__d("WADbSignedPrekeyTxns",["WADbMetaTxns","WAErr","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WADbMetaTxns").maybeGetLastSignedPrekeyIdAndIdentity(a).then(function(b){var e=b.identityPair;b=b.keyId;if(b==null)if(e==null)return d("WAResultOrError").makeError("missing-last-signed-prekey-id",c("WAErr")("No lastSignedPrekeyId and registration in meta table."));else return d("WAResultOrError").makeError("missing-last-signed-prekey-id",c("WAErr")("No lastSignedPrekeyId in meta table but identity exists. Very bad"));return a.signedPrekey.get({keyId:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing-last-signed-prekey-id",c("WAErr")("No signed prekey matches the lastSignedPrekeyId supplied")):d("WAResultOrError").makeResult(a.encoded)})})}function b(a,b){return a.signedPrekey.bulkGet(b)}g.getLatestSignedPreKey=a;g.getSignedPrekeys=b}),98);
__d("WALoadLatestSignedPreKeyApi",["MAWTransactionMode","WADbSignedPrekeyTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READONLY,signedPrekey:d("MAWTransactionMode").READONLY},"loadLatestSignedPreKey",function(a){return function(){return d("WADbSignedPrekeyTxns").getLatestSignedPreKey(a)}});g.loadLatestSignedPreKey=a}),98);
__d("WALoadOneTimePreKeyApi",["MAWODSProxy","MAWTransactionMode","WADbTransactor","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({prekey:d("MAWTransactionMode").READONLY},"loadOneTimePreKey",function(a){return function(b){return a.prekey.get(b).then(function(a){if(a==null)d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GET_PREKEY,key:"miss_prekey_in_db"});else return a.encoded})}});g.loadOneTimePreKey=a}),98);
__d("WALoadPreKeysApi",["MAWDexieTable","MAWTransactionMode","WACompareIdentity","WADbMetaTxns","WADbPrekeyTxns","WADbSignedPrekeyTxns","WADbTransactor","WAErr","WALoggerTag","WASignalSignatures","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["No last prekey generation id"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get latest signed prekey"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekey]);b=d("WADbTransactor").makeSignalTransactor({identity:(a=d("MAWTransactionMode")).READONLY,meta:a.READONLY,prekey:a.READONLY,prekeyGeneration:a.READONLY,signedPrekey:a.READONLY},"loadPreKeys",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("WADbSignedPrekeyTxns").getLatestSignedPreKey(a),d("WACompareIdentity").compareIdentityDexie(a)]).then(function(e){e=e[0];if(!e.success){var f;k.ERROR(j());throw(f=e.error)!=null?f:c("WAErr")("Failed to get latest signed prekey")}var g=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(g==null){k.ERROR(i());throw c("WAErr")("Failed to deserialize signed prekey")}f=b!=null?d("MAWDexieTable").dexieResolve(b):d("WADbMetaTxns").maybeGetLastPrekeyGenerationId(a);return f.then(function(b){if(b==null){k.ERROR(h());throw c("WAErr")("No last prekey generation id")}return d("WADbPrekeyTxns").getPrekeysForGeneration(a,b).then(function(a){return{preKeys:a,signedPreKey:g}})})})}});g.loadPreKeys=b}),98);
__d("WALoadSenderKeySessionApi",["MAWTransactionMode","WACryptoManager","WADbSignal","WADbTransactor","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({senderKeySessions:d("MAWTransactionMode").READONLY},"loadSenderKeySession",function(a){return function(b,c){var e=d("WAJids").extractUserJid(c);c=d("WAJids").extractDeviceId(c);b=d("WADbSignal").buildSenderKeySessionId(b,e,c);return a.senderKeySessions.get({id:b}).then(function(a){if(a==null)return d("WAResultOrError").makeError("errLoadSenderKeySession");a=d("WACryptoManager").decodeSenderKeySession(a.record);return d("WAResultOrError").makeResult(a)})}});g.loadSenderKeySession=a}),98);
__d("WALoadSignedPreKeyApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({signedPrekey:d("MAWTransactionMode").READONLY},"loadSignedPreKey",function(a){return function(b){return a.signedPrekey.get(b).then(function(a){return a==null?void 0:a.encoded})}});g.loadSignedPreKey=a}),98);
__d("WASaveOneTimePreKeyApi",["MAWDexieTable","MAWTransactionMode","WADbMetaTxns","WADbSignal","WADbTransactor","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE,prekey:d("MAWTransactionMode").READWRITE},"saveOneTimePreKey",function(a){return function(b){return d("WADbMetaTxns").maybeGetLastPrekeyId(a).then(function(c){return c==null?d("WAResultOrError").makeError("missing_last_prekey"):d("MAWDexieTable").dexieAll([a.prekey.put(babelHelpers["extends"]({},b,{isDeleted:!1})),a.meta.put({key:d("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:b.keyId}})]).then(function(){return d("WAResultOrError").makeResult()})})}});g.saveOneTimePreKey=a}),98);
__d("WASavePreKeysGenerationApi",["MAWDexieTable","MAWTransactionMode","WACryptoManager","WADbMetaTxns","WADbSignal","WADbTransactor","WAErr","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE,prekey:d("MAWTransactionMode").READWRITE,prekeyGeneration:d("MAWTransactionMode").READWRITE},"savePreKeysGeneration",function(a){return function(b){return d("WADbMetaTxns").maybeGetLastPrekeyGenerationId(a).then(function(e){if(b.length===0)throw c("WAErr")("Keys provided to savePreKeysGeneration cannot be empty");var f=d("WACryptoManager").castToPreKeyGenerationId(((e=e)!=null?e:0)+1);e=b[0].keyId;var g=b[b.length-1].keyId,h=b.map(function(a){return babelHelpers["extends"]({},a,{isDeleted:!1})});h=a.prekey.bulkPut(h);var i=a.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:g}},{key:d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId,value:{lastPrekeyGenerationId:f}}]);g=a.prekeyGeneration.put({createdTs:d("WATimeUtils").unixTime(),endingId:g,generationId:f,startingId:e});return d("MAWDexieTable").dexieAll([h,i,g]).then(function(){return d("WAResultOrError").makeResult(f)})})}});g.savePreKeysGeneration=a}),98);
__d("WASaveSignedPreKeyIfNewApi",["MAWDexieTable","MAWTransactionMode","WADbSignal","WADbTransactor","WASignalSignatures"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE,signedPrekey:d("MAWTransactionMode").READWRITE},"saveSignedPreKeyIfNew",function(a){return function(b,c){return a.signedPrekey.get(b).then(function(e){if(e!=null){e=d("WASignalSignatures").deserializeSignedPreKey(e.encoded);if(e!=null)return{key:e,type:"duplicate"}}e=a.signedPrekey.put({encoded:c,keyId:b});var f=a.meta.put({key:d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:b}});return d("MAWDexieTable").dexieAll([e,f]).then(function(){return{type:"success"}})})}});g.saveSignedPreKeyIfNew=a}),98);
__d("WASessionApi",["MAWDexieTable","MAWTransactionMode","WABase64","WACryptoManager","WACryptoUtils","WADbTransactor","WALogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSessionApi -- identity in session table is different with identity table ",", ","  with context: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSessionApi -- identity in session table is different with identity table with context: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSessionApi -- missing identity"]);j=function(){return a};return a}a=d("WADbTransactor").makeSignalTransactor({identity:d("MAWTransactionMode").READONLY,session:d("MAWTransactionMode").READONLY},"loadSession",function(a){return function(b,e){return d("MAWDexieTable").dexieAll([a.session.get({id:b}),a.identity.get({deviceJid:b})]).then(function(a){var b=a[0];a=a[1];if(b==null)return null;b=d("WACryptoManager").decodeSession(b.session);a==null?d("WALogger").ERROR(j()):d("WACryptoUtils").uint8ArraysEqual(a.identity,b.remote.pubKey)||(d("WALogger").ERROR(i(),e),c("gkx")("23958")&&c("gkx")("23959")&&d("WALogger").ERROR(h(),d("WABase64").encodeB64(a.identity),d("WABase64").encodeB64(b.remote.pubKey),e));return b})}});b=d("WADbTransactor").makeSignalTransactor({session:d("MAWTransactionMode").READONLY},"bulkLoadSession",function(a){return function(b){return a.session.bulkGet(b).then(k)}});function k(a){return a.reduce(function(a,b){if(b==null)return a;var c=d("WACryptoManager").decodeSession(b.session);a.set(b.id,c);return a},new Map())}g.loadSession=a;g.bulkLoadSession=b}),98);
__d("WACryptoDbCallbacks",["WABulkSaveSignalDataApi","WADeletePreKeyGenerationsApi","WAGetLastPreKeyGenerationIdApi","WAGetPreKeyGenerationsTimestampsApi","WALoadICDCApi","WALoadIdentitiesApi","WALoadLastSyncTsApi","WALoadLatestSignedPreKeyApi","WALoadOneTimePreKeyApi","WALoadPreKeysApi","WALoadSenderKeySessionApi","WALoadSignedPreKeyApi","WASaveOneTimePreKeyApi","WASavePreKeysGenerationApi","WASaveSignedPreKeyIfNewApi","WASessionApi"],(function(a,b,c,d,e,f,g){"use strict";a={bulkLoadIdentities:d("WALoadIdentitiesApi").bulkLoadIdentities,bulkSaveSignalData:d("WABulkSaveSignalDataApi").bulkSaveSignalData,deletePreKeyGenerations:d("WADeletePreKeyGenerationsApi").deletePreKeyGenerations,getLastPreKeyGenerationId:d("WAGetLastPreKeyGenerationIdApi").getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:d("WAGetPreKeyGenerationsTimestampsApi").getPreKeyGenerationsTimestamps,loadICDC:d("WALoadICDCApi").loadICDC,loadIdentities:d("WALoadIdentitiesApi").loadIdentities,loadLastSyncTs:d("WALoadLastSyncTsApi").loadLastSyncTs,loadLatestSignedPreKey:d("WALoadLatestSignedPreKeyApi").loadLatestSignedPreKey,loadOneTimePreKey:d("WALoadOneTimePreKeyApi").loadOneTimePreKey,loadPreKeys:d("WALoadPreKeysApi").loadPreKeys,loadSenderKeySession:d("WALoadSenderKeySessionApi").loadSenderKeySession,loadSession:d("WASessionApi").loadSession,loadSessions:d("WASessionApi").bulkLoadSession,loadSignedPreKey:d("WALoadSignedPreKeyApi").loadSignedPreKey,saveOneTimePreKey:d("WASaveOneTimePreKeyApi").saveOneTimePreKey,savePreKeysGeneration:d("WASavePreKeysGenerationApi").savePreKeysGeneration,saveSignedPreKeyIfNew:d("WASaveSignedPreKeyIfNewApi").saveSignedPreKeyIfNew};g.cryptoDbCallbacks=a}),98);
__d("WASignalEntityStoreV2",["$InternalEnum","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["NOT_PERSISTED","PERSIST_IN_PROGRESS","PERSISTED"]);a=function(){function a(){this.$1=new Map()}var c=a.prototype;c.TEST_ONLY_LOAD_FROM_MEMORY=function(a){return this.$2(a)};c.$2=function(a){a=this.$1.get(a);return a!=null?{entity:a.entity,deleted:a.deleted}:null};c.load=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=this.$2(a);if(!(d==null?void 0:d.deleted)){f.next=3;break}return f.abrupt("return",null);case 3:if(!(d!=null&&d.entity!=null)){f.next=5;break}return f.abrupt("return",d.entity);case 5:f.next=7;return b("regeneratorRuntime").awrap(c(a));case 7:e=f.sent;this.$3(a,e);return f.abrupt("return",e);case 10:case"end":return f.stop()}},null,this)};c.bulkLoad=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:d=[],e=new Map(),f=0;case 3:if(!(f<a.length)){q.next=15;break}g=a[f];h=this.$2(g);if(!(h==null)){q.next=9;break}d.push(g);return q.abrupt("continue",12);case 9:if(!h.deleted){q.next=11;break}return q.abrupt("continue",12);case 11:h.entity!=null?e.set(g,h.entity):d.push(g);case 12:f++;q.next=3;break;case 15:q.next=17;return b("regeneratorRuntime").awrap(c(d));case 17:i=q.sent,(j=i.entries(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 19:if(!k){q.next=25;break}if(!(l>=j.length)){q.next=22;break}return q.abrupt("break",36);case 22:m=j[l++];q.next=29;break;case 25:l=j.next();if(!l.done){q.next=28;break}return q.abrupt("break",36);case 28:m=l.value;case 29:n=m,o=n[0],p=n[1],e.set(o,p),this.$3(o,p);case 34:q.next=19;break;case 36:return q.abrupt("return",e);case 37:case"end":return q.stop()}},null,this)};c.$3=function(a,b){this.$1.set(a,{entity:b,status:g.PERSISTED,deleted:!1})};c.store=function(a,b){this.$1.set(a,{entity:b,status:g.NOT_PERSISTED,deleted:!1})};c.remove=function(a){this.$1.set(a,{entity:null,status:g.NOT_PERSISTED,deleted:!0})};c.pureSnapshot=function(){var a=[],b=Array.from(this.$1.entries()).filter(function(a){a[0];a=a[1];return a.status===g.NOT_PERSISTED}).filter(function(b){var c=b[0];b=b[1];b.deleted&&a.push({id:c});return!b.deleted}).filter(function(a){a[0];a=a[1];return a.entity!=null}).map(function(a){var b=a[0];a=a[1];return{id:b,cachedEntity:a.entity}});return{update:b,remove:a}};c.snapshot=function(){var a=this,b=this.pureSnapshot();b.remove.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});b.update.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});return b};c.markSnapshotAsCommitted=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.PERSISTED)})};c.markSnapshotAsFailed=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.NOT_PERSISTED)})};c.clear=function(){this.$1=new Map()};return a}();f.PersistStatus=g;f.SignalEntityStore=a}),66);
__d("WASignalIdentityStore",["Promise","WAJids","WALogger","WASignalEntityStoreV2","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[WASignalIdentityStore] This should never happen."]);i=function(){return a};return a}a=function(){function a(){this.$1=new Map(),this.$2=new(d("WASignalEntityStoreV2").SignalEntityStore)()}var c=a.prototype;c.bulkLoadIdentities=function(a){var c=this,d,e,f,g,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:d=function(){var a,d,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:if(!f){k.next=6;break}if(!(g>=e.length)){k.next=3;break}return k.abrupt("return","break");case 3:i=e[g++];k.next=10;break;case 6:g=e.next();if(!g.done){k.next=9;break}return k.abrupt("return","break");case 9:i=g.value;case 10:a=i;d=a[0];j=a[1];k.next=15;return b("regeneratorRuntime").awrap(c.loadIdentitiesByUser(d,function(){return(h||(h=b("Promise"))).resolve(j)}));case 15:case"end":return k.stop()}},null,this)},(e=a,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 2:k.next=4;return b("regeneratorRuntime").awrap(d());case 4:j=k.sent;if(!(j==="break")){k.next=7;break}return k.abrupt("break",9);case 7:k.next=2;break;case 9:return k.abrupt("return",a);case 10:case"end":return k.stop()}},null,this)};c.loadIdentitiesByUser=function(a,c){var e,f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=this.$1.get(a);if(!(e==null)){j.next=13;break}j.t0=this;j.t1=a;j.next=6;return b("regeneratorRuntime").awrap(c(a));case 6:j.t2=j.sent;f=j.t0.$3.call(j.t0,j.t1,j.t2);g=Array.from(f.keys());this.$1.set(a,new Set(g));return j.abrupt("return",this.$2.bulkLoad(g,function(){return(h||(h=b("Promise"))).resolve(f)}));case 13:return j.abrupt("return",this.$2.bulkLoad(Array.from(e),function(a){a.length>0&&d("WALogger").ERROR(i());return(h||(h=b("Promise"))).resolve(new Map())}));case 14:case"end":return j.stop()}},null,this)};c.$3=function(a,b){b=new Map(b);var c=this.$2.pureSnapshot(),e=c.remove;c=c.update;for(var e=e,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;h=h.id;b["delete"](h)}for(h=c,g=Array.isArray(h),f=0,h=g?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(f>=h.length)break;e=h[f++]}else{f=h.next();if(f.done)break;e=f.value}c=e;e=c.id;c=c.cachedEntity;c!=null&&d("WAJids").extractUserJid(e)===a&&b.set(e,c)}return b};c.store=function(a,b){this.$2.store(a,b);b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b.add(a)};c.remove=function(a){this.$2.remove(a);var b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b["delete"](a)};c.clear=function(){this.$2.clear(),this.$1=new Map()};c.load=function(a,b){return this.$2.load(a,b)};c.bulkLoad=function(a,b){return this.$2.bulkLoad(a,b)};c.snapshot=function(){return this.$2.snapshot()};c.pureSnapshot=function(){return this.pureSnapshot()};c.markSnapshotAsCommitted=function(){this.$2.markSnapshotAsCommitted()};c.markSnapshotAsFailed=function(){this.$2.markSnapshotAsFailed()};return a}();g.SignalIdentityStore=a}),98);
__d("WAInMemorySignalStore",["Promise","WACryptoManager","WACryptoUtils","WAGlobals","WAICDCUtils","WAIdentityUtils","WAJids","WAProtocolQueue","WAResultOrError","WASignalEntityStoreV2","WASignalIdentityStore","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: end"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: start"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Snapshot: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing old identity: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing my device identity. This should not happen"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove identity the other one "]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing session dur to identity mismatch: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove session the other one"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Receiving an identity for my device but it is different from original one"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update user devices: userJid: ","; new identities: ","; previous identities: ","}"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);s=function(){return a};return a}var t=d("WATagsLogger").TAGS(["CryptoManager","InMemorySignalStore"]);a=function(){function a(a,c){var e=this;this.loadSession=function(a,b){return e.$1.load(a,function(a){return e.$9.loadSession(a,b)})};this.loadSessions=function(a){return e.$1.bulkLoad(a,function(a){return e.$9.loadSessions(a).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})}).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})};this.loadSignedPreKey=function(a){return e.$7.load(a,function(){return e.$9.loadSignedPreKey(a)})};this.bulkLoadIdentities=function(a){return e.$9.bulkLoadIdentities(a).then(function(a){return e.$5.bulkLoadIdentities(a)})};this.loadIdentities=function(a){return e.$5.loadIdentitiesByUser(a,function(){return e.$9.loadIdentities(a)})};this.saveIdentity=function(a,c){return(h||(h=b("Promise"))).resolve(e.storeIdentity(a,c))};this.loadOneTimePreKey=function(a){return e.$6.load(a,function(){return e.$9.loadOneTimePreKey(a)})};this.saveSenderKeySession=function(a,c,d){e.storeSenderKeySession(a,c,d);return(h||(h=b("Promise"))).resolve()};this.saveSignedPreKeyIfNew=function(a,b){return e.$9.saveSignedPreKeyIfNew(a,b)};this.loadSenderKeySession=function(a,c){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(e.$8.load(d("WACryptoManager").encodeSenderKey(a,c),function(){var d;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(e.$9.loadSenderKeySession(a,c));case 2:d=f.sent;return f.abrupt("return",d.success?d.value:null);case 4:case"end":return f.stop()}},null,this)}));case 2:f=g.sent;if(!(f==null)){g.next=5;break}return g.abrupt("return",d("WAResultOrError").makeError("errLoadSenderKeySession"));case 5:return g.abrupt("return",d("WAResultOrError").makeResult(f));case 6:case"end":return g.stop()}},null,this)};this.handleNewSession=function(a,c,f,g,i){e.storeSession(a,c);f!=null&&e.storeIdentity(a,f);g!=null&&e.removeOneTimePreKey(g);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())};this.saveICDC=function(a,c){e.$3.store(a,c);return(h||(h=b("Promise"))).resolve()};this.loadICDC=function(a){return e.$3.load(a,function(){return e.$9.loadICDC(a)})};this.saveDhash=function(a,c){e.$2.store(a,c);return(h||(h=b("Promise"))).resolve()};this.getLastPreKeyGenerationId=function(){return e.$9.getLastPreKeyGenerationId()};this.savePreKeysGeneration=function(a){return e.$9.savePreKeysGeneration(a)};this.getPreKeyGenerationsTimestamps=function(){return e.$9.getPreKeyGenerationsTimestamps()};this.deletePreKeyGenerations=function(a){return e.$9.deletePreKeyGenerations(a)};this.saveOneTimePreKey=function(a){return e.$9.saveOneTimePreKey(a)};this.loadPreKeys=function(a){return e.$9.loadPreKeys(a)};this.loadLatestSignedPreKey=function(){return e.$9.loadLatestSignedPreKey()};this.calculateICDC=function(a){if(a.length===0)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("missing_participants"));var c=new Set();return(h||(h=b("Promise"))).all(a.map(function(a){var f,g,h,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:q.next=2;return b("regeneratorRuntime").awrap(e.loadIdentities(a));case 2:f=q.sent;q.next=5;return b("regeneratorRuntime").awrap(e.loadICDC(a));case 5:g=q.sent;q.next=8;return b("regeneratorRuntime").awrap(e.$9.loadLastSyncTs(a));case 8:h=q.sent;d("WAICDCUtils").isLastSyncTsExpired(h)&&c.add(a);i=new Map(Array.from(f.entries()).map(function(a){var b=a[0];a=a[1];return[d("WAIdentityUtils").removeKeyTypeIfNeeded(a).toString(),b]}));if(!(g==null||d("WAICDCUtils").isICDCIndexInvalid(g))){q.next=14;break}c.add(a);return q.abrupt("return",null);case 14:j=[],(k=g.devices,l=Array.isArray(k),m=0,k=l?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 16:if(!l){q.next=22;break}if(!(m>=k.length)){q.next=19;break}return q.abrupt("break",34);case 19:n=k[m++];q.next=26;break;case 22:m=k.next();if(!m.done){q.next=25;break}return q.abrupt("break",34);case 25:n=m.value;case 26:o=n;p=i.get(d("WAIdentityUtils").removeKeyTypeIfNeeded(o).toString());if(!(p==null)){q.next=31;break}c.add(a);return q.abrupt("continue",32);case 31:j.push({id:d("WAJids").extractDeviceId(p),identity:d("WAIdentityUtils").removeKeyTypeIfNeeded(o)});case 32:q.next=16;break;case 34:return q.abrupt("return",{devices:j,sequence:g.sequence,signingDeviceIndex:g.signingDeviceIndex,timestamp:g.timestamp,user:a});case 35:case"end":return q.stop()}},null,this)})).then(function(a){var b=a.filter(Boolean);return b.length===0?d("WAResultOrError").makeError("invalid_icdc_info"):d("WAResultOrError").makeResult({icdcInfo:a.filter(Boolean),usersWithMissingICDC:c})})["catch"](function(a){t.ERROR(s(),a);return d("WAResultOrError").makeError("invalid_icdc_info")})};this.$9=a;this.$10=c;this.$5=new(d("WASignalIdentityStore").SignalIdentityStore)();this.$1=new((a=d("WASignalEntityStoreV2")).SignalEntityStore)();this.$2=new a.SignalEntityStore();this.$3=new a.SignalEntityStore();this.$4=new a.SignalEntityStore();this.$6=new a.SignalEntityStore();this.$7=new a.SignalEntityStore();this.$8=new a.SignalEntityStore()}var c=a.prototype;c.storeSession=function(a,b){this.$1.store(a,b)};c.storeIdentity=function(a,b){if(!b)return;this.$5.store(a,b)};c.removeOneTimePreKey=function(a){this.$6.remove(a)};c.storeSenderKeySession=function(a,b,c){this.$8.store(d("WACryptoManager").encodeSenderKey(a,b),c)};c.updateUserDevicesInfo=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){var e,f,g,i,j,k,s,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;return b("regeneratorRuntime").async(function(O){while(1)switch(O.prev=O.next){case 0:O.next=2;return b("regeneratorRuntime").awrap(c.loadIdentities(a.jid));case 2:e=O.sent,(f=a.devices,g=a.jid,i=a.notificationTs,j=a.dhash,k=a.icdcInfo),t.DEV(r(),g,f.map(function(b){b=b.id;return d("WAJids").toDeviceJid(a.jid,b)}).join(","),Array.from(e.keys()).join(",")),s=new Set(e.keys()),u=[],v=[],(w=f,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 9:if(!x){O.next=15;break}if(!(y>=w.length)){O.next=12;break}return O.abrupt("break",41);case 12:z=w[y++];O.next=19;break;case 15:y=w.next();if(!y.done){O.next=18;break}return O.abrupt("break",41);case 18:z=y.value;case 19:A=z;B=A.id;C=A.identity;D=A.model;E=A.platform;F=d("WAJids").toDeviceJid(a.jid,B);G=e.get(F);d("WAGlobals").getMyDeviceJid()===F&&(H=d("WACryptoUtils").uint8ArraysEqual(d("WAIdentityUtils").removeKeyTypeIfNeeded(c.$10.staticKeyPair.publicKey),d("WAIdentityUtils").removeKeyTypeIfNeeded(C)),H||t.ERROR(q()));s["delete"](F);if(!(G==null)){O.next=32;break}v.push({instruction:"identityAdded",jid:d("WAJids").extractUserJid(F),type:"instruction",device:F,identity:C,model:D,platform:E,notificationTs:i,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow});O.next=39;break;case 32:if(d("WACryptoUtils").uint8ArraysEqual(G,C)){O.next=39;break}if(!(d("WAJids").extractUserJid(F)!==g)){O.next=36;break}t.ERROR(p());return O.abrupt("continue",39);case 36:u.push(F),t.DEV(o(),F),v.push({instruction:"identityChanged",jid:d("WAJids").extractUserJid(F),type:"instruction",device:F,identity:C,model:D,platform:E,notificationTs:i,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow});case 39:O.next=9;break;case 41:I=[],(J=s,K=Array.isArray(J),L=0,J=K?J:J[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 43:if(!K){O.next=49;break}if(!(L>=J.length)){O.next=46;break}return O.abrupt("break",63);case 46:M=J[L++];O.next=53;break;case 49:L=J.next();if(!L.done){O.next=52;break}return O.abrupt("break",63);case 52:M=L.value;case 53:N=M;if(!(d("WAJids").extractUserJid(N)!==g)){O.next=57;break}t.ERROR(n());return O.abrupt("continue",61);case 57:I.push(N),d("WAGlobals").getMyDeviceJid()===N&&t.ERROR(m()),t.DEV(l(),N),v.push({instruction:"identityRemoved",jid:d("WAJids").extractUserJid(N),type:"instruction",device:N,notificationTs:i,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow});case 61:O.next=43;break;case 63:return O.abrupt("return",(h||(h=b("Promise"))).all([j!=null?c.saveDhash(g,j):(h||(h=b("Promise"))).resolve(),k!=null?c.saveICDC(g,k):(h||(h=b("Promise"))).resolve()].concat(Array.from(I).map(function(a){return c.deleteIdentity(a)}),[I.concat(u).map(function(a){return c.$11(a)})],f.map(function(b){var a=b.id;b=b.identity;return c.saveIdentity(d("WAJids").toDeviceJid(g,a),b)}))).then(function(){return d("WAResultOrError").makeResult(v)}));case 64:case"end":return O.stop()}},null,this)})).then(function(a){a=a.flatMap(function(a){return a.success?a.value:[]});a.forEach(function(a){void d("WAProtocolQueue").protocolQueue().addPending(a)})}).then(function(){})};c.savePendingToDatabase=function(){var a=this,c=this.$12();if(c==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult([]));t.DEV(k(),c);t.LOG(j());return this.$9.bulkSaveSignalData(c).then(function(b){t.LOG(i());a.$13();return b},function(c){a.$14();return(h||(h=b("Promise"))).reject(c)})};c.clear=function(){this.$1.clear(),this.$5.clear(),this.$6.clear(),this.$7.clear(),this.$8.clear(),this.$2.clear(),this.$3.clear()};c.deleteIdentity=function(a){this.$5.remove(a);return(h||(h=b("Promise"))).resolve()};c.$11=function(a){this.$1.remove(a);return(h||(h=b("Promise"))).resolve()};c.$13=function(){this.$1.markSnapshotAsCommitted(),this.$2.markSnapshotAsCommitted(),this.$3.markSnapshotAsCommitted(),this.$5.markSnapshotAsCommitted(),this.$6.markSnapshotAsCommitted(),this.$7.markSnapshotAsCommitted(),this.$8.markSnapshotAsCommitted()};c.$14=function(){this.$1.markSnapshotAsFailed(),this.$2.markSnapshotAsFailed(),this.$3.markSnapshotAsFailed(),this.$5.markSnapshotAsFailed(),this.$6.markSnapshotAsFailed(),this.$7.markSnapshotAsFailed(),this.$8.markSnapshotAsFailed()};c.$12=function(){var a=this.$1.snapshot(),b=[],c=a.remove.map(function(a){return a.id});a.update.forEach(function(a){var c=a.id;a=a.cachedEntity;if(a==null)return;b.push({id:c,updated:a})});var e=[];this.$8.snapshot().update.forEach(function(a){var b=d("WACryptoManager").decodeSenderKey(a.id),c=b.groupId;b=b.deviceId;a.cachedEntity!=null&&c&&b&&e.push({groupId:c,author:b,updated:a.cachedEntity})});a=this.$5.snapshot();var f=a.remove.map(function(a){return a.id}),g=[];a.update.forEach(function(a){var b=a.id;a=a.cachedEntity;if(a==null)return;g.push({id:b,identity:a})});a=this.$6.snapshot().remove;var h=this.$2.snapshot(),i=[];for(var h=h.update,j=Array.isArray(h),k=0,h=j?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=h.length)break;l=h[k++]}else{k=h.next();if(k.done)break;l=k.value}l=l;var m=l.cachedEntity;l=l.id;m!=null&&i.push({id:l,dhash:m})}l=this.$3.snapshot();m=[];for(k=l.update,j=Array.isArray(k),h=0,k=j?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(j){if(h>=k.length)break;l=k[h++]}else{h=k.next();if(h.done)break;l=h.value}l=l;var n=l.cachedEntity;l=l.id;n!=null&&m.push({id:l,icdc:n})}return b.length===0&&c.length===0&&g.length===0&&e.length===0&&a.length===0&&m.length===0&&i.length===0&&f.length===0?null:{dhashUpdate:i,icdcUpdate:m,identityRemove:f,identityUpdate:g,preKeyRemove:a,senderKeySessionUpdate:e,sessionRemove:c,sessionUpdate:b}};c.warmCache=function(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(this.bulkLoadIdentities(a.map(d("WAJids").interpretAsUserJid).filter(Boolean)));case 2:c=f.sent;e=Array.from(c.values()).reduce(function(a,b){return a.concat(Array.from(b.keys()))},[]);f.next=6;return b("regeneratorRuntime").awrap(this.loadSessions(e));case 6:case"end":return f.stop()}},null,this)};return a}();g.InMemorySignalStoreImpl=a}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h={delayMs:50,maxSize:100};function a(a,b){b=b===void 0?h:b;var c=b.delayMs,e=b.maxSize,f=null;function g(b){f&&f.args===b&&(f=null);return a(b)}return function(a){if(f!=null)f.args.push(a);else{var b=[a],h=new(d("WAResolvable").Resolvable)();a=h.promise.then(g);var i=function(){return void h.resolve(b)},j=setTimeout(i,c);f={args:b,batchPromise:a,run:i,timer:j}}a=f;i=a.args;j=a.batchPromise;var k=i.length-1;if(i.length>=e){clearTimeout((a=f)==null?void 0:a.timer);f.run();f=null}return j.then(function(a){return a[k]})}}g.makeSimpleBatcher=a}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("WARequestKeysBatcher").makeSimpleBatcher(function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WABulkRequestKeys").bulkRequestKeys(a));case 2:c=e.sent;if(!(c.success===!1)){e.next=5;break}return e.abrupt("return",a.map(function(){return c}));case 5:return e.abrupt("return",a.map(function(a){a=c.value.get(a);return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeError("errRequestKeysNoKeys")}));case 6:case"end":return e.stop()}},null,this)});c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},a);g.requestKeys=c}),98);
__d("WACryptoManagerUtils",["Promise","WABulkRequestKeys","WACryptoDbCallbacks","WACryptoManager","WAErr","WAGlobals","WAHandleFailureUtils","WAInMemorySignalStore","WALogger","WALoggerTag","WAPREList","WAPREMetrics","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate one time prekey"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot deserialize signed prekey"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["No signed prekey: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt messages"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg error: ",""]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekey]);function a(a){var b=new(d("WAInMemorySignalStore").InMemorySignalStoreImpl)(d("WACryptoDbCallbacks").cryptoDbCallbacks,a),c=p();return{manager:d("WACryptoManager").initCryptoManager({regInfo:a,storage:b,network:c}),storage:b}}function p(){return{requestKeys:d("WARequestKeys").requestKeys,bulkRequestKeys:d("WABulkRequestKeys").bulkRequestKeys}}function q(a,b){if(b.success)a==null?void 0:a.endSuccess();else{var c,e=b.error;d("WALogger").WARN(n(),e);switch(e){case"errDuplicateMsg":a==null?void 0:a.addPoint(e);a==null?void 0:a.endSuccess();return;case"errCryptoDeserialization":case"errSignalNoSession":case"errSignalInvalidMsg":case"errInvalidMac":case"errSignalInvalidSignedPreKey":case"errSignalSignedPreKeyIdMismatch":case"errSignalSignedPreKeyDeserialization":case"errSignalInvalidOneTimeKey":case"errSignalOneTimeKeyMismatch":case"errSignalOneTimeKeyDeserialization":case"errSignalInvalidKey":case"errSignalDecryptionFailed":case"errSignalDeserializeInvalidProtoFormat":case"errSignalDeserializeRatchetKeyBadFormat":case"errSignalDeserializePkInvalidProtoFormat":case"errSignalDeserializePkKeyBadFormat":case"errSignalTooManyMessagesInFuture":case"errSignalEmptyVersionContentSuffix":case"errSignalContentExceededExpectedLength":case"errSignalGrpInvalidProtoFormat":case"errSignalGrpInvalidKeyFormat":case"errSignalGrpVersionContentEmpty":case"errSignalGrpInvalidVersionContentLength":case"errSignalGrpSenderKeyInvalidProtoFormat":case"errSignalGrpSenderKeyProtoError":case"errSignalGrpTooManyMessagesInFuture":c=e;break;default:typeof e==="string"?c=e:(d("WALogger").ERROR(m(),b),c="fail");break}a==null?void 0:a.endFail(c)}}function e(a,c,e,f,g){var i=null;return d("WACryptoManager").decryptContent(f.cryptoManager,c,{ciphertext:e,type:a},function(a,c){i={plaintext:a,remoteIdentity:c};return(h||(h=b("Promise"))).resolve()}).then(function(a){q(g,a);if(a.success)return d("WAResultOrError").makeResult(i);else return a})}function f(a,c,e,f,g){var i=null;return d("WACryptoManager").decryptGroupContent(f.cryptoManager,a,c,e,function(a){i={plaintext:a};return(h||(h=b("Promise"))).resolve()}).then(function(a){q(g,a);if(a.success)return d("WAResultOrError").makeResult(i);else return a})}function r(a,b){return d("WACryptoManager").getParticipantInfo(b,a)}function s(a){return a.storage.getPreKeyGenerationsTimestamps()}function t(a,b){return b.storage.deletePreKeyGenerations(a)}function u(a,b,c,e){return d("WACryptoManager").saveSenderKeySession(e.cryptoManager,a,b,c)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield a.storage.loadLatestSignedPreKey());if(e.success===!1){var f;o.EXPECTED_ERROR(k(),(f=(f=e.payload)==null?void 0:f.toString())!=null?f:"");d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_NO_SIGNED_PRE_KEY).endFail("missing-signed-prekey");e.error==="missing-last-signed-prekey-id"&&(yield d("WAHandleFailureUtils").reregisterPhone());throw(f=e.payload)!=null?f:c("WAErr")("No signed prekey")}f=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(f==null){o.ERROR(j());throw c("WAErr")("Cannot deserialize signed prekey")}e=(yield d("WACryptoManager").generateOneTimePreKey(a));if(e==null){d("WATagsLogger").TAGS([c("WALoggerTag").OneTimePrekey]).ERROR(i());throw c("WAErr")("Cannot generate one time prekey")}a=a.regInfo;var g=a.regId;a=a.staticKeyPair;return(h||(h=b("Promise"))).resolve({regId:g,keyType:d("WASignalKeys").KEY_TYPE,publicKey:a.publicKey,signedPreKey:f,preKey:e})});return w.apply(this,arguments)}function x(a,b,c){var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"group",jid:a},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").encryptGroupContent(c.cryptoManager,a,d("WAGlobals").getMyDeviceJid(),b).then(function(a){if(a.success)e.endSuccess();else{var b=a.error;switch(b){case"identity-mismatch":break;default:break}e.endFail(b)}return a})}function y(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:c},string_array:{node_types:e,message_types:f,media_types:g},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"missing":case"mismatch":case"runtime-exception":break;default:break}h.endFail(b)}return a})}function z(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:g},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").encryptContent(c.cryptoManager,a,b,e||d("WACryptoManager").DEFAULT_SESSION_REQUEST,f).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}h.endFail(b)}return a})}function A(a,b){return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success===!1){d("WALogger").ERROR(l());return new Map()}return a.value})}function B(a,b){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=(yield d("WACryptoManager").ensureSessionsExists(c.cryptoManager,a));yield (h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return c.cryptoManager.storage.handleNewSession(b,a,a.remote.pubKey)}))});return C.apply(this,arguments)}g.createCryptoManager=a;g.decryptMsg=e;g.decryptGroupMsg=f;g.getParticipantInfo=r;g.getPreKeyGenerationsTimestamps=s;g.deletePreKeyGenerations=t;g.saveSenderKeySession=u;g.getSignalInfoForRetry=v;g.encryptGroupContentWithMetrics=x;g.bulkEncryptMsgWithMetrics=y;g.encryptMsgWithMetrics=z;g.bulkEncrypt=A;g.bulkPreEstablishOutgoingSession=B}),98);
__d("WADbRegistrationApi",["MAWTransactionMode","WADbSignal","WADbTransactor","WAErr","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker: got db data"]);h=function(){return a};return a}function i(a){return a.meta.bulkGet([(a=d("WADbSignal")).MetaKeysEnum.fbid,a.MetaKeysEnum.deviceId,a.MetaKeysEnum.cat,a.MetaKeysEnum.regId,a.MetaKeysEnum.identityKeyPair,a.MetaKeysEnum.authKeyPair]).then(function(a){var b=a[0],e=a[1],f=a[2],g=a[3],i=a[4];a=a[5];d("WALogger").LOG(h());b=b==null?void 0:b.value.fbid;e=e==null?void 0:e.value.deviceId;f=f==null?void 0:f.value.cat;g=g==null?void 0:g.value.regId;i=i==null?void 0:i.value.identityKeyPair;a=a==null?void 0:a.value.authKeyPair;if(b==null)throw c("WAErr")("fbid not set");if(e==null)throw c("WAErr")("deviceId not set");if(f==null)throw c("WAErr")("fbCat not set");if(g==null||i==null)throw c("WAErr")("regInfo not set");return{deviceJid:d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(b),e),fbCat:f.encrypted_serialized_cat,regInfo:{authKeyPair:a,regId:g,staticKeyPair:i},userJid:d("WAJids").toMsgrUserJid(b)}})}function a(){return d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READONLY},"loadAllRegistrationMeta",function(a){return function(){return i(a)}})()}b=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE},"saveLastSessionDeviceWasLinkedTo",function(a){return function(b,c){b=c.sessionId;return a.meta.put({key:d("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,value:{lastSessionDeviceWasLinkedTo:b}}).then(function(){})}});e=function(a){return d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE,signedPrekey:d("MAWTransactionMode").READWRITE},"inMetaStoreAndSignedPreKey",function(b){return function(c){return a(b,c)}})};f=function(a){return d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE},"saveDeviceId",function(b){return function(c){return a(b,c)}})};var j=function(a){return d("WADbTransactor").makeSignalTransactor({identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY,signedPrekey:d("MAWTransactionMode").READONLY},"checkExistingRegistration",function(b){return function(){return a(b)}})()},k=function(a){return d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READWRITE},"saveICDC",function(b){return function(c,d){return a(b,c,d)}})};g.loadAllRegistrationMetaInTransaction=a;g.saveLastSessionDeviceWasLinkedTo=b;g.inMetaStoreAndSignedPreKeyTransaction=e;g.inSaveDeviceIdTransaction=f;g.checkExistingRegTransaction=j;g.saveICDCInTransaction=k}),98);
__d("WAMapUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return new Map(Array.from(a.entries()).map(function(a){return[a[0],b(a[1],a[0])]}))}f.mapValues=a}),66);
__d("WAProtocolMediaType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":case"product":return a;case"xma-image":return"document";default:return null}}f.castToProtocolMediaType=a}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAErr","WAGlobals","WALogger","WAMapUtils","WAMsgTransport.pb","WANullthrows","WAProtocolMediaType","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""]);i=function(){return a};return a}function a(a,b,e,f){var g=new Set(),h=new Set(),m=new Set(),n=d("WAMapUtils").mapValues(a,function(a,b){var c=a.params;a=a.icdc;var d;g.add(c.type);switch(c.type){case"message":d=j({messageBytes:c.messageBytes,to:b,icdc:a,chat:c.chat,applicationPayloadVersion:c.applicationPayloadVersion});h.add(c.messageType.type);c.messageType.mediaType!=null&&m.add(c.messageType.mediaType);break;case"appdata":d=k({messageBytes:c.messageBytes});break;default:c.type,d=l({skdm:c.skdm,icdc:a})}return{plaintext:d}});return d("WACryptoManagerUtils").bulkEncryptMsgWithMetrics(n,b,e,Array.from(g),Array.from(h),Array.from(m)).then(function(b){if(!b.success){d("WALogger").ERROR(i(),b.error);return null}return d("WAMapUtils").mapValues(b.value,function(b,e){var g,h=b.type,i=b.ciphertext;b=b.baseKey;g=c("WANullthrows")((g=a.get(e))==null?void 0:g.params);var j=g.type==="message"&&g.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(g.messageType.mediaType):null;return{encType:"device",to:e,v:((e=g.messageBytes)==null?void 0:e.version)==="v2"?"2":"3",type:h,mediaType:j,count:f,ciphertext:i,baseKey:b}})})}function b(a,b,c,e,f,g,i){var m;switch(b.type){case"message":m=j({messageBytes:b.messageBytes,to:a,icdc:i,chat:b.chat,applicationPayloadVersion:b.applicationPayloadVersion});break;case"appdata":m=k({messageBytes:b.messageBytes});break;default:b.type,m=l({skdm:b.skdm,icdc:i})}i=d("WACryptoManagerUtils").encryptMsgWithMetrics(a,m,c,f,g,b==null?void 0:b.chat);return i.then(function(c){var f;if(!c.success){d("WALogger").ERROR(h(),c.error);return null}var g=b.type==="message"&&b.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(b.messageType.mediaType):null,i=c.value,j=i.type;i=i.ciphertext;return{encType:"device",to:a,v:((f=b.messageBytes)==null?void 0:f.version)==="v2"?"2":"3",type:j,mediaType:g,count:e,ciphertext:i,baseKey:c.value.baseKey}})}function j(a){var b=a.messageBytes,c=a.to,e=a.icdc,f=a.chat;a=a.applicationPayloadVersion;if(b.version==="v3"){var g=null;d("WAGlobals").isPeerDevice(c)&&(g=f);f=d("WAAsMessageTransport").asMessageTransport(b.bytes,g,null,e,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,f).readByteArray()}else if(d("WAGlobals").isPeerDevice(c))return b.bytesForPeer;else return b.bytes}function k(a){a=a.messageBytes;if(a.version==="v3"){a=d("WAAsMessageTransport").asMessageTransport(a.bytes);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,a).readByteArray()}else throw c("WAErr")("Plaintext v2 not supported yet")}function l(a){var b=a.skdm;a=a.icdc;b=d("WAAsMessageTransport").asMessageTransport(null,null,b,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArray()}g.getEncNodes=a;g.getEncNode=b}),98);
__d("WAPhash",["Promise","WABase64","WABinary","WACryptoDependencies","WALogger","WASortedLists"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"]);j=function(){return a};return a}function a(a){d("WALogger").LOG(j());a=d("WASortedLists").sortAndDedupe(a);var c=new(d("WABinary").Binary)();for(var e=0;e<a.length;e++)c.writeString(a[e]);return(h||(h=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",c.readByteArray()).then(function(a){d("WALogger").LOG(i());a=new Uint8Array(a,0,6);return"2:"+d("WABase64").encodeB64(a)}))}g.calculatePHash=a}),98);
__d("WAEncUserMsg",["Promise","WAEncNode","WAGlobals","WAICDCUtils","WAJids","WAPhash","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt - getParticipantNodes -- EMPTY DEVICE JIDS"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- OTHER_RECIPENT_DEVICE_EMPTY"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no other recipient"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"]);r=function(){return a};return a}var s=d("WATagsLogger").TAGS(["WAEncUserMsg"]);function a(a,c,e,f){s.LOG(r());a.length===0&&s.ERROR(q());var g=!1;a.length===1&&(g=a[0].user===d("WAGlobals").getMyUserJid());var i=a.find(function(a){return a.user===d("WAGlobals").getMyUserJid()});i==null&&(i={user:d("WAGlobals").getMyUserJid(),devicesInfo:[]});var j=a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()});j.length===0&&c.type!=="appdata"&&!g&&s.ERROR(p());g=d("WAICDCUtils").computeICDCParticipantDevices(i,j,e);s.LOG(o());i=a.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});v(a)&&s.LOG(n());return(h||(h=b("Promise"))).all([t(i,c,f,g),d("WAPhash").calculatePHash(i.concat(d("WAGlobals").getMyDeviceJid()))]).then(function(a){var b=a[0];a=a[1];s.LOG(m());return{participants:b,phash:a}})}function c(a,b,c){return t(a,b,c)}function t(a,b,c,d){return u(a,b,c,d).then(function(a){if(a.length===0){s.WARN(l());return}return a})}function e(a,b,c,e,f,g){return d("WAEncNode").getEncNode(a,b,c,e,f,g)}function u(a,b,c,e){var f=!1;s.LOG(k());(b.type!=="message"||d("WAJids").interpretAsGroupJid(b.chat)!=null)&&(f=!0);a=d("WAEncNode").getEncNodes(new Map(a.map(function(a){return[a,{params:b,icdc:e}]})),c).then(function(a){if(a==null){s.WARN(j());return[]}b.type==="message"&&(f=f||Array.from(a.keys()).some(function(a){return d("WAJids").extractUserJid(a)===b.chat}));return Array.from(a==null?void 0:a.values())});return a.then(function(a){if(f)return a;else{s.ERROR(i());return[]}}).then(function(a){return a.filter(Boolean)})}function v(a){return a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()}).flatMap(function(a){return a.devicesInfo}).length===0}g.encryptUserMsg=a;g.encryptGroupFanoutMsg=c;g.encryptDeviceJidMessage=e}),98);
__d("WAGetMetaApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READONLY},"getMeta",function(a){return function(){return a.meta.bulkGet(["certificateChain","deviceId","identityKeyPair","abProps","edgeInfo","clockSkew","authKeyPair"]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5];a=a[6];return{abProps:e==null?void 0:(e=e.value)==null?void 0:e.abProps,authKeyPair:a==null?void 0:(e=a.value)==null?void 0:e.authKeyPair,certificateChain:b==null?void 0:(a=b.value)==null?void 0:a.certificateChain,clockSkew:g==null?void 0:(e=g.value)==null?void 0:e.clockSkew,deviceId:c==null?void 0:(b=c.value)==null?void 0:b.deviceId,edgeInfo:f==null?void 0:(a=f.value)==null?void 0:a.edgeInfo,identityKeyPair:d==null?void 0:(g=d.value)==null?void 0:g.identityKeyPair}})}});g.getMeta=a}),98);
__d("WAGetCurrentUserDeviceInfoApi",["WAGetMetaApi","WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGetMetaApi").getMeta().then(function(a){var b=a==null?void 0:a.deviceId;a=a==null?void 0:a.identityKeyPair;if(b==null||a==null)return null;a=d("WASignalKeys").serializePubKey(a);return{deviceId:b,identityKey:a}})};b=function(){return d("WAGetMetaApi").getMeta().then(function(a){return(a==null?void 0:a.deviceId)==null?null:{deviceId:a==null?void 0:a.deviceId}})};g.getCurrentUserDeviceInfo=a;g.getCurrentUserDeviceId=b}),98);
__d("WAMediaHkdfInfo",["WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"document":return"WhatsApp Document Keys";case"image":case"sticker":case"xma-image":return"WhatsApp Image Keys";case"video":case"gif":return"WhatsApp Video Keys";case"audio":case"ptt":return"WhatsApp Audio Keys";case"md-app-state":return"WhatsApp App State Keys";case"md-msg-hist":return"WhatsApp History Keys";default:throw c("WAErr")("getMediaHkdfInfo: unexpected media type "+a)}}function b(){return"Messenger Preview Keys"}g.getMediaHkdfInfo=a;g.getPreviewMediaHkdfInfo=b}),98);
__d("WAMediaCrypto",["Promise","WABinary","WACryptoAesCbc","WACryptoDependencies","WACryptoHkdf","WACryptoHmac","WACryptoSha256","WACryptoUtils","WACustomError","WAErr","WAHashUtils","WALogger","WAMediaCryptoSidecar","WAMediaHkdfInfo","WAMediaUtils","WATagsLogger","WATypedArraysConcat","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing scan ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt partial due to invalid target scan"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialChunks targetScan greater length of scanLength array"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["WAMediaCrypto"]),m=d("WACustomError").customError("HmacValidationError",!1),n=new Uint8Array([2,2]);function o(a,b){return d("WACryptoHkdf").extractAndExpand(new Uint8Array(a),b,112).then(function(a){return{iv:new Uint8Array(a,0,16),cipherKey:new Uint8Array(a,16,32),hmacKey:new Uint8Array(a,48,32),refKey:new Uint8Array(a,80,32)}})}function p(a,b){b=d("WAMediaHkdfInfo").getMediaHkdfInfo(b);return o(a,b)}function q(a){var b=d("WAMediaHkdfInfo").getPreviewMediaHkdfInfo();return o(a,b)}function a(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=new Map();f.next=3;return b("regeneratorRuntime").awrap(q(a));case 3:d=f.sent;c.set("preview",d);e=["document","image","video","audio","md-app-state","md-msg-hist"];f.next=8;return b("regeneratorRuntime").awrap((h||(h=b("Promise"))).all(e.map(function(b){return p(a,b).then(function(a){c.set(b,a)})})));case 8:return f.abrupt("return",c);case 9:case"end":return f.stop()}},null,this)}function e(a){switch(a){case"image":case"video":return a;default:throw c("WAErr")("Unsupported PreviewMediaType: "+a)}}var r=16,s=16,t=10,u=64*1024;function f(a,c,e,f,g){var i,j,k,l,m,n,o,p,q,v,w,x,y,z,A;return b("regeneratorRuntime").async(function(B){while(1)switch(B.prev=B.next){case 0:i=new(d("WABinary").Binary)(),i.ensureCapacity(s+f.size+r+t),i.writeByteArray(c),j=new(d("WACryptoAesCbc").AesCbcStream)(i,"encrypt",a,c),k=0,l=k+u;case 6:if(!(l<f.size)){B.next=17;break}m=f.slice(k,l);B.next=10;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(m));case 10:n=B.sent;B.next=13;return b("regeneratorRuntime").awrap(j.append(new Uint8Array(n)));case 13:k=l;l+=u;B.next=6;break;case 17:B.next=19;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(f.slice(k)));case 19:o=B.sent;B.next=22;return b("regeneratorRuntime").awrap(j.finalize(new Uint8Array(o)));case 22:p=i.peek(function(a){return a.readByteArray()});B.next=25;return b("regeneratorRuntime").awrap(d("WACryptoHmac").encodeKeySha256(e));case 25:q=B.sent;B.next=28;return b("regeneratorRuntime").awrap(d("WACryptoHmac").sign(q,p));case 28:v=B.sent;i.writeByteArray(new Uint8Array(v,0,t));w=i.readByteArray();x=w.subarray(s);B.next=34;return b("regeneratorRuntime").awrap((h||(h=b("Promise"))).all([d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",x),d("WAMediaCryptoSidecar").shouldHaveStreamingSidecar(g)?d("WAMediaCryptoSidecar").calculateStreamingSidecar(q,w):void 0]));case 34:y=B.sent;z=y[0];A=y[1];return B.abrupt("return",{ciphertext:x,ciphertextHash:z,sidecar:A,ivCiphertext:p,ivCiphertextHmac:w});case 38:case"end":return B.stop()}},null,this)}function v(a,c,e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WACryptoHmac").encodeKeySha256(a));case 2:f=h.sent;g=d("WABinary").Binary.build(c,e).readByteArray();return h.abrupt("return",d("WACryptoHmac").sign(f,g));case 5:case"end":return h.stop()}},null,this)}function w(a,c,e,f,g){var h,i,j,k,l;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:if(10<=g.length&&g.length<=32){n.next=2;break}throw new m("Bad hmac size "+g.length);case 2:h=d("WABinary").Binary.build(c,e).readByteArray();n.next=5;return b("regeneratorRuntime").awrap(d("WACryptoHmac").hmacSha256(f,h).then(function(a){return new Uint8Array(a)}));case 5:i=n.sent;j=i.slice(0,g.length);if(A(j,g)){n.next=9;break}throw new m("hmacAndDecrypt hmac mismatch");case 9:n.next=11;return b("regeneratorRuntime").awrap(d("WACryptoAesCbc").aesCbcDecrypt(a,c,e));case 11:k=n.sent;n.next=14;return b("regeneratorRuntime").awrap(d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",k));case 14:l=n.sent;return n.abrupt("return",{plaintextHash:d("WAHashUtils").toPlaintextHash(l),plaintext:k});case 16:case"end":return n.stop()}},null,this)}function x(a,b,c,e,f){if(!(10<=f.length&&f.length<=32))throw new m("Bad hmac size "+f.length);var g=d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[b,c]);return d("WACryptoHmac").hmacSha256(e,g,f.length).then(function(a){return new Uint8Array(a)}).then(function(a){if(!d("WACryptoUtils").uint8ArraysEqual(a,f))throw new m("hmacAndDecrypt hmac mismatch")}).then(function(){var a=c.byteLength%r===t;if(a===!0)return c.subarray(0,-10);else return c}).then(function(c){return y(a,b,c)})}function y(a,b,c){var e=c.subarray(-r);return d("WACryptoAesCbc").aesCbcEncrypt(a,n,e).then(function(a){return a.slice(s)}).then(function(a){return d("WABinary").Binary.build(c,a).readByteArray()}).then(function(c){return d("WACryptoAesCbc").aesCbcDecrypt(a,b,c)}).then(function(a){return new Uint8Array(a,0,a.byteLength-n.byteLength)}).then(function(a){return{plaintext:a,nextIv:e}})}function z(a,e,f,g,h,m){var n,o,p,q,r,s,t,u,v,w,y,z,A,B,C,D;return b("regeneratorRuntime").async(function(E){while(1)switch(E.prev=E.next){case 0:h>m.scanLengths.length&&l.ERROR(k());n=Math.min(h,m.scanLengths.length);if(!(n<1)){E.next=5;break}l.ERROR(j());throw c("WAErr")("Unable to decrypt partial due to invalid target scan");case 5:o=new(d("WABinary").Binary)();p=[];for(q=0;q<n;q++)p.push(new Uint8Array(m.sidecar,q*10,10));r=0;s=e;t=0;u=0;case 12:if(!(u<n)){E.next=29;break}d("WALogger").DEV(i(),u);v=m.alignedScanLengths[u];w=r+v;y=f.subarray(r,w);E.next=19;return b("regeneratorRuntime").awrap(x(a,s,y,g,p[u]));case 19:z=E.sent,A=z.plaintext,B=z.nextIv,o.write(A),r+=v,s=B,t+=m.scanLengths[u];case 26:u++;E.next=12;break;case 29:C=o.readBuffer(t);E.next=32;return b("regeneratorRuntime").awrap(d("WACryptoSha256").sha256(C));case 32:D=E.sent;return E.abrupt("return",{plaintextHash:d("WAHashUtils").toPlaintextHash(D),plaintext:C});case 34:case"end":return E.stop()}},null,this)}function A(a,b){if(a.length!==b.length)return!1;var c=1,d=a.length;for(var e=0;e<d;e++)c&=a[e]===b[e]?1:0;return c!==0}g.HmacValidationError=m;g.DEFAULT_PADDING=n;g.computeMediaKeys=p;g.computeMediaKeysForPreview=q;g.deprecated_getAllCommonComputedMediaKeys=a;g.convertServerMediaTypeToPreviewMediaType=e;g.CBC_BLOCK_SIZE=r;g.IV_LENGTH=s;g.HMAC_LENGTH=t;g.encryptAndHmac=f;g.hmacCiphertext=v;g.hmacAndDecrypt=w;g.hmacAndDecryptPartial=x;g.decryptPartialChunks=z}),98);
__d("WASmaxInDevicesNotifyResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseNotifyResponseError=a}),98);
__d("WASmaxInDevicesNotifyResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseNotifyResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutDevicesNotifyRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.userJid;a=d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(a)});return a}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeNotifyRequestUsersUser=h;g.makeNotifyRequest=a}),98);
__d("WASmaxDevicesNotifyRPC",["WAComms","WASmaxInDevicesNotifyResponseError","WASmaxInDevicesNotifyResponseSuccess","WASmaxOutDevicesNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDevicesNotifyRequest").makeNotifyRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDevicesNotifyResponseSuccess").parseNotifyResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"NotifyResponseSuccess",value:g.value});case 7:h=d("WASmaxInDevicesNotifyResponseError").parseNotifyResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"NotifyResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendNotifyRPC=a}),98);
__d("WANotifyDeviceChange",["Promise","WAErr","WAGlobals","WALogger","WAPersistedJobManager","WASmaxDevicesNotifyRPC","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["The maximum number of users that can be notified is ",""]);i=function(){return a};return a}function a(a,c){a=c.users;if(a.size===0)return(h||(h=b("Promise"))).resolve();c=d("WAGlobals").getConfig().maxUsersForNotifyDeviceChange();var e=Array.from(a);a.size>c&&(d("WALogger").ERROR(i(),c),e=e.slice(0,c));return j(e)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxDevicesNotifyRPC").sendNotifyRPC({userArgs:a.map(function(a){return{userJid:a}})}));if(a.name==="NotifyResponseSuccess")return;a.name;a=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;if(a.name==="RetryableIQError"){var b=a.value.backoff;if(b!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:b},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}throw c("WAErr")("Failed with an unexpected error code "+a.value.code)});return k.apply(this,arguments)}g.notifyDeviceChange=a}),98);
__d("WAQueryGroup",["$InternalEnum","WADeprecatedSendIq","WADeprecatedWapParser","WAGroupParserUtils","WAPREList","WAPREMetrics","WAResultOrError","WAWap","WAWaterFlow","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("WADeprecatedWapParser"))("queryAllGroupsResponse",function(a){a.assertTag("iq");return{groups:a.child("groups").mapChildren(d("WAGroupParserUtils").parseGroupNode)}});function a(){var a,c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUPS);c=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").G_US,type:"get",xmlns:"w:g2"},d("WAWap").wap("participating",null,d("WAWap").wap("participants",null),d("WAWap").wap("description",null)));f.next=4;return b("regeneratorRuntime").awrap(d("WADeprecatedSendIq").deprecatedSendIq(c,h));case 4:e=f.sent;if(e.success){f.next=8;break}a.endFail("query_groups_fail");return f.abrupt("return",d("WAResultOrError").makeError(e));case 8:a.endSuccess();return f.abrupt("return",d("WAResultOrError").makeResult(e.result));case 10:case"end":return f.stop()}},null,this)}var i=new(c("WADeprecatedWapParser"))("queryAllGroupsResponse",function(a){a.assertTag("iq");return{group:d("WAGroupParserUtils").parseGroupNode(a.child("group"))}}),j=b("$InternalEnum").Mirrored(["IQ_REQUEST"]);function e(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=d("WAWaterFlow").makeWaterflow("query-group",d("WAPREList").PRE_METRIC.QUERY_GROUP).startMetric();e.addPoint(j.IQ_REQUEST);g.next=4;return b("regeneratorRuntime").awrap(d("WADeprecatedSendIq").deprecatedSendIq(d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").GROUP_JID(a),type:"get",xmlns:"w:g2"},d("WAWap").wap("query",{request:c!=null?d("WAWap").CUSTOM_STRING(c):d("WAWap").DROP_ATTR})),i));case 4:f=g.sent;if(f.success){g.next=8;break}e.endFail("Fail-"+f.errorCode);return g.abrupt("return",d("WAResultOrError").makeError(f));case 8:e.endSuccess();return g.abrupt("return",d("WAResultOrError").makeResult(f.result.group));case 10:case"end":return g.stop()}},null,this)}g.queryAllGroups=a;g.parseQueryGroupResponse=i;g.queryGroup=e}),98);
__d("WAQueryGroups",["Promise","WACreateGroup","WAErr","WAGetDevices","WAPushSafeTypes","WAQueryGroup","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=d("WAPushSafeTypes").unsafeNotNullable(e);var f={groups:[]};if(e.type==="all"){var g=(yield d("WAQueryGroup").queryAllGroups());if(g.success===!1){var i;throw c("WAErr")("Failed to parse queryAllGroup response with error "+JSON.stringify((i=g.error)!=null?i:null))}f=g.value}else{e.type;i=(yield (h||(h=b("Promise"))).all(e.groups.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAQueryGroup").queryGroup(a));if(a.success===!1){var b;throw c("WAErr")("Failed to parse queryGroup response with error "+JSON.stringify((b=a.error)!=null?b:null))}return a.value});return function(b){return a.apply(this,arguments)}}())));f={groups:i}}yield d("WACreateGroup").createGroups(f.groups.map(function(a){return{groupStatus:"queried",groupToCreate:a,serverTs:d("WATimeUtils").unixTime(),extras:void 0,folder:void 0,key:void 0}}));var j=new Set();f.groups.forEach(function(a){return a.participants.forEach(function(a){a.success?j.add(a.value.user):j.add(a.error.user)})});yield d("WAGetDevices").getDevices(a,{users:j,reason:"query-groups",ignoreDhash:!1})});return i.apply(this,arguments)}g.queryGroups=a}),98);
__d("WASetMetaApi",["MAWDexieTable","MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READWRITE},"getMeta",function(a){return function(b){return d("MAWDexieTable").dexieAll(Object.entries(b).map(function(b){var c,d=b[0];b=b[1];return a.meta.put({key:d,value:(c={},c[d]=b,c)})})).then(function(){})}});g.setMeta=a}),98);
__d("WASmaxInAppdataPublishAckMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","appdata");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({"class":c.value,t:b.value})}g.parseAckMixin=a}),98);
__d("WASmaxInAppdataPublishPeerResponseNegative",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;a=d("WASmaxInAppdataPublishAckMixin").parseAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},a.value))}g.parsePeerResponseNegative=a}),98);
__d("WASmaxInAppdataPublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInAppdataPublishPeerResponseSuccess",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxInAppdataPublishDeviceListStaleMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxInAppdataPublishAckMixin").parseAckMixin(a,b);if(!c.success)return c;b=d("WASmaxInAppdataPublishDeviceListStaleMixin").parseDeviceListStaleMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{deviceListStaleMixin:b.success?b.value:null}))}g.parsePeerResponseSuccess=a}),98);
__d("WASmaxOutAppdataPublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutAppdataPublishInternalTestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("appdata",null,d("WASmaxJsx").smax("test",{config:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutAppdataPublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutAppdataPublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.edgeIdArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishRequestIDMixin","WASmaxOutAppdataPublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutAppdataPublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutAppdataPublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutAppdataPublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutAppdataPublishWithDeviceListCheckMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.appdataDeviceListCheck;a=d("WASmaxJsx").smax("appdata",{device_list_check:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWithDeviceListCheckMixin=a}),98);
__d("WASmaxOutAppdataPublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishDeviceIdentityMixin","WASmaxOutAppdataPublishInternalTestMixin","WASmaxOutAppdataPublishTraceContextMixin","WASmaxOutAppdataPublishWithDeviceListCheckMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.withDeviceListCheckMixinArgs,f=a.internalTestMixinArgs;a=a.traceContextMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutAppdataPublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutAppdataPublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutAppdataPublishWithDeviceListCheckMixin").mergeWithDeviceListCheckMixin,b.optionalMerge(d("WASmaxOutAppdataPublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("appdata",null),c),e),f),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutAppdataPublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutAppdataPublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutAppdataPublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutAppdataPublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encVersionFutureproofMixinArgs;a=a.encTypeIndividualMixinArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").DEVICE_JID(b)},d("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(d("WASmaxJsx").smax("enc",null),c),a));return b}function i(a){var b=a.toArgs;a=a.appdataTo;a=d("WASmaxJsx").smax("appdata",{to:d("WAWap").USER_JID(a)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,b,1,24)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePeerPeerFanoutParticipantsTo=h;g.mergePeerPeerFanoutMixin=a}),98);
__d("WASmaxOutAppdataPublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutAppdataPublishRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.appdataT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("appdata",{t:d("WAWap").INT(b)},d("WASmaxOutAppdataPublishEncRetryMixin").mergeEncRetryMixin(d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WASmaxOutAppdataPublishRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.appdataTo,c=a.retryMixinArgs,e=a.encVersionFutureproofMixinArgs;a=a.encTypeIndividualMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutAppdataPublishRetryMixin").mergeRetryMixin,d("WASmaxJsx").smax("appdata",{to:d("WAWap").DEVICE_JID(b)},d("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(d("WASmaxJsx").smax("enc",null),e),a)),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerPeerSingleMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerFanoutOrPeerSingleMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishPeerPeerFanoutMixin","WASmaxOutAppdataPublishPeerPeerSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.peerPeerFanout)return d("WASmaxOutAppdataPublishPeerPeerFanoutMixin").mergePeerPeerFanoutMixin(a,b.peerPeerFanout);if(b.peerPeerSingle)return d("WASmaxOutAppdataPublishPeerPeerSingleMixin").mergePeerPeerSingleMixin(a,b.peerPeerSingle);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergePeerPeerFanoutOrPeerSingleMixinGroup=a}),98);
__d("WASmaxOutAppdataPublishPeerRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAppdataPublishBaseMixin","WASmaxOutAppdataPublishPeerPeerFanoutOrPeerSingleMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.appdataId,c=a.appdataPushPriority,e=a.peerPeerFanoutOrPeerSingleMixinGroupArgs;b=d("WASmaxOutAppdataPublishPeerPeerFanoutOrPeerSingleMixinGroup").mergePeerPeerFanoutOrPeerSingleMixinGroup(d("WASmaxOutAppdataPublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("appdata",{id:d("WAWap").STANZA_ID(b),category:"peer",push_priority:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a),e);return b}g.makePeerRequest=a}),98);
__d("WASmaxAppdataPublishPeerRPC",["WAComms","WASmaxInAppdataPublishPeerResponseNegative","WASmaxInAppdataPublishPeerResponseSuccess","WASmaxOutAppdataPublishPeerRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutAppdataPublishPeerRequest").makePeerRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInAppdataPublishPeerResponseNegative").parsePeerResponseNegative(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"PeerResponseNegative",value:g.value});case 7:h=d("WASmaxInAppdataPublishPeerResponseSuccess").parsePeerResponseSuccess(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"PeerResponseSuccess",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Peer",{Negative:g,Success:h}));case 11:case"end":return i.stop()}},null,this)}g.sendPeerRPC=a}),98);/*FB_PKG_DELIM*/
__d("WABulkSetRotateSenderKeyToTrueApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"bulkSetRotateSenderKeyToTrue",function(a){return function(b,c){return d("WADbPersonalSenderKeyStatusTxns").bulkSetRotateSenderKeyToTrueTxn(a,c).then(function(){})}});g.bulkSetRotateSenderKeyToTrue=a}),98);
__d("WAAlignChunkLengthsToMultipleOfAesBlockSize",[],(function(a,b,c,d,e,f){"use strict";function g(a){return parseInt((a+15)/16,10)*16}function a(a,b){var c=[],d=0,e=0,f=0;for(var h=0;h<a.length;++h){d+=a[h];if(h===a.length-1&&b!=null&&b>0){d>e?c.push(b-e):(c.pop(),c.push(b-f));break}else if(d>e){var i=g(d-e);f=e;c.push(i);e+=i}}return c}f.alignChunkSizeToMultipleAesBlockSize=g;f.alignChunkLengthsToMultipleOfAesBlockSize=a}),66);
__d("WAProgressiveJpegAlignScanLengths",["WAAlignChunkLengthsToMultipleOfAesBlockSize"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.scanLengths;a=a.totalEncryptedBytes;return d("WAAlignChunkLengthsToMultipleOfAesBlockSize").alignChunkLengthsToMultipleOfAesBlockSize(b.map(function(a){return a}),a).map(function(a){return a})}function b(a){return a}g.progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize=a;g.toProgressiveJpegAlignedScanLength=b}),98);
__d("WAProgressiveJpegGetPJpegDetails",["WAMediaCrypto","WAProgressiveJpegAlignScanLengths","WAProgressiveJpegGetScanLengths","WAResultOrError","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar size mismatch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar is missing"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar has an invalid length"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["WAProgressiveJpegDetails"]);function a(a){var b=a.progressiveJpegDetails;a=a.ciphertextLength;return babelHelpers["extends"]({},b,{alignedScanLengths:d("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:b.scanLengths,totalEncryptedBytes:a})})}function c(a,c,e){var f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:f=c.byteLength-d("WAMediaCrypto").IV_LENGTH;g=d("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(a);h=d("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:g,totalEncryptedBytes:f});j.next=5;return b("regeneratorRuntime").awrap(l(h,c,e));case 5:i=j.sent;return j.abrupt("return",{scanLengths:g,sidecar:i});case 7:case"end":return j.stop()}},null,this)}function l(a,c,e){var f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:f=new Uint8Array(a.length*10),g=0,h=0,i=c.slice(0,16),j=c.slice(16),k=0;case 6:if(!(k<a.length)){o.next=19;break}l=a[k];h=g+l;m=j.subarray(g,h);o.next=12;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").hmacCiphertext(e,i,m));case 12:n=o.sent.slice(0,10),f.set(new Uint8Array(n),k*10),i=m.slice(m.length-16,m.length),g=h;case 16:k++;o.next=6;break;case 19:return o.abrupt("return",f.buffer);case 20:case"end":return o.stop()}},null,this)}function m(a){if(a.sidecar.byteLength%d("WAMediaCrypto").HMAC_LENGTH!==0){k.ERROR(j());return d("WAResultOrError").makeError("pjpeg-check-sidecar-invalid-length")}if(a.scanLengths.length>0&&a.sidecar.byteLength===0){k.ERROR(i());return d("WAResultOrError").makeError("pjpeg-check-no-sidecar")}if(a.scanLengths.length===0)return d("WAResultOrError").makeResult(!1);if(a.scanLengths.length*d("WAMediaCrypto").HMAC_LENGTH!==a.sidecar.byteLength){k.ERROR(h());return d("WAResultOrError").makeError("pjpeg-check-scan-length-mismatch")}return d("WAResultOrError").makeResult(!0)}function e(a,b){var c=0;if(b===0)return 0;for(var d=0;d<b;d++){var e=a[d];e!=null&&(c+=e)}return c}function f(a){a=a.progressiveJpegDetails;if(a==null)return d("WAResultOrError").makeResult(null);var b=m(a);if(b.success===!1)return b;return b.value===!0?d("WAResultOrError").makeResult({scanLengths:a.scanLengths,sidecar:a.sidecar}):d("WAResultOrError").makeResult(null)}g.getExtendedProgressiveJpegDetails=a;g.getProgressiveJpegDetails=c;g.isValidProgressiveJpegDetails=m;g.getTotalByteSizeForScan=e;g.maybeGetProgressiveJpegDetailsUsingMediaEntry=f}),98);
__d("WADownloadDownloadablePreview",["WADownloadMedia","WAGetPlatformFromStanzaId","WAGlobals","WAJids","WAMediaCrypto","WAPREList","WAPREMetrics","WAProgressiveJpegGetPJpegDetails","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished downloading"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed to download media. Reason: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type "," - ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - mediaEntryData "," is incomplete for media preview"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadableThumbnail exists. Attempting to download."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping downloadablePreview for progressive jpeg"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["No downloadableThumbnail. Skipping..."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_available: ",""]);o=function(){return a};return a}var p=d("WADownloadMedia").mediaDownloadLogger.TAGS(["DownloadDownloadablePreview"]);function a(a,b,c,d,e){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g=f.getMediaPlaintext,q=f.handleMediaPreviewBeforeDownload;f=f.updateMediaEntryForMsg;var r=e.downloadableThumbnail,s=r==null?void 0:r.directPath,t=s!=null,u=d("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(e);u=u.success===!0?u.value:null;p.LOG(o(),t);if(r==null||s==null){p.LOG(n());return null}if(u!=null&&e.serverMediaType==="image"&&d("WAGlobals").getConfig().skipDownloadablePreviewForProgressiveJpeg()){p.LOG(m());return null}p.LOG(l());t=r.fileEncSha256;var v=r.fileSha256,w=r.mediaKey;r=r.objectId;var x=d("WAJids").switchOnMsgrChatJidType(a.chat,{group:function(){return"group"},user:function(){return"user"}});u=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{duplicateDirectPath:s===e.directPath,isMediaFallbackToAlternativeHmacSaltsEnabled:d("WAGlobals").getConfig().isMediaFallbackToAlternativeHmacSaltsEnabled(),isPreview:!0,isProgressiveJpeg:u!=null},string:{chat_type:x,downloadEntry:"downloadable-preview",e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.externalId),mediaType:e.serverMediaType}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);u.addPoint("wa_protocol_media_download_start");if(s==null||t==null||v==null||w==null){p.ERROR(k(),e);u.addPoint("wa_protocol_media_download_fail");u.endFail("preview-incomplete-media-entry");return}var y;try{y=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(c)}catch(a){p.ERROR(j(),c,a);u.addPoint("wa_protocol_media_download_fail");u.endFail("preview-unsupported-type");return}yield q(b);x=(yield d("WADownloadMedia").downloadMediaImpl(a,b,u,{messageType:y,type:"preview"},s,t,v,w,r,null,e,{getMediaPlaintext:g,updateMediaEntryForMsg:f}));if(x.success===!1)p.WARN(i(),x.error),u.addPoint("wa_protocol_media_download_fail"),u.endFail(x.error);else{p.LOG(h());u.addPoint("wa_protocol_media_download_end");u.endSuccess();return x.value}});return q.apply(this,arguments)}g.maybeDownloadDownloadablePreview=a}),98);
__d("WADecryptMedia",["WAGlobals","WAMediaCrypto","WAResultOrError","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Success"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Using default plaintext verifier"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose([""," is not a working hmac salt."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found a working hmac salt using ","."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying "," as an alternative hmac salt."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encountered enc-hash-mismatch - looking for a potential working hmac salt"]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["WADecryptMedia"]);function p(a,c,e,f){var g,h,i,j,p,q,r,s,t,u,v;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:o.WARN(n());g=e.type==="preview"?"preview":e.mediaType;w.next=4;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").deprecated_getAllCommonComputedMediaKeys(f));case 4:h=w.sent,(j=h,p=Array.isArray(j),q=0,j=p?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 6:if(!p){w.next=12;break}if(!(q>=j.length)){w.next=9;break}return w.abrupt("break",39);case 9:r=j[q++];w.next=16;break;case 12:q=j.next();if(!q.done){w.next=15;break}return w.abrupt("break",39);case 15:r=q.value;case 16:s=r;t=s[0];u=s[1];w.prev=19;if(!(t===g)){w.next=22;break}return w.abrupt("continue",37);case 22:o.LOG(m(),t);w.t0=d("WAResultOrError").makeResult;w.next=26;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").hmacAndDecrypt(u.cipherKey,u.iv,a,u.hmacKey,c));case 26:w.t1=w.sent;v=w.t0(w.t1);i={hmacAndDecryptResult:v,alternativeHmacSaltUsed:t};o.LOG(l(),t);return w.abrupt("return",i);case 33:w.prev=33;w.t2=w["catch"](19);o.LOG(k(),t);return w.abrupt("continue",37);case 37:w.next=6;break;case 39:return w.abrupt("return",{hmacAndDecryptResult:d("WAResultOrError").makeError("enc-hash-mismatch")});case 40:case"end":return w.stop()}},null,this,[[19,33]])}function a(a){var c,e,f,g,k,l,m,n,q,r,s,t,u,v;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:c=a.ciphertextHmac,e=a.mediaKey,f=a.mediaTypeDetails,g=a.plaintextHash;o.LOG(j());k=c.byteLength-d("WAMediaCrypto").HMAC_LENGTH;l=new Uint8Array(c,k);m=new Uint8Array(c,0,k);f.type==="preview"?n=d("WAMediaCrypto").computeMediaKeysForPreview(e):n=d("WAMediaCrypto").computeMediaKeys(e,f.mediaType);r=null;w.next=9;return b("regeneratorRuntime").awrap(n.then(function(a){var b=a.iv,c=a.cipherKey;a=a.hmacKey;return d("WAMediaCrypto").hmacAndDecrypt(c,b,m,a,l)}).then(d("WAResultOrError").makeResult)["catch"](function(a){o.ERROR(i(),a);if(a instanceof d("WAMediaCrypto").HmacValidationError)return d("WAResultOrError").makeError("enc-hash-mismatch");else return d("WAResultOrError").makeError("decryption-error")}));case 9:q=w.sent;if(!(d("WAGlobals").getConfig().isMediaFallbackToAlternativeHmacSaltsEnabled()===!0&&q.success===!1&&q.error==="enc-hash-mismatch")){w.next=16;break}w.next=13;return b("regeneratorRuntime").awrap(p(m,l,f,e));case 13:s=w.sent,q=s.hmacAndDecryptResult,r=s.alternativeHmacSaltUsed;case 16:if(q.success){w.next=18;break}return w.abrupt("return",q);case 18:t=q.value,u=t.plaintext,v=t.plaintextHash;if(!(g!==v)){w.next=21;break}return w.abrupt("return",d("WAResultOrError").makeError("hash-mismatch"));case 21:o.LOG(h());return w.abrupt("return",d("WAResultOrError").makeResult({plaintext:u,alternativeHmacSaltUsed:r}));case 23:case"end":return w.stop()}},null,this)}g.decryptMedia=a}),98);
__d("WADecimalStringMod",["WAErr","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string']);i=function(){return a};return a}function a(a,b){if(!/^\d+$/.test(a)){d("WALogger").ERROR(i(),a);throw c("WAErr")("decimalStringMod is given an invalid decimal string")}var e=a.length;if(e<16||e===16&&a<="9007199254740991")return Number(a)%b;if(e>20||e===20&&a>"18446744073709551615"){d("WALogger").ERROR(h(),a);throw c("WAErr")("decimalStringMod is given value over 64 bits")}e=0;for(var f=0;f<a.length;f++){var g=Number(a[f]);e=(e*10+g)%b}return e}g.decimalStringMod=a}),98);
__d("WACreateGetVcaEnabledBucket",["WAArrayBufferUtils","WADecimalStringMod","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaRouteSelection: can't get fbId from mediaDirectPath"]);h=function(){return a};return a}function a(a,b){return function(){return b==null?null:d("WAArrayBufferUtils").arrayBufferMod(a,b)+100}}function b(a,b){return function(){if(b==null)return null;var c=a.split("/");c=c[c.length-1];c=c.split("_")[1];if(!/^\d+$/.test(c))return null;if(c==null){d("WALogger").ERROR(h());return null}else return d("WADecimalStringMod").decimalStringMod(c,b)+100}}g.createGetVcaEnabledBucket=a;g.msgrCreateGetVcaEnabledBucket=b}),98);
__d("WAExtractNcHotTimestamp",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return null;a=h(a);if(a.has("_nc_hot")){a=parseInt(a.get("_nc_hot"),10);return Number.isInteger(a)?d("WATimeUtils").castToUnixTime(a):null}else return null}function h(a){a=a.split("?");return new URLSearchParams(a.length===2?a[1]:"")}g.extractNcHotTimestamp=a}),98);
__d("WAMediaConnParser",["WADeprecatedWapParser","WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";a=new(c("WADeprecatedWapParser"))("mediaConnParser",function(a){a=a.child("media_conn");var b=j(a);return{hosts:b,authToken:a.attrString("auth"),authTokenExpiryTs:a.attrFutureTime("auth_ttl"),routesExpiryTs:a.attrFutureTime("ttl"),maxBuckets:a.attrInt("max_buckets"),maxManualRetry:(b=a.maybeAttrInt("max_manual_retry",0,4))!=null?b:3,maxAutoDownloadRetry:(b=a.maybeAttrInt("max_auto_download_retry",0,4))!=null?b:3}});function h(a){var b;return!a.hasAttr("fallback_hostname")?void 0:{domain:a.attrString("fallback_hostname"),"class":a.maybeAttrString("fallback_class"),ip4:(b=a.maybeAttrString("fallback_ip4"))!=null?b:void 0,ip6:(b=a.maybeAttrString("fallback_ip6"))!=null?b:void 0}}function i(a){var b;return{domain:a.attrString("hostname"),fallback:h(a),uploadable:k(a,"upload"),downloadable:k(a,"download"),isFallback:a.maybeAttrString("type")==="fallback",downloadBuckets:(b=(b=a.maybeChild("download_buckets"))==null?void 0:b.mapChildren(function(a){return parseInt(a.tag(),10)}))!=null?b:[],"class":a.maybeAttrString("class"),ip4:(b=a.maybeAttrString("ip4"))!=null?b:void 0,ip6:(b=a.maybeAttrString("ip6"))!=null?b:void 0}}function j(a){return a.mapChildrenWithTag("host",i)}function k(a,b){if(a.hasChild(b))return a.child(b).mapChildren(function(a){a=a.tag();return d("WAServerMediaType").castToServerMediaType(a)}).filter(Boolean);else return d("WAServerMediaType").SERVER_MEDIA}g.mediaConnParser=a}),98);
__d("WAGatherMediaInfo",["WADeprecatedSendIq","WAErrors","WALogger","WAMediaConnParser","WAPromiseManagement","WAPromiseRetryLoop","WAResultOrError","WAWap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," hosts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got client error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," seconds backoff"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo failure ",""]);l=function(){return a};return a}var m=507;b=d("WAPromiseManagement").cacheWhilePending(function(){return"gatherMediaInfo"},a);function a(){var a=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"gatherMediaInfo",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:o});a.start();return a.promise()}var n=60;function o(a){var b;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:b.generateId()},b.wap("media_conn",null));return d("WADeprecatedSendIq").deprecatedSendIqIfConnectedWithin(b,d("WAMediaConnParser").mediaConnParser,n).then(function(b){if(!b.success){d("WALogger").LOG(l(),b);if(b.errorCode===m){var c=b.errorBackoff;d("WALogger").LOG(k(),c);a(d("WAResultOrError").makeError({type:"backoff",backoffMs:c*1e3}))}else b.errorCode<500&&(d("WALogger").LOG(j(),b.errorCode),a(d("WAResultOrError").makeError({type:"client-error",code:b.errorCode,text:b.errorText})))}else d("WALogger").LOG(i(),b.result.hosts.length),a(d("WAResultOrError").makeResult(b.result))})["catch"](function(b){b instanceof d("WAErrors").Disconnected?a(d("WAResultOrError").makeError("disconnected")):d("WALogger").ERROR(h(),b)})}g.gatherMediaInfo=b}),98);
__d("WAMediaRouteSelection",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=null,c=null,e=null,f=a.hosts,g=a.operation,h=a.mediaType;if(a.operation==="download"){var i=a.catHotTimespan,j=a.ncHot;a=a.getVcaEnabledBucket;var k=new Map();f.forEach(function(a){a.downloadBuckets.forEach(function(b){k.set(b,a)})});var l=k.get(0);i>0&&j!=null&&d("WATimeUtils").happenedWithin(d("WATimeUtils").castToUnixTime(j),i)?b=1:a&&(b=a());j=null;b!=null&&(j=k.get(b));((i=j)==null?void 0:i.downloadable.includes(h))?c=j:(l==null?void 0:l.downloadable.includes(h))&&(c=l)}for(a=0;a<f.length;a++){i=f[a];g==="upload"&&i.uploadable.includes(h)?c==null?c=i:i.isFallback&&e==null&&(e=i):g==="download"&&i.downloadable.includes(h)&&(c==null?c=i:i.isFallback&&e==null&&(e=i));if(c!=null&&e!=null)break}return{selectedHost:c,fallbackHost:e,bucket:b}}g.mediaRouteSelection=a}),98);
__d("WAGetMediaRoute",["$InternalEnum","Promise","WACreateGetVcaEnabledBucket","WAExtractNcHotTimestamp","WAGatherMediaInfo","WAMediaRouteSelection","WAPromiseManagement","WAResultOrError","WATagsLogger","WATimeUtils","WAWorkerGlobalScope","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error occurred on gather after backoff expiry: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Can not get mediaAccess: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, gather a new one"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, but we are still locked by backoff"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error occurred during authTTL automatic refresh: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["AuthTTL approaching expiry, refreshing MediaAccess routes"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error: no media host"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get mediaAccess: ",""]);p=function(){return a};return a}var q=d("WATagsLogger").TAGS(["GetMediaRoute"]),r=!0,s=86400,t=b("$InternalEnum")({Fresh:"fresh",Cached:"cached",Stale:"stale"}),u=null,v=!1,w=null;function a(a,c){var e,f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return b("regeneratorRuntime").awrap(A());case 2:e=n.sent;if(e.success){n.next=7;break}q.ERROR(p(),e.error);c==null?void 0:c.addPoint("get_media_access_failed",{string:{mediaAccessStatus:e.error}});return n.abrupt("return",e);case 7:c==null?void 0:c.addAnnotations({string:{mediaAccessStatus:e.value.state}});f=e.value.mediaAccess,g=f.authToken,h=f.hosts,i=f.maxBuckets;j=a.operation==="upload"?d("WAMediaRouteSelection").mediaRouteSelection({operation:"upload",mediaType:a.serverMediaType,hosts:h}):d("WAMediaRouteSelection").mediaRouteSelection({operation:"download",mediaType:a.serverMediaType,hosts:h,catHotTimespan:s,ncHot:d("WAExtractNcHotTimestamp").extractNcHotTimestamp(a.directPath),getVcaEnabledBucket:r?d("WACreateGetVcaEnabledBucket").msgrCreateGetVcaEnabledBucket(a.directPath,i):void 0}),k=j.selectedHost,l=j.fallbackHost,m=j.bucket;if(!(k==null)){n.next=13;break}q.ERROR(o());return n.abrupt("return",d("WAResultOrError").makeError("no-host"));case 13:return n.abrupt("return",d("WAResultOrError").makeResult({authToken:g,selectedHost:k,fallbackHost:l,bucket:m}));case 14:case"end":return n.stop()}},null,this)}function x(){var a=w;a!=null&&(d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(a),w=null)}function y(a){x();var b=Math.max(a.authTokenExpiryTs-d("WATimeUtils").unixTime(),0);if(b<=5*60)return;var c=d("WATimeUtils").pastUnixTime(5*60,a.authTokenExpiryTs);b=d("WATimeUtils").pastUnixTime(Math.floor(b*.2),a.authTokenExpiryTs);a=c<b?c:b;c=d("WATimeUtils").cappedMillisecondsUntil(a);b=Math.floor(Math.random()*d("WATimeUtils").MINUTE_MILLISECONDS);a=d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){q.LOG(n()),z()["catch"](function(a){q.ERROR(m(),a)})},c+b);w=a}var z=d("WAPromiseManagement").cacheWhilePending(function(){return"all"},function(){var a,c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!v){f.next=3;break}q.LOG(l());return f.abrupt("return",d("WAResultOrError").makeError("backoff"));case 3:q.LOG(k());x();f.next=7;return b("regeneratorRuntime").awrap(d("WAGatherMediaInfo").gatherMediaInfo());case 7:a=f.sent;if(!a.success){f.next=14;break}u=a.value;y(a.value);return f.abrupt("return",d("WAResultOrError").makeResult({mediaAccess:a.value,state:t.Fresh}));case 14:c=a.error;e=c==="disconnected"?"disconnected":c.type;q.WARN(j(),e);if(!(c==="disconnected"||c.type==="client-error")){f.next=21;break}return f.abrupt("return",d("WAResultOrError").makeError("disconnected"));case 21:c.type;v=!0;d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){v=!1,z()["catch"](function(a){q.ERROR(i(),a)})},c.backoffMs);return f.abrupt("return",d("WAResultOrError").makeError("backoff"));case 25:case"end":return f.stop()}},null,this)}),A=function(){var a=u;if(a==null)return z();if(d("WATimeUtils").isInFuture(a.routesExpiryTs))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({mediaAccess:a,state:t.Cached}));var c=z();return d("WATimeUtils").isInFuture(a.authTokenExpiryTs)?(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({mediaAccess:a,state:t.Stale})):c};function c(){u=null,v=!1,x()}g.getMediaRoute=a;g.clearCachedMediaAccessForTest=c}),98);
__d("WAMediaOperationsRetrier",["WALogger","WAPromiseBackoffs","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MediaOperationsRetrier:"," wait for internet, attempt = ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running retrier"]);i=function(){return a};return a}var j=4,k={algo:{type:"constant",delay:1e3},jitter:0};a=function(){function a(a,b,c){this.$1=a,this.routesInfo=b,this.$2=d("WAPromiseBackoffs").createPromiseTimer(k),this.$3=0,this.$4=!1,this.$5=c}var c=a.prototype;c.run=function(a,c){var e,f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:if(!(this.$3<j)){l.next=29;break}d("WALogger").DEV(i());l.next=4;return b("regeneratorRuntime").awrap(this.$2());case 4:e=void 0;if(!(this.$3>0)){l.next=12;break}e=this.$3>=j-2&&!this.$4;d("WALogger").LOG(h(),this.$1,this.$3);l.next=10;return b("regeneratorRuntime").awrap(this.$5==null?void 0:this.$5());case 10:l.next=13;break;case 12:e=!1;case 13:f=this.routesInfo;if(f){l.next=16;break}return l.abrupt("return",null);case 16:g=f.host;e&&f.fallbackHost&&(g=f.fallbackHost);l.next=20;return b("regeneratorRuntime").awrap(a(g,f.authToken,this.$3,c));case 20:k=l.sent;if(!k.success){l.next=25;break}return l.abrupt("return",k.value);case 25:++this.$3,this.$4=k.error.progressMade;case 27:l.next=0;break;case 29:return l.abrupt("return",null);case 30:case"end":return l.stop()}},null,this)};return a}();g.MAX_ATTEMPTS=j;g.BACKOFF_OPTIONS=k;g.MediaOperationsRetrier=a}),98);
__d("WACreateMediaDownloadRetrier",["WAComms","WAGetMediaRoute","WAGlobals","WAMediaOperationsRetrier","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c,e,f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:c=a.directPath,e=a.eventFlow,f=a.fileEncSha256,g=a.mediaTypeDetails;h=g.type==="regular"?g.mediaType:"preview";e==null?void 0:e.addPoint("get_media_route_start");o.next=5;return b("regeneratorRuntime").awrap(d("WAGetMediaRoute").getMediaRoute({operation:"download",serverMediaType:h,fileEncSha256:f,directPath:c},e));case 5:i=o.sent;e==null?void 0:e.addPoint("get_media_route_finish");if(i.success){o.next=9;break}return o.abrupt("return",i);case 9:j=i.value,k=j.selectedHost,l=j.fallbackHost,m=j.authToken;n=new(d("WAMediaOperationsRetrier").MediaOperationsRetrier)("download",{host:{domain:k.domain,"class":k["class"]},fallbackHost:l&&{domain:l.domain,"class":l["class"]},authToken:m,timeElapsed:null},d("WAGlobals").getConfig().isMediaWaitForConnectionOnRetryEnabled()===!0?d("WAComms").waitForConnection:void 0);return o.abrupt("return",d("WAResultOrError").makeResult({retrier:n,mediaRouteDetails:i.value}));case 12:case"end":return o.stop()}},null,this)}g.createMediaDownloadRetrier=a}),98);
__d("WASmaxInMmsdIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInMmsdEnums",[],(function(a,b,c,d,e,f){a={0:"0",1:"1"};b={400:"400",401:"401",404:"404",408:"408",409:"409",415:"415",426:"426",429:"429"};c={500:"500",501:"501",502:"502",503:"503",507:"507"};d={fallback:"fallback",primary:"primary"};e={"false":"false","true":"true"};var g={fna:"fna",pop:"pop"};f.ENUM_0_1=a;f.ENUM_400_401_404_408_409_415_426_429=b;f.ENUM_500_501_502_503_507=c;f.ENUM_FALLBACK_PRIMARY=d;f.ENUM_FALSE_TRUE=e;f.ENUM_FNA_POP=g}),66);
__d("WASmaxInMmsdRequestErrorMixin",["WAResultOrError","WASmaxInMmsdEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;var c=d("WASmaxParseUtils").attrStringEnum(a,"code",d("WASmaxInMmsdEnums").ENUM_400_401_404_408_409_415_426_429);if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"backoff",0,10800);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:c.value,backoff:a.value})}g.parseRequestErrorMixin=a}),98);
__d("WASmaxInMmsdResignCdnUrlResponseClientError",["WAResultOrError","WASmaxInMmsdIQErrorResponseMixin","WASmaxInMmsdRequestErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInMmsdRequestErrorMixin").parseRequestErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInMmsdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorRequestErrorMixin:c.value},a.value))}g.parseResignCdnUrlResponseClientError=a}),98);
__d("WASmaxInMmsdServerErrorMixin",["WAResultOrError","WASmaxInMmsdEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;var c=d("WASmaxParseUtils").attrStringEnum(a,"code",d("WASmaxInMmsdEnums").ENUM_500_501_502_503_507);if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"backoff",0,10800);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:c.value,backoff:a.value})}g.parseServerErrorMixin=a}),98);
__d("WASmaxInMmsdResignCdnUrlResponseServerError",["WAResultOrError","WASmaxInMmsdIQErrorResponseMixin","WASmaxInMmsdServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInMmsdServerErrorMixin").parseServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInMmsdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorServerErrorMixin:c.value},a.value))}g.parseResignCdnUrlResponseServerError=a}),98);
__d("WASmaxInMmsdIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInMmsdResignCdnUrlResponseSuccess",["WAResultOrError","WASmaxInMmsdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"cdn_url_resign");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(c.value,"direct_path");if(!c.success)return c;a=d("WASmaxInMmsdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({cdnUrlResignDirectPath:c.value},a.value))}g.parseResignCdnUrlResponseSuccess=a}),98);
__d("WASmaxOutMmsdBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutMmsdIQRequestCommonMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{xmlns:"w:m",to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIQRequestCommonMixin=a}),98);
__d("WASmaxOutMmsdResignCdnUrlResignWithHandleParamsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.cdnUrlResignHandle;a=d("WASmaxJsx").smax("cdn_url_resign",{handle:d("WAWap").CUSTOM_STRING(a),use_case_hint:"wa_stickers"});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeResignCdnUrlResignWithHandleParamsMixin=a}),98);
__d("WASmaxOutMmsdResignCdnUrlResignWithObjectIdAndFBIdParamsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.cdnUrlResignFbid;a=a.cdnUrlResignObjectId;b=d("WASmaxJsx").smax("cdn_url_resign",{fbid:d("WAWap").CUSTOM_STRING(b),object_id:d("WAWap").CUSTOM_STRING(a),use_case_hint:"fb_encrypted_backup"});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeResignCdnUrlResignWithObjectIdAndFBIdParamsMixin=a}),98);
__d("WASmaxOutMmsdResignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMmsdResignCdnUrlResignWithHandleParamsMixin","WASmaxOutMmsdResignCdnUrlResignWithObjectIdAndFBIdParamsMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.resignCdnUrlResignWithObjectIdAndFBIdParams)return d("WASmaxOutMmsdResignCdnUrlResignWithObjectIdAndFBIdParamsMixin").mergeResignCdnUrlResignWithObjectIdAndFBIdParamsMixin(a,b.resignCdnUrlResignWithObjectIdAndFBIdParams);if(b.resignCdnUrlResignWithHandleParams)return d("WASmaxOutMmsdResignCdnUrlResignWithHandleParamsMixin").mergeResignCdnUrlResignWithHandleParamsMixin(a,b.resignCdnUrlResignWithHandleParams);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeResignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroup=a}),98);
__d("WASmaxOutMmsdResignCdnUrlResignParamsMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMmsdResignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.resignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroupArgs;a=d("WASmaxOutMmsdResignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroup").mergeResignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroup(d("WASmaxJsx").smax("cdn_url_resign",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeResignCdnUrlResignParamsMixin=a}),98);
__d("WASmaxOutMmsdResignCdnUrlRequest",["WASmaxJsx","WASmaxOutMmsdBaseIQGetRequestMixin","WASmaxOutMmsdIQRequestCommonMixin","WASmaxOutMmsdResignCdnUrlResignParamsMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.cdnUrlResignSignDuration;a=a.resignCdnUrlResignParamsMixinArgs;b=d("WASmaxOutMmsdIQRequestCommonMixin").mergeIQRequestCommonMixin(d("WASmaxOutMmsdBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxOutMmsdResignCdnUrlResignParamsMixin").mergeResignCdnUrlResignParamsMixin(d("WASmaxJsx").smax("cdn_url_resign",{sign_duration:d("WAWap").INT(b)}),a))));return b}g.makeResignCdnUrlRequest=a}),98);
__d("WASmaxMmsdResignCdnUrlRPC",["WAComms","WASmaxInMmsdResignCdnUrlResponseClientError","WASmaxInMmsdResignCdnUrlResponseServerError","WASmaxInMmsdResignCdnUrlResponseSuccess","WASmaxOutMmsdResignCdnUrlRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutMmsdResignCdnUrlRequest").makeResignCdnUrlRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInMmsdResignCdnUrlResponseSuccess").parseResignCdnUrlResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"ResignCdnUrlResponseSuccess",value:g.value});case 7:h=d("WASmaxInMmsdResignCdnUrlResponseClientError").parseResignCdnUrlResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"ResignCdnUrlResponseClientError",value:h.value});case 10:i=d("WASmaxInMmsdResignCdnUrlResponseServerError").parseResignCdnUrlResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"ResignCdnUrlResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ResignCdnUrl",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendResignCdnUrlRPC=a}),98);
__d("WAGetResignedCdnUrl",["WAAssertUnreachable","WAErrorMessage","WALogger","WAPromiseRetryLoop","WAResultOrError","WASmaxMmsdResignCdnUrlRPC","WASmaxParsingFailure"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestCdnResignedUrl - Unknown Error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestCdnResignedUrl - Error thrown whilst parsing SMAX response - ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Direct path signature expired. objectId: ",", fbid: ","."]);j=function(){return a};return a}var k="507",l=259200;function a(a){var b=a.objectId;a=a.fbid;b=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"requestCdnResignedUrl",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:m({objectId:b,fbid:a})});b.start();return b.promise()}function m(a){var b=a.objectId,e=a.fbid;return function(a){d("WALogger").LOG(j(),b,e);return d("WASmaxMmsdResignCdnUrlRPC").sendResignCdnUrlRPC({cdnUrlResignSignDuration:l,resignCdnUrlResignParamsMixinArgs:{resignWithResignCdnUrlObjectIdAndFBIdOrResignCdnUrlHandleParamsMixinGroupArgs:{resignCdnUrlResignWithObjectIdAndFBIdParams:{cdnUrlResignFbid:e,cdnUrlResignObjectId:b}}}}).then(function(b){switch(b.name){case"ResignCdnUrlResponseSuccess":return a(d("WAResultOrError").makeResult({directPath:b.value.cdnUrlResignDirectPath}));case"ResignCdnUrlResponseClientError":return a(d("WAResultOrError").makeError({type:"client-error",text:b.value.errorRequestErrorMixin.text}));case"ResignCdnUrlResponseServerError":if(b.value.errorServerErrorMixin.code!==k)return;return a(d("WAResultOrError").makeError({type:"server-error",text:b.value.errorServerErrorMixin.text,backoff:b.value.errorServerErrorMixin.backoff}));default:throw c("WAAssertUnreachable")(b.name)}})["catch"](function(b){var c=d("WAErrorMessage").maybeGetMessageFromError(b);if(b instanceof d("WASmaxParsingFailure").SmaxParsingFailure){d("WALogger").ERROR(i(),c);return a(d("WAResultOrError").makeError({type:"smax-parsing-error"}))}else{d("WALogger").ERROR(h(),c);return}})}}g.getCdnResignedUrl=a}),98);
__d("WAHttpDownloadMedia",["WAErrorMessage","WALogger","WAMediaQplHelper","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: can not resume from offset"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to initiate fetch: ",", message: ",""]);k=function(){return a};return a}var l="URL signature expired";function a(a,c){var e,f,g,m,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:f=(e=c)!=null?e:{},g=f.mediaMetrics,m=f.abortSignal;s.prev=1;g==null?void 0:g.addPoint("http_fetch_start");s.next=5;return b("regeneratorRuntime").awrap(self.fetch(a,{method:"GET",mode:"cors",cache:"no-store",signal:m}));case 5:n=s.sent;g==null?void 0:g.addPoint("http_fetch_end");s.next=16;break;case 9:s.prev=9;s.t0=s["catch"](1);g==null?void 0:g.addPoint("http_fetch_fail");o=d("WAErrorMessage").maybeGetMessageFromError(s.t0);d("WALogger").WARN(k(),s.t0,o);g==null?void 0:g.addAnnotations({bool:{threwFetchError:!0}});return s.abrupt("return",d("WAResultOrError").makeError("http-fetch-exception"));case 16:p=n.headers.get("content-length");q=n,r=q.status;d("WALogger").LOG(j(),r);g==null?void 0:g.addAnnotations({string:{ciphertextMediaSizeBucket:p!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(Number(p)):null},"int":{httpStatus:r}});s.t1=r;s.next=s.t1===200?23:s.t1===206?23:s.t1===401?24:s.t1===403?25:s.t1===404?26:s.t1===410?26:s.t1===408?27:s.t1===416?28:s.t1===429?30:s.t1===507?30:31;break;case 23:return s.abrupt("return",d("WAResultOrError").makeResult(n));case 24:return s.abrupt("return",d("WAResultOrError").makeError("access-expired"));case 25:return s.abrupt("return",n.text().then(function(a){return a===l?d("WAResultOrError").makeError("signature-expired"):d("WAResultOrError").makeError("access-expired")})["catch"](function(a){d("WALogger").ERROR(i(),a);return d("WAResultOrError").makeError("access-expired")}));case 26:return s.abrupt("return",d("WAResultOrError").makeError("media-not-found"));case 27:return s.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 28:d("WALogger").ERROR(h());return s.abrupt("return",d("WAResultOrError").makeError("request-error"));case 30:return s.abrupt("return",d("WAResultOrError").makeError("download-throttled"));case 31:if(!(r>=400&&r<500)){s.next=33;break}return s.abrupt("return",d("WAResultOrError").makeError("request-error"));case 33:return s.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 34:case"end":return s.stop()}},null,this,[[1,9]])}g.httpDownloadMedia=a}),98);
__d("WAHttpUtils",["WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){if(!/^https:\/\/[-\w.]+\.\w+$/.test(a))throw c("WAErr")('buildUrl given invalid host "'+a+'"');if(!b.startsWith("/"))throw c("WAErr")('buildUrl given invalid path "'+b+'"');var e=d;d=""+a+b;if(!e)return d;a=Object.keys(e).map(function(a){var b=e[a];b instanceof ArrayBuffer&&(b=new Uint8Array(b));b=b instanceof Uint8Array?Array.prototype.slice.call(b).map(function(a){return"%"+a.toString(16)}).join(""):encodeURIComponent(b.toString());return encodeURIComponent(a)+"="+b});if(a.length>0){b=a.join("&");return d.includes("?")?d+"&"+b:d+"?"+b}else return d}g.buildUrl=a}),98);
__d("WAMediaUrl",["WABase64","WAGlobals","WAHttpUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function a(a,b,c,e,f,g,i){var j=d("WAGlobals").getDependencies().mediaUploadRoot();c=d("WABase64").encodeB64UrlSafe(c);b=d("WABase64").encodeB64UrlSafe(b);f={auth:f,token:b};g&&(f.resume=h);i!=null&&i>0&&(f.bytestart=i);return d("WAHttpUtils").buildUrl("https://"+e,j+"/"+a+"/"+c,f)}function b(a,b,c,e,f,g,h){b=d("WABase64").encodeB64UrlSafe(b);b={hash:b,mode:e};f!=null&&(b._nc_cat=f);g!=null&&g>=0&&(b.bytestart=g);h!=null&&h>0&&(b.byteend=h);return d("WAHttpUtils").buildUrl("https://"+c,a,b)}g.RESUME_PARAM=h;g.buildUploadUrl=a;g.buildDownloadUrl=b}),98);
__d("WADownloadCiphertext",["WAAssertUnreachable","WABase64","WACreateMediaDownloadRetrier","WACryptoSha256","WACryptoUtils","WAGetResignedCdnUrl","WAHashUtils","WAHttpDownloadMedia","WALogger","WAMediaUrl","WAPromiseDelays","WAPromiseManagement","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext failed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia given up"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadCiphertext http download exception: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["result to generate a new cdn url was throttled (507)"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate a new cdn url: missing objectId or fbid"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Downloading ciphertext for hash: ",""]);o=function(){return a};return a}function a(a){var e,f,g,q,r,s,t,u,v,w,x,y,z,A,B,C,D;return b("regeneratorRuntime").async(function(E){while(1)switch(E.prev=E.next){case 0:e=a.mediaTypeDetails,f=a.fileEncSha256,g=a.directPath,q=a.plaintextHash,r=a.objectId,s=a.fbid,t=a.pathRedirected,u=a.eventFlow,v=a.fromBytes,w=a.toBytes;d("WALogger").LOG(o(),d("WAHashUtils").sanitisePlaintextHash(q));E.next=4;return b("regeneratorRuntime").awrap(d("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({mediaTypeDetails:e,directPath:g,eventFlow:u,fileEncSha256:f}));case 4:x=E.sent;if(x.success){E.next=7;break}return E.abrupt("return",x);case 7:y=x.value,z=y.retrier,A=y.mediaRouteDetails;E.next=10;return b("regeneratorRuntime").awrap(z.run(function(a){a=a.domain;a=d("WAMediaUrl").buildDownloadUrl(g,f,a,"manual",A.bucket,v,w);u==null?void 0:u.addPoint("http_download_media_start");return d("WAHttpDownloadMedia").httpDownloadMedia(a,{mediaMetrics:u}).then(function(c){var a,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!c.success){i.next=4;break}return i.abrupt("return",c.value.arrayBuffer().then(function(a){u==null?void 0:u.addPoint("http_download_media_end");return d("WAResultOrError").makeResult(d("WAResultOrError").makeResult(a))})["catch"](function(a){u==null?void 0:u.addPoint("response_array_buffer_error");d("WALogger").ERROR(n(),a);return d("WAResultOrError").makeResult(d("WAResultOrError").makeError("body-network-error"))}));case 4:u==null?void 0:u.addPoint("http_download_media_fail");a=c.error;d("WALogger").LOG(m(),a);i.t0=a;i.next=i.t0==="signature-expired"?10:i.t0==="http-fetch-exception"?38:i.t0==="server-timeout"?38:i.t0==="unspecified-http-error"?38:39;break;case 10:if(!(r==null||s==null)){i.next=13;break}d("WALogger").LOG(l());return i.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired-and-resign-failed-no-ids")));case 13:i.next=15;return b("regeneratorRuntime").awrap(d("WAGetResignedCdnUrl").getCdnResignedUrl({objectId:r,fbid:s}));case 15:e=i.sent;if(e.success){i.next=31;break}u==null?void 0:u.addPoint("resign_cdn_url_fail",{string:{resignCdnErrorType:e.error.type,resignCdnError:e.error.text}});f=d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired-and-resign-failed-cdn-url"));i.t1=e.error.type;i.next=i.t1==="client-error"?22:i.t1==="server-error"?23:29;break;case 22:return i.abrupt("return",f);case 23:if(!(e.error.backoff!=null)){i.next=28;break}g=e.error.backoff;u==null?void 0:u.addPoint("resign_cdn_url_backoff");d("WALogger").LOG(k());return i.abrupt("return",d("WAPromiseDelays").delayMs(g).then(function(){return d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired"))}));case 28:return i.abrupt("return",f);case 29:e.error.type;return i.abrupt("return",f);case 31:e.success;u==null?void 0:u.addPoint("resign_cdn_url_success");h=e.value.directPath;if(!(t!=null)){i.next=37;break}i.next=37;return b("regeneratorRuntime").awrap(t(h));case 37:return i.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired")));case 38:return i.abrupt("return",d("WAResultOrError").makeError({progressMade:!0}));case 39:return i.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a)));case 40:case"end":return i.stop()}},null,this)})["catch"](function(a){d("WALogger").WARN(j(),a);return d("WAResultOrError").makeError({progressMade:!1})})}));case 10:B=E.sent;if(!(B==null)){E.next=14;break}d("WALogger").WARN(i());return E.abrupt("return",d("WAResultOrError").makeError("max-attempts-exceeded"));case 14:if(!(B.success===!1)){E.next=27;break}C=B.error;d("WALogger").WARN(h(),C);E.t0=C;E.next=E.t0==="signature-expired"?20:E.t0==="signature-expired-and-resign-failed-cdn-url"?20:E.t0==="signature-expired-and-resign-failed-no-ids"?20:E.t0==="media-not-found"?20:E.t0==="download-throttled"?20:E.t0==="request-error"?20:E.t0==="access-expired"?21:E.t0==="body-network-error"?22:23;break;case 20:return E.abrupt("return",d("WAResultOrError").makeError(C));case 21:return E.abrupt("return",d("WAResultOrError").makeError("disconnected"));case 22:return E.abrupt("return",d("WAResultOrError").makeError("request-error"));case 23:C;throw c("WAAssertUnreachable")(C);case 25:E.next=40;break;case 27:D=B.value;E.t1=!p(v,w);if(!E.t1){E.next=36;break}E.t2=d("WACryptoUtils").arrayBuffersEqual;E.next=33;return b("regeneratorRuntime").awrap(d("WACryptoSha256").sha256(D));case 33:E.t3=E.sent,E.t4=f,E.t1=!E.t2(E.t3,E.t4);case 36:if(!E.t1){E.next=38;break}return E.abrupt("return",d("WAResultOrError").makeError("ciphertext-hash-mismatch"));case 38:u==null?void 0:u.addPoint("download_finish",{"int":{byteLength:D.byteLength},bool:{isPartialDownload:p(v,w)}});return E.abrupt("return",d("WAResultOrError").makeResult(D));case 40:case"end":return E.stop()}},null,this)}e=d("WAPromiseManagement").cacheWhilePending(function(a){var b=a.fileEncSha256,c=a.fromBytes;a=a.toBytes;return d("WABase64").encodeB64UrlSafe(b)+"-"+((b=c)!=null?b:"X")+"-"+((c=a)!=null?c:"X")},a);function p(a,b){return a!=null&&a>0?!0:b!=null}g.cachedDownloadCiphertext=e}),98);
__d("WADownloadAndDecryptMedia",["WADecryptMedia","WADownloadCiphertext","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c,e,f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:c=a.mediaTypeDetails,e=a.fileEncSha256,f=a.directPath,g=a.mediaKey,h=a.plaintextHash,i=a.objectId,j=a.fbid,k=a.pathRedirected,l=a.eventFlow;o.next=3;return b("regeneratorRuntime").awrap(d("WADownloadCiphertext").cachedDownloadCiphertext({mediaTypeDetails:c,fileEncSha256:e,directPath:f,objectId:i,fbid:j,pathRedirected:k,eventFlow:l,plaintextHash:h}));case 3:m=o.sent;if(!(m.success!==!0)){o.next=6;break}return o.abrupt("return",m);case 6:o.next=8;return b("regeneratorRuntime").awrap(d("WADecryptMedia").decryptMedia({mediaKey:g,mediaTypeDetails:c,plaintextHash:h,ciphertextHmac:m.value}));case 8:n=o.sent;if(!(n.success!==!0)){o.next=11;break}return o.abrupt("return",n);case 11:n.value.alternativeHmacSaltUsed!=null&&l.addAnnotations({string:{alternativeHmacSaltUsed:n.value.alternativeHmacSaltUsed}});return o.abrupt("return",d("WAResultOrError").makeResult(n.value.plaintext));case 13:case"end":return o.stop()}},null,this)}g.downloadAndDecryptMedia=a}),98);
__d("WACreateMediaDecrypterStream",["WABinary","WAErr","WAMediaCrypto","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid PKCS padding length"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Plaintext size is less than CBC_BLOCK_SIZE"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected ciphertext in buffer following flush"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt chunk: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," of size ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs and ciphertextLengths must have the same length"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs must have at least one element"]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["WADecryptStream"]);function a(a,c,e,f,g){if(f.byteLength===0){o.ERROR(n());return d("WAResultOrError").makeError("missing-expected-hmacs")}if(f.byteLength!==g.length*d("WAMediaCrypto").HMAC_LENGTH){o.ERROR(m());return d("WAResultOrError").makeError("hmac-chiphertext-array-mismatch")}var h=p(f),i=c,r=new(d("WABinary").Binary)(),s=0,t=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){r.writeByteArray(b);for(;s<h.length&&r.size()>=g[s];s++){b=r.readByteArray(g[s]);o.DEV(l(),s,b.length);try{b=(yield d("WAMediaCrypto").hmacAndDecryptPartial(a,i,b,e,h[s]));var f=b.plaintext;b=b.nextIv;var j=s===g.length-1;j?void c.enqueue(q(f)):void c.enqueue(f);i=b}catch(a){o.ERROR(k(),a),a instanceof d("WAMediaCrypto").HmacValidationError?c.error("enc-hash-mismatch"):c.error("decryption-error")}}});return function(a,b){return c.apply(this,arguments)}}();f=new TransformStream({transform:function(a,b){a=a;return t(a,b)},flush:function(a){r.size()>0&&o.ERROR(j())}});return d("WAResultOrError").makeResult(f)}function p(a){var b=[];if(a.byteLength%d("WAMediaCrypto").HMAC_LENGTH!==0)throw c("WAErr")("Sidecar length is not a multiple of hmac length");for(var e=0;e<a.byteLength;e+=d("WAMediaCrypto").HMAC_LENGTH){var f=new Uint8Array(a,e,d("WAMediaCrypto").HMAC_LENGTH);b.push(f)}return b}function q(a){if(a.length<d("WAMediaCrypto").CBC_BLOCK_SIZE){o.ERROR(i());return a}var b=a[a.length-1];if(b===0||b>d("WAMediaCrypto").CBC_BLOCK_SIZE){o.ERROR(h());return a}return a.subarray(0,-b)}g.createDefaultDecryptStream=a}),98);
__d("WAMediaProgressiveJpegTransformStream",["WABinary"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.scanLengths,c=[];a=0;for(var e=b,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;a+=h;c.push(a)}var i=new(d("WABinary").Binary)(),j=0,k=0;h=new TransformStream({transform:function(a,d){a=a;k+=a.byteLength;i.writeByteArray(a);for(;j<b.length&&c[j]<k;j++){a=i.readByteArray(b[j]);void d.enqueue(a)}},flush:function(a){void a.enqueue(i.readByteArray())}});return h}g.makeProgressiveJpegHandlerTransformStream=a}),98);
__d("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry",["WACreateMediaDecrypterStream","WAHttpDownloadMedia","WAMediaCrypto","WAMediaProgressiveJpegTransformStream","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is not a number"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is missing"]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.serverMediaType,c=a.downloadUrl,e=a.eventFlow,f=a.progressiveJpegDetails;a=a.mediaKey;c=(yield d("WAHttpDownloadMedia").httpDownloadMedia(c,{mediaMetrics:e}));if(c.success!==!0)return c;e=c.value.body;if(e==null)return d("WAResultOrError").makeError("body-network-error");c=c.value.headers.get("Content-Length");if(c==null){j.ERROR(i());return d("WAResultOrError").makeError("missing-content-length-header")}c=Number(c);if(Number.isNaN(c)){j.ERROR(h());return d("WAResultOrError").makeError("invalid-content-length-header")}f=d("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:f,ciphertextLength:c});c=(yield d("WAMediaCrypto").computeMediaKeys(a,b));a=d("WACreateMediaDecrypterStream").createDefaultDecryptStream(c.cipherKey,c.iv,c.hmacKey,f.sidecar,f.alignedScanLengths);if(a.success!==!0)return a;b=a.value;c=d("WAMediaProgressiveJpegTransformStream").makeProgressiveJpegHandlerTransformStream(f);a=e.pipeThrough(b).pipeThrough(c);return d("WAResultOrError").makeResult(a)});return k.apply(this,arguments)}g.downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry=a}),98);
__d("WADownloadProgressiveJpegPlaintextStreamer",["WAAssertUnreachable","WACreateMediaDownloadRetrier","WADownloadProgressiveJpegPlaintextStreamerWithoutRetry","WAMediaUrl","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download with stream given up"]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.serverMediaType,f=a.fileEncSha256,g=a.directPath,j=a.eventFlow,k=a.progressiveJpegDetails,l=a.mediaKey;a=(yield d("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({directPath:g,eventFlow:j,fileEncSha256:f,mediaTypeDetails:{type:"regular",mediaType:e}}));if(!a.success)return a;a=a.value;var m=a.retrier;a=a.mediaRouteDetails;var n=a.bucket;a=(yield m.run(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.domain;a=d("WAMediaUrl").buildDownloadUrl(g,f,a,"manual",n);a=(yield d("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry").downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry({downloadUrl:a,eventFlow:j,mediaKey:l,progressiveJpegDetails:k,serverMediaType:e}));if(a.success===!0)return d("WAResultOrError").makeResult(a);a=a.error;switch(a){case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":case"invalid-content-length-header":case"missing-content-length-header":return d("WAResultOrError").makeError({progressMade:!0});case"access-expired":return d("WAResultOrError").makeResult(d("WAResultOrError").makeError("disconnected"));case"body-network-error":return d("WAResultOrError").makeResult(d("WAResultOrError").makeError("request-error"));case"media-not-found":case"request-error":case"download-throttled":case"signature-expired":return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a));case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a));default:a;throw c("WAAssertUnreachable")(a)}});return function(b){return a.apply(this,arguments)}}()));if(a==null){i.WARN(h());return d("WAResultOrError").makeError("max-attempts-exceeded")}return a});return j.apply(this,arguments)}g.downloadProgressiveJpegPlaintextUsingStreams=a}),98);
__d("WAIsArmadilloMediaKeyExpired",["WAGlobals","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return d("WAResultOrError").makeError("missing-media-key-timestamp");var b=d("WAGlobals").getConfig().mediaTtlOnWhatsAppInfraInDays()*d("WATimeUtils").DAY_SECONDS;return a==null||!d("WATimeUtils").happenedWithin(a,b)?d("WAResultOrError").makeError("media-key-expired"):d("WAResultOrError").makeResult()}g.isArmadilloMediaKeyExpired=a}),98);
__d("WAParseWav",["WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=new DataView(a);if(b.getUint32(0)!==1380533830||b.getUint32(8)!==1463899717)return d("WAResultOrError").makeError("invalid-wav");if(a.byteLength<44)return d("WAResultOrError").makeError("invalid-wav");a=b.getUint16(22,!0);b=b.getUint32(24,!0);return d("WAResultOrError").makeResult({numChannels:a,sampleRate:b})}g.parseWav=a}),98);
__d("WAProgressiveJpegAddJPEGTrailingTag",["WATypedArraysConcat"],(function(a,b,c,d,e,f,g){"use strict";var h=new Uint8Array([255,217]);function a(a){return d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[new Uint8Array(a),h]).buffer}g.JPEG_TRAILING_TAG=h;g.addJPEGTrailingTag=a}),98);
__d("WADownloadMedia",["Promise","WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadAndDecryptMedia","WADownloadDownloadablePreview","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAGlobals","WAHashUtils","WAIsArmadilloMediaKeyExpired","WAMediaCrypto","WAMediaQplHelper","WAMediaUtils","WAParseWav","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAPromiseManagement","WAResultOrError","WATagsLogger","WATimeUtils","WATypedArraysConcat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download successful. PlaintextHash: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch. PlaintextHash: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling preview from scan "," for plaintextHash ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," for plaintextHash ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Targeting scanIndex "," for preview. PlaintextHash: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg. PlaintextHash: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["ptt is not wav format"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch. mediaTypeDetailsType: ",", mediaTypeDetailsValue: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["media already exists in db, skipping download"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media Entry size "," does not match decrypted plaintext size ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaPreviewPromise state: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Falling back to full download"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media Streaming failed to download progressive jpeg. Reason: ",". PlaintextHash: ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media Streaming failed to download progressive jpeg. Reason: ","."]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type "," - ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get ProgressiveJpeg details: ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaEntry is incomplete"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose([""," is not downloaded"]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media Key Expired"]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["start downloadMedia."]);F=function(){return a};return a}var G=d("WATagsLogger").TAGS(["MediaDownload"]);function a(a){var c=a.downloadMediaMetric,e=a.hash,f=a.mediaEntry,g=a.protocolMsgId,i=a.getMediaPlaintext,j=a.onlyIfMediaTTLIsValid,k=a.handleMediaPreviewDownload,l=a.handleMediaPreviewBeforeDownload;a=a.updateMediaEntryForMsg;G.DEV(F());var m=f.mediaKeyTimestamp;c.addPoint("wa_protocol_media_download_start",{string:{mediaType:f.serverMediaType,mediaKeyTimestampAgeBucket:P(m)},"int":{mediaEntrySize:f.size},bool:{isMediaStreamingForProgressiveJpegEnabled:d("WAGlobals").getConfig().isMediaStreamingForProgressiveJpegEnabled()}});if(j){j=d("WAIsArmadilloMediaKeyExpired").isArmadilloMediaKeyExpired(m);if(!j.success){G.DEV(E());return(h||(h=b("Promise"))).resolve(j)}}m=d("WAGlobals").getConfig().uiLayoutTriggeredMediaDownload()?I:H;return m({downloadMediaMetric:c,hash:e,mediaEntry:f,protocolMsgId:g,getMediaPlaintext:i,handleMediaPreviewDownload:k,handleMediaPreviewBeforeDownload:l,updateMediaEntryForMsg:a}).then(function(a){a.success?c.addPoint("wa_protocol_media_download_end"):c.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:a.error}});return a})["catch"](function(a){c.addPoint("wa_protocol_media_download_fail");a=d("WAErrorMessage").maybeGetMessageFromError(a);G.ERROR(D(),a);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("runtime-error"))})}var H=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,e=a.downloadMediaMetric,f=a.hash,g=a.mediaEntry,i=a.protocolMsgId,j=a.getMediaPlaintext,k=a.handleMediaPreviewDownload,l=a.handleMediaPreviewBeforeDownload;a=a.updateMediaEntryForMsg;var m=g.directPath,n=g.fbid,o=g.fileEncSha256,p=g.fileSha256,q=g.mediaKey,r=g.objectId,s=g.serverMediaType,t=g.size;if(m==null||o==null||p==null||q==null||s==null){G.WARN(C(),g);G.ERROR(B());return d("WAResultOrError").makeError("media-entry-invalid")}if((g==null?void 0:(c=g.downloadableThumbnail)==null?void 0:c.directPath)!=null){e.addAnnotations({bool:{duplicateDirectPath:(g==null?void 0:(c=g.downloadableThumbnail)==null?void 0:c.directPath)===m,hasDownloadableThumbnail:!0}})}c=d("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(g);c.success===!1&&(G.ERROR(A(),c.error),e.addPoint(c.error));c=c.success===!0?c.value:null;e.addAnnotations({bool:{isProgressiveJpeg:c!=null}});var D=function(a){if(a==null)return(h||(h=b("Promise"))).resolve();var c;try{c=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(s)}catch(a){G.ERROR(z(),s,a);return(h||(h=b("Promise"))).resolve()}return k(f,a,c,i).then(function(){})};if(c!=null&&d("WAMediaUtils").isTransformStreamSupported()&&s==="image"&&d("WAGlobals").getConfig().isMediaStreamingForProgressiveJpegEnabled()){var E=(yield M({directPath:m,downloadFlow:e,fileEncSha256:o,handleMediaPreviewBlob:D,hash:f,mediaKey:q,progressiveJpegDetails:c,serverMediaType:s,fileSha256:p}));if(E.success)return d("WAResultOrError").makeResult({mimeType:d("WAMediaUtils").getMimeTypeFromServerMediaType(s),plaintext:E.value});else{E=E.error;e==null?void 0:e.addPoint("media_streaming_failed");G.ERROR(y(),E);G.WARN(x(),E,d("WAHashUtils").sanitisePlaintextHash(f));G.LOG(w());e==null?void 0:e.addPoint("fallback_to_full_download")}}E=L({hash:f,mediaEntry:g,progressiveJpegDetails:c,protocolMsgId:i,serverMediaType:s,getMediaPlaintext:j,handleMediaPreviewBeforeDownload:l,updateMediaEntryForMsg:a});void E.then(D);c=(yield J(i,f,e,{mediaType:s,type:"regular"},m,o,p,q,r,n,g,{getMediaPlaintext:j,updateMediaEntryForMsg:a}));l=(yield O(E));G.LOG(v(),l);(g==null?void 0:(D=g.downloadableThumbnail)==null?void 0:D.directPath)!=null&&e.addAnnotations({string:{mediaPreviewPromiseState:l}});if(c.success){t!=null&&(t!==c.value.byteLength&&(G.WARN(u(),t,c.value.byteLength),e.addPoint("legacy_plaintext_size_mismatch")));m={mimeType:d("WAMediaUtils").getMimeTypeFromServerMediaType(s),plaintext:c.value};return d("WAResultOrError").makeResult(m)}else return c});return function(b){return a.apply(this,arguments)}}(),I=d("WAPromiseManagement").cacheWhilePending(function(a){a=a.hash;return a},H);function J(a,b,c,d,e,f,g,h,i,j,k,l){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,h,i,j,k,l,m,n){c=n.getMediaPlaintext;var o=n.updateMediaEntryForMsg,p=d("WAHashUtils").toPlaintextHash(i);if(d("WAGlobals").getConfig().mediaDownloadDeduplication()){n=(yield c(p));if(n!=null){G.LOG(t());e.addPoint("media_download_skipped");i=(yield d("WAMediaUtils").blobToArrayBuffer(n));return d("WAResultOrError").makeResult(i)}}e.addAnnotations({bool:{downloadSkipped:!1}});c=(yield d("WADownloadAndDecryptMedia").downloadAndDecryptMedia({directPath:g,eventFlow:e,fbid:l,fileEncSha256:h,mediaKey:j,mediaTypeDetails:f,objectId:k,pathRedirected:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=function(){return d("WAMediaUtils").encodeMediaEntryWithUpdatedPath(m,b)};yield o(p,a,c,k,m.serverMediaType)});function e(a){return c.apply(this,arguments)}return e}(),plaintextHash:p}));if(c.success===!1){n=c.error;switch(n){case"signature-expired":case"signature-expired-and-resign-failed-cdn-url":case"signature-expired-and-resign-failed-no-ids":case"media-not-found":return d("WAResultOrError").makeError(n);case"enc-hash-mismatch":G.WARN(s(),f.type,f.type==="regular"?f.mediaType:f.messageType);G.ERROR(r());return d("WAResultOrError").makeError(n);default:n;return d("WAResultOrError").makeError(n)}}else{i=c.value;if(f.type==="regular"&&f.mediaType==="ptt"){g=d("WAParseWav").parseWav(i);!g.success?G.DEV(q()):e.addAnnotations({"int":{pttNumChannels:g.value.numChannels,pttSampleRate:g.value.sampleRate}})}e.addPoint("download_media_success",{string:{media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(i.byteLength)}});return d("WAResultOrError").makeResult(i)}});return K.apply(this,arguments)}function L(a){var b=a.hash,c=a.mediaEntry,e=a.progressiveJpegDetails,f=a.protocolMsgId,g=a.serverMediaType,h=a.getMediaPlaintext,i=a.handleMediaPreviewBeforeDownload,j=a.updateMediaEntryForMsg;return e==null||!d("WAGlobals").getConfig().isProgressiveJpegEnabledForDownload()?d("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(f,b,g,c,{getMediaPlaintext:h,handleMediaPreviewBeforeDownload:i,updateMediaEntryForMsg:j}):d("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreview({protocolMsgId:f,hash:b,serverMediaType:g,mediaEntry:c,progressiveJpegDetails:e,getMediaPlaintext:h,handleMediaPreviewBeforeDownload:i}).then(function(a){return a.success!==!0?d("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(f,b,g,c,{getMediaPlaintext:h,handleMediaPreviewBeforeDownload:i,updateMediaEntryForMsg:j}):a.value})}function M(a){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.directPath,c=a.downloadFlow,e=a.fileEncSha256,f=a.fileSha256,g=a.handleMediaPreviewBlob,h=a.hash,q=a.mediaKey,r=a.progressiveJpegDetails;a=a.serverMediaType;var s=G.TAGS(["MediaStreaming"]);s.LOG(p(),d("WAHashUtils").sanitisePlaintextHash(h));c==null?void 0:c.addPoint("media_streaming_start");var t=d("WADownloadProgressiveJpegPreview").getPreviewTargetScan(r.scanLengths)-1;s.LOG(o(),t,d("WAHashUtils").sanitisePlaintextHash(h));b=(yield d("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({directPath:b,eventFlow:c,fileEncSha256:e,mediaKey:q,progressiveJpegDetails:r,serverMediaType:a}));if(b.success===!1)return b;e=[];q=0;try{r=!0;a=!1;var u;try{for(var v=babelHelpers.asyncIterator(Q(b.value)),b,b;b=(yield v.next()),r=b.done,b=(yield b.value),!r;r=!0){b=b;if(b==null)continue;s.LOG(n(),q,d("WAHashUtils").sanitisePlaintextHash(h));e.push(b);if(q===t){c==null?void 0:c.addPoint("media_streaming_preview_processed");s.LOG(m(),q,d("WAHashUtils").sanitisePlaintextHash(h));b=d("WAByteArray").uint8ArrayToBuffer(d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(e,[d("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));void g(b)}q++}}catch(b){a=!0,u=b}finally{try{!r&&v["return"]!=null&&(yield v["return"]())}finally{if(a)throw u}}c==null?void 0:c.addPoint("media_streaming_finish");b=d("WAByteArray").uint8ArrayToBuffer(d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(e)));g=(yield d("WACryptoSha256").sha256(b));if(!d("WACryptoUtils").arrayBuffersEqual(f,g)){s.ERROR(l());s.WARN(k(),d("WAHashUtils").sanitisePlaintextHash(h));c==null?void 0:c.addPoint("streaming_plaintext_hash_mismatch");return d("WAResultOrError").makeError("hash-mismatch")}s.LOG(j(),d("WAHashUtils").sanitisePlaintextHash(h));c==null?void 0:c.addAnnotations({string:{media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(b.byteLength)}});return d("WAResultOrError").makeResult(b)}catch(a){s.ERROR(i(),a);return d("WAResultOrError").makeError("stream-error")}});return N.apply(this,arguments)}function O(a){var c={};return(h||(h=b("Promise"))).race([a,c]).then(function(a){return a===c?"pending":"fulfilled"},function(){return"rejected"})}function P(a){if(a==null)return"Missing";switch(!0){case d("WATimeUtils").happenedWithin(a,1*d("WATimeUtils").DAY_SECONDS):return"< 1 day";case d("WATimeUtils").happenedWithin(a,7*d("WATimeUtils").DAY_SECONDS):return"1-7 days";case d("WATimeUtils").happenedWithin(a,14*d("WATimeUtils").DAY_SECONDS):return"7-14 days";case d("WATimeUtils").happenedWithin(a,21*d("WATimeUtils").DAY_SECONDS):return"14-21 days";case d("WATimeUtils").happenedWithin(a,30*d("WATimeUtils").DAY_SECONDS):return"21-30 days";case d("WATimeUtils").happenedWithin(a,40*d("WATimeUtils").DAY_SECONDS):return"30-40 days";case d("WATimeUtils").happenedWithin(a,50*d("WATimeUtils").DAY_SECONDS):return"40-50 days";case d("WATimeUtils").happenedWithin(a,60*d("WATimeUtils").DAY_SECONDS):return"50-60 days";default:return"> 60 days"}}function Q(a){return R.apply(this,arguments)}function R(){R=babelHelpers.wrapAsyncGenerator(function*(a){a=a.getReader();try{while(!0){var b=(yield babelHelpers.awaitAsyncGenerator(a.read())),c=b.done;b=b.value;if(c)return;yield b}}finally{a.releaseLock()}});return R.apply(this,arguments)}g.mediaDownloadLogger=G;g.downloadMedia=a;g.downloadMediaImpl=J}),98);
__d("WADownloadProgressiveJpegPlaintext",["WADownloadCiphertext","WAMediaCrypto","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ProgressiveJpeg download and decrypt successful. Partial: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Using progressiveJpeg decryptAndVerify"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["DownloadProgressiveJpeg"]);function a(a){var c,e,f,g,h,i,j,k,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:c=a.mediaTypeDetails,e=a.fileEncSha256,f=a.directPath,g=a.mediaKey,h=a.eventFlow,i=a.pathRedirected,j=a.progressiveJpegDetails,k=a.targetScan,n=a.plaintextHash,o=a.size;p=d("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:j,ciphertextLength:m(o)});q=d("WAProgressiveJpegGetPJpegDetails").getTotalByteSizeForScan(p.alignedScanLengths,k);s.next=5;return b("regeneratorRuntime").awrap(d("WADownloadCiphertext").cachedDownloadCiphertext({mediaTypeDetails:c,fileEncSha256:e,directPath:f,pathRedirected:i,fromBytes:0,toBytes:q-1,eventFlow:h,plaintextHash:n}));case 5:r=s.sent;if(!(r.success!==!0)){s.next=8;break}return s.abrupt("return",r);case 8:return s.abrupt("return",l(g,c,k,p,r.value));case 9:case"end":return s.stop()}},null,this)}function l(a,c,e,f,g){var l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:k.LOG(j());l=new Uint8Array(g);c.type==="preview"?m=d("WAMediaCrypto").computeMediaKeysForPreview(a):m=d("WAMediaCrypto").computeMediaKeys(a,c.mediaType);p.next=5;return b("regeneratorRuntime").awrap(m.then(function(a){var b=a.iv,c=a.cipherKey;a=a.hmacKey;return d("WAMediaCrypto").decryptPartialChunks(c,b,l,a,e,f)}).then(d("WAResultOrError").makeResult)["catch"](function(a){k.ERROR(i(),a);if(a instanceof d("WAMediaCrypto").HmacValidationError)return d("WAResultOrError").makeError("enc-hash-mismatch");else return d("WAResultOrError").makeError("decryption-error")}));case 5:n=p.sent;if(n.success){p.next=8;break}return p.abrupt("return",n);case 8:k.LOG(h(),e<f.scanLengths.length);o=d("WAProgressiveJpegAddJPEGTrailingTag").addJPEGTrailingTag(n.value.plaintext);return p.abrupt("return",d("WAResultOrError").makeResult(o));case 11:case"end":return p.stop()}},null,this)}function m(a){if(a==null)return null;var b=d("WAMediaCrypto").CBC_BLOCK_SIZE-a%d("WAMediaCrypto").CBC_BLOCK_SIZE;return a+b+d("WAMediaCrypto").HMAC_LENGTH}g.downloadProgressiveJpegPlaintext=a}),98);
__d("WAProgressiveJpegGetTargetScanLengthForBytes",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=0,d=0;for(var e=0;e<a.length;e++){d=e+1;c+=a[e];if(c>=b)break}return d}f.getTargetScanBasedOnByteSize=a}),66);
__d("WADownloadProgressiveJpegPreview",["WADownloadMedia","WADownloadProgressiveJpegPlaintext","WAGetPlatformFromStanzaId","WAGlobals","WAJids","WALoggerTag","WAMediaUtils","WAPREList","WAPREMetrics","WAProgressiveJpegGetTargetScanLengthForBytes","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Finished progressiveJpeg preview download"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["media already exists in db, skipping download"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting progressiveJpeg preview download"]);j=function(){return a};return a}var k=d("WADownloadMedia").mediaDownloadLogger.TAGS([c("WALoggerTag").MediaPreview]),l=d("WAGlobals").getConfig().jpegThumbnailTargetByteSizeKB()*1024,m=3,n=3;function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.protocolMsgId,c=a.hash,e=a.serverMediaType,f=a.mediaEntry,g=a.progressiveJpegDetails,l=a.getMediaPlaintext;a=a.handleMediaPreviewBeforeDownload;var m=f.directPath,n=f.fileEncSha256,o=f.mediaKey,q=f.size;if(m==null||n==null||o==null)return d("WAResultOrError").makeError("pjpeg-failed");yield a(c);a=d("WAJids").switchOnMsgrChatJidType(b.chat,{group:function(){return"group"},user:function(){return"user"}});a=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isMediaFallbackToAlternativeHmacSaltsEnabled:d("WAGlobals").getConfig().isMediaFallbackToAlternativeHmacSaltsEnabled(),isPreview:!0,isProgressiveJpeg:!0},string:{chat_type:a,downloadEntry:"progressiveJpeg-preview",e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(b.externalId),mediaType:f.serverMediaType},"int":{mediaEntrySize:f.size}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);k.LOG(j());a.addPoint("wa_protocol_media_download_start");if(g.scanLengths.length<3){a.endFail("pjpeg-too-few-scans");return d("WAResultOrError").makeError("pjpeg-failed")}b=d("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?g.scanLengths.length-1:g.scanLengths.length;f=Math.min(p(g.scanLengths,q),b);if(d("WAGlobals").getConfig().mediaDownloadDeduplication()){b=(yield l(c));if(b!=null){k.LOG(i());l=(yield d("WAMediaUtils").blobToArrayBuffer(b));a.addPoint("media_download_skipped");a.addPoint("wa_protocol_media_download_end");a.endSuccess();return d("WAResultOrError").makeResult(l)}}b=(yield d("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({directPath:m,eventFlow:a,fileEncSha256:n,mediaKey:o,mediaTypeDetails:{mediaType:e,type:"regular"},progressiveJpegDetails:g,plaintextHash:c,targetScan:f,size:q}));if(!b.success){a.addPoint("wa_protocol_media_download_fail");a.endFail(b.error);return d("WAResultOrError").makeError("pjpeg-failed")}l=b.value;k.LOG(h());a.addPoint("wa_protocol_media_download_end");a.endSuccess();return d("WAResultOrError").makeResult(l)});return o.apply(this,arguments)}function p(a,b){var c=d("WAGlobals").getConfig().thumbnailImprovementsEnabled();c=c?d("WAProgressiveJpegGetTargetScanLengthForBytes").getTargetScanBasedOnByteSize(a,l):m;(b==null||b===0)&&(c=Math.min(c,a.length-1));c=Math.max(c,n);return c}g.maybeDownloadProgressiveJpegPreview=a;g.getPreviewTargetScan=p}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchSelfResponseError=a}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"manufacturer");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"seen");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"creation");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"ip");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"location");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"latitude");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"longitude");if(!c.success)return c;a=d("WASmaxParseUtils").contentString(a);return!a.success?a:d("WAResultOrError").makeResult({latitude:b.value,longitude:c.value,elementValue:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"manufacturer",i);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"model",j);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChildWithTag(a,"seen",k);if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChildWithTag(a,"creation",l);if(!g.success)return g;var o=d("WASmaxParseUtils").optionalChildWithTag(a,"ip",m);if(!o.success)return o;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"location",n);if(!p.success)return p;var q=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!q.success)return q;a=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({id:q.value},a.value,{platform:b.value,manufacturer:c.value,model:e.value,seen:f.value,creation:g.value,ip:o.value,location:p.value}))}g.parseDeviceInfoPlatform=h;g.parseDeviceInfoManufacturer=i;g.parseDeviceInfoModel=j;g.parseDeviceInfoSeen=k;g.parseDeviceInfoCreation=l;g.parseDeviceInfoIp=m;g.parseDeviceInfoLocation=n;g.parseDeviceInfoMixin=a}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"self");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"device",1,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{selfDevice:b.value}))}g.parseFetchSelfResponseSuccessSelfDevice=h;g.parseFetchSelfResponseSuccess=a}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("self",null)));return a}g.makeFetchSelfRequest=a}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=d("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest();h.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=h.sent;f=d("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(e,c);if(!f.success){h.next=7;break}return h.abrupt("return",{name:"FetchSelfResponseSuccess",value:f.value});case 7:g=d("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(e,c);if(!g.success){h.next=10;break}return h.abrupt("return",{name:"FetchSelfResponseError",value:g.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:f,Error:g}));case 11:case"end":return h.stop()}},null,this)}g.sendFetchSelfRPC=a}),98);
__d("WAGetCurrentUserDeviceList",["WAAssertUnreachable","WAErr","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"]);h=function(){return a};return a}function i(a,b){if(a.isCurrentDevice&&b.isCurrentDevice){d("WALogger").ERROR(h());return 0}if(a.isCurrentDevice)return-1;if(b.isCurrentDevice)return 1;if(a.lastSeen!=null&&b.lastSeen==null)return-1;if(a.lastSeen==null&&b.lastSeen!=null)return 1;if(a.lastSeen!=null&&b.lastSeen!=null){a=a.lastSeen;b=b.lastSeen;return b.getTime()-a.getTime()}return 0}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC());switch(a.name){case"FetchSelfResponseError":var b=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;switch(b.name){case"RetryableIQError":var e=b.value.backoff;if(e!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{delay:e,type:"constant"},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});default:b.name;e=b.value.code;throw c("WAErr")("Failed with an error code "+e)}case"FetchSelfResponseSuccess":var f=d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid());return a.value.selfDevice.map(function(a){var b=a.creation,c=a.elementValue,e=a.id,g=a.ip,h=a.location,i=a.manufacturer,j=a.model,k=a.platform;a=a.seen;return{creationTime:b==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(b.elementValue)),id:d("WAJids").interpretAsDeviceId(e),identityKey:d("WASignalKeys").serializeIdentity(c),ipAddress:(b=g==null?void 0:g.elementValue)!=null?b:null,isCurrentDevice:e===f,lastSeen:a==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(a.elementValue)),latitude:h==null?null:parseFloat(h.latitude),location:(c=h==null?void 0:h.elementValue)!=null?c:null,longitude:h==null?null:parseFloat(h.longitude),manufacturer:(g=i==null?void 0:i.elementValue)!=null?g:null,model:(b=j==null?void 0:j.elementValue)!=null?b:null,platform:(e=k==null?void 0:k.elementValue)!=null?e:null}}).sort(i);default:return c("WAAssertUnreachable")(a.name)}});return j.apply(this,arguments)}g.getCurrentUserDeviceList=a}),98);
__d("WAPreEstablishOutgoingSessionForGroup",["Promise","WACryptoManagerUtils","WAGlobals","WAPushSafeTypes","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=d("WAPushSafeTypes").unsafeNotNullable(c);c=a.groupJid;var e=a.userJids;if(!d("WAGlobals").getConfig().isPreEstablishSessionEnabled())return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());if(i.has(c))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.cryptoManager.storage.bulkLoadIdentities(e));b=Array.from(b).flatMap(function(a){a=a[1];return Array.from(a.keys())});return d("WACryptoManagerUtils").bulkPreEstablishOutgoingSession(b,a)});return function(b){return a.apply(this,arguments)}}(),{flush:!0,afterInit:!0,operationType:"pre_establish_session"});i.add(c);return d("WAResultOrError").makeResult()});return j.apply(this,arguments)}g.preEstablishSession=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound"],[b,c])}g.parseIQErrorBadRequestOrItemNotFoundMixinGroup=a}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:b.value})}g.parseNonRetryableRemoveDeviceIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[b,c])}g.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:b.value}))}g.parseRemoveResponseError=a}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRemoveResponseSuccess=a}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.removeId;a=a.identityKeyMixinArgs;b=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxJsx").smax("remove",{id:d("WAWap").INT(b)}),a)));return b}g.makeRemoveRequest=a}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"RemoveResponseSuccess",value:g.value});case 7:h=d("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"RemoveResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendRemoveRPC=a}),98);
__d("WARemoveDevice",["WALogger","WAPersistedJobManager","WAPushSafeTypes","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeDevice called for device "," and identity ",""]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAPushSafeTypes").unsafeNotNullable(b);b=a.deviceId;a=a.identity;d("WALogger").DEV(i(),b,a);a=d("WASignalOther").sliceBytes(a,1,32);a=(yield d("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:b,identityKeyMixinArgs:{anyElementValue:a}}));d("WALogger").LOG(h(),b,a);if(a.name==="RemoveResponseSuccess")return d("WAResultOrError").makeResult();else{a.name;b=a.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(b.name!=="RetryableIQError")return d("WAResultOrError").makeError();b.name;a=b.value.backoff;if(a!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:a},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}});return j.apply(this,arguments)}g.removeDevice=a}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WALogger","WARemoveDevice","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeCurrentDevice called for current device"]);i=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i());var b=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());if(b==null){d("WALogger").WARN(h());return d("WAResultOrError").makeResult()}var c=b.deviceId;b=b.identityKey;a=(yield d("WARemoveDevice").removeDevice(a,{deviceId:c,identity:b}));if(a.success){yield d("WAGlobals").getDependencies().clearSignalAndTempStores();return d("WAResultOrError").makeResult()}return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}();g.removeCurrentDevice=a}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["sendAppDataFanout"]),p=24;function a(a,b){a=b.contents;var c=b.externalId,e=b.permittedIdentitiesPerDevice;b=b.checkPhash;b=b===void 0?"checkPhash":b;return q(a,c,e,b)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);o.ERROR(n(),a);return d("WAResultOrError").makeError("runtime-error")})}function q(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e===void 0&&(e="checkPhash");o.LOG(m(),b);a=d("WAConvertAppData").convertAppData(a);var f={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArray()),version:"v3"},g=[];a=Array.from(c.entries()).map(function(a){var b=a[0];a=a[1];return{identity:a.pubKey,jid:b}});c=p;a.length>c&&(o.WARN(l(),a.length),o.ERROR(k(),c),a=a.slice(0,c));var n=[{devicesInfo:a,user:d("WAGlobals").getMyUserJid()}];c=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptUserMsg(n,{messageBytes:f,type:"appdata"},[],{cryptoManager:a})},{operationType:"encrypt",flush:!0}));a=c.phash;var q=!1;c.participants!=null&&c.participants.forEach(function(a){a.type==="pkmsg"&&(q=!0),g.push({toJid:a.to,encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)}})});c={appdataTo:d("WAGlobals").getMyUserJid(),toArgs:g};c={peerPeerFanout:c};var r=void 0;if(q){var s=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());s=s==null?void 0:s.identityKey;if(s==null){o.ERROR(j());return d("WAResultOrError").makeError("no-public-identity")}r={deviceIdentityElementValue:s}}s={appdataDeviceListCheck:e==="checkPhash"?"true":"false"};e={appdataId:b,peerPeerFanoutOrPeerSingleMixinGroupArgs:c,deviceIdentityMixinArgs:r,withDeviceListCheckMixinArgs:s};b=(yield d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(e));switch(b.name){case"PeerResponseSuccess":r=(c=b.value.deviceListStaleMixin)==null?void 0:c.phash;if(r!=null&&a!=null&&r!==a){o.LOG(i(),a,r);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"});return d("WAResultOrError").makeResult({phashMismatch:!0})}else return d("WAResultOrError").makeResult({phashMismatch:!1});default:b.name;o.ERROR(h(),b.value.error);return d("WAResultOrError").makeError("ack-failure")}});return r.apply(this,arguments)}g.MAX_APPDATA_RECIPIENTS=p;g.sendAppDataToDevicesProtocol=a}),98);
__d("WASaveReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"saveReceipt",function(a){return function(b){return a.receipts.put({msgId:b.id.externalId.toString(),permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,recipientDevices:b.recipientDevices,waMsgId:d("WAMsg").craftWAMsgIdString(b.id)}).then(function(){})}});g.saveReceipt=a}),98);
__d("WASendMsgUtilV2",["Promise","WADevicesState","WAErr","WAGenReportingMeta","WAGetDevices","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WAResultOrError","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices for users with missing icdc info: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing icdc info."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to calculate ICDC info for message with id ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""]);q=function(){return a};return a}function r(a){return(h||(h=b("Promise"))).resolve()}function s(a,b){return d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([a,d("WAGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+b)}function t(a,c){a=c.chatJid;var e=c.reason;return d("WAJids").switchOnChatJidType(a,{group:function(a){return r(a)},interopUser:function(a){return s(a,e)},lidUser:function(a){return s(a,e)},msgrUser:function(a){return s(a,e)},phoneUser:function(a){return s(a,e)}})["catch"](function(a){d("WALogger").ERROR(q(),a);return(h||(h=b("Promise"))).resolve()})}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.messagePayload;a=a.loadThreadParticipants;var e={author:c.protocolMsgId.author,chat:c.protocolMsgId.chat,externalId:c.protocolMsgId.externalId},f=(yield d("WALoadReceiptApi").loadReceipt(e));if(f.success)return f;b==null?void 0:b.addPoint("get_devices_before_send_start");yield t(b,{chatJid:c.protocolMsgId.chat,reason:"prepareReceipt"});b==null?void 0:b.addPoint("get_devices_before_send_end");var g=(yield a(c.protocolMsgId.chat));f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(g)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"}).then(function(a){var b=new Map();for(a of a){a[0];var c=a[1];for(c of c){var e=c[0],f=c[1];if(e===d("WAGlobals").getMyDeviceJid())continue;b.set(e,{pubKey:f})}}return b}));b=new Set();a={permittedIdentitiesPerDevice:f,recipientDevices:b,id:e};yield d("WASaveReceiptApi").saveReceipt(a)["catch"](function(a){d("WALogger").ERROR(p(),a);return d("WAResultOrError").makeError("missing-receipt")});return d("WAResultOrError").makeResult(a)});return v.apply(this,arguments)}function a(a,b,c){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){a=c.messagePayload;var f=c.loadThreadParticipants,g=c.sendIdentity,i=g===void 0?!1:g;g=c.isInstamadillo;c=g===void 0?!1:g;g=(yield u({messagePayload:a,loadThreadParticipants:f},e));if(g.success===!1){d("WALogger").ERROR(o());return d("WAResultOrError").makeError({type:"missing-receipt"})}f=g.value;var p=a.frankingKey,q=a.frankingVersion,r=a.messageBytes,s=a.messageType,t=a.protocolMsgId;g=x(f.permittedIdentitiesPerDevice);var v=s.type==="text"&&s.invitedParticipantUserJid!=null?g.filter(function(a){return a.user===s.invitedParticipantUserJid||a.user===d("WAGlobals").getMyUserJid()}):g;e==null?void 0:e.addPoint("recipients-calculated",{"int":{recipientsCount:v.length},string:{msgType:s.type}});a=s.type==="text"&&s.invitedParticipantUserJid!=null?s.invitedParticipantUserJid:t.chat;if(v.length===0){d("WALogger").ERROR(n());return d("WAResultOrError").makeError({type:"no-recipients"})}f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.cryptoManager;var b=(yield a.storage.calculateICDC(v.map(function(a){return a.user})));a=i?yield y(a):null;return{icdcInfoResult:b,deviceIdentity:a}});return function(b){return a.apply(this,arguments)}}(),{operationType:"calc_icdc",flush:!0,afterInit:!0}));g=f.icdcInfoResult;f=f.deviceIdentity;g.success===!1&&d("WALogger").ERROR(m(),t.externalId);g=g.success?g.value:{icdcInfo:[],usersWithMissingICDC:new Set()};var w=g.icdcInfo;g=g.usersWithMissingICDC;g.size>0&&(d("WALogger").LOG(l()),d("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"missing-icdc-info",users:g})["catch"](function(a){d("WALogger").ERROR(k(),a)}));g=(yield s.isRevoked===!0?(h||(h=b("Promise"))).resolve(null):d("WAGenReportingMeta").genReportingMeta(r.bytes,p,q));return d("WASendMsgInternal").sendMessage({type:"chat",messageBytes:r,chat:a,deviceIdentity:f,messageType:s,protocolMsgId:t,externalId:t.externalId,icdcInfo:w,recipients:v,reportingMeta:g},e,c).then(function(a){if(a.success)return d("WASentBytesCache").sentBytesCache().saveSentBytes({ts:a.value.serverTs,frankingKey:p,frankingVersion:q,messageBytes:r,messageType:s,protocolMsgId:t,waMsgId:d("WAMsg").craftWAMsgIdString({author:t.author,chat:t.chat,externalId:t.externalId})})["catch"](function(a){d("WALogger").ERROR(j(),a)}).then(function(){return a});else return a})});return w.apply(this,arguments)}function x(a){var b=new Map();a.forEach(function(a,c){a=a.pubKey;var e=d("WAJids").extractUserJid(c);a={identity:a,jid:c};c=b.get(e)||[];c.push(a);b.set(e,c)});return Array.from(b,function(a){var b=a[0];a=a[1];return{devicesInfo:a,user:b}})}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield a.storage.loadIdentities(d("WAGlobals").getMyUserJid()));a=a.get(d("WAGlobals").getMyDeviceJid());if(a!=null)return a;throw c("WAErr")("missing-identity")}catch(a){d("WALogger").ERROR(i(),a)}});return z.apply(this,arguments)}g.getDevicesBeforeSend=t;g.sendChatMessage=a}),98);
__d("WASetClockSkewApi",["WASetMetaApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){a=a.clockSkew;return d("WASetMetaApi").setMeta({clockSkew:a})};g.setClockSkew=a}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]);h=function(){return a};return a}function a(){d("WALogger").LOG(h()),d("WAComms").sendPing()}function c(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.clockSkew;d("WATimeUtils").setClockSkew(a);yield d("WASetClockSkewApi").setClockSkew({clockSkew:a})});return i.apply(this,arguments)}g.sendPing=a;g.updateClockSkew=c}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",501);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[b,c])}g.parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup=a}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup").parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrFeatureNotImplementedMixinGroup:b.value}))}g.parseGetExperimentConfigResponseErrorNoRetry=a}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorIQErrorInternalServerErrorMixin:c.value},a.value))}g.parseGetExperimentConfigResponseErrorRetry=a}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"config_code",1,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"config_value");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"config_expo_key",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({configCode:b.value,configValue:c.value,configExpoKey:a.value})}g.parseExperimentConfigMixin=a}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"event_code",1,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"sampling_weight",-1e4,1e4);return!a.success?a:d("WAResultOrError").makeResult({eventCode:b.value,samplingWeight:a.value})}g.parseSamplingConfigMixin=a}),98);
__d("WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ExperimentConfig",value:b.value});var c=d("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(a);return c.success?d("WAResultOrError").makeResult({name:"SamplingConfig",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ExperimentConfig","SamplingConfig"],[b,c])}g.parseExperimentOrSamplingConfigMixinGroup=a}),98);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup").parseExperimentOrSamplingConfigMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({experimentOrSamplingConfigMixinGroup:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"erid");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,1,100);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"props");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"erid",i);if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"protocol","1");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"ab_key");if(!g.success)return g;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"hash");if(!j.success)return j;var k=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh",0,void 0);if(!k.success)return k;var l=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh_id",0,void 0);if(!l.success)return l;a=d("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"prop",0,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({propsProtocol:f.value,propsAbKey:g.value,propsHash:j.value,propsRefresh:k.value,propsRefreshId:l.value},a.value,{erid:e.value,propsProp:b.value}))}g.parseGetExperimentConfigResponseSuccessPropsProp=h;g.parseGetExperimentConfigResponseSuccessErid=i;g.parseGetExperimentConfigResponseSuccess=a}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.propsHash;a=d("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"abt",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("props",{protocol:"1",hash:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeGetExperimentConfigRequest=a}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetExperimentConfigResponseSuccess",value:g.value});case 7:h=d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetExperimentConfigResponseErrorNoRetry",value:h.value});case 10:i=d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetExperimentConfigResponseErrorRetry",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:g,ErrorNoRetry:h,ErrorRetry:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetExperimentConfigRPC=a}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""]);h=function(){return a};return a}function a(a){var c,e,f,g,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:q.next=2;return b("regeneratorRuntime").awrap(d("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC({propsHash:a}));case 2:c=q.sent;if(!(c.name==="GetExperimentConfigResponseSuccess")){q.next=7;break}e=c.value,f=e.propsAbKey,g=e.propsHash,j=e.propsRefresh,k=e.propsRefreshId,l=e.propsProp,m=e.erid;n=i(l),o=n.newProps,p=n.samplingConfigs;return q.abrupt("return",d("WAResultOrError").makeResult({abKey:f,hash:g,refresh:j,refreshId:k,props:o,samplingConfigs:p,erid:m==null?void 0:m.elementValue}));case 7:d("WALogger").WARN(h(),c.value);return q.abrupt("return",d("WAResultOrError").makeError());case 9:case"end":return q.stop()}},null,this)}function i(a){var b=[],c=[];a.forEach(function(a){a=a.experimentOrSamplingConfigMixinGroup;if(a.name==="ExperimentConfig"){var d;b.push({configCode:a.value.configCode,configValue:a.value.configValue,configExpoKey:(d=a.value.configExpoKey)==null?void 0:d.toString()})}else a.name==="SamplingConfig"&&c.push({eventCode:a.value.eventCode,samplingWeight:a.value.samplingWeight})});return{newProps:b,samplingConfigs:c}}g.getAbPropsProtocol=a}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"]);k=function(){return a};return a}c=d("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},a);function a(a){var b=a.sendHash;b=b===void 0?!0:b;var c=a.eventFlow;c==null?void 0:c.addPoint("sync_ab_props",{bool:{sendHash:b}});return b==null||b===!1?l(null,c):d("WAAbProps").getHash().then(function(a){return l(a,c)})}e=a;function l(a,c){var e,f,g,h,i,l,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:c==null?void 0:c.addPoint("fetch_ab_props");q.next=3;return b("regeneratorRuntime").awrap(d("WAGetAbPropsProtocol").getAbPropsProtocol(a));case 3:e=q.sent;if(e.success){q.next=8;break}d("WALogger").ERROR(k());q.next=15;break;case 8:f=e.value,g=f.abKey,h=f.hash,i=f.refresh,l=f.props;n=d("WAAbPropsHelpers").parseAbProps(d("WAAbProps").getConfig(),l);c==null?void 0:c.addPoint("save_ab_props");q.next=13;return b("regeneratorRuntime").awrap(m(g,h,i,n));case 13:o=q.sent,o.success===!1&&(o.error,d("WALogger").LOG(j()));case 15:q.next=17;return b("regeneratorRuntime").awrap(d("WAAbProps").getRefreshSecs());case 17:p=q.sent;return q.abrupt("return",{seconds:p});case 19:case"end":return q.stop()}},null,this)}function m(a,c,e,f){var g,j,k,l,m,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:v.next=2;return b("regeneratorRuntime").awrap(d("WAAbProps").getAbProps());case 2:k=v.sent;l={abKey:(g=a)!=null?g:k.abKey,hash:(j=c)!=null?j:k.hash,refresh:d("WAAbPropsHelpers").maybeUpdateRefresh(e),lastSyncTime:d("WATimeUtils").unixTime(),propValues:k.propValues,propExpoKeys:k.propExpoKeys,internalExpoKeys:k.internalExpoKeys,expoKeyStr:k.expoKeyStr};if(!(c==null)){v.next=9;break}v.next=7;return b("regeneratorRuntime").awrap(d("WAAbProps").setAbProps(l));case 7:d("WALogger").LOG(i());return v.abrupt("return",d("WAResultOrError").makeError("noHash"));case 9:d("WALogger").LOG(h());m=f.values,n=f.expoKeys;o=d("WAAbPropsHelpers").maybeUpdatePropValues(m,k.propValues,d("WAAbProps").getConfig());p=d("WAAbPropsHelpers").maybeUpdateExpoKeys(n,k.propExpoKeys,d("WAAbProps").getConfig()),q=p.propExpoKeys,r=p.expoKeysToDelete;u=d("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(r,k.internalExpoKeys);u!=null&&(s=u.internalExpoKeys,t=u.expoKeyStr);v.next=17;return b("regeneratorRuntime").awrap(d("WAAbProps").setAbProps(babelHelpers["extends"]({},l,{propValues:o,propExpoKeys:q,internalExpoKeys:s,expoKeyStr:t})));case 17:return v.abrupt("return",d("WAResultOrError").makeResult());case 18:case"end":return v.stop()}},null,this)}g.syncAbProps=c;g.syncAbPropsDebug=e}),98);
__d("WASyncAbProps",["WAAbPropsSync","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=b.sendHash;d("WALogger").LOG(h());yield d("WAAbPropsSync").syncAbProps({sendHash:b,eventFlow:(b=a)!=null?b:void 0})});return i.apply(this,arguments)}g.syncAbProps=a}),98);
__d("WAHttpResumeCheck",["WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to parse request body ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: resume is NaN: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: object_id is missing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: direct_path is missing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: response status ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to initiate fetch ",""]);m=function(){return a};return a}function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.prev=0;g.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"text/plain"}}));case 3:c=g.sent;g.next=10;break;case 6:g.prev=6;g.t0=g["catch"](0);d("WALogger").ERROR(m(),g.t0);throw g.t0;case 10:e=c,f=e.status;d("WALogger").LOG(l(),f);g.t1=f;g.next=g.t1===200?15:g.t1===404?16:g.t1===408?17:g.t1===429?18:g.t1===507?18:19;break;case 15:return g.abrupt("return",c.json().then(function(a){var b=a.resume,c=a.direct_path;a=a.object_id;if(b==="complete"){if(c==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeResult({type:"media-not-found"})}if(a==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeResult({type:"media-not-found"})}return d("WAResultOrError").makeResult({type:"media-found",directPath:c,objectId:a})}c=parseInt(b,10);if(c===0)return d("WAResultOrError").makeResult({type:"media-not-found"});if(Number.isNaN(c)){d("WALogger").ERROR(i(),b);return d("WAResultOrError").makeResult({type:"media-not-found"})}return d("WAResultOrError").makeResult({type:"media-partial-found",resumeFromBytes:c})})["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return g.abrupt("return",d("WAResultOrError").makeResult({type:"media-not-found"}));case 17:return g.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 18:return g.abrupt("return",d("WAResultOrError").makeError("upload-throttled"));case 19:if(!(f>=400&&f<500)){g.next=21;break}return g.abrupt("return",d("WAResultOrError").makeError("request-error"));case 21:return g.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 22:case"end":return g.stop()}},null,this,[[0,6]])}g.httpResumeCheck=a}),98);
__d("WACheckCiphertextInServer",["WAHttpResumeCheck","WAMediaUrl","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e,f){return f.run(function(f,g){var h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:h=d("WAMediaUrl").buildUploadUrl(a,e,c,f.domain,g,!0);k.next=3;return b("regeneratorRuntime").awrap(d("WAHttpResumeCheck").httpResumeCheck(h));case 3:i=k.sent;if(!i.success){k.next=8;break}return k.abrupt("return",d("WAResultOrError").makeResult(i));case 8:j=i.error;k.t0=j;k.next=k.t0==="server-timeout"?12:k.t0==="unspecified-http-error"?12:13;break;case 12:return k.abrupt("return",d("WAResultOrError").makeError({progressMade:!0}));case 13:return k.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError(j)));case 14:case"end":return k.stop()}},null,this)}).then(function(a){return(a=a)!=null?a:d("WAResultOrError").makeError("max-attempts-exceeded")})}g.checkCiphertextInServer=a}),98);
__d("WACreateRetrier",["WAComms","WAGetMediaRoute","WAGlobals","WAMediaOperationsRetrier","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:c==null?void 0:c.addPoint("get_media_route_start");k.next=3;return b("regeneratorRuntime").awrap(d("WAGetMediaRoute").getMediaRoute({operation:"upload",serverMediaType:a},c));case 3:e=k.sent;c==null?void 0:c.addPoint("get_media_route_finish");if(e.success){k.next=7;break}return k.abrupt("return",e);case 7:f=e.value,g=f.selectedHost,h=f.fallbackHost,i=f.authToken;j=new(d("WAMediaOperationsRetrier").MediaOperationsRetrier)("upload",{host:{domain:g.domain,"class":g["class"]},fallbackHost:h&&{domain:h.domain,"class":h["class"]},authToken:i,timeElapsed:null},d("WAGlobals").getConfig().isMediaWaitForConnectionOnRetryEnabled()===!0?d("WAComms").waitForConnection:void 0);return k.abrupt("return",d("WAResultOrError").makeResult(j));case 10:case"end":return k.stop()}},null,this)}g.createUploadRetrier=a}),98);
__d("WAHttpRegularUploadMedia",["WAErr","WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to parse request body ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to initiate fetch ",""]);j=function(){return a};return a}function a(a,e){var f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.prev=0;l.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"text/plain"},body:new Blob([e])}));case 3:f=l.sent;l.next=10;break;case 6:l.prev=6;l.t0=l["catch"](0);d("WALogger").ERROR(j(),l.t0);throw l.t0;case 10:g=f,k=g.status;d("WALogger").LOG(i(),k);l.t1=k;l.next=l.t1===200?15:l.t1===408?16:l.t1===413?17:l.t1===415?18:l.t1===429?19:l.t1===507?19:20;break;case 15:return l.abrupt("return",f.json().then(function(a){if(!Object.prototype.hasOwnProperty.call(a,"direct_path"))throw c("WAErr")("direct_path not available in wa upload http response");if(typeof a.direct_path!=="string")throw c("WAErr")('directPath: "'+a.direct_path+'" is not a string');if(a.object_id&&typeof a.object_id!=="string")throw c("WAErr")('objectId: "'+a.object_id+'" is not a string');if(a.handle&&typeof a.handle!=="string")throw c("WAErr")('handle: "'+a.handle+'" is not a string');a={directPath:a.direct_path,objectId:a.object_id,handle:a.handle};return d("WAResultOrError").makeResult(a)})["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return l.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 17:return l.abrupt("return",d("WAResultOrError").makeError("payload-too-large"));case 18:return l.abrupt("return",d("WAResultOrError").makeError("invalid-media"));case 19:return l.abrupt("return",d("WAResultOrError").makeError("upload-throttled"));case 20:if(!(k>=400&&k<500)){l.next=22;break}return l.abrupt("return",d("WAResultOrError").makeError("request-error"));case 22:return l.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 23:case"end":return l.stop()}},null,this,[[0,6]])}g.httpRegularUploadMedia=a}),98);
__d("WAEncryptAndUploadPlaintext",["WABase64","WAGlobals","WAHttpRegularUploadMedia","WAHttpResumeCheck","WALogger","WAMediaCrypto","WAMediaUrl","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: upload success "," ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext given up"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: start upload media to ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: error during retrier ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Found valid progressiveJpeg details. Adding to media entry."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Created invalid progressiveJpeg details during encrypt and upload: ",""]);o=function(){return a};return a}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.mediaTypeDetails,e=a.plaintextHash,f=a.plaintext,g=a.mediaKey,p=a.mediaKeyTimestamp,q=a.uploadToken,r=a.size,s=a.uploadRetrier,t=a.updateMediaEntry,u=a.mediaUploadQplFlow,v=a.filename,w=a.fromOffset,x=w===void 0?0:w;w=a.getDownloadableThumbnailForMedia;var y,z,A;if(c.type==="preview"){a=(yield d("WAMediaCrypto").computeMediaKeysForPreview(g));y=a.iv;z=a.cipherKey;a=a.hmacKey;A="preview"}else{var B=(yield d("WAMediaCrypto").computeMediaKeys(g,c.mediaType));y=B.iv;z=B.cipherKey;a=B.hmacKey;A=c.mediaType}B=(yield d("WAMediaCrypto").encryptAndHmac(z,y,a,f,A));var C=B.ciphertext,D=B.ciphertextHash;c=B.sidecar;z=B.ivCiphertextHmac;y=null;if(A==="image"){B=(yield d("WAProgressiveJpegGetPJpegDetails").getProgressiveJpegDetails(new Uint8Array(yield d("WAMediaUtils").blobToArrayBuffer(f)),z,a));f=d("WAProgressiveJpegGetPJpegDetails").isValidProgressiveJpegDetails(B);f.success===!1?(d("WALogger").ERROR(o(),f.error),u==null?void 0:u.addPoint(f.error)):f.value===!0&&d("WAGlobals").getConfig().isProgressiveJpegSendEnabled()&&(d("WALogger").LOG(n()),y=B)}z={fileSha256:d("WABase64").decodeB64UrlSafe(e),fileEncSha256:D,mediaKey:g,mediaKeyTimestamp:p,serverMediaType:A,uploadToken:q,sidecar:c,filename:v,progressiveJpegDetails:y,size:r};var E;yield t(z);a=(yield s.run(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=a.domain;var e=x;if(c>0)try{var f=d("WAMediaUrl").buildUploadUrl(A,q,D,a,b,!0);f=(yield d("WAHttpResumeCheck").httpResumeCheck(f));if(f.success){f=f.value;if(f.type==="media-found"){u==null?void 0:u.addAnnotations({bool:{existingMediaFound:!0}});return d("WAResultOrError").makeResult(d("WAResultOrError").makeResult({directPath:f.directPath,objectId:null,handle:null}))}f.type==="media-partial-found"&&(e=f.resumeFromBytes)}}catch(a){d("WALogger").ERROR(m(),a)}e>0&&e<C.byteLength?(u==null?void 0:u.addAnnotations({"int":{fromOffset:e},bool:{continuedFromOffset:!0}}),E=C.subarray(e)):E=C;f=d("WAMediaUrl").buildUploadUrl(A,q,D,a,b,!1,e);d("WALogger").LOG(l(),f);return d("WAHttpRegularUploadMedia").httpRegularUploadMedia(f,E).then(function(a){if(a.success){u==null?void 0:u.addPoint("upload_finish",{"int":{byteLength:E.byteLength,attempt:c}});return d("WAResultOrError").makeResult(a)}else{a=a.error;d("WALogger").LOG(k(),a);switch(a){case"server-timeout":case"unspecified-http-error":return d("WAResultOrError").makeError({progressMade:!0});default:return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a))}}})["catch"](function(a){d("WALogger").ERROR(j(),a);return d("WAResultOrError").makeError({progressMade:!1})})});return function(b,c,d){return a.apply(this,arguments)}}()));if(a==null){d("WALogger").WARN(i());u==null?void 0:u.endFail("maxAttemptsExceeded");return d("WAResultOrError").makeError("max-attempts-exceeded")}if(a.success===!1){u==null?void 0:u.endFail(a.error);return a}f=a.value;B=f.directPath;g=f.objectId;p=f.handle;c=(yield w(e));z=babelHelpers["extends"]({},z,{directPath:B,downloadableThumbnail:c,handle:p,objectId:g});yield t(z);d("WALogger").LOG(h(),{directPath:B},{objectId:g});u==null?void 0:u.endSuccess();return d("WAResultOrError").makeResult(z)});return p.apply(this,arguments)}g.encryptAndUploadPlaintext=a}),98);
__d("WAIsMediaKeyReusable",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=2*d("WATimeUtils").DAY_SECONDS;function a(a){var b=Math.floor(Math.random()*d("WATimeUtils").DAY_SECONDS);return a!=null&&d("WATimeUtils").happenedWithin(a,h+b)}g.MMS_MEDIA_KEY_TTL=h;g.isMediaKeyReusable=a}),98);
__d("WAFindReusableMediaEntry",["WAIsMediaKeyReusable","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==null)return null;b=b.get(a);if(b==null)return null;a=d("WAMediaUtils").decodeMediaEntryData(b);b=a.fileEncSha256;var c=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken;a=babelHelpers.objectWithoutPropertiesLoose(a,["fileEncSha256","mediaKey","mediaKeyTimestamp","uploadToken"]);return c!=null&&f!=null&&b!=null&&e!=null&&d("WAIsMediaKeyReusable").isMediaKeyReusable(e)?babelHelpers["extends"]({},a,{fileEncSha256:b,mediaKey:c,mediaKeyTimestamp:e,uploadToken:f}):null}g.findReusableMediaEntryForArmadillo=a}),98);
__d("WAUploadMedia",["WABase64","WABulkPutMediaKeysApi","WACheckCiphertextInServer","WACreateRetrier","WAEncryptAndUploadPlaintext","WAFindReusableMediaEntry","WAGlobals","WAHashUtils","WALogger","WAMediaUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is not on the server, start uploading"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is partially on the server, start uploading from byteOffset ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is on the server"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume/exist check exhausted available retries"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: async upload"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: no media entry found, need to upload media"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: fail to gather media routes"]);q=function(){return a};return a}function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.chatJid;var b=a.filename,c=a.hash,e=a.mediaTypeDetails,f=a.protocolMsgId,g=a.size,r=a.uploadMediaMetric,t=a.getMediaKnownEntries,u=a.getMediaPlaintext,v=a.updateMediaEntryForMsg,w=a.updateMediaEntryForOptimisticUpload;a=a.getDownloadableThumbnailForMedia;var x;e.type==="regular"?x=e.mediaType:x="preview";var y=(yield d("WACreateRetrier").createUploadRetrier(x,r));if(!y.success){d("WALogger").WARN(q());r==null?void 0:r.endFail("failToGatherMediaRoutes");return y}y=y.value;v=s(f,c,v,w);w=(yield t(c));t=d("WAFindReusableMediaEntry").findReusableMediaEntryForArmadillo(f,w);if(t==null){d("WALogger").LOG(p());f=d("WAMediaUtils").createMediaKey();w=d("WAMediaUtils").createUploadToken();var z=d("WATimeUtils").unixTime(),A=(yield u(c));if(A==null){d("WALogger").ERROR(o());r==null?void 0:r.endFail("missingPlaintext");return d("WAResultOrError").makeError("no-plaintext")}return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,mediaKey:f,mediaKeyTimestamp:z,mediaTypeDetails:e,mediaUploadQplFlow:r,plaintext:A,plaintextHash:c,updateMediaEntry:v,uploadRetrier:y,uploadToken:w,getDownloadableThumbnailForMedia:a})}f=t.directPath;z=t.downloadableThumbnail;A=t.fileEncSha256;w=t.fileSha256;var B=t.mediaKey,C=t.mediaKeyTimestamp,D=t.objectId;t=t.uploadToken;z={directPath:f,downloadableThumbnail:z,fileEncSha256:A,filename:b,fileSha256:w||d("WABase64").decodeB64UrlSafe(c),mediaKey:B,mediaKeyTimestamp:C,objectId:D,serverMediaType:x,size:g,uploadToken:t};if(f!=null){d("WALogger").LOG(n());yield v(z);r==null?void 0:r.endSuccess({bool:{reused_media_entry:!0}});return d("WAResultOrError").makeResult(z)}w=(yield d("WACheckCiphertextInServer").checkCiphertextInServer(x,A,t,y));if(!w.success){d("WALogger").WARN(m());r==null?void 0:r.endFail("failToUpload");return w}D=w.value;if(D.type==="media-found"){d("WALogger").LOG(l());r==null?void 0:r.addAnnotations({bool:{existingMediaFound:!0}});f=babelHelpers["extends"]({},z,{directPath:D.directPath,objectId:D.objectId});yield v(f);r==null?void 0:r.endSuccess({bool:{reused_media_entry:!0}});return d("WAResultOrError").makeResult(f)}else if(D.type==="media-partial-found"){d("WALogger").LOG(k(),D.resumeFromBytes);x=D.resumeFromBytes;A=(yield u(c));if(A==null){d("WALogger").ERROR(j());r==null?void 0:r.endFail("missingPlaintext");return d("WAResultOrError").makeError("no-plaintext")}return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,fromOffset:x,mediaKey:B,mediaKeyTimestamp:C,mediaTypeDetails:e,mediaUploadQplFlow:r,plaintext:A,plaintextHash:c,updateMediaEntry:v,uploadRetrier:y,uploadToken:t,getDownloadableThumbnailForMedia:a})}d("WALogger").LOG(i());w=d("WATimeUtils").unixTime();z=(yield u(c));if(z==null){d("WALogger").ERROR(h());r==null?void 0:r.endFail("missingPlaintext");return d("WAResultOrError").makeError("no-plaintext")}return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,mediaKey:B,mediaKeyTimestamp:w,mediaTypeDetails:e,mediaUploadQplFlow:r,plaintext:z,plaintextHash:c,updateMediaEntry:v,uploadRetrier:y,uploadToken:t,getDownloadableThumbnailForMedia:a})});return r.apply(this,arguments)}function s(a,c,e,f){return function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){if(d("WAGlobals").getConfig().useProtocolMediaKey()){var g;g={directPath:b.directPath,fbid:(g=b.fbid)!=null?g:void 0,fileEncSha256:b.fileEncSha256,fileSha256:d("WABase64").decodeB64UrlSafe(c),mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp,objectId:(g=b.objectId)!=null?g:void 0,plaintextHash:c,ciphertextHash:d("WAHashUtils").toCiphertextHash(b.fileEncSha256),serverMediaType:b.serverMediaType,sidecar:b.sidecar,scanLengths:void 0,uploadToken:b.uploadToken,size:void 0};yield d("WABulkPutMediaKeysApi").bulkPutMediaKeys([g])}var h=d("WAMediaUtils").encodeMediaEntryForUpload(b);if(a==null)return f(c,function(){return h},b==null?void 0:b.objectId,b==null?void 0:b.serverMediaType);else return e(c,a,function(){return h},b==null?void 0:b.objectId,b==null?void 0:b.serverMediaType)});function h(a){return g.apply(this,arguments)}return h}()}g.uploadMedia=a}),98);
__d("WAAPIEager",["WAAPIMetrics","WABulkSetRotateSenderKeyToTrueApi","WADbRegistrationApi","WADownloadMedia","WAGenerateAndUploadPreKeys","WAGetCurrentUserDeviceList","WAGetDevices","WANotifyDeviceChange","WAPreEstablishOutgoingSessionForGroup","WAQueryGroups","WARemoveCurrentDevice","WARemoveDevice","WASendAppDataFanoutProtocol","WASendMsgUtilV2","WASendPing","WASyncAbProps","WAUploadMedia"],(function(a,b,c,d,e,f,g){"use strict";a={getCurrentUserDeviceList:function(){return d("WAAPIMetrics").withMetrics(d("WAGetCurrentUserDeviceList").getCurrentUserDeviceList,"getCurrentUserDeviceList")()},syncAbProps:function(){return d("WAAPIMetrics").withMetrics(d("WASyncAbProps").syncAbProps,"syncAbProps").apply(void 0,arguments)},generateAndUploadPreKeys:function(){return d("WAAPIMetrics").withMetrics(d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys,"generateAndUploadPreKeys").apply(void 0,arguments)},getDevicesBeforeSend:function(){return d("WAAPIMetrics").withMetrics(d("WASendMsgUtilV2").getDevicesBeforeSend,"getDevicesBeforeSend").apply(void 0,arguments)},preEstablishSession:function(){return d("WAAPIMetrics").withMetrics(d("WAPreEstablishOutgoingSessionForGroup").preEstablishSession,"preEstablishSession").apply(void 0,arguments)},sendChatMessage:function(){return d("WAAPIMetrics").withMetrics(d("WASendMsgUtilV2").sendChatMessage,"sendChatMessage").apply(void 0,arguments)},updateClockSkew:function(){return d("WAAPIMetrics").withMetrics(d("WASendPing").updateClockSkew,"updateClockSkew").apply(void 0,arguments)},queryGroups:function(){return d("WAAPIMetrics").withMetrics(d("WAQueryGroups").queryGroups,"queryGroups").apply(void 0,arguments)},getDevices:function(){return d("WAAPIMetrics").withMetrics(d("WAGetDevices").getDevices,"getDevices").apply(void 0,arguments)},removeDevice:function(){return d("WAAPIMetrics").withMetrics(d("WARemoveDevice").removeDevice,"removeDevice").apply(void 0,arguments)},removeCurrentDevice:function(){return d("WAAPIMetrics").withMetrics(d("WARemoveCurrentDevice").removeCurrentDevice,"removeCurrentDevice")()},notifyDeviceChange:function(){return d("WAAPIMetrics").withMetrics(d("WANotifyDeviceChange").notifyDeviceChange,"notifyDeviceChange").apply(void 0,arguments)},saveLastSessionDeviceWasLinkedTo:function(){return d("WAAPIMetrics").withMetrics(d("WADbRegistrationApi").saveLastSessionDeviceWasLinkedTo,"saveLastSessionDeviceWasLinkedTo").apply(void 0,arguments)},sendAppData:function(){return d("WAAPIMetrics").withMetrics(d("WASendAppDataFanoutProtocol").sendAppDataToDevicesProtocol,"sendAppData").apply(void 0,arguments)},setRotateSenderKeyToTrue:function(){return d("WAAPIMetrics").withMetrics(d("WABulkSetRotateSenderKeyToTrueApi").bulkSetRotateSenderKeyToTrue,"setRotateSenderKeyToTrue").apply(void 0,arguments)},uploadMedia:function(a){return d("WAUploadMedia").uploadMedia(a)},downloadMedia:function(a){return d("WADownloadMedia").downloadMedia(a)}};b=a;g["default"]=b}),98);/*FB_PKG_DELIM*/
/**
 * License: https://www.facebook.com/legal/license/yKsQCAUqcFZ/
 */
__d("dexie-4.0.1-alpha.22",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){(function(b,c){typeof g==="object"&&typeof h!=="undefined"?h.exports=c():(b=typeof globalThis!=="undefined"?globalThis:b||self,b.Dexie=c())})(this,function(){var b=function(a,c){b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};return b(a,c)};function c(a,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");b(a,c);function d(){this.constructor=a}a.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d())}var d=function(){d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return d.apply(this,arguments)};function e(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++)(f||!(d in b))&&(f||(f=Array.prototype.slice.call(b,0,d)),f[d]=b[d]);return a.concat(f||Array.prototype.slice.call(b))}var f=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:a,g=Object.keys,h=Array.isArray;typeof Promise!=="undefined"&&!f.Promise&&(f.Promise=Promise);function i(a,b){if(typeof b!=="object")return a;g(b).forEach(function(c){a[c]=b[c]});return a}var j=Object.getPrototypeOf,k={}.hasOwnProperty;function l(a,b){return k.call(a,b)}function m(a,b){typeof b==="function"&&(b=b(j(a))),(typeof Reflect==="undefined"?g:Reflect.ownKeys)(b).forEach(function(c){o(a,c,b[c])})}var n=Object.defineProperty;function o(a,b,c,d){n(a,b,i(c&&l(c,"get")&&typeof c.get==="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},d))}function p(a){return{from:function(b){a.prototype=Object.create(b.prototype);o(a.prototype,"constructor",a);return{extend:m.bind(null,a.prototype)}}}}var q=Object.getOwnPropertyDescriptor;function r(a,b){var c=q(a,b);return c||(c=j(a))&&r(c,b)}var s=[].slice;function t(a,b,c){return s.call(a,b,c)}function u(a,b){return b(a)}function v(a){if(!a)throw new Error("Assertion Failed")}function aa(a){f.setImmediate?setImmediate(a):setTimeout(a,0)}function ba(a,b){return a.reduce(function(a,c,d){c=b(c,d);c&&(a[c[0]]=c[1]);return a},{})}function ca(a,b,c){try{a.apply(null,c)}catch(a){b&&b(a)}}function w(a,b){if(l(a,b))return a[b];if(!b)return a;if(typeof b!=="string"){var c=[];for(var d=0,e=b.length;d<e;++d){var f=w(a,b[d]);c.push(f)}return c}f=b.indexOf(".");if(f!==-1){d=a[b.substr(0,f)];return d===void 0?void 0:w(d,b.substr(f+1))}return void 0}function x(a,b,c){if(!a||b===void 0)return;if("isFrozen"in Object&&Object.isFrozen(a))return;if(typeof b!=="string"&&"length"in b){v(typeof c!=="string"&&"length"in c);for(var d=0,e=b.length;d<e;++d)x(a,b[d],c[d])}else{d=b.indexOf(".");if(d!==-1){e=b.substr(0,d);d=b.substr(d+1);if(d==="")c===void 0?h(a)&&!isNaN(parseInt(e))?a.splice(e,1):delete a[e]:a[e]=c;else{var f=a[e];(!f||!l(a,e))&&(f=a[e]={});x(f,d,c)}}else c===void 0?h(a)&&!isNaN(parseInt(b))?a.splice(b,1):delete a[b]:a[b]=c}}function da(a,b){typeof b==="string"?x(a,b,void 0):"length"in b&&[].map.call(b,function(b){x(a,b,void 0)})}function ea(a){var b={};for(var c in a)l(a,c)&&(b[c]=a[c]);return b}var fa=[].concat;function ga(a){return fa.apply([],a)}var y="Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ga([8,16,32,64].map(function(a){return["Int","Uint","Float"].map(function(b){return b+a+"Array"})}))).filter(function(a){return f[a]}),ha=new Set(y.map(function(a){return f[a]}));function ia(a){var b={};for(var c in a)if(l(a,c)){var d=a[c];b[c]=!d||typeof d!=="object"||ha.has(d.constructor)?d:ia(d)}return b}function ja(a){for(var b in a)if(l(a,b))return!1;return!0}var ka=null;function z(a){ka=new WeakMap();a=la(a);ka=null;return a}function la(a){if(!a||typeof a!=="object")return a;var b=ka.get(a);if(b)return b;if(h(a)){b=[];ka.set(a,b);for(var c=0,d=a.length;c<d;++c)b.push(la(a[c]))}else if(ha.has(a.constructor))b=a;else{c=j(a);b=c===Object.prototype?{}:Object.create(c);ka.set(a,b);for(d in a)l(a,d)&&(b[d]=la(a[d]))}return b}var ma={}.toString;function na(a){return ma.call(a).slice(8,-1)}var oa=typeof Symbol!=="undefined"?Symbol.iterator:"@@iterator",pa=typeof oa==="symbol"?function(a){var b;return a!=null&&(b=a[oa])&&b.apply(a)}:function(){return null};function qa(a,b){b=a.indexOf(b);b>=0&&a.splice(b,1);return b>=0}var ra={};function A(a){var b,c,d,e;if(arguments.length===1){if(h(a))return a.slice();if(this===ra&&typeof a==="string")return[a];if(e=pa(a)){c=[];while(d=e.next(),!d.done)c.push(d.value);return c}if(a==null)return[a];b=a.length;if(typeof b==="number"){c=new Array(b);while(b--)c[b]=a[b];return c}return[a]}b=arguments.length;c=new Array(b);while(b--)c[b]=arguments[b];return c}var sa=typeof Symbol!=="undefined"?function(a){return a[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},B=typeof location!=="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ta(a,b){B=a,ua=b}var ua=function(){return!0},va=!new Error("").stack;function C(){if(va)try{C.arguments;throw new Error()}catch(a){return a}return new Error()}function wa(a,b){var c=a.stack;if(!c)return"";b=b||0;c.indexOf(a.name)===0&&(b+=(a.name+a.message).split("\n").length);return c.split("\n").slice(b).filter(ua).map(function(a){return"\n"+a}).join("")}y=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"];var D=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"];y=y.concat(D);var xa={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ya(a,b){this._e=C(),this.name=a,this.message=b}p(ya).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+wa(this._e,2))}},toString:function(){return this.name+": "+this.message}});function za(a,b){return a+". Errors: "+Object.keys(b).map(function(a){return b[a].toString()}).filter(function(a,b,c){return c.indexOf(a)===b}).join("\n")}function Aa(a,b,c,d){this._e=C(),this.failures=b,this.failedKeys=d,this.successCount=c,this.message=za(a,b)}p(Aa).from(ya);function Ba(a,b){this._e=C(),this.name="BulkError",this.failures=Object.keys(b).map(function(a){return b[a]}),this.failuresByPos=b,this.message=za(a,this.failures)}p(Ba).from(ya);var Ca=y.reduce(function(a,b){return a[b]=b+"Error",a},{}),Da=ya,E=y.reduce(function(b,c){var d=c+"Error";function a(a,b){this._e=C(),this.name=d,!a?(this.message=xa[c]||d,this.inner=null):typeof a==="string"?(this.message="".concat(a).concat(b?"\n "+b:""),this.inner=b||null):typeof a==="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a)}p(a).from(Da);b[c]=a;return b},{});E.Syntax=SyntaxError;E.Type=TypeError;E.Range=RangeError;var Ea=D.reduce(function(a,b){a[b+"Error"]=E[b];return a},{});function Fa(a,b){if(!a||a instanceof ya||a instanceof TypeError||a instanceof SyntaxError||!a.name||!Ea[a.name])return a;b=new Ea[a.name](b||a.message,a);"stack"in a&&o(b,"stack",{get:function(){return this.inner.stack}});return b}D=y.reduce(function(a,b){["Syntax","Type","Range"].indexOf(b)===-1&&(a[b+"Error"]=E[b]);return a},{});D.ModifyError=Aa;D.DexieError=ya;D.BulkError=Ba;function F(){}function Ga(a){return a}function Ha(a,b){return a==null||a===Ga?b:function(c){return b(a(c))}}function G(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}function Ia(a,b){return a===F?b:function(){var c=a.apply(this,arguments);c!==void 0&&(arguments[0]=c);var d=this.onsuccess,e=this.onerror;this.onsuccess=null;this.onerror=null;var f=b.apply(this,arguments);d&&(this.onsuccess=this.onsuccess?G(d,this.onsuccess):d);e&&(this.onerror=this.onerror?G(e,this.onerror):e);return f!==void 0?f:c}}function Ja(a,b){return a===F?b:function(){a.apply(this,arguments);var c=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null;b.apply(this,arguments);c&&(this.onsuccess=this.onsuccess?G(c,this.onsuccess):c);d&&(this.onerror=this.onerror?G(d,this.onerror):d)}}function Ka(a,b){return a===F?b:function(c){var d=a.apply(this,arguments);i(c,d);var e=this.onsuccess,f=this.onerror;this.onsuccess=null;this.onerror=null;var g=b.apply(this,arguments);e&&(this.onsuccess=this.onsuccess?G(e,this.onsuccess):e);f&&(this.onerror=this.onerror?G(f,this.onerror):f);return d===void 0?g===void 0?void 0:g:i(d,g)}}function La(a,b){return a===F?b:function(){return b.apply(this,arguments)===!1?!1:a.apply(this,arguments)}}function Ma(a,b){return a===F?b:function(){var c=a.apply(this,arguments);if(c&&typeof c.then==="function"){var d=this,e=arguments.length,f=new Array(e);while(e--)f[e]=arguments[e];return c.then(function(){return b.apply(d,f)})}return b.apply(this,arguments)}}var Na={},Oa=100,Pa=20,Qa=100;y=typeof Promise==="undefined"?[]:function(){var a=Promise.resolve();if(typeof crypto==="undefined"||!crypto.subtle)return[a,j(a),a];var b=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[b,j(b),a]}();var Ra=y[0],Sa=y[1],Ta=y[2],Ua=Sa&&Sa.then,Va=Ra&&Ra.constructor,Wa=!!Ta,Xa=!1,Ya=Ta?function(){Ta.then(pb)}:f.setImmediate?setImmediate.bind(null,pb):f.MutationObserver?function(){var a=document.createElement("div");new MutationObserver(function(){pb(),a=null}).observe(a,{attributes:!0});a.setAttribute("i","1")}:function(){setTimeout(pb,0)},Za=function(a,b){eb.push([a,b]),ab&&(Ya(),ab=!1)},$a=!0,ab=!0,H=[],bb=[],cb=null,db=Ga,I={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:F,pgp:!1,env:{},finalize:F},J=I,eb=[],K=0,fb=[];function L(a){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");this._listeners=[];this._lib=!1;var b=this._PSD=J;B&&(this._stackHolder=C(),this._prev=null,this._numPrev=0);if(typeof a!=="function"){if(a!==Na)throw new TypeError("Not a function");this._state=arguments[1];this._value=arguments[2];this._state===!1&&jb(this,this._value);return}this._state=null;this._value=null;++b.ref;ib(this,a)}var gb={get:function(){var a=J,b=Ab;function c(c,d){var e=this,f=!a.global&&(a!==J||b!==Ab),g=f&&!P(),h=new L(function(b,h){lb(e,new hb(Jb(c,a,f,g),Jb(d,a,f,g),b,h,a))});B&&ob(h,this);return h}c.prototype=Na;return c},set:function(a){o(this,"then",a&&a.prototype===Na?gb:{get:function(){return a},set:gb.set})}};m(L.prototype,{then:gb,_then:function(a,b){lb(this,new hb(null,null,a,b,J))},"catch":function(b){if(arguments.length===1)return this.then(null,b);var a=arguments[0],c=arguments[1];return typeof a==="function"?this.then(null,function(b){return b instanceof a?c(b):wb(b)}):this.then(null,function(b){return b&&b.name===a?c(b):wb(b)})},"finally":function(a){return this.then(function(b){a();return b},function(b){a();return wb(b)})},stack:{get:function(){if(this._stack)return this._stack;try{Xa=!0;var a=nb(this,[],Pa);a=a.join("\nFrom previous: ");this._state!==null&&(this._stack=a);return a}finally{Xa=!1}}},timeout:function(a,b){var c=this;return a<Infinity?new L(function(d,e){var f=setTimeout(function(){return e(new E.Timeout(b))},a);c.then(d,e)["finally"](clearTimeout.bind(null,f))}):this}});typeof Symbol!=="undefined"&&Symbol.toStringTag&&o(L.prototype,Symbol.toStringTag,"Dexie.Promise");I.env=Gb();function hb(a,b,c,d,e){this.onFulfilled=typeof a==="function"?a:null,this.onRejected=typeof b==="function"?b:null,this.resolve=c,this.reject=d,this.psd=e}m(L,{all:function(){var a=A.apply(null,arguments).map(Db);return new L(function(b,c){a.length===0&&b([]);var d=a.length;a.forEach(function(e,f){return L.resolve(e).then(function(c){a[f]=c,--d||b(a)},c)})})},resolve:function(a){if(a instanceof L)return a;if(a&&typeof a.then==="function")return new L(function(b,c){a.then(b,c)});var b=new L(Na,!0,a);ob(b,cb);return b},reject:wb,race:function(){var a=A.apply(null,arguments).map(Db);return new L(function(b,c){a.map(function(a){return L.resolve(a).then(b,c)})})},PSD:{get:function(){return J},set:function(a){return J=a}},totalEchoes:{get:function(){return Ab}},newPSD:O,usePSD:Hb,scheduler:{get:function(){return Za},set:function(a){Za=a}},rejectionMapper:{get:function(){return db},set:function(a){db=a}},follow:function(a,b){return new L(function(c,d){return O(function(b,c){var d=J;d.unhandleds=[];d.onunhandled=c;d.finalize=G(function(){var a=this;tb(function(){a.unhandleds.length===0?b():c(a.unhandleds[0])})},d.finalize);a()},b,c,d)})}});Va&&(Va.allSettled&&o(L,"allSettled",function(){var a=A.apply(null,arguments).map(Db);return new L(function(b){a.length===0&&b([]);var c=a.length,d=new Array(c);a.forEach(function(a,e){return L.resolve(a).then(function(a){return d[e]={status:"fulfilled",value:a}},function(a){return d[e]={status:"rejected",reason:a}}).then(function(){return--c||b(d)})})})}),Va.any&&typeof AggregateError!=="undefined"&&o(L,"any",function(){var a=A.apply(null,arguments).map(Db);return new L(function(b,c){a.length===0&&c(new AggregateError([]));var d=a.length,e=new Array(d);a.forEach(function(a,f){return L.resolve(a).then(function(a){return b(a)},function(a){e[f]=a,--d||c(new AggregateError(e))})})})}));function ib(a,b){try{b(function(b){if(a._state!==null)return;if(b===a)throw new TypeError("A promise cannot be resolved with itself.");var c=a._lib&&qb();b&&typeof b.then==="function"?ib(a,function(a,c){b instanceof L?b._then(a,c):b.then(a,c)}):(a._state=!0,a._value=b,kb(a));c&&rb()},jb.bind(null,a))}catch(b){jb(a,b)}}function jb(a,b){bb.push(b);if(a._state!==null)return;var c=a._lib&&qb();b=db(b);a._state=!1;a._value=b;B&&b!==null&&typeof b==="object"&&!b._promise&&ca(function(){var c=r(b,"stack");b._promise=a;o(b,"stack",{get:function(){return Xa?c&&(c.get?c.get.apply(b):c.value):a.stack}})});ub(a);kb(a);c&&rb()}function kb(a){var b=a._listeners;a._listeners=[];for(var c=0,d=b.length;c<d;++c)lb(a,b[c]);c=a._PSD;--c.ref||c.finalize();K===0&&(++K,Za(function(){--K===0&&sb()},[]))}function lb(a,b){if(a._state===null){a._listeners.push(b);return}var c=a._state?b.onFulfilled:b.onRejected;if(c===null)return(a._state?b.resolve:b.reject)(a._value);++b.psd.ref;++K;Za(mb,[c,a,b])}function mb(a,b,c){try{cb=b;var d,e=b._value;b._state?d=a(e):(bb.length&&(bb=[]),d=a(e),bb.indexOf(e)===-1&&vb(b));c.resolve(d)}catch(a){c.reject(a)}finally{cb=null,--K===0&&sb(),--c.psd.ref||c.psd.finalize()}}function nb(a,b,c){if(b.length===c)return b;var d="";if(a._state===!1){var e=a._value,f,g;e!=null?(f=e.name||"Error",g=e.message||e,d=wa(e,0)):(f=e,g="");b.push(f+(g?": "+g:"")+d)}B&&(d=wa(a._stackHolder,2),d&&b.indexOf(d)===-1&&b.push(d),a._prev&&nb(a._prev,b,c));return b}function ob(a,b){var c=b?b._numPrev+1:0;c<Oa&&(a._prev=b,a._numPrev=c)}function pb(){qb()&&rb()}function qb(){var a=$a;$a=!1;ab=!1;return a}function rb(){var a,b,c;do while(eb.length>0){a=eb;eb=[];c=a.length;for(b=0;b<c;++b){var d=a[b];d[0].apply(null,d[1])}}while(eb.length>0);$a=!0;ab=!0}function sb(){var a=H;H=[];a.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)});a=fb.slice(0);var b=a.length;while(b)a[--b]()}function tb(a){function b(){a(),fb.splice(fb.indexOf(b),1)}fb.push(b);++K;Za(function(){--K===0&&sb()},[])}function ub(a){H.some(function(b){return b._value===a._value})||H.push(a)}function vb(a){var b=H.length;while(b)if(H[--b]._value===a._value){H.splice(b,1);return}}function wb(a){return new L(Na,!1,a)}function M(a,b){var c=J;return function(){var d=qb(),e=J;try{Q(c,!0);return a.apply(this,arguments)}catch(a){b&&b(a)}finally{Q(e,!1),d&&rb()}}}var N={awaits:0,echoes:0,id:0},xb=0,yb=[],zb=0,Ab=0,Bb=0;function O(b,a,c,d){var e=J,f=Object.create(e);f.parent=e;f.ref=0;f.global=!1;f.id=++Bb;var g=I.env;f.env=Wa?{Promise:L,PromiseProp:{value:L,configurable:!0,writable:!0},all:L.all,race:L.race,allSettled:L.allSettled,any:L.any,resolve:L.resolve,reject:L.reject,nthen:Kb(g.nthen,f),gthen:Kb(g.gthen,f)}:{};a&&i(f,a);++e.ref;f.finalize=function(){--this.parent.ref||this.parent.finalize()};g=Hb(f,b,c,d);f.ref===0&&f.finalize();return g}function Cb(){N.id||(N.id=++xb);++N.awaits;N.echoes+=Qa;return N.id}function P(){if(!N.awaits)return!1;--N.awaits===0&&(N.id=0);N.echoes=N.awaits*Qa;return!0}(""+Ua).indexOf("[native code]")===-1&&(Cb=P=F);function Db(a){if(N.echoes&&a&&a.constructor===Va){Cb();return a.then(function(a){P();return a},function(a){P();return R(a)})}return a}function Eb(a){++Ab,(!N.echoes||--N.echoes===0)&&(N.echoes=N.id=0),yb.push(J),Q(a,!0)}function Fb(){var a=yb[yb.length-1];yb.pop();Q(a,!1)}function Q(a,b){var c=J;(b?N.echoes&&(!zb++||a!==J):zb&&(!--zb||a!==J))&&Ib(b?Eb.bind(null,a):Fb);if(a===J)return;J=a;c===I&&(I.env=Gb());if(Wa){b=I.env.Promise;var d=a.env;Sa.then=d.nthen;b.prototype.then=d.gthen;(c.global||a.global)&&(Object.defineProperty(f,"Promise",d.PromiseProp),b.all=d.all,b.race=d.race,b.resolve=d.resolve,b.reject=d.reject,d.allSettled&&(b.allSettled=d.allSettled),d.any&&(b.any=d.any))}}function Gb(){var a=f.Promise;return Wa?{Promise:a,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:a.all,race:a.race,allSettled:a.allSettled,any:a.any,resolve:a.resolve,reject:a.reject,nthen:Sa.then,gthen:a.prototype.then}:{}}function Hb(a,b,c,d,e){var f=J;try{Q(a,!0);return b(c,d,e)}finally{Q(f,!1)}}function Ib(a){Ua.call(Ra,a)}function Jb(a,b,c,d){return typeof a!=="function"?a:function(){var e=J;c&&Cb();Q(b,!0);try{return a.apply(this,arguments)}finally{Q(e,!1),d&&Ib(P)}}}function Kb(a,b){return function(c,d){return a.call(this,Jb(c,b),Jb(d,b))}}var R=L.reject;function Lb(a,b,c,d){if(!a.idbdb||!a._state.openComplete&&!J.letThrough&&!a._vip){if(a._state.openComplete)return R(new E.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._options.autoOpen)return R(new E.DatabaseClosed());a.open()["catch"](F)}return a._state.dbReadyPromise.then(function(){return Lb(a,b,c,d)})}else{var e=a._createTransaction(b,c,a._dbSchema);try{e.create(),a._state.PR1398_maxLoop=3}catch(e){if(e.name===Ca.InvalidState&&a.isOpen()&&--a._state.PR1398_maxLoop>0){a._close();return a.open().then(function(){return Lb(a,b,c,d)})}return R(e)}return e._promise(b,function(a,b){return O(function(){J.trans=e;return d(a,b,e)})}).then(function(a){if(b==="readwrite")try{e.idbtrans.commit()}catch(a){}return b==="readonly"?a:e._completion.then(function(){return a})})}}y="4.0.1-alpha.22";var Mb=String.fromCharCode(65535),Nb=-Infinity,S="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ob="String expected.",Pb=[],Qb=typeof navigator!=="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Rb=Qb,Sb=Qb,Tb=function(a){return!/(dexie\.js|dexie\.min\.js)/.test(a)},Ub="__dbnames",Vb="readonly",Wb="readwrite";function Xb(a,b){return a?b?function(){return a.apply(this,arguments)&&b.apply(this,arguments)}:a:b}var Yb={type:3,lower:-Infinity,lowerOpen:!1,upper:[[]],upperOpen:!1};function Zb(a){return typeof a==="string"&&!/\./.test(a)?function(b){b[a]===void 0&&a in b&&(b=z(b),delete b[a]);return b}:function(a){return a}}function $b(){throw E.Type()}function T(a,b){try{var c=cc(a),d=cc(b);if(c!==d){if(c==="Array")return 1;if(d==="Array")return-1;if(c==="binary")return 1;if(d==="binary")return-1;if(c==="string")return 1;if(d==="string")return-1;if(c==="Date")return 1;return d!=="Date"?NaN:-1}switch(c){case"number":case"Date":case"string":return a>b?1:a<b?-1:0;case"binary":return bc(dc(a),dc(b));case"Array":return ac(a,b)}}catch(a){}return NaN}function ac(a,b){var c=a.length,d=b.length,e=c<d?c:d;for(var f=0;f<e;++f){var g=T(a[f],b[f]);if(g!==0)return g}return c===d?0:c<d?-1:1}function bc(a,b){var c=a.length,d=b.length,e=c<d?c:d;for(var f=0;f<e;++f)if(a[f]!==b[f])return a[f]<b[f]?-1:1;return c===d?0:c<d?-1:1}function cc(a){var b=typeof a;if(b!=="object")return b;if(ArrayBuffer.isView(a))return"binary";b=na(a);return b==="ArrayBuffer"?"binary":b}function dc(a){if(a instanceof Uint8Array)return a;return ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a)}var ec=function(){function a(){}a.prototype._trans=function(a,b,c){var d=this._tx||J.trans,e=this.name;function f(c,d,a){if(!a.schema[e])throw new E.NotFound("Table "+e+" not part of transaction");return b(a.idbtrans,a)}var g=qb();try{return d&&d.db===this.db?d===J.trans?d._promise(a,f,c):O(function(){return d._promise(a,f,c)},{trans:d,transless:J.transless||J}):Lb(this.db,a,[this.name],f)}finally{g&&rb()}};a.prototype.get=function(a,b){var c=this;return a&&a.constructor===Object?this.where(a).first(b):this._trans("readonly",function(b){return c.core.get({trans:b,key:a}).then(function(a){return c.hook.reading.fire(a)})}).then(b)};a.prototype.where=function(a){if(typeof a==="string")return new this.db.WhereClause(this,a);if(h(a))return new this.db.WhereClause(this,"[".concat(a.join("+"),"]"));var b=g(a);if(b.length===1)return this.where(b[0]).equals(a[b[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(a){if(a.compound&&b.every(function(b){return a.keyPath.indexOf(b)>=0})){for(var c=0;c<b.length;++c)if(b.indexOf(a.keyPath[c])===-1)return!1;return!0}return!1}).sort(function(a,b){return a.keyPath.length-b.keyPath.length})[0];if(c&&this.db._maxKey!==Mb){var d=c.keyPath.slice(0,b.length);return this.where(d).equals(d.map(function(b){return a[b]}))}!c&&B&&!1;var e=this.schema.idxByName,f=this.db._deps.indexedDB;function i(a,b){return f.cmp(a,b)===0}d=b.reduce(function(b,c){var d=b[0];b=b[1];var f=e[c],g=a[c];return[d||f,d||!f?Xb(b,f&&f.multi?function(a){a=w(a,c);return h(a)&&a.some(function(a){return i(g,a)})}:function(a){return i(g,w(a,c))}):b]},[null,null]);var j=d[0];d=d[1];return j?this.where(j.name).equals(a[j.keyPath]).filter(d):c?this.filter(d):this.where(b).equals("")};a.prototype.filter=function(a){return this.toCollection().and(a)};a.prototype.count=function(a){return this.toCollection().count(a)};a.prototype.offset=function(a){return this.toCollection().offset(a)};a.prototype.limit=function(a){return this.toCollection().limit(a)};a.prototype.each=function(a){return this.toCollection().each(a)};a.prototype.toArray=function(a){return this.toCollection().toArray(a)};a.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))};a.prototype.orderBy=function(a){return new this.db.Collection(new this.db.WhereClause(this,h(a)?"[".concat(a.join("+"),"]"):a))};a.prototype.reverse=function(){return this.toCollection().reverse()};a.prototype.mapToClass=function(a){var b=this,d=b.db,e=b.name;this.schema.mappedClass=a;a.prototype instanceof $b&&(a=function(a){c(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}Object.defineProperty(b.prototype,"db",{get:function(){return d},enumerable:!1,configurable:!0});b.prototype.table=function(){return e};return b}(a));var f=new Set();for(b=a.prototype;b;b=j(b))Object.getOwnPropertyNames(b).forEach(function(a){return f.add(a)});b=function(b){if(!b)return b;var c=Object.create(a.prototype);for(var d in b)if(!f.has(d))try{c[d]=b[d]}catch(a){}return c};this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook);this.schema.readHook=b;this.hook("reading",b);return a};a.prototype.defineClass=function(){function a(a){i(this,a)}return this.mapToClass(a)};a.prototype.add=function(a,b){var c=this,d=this.schema.primKey,e=d.auto,f=d.keyPath,g=a;f&&e&&(g=Zb(f)(a));return this._trans("readwrite",function(a){return c.core.mutate({trans:a,type:"add",keys:b!=null?[b]:null,values:[g]})}).then(function(a){return a.numFailures?L.reject(a.failures[0]):a.lastResult}).then(function(b){if(f)try{x(a,f,b)}catch(a){}return b})};a.prototype.update=function(a,b){if(typeof a==="object"&&!h(a)){var c=w(a,this.schema.primKey.keyPath);return c===void 0?R(new E.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(b)}else return this.where(":id").equals(a).modify(b)};a.prototype.put=function(a,b){var c=this,d=this.schema.primKey,e=d.auto,f=d.keyPath,g=a;f&&e&&(g=Zb(f)(a));return this._trans("readwrite",function(a){return c.core.mutate({trans:a,type:"put",values:[g],keys:b!=null?[b]:null})}).then(function(a){return a.numFailures?L.reject(a.failures[0]):a.lastResult}).then(function(b){if(f)try{x(a,f,b)}catch(a){}return b})};a.prototype["delete"]=function(a){var b=this;return this._trans("readwrite",function(c){return b.core.mutate({trans:c,type:"delete",keys:[a]})}).then(function(a){return a.numFailures?L.reject(a.failures[0]):void 0})};a.prototype.clear=function(){var a=this;return this._trans("readwrite",function(b){return a.core.mutate({trans:b,type:"deleteRange",range:Yb})}).then(function(a){return a.numFailures?L.reject(a.failures[0]):void 0})};a.prototype.bulkGet=function(a){var b=this;return this._trans("readonly",function(c){return b.core.getMany({keys:a,trans:c}).then(function(a){return a.map(function(a){return b.hook.reading.fire(a)})})})};a.prototype.bulkAdd=function(b,c,d){var e=this,a=Array.isArray(c)?c:void 0;d=d||(a?void 0:c);var f=d?d.allKeys:void 0;return this._trans("readwrite",function(c){var d=e.schema.primKey,g=d.auto;d=d.keyPath;if(d&&a)throw new E.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==b.length)throw new E.InvalidArgument("Arguments objects and keys must have the same length");var h=b.length;g=d&&g?b.map(Zb(d)):b;return e.core.mutate({trans:c,type:"add",keys:a,values:g,wantResults:f}).then(function(a){var b=a.numFailures,c=a.results,d=a.lastResult;a=a.failures;c=f?c:d;if(b===0)return c;throw new Ba("".concat(e.name,".bulkAdd(): ").concat(b," of ").concat(h," operations failed"),a)})})};a.prototype.bulkPut=function(b,c,d){var e=this,a=Array.isArray(c)?c:void 0;d=d||(a?void 0:c);var f=d?d.allKeys:void 0;return this._trans("readwrite",function(c){var d=e.schema.primKey,g=d.auto;d=d.keyPath;if(d&&a)throw new E.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==b.length)throw new E.InvalidArgument("Arguments objects and keys must have the same length");var h=b.length;g=d&&g?b.map(Zb(d)):b;return e.core.mutate({trans:c,type:"put",keys:a,values:g,wantResults:f}).then(function(a){var b=a.numFailures,c=a.results,d=a.lastResult;a=a.failures;c=f?c:d;if(b===0)return c;throw new Ba("".concat(e.name,".bulkPut(): ").concat(b," of ").concat(h," operations failed"),a)})})};a.prototype.bulkUpdate=function(b){var c=this,d=this.core,a=b.map(function(a){return a.key}),e=b.map(function(a){return a.changes}),f=[];return this._trans("readwrite",function(g){return d.getMany({trans:g,keys:a,cache:"clone"}).then(function(h){var i=[],j=[];b.forEach(function(a,b){var d=a.key;a=a.changes;var e=h[b];if(e){for(var g=0,k=Object.keys(a);g<k.length;g++){var l=k[g],m=a[l];if(l===c.schema.primKey.keyPath){if(T(m,d)!==0)throw new E.Constraint("Cannot update primary key in bulkUpdate()")}else x(e,l,m)}f.push(b);i.push(d);j.push(e)}});var k=i.length;return d.mutate({trans:g,type:"put",keys:i,values:j,updates:{keys:a,changeSpecs:e}}).then(function(a){var b=a.numFailures;a=a.failures;if(b===0)return k;for(var d=0,e=Object.keys(a);d<e.length;d++){var g=e[d],h=f[Number(g)];if(h!=null){var i=a[g];delete a[g];a[h]=i}}throw new Ba("".concat(c.name,".bulkUpdate(): ").concat(b," of ").concat(k," operations failed"),a)})})})};a.prototype.bulkDelete=function(a){var b=this,c=a.length;return this._trans("readwrite",function(c){return b.core.mutate({trans:c,type:"delete",keys:a})}).then(function(a){var d=a.numFailures,e=a.lastResult;a=a.failures;if(d===0)return e;throw new Ba("".concat(b.name,".bulkDelete(): ").concat(d," of ").concat(c," operations failed"),a)})};return a}();function fc(a){var b={},c=function(d,e){if(e){var c=arguments.length,f=new Array(c-1);while(--c)f[c-1]=arguments[c];b[d].subscribe.apply(null,f);return a}else if(typeof d==="string")return b[d]};c.addEventType=f;for(var d=1,e=arguments.length;d<e;++d)f(arguments[d]);return c;function f(a,d,e){if(typeof a==="object")return i(a);d||(d=La);e||(e=F);var f={subscribers:[],fire:e,subscribe:function(a){f.subscribers.indexOf(a)===-1&&(f.subscribers.push(a),f.fire=d(f.fire,a))},unsubscribe:function(a){f.subscribers=f.subscribers.filter(function(b){return b!==a}),f.fire=f.subscribers.reduce(d,e)}};b[a]=c[a]=f;return f}function i(a){g(a).forEach(function(b){var c=a[b];if(h(c))f(b,a[b][0],a[b][1]);else if(c==="asap")var d=f(b,Ga,function(){var a=arguments.length,b=new Array(a);while(a--)b[a]=arguments[a];d.subscribers.forEach(function(a){aa(function(){a.apply(null,b)})})});else throw new E.InvalidArgument("Invalid event config")})}}function gc(a,b){p(b).from({prototype:a});return b}function hc(a){return gc(ec.prototype,function(b,c,d){this.db=a,this._tx=d,this.name=b,this.schema=c,this.hook=a._allTables[b]?a._allTables[b].hook:fc(null,{creating:[Ia,F],reading:[Ha,Ga],updating:[Ka,F],deleting:[Ja,F]})})}function ic(a,b){return!(a.filter||a.algorithm||a.or)&&(b?a.justLimit:!a.replayFilter)}function jc(a,b){a.filter=Xb(a.filter,b)}function kc(a,b,c){var d=a.replayFilter;a.replayFilter=d?function(){return Xb(d(),b())}:b;a.justLimit=c&&!d}function lc(a,b){a.isMatch=Xb(a.isMatch,b)}function mc(a,b){if(a.isPrimKey)return b.primaryKey;var c=b.getIndexByKeyPath(a.index);if(!c)throw new E.Schema("KeyPath "+a.index+" on object store "+b.name+" is not indexed");return c}function nc(a,b,c){var d=mc(a,b.schema);return b.openCursor({trans:c,values:!a.keysOnly,reverse:a.dir==="prev",unique:!!a.unique,query:{index:d,range:a.range}})}function oc(a,b,c,d){var e=a.replayFilter?Xb(a.filter,a.replayFilter()):a.filter;if(!a.or)return pc(nc(a,d,c),Xb(a.algorithm,e),b,!a.keysOnly&&a.valueMapper);else{var f={},g=function(a,c,d){if(!e||e(c,d,function(a){return c.stop(a)},function(a){return c.fail(a)})){var g=c.primaryKey,h=""+g;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(g));l(f,h)||(f[h]=!0,b(a,c,d))}};return Promise.all([a.or._iterate(g,c),pc(nc(a,d,c),a.algorithm,g,!a.keysOnly&&a.valueMapper)])}}function pc(a,b,c,d){var e=d?function(a,b,e){return c(d(a),b,e)}:c,f=M(e);return a.then(function(a){if(a)return a.start(function(){var c=function(){return a["continue"]()};(!b||b(a,function(a){return c=a},function(b){a.stop(b),c=F},function(b){a.fail(b),c=F}))&&f(a.value,a,function(a){return c=a});c()})})}var qc=function(){function a(){}a.prototype._read=function(a,b){var c=this._ctx;return c.error?c.table._trans(null,R.bind(null,c.error)):c.table._trans("readonly",a).then(b)};a.prototype._write=function(a){var b=this._ctx;return b.error?b.table._trans(null,R.bind(null,b.error)):b.table._trans("readwrite",a,"locked")};a.prototype._addAlgorithm=function(a){var b=this._ctx;b.algorithm=Xb(b.algorithm,a)};a.prototype._iterate=function(a,b){return oc(this._ctx,a,b,this._ctx.table.core)};a.prototype.clone=function(a){var b=Object.create(this.constructor.prototype),c=Object.create(this._ctx);a&&i(c,a);b._ctx=c;return b};a.prototype.raw=function(){this._ctx.valueMapper=null;return this};a.prototype.each=function(a){var b=this._ctx;return this._read(function(c){return oc(b,a,c,b.table.core)})};a.prototype.count=function(a){var b=this;return this._read(function(a){var c=b._ctx,d=c.table.core;if(ic(c,!0))return d.count({trans:a,query:{index:mc(c,d.schema),range:c.range}}).then(function(a){return Math.min(a,c.limit)});else{var e=0;return oc(c,function(){++e;return!1},a,d).then(function(){return e})}}).then(a)};a.prototype.sortBy=function(a,b){var c=a.split(".").reverse(),d=c[0],e=c.length-1;function f(a,b){return b?f(a[c[b]],b-1):a[d]}var g=this._ctx.dir==="next"?1:-1;function h(a,b){a=f(a,e);b=f(b,e);return a<b?-g:a>b?g:0}return this.toArray(function(a){return a.sort(h)}).then(b)};a.prototype.toArray=function(a){var b=this;return this._read(function(a){var c=b._ctx;if(c.dir==="next"&&ic(c,!0)&&c.limit>0){var d=c.valueMapper,e=mc(c,c.table.core.schema);return c.table.core.query({trans:a,limit:c.limit,values:!0,query:{index:e,range:c.range}}).then(function(a){a=a.result;return d?a.map(d):a})}else{var f=[];return oc(c,function(a){return f.push(a)},a,c.table.core).then(function(){return f})}},a)};a.prototype.offset=function(a){var b=this._ctx;if(a<=0)return this;b.offset+=a;ic(b)?kc(b,function(){var b=a;return function(a,c){if(b===0)return!0;if(b===1){--b;return!1}c(function(){a.advance(b),b=0});return!1}}):kc(b,function(){var b=a;return function(){return--b<0}});return this};a.prototype.limit=function(a){this._ctx.limit=Math.min(this._ctx.limit,a);kc(this._ctx,function(){var b=a;return function(a,c,d){--b<=0&&c(d);return b>=0}},!0);return this};a.prototype.until=function(a,b){jc(this._ctx,function(c,d,e){if(a(c.value)){d(e);return b}else return!0});return this};a.prototype.first=function(a){return this.limit(1).toArray(function(a){return a[0]}).then(a)};a.prototype.last=function(a){return this.reverse().first(a)};a.prototype.filter=function(a){jc(this._ctx,function(b){return a(b.value)});lc(this._ctx,a);return this};a.prototype.and=function(a){return this.filter(a)};a.prototype.or=function(a){return new this.db.WhereClause(this._ctx.table,a,this)};a.prototype.reverse=function(){this._ctx.dir=this._ctx.dir==="prev"?"next":"prev";this._ondirectionchange&&this._ondirectionchange(this._ctx.dir);return this};a.prototype.desc=function(){return this.reverse()};a.prototype.eachKey=function(a){var b=this._ctx;b.keysOnly=!b.isMatch;return this.each(function(b,c){a(c.key,c)})};a.prototype.eachUniqueKey=function(a){this._ctx.unique="unique";return this.eachKey(a)};a.prototype.eachPrimaryKey=function(a){var b=this._ctx;b.keysOnly=!b.isMatch;return this.each(function(b,c){a(c.primaryKey,c)})};a.prototype.keys=function(a){var b=this._ctx;b.keysOnly=!b.isMatch;var c=[];return this.each(function(a,b){c.push(b.key)}).then(function(){return c}).then(a)};a.prototype.primaryKeys=function(a){var b=this._ctx;if(b.dir==="next"&&ic(b,!0)&&b.limit>0)return this._read(function(a){var c=mc(b,b.table.core.schema);return b.table.core.query({trans:a,values:!1,limit:b.limit,query:{index:c,range:b.range}})}).then(function(a){a=a.result;return a}).then(a);b.keysOnly=!b.isMatch;var c=[];return this.each(function(a,b){c.push(b.primaryKey)}).then(function(){return c}).then(a)};a.prototype.uniqueKeys=function(a){this._ctx.unique="unique";return this.keys(a)};a.prototype.firstKey=function(a){return this.limit(1).keys(function(a){return a[0]}).then(a)};a.prototype.lastKey=function(a){return this.reverse().firstKey(a)};a.prototype.distinct=function(){var a=this._ctx;a=a.index&&a.table.schema.idxByName[a.index];if(!a||!a.multi)return this;var b={};jc(this._ctx,function(a){a=a.primaryKey.toString();var c=l(b,a);b[a]=!0;return!c});return this};a.prototype.modify=function(a){var b=this,c=this._ctx;return this._write(function(d){var e;if(typeof a==="function")e=a;else{var f=g(a),h=f.length;e=function(b){var c=!1;for(var d=0;d<h;++d){var e=f[d],g=a[e];w(b,e)!==g&&(x(b,e,g),c=!0)}return c}}var i=c.table.core,j=i.schema.primaryKey,k=j.outbound,l=j.extractKey,m=b.db._options.modifyChunkSize||200,n=[],o=0,p=[],q=function(a,b){var c=b.failures;b=b.numFailures;o+=a-b;for(a=0,b=g(c);a<b.length;a++){var d=b[a];n.push(c[d])}};return b.clone().primaryKeys().then(function(b){var f=function(g){var h=Math.min(m,b.length-g);return i.getMany({trans:d,keys:b.slice(g,g+h),cache:"immutable"}).then(function(j){var n=[],o=[],p=k?[]:null,r=[];for(var s=0;s<h;++s){var t=j[s],u={value:z(t),primKey:b[g+s]};e.call(u,u.value,u)!==!1&&(u.value==null?r.push(b[g+s]):!k&&T(l(t),l(u.value))!==0?(r.push(b[g+s]),n.push(u.value)):(o.push(u.value),k&&p.push(b[g+s])))}var v=ic(c)&&c.limit===Infinity&&(typeof a!=="function"||a===rc)&&{index:c.index,range:c.range};return Promise.resolve(n.length>0&&i.mutate({trans:d,type:"add",values:n}).then(function(a){for(var b in a.failures)r.splice(parseInt(b),1);q(n.length,a)})).then(function(){return(o.length>0||v&&typeof a==="object")&&i.mutate({trans:d,type:"put",keys:p,values:o,criteria:v,changeSpec:typeof a!=="function"&&a}).then(function(a){return q(o.length,a)})}).then(function(){return(r.length>0||v&&a===rc)&&i.mutate({trans:d,type:"delete",keys:r,criteria:v}).then(function(a){return q(r.length,a)})}).then(function(){return b.length>g+h&&f(g+m)})})};return f(0).then(function(){if(n.length>0)throw new Aa("Error modifying one or more objects",n,o,p);return b.length})})})};a.prototype["delete"]=function(){var a=this._ctx,b=a.range;return ic(a)&&(a.isPrimKey&&!Sb||b.type===3)?this._write(function(c){var d=a.table.core.schema.primaryKey,e=b;return a.table.core.count({trans:c,query:{index:d,range:e}}).then(function(b){return a.table.core.mutate({trans:c,type:"deleteRange",range:e}).then(function(a){var c=a.failures;a.lastResult;a.results;a=a.numFailures;if(a)throw new Aa("Could not delete some values",Object.keys(c).map(function(a){return c[a]}),b-a);return b-a})})}):this.modify(rc)};return a}(),rc=function(a,b){return b.value=null};function sc(a){return gc(qc.prototype,function(b,c){this.db=a;var d=Yb,e=null;if(c)try{d=c()}catch(a){e=a}c=b._ctx;b=c.table;var f=b.hook.reading.fire;this._ctx={table:b,index:c.index,isPrimKey:!c.index||b.schema.primKey.keyPath&&c.index===b.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:Infinity,error:e,or:c.or,valueMapper:f!==Ga?f:null}})}function tc(a,b){return a<b?-1:a===b?0:1}function uc(a,b){return a>b?-1:a===b?0:1}function U(a,b,c){a=a instanceof Bc?new a.Collection(a):a;a._ctx.error=c?new c(b):new TypeError(b);return a}function vc(a){return new a.Collection(a,function(){return Ac("")}).limit(0)}function wc(a){return a==="next"?function(a){return a.toUpperCase()}:function(a){return a.toLowerCase()}}function xc(a){return a==="next"?function(a){return a.toLowerCase()}:function(a){return a.toUpperCase()}}function yc(b,c,d,e,a,f){var g=Math.min(b.length,e.length),h=-1;for(var i=0;i<g;++i){var j=c[i];if(j!==e[i]){if(a(b[i],d[i])<0)return b.substr(0,i)+d[i]+d.substr(i+1);if(a(b[i],e[i])<0)return b.substr(0,i)+e[i]+d.substr(i+1);return h>=0?b.substr(0,h)+c[h]+d.substr(h+1):null}a(b[i],j)<0&&(h=i)}if(g<e.length&&f==="next")return b+d.substr(b.length);return g<b.length&&f==="prev"?b.substr(0,d.length):h<0?null:b.substr(0,h)+e[h]+d.substr(h+1)}function zc(a,b,c,d){var e,f,g,h,i,j,k,l=c.length;if(!c.every(function(a){return typeof a==="string"}))return U(a,Ob);function m(a){e=wc(a);f=xc(a);g=a==="next"?tc:uc;var b=c.map(function(a){return{lower:f(a),upper:e(a)}}).sort(function(a,b){return g(a.lower,b.lower)});h=b.map(function(a){return a.upper});i=b.map(function(a){return a.lower});j=a;k=a==="next"?"":d}m("next");a=new a.Collection(a,function(){return V(h[0],i[l-1]+d)});a._ondirectionchange=function(a){m(a)};var n=0;a._addAlgorithm(function(a,c,d){var e=a.key;if(typeof e!=="string")return!1;var m=f(e);if(b(m,i,n))return!0;else{var o=null;for(var p=n;p<l;++p){var q=yc(e,m,h[p],i[p],g,j);q===null&&o===null?n=p+1:(o===null||g(o,q)>0)&&(o=q)}o!==null?c(function(){a["continue"](o+k)}):c(d);return!1}});return a}function V(a,b,c,d){return{type:2,lower:a,upper:b,lowerOpen:c,upperOpen:d}}function Ac(a){return{type:1,lower:a,upper:a}}var Bc=function(){function a(){}Object.defineProperty(a.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0});a.prototype.between=function(a,b,c,d){c=c!==!1;d=d===!0;try{return this._cmp(a,b)>0||this._cmp(a,b)===0&&(c||d)&&!(c&&d)?vc(this):new this.Collection(this,function(){return V(a,b,!c,!d)})}catch(a){return U(this,S)}};a.prototype.equals=function(a){return a==null?U(this,S):new this.Collection(this,function(){return Ac(a)})};a.prototype.above=function(a){return a==null?U(this,S):new this.Collection(this,function(){return V(a,void 0,!0)})};a.prototype.aboveOrEqual=function(a){return a==null?U(this,S):new this.Collection(this,function(){return V(a,void 0,!1)})};a.prototype.below=function(a){return a==null?U(this,S):new this.Collection(this,function(){return V(void 0,a,!1,!0)})};a.prototype.belowOrEqual=function(a){return a==null?U(this,S):new this.Collection(this,function(){return V(void 0,a)})};a.prototype.startsWith=function(a){return typeof a!=="string"?U(this,Ob):this.between(a,a+Mb,!0,!0)};a.prototype.startsWithIgnoreCase=function(a){return a===""?this.startsWith(a):zc(this,function(a,b){return a.indexOf(b[0])===0},[a],Mb)};a.prototype.equalsIgnoreCase=function(a){return zc(this,function(a,b){return a===b[0]},[a],"")};a.prototype.anyOfIgnoreCase=function(){var a=A.apply(ra,arguments);return a.length===0?vc(this):zc(this,function(a,b){return b.indexOf(a)!==-1},a,"")};a.prototype.startsWithAnyOfIgnoreCase=function(){var a=A.apply(ra,arguments);return a.length===0?vc(this):zc(this,function(a,b){return b.some(function(b){return a.indexOf(b)===0})},a,Mb)};a.prototype.anyOf=function(){var a=this,b=A.apply(ra,arguments),c=this._cmp;try{b.sort(c)}catch(a){return U(this,S)}if(b.length===0)return vc(this);var d=new this.Collection(this,function(){return V(b[0],b[b.length-1])});d._ondirectionchange=function(d){c=d==="next"?a._ascending:a._descending,b.sort(c)};var e=0;d._addAlgorithm(function(a,d,f){var g=a.key;while(c(g,b[e])>0){++e;if(e===b.length){d(f);return!1}}if(c(g,b[e])===0)return!0;else{d(function(){a["continue"](b[e])});return!1}});return d};a.prototype.notEqual=function(a){return this.inAnyRange([[Nb,a],[a,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})};a.prototype.noneOf=function(){var a=A.apply(ra,arguments);if(a.length===0)return new this.Collection(this);try{a.sort(this._ascending)}catch(a){return U(this,S)}var b=a.reduce(function(a,b){return a?a.concat([[a[a.length-1][1],b]]):[[Nb,b]]},null);b.push([a[a.length-1],this.db._maxKey]);return this.inAnyRange(b,{includeLowers:!1,includeUppers:!1})};a.prototype.inAnyRange=function(c,d){var e=this,a=this._cmp,f=this._ascending,g=this._descending,h=this._min,i=this._max;if(c.length===0)return vc(this);if(!c.every(function(a){return a[0]!==void 0&&a[1]!==void 0&&f(a[0],a[1])<=0}))return U(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",E.InvalidArgument);var j=!d||d.includeLowers!==!1,k=d&&d.includeUppers===!0;function b(b,c){var d=0,e=b.length;for(;d<e;++d){var f=b[d];if(a(c[0],f[1])<0&&a(c[1],f[0])>0){f[0]=h(f[0],c[0]);f[1]=i(f[1],c[1]);break}}d===e&&b.push(c);return b}var l=f;function m(a,b){return l(a[0],b[0])}var n;try{n=c.reduce(b,[]),n.sort(m)}catch(a){return U(this,S)}var o=0,p=k?function(a){return f(a,n[o][1])>0}:function(a){return f(a,n[o][1])>=0},q=j?function(a){return g(a,n[o][0])>0}:function(a){return g(a,n[o][0])>=0};function r(a){return!p(a)&&!q(a)}var s=p;d=new this.Collection(this,function(){return V(n[0][0],n[n.length-1][1],!j,!k)});d._ondirectionchange=function(a){a==="next"?(s=p,l=f):(s=q,l=g),n.sort(m)};d._addAlgorithm(function(a,b,c){var d=a.key;while(s(d)){++o;if(o===n.length){b(c);return!1}}if(r(d))return!0;else if(e._cmp(d,n[o][1])===0||e._cmp(d,n[o][0])===0)return!1;else{b(function(){l===f?a["continue"](n[o][0]):a["continue"](n[o][1])});return!1}});return d};a.prototype.startsWithAnyOf=function(){var a=A.apply(ra,arguments);if(!a.every(function(a){return typeof a==="string"}))return U(this,"startsWithAnyOf() only works with strings");return a.length===0?vc(this):this.inAnyRange(a.map(function(a){return[a,a+Mb]}))};return a}();function Cc(a){return gc(Bc.prototype,function(b,c,d){this.db=a;this._ctx={table:b,index:c===":id"?null:c,or:d};this._cmp=this._ascending=T;this._descending=function(a,b){return T(b,a)};this._max=function(a,b){return T(a,b)>0?a:b};this._min=function(a,b){return T(a,b)<0?a:b};this._IDBKeyRange=a._deps.IDBKeyRange;if(!this._IDBKeyRange)throw new E.MissingAPI()})}function W(a){return M(function(b){Dc(b);a(b.target.error);return!1})}function Dc(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()}var Ec="storagemutated",X="x-storagemutated-1",Y=fc(null,Ec),Fc=function(){function a(){}a.prototype._lock=function(){v(!J.global);++this._reculock;this._reculock===1&&!J.global&&(J.lockOwnerFor=this);return this};a.prototype._unlock=function(){v(!J.global);if(--this._reculock===0){J.global||(J.lockOwnerFor=null);while(this._blockedFuncs.length>0&&!this._locked()){var a=this._blockedFuncs.shift();try{Hb(a[1],a[0])}catch(a){}}}return this};a.prototype._locked=function(){return this._reculock&&J.lockOwnerFor!==this};a.prototype.create=function(a){var b=this;if(!this.mode)return this;var c=this.db.idbdb,d=this.db._state.dbOpenError;v(!this.idbtrans);if(!a&&!c)switch(d&&d.name){case"DatabaseClosedError":throw new E.DatabaseClosed(d);case"MissingAPIError":throw new E.MissingAPI(d.message,d);default:throw new E.OpenFailed(d)}if(!this.active)throw new E.TransactionInactive();v(this._completion._state===null);a=this.idbtrans=a||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):c.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}));a.onerror=M(function(c){Dc(c),b._reject(a.error)});a.onabort=M(function(c){Dc(c),b.active&&b._reject(new E.Abort(a.error)),b.active=!1,b.on("abort").fire(c)});a.oncomplete=M(function(){b.active=!1,b._resolve(),"mutatedParts"in a&&Y.storagemutated.fire(a.mutatedParts)});return this};a.prototype._promise=function(a,b,c){var d=this;if(a==="readwrite"&&this.mode!=="readwrite")return R(new E.ReadOnly("Transaction is readonly"));if(!this.active)return R(new E.TransactionInactive());if(this._locked())return new L(function(e,f){d._blockedFuncs.push([function(){d._promise(a,b,c).then(e,f)},J])});else if(c)return O(function(){var a=new L(function(a,c){d._lock();var e=b(a,c,d);e&&e.then&&e.then(a,c)});a["finally"](function(){return d._unlock()});a._lib=!0;return a});else{var e=new L(function(a,c){var e=b(a,c,d);e&&e.then&&e.then(a,c)});e._lib=!0;return e}};a.prototype._root=function(){return this.parent?this.parent._root():this};a.prototype.waitFor=function(a){var b=this._root(),c=L.resolve(a);if(b._waitingFor)b._waitingFor=b._waitingFor.then(function(){return c});else{b._waitingFor=c;b._waitingQueue=[];var d=b.idbtrans.objectStore(b.storeNames[0]);(function a(){++b._spinCount;while(b._waitingQueue.length)b._waitingQueue.shift()();b._waitingFor&&(d.get(-Infinity).onsuccess=a)})()}var e=b._waitingFor;return new L(function(a,d){c.then(function(c){return b._waitingQueue.push(M(a.bind(null,c)))},function(a){return b._waitingQueue.push(M(d.bind(null,a)))})["finally"](function(){b._waitingFor===e&&(b._waitingFor=null)})})};a.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new E.Abort()))};a.prototype.table=function(a){var b=this._memoizedTables||(this._memoizedTables={});if(l(b,a))return b[a];var c=this.schema[a];if(!c)throw new E.NotFound("Table "+a+" not part of transaction");c=new this.db.Table(a,c,this);c.core=this.db.core.table(a);b[a]=c;return c};return a}();function Gc(a){return gc(Fc.prototype,function(b,c,d,e,f){var g=this;this.db=a;this.mode=b;this.storeNames=c;this.schema=d;this.chromeTransactionDurability=e;this.idbtrans=null;this.on=fc(this,"complete","error","abort");this.parent=f||null;this.active=!0;this._reculock=0;this._blockedFuncs=[];this._resolve=null;this._reject=null;this._waitingFor=null;this._waitingQueue=null;this._spinCount=0;this._completion=new L(function(a,b){g._resolve=a,g._reject=b});this._completion.then(function(){g.active=!1,g.on.complete.fire()},function(a){var b=g.active;g.active=!1;g.on.error.fire(a);g.parent?g.parent._reject(a):b&&g.idbtrans&&g.idbtrans.abort();return R(a)})})}function Hc(a,b,c,d,e,f,g){return{name:a,keyPath:b,unique:c,multi:d,auto:e,compound:f,src:(c&&!g?"&":"")+(d?"*":"")+(e?"++":"")+Ic(b)}}function Ic(a){return typeof a==="string"?a:a?"["+[].join.call(a,"+")+"]":""}function Jc(a,b,c){return{name:a,primKey:b,indexes:c,mappedClass:null,idxByName:ba(c,function(a){return[a.name,a]})}}function Kc(a){return a.length===1?a[0]:a}var Lc=function(a){try{a.only([[]]);Lc=function(){return[[]]};return[[]]}catch(a){Lc=function(){return Mb};return Mb}};function Mc(a){if(a==null)return function(){return void 0};else if(typeof a==="string")return Nc(a);else return function(b){return w(b,a)}}function Nc(a){var b=a.split(".");if(b.length===1)return function(b){return b[a]};else return function(b){return w(b,a)}}function Oc(a){return[].slice.call(a)}var Pc=0;function Qc(a){return a==null?":id":typeof a==="string"?a:"[".concat(a.join("+"),"]")}function Rc(a,b,c){function d(a,b){var c=Oc(a.objectStoreNames);return{schema:{name:a.name,tables:c.map(function(a){return b.objectStore(a)}).map(function(a){var b=a.keyPath,c=a.autoIncrement,d=h(b),e=b==null,f={};e={name:a.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:e,compound:d,keyPath:b,autoIncrement:c,unique:!0,extractKey:Mc(b)},indexes:Oc(a.indexNames).map(function(b){return a.index(b)}).map(function(b){var c=b.name,d=b.unique,e=b.multiEntry;b=b.keyPath;var a=h(b);c={name:c,compound:a,keyPath:b,unique:d,multiEntry:e,extractKey:Mc(b)};f[Qc(b)]=c;return c}),getIndexByKeyPath:function(a){return f[Qc(a)]}};f[":id"]=e.primaryKey;b!=null&&(f[Qc(b)]=e.primaryKey);return e})},hasGetAll:c.length>0&&"getAll"in b.objectStore(c[0])&&!(typeof navigator!=="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function e(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var c=a.lower,d=a.upper,e=a.lowerOpen;a=a.upperOpen;c=c===void 0?d===void 0?null:b.upperBound(d,!!a):d===void 0?b.lowerBound(c,!!e):b.bound(c,d,!!e,!!a);return c}function f(b){var c=b.name;function d(d){var f=d.trans,b=d.type,a=d.keys,g=d.values,h=d.range;return new Promise(function(d,i){d=M(d);i=f.objectStore(c);var j=i.keyPath==null,k=b==="put"||b==="add";if(!k&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);var l=(a||g||{length:1}).length;if(a&&g&&a.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(l===0)return d({numFailures:0,failures:{},results:[],lastResult:void 0});var m,n=[],o=[],p=0,q=function(a){++p,Dc(a)};if(b==="deleteRange"){if(h.type===4)return d({numFailures:p,failures:o,results:[],lastResult:void 0});h.type===3?n.push(m=i.clear()):n.push(m=i["delete"](e(h)))}else{j=k?j?[g,a]:[g,null]:[a,null];var r=j[0];j=j[1];if(k)for(k=0;k<l;++k)n.push(m=j&&j[k]!==void 0?i[b](r[k],j[k]):i[b](r[k])),m.onerror=q;else for(k=0;k<l;++k)n.push(m=i[b](r[k])),m.onerror=q}var s=function(c){c=c.target.result;n.forEach(function(a,b){return a.error!=null&&(o[b]=a.error)});d({numFailures:p,failures:o,results:b==="delete"?a:n.map(function(a){return a.result}),lastResult:c})};m.onerror=function(a){q(a),s(a)};m.onsuccess=s})}function a(b){var d=b.trans,f=b.values,a=b.query,g=b.reverse,h=b.unique;return new Promise(function(b,i){b=M(b);var j=a.index,k=a.range,l=d.objectStore(c);l=j.isPrimaryKey?l:l.index(j.name);j=g?h?"prevunique":"prev":h?"nextunique":"next";var m=f||!("openKeyCursor"in l)?l.openCursor(e(k),j):l.openKeyCursor(e(k),j);m.onerror=W(i);m.onsuccess=M(function(a){var c=m.result;if(!c){b(null);return}c.___id=++Pc;c.done=!1;var e=c["continue"].bind(c),f=c.continuePrimaryKey;f&&(f=f.bind(c));var g=c.advance.bind(c);a=function(){throw new Error("Cursor not started")};var h=function(){throw new Error("Cursor not stopped")};c.trans=d;c.stop=c["continue"]=c.continuePrimaryKey=c.advance=a;c.fail=M(i);c.next=function(){var a=this,b=1;return this.start(function(){return b--?a["continue"]():a.stop()}).then(function(){return a})};c.start=function(a){var b=new Promise(function(a,b){a=M(a),m.onerror=W(b),c.fail=b,c.stop=function(b){c.stop=c["continue"]=c.continuePrimaryKey=c.advance=h,a(b)}}),d=function(){if(m.result)try{a()}catch(a){c.fail(a)}else c.done=!0,c.start=function(){throw new Error("Cursor behind last entry")},c.stop()};m.onsuccess=M(function(a){m.onsuccess=d,d()});c["continue"]=e;c.continuePrimaryKey=f;c.advance=g;d();return b};b(c)},i)})}function f(a){return function(b){return new Promise(function(f,g){f=M(f);var h=b.trans,i=b.values,j=b.limit,d=b.query,k=j===Infinity?void 0:j,l=d.index;d=d.range;h=h.objectStore(c);h=l.isPrimaryKey?h:h.index(l.name);l=e(d);if(j===0)return f({result:[]});if(a){d=i?h.getAll(l,k):h.getAllKeys(l,k);d.onsuccess=function(a){return f({result:a.target.result})};d.onerror=W(g)}else{var m=0,n=i||!("openKeyCursor"in h)?h.openCursor(l):h.openKeyCursor(l),o=[];n.onsuccess=function(a){a=n.result;if(!a)return f({result:o});o.push(i?a.value:a.primaryKey);if(++m===j)return f({result:o});a["continue"]()};n.onerror=W(g)}})}}return{name:c,schema:b,mutate:d,getMany:function(b){var d=b.trans,a=b.keys;return new Promise(function(b,e){b=M(b);var f=d.objectStore(c),g=a.length,h=new Array(g),i=0,j=0,k=function(a){a=a.target;(h[a._pos]=a.result)!=null;++j===i&&b(h)};e=W(e);for(var l=0;l<g;++l){var m=a[l];m!=null&&(m=f.get(a[l]),m._pos=l,m.onsuccess=k,m.onerror=e,++i)}i===0&&b(h)})},get:function(a){var b=a.trans,d=a.key;return new Promise(function(a,e){a=M(a);var f=b.objectStore(c);f=f.get(d);f.onsuccess=function(b){return a(b.target.result)};f.onerror=W(e)})},query:f(g),openCursor:a,count:function(b){var a=b.query,d=b.trans,f=a.index,g=a.range;return new Promise(function(a,b){var h=d.objectStore(c);h=f.isPrimaryKey?h:h.index(f.name);var i=e(g);i=i?h.count(i):h.count();i.onsuccess=M(function(b){return a(b.target.result)});i.onerror=W(b)})}}}d=d(a,c);c=d.schema;var g=d.hasGetAll;d=c.tables.map(function(a){return f(a)});var i={};d.forEach(function(a){return i[a.name]=a});return{stack:"dbcore",transaction:a.transaction.bind(a),table:function(a){var b=i[a];if(!b)throw new Error("Table '".concat(a,"' not found"));return i[a]},MIN_KEY:-Infinity,MAX_KEY:Lc(b),schema:c}}function Sc(a,b){return b.reduce(function(a,b){b=b.create;return d(d({},a),b(a))},a)}function Tc(a,b,c,d){var e=c.IDBKeyRange;c.indexedDB;c=Sc(Rc(b,e,d),a.dbcore);return{dbcore:c}}function Uc(a,b){var c=a._novip;a=b.db;a=Tc(c._middlewares,a,c._deps,b);c.core=a.dbcore;c.tables.forEach(function(a){var b=a.name;c.core.schema.tables.some(function(a){return a.name===b})&&(a.core=c.core.table(b),c[b]instanceof c.Table&&(c[b].core=a.core))})}function Vc(a,b,c,d){var e=a._novip;c.forEach(function(a){var c=d[a];b.forEach(function(b){var d=r(b,a);(!d||"value"in d&&d.value===void 0)&&(b===e.Transaction.prototype||b instanceof e.Transaction?o(b,a,{get:function(){return this.table(a)},set:function(b){n(this,a,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):b[a]=new e.Table(a,c))})})}function Wc(a,b){var c=a._novip;b.forEach(function(a){for(var b in a)a[b]instanceof c.Table&&delete a[b]})}function Xc(a,b){return a._cfg.version-b._cfg.version}function Yc(a,b,c,d){var e=a._dbSchema,f=a._createTransaction("readwrite",a._storeNames,e);f.create(c);f._completion["catch"](d);var h=f._reject.bind(f),i=J.transless||J;O(function(){J.trans=f,J.transless=i,b===0?(g(e).forEach(function(a){ad(c,a,e[a].primKey,e[a].indexes)}),Uc(a,c),L.follow(function(){return a.on.populate.fire(f)})["catch"](h)):Zc(a,b,f,c)["catch"](h)})}function Zc(a,b,c,d){var e=a._novip,f=[];a=e._versions;var h=e._dbSchema=ed(e,e.idbdb,d),i=!1;a=a.filter(function(a){return a._cfg.version>=b});a.forEach(function(a){f.push(function(){var f=h,j=a._cfg.dbschema;hd(e,f,d);hd(e,j,d);h=e._dbSchema=j;var k=$c(f,j);k.add.forEach(function(a){ad(d,a[0],a[1].primKey,a[1].indexes)});k.change.forEach(function(a){if(a.recreate)throw new E.Upgrade("Not yet support for changing primary key");else{var b=d.objectStore(a.name);a.add.forEach(function(a){return dd(b,a)});a.change.forEach(function(a){b.deleteIndex(a.name),dd(b,a)});a.del.forEach(function(a){return b.deleteIndex(a)})}});var l=a._cfg.contentUpgrade;if(l&&a._cfg.version>b){Uc(e,d);c._memoizedTables={};i=!0;var m=ea(j);k.del.forEach(function(a){m[a]=f[a]});Wc(e,[e.Transaction.prototype]);Vc(e,[e.Transaction.prototype],g(m),m);c.schema=m;var n=sa(l);n&&Cb();var o;j=L.follow(function(){o=l(c);if(o&&n){var a=P.bind(null,null);o.then(a,a)}});return o&&typeof o.then==="function"?L.resolve(o):j.then(function(){return o})}}),f.push(function(b){if(!i||!Rb){var d=a._cfg.dbschema;cd(d,b)}Wc(e,[e.Transaction.prototype]);Vc(e,[e.Transaction.prototype],e._storeNames,e._dbSchema);c.schema=e._dbSchema})});function j(){return f.length?L.resolve(f.shift()(c.idbtrans)).then(j):L.resolve()}return j().then(function(){bd(h,d)})}function $c(a,b){var c={del:[],add:[],change:[]},d;for(d in a)b[d]||c.del.push(d);for(d in b){var e=a[d],f=b[d];if(!e)c.add.push([d,f]);else{var g={name:d,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(e.primKey.keyPath||"")!==""+(f.primKey.keyPath||"")||e.primKey.auto!==f.primKey.auto&&!Qb)g.recreate=!0,c.change.push(g);else{e=e.idxByName;f=f.idxByName;var h;for(h in e)f[h]||g.del.push(h);for(h in f){var i=e[h],j=f[h];!i?g.add.push(j):i.src!==j.src&&g.change.push(j)}(g.del.length>0||g.add.length>0||g.change.length>0)&&c.change.push(g)}}}return c}function ad(a,b,c,d){var e=a.db.createObjectStore(b,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});d.forEach(function(a){return dd(e,a)});return e}function bd(a,b){g(a).forEach(function(c){b.db.objectStoreNames.contains(c)||ad(b,c,a[c].primKey,a[c].indexes)})}function cd(a,b){[].slice.call(b.db.objectStoreNames).forEach(function(c){return a[c]==null&&b.db.deleteObjectStore(c)})}function dd(a,b){a.createIndex(b.name,b.keyPath,{unique:b.unique,multiEntry:b.multi})}function ed(a,b,c){var d={};a=t(b.objectStoreNames,0);a.forEach(function(a){var b=c.objectStore(a),e=b.keyPath,f=Hc(Ic(e),e||"",!1,!1,!!b.autoIncrement,e&&typeof e!=="string",!0),g=[];for(var h=0;h<b.indexNames.length;++h){var i=b.index(b.indexNames[h]);e=i.keyPath;i=Hc(i.name,e,!!i.unique,!!i.multiEntry,!1,e&&typeof e!=="string",!1);g.push(i)}d[a]=Jc(a,f,g)});return d}function fd(a,b,c){a=a._novip;a.verno=b.version/10;c=a._dbSchema=ed(a,b,c);a._storeNames=t(b.objectStoreNames,0);Vc(a,[a._allTables],g(c),c)}function gd(a,b){b=ed(a,a.idbdb,b);b=$c(b,a._dbSchema);return!(b.add.length||b.change.some(function(a){return a.add.length||a.change.length}))}function hd(a,b,c){a=a._novip;var d=c.db.objectStoreNames;for(var e=0;e<d.length;++e){var g=d[e],h=c.objectStore(g);a._hasGetAll="getAll"in h;for(var i=0;i<h.indexNames.length;++i){var j=h.indexNames[i],k=h.index(j).keyPath;k=typeof k==="string"?k:"["+t(k).join("+")+"]";if(b[g]){var l=b[g].idxByName[k];l&&(l.name=j,delete b[g].idxByName[k],b[g].idxByName[j]=l)}}}typeof navigator!=="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(a._hasGetAll=!1)}function id(a){return a.split(",").map(function(a,b){a=a.trim();var c=a.replace(/([&*]|\+\+)/g,""),d=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return Hc(c,d||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),h(d),b===0)})}var jd=function(){function a(){}a.prototype._parseStoresSpec=function(a,b){g(a).forEach(function(c){if(a[c]!==null){var d=id(a[c]),e=d.shift();if(e.multi)throw new E.Schema("Primary key cannot be multi-valued");d.forEach(function(a){if(a.auto)throw new E.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new E.Schema("Index must have a name and cannot be an empty string")});b[c]=Jc(c,e,d)}})};a.prototype.stores=function(a){var b=this.db;this._cfg.storesSource=this._cfg.storesSource?i(this._cfg.storesSource,a):a;a=b._versions;var c={},d={};a.forEach(function(a){i(c,a._cfg.storesSource),d=a._cfg.dbschema={},a._parseStoresSpec(c,d)});b._dbSchema=d;Wc(b,[b._allTables,b,b.Transaction.prototype]);Vc(b,[b._allTables,b,b.Transaction.prototype,this._cfg.tables],g(d),d);b._storeNames=g(d);return this};a.prototype.upgrade=function(a){this._cfg.contentUpgrade=Ma(this._cfg.contentUpgrade||F,a);return this};return a}();function kd(a){return gc(jd.prototype,function(b){this.db=a,this._cfg={version:b,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function ld(a,b){var c=a._dbNamesDB;c||(c=a._dbNamesDB=new je(Ub,{addons:[],indexedDB:a,IDBKeyRange:b}),c.version(1).stores({dbnames:"name"}));return c.table("dbnames")}function md(a){return a&&typeof a.databases==="function"}function nd(a){var b=a.indexedDB;a=a.IDBKeyRange;return md(b)?Promise.resolve(b.databases()).then(function(a){return a.map(function(a){return a.name}).filter(function(a){return a!==Ub})}):ld(b,a).toCollection().primaryKeys()}function od(a,b){var c=a.indexedDB;a=a.IDBKeyRange;!md(c)&&b!==Ub&&ld(c,a).put({name:b})["catch"](F)}function pd(a,b){var c=a.indexedDB;a=a.IDBKeyRange;!md(c)&&b!==Ub&&ld(c,a)["delete"](b)["catch"](F)}function qd(a){return O(function(){J.letThrough=!0;return a()})}function rd(){var a=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!a||!indexedDB.databases)return Promise.resolve();var b;return new Promise(function(a){var c=function(){return indexedDB.databases()["finally"](a)};b=setInterval(c,100);c()})["finally"](function(){return clearInterval(b)})}function sd(a){var b=a._state,c=a._deps.indexedDB;if(b.isBeingOpened||a.idbdb)return b.dbReadyPromise.then(function(){return b.dbOpenError?R(b.dbOpenError):a});B&&(b.openCanceller._stackHolder=C());b.isBeingOpened=!0;b.dbOpenError=null;b.openComplete=!1;var d=b.openCanceller;function e(){if(b.openCanceller!==d)throw new E.DatabaseClosed("db.open() was cancelled")}var f=b.dbReadyResolve,g=null,h=!1;return L.race([d,(typeof navigator==="undefined"?L.resolve():rd()).then(function(){return new L(function(d,f){e();if(!c)throw new E.MissingAPI();var i=a.name,j=b.autoSchema?c.open(i):c.open(i,Math.round(a.verno*10));if(!j)throw new E.MissingAPI();j.onerror=W(f);j.onblocked=M(a._fireOnBlocked);j.onupgradeneeded=M(function(d){g=j.transaction;if(b.autoSchema&&!a._options.allowEmptyDB){j.onerror=Dc;g.abort();j.result.close();var e=c.deleteDatabase(i);e.onsuccess=e.onerror=M(function(){f(new E.NoSuchDatabase("Database ".concat(i," doesnt exist")))})}else{g.onerror=W(f);e=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;h=e<1;a._novip.idbdb=j.result;Yc(a,e/10,g,f)}},f);j.onsuccess=M(function(){g=null;var c=a._novip.idbdb=j.result,e=t(c.objectStoreNames);if(e.length>0)try{e=c.transaction(Kc(e),"readonly");b.autoSchema?fd(a,c,e):(hd(a,a._dbSchema,e),!gd(a,e));Uc(a,e)}catch(a){}Pb.push(a);c.onversionchange=M(function(c){b.vcFired=!0,a.on("versionchange").fire(c)});c.onclose=M(function(b){a.on("close").fire(b)});h&&od(a._deps,i);d()},f)})})]).then(function(){e();b.onReadyBeingFired=[];return L.resolve(qd(function(){return a.on.ready.fire(a.vip)})).then(function c(){if(b.onReadyBeingFired.length>0){var d=b.onReadyBeingFired.reduce(Ma,F);b.onReadyBeingFired=[];return L.resolve(qd(function(){return d(a.vip)})).then(c)}})})["finally"](function(){b.onReadyBeingFired=null,b.isBeingOpened=!1}).then(function(){return a})["catch"](function(c){b.dbOpenError=c;try{g&&g.abort()}catch(a){}d===b.openCanceller&&a._close();return R(c)})["finally"](function(){b.openComplete=!0,f()})}function td(a){var b=function(b){return a.next(b)},c=function(b){return a["throw"](b)},d=f(b),e=f(c);function f(a){return function(b){b=a(b);var c=b.value;return b.done?c:!c||typeof c.then!=="function"?h(c)?Promise.all(c).then(d,e):d(c):c.then(d,e)}}return f(b)()}function ud(a,b,c){var d=arguments.length;if(d<2)throw new E.InvalidArgument("Too few arguments");var e=new Array(d-1);while(--d)e[d-1]=arguments[d];c=e.pop();var f=ga(e);return[a,f,c]}function vd(a,b,c,d,e){return L.resolve().then(function(){var f=J.transless||J,g=a._createTransaction(b,c,a._dbSchema,d);g.explicit=!0;f={trans:g,transless:f};if(d)g.idbtrans=d.idbtrans;else try{g.create(),a._state.PR1398_maxLoop=3}catch(d){if(d.name===Ca.InvalidState&&a.isOpen()&&--a._state.PR1398_maxLoop>0){a._close();return a.open().then(function(){return vd(a,b,c,null,e)})}return R(d)}var h=sa(e);h&&Cb();var i;f=L.follow(function(){i=e.call(g,g);if(i)if(h){var a=P.bind(null,null);i.then(a,a)}else typeof i.next==="function"&&typeof i["throw"]==="function"&&(i=td(i))},f);return(i&&typeof i.then==="function"?L.resolve(i).then(function(a){return g.active?a:R(new E.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return i})).then(function(a){d&&g._resolve();return g._completion.then(function(){return a})})["catch"](function(a){g._reject(a);return R(a)})})}function wd(a,b,c){a=h(a)?a.slice():[a];for(var d=0;d<c;++d)a.push(b);return a}function xd(a){return d(d({},a),{table:function(b){var c=a.table(b);b=c.schema;var e={},f=[];function g(a,b,c){var h=Qc(a),i=e[h]=e[h]||[],j=a==null?0:typeof a==="string"?1:a.length,k=b>0;h=d(d({},c),{name:k?"".concat(h,"(virtual-from:").concat(c.name,")"):c.name,lowLevelIndex:c,isVirtual:k,keyTail:b,keyLength:j,extractKey:Mc(a),unique:!k&&c.unique});i.push(h);h.isPrimaryKey||f.push(h);if(j>1){k=j===2?a[0]:a.slice(0,j-1);g(k,b+1,c)}i.sort(function(a,b){return a.keyTail-b.keyTail});return h}var h=g(b.primaryKey.keyPath,0,b.primaryKey);e[":id"]=[h];for(var i=0,j=b.indexes;i<j.length;i++){var k=j[i];g(k.keyPath,0,k)}function l(a){a=e[Qc(a)];return a&&a[0]}function m(b,c){return{type:b.type===1?2:b.type,lower:wd(b.lower,b.lowerOpen?a.MAX_KEY:a.MIN_KEY,c),lowerOpen:!0,upper:wd(b.upper,b.upperOpen?a.MIN_KEY:a.MAX_KEY,c),upperOpen:!0}}function n(b){var a=b.query.index;return a.isVirtual?d(d({},b),{query:{index:a.lowLevelIndex,range:m(b.query.range,a.keyTail)}}):b}k=d(d({},c),{schema:d(d({},b),{primaryKey:h,indexes:f,getIndexByKeyPath:l}),count:function(a){return c.count(n(a))},query:function(a){return c.query(n(a))},openCursor:function(d){var b=d.query.index,e=b.keyTail,f=b.isVirtual,g=b.keyLength;if(!f)return c.openCursor(d);function h(b){function c(c){c!=null?b["continue"](wd(c,d.reverse?a.MAX_KEY:a.MIN_KEY,e)):d.unique?b["continue"](b.key.slice(0,g).concat(d.reverse?a.MIN_KEY:a.MAX_KEY,e)):b["continue"]()}c=Object.create(b,{"continue":{value:c},continuePrimaryKey:{value:function(d,c){b.continuePrimaryKey(wd(d,a.MAX_KEY,e),c)}},primaryKey:{get:function(){return b.primaryKey}},key:{get:function(){var a=b.key;return g===1?a[0]:a.slice(0,g)}},value:{get:function(){return b.value}}});return c}return c.openCursor(n(d)).then(function(a){return a&&h(a)})}});return k}})}var yd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:xd};function zd(a,b,c,d){c=c||{};d=d||"";g(a).forEach(function(e){if(!l(b,e))c[d+e]=void 0;else{var f=a[e],g=b[e];if(typeof f==="object"&&typeof g==="object"&&f&&g){var h=na(f),i=na(g);h!==i?c[d+e]=b[e]:h==="Object"?zd(f,g,c,d+e+"."):f!==g&&(c[d+e]=b[e])}else f!==g&&(c[d+e]=b[e])}});g(b).forEach(function(e){l(a,e)||(c[d+e]=b[e])});return c}function Ad(a,b){return b.type==="delete"?b.keys:b.keys||b.values.map(a.extractKey)}var Bd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(a){return d(d({},a),{table:function(b){var c=a.table(b),f=c.schema.primaryKey,g=d(d({},c),{mutate:function(a){var g=J.trans,h=g.table(b).hook,i=h.deleting,j=h.creating,k=h.updating;switch(a.type){case"add":if(j.fire===F)break;return g._promise("readwrite",function(){return m(a)},!0);case"put":if(j.fire===F&&k.fire===F)break;return g._promise("readwrite",function(){return m(a)},!0);case"delete":if(i.fire===F)break;return g._promise("readwrite",function(){return m(a)},!0);case"deleteRange":if(i.fire===F)break;return g._promise("readwrite",function(){return n(a)},!0)}return c.mutate(a);function m(b){var g=J.trans,a=b.keys||Ad(f,b);if(!a)throw new Error("Keys missing");b=b.type==="add"||b.type==="put"?d(d({},b),{keys:a}):d({},b);b.type!=="delete"&&(b.values=e([],b.values,!0));b.keys&&(b.keys=e([],b.keys,!0));return Cd(c,b,a).then(function(d){var e=a.map(function(a,c){var e=d[c],h={onerror:null,onsuccess:null};if(b.type==="delete")i.fire.call(h,a,e,g);else if(b.type==="add"||e===void 0){var m=j.fire.call(h,a,b.values[c],g);a==null&&m!=null&&(a=m,b.keys[c]=a,f.outbound||x(b.values[c],f.keyPath,a))}else{m=zd(e,b.values[c]);var n=k.fire.call(h,m,a,e,g);if(n){var o=b.values[c];Object.keys(n).forEach(function(a){l(o,a)?o[a]=n[a]:x(o,a,n[a])})}}return h});return c.mutate(b).then(function(c){var f=c.failures,g=c.results,h=c.numFailures;c=c.lastResult;for(var i=0;i<a.length;++i){var j=g?g[i]:a[i],k=e[i];j==null?k.onerror&&k.onerror(f[i]):k.onsuccess&&k.onsuccess(b.type==="put"&&d[i]?b.values[i]:j)}return{failures:f,results:g,numFailures:h,lastResult:c}})["catch"](function(a){e.forEach(function(b){return b.onerror&&b.onerror(a)});return Promise.reject(a)})})}function n(a){return o(a.trans,a.range,1e4)}function o(a,b,e){return c.query({trans:a,values:!1,query:{index:f,range:b},limit:e}).then(function(c){var f=c.result;return m({type:"delete",keys:f,trans:a}).then(function(c){if(c.numFailures>0)return Promise.reject(c.failures[0]);if(f.length<e)return{failures:[],numFailures:0,lastResult:void 0};else return o(a,d(d({},b),{lower:f[f.length-1],lowerOpen:!0}),e)})})}}});return g}})}};function Cd(a,b,c){return b.type==="add"?Promise.resolve([]):a.getMany({trans:b.trans,keys:c,cache:"immutable"})}function Dd(a,b,c){try{if(!b)return null;if(b.keys.length<a.length)return null;var d=[];for(var e=0,f=0;e<b.keys.length&&f<a.length;++e){if(T(b.keys[e],a[f])!==0)continue;d.push(c?z(b.values[e]):b.values[e]);++f}return d.length===a.length?d:null}catch(a){return null}}var Ed={stack:"dbcore",level:-1,create:function(a){return{table:function(b){var c=a.table(b);return d(d({},c),{getMany:function(a){if(!a.cache)return c.getMany(a);var b=Dd(a.keys,a.trans._cache,a.cache==="clone");return b?L.resolve(b):c.getMany(a).then(function(b){a.trans._cache={keys:a.keys,values:a.cache==="clone"?z(b):b};return b})},mutate:function(a){a.type!=="add"&&(a.trans._cache=null);return c.mutate(a)}})}}}};function Fd(a){return!("from"in a)}var Z=function(a,b){if(this)i(this,arguments.length?{d:1,from:a,to:arguments.length>1?b:a}:{d:0});else{var c=new Z();a&&"d"in a&&i(c,a);return c}};m(Z.prototype,(xd={add:function(a){Hd(this,a);return this},addKey:function(a){Gd(this,a,a);return this},addKeys:function(a){var b=this;a.forEach(function(a){return Gd(b,a,a)});return this}},xd[oa]=function(){return Jd(this)},xd));function Gd(a,b,c){var d=T(b,c);if(isNaN(d))return;if(d>0)throw RangeError();if(Fd(a))return i(a,{from:b,to:c,d:1});d=a.l;var e=a.r;if(T(c,a.from)<0){d?Gd(d,b,c):a.l={from:b,to:c,d:1,l:null,r:null};return Kd(a)}if(T(b,a.to)>0){e?Gd(e,b,c):a.r={from:b,to:c,d:1,l:null,r:null};return Kd(a)}T(b,a.from)<0&&(a.from=b,a.l=null,a.d=e?e.d+1:1);T(c,a.to)>0&&(a.to=c,a.r=null,a.d=a.l?a.l.d+1:1);b=!a.r;d&&!a.l&&Hd(a,d);e&&b&&Hd(a,e)}function Hd(a,b){function c(a,b){var d=b.from,e=b.to,f=b.l;b=b.r;Gd(a,d,e);f&&c(a,f);b&&c(a,b)}Fd(b)||c(a,b)}function Id(a,b){b=Jd(b);var c=b.next();if(c.done)return!1;var d=c.value;a=Jd(a);var e=a.next(d.from),f=e.value;while(!c.done&&!e.done){if(T(f.from,d.to)<=0&&T(f.to,d.from)>=0)return!0;T(d.from,f.from)<0?d=(c=b.next(f.from)).value:f=(e=a.next(d.from)).value}return!1}function Jd(a){var b=Fd(a)?null:{s:0,n:a};return{next:function(a){var c=arguments.length>0;while(b)switch(b.s){case 0:b.s=1;if(c)while(b.n.l&&T(a,b.n.from)<0)b={up:b,n:b.n.l,s:1};else while(b.n.l)b={up:b,n:b.n.l,s:1};case 1:b.s=2;if(!c||T(a,b.n.to)<=0)return{value:b.n,done:!1};case 2:if(b.n.r){b.s=3;b={up:b,n:b.n.r,s:0};continue}case 3:b=b.up}return{done:!0}}}}function Kd(a){var b;b=(((b=a.r)===null||b===void 0?void 0:b.d)||0)-(((b=a.l)===null||b===void 0?void 0:b.d)||0);b=b>1?"r":b<-1?"l":"";if(b){var c=b==="r"?"l":"r",e=d({},a),f=a[b];a.from=f.from;a.to=f.to;a[b]=f[b];e[b]=f[c];a[c]=e;e.d=Ld(e)}a.d=Ld(a)}function Ld(a){var b=a.r;a=a.l;return(b?a?Math.max(b.d,a.d):b.d:a?a.d:0)+1}function Md(a,b){return a.trans.mode==="readonly"&&!!a.subscr&&!a.trans.explicit&&a.trans.db._options.cache!=="disabled"&&!b.schema.primaryKey.outbound}function Nd(a,b){switch(a){case"query":return b.values&&!b.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}function Od(a,b){g(b).forEach(function(c){a[c]?Hd(a[c],b[c]):a[c]=ia(b[c])});return a}var Pd={stack:"dbcore",level:0,name:"Observability",create:function(a){var b=a.schema.name,c=new Z(a.MIN_KEY,a.MAX_KEY);return d(d({},a),{transaction:function(b,c,d){if(!J.subscr)return a.transaction(b,c,d);if(c!=="readonly")throw new E.ReadOnly("write transaction not allowed within liveQueries");return a.transaction(b,c,d)},table:function(e){var f=a.table(e),i=f.schema,j=i.primaryKey,k=j.extractKey,l=j.outbound,m=d(d({},f),{mutate:function(g){var k=g.trans,l=g.mutatedParts||(g.mutatedParts={}),m=function(a){a="idb://".concat(b,"/").concat(e,"/").concat(a);return l[a]||(l[a]=new Z())},n=m(""),o=m(":dels"),d=g.type,p=g.type==="deleteRange"?[g.range]:g.type==="delete"?[g.keys]:g.values.length<50?[Ad(j,g).filter(function(a){return a}),g.values]:[],a=p[0];p=p[1];var q=g.trans._cache;if(h(a)){n.addKeys(a);q=d==="delete"||a.length===p.length?Dd(a,q):null;!q&&d!=="add"&&o.addKeys(a);(q||p)&&Qd(m,i,q,p)}else if(a){d={from:a.lower,to:a.upper};o.add(d);n.add(d)}else n.add(c),o.add(c),i.indexes.forEach(function(a){return m(a.name).add(c)});return f.mutate(g).then(function(b){a&&(g.type==="add"||g.type==="put")&&n.addKeys(b.results);k.mutatedParts=Od(k.mutatedParts||{},l);return b})}}),n=function(b){b=b.query;var c=b.index;b=b.range;return[c,new Z((c=b.lower)!==null&&c!==void 0?c:a.MIN_KEY,(c=b.upper)!==null&&c!==void 0?c:a.MAX_KEY)]},o={get:function(a){return[j,new Z(a.key)]},getMany:function(a){return[j,new Z().addKeys(a.keys)]},count:n,query:n,openCursor:n};g(o).forEach(function(a){m[a]=function(g){var h=J.subscr,i=!!h,j=Md(J,f)&&Nd(a,g),m=j?g.obsSet={}:h;if(i){var n=function(a){a="idb://".concat(b,"/").concat(e,"/").concat(a);return m[a]||(m[a]=new Z())},p=n(""),q=n(":dels"),r=o[a](g),s=r[0],t=r[1];n(s.name||"").add(t);if(!s.isPrimaryKey)if(a==="count")q.add(c);else{var u=a==="query"&&l&&g.values&&f.query(d(d({},g),{values:!1}));return f[a].apply(this,arguments).then(function(b){if(a==="query"){if(l&&g.values)return u.then(function(a){a=a.result;p.addKeys(a);return b});var c=g.values?b.result.map(k):b.result;g.values?p.addKeys(c):q.addKeys(c)}else if(a==="openCursor"){var d=b,e=g.values;return d&&Object.create(d,{key:{get:function(){q.addKey(d.primaryKey);return d.key}},primaryKey:{get:function(){var a=d.primaryKey;q.addKey(a);return a}},value:{get:function(){e&&p.addKey(d.primaryKey);return d.value}}})}return b})}}return f[a].apply(this,arguments)}});return m}})}};function Qd(a,b,c,d){function e(b){var e=a(b.name||"");function f(a){return a!=null?b.extractKey(a):null}var g=function(a){return b.multiEntry&&h(a)?a.forEach(function(a){return e.addKey(a)}):e.addKey(a)};(c||d).forEach(function(a,b){a=c&&f(c[b]);b=d&&f(d[b]);T(a,b)!==0&&(a!=null&&g(a),b!=null&&g(b))})}b.indexes.forEach(e)}function Rd(a,b){return b.lower===void 0?!0:b.lowerOpen?T(a,b.lower)>0:T(a,b.lower)>=0}function Sd(a,b){return b.upper===void 0?!0:b.upperOpen?T(a,b.upper)<0:T(a,b.upper)<=0}function Td(a,b){return Rd(a,b)&&Sd(a,b)}function Ud(a,b,c,d,e,f){if(!c||c.length===0)return a;var g=b.query.index;d=d.schema.primaryKey;var h=d.extractKey,i=g.extractKey,j=(g.lowLevelIndex||g).extractKey;d=c.reduce(function(a,c){var d=a,e=c.type==="add"||c.type==="put"?c.values.filter(function(a){return Td(i(a),b.query.range)}).map(function(a){a=z(a);f&&Object.freeze(a);return a}):[];switch(c.type){case"add":d=a.concat(b.values?e:e.map(function(a){return h(a)}));break;case"put":var g=new Z().addKeys(c.values.map(function(a){return h(a)}));d=a.filter(function(a){a=b.values?h(a):a;return!Id(new Z(a),g)}).concat(b.values?e:e.map(function(a){return h(a)}));break;case"delete":var j=new Z().addKeys(c.keys);d=a.filter(function(a){a=b.values?h(a):a;return!Id(new Z(a),j)});break;case"deleteRange":var k=c.range;d=a.filter(function(a){return!Td(h(a),k)});break}return d},a);if(d===a)return a;d.sort(function(a,b){return T(j(a),j(b))||T(h(a),h(b))});b.limit&&b.limit<Infinity&&(d.length>b.limit?d.length=b.limit:a.length===b.limit&&d.length<b.limit&&(e.dirty=!0));return f?Object.freeze(d):d}var Vd={};function Wd(a,b){return T(a.lower,b.lower)===0&&T(a.upper,b.upper)===0&&!!a.lowerOpen===!!b.lowerOpen&&!!a.upperOpen===!!b.upperOpen}function Xd(a,b,c,d){if(a===void 0)return b!==void 0?-1:0;if(b===void 0)return 1;a=T(a,b);if(a===0){if(c&&d)return 0;if(c)return 1;if(d)return-1}return a}function Yd(a,b,c,d){if(a===void 0)return b!==void 0?1:0;if(b===void 0)return-1;a=T(a,b);if(a===0){if(c&&d)return 0;if(c)return-1;if(d)return 1}return a}function Zd(a,b){return Xd(a.lower,b.lower,a.lowerOpen,b.lowerOpen)<=0&&Yd(a.upper,b.upper,a.upperOpen,b.upperOpen)>=0}function $d(b,c,a,d){b=Vd["idb://".concat(b,"/").concat(c)];if(!b)return[];c=b.queries[a];if(!c)return[null,!1,b,null];var e=d.query?d.query.index.name:null;c=c[e||""];if(!c)return[null,!1,b,null];switch(a){case"query":e=c.find(function(a){return a.req.limit===d.limit&&a.req.values===d.values&&Wd(a.req.query.range,d.query.range)});if(e)return[e,!0,b,c];a=c.find(function(a){var b="limit"in a.req?a.req.limit:Infinity;return b>=d.limit&&(d.values?a.req.values:!0)&&Zd(a.req.query.range,d.query.range)});return[a,!1,b,c];case"count":e=c.find(function(a){return Wd(a.req.query.range,d.query.range)});return[e,!!e,b,c]}}function ae(a,b){return Object.keys(a).some(function(c){return b[c]&&Id(b[c],a[c])})}var be={},ce=!1;function de(a){Od(be,a),ce||(ce=!0,queueMicrotask(function(){ce=!1;var a=be;be={};ee(a)}))}function ee(a,b){b===void 0&&(b=!1);var c=new Set();for(var d in a){var e=/^idb\:\/\/(.*)\/(.*)\//.exec(d);if(e){var f=e[1];e=e[2];f=Vd["idb://".concat(f,"/").concat(e)];f&&fe(f,a,c,b)}}c.forEach(function(a){return a()})}function fe(a,b,c,d){var e=d&&[];for(var f=0,g=Object.entries(a.queries.query);f<g.length;f++){var h=g[f],i=h[0];h=h[1];var j=d&&[];for(var k=0,h=h;k<h.length;k++){var l=h[k];l.obsSet&&ae(b,l.obsSet)?l.subscribers.forEach(function(a){return c.add(a)}):d&&j.push(l)}d&&e.push([i,j])}if(d)for(l=0,k=e;l<k.length;l++){h=k[l];var i=h[0],j=h[1];a.queries.query[i]=j}}function ge(a,b,c,d){a.subscribers.add(c),d.addEventListener("abort",function(){a.subscribers["delete"](c),a.subscribers.size===0&&he(a,b)})}function he(a,b){setTimeout(function(){a.subscribers.size===0&&qa(b,a)},3e3)}var ie={stack:"dbcore",level:0,name:"Cache",create:function(a){var b=a.schema.name,c=d(d({},a),{transaction:function(c,d,e){var f=a.transaction(c,d,e);if(d==="readwrite"){var g=new AbortController();e=g.signal;var h=function(e){return function(){g.abort();if(d==="readwrite"){var h=new Set();for(var i=0,j=c;i<j.length;i++){var k=j[i],l=Vd["idb://".concat(b,"/").concat(k)];k=a.table(k);if(l){var m=l.optimisticOps.filter(function(a){return a.trans===f});if(m.length>0){l.optimisticOps=l.optimisticOps.filter(function(a){return a.trans!==f});for(var n=0,l=Object.values(l.queries.query);n<l.length;n++){var o=l[n];for(var p=0,q=o.slice();p<q.length;p++){var r=q[p];if(r.res!=null&&f.mutatedParts)if(e&&!r.dirty){var s=Object.isFrozen(r.res);s=Ud(r.res,r.req,m,k,r,s);r.dirty?(qa(o,r),r.subscribers.forEach(function(a){return h.add(a)})):s!==r.res&&(r.res=s,r.promise=L.resolve({result:s}))}else r.dirty&&qa(o,r),r.subscribers.forEach(function(a){return h.add(a)})}}}}}h.forEach(function(a){return a()})}}};f.addEventListener("abort",h(!1),{signal:e});f.addEventListener("error",h(!1),{signal:e});f.addEventListener("complete",h(!0),{signal:e})}return f},table:function(c){var e=a.table(c),f=e.schema.primaryKey,g=d(d({},e),{mutate:function(a){if(f.outbound||J.trans.db._options.cache==="disabled")return e.mutate(a);var g=Vd["idb://".concat(b,"/").concat(c)];if(!g)return e.mutate(a);var h=e.mutate(a);(a.type==="add"||a.type==="put")&&(a.values.length>=50||Ad(f,a).some(function(a){return a==null}))?h.then(function(b){var c=d(d({},a),{values:a.values.map(function(a,c){a=f.keyPath.includes(".")?z(a):d({},a);x(a,f.keyPath,b.results[c]);return a})});g.optimisticOps.push(c);queueMicrotask(function(){return de(a.mutatedParts)})}):(g.optimisticOps.push(a),de(a.mutatedParts),h["catch"](function(){qa(g.optimisticOps,a),de(a.mutatedParts)}));return h},query:function(a){if(!Md(J,e)||!Nd("query",a))return e.query(a);var d=J.trans.db._options.cache==="immutable",f=J,g=f.requery;f=f.signal;var h=$d(b,c,"query",a),i=h[0],j=h[1],k=h[2],l=h[3];if(i&&j)i.obsSet=a.obsSet;else{h=e.query(a).then(function(a){var b=a.result;i.res=b;if(d){for(var c=0,e=b.length;c<e;++c)Object.freeze(b[c]);Object.freeze(b)}else a.result=z(b);return a})["catch"](function(a){l&&i&&qa(l,i);return Promise.reject(a)});i={obsSet:a.obsSet,promise:h,subscribers:new Set(),type:"query",req:a,dirty:!1};l?l.push(i):(l=[i],k||(k=Vd["idb://".concat(b,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map(),optimisticOps:[],unsignaledParts:{}}),k.queries.query[a.query.index.name||""]=l)}ge(i,l,g,f);return i.promise.then(function(b){return{result:Ud(b.result,a,k===null||k===void 0?void 0:k.optimisticOps,e,i,d)}})}});return g}});return c}},je=function(){function a(b,c){var e=this;this._middlewares={};this.verno=0;var f=a.dependencies;this._options=c=d({addons:a.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},c);this._deps={indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange};f=c.addons;this._dbSchema={};this._versions=[];this._storeNames=[];this._allTables={};this.idbdb=null;this._novip=this;var g={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};g.dbReadyPromise=new L(function(a){g.dbReadyResolve=a});g.openCanceller=new L(function(a,b){g.cancelOpen=b});this._state=g;this.name=b;this.on=fc(this,"populate","blocked","versionchange","close",{ready:[Ma,F]});this.on.ready.subscribe=u(this.on.ready.subscribe,function(b){return function(c,d){a.vip(function(){var a=e._state;if(a.openComplete)a.dbOpenError||L.resolve().then(c),d&&b(c);else if(a.onReadyBeingFired)a.onReadyBeingFired.push(c),d&&b(c);else{b(c);var f=e;d||b(function a(){f.on.ready.unsubscribe(c),f.on.ready.unsubscribe(a)})}})}});this.Collection=sc(this);this.Table=hc(this);this.Transaction=Gc(this);this.Version=kd(this);this.WhereClause=Cc(this);this.on("versionchange",function(a){a.newVersion>0?!1:!1,e.close()});this.on("blocked",function(a){!a.newVersion||a.newVersion<a.oldVersion?!1:!1});this._maxKey=Lc(c.IDBKeyRange);this._createTransaction=function(a,b,c,d){return new e.Transaction(a,b,c,e._options.chromeTransactionDurability,d)};this._fireOnBlocked=function(a){e.on("blocked").fire(a),Pb.filter(function(a){return a.name===e.name&&a!==e&&!a._state.vcFired}).map(function(b){return b.on("versionchange").fire(a)})};this.use(Ed);this.use(ie);this.use(Pd);this.use(yd);this.use(Bd);this.vip=Object.create(this,{_vip:{value:!0}});f.forEach(function(a){return a(e)})}a.prototype.version=function(a){if(isNaN(a)||a<.1)throw new E.Type("Given version is not a positive number");a=Math.round(a*10)/10;if(this.idbdb||this._state.isBeingOpened)throw new E.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var b=this._versions,c=b.filter(function(b){return b._cfg.version===a})[0];if(c)return c;c=new this.Version(a);b.push(c);b.sort(Xc);c.stores({});this._state.autoSchema=!1;return c};a.prototype._whenReady=function(a){var b=this;return this.idbdb&&(this._state.openComplete||J.letThrough||this._vip)?a():new L(function(a,c){if(b._state.openComplete)return c(new E.DatabaseClosed(b._state.dbOpenError));if(!b._state.isBeingOpened){if(!b._options.autoOpen){c(new E.DatabaseClosed());return}b.open()["catch"](F)}b._state.dbReadyPromise.then(a,c)}).then(a)};a.prototype.use=function(a){var b=a.stack,c=a.create,d=a.level;a=a.name;a&&this.unuse({stack:b,name:a});var e=this._middlewares[b]||(this._middlewares[b]=[]);e.push({stack:b,create:c,level:d==null?10:d,name:a});e.sort(function(a,b){return a.level-b.level});return this};a.prototype.unuse=function(a){var b=a.stack,c=a.name,d=a.create;b&&this._middlewares[b]&&(this._middlewares[b]=this._middlewares[b].filter(function(a){return d?a.create!==d:c?a.name!==c:!1}));return this};a.prototype.open=function(){var a=this;return Hb(I,function(){return sd(a)})};a.prototype._close=function(){var a=this._state,b=Pb.indexOf(this);b>=0&&Pb.splice(b,1);if(this.idbdb){try{this.idbdb.close()}catch(a){}this._novip.idbdb=null}a.dbReadyPromise=new L(function(b){a.dbReadyResolve=b});a.openCanceller=new L(function(b,c){a.cancelOpen=c})};a.prototype.close=function(){this._close();var a=this._state;this._options.autoOpen=!1;a.dbOpenError=new E.DatabaseClosed();a.isBeingOpened&&a.cancelOpen(a.dbOpenError)};a.prototype["delete"]=function(){var a=this,b=arguments.length>0,c=this._state;return new L(function(d,e){var f=function(){a.close();var b=a._deps.indexedDB.deleteDatabase(a.name);b.onsuccess=M(function(){pd(a._deps,a.name),d()});b.onerror=W(e);b.onblocked=a._fireOnBlocked};if(b)throw new E.InvalidArgument("Arguments not allowed in db.delete()");c.isBeingOpened?c.dbReadyPromise.then(f):f()})};a.prototype.backendDB=function(){return this.idbdb};a.prototype.isOpen=function(){return this.idbdb!==null};a.prototype.hasBeenClosed=function(){var a=this._state.dbOpenError;return a&&a.name==="DatabaseClosed"};a.prototype.hasFailed=function(){return this._state.dbOpenError!==null};a.prototype.dynamicallyOpened=function(){return this._state.autoSchema};Object.defineProperty(a.prototype,"tables",{get:function(){var a=this;return g(this._allTables).map(function(b){return a._allTables[b]})},enumerable:!1,configurable:!0});a.prototype.transaction=function(){var a=ud.apply(this,arguments);return this._transaction.apply(this,a)};a.prototype._transaction=function(a,b,c){var d=this,e=J.trans;(!e||e.db!==this||a.indexOf("!")!==-1)&&(e=null);var f=a.indexOf("?")!==-1;a=a.replace("!","").replace("?","");var g,h;try{h=b.map(function(a){a=a instanceof d.Table?a.name:a;if(typeof a!=="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return a});if(a=="r"||a===Vb)g=Vb;else if(a=="rw"||a==Wb)g=Wb;else throw new E.InvalidArgument("Invalid transaction mode: "+a);if(e){if(e.mode===Vb&&g===Wb)if(f)e=null;else throw new E.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");e&&h.forEach(function(a){if(e&&e.storeNames.indexOf(a)===-1)if(f)e=null;else throw new E.SubTransaction("Table "+a+" not included in parent transaction.")});f&&e&&!e.active&&(e=null)}}catch(a){return e?e._promise(null,function(b,c){c(a)}):R(a)}var i=vd.bind(null,this,g,h,e,c);return e?e._promise(g,i,"lock"):J.trans?Hb(J.transless,function(){return d._whenReady(i)}):this._whenReady(i)};a.prototype.table=function(a){if(!l(this._allTables,a))throw new E.InvalidTable("Table ".concat(a," does not exist"));return this._allTables[a]};return a}(),ke=typeof Symbol!=="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",le=function(){function a(a){this._subscribe=a}a.prototype.subscribe=function(a,b,c){return this._subscribe(!a||typeof a==="function"?{next:a,error:b,complete:c}:a)};a.prototype[ke]=function(){return this};return a}(),me;try{me={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch(a){me={indexedDB:null,IDBKeyRange:null}}function ne(a){var b=!1,c,d=new le(function(d){var e=sa(a);function f(b){e&&Cb();b=O(a,b);e&&b["finally"](P);return b}var g=!1,h,i={},j={},k={get closed(){return g},unsubscribe:function(){if(g)return;g=!0;h&&h.abort();l&&Y.storagemutated.unsubscribe(n)}};d.start&&d.start(k);var l=!1;function m(){return ae(j,i)}var n=function(a){Od(i,a),m()&&o()},o=function(){if(g||!me.indexedDB)return;i={};var a={};h&&h.abort();h=new AbortController();var e={subscr:a,signal:h.signal,requery:o,trans:null},k=f(e);Promise.resolve(k).then(function(f){b=!0;c=f;if(g||e.signal.aborted)return;i={};j=a;!ja(j)&&!l&&(Y(Ec,n),l=!0);d.next&&d.next(f)},function(a){b=!1;if(!["DatabaseClosedError","AbortError"].includes(a===null||a===void 0?void 0:a.name)){if(g)return;d.error&&d.error(a)}})};o();return k});d.hasValue=function(){return b};d.getValue=function(){return c};return d}var oe=je;m(oe,d(d({},D),{"delete":function(a){a=new oe(a,{addons:[]});return a["delete"]()},exists:function(a){return new oe(a,{addons:[]}).open().then(function(a){a.close();return!0})["catch"]("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(a){try{return nd(oe.dependencies).then(a)}catch(a){return R(new E.MissingAPI())}},defineClass:function(){function a(a){i(this,a)}return a},ignoreTransaction:function(a){return J.trans?Hb(J.transless,a):a()},vip:qd,async:function(a){return function(){try{var b=td(a.apply(this,arguments));return!b||typeof b.then!=="function"?L.resolve(b):b}catch(a){return R(a)}}},spawn:function(a,b,c){try{a=td(a.apply(c,b||[]));return!a||typeof a.then!=="function"?L.resolve(a):a}catch(a){return R(a)}},currentTransaction:{get:function(){return J.trans||null}},waitFor:function(a,b){a=L.resolve(typeof a==="function"?oe.ignoreTransaction(a):a).timeout(b||6e4);return J.trans?J.trans.waitFor(a):a},Promise:L,debug:{get:function(){return B},set:function(a){ta(a,a==="dexie"?function(){return!0}:Tb)}},derive:p,extend:i,props:m,override:u,Events:fc,on:Y,liveQuery:ne,extendObservabilitySet:Od,getByKeyPath:w,setByKeyPath:x,delByKeyPath:da,shallowClone:ea,deepClone:z,getObjectDiff:zd,cmp:T,asap:aa,minKey:Nb,addons:[],connections:Pb,errnames:Ca,dependencies:me,cache:Vd,semVer:y,version:y.split(".").map(function(a){return parseInt(a)}).reduce(function(a,b,c){return a+b/Math.pow(10,c*2)})}));oe.maxKey=Lc(oe.dependencies.IDBKeyRange);typeof dispatchEvent!=="undefined"&&typeof addEventListener!=="undefined"&&(Y(Ec,function(a){if(!$){var b;Qb?(b=document.createEvent("CustomEvent"),b.initCustomEvent(X,!0,!0,a)):b=new CustomEvent(X,{detail:a});$=!0;dispatchEvent(b);$=!1}}),addEventListener(X,function(a){a=a.detail;$||pe(a)}));function pe(a){var b=$;try{$=!0,Y.storagemutated.fire(a),ee(a,!0)}finally{$=b}}var $=!1;if(typeof BroadcastChannel!=="undefined"){var qe=new BroadcastChannel(X);typeof qe.unref==="function"&&qe.unref();Y(Ec,function(a){$||qe.postMessage(a)});qe.onmessage=function(a){a.data&&pe(a.data)}}else if(typeof self!=="undefined"&&typeof navigator!=="undefined"){Y(Ec,function(a){try{$||(typeof localStorage!=="undefined"&&localStorage.setItem(X,JSON.stringify({trig:Math.random(),changedParts:a})),typeof self.clients==="object"&&e([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(b){return b.postMessage({type:X,changedParts:a})}))}catch(a){}});typeof addEventListener!=="undefined"&&addEventListener("storage",function(a){if(a.key===X){a=JSON.parse(a.newValue);a&&pe(a.changedParts)}});xd=self.document&&navigator.serviceWorker;xd&&xd.addEventListener("message",re)}function re(a){a=a.data;a&&a.type===X&&pe(a.changedParts)}L.rejectionMapper=Fa;ta(B,Tb);D=Object.freeze({__proto__:null,Dexie:je,liveQuery:ne,Entity:$b,cmp:T,"default":je,RangeSet:Z,mergeRanges:Hd,rangesOverlap:Id});d(je,D,{"default":je});return je})}var j=!1;function k(){j||(j=!0,i());return h.exports}function b(a){switch(a){case void 0:return k()}}e.exports=b}),null);
__d("dexie_maw",["dexie-4.0.1-alpha.22"],(function(a,b,c,d,e,f){e.exports=b("dexie-4.0.1-alpha.22")()}),null);
/**
 * License: https://www.facebook.com/legal/license/CCT5pM3qiNk/
 */
__d("tweetnacl-auth-1.0.1",["tweetnacl-1.0.3"],(function(a,b,c,d,e,f){"use strict";var g=b("tweetnacl-1.0.3");c={};var h={exports:c};function i(){(function(a,b){typeof h!=="undefined"&&h.exports?h.exports=b(g()):a.nacl.auth=b(a.nacl)})(this,function(a){if(!a)throw new Error("tweetnacl not loaded");var b=128,c=64;function d(d,e){var f=new Uint8Array(b+Math.max(c,d.length)),g;e.length>b&&(e=a.hash(e));for(g=0;g<b;g++)f[g]=54;for(g=0;g<e.length;g++)f[g]^=e[g];f.set(d,b);d=a.hash(f.subarray(0,b+d.length));for(g=0;g<b;g++)f[g]=92;for(g=0;g<e.length;g++)f[g]^=e[g];f.set(d,b);return a.hash(f.subarray(0,b+d.length))}function e(a,b){var c=new Uint8Array(32);c.set(d(a,b).subarray(0,32));return c}e.full=function(a,b){return d(a,b)};e.authLength=32;e.authFullLength=64;e.keyLength=32;return e})}var j=!1;function k(){j||(j=!0,i());return h.exports}function a(a){switch(a){case void 0:return k()}}e.exports=a}),null);
__d("tweetnacl-auth",["tweetnacl-auth-1.0.1"],(function(a,b,c,d,e,f){e.exports=b("tweetnacl-auth-1.0.1")()}),null);/*FB_PKG_DELIM*/
__d("LSQueryBulkUtils",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){b=await Promise.all(b.map(function(b){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a).getKeyRange(b))}));return b.flat()}async function b(a,b){await Promise.all(b.map(function(b){return a.put(b)}));return b}g.bulkGetByIndex=a;g.bulkPut=b}),98);
__d("MAWUnsafeCoerce",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeCoerce=a}),66);
__d("MAWBulkEditMsgsTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWThreadSnippetForTextMsg","MAWUnsafeCoerce","WAGlobals","WAJids","WAMsgMap","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){var f=[];for(var g=0;g<a.length;g++){var h=a[g],i=d("MAWJidUtils").maybeToProtocolMsgId(h.author,h.threadJid,h.originalMsgExternalId);if(i!=null){i=(i=e.get(i))==null?void 0:i.msgId;i!=null?f.push(babelHelpers["extends"]({},h,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(b[g]),originalMsgId:i})):c("FBLogger")("messenger_e2ee_web").warn("[edit messagehistory] Failed to get the original msgId for a msg that has been edited.")}}d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:f})}function a(a,b){var c=new Set(),e=[];b.forEach(function(a){var b=a.chatJid;a=a.msg;c.add(b);e.push(a.originalMsgExternalId)});return d("MAWDexieTable").dexieAll([a.messages.where("externalId").anyOf(e).toArray(),a.messages.where("quoteExternalId").anyOf(e).toArray(),a.editMsgHistory.where("originalMsgExternalId").anyOf(e).toArray(),a.threads.where("jid").anyOf(Array.from(c)).toArray()]).then(function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return{editMsgHistory:d,originalMsgs:b,quoteMessages:c,threads:a}})}function i(a,b,e){var f=new Map();b.values().forEach(function(a){var b;b=(b=a.threadJid)!=null?b:d("WAJids").unsafeCoerceToChatJid("");if(f.has(b)){var c;(c=f.get(b))==null?void 0:c.push(a)}else f.set(b,[a])});b=e.map(function(b){return d("MAWDbMsgTxns").getThreadNewestMessageId(a,b,"defer_to_qe").then(function(a){return{editedMsgsInThread:f.get(b.jid),newestMsgId:a,thread:b}})});return d("MAWDexieTable").dexieAll(b).then(function(a){a.forEach(function(a){var b=a.editedMsgsInThread,e=a.newestMsgId;a=a.thread;if(a==null||b==null)return;b=b.filter(function(a){return a.msgId===e})[0];if(b!=null){var f=b.author;if(f==="@system")throw c("err")("[edit message] author should not be @system.");f=d("WAJids").userIdFromJid(f==="@me"?d("WAGlobals").getMyUserJid():f);b=c("MAWThreadSnippetForTextMsg")(b,f,d("WAJids").interpretAsGroupJid(a.jid)!=null);var g=b.snippetParams;b=b.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:g,snippetSenderContactId:f,snippetType:b,threadJid:a.jid})})}})})}function b(a,b,e){var f=e.editMsgHistory,g=e.originalMsgs,j=e.quoteMessages,l=e.threads,m=g.reduce(function(a,b){var c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?a:a.set(c,b)},new(d("WAMsgMap").MsgMap)());e=f.reduce(function(a,b){var c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?a:a.set(c,b)},new(d("WAMsgMap").MsgMap)());g=k(b,{messageHistoriesToEdit:e,messagesToEdit:m});var n=g[0],o=g[1],p=g[2];return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,n,!1).then(function(b){h(n,b,m);var e=new(d("WAMsgMap").MsgMap)();o.entries().forEach(function(a){var b=a[0];a=a[1];var f=m.get(b);if(f==null){c("FBLogger")("messenger_e2ee_web").warn("Cannot find the original msg for the edit action.");return}if(f.type!==d("WAMsgType").MSG_TYPE.TEXT&&f.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT)throw c("err")("Only text or cipher text can be edited. Original msg type: %s",f.type);f=babelHelpers["extends"]({},f,{editCount:((f=f.editCount)!=null?f:0)+((f=p.get(b))!=null?f:0),msgContent:a.editMsgContent,type:d("WAMsgType").MSG_TYPE.TEXT});e.set(b,f)});return i(a,e,l).then(function(){var b=j.map(function(a){var b=a.quote,f=a.quoteExternalId,g=a.threadJid;if(b==null){c("FBLogger")("messenger_e2ee_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",a.externalId);return}g=d("MAWJidUtils").maybeToProtocolMsgId(b.content.author,g,f);if(g==null)return;f=e.get(g);if(f==null)return;return babelHelpers["extends"]({},a,{quote:babelHelpers["extends"]({},b,{content:babelHelpers["extends"]({},b.content,{msgContent:babelHelpers["extends"]({},f.msgContent)})})})}).filter(Boolean);return a.messages.bulkPut(e.values().concat(b)).then(function(){e.values().forEach(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a)})})})}).then(function(){b.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})})})}function j(a,b){var e;switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.EDIT_ACTION:return{author:a.author,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=a.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:(e=a.originalMsgExternalId)!=null?e:a.externalId,sendStatus:d("MAWAckLevel").ACK.sent,specialTextSize:a.specialTextSize,threadJid:b};case d("WAMsgType").MSG_TYPE.CIPHERTEXT:return{author:a.author,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:{content:""},originalMsgExternalId:a.externalId,sendStatus:d("MAWAckLevel").ACK.sent,specialTextSize:a.specialTextSize,threadJid:b};default:a.type;throw c("err")("MAWBulkEditMsgsTxns::getMessageHistory: Unexpected msg type")}}function k(a,b){var e=b.messageHistoriesToEdit,f=b.messagesToEdit,g=[],h=new(d("WAMsgMap").MsgMap)(),i=new(d("WAMsgMap").MsgMap)();a.forEach(function(a){var b=a.chatJid;a=a.msg;var k=d("MAWJidUtils").maybeToProtocolMsgId(a.author,b,a.originalMsgExternalId);if(k==null)throw c("err")("[protocolMsgId] Cannot get the protocol id for the edit action. isAuthorSystem = %s; chatJid = %s; externalId = %s",d("WAJids").isAuthorSystem(a.author),!!b,!!a.originalMsgExternalId);var l=d("MAWJidUtils").maybeToProtocolMsgId(a.author,b,a.externalId);if(l==null)throw c("err")("[editMsgProtocolMsgId] Cannot get the protocol id for the edit action. isAuthorSystem = %s; chatJid = %s; externalId = %s",d("WAJids").isAuthorSystem(a.author),!!b,!!a.externalId);if(e.get(l)==null){g.push(j(a,b));l=(l=i.get(k))!=null?l:0;var m=f.get(k);i.set(k,l+1);if(e.get(k)==null&&l===0&&m!=null){if(m.type!==d("WAMsgType").MSG_TYPE.TEXT&&m.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT)throw c("err")("Only text or cipher text can be edited. Original msg type: %s",m.type);g.push(j(m,b))}}l=h.get(k);m=l==null?void 0:l.serverTs;b=a==null?void 0:a.serverTs;(m==null||b==null||m<b)&&h.set(k,a)});return[g,h,i]}g.prepareDataForMessageEdit=a;g.bulkEditMsgs=b;g.getMessageHistory=j}),98);
__d("MAWHIMLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["HandleIncomingMessage"]);g["default"]=a}),98);
__d("MAWDbRavenActionTxns",["MAWBridgeTypesCreators","MAWDbMsg","MAWIndexedDb","MAWMsg","MAWRavenUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){return a.messages.where("externalId").equals(b.ravenActionToMsgExternalId).filter(function(a){return a.threadJid===e.jid}).first().then(function(f){var g=f==null?void 0:f.msgId;if(g==null)throw c("err")("Cannot Write Raven Action without ID of Raven Message");return h(a,f).then(function(c){var d=babelHelpers["extends"]({msgId:g,threadJid:e.jid},b);return a.unrenderedMessages.add(d).then(function(a){return babelHelpers["extends"]({rowId:a},d)})}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"RavenActionUpdate",value:d("MAWBridgeTypesCreators").createBridgeRavenAction(a)});return})})}function h(a,b){if((b==null?void 0:b.type)!=="Raven")throw c("err")("Cannot Modify Message because Message is not Raven Message");var e=[d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(Number(b.ravenEphemeralMediaState)),d("MAWMsg").MAWRavenMsgEphemeralType.cast(Number(b.ravenEphemeralType))],f=e[0];e=e[1];if(f==null||e==null)throw c("err")("ravenEphemeralMediaStateEnum or ravenEphemeralTypeEnum is null");f=d("MAWRavenUtils").getNextRavenMessageEphemeralState(f,e);return a.messages.put(babelHelpers["extends"]({},b,{ravenEphemeralMediaState:f}))}function b(a,b,c){c=d("MAWDbMsg").isRavenActionMsgType(c)&&(b==null?void 0:b.externalId)!=null?[b.externalId]:[];return a.messages.where("externalId").anyOf(c).filter(function(a){return a.author===(b==null?void 0:b.author)&&a.threadJid===(b==null?void 0:b.chat)}).first()}g.writeRavenActionMsg=a;g.modifyRavenMsgWithActionMsg=h;g.maybeGetRavenMsgQueryByProtocolMsgId=b}),98);
__d("MAWEphemeralUtils",["MAWLocalizationType","WAArmadilloApplication.pb","WAGlobals","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";var h=60,i=60*h,j=24*i;function a(a,b,c,e){var f=[],g=b===j,k=a===d("WAGlobals").getMyUserJid();if(e)e=d("MAWLocalizationType").LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET;else if(!k||a==null)b===0?e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:b<h?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,f.push(b.toString())):b<i?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,f.push((b/h).toString())):b<j||g?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,f.push((b/i).toString())):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,f.push((b/j).toString()));else{a=d("WAJids").extractUserId(a).toString();b===0?k?e=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF:(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,f.push(a)):b<h?(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,f.push(a)),f.push(b.toString())):b<i?(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,f.push(a)),f.push((b/h).toString())):b<j||g?(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,f.push(a)),f.push((b/i).toString())):(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,f.push(a)),f.push((b/j).toString()))}return{ephemeralSettingChangeContent:f,ephemeralSettingChangeType:e}}function b(a,b,e){var f,g=[];b=d("WAJids").extractUserId(b).toString();switch(a){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:e?f=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT:(f=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,g.push(b));break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:e?f=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN:(f=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,g.push(b));break;default:throw c("err")("Received unexpected screenshot action type")}return{ephemeralScreenshotActionContent:g,ephemeralScreenshotActionType:f}}g.getEphemeralSettingChangeData=a;g.getEphemeralScreenshotActionData=b}),98);
__d("MAWEphemeralAdminMsgBuildTxns",["MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralUtils","MAWExternalId","MAWIndexedDb","MAWMsgType","MAWThreadSnippetBuildTxns","MAWWriteMsgTxns","WAGlobals","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i,j){if(e<0)throw c("err")("Received unexpected ephemeral time setting");e=d("MAWEphemeralUtils").getEphemeralSettingChangeData(b,e,h,i);h=e.ephemeralSettingChangeContent;i=e.ephemeralSettingChangeType;var k={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:(e=b)!=null?e:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:h,adminType:i,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};e=j!=null&&b!=null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,j,g.jid,b):d("MAWDexieTable").dexieResolve();return e.then(function(b){if(b==null){var c,e=babelHelpers["extends"]({},k,{externalId:(c=j)!=null?c:d("MAWExternalId").generateExternalId(),threadJid:g.jid,ts:f});return d("MAWWriteMsgTxns").writeMsg(a,e,g).then(function(a){return babelHelpers["extends"]({},e,{msgId:a.msgId,rowId:a.rowId})})}else if(b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var h=babelHelpers["extends"]({},b,k);return a.messages.put(h).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,[b])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(h)});return d("MAWDbMsgTxns").getThreadNewestMessageId(a,g).then(function(b){return h.msgId===b?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,h).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:g.jid})});return h}):h})})}else return null})}function b(a,b,c,e,f,g,h){var i=b===d("WAGlobals").getMyUserJid(),j=d("MAWEphemeralUtils").getEphemeralScreenshotActionData(f,b,i),k=j.ephemeralScreenshotActionContent;j=j.ephemeralScreenshotActionType;if(h==null){var l={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:i?d("WAJids").AUTHOR_ME:b,externalId:g,msgContent:{adminMsgContent:k,adminType:j,screenshotActionType:f,version:1},threadJid:c.jid,ts:e,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return d("MAWWriteMsgTxns").writeMsg(a,l,c).then(function(a){return babelHelpers["extends"]({},l,{msgId:a.msgId,rowId:a.rowId})})}else if(h.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var m=babelHelpers["extends"]({},h,{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:i?d("WAJids").AUTHOR_ME:b,msgContent:{adminMsgContent:k,adminType:j,screenshotActionType:f,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION});return a.messages.put(m).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(h.threadJid,[h])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(m)});return d("MAWDbMsgTxns").getThreadNewestMessageId(a,c).then(function(b){return m.msgId===b?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,m).then(function(a){var b=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:e,snippetType:a,threadJid:c.jid})});return m}):m})})}else return d("MAWDexieTable").dexieResolve(null)}g.writeEphemeralSettingAdminMsg=a;g.writeEphemeralScreenshotActionMsg=b}),98);
__d("MAWMsgActionType",[],(function(a,b,c,d,e,f){"use strict";a={DELETE_FOR_ME:"DELETE_FOR_ME",NO_ACTION:"NO_ACTION",REVOKE:"REVOKE",UPDATE_CIPHERTEXT:"UPDATE_CIPHERTEXT",UPDATE_CIPHERTEXT_WITH_ASSOCIATED:"UPDATE_CIPHERTEXT_WITH_ASSOCIATED",WRITE:"WRITE",WRITE_WITH_ASSOCIATED:"WRITE_WITH_ASSOCIATED"};f.MSG_ACTION=a}),66);
__d("MAWDbReceiptTxns",["MAWDexieTable","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly fetched null data from a msgIdToReceiptData map"]);h=function(){return a};return a}function a(a,b,c){return i([{deliveryReceipts:b==="delivered"?c:[],msgId:a,readReceipts:b==="read"?c:[],senderReceipts:b==="sender"?c:[]}]).then(function(a){return a[0]||{type:"missing"}})}function i(a){var b=a.map(function(a){return a.msgId}),c=new Map();a.forEach(function(a){c.set(a.msgId,a)});a=b.map(function(a){var b=c.get(a);if(b==null){d("WALogger").ERROR(h());return null}var e=new Set(),f=new Map(),g=b.deliveryReceipts,i=b.readReceipts;b=b.senderReceipts;[{receiptType:"delivered",receivers:g},{receiptType:"read",receivers:i},{receiptType:"sender",receivers:b}].forEach(function(a){var b=a.receiptType;a=a.receivers;a.forEach(function(a){var c=a.device;a=a.ts;c=d("WAJids").extractUserJid(c);var g=!1;if(b!=="sender"){var h=f.get(c);a=j(h,b,a);f.set(c,a);g=k(h,a)}g&&e.add(c)})});return{affectedUserJids:e,receipt:{msgId:a,statusTsPerUser:f}}}).filter(Boolean);return d("MAWDexieTable").dexieResolve(a.map(function(a){return{affectedUserJids:a.affectedUserJids,receipt:a.receipt}}))}function j(a,b,c){var d;d=(d=a==null?void 0:a.deliveredTs)!=null?d:c;a=a==null?void 0:a.readTs;b==="read"&&a==null&&(a=c);return{deliveredTs:d,readTs:a}}function k(a,b){return((b==null?void 0:b.deliveredTs)||0)>((a==null?void 0:a.deliveredTs)||0)||((b==null?void 0:b.readTs)||0)>((a==null?void 0:a.readTs)||0)}function b(a,b){return a.receipts.bulkDelete(b)}g.writeReceiptsForDevices=a;g.bulkWriteReceiptsForDevices=i;g.bulkDeleteAllReceiptsForMessages=b}),98);
__d("MAWMessageRequestUtils",["MAWFolderTypes","WADbContact"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a===d("MAWFolderTypes").FOLDER_ID.PENDING||a===d("MAWFolderTypes").FOLDER_ID.OTHER;return a}function b(a,b){return(a===null||a===d("MAWFolderTypes").FOLDER_ID.INBOX)&&(b===d("WADbContact").REVERSED_ONE_WAY_CONTACT||b===d("WADbContact").NON_CONTACT)}g.isMessageRequestOrSpamThread=a;g.isInboxRequest=b}),98);
__d("MAWMarkThreadAsReadTxns",["FBLogger","MAWBridgeThread","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMessageRequestUtils","MAWTimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d,e,f){f===void 0&&(f=!1);var g=new Map();g.set(b,{msgId:d,sortOrderMs:e});return h(a,g,f).then(function(a){a=a.get(b);if(a==null)throw c("FBLogger")("messenger_web_devx","maw_mark_thread_as_read").warn("ThreadReadReceiptInfo unexpectedly unavailable for thread\n         in markThreadAsReadUpToMsgSortOrderMs()");return a})}function h(a,b,c){c===void 0&&(c=!1);return j(a,b).then(function(e){var f=e.threadJidToReadReceiptInfo,g=e.updatedThreads;return a.threads.bulkPut(g).then(function(){g.forEach(function(a){var e;e=(e=b.get(a.jid))==null?void 0:e.sortOrderMs;e!=null&&!c&&d("MAWIndexedDb").afterTransaction({tag:"ThreadTimestampsUpdated",value:d("MAWBridgeThread").createBridgeThreadTimestampsUpdated(a.jid,e,e,!1)});f.set(a.jid,{isReadReceiptExpectedToBeSent:(a=(e=f.get(a.jid))==null?void 0:e.isReadReceiptExpectedToBeSent)!=null?a:!1,type:"success"})});return f})})}function i(a,b,c){return d("MAWDbMsgTxns").getThreadOldestMessageId(a,b.jid).then(function(a){if(a==null)return null;a=d("MAWTimeUtils").ensureValidMillisTime(b.newestMsgTs);return babelHelpers["extends"]({},b,{lastReadMsg:c.msgId,newestMsgTs:a})})}function j(a,b){var e=new Map(),f=Array.from(b.keys()),g=[];return a.threads.where("jid").anyOf(f).toArray().then(function(h){var j=new Map();h.forEach(function(a){return j.set(a.jid,a)});f.forEach(function(a){j.has(a)||j.set(a,null)});h=Array.from(j).map(function(d){var f=d[0];d=d[1];if(d==null){e.set(f,{isReadReceiptExpectedToBeSent:!1,type:"missing"});return}f=k(d.folder);e.set(d.jid,{isReadReceiptExpectedToBeSent:f,type:"success"});f=b.get(d.jid);if(f==null)throw c("FBLogger")("maw_threads","maw_mark_thread_as_read").warn("ThreadReadReceiptInfo unexpectedly unavailable for thread\n            in getThreadJidToReadReceiptInfo()");return i(a,d,f).then(function(a){a!=null&&g.push(a)})});return d("MAWDexieTable").dexieAll(h).then(function(){return{threadJidToReadReceiptInfo:e,updatedThreads:g}})})}function k(a){return!d("MAWMessageRequestUtils").isMessageRequestOrSpamThread(a)}g.markThreadAsReadUpToMsgSortOrderMs=a;g.bulkMarkThreadAsReadUpToMsgSortOrderMs=h;g.isReadReceiptExpectedToBeSentFor=k}),98);
__d("MAWPendingReceiptProcessingTxns",["MAWDbMsg","MAWDbParticipantTxns","MAWDbReceiptTxns","MAWDexieTable","MAWMarkThreadAsReadTxns","WAJids","WALogger","WAMsg","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing pending receipts for "," from ",""]);h=function(){return a};return a}function a(a,b,c){var e=d("WAMsg").craftWAMsgIdString({author:c.author,chat:b,externalId:c.externalId});return a.pendingReceipts.get(e).then(function(b){if(b==null)return;d("WALogger").LOG(h(),c.externalId,c.author);if(b.author===d("WAJids").AUTHOR_ME){var f=d("MAWDexieTable").dexieResolve();b.deliveryReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(c.msgId,"delivered",b.deliveryReceipts)}));b.readReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(c.msgId,"read",b.readReceipts)}));return f.then(function(b){var f=[];b!=null&&b.type!=="missing"&&b.receipt.statusTsPerUser.forEach(function(b,e){var g=b.deliveredTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0),h=b.readTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0);b=(b=b.readTs)!=null?b:d("WATimeUtils").castToUnixTime(0);f.push(d("MAWDbParticipantTxns").updateParticipantTimestamps(a,[c.threadJid,e],g,h,b))});return d("MAWDexieTable").dexieAll(f).then(function(){a.pendingReceipts["delete"](e)})})}else return d("MAWDexieTable").dexieAll([d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgSortOrderMs(a,c.threadJid,c.msgId,d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(c)))]).then(function(){return a.pendingReceipts["delete"](e)})})}g.processPendingReceipts=a}),98);
__d("MAWWriteEditTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWBulkEditMsgsTxns","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWThreadSnippetForTextMsg","MAWUnsafeCoerce","MAWWriteMsgTxns","WAGlobals","WAJids","WAMsgType","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=b.args,f=b.externalId,g=e.editMsgContent;e=e.originalProtocolMsgId;var i=e.chat,j=e.externalId;return d("MAWDexieTable").dexieAll([a.threads.get({jid:i}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e)]).then(function(e){var k=e[0],l=e[1];if(k==null)return d("WAResultOrError").makeError("missing_thread");if(l==null)return d("WAResultOrError").makeError("missing_msg");if(l.type!==d("WAMsgType").MSG_TYPE.TEXT)throw c("err")("Only text or cipher text can be edited. Original msg type: %s",l.type);return d("MAWDexieTable").dexieAll([a.messages.where("quoteExternalId").equals(j).filter(function(a){return((a=a.quote)==null?void 0:a.content.type)!==d("WAMsgType").NOTE_REPLY}).toArray(),a.editMsgHistory.where("originalMsgExternalId").equals(j).toArray(),d("MAWDbMsgTxns").getThreadNewestMessageId(a,k)]).then(function(e){var m=e[0],n=e[1],o=e[2];e=n.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===f});if((e==null?void 0:e.sendStatus)!=null&&e.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("already_sent");e=[];e.push(h(b,i,j));n=n.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===j});n==null&&(l.editCount==null||l.editCount===0)&&e.push(h(l,i,j));return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,e,!1).then(function(){var b,e=babelHelpers["extends"]({},l,{ack:d("MAWAckLevel").ACK.clock,editCount:((b=l.editCount)!=null?b:0)+1,msgContent:g});if(o!=null&&o===e.msgId){b=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid());var h=c("MAWThreadSnippetForTextMsg")(e,b,d("WAJids").interpretAsGroupJid(k.jid)!=null),n=h.snippetParams;h=h.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:n,snippetSenderContactId:b,snippetType:h,threadJid:k.jid})})}var p=[],q=d("WAGlobals").getMyUserJid();n=m.find(function(a){var b;return(((b=a.quote)==null?void 0:b.content.author)===d("WAJids").AUTHOR_ME||((b=a.quote)==null?void 0:b.content.author)===q)&&a.threadJid===i});if(n!=null){b=n.quote;h=n.quoteExternalId;if(b==null)c("FBLogger")("messenger_e2ee_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",h);else{h=babelHelpers["extends"]({},n,{quote:babelHelpers["extends"]({},b,{content:babelHelpers["extends"]({},b.content,{msgContent:babelHelpers["extends"]({},e.msgContent)})})});p.push(h)}}return a.messages.bulkPut([e].concat(p)).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,l)}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e,void 0,a)})}).then(function(){p.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult({originalMsgExternalId:j,originalMsgId:l.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:i,externalId:f}})})})})})}function h(a,b,c){var e;return{author:d("WAJids").AUTHOR_ME,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=(e=a.args)==null?void 0:e.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:c,sendStatus:d("MAWAckLevel").ACK.clock,specialTextSize:a.specialTextSize,threadJid:b}}function b(a,b,c,e){if(b.type!==d("WAMsgType").MSG_TYPE.TEXT||!e||e.length===0)return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b,c);var f=e.sort(function(a,b){return b.editTs-a.editTs})[0].msgContent;e=e.length;return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,babelHelpers["extends"]({},b,{editCount:e,msgContent:f}),c).then(function(c){return(c.type===d("WAMsgType").MSG_TYPE.TEXT?d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,[d("MAWBulkEditMsgsTxns").getMessageHistory(babelHelpers["extends"]({},c,{msgContent:b.msgContent}),c.threadJid)]):d("MAWDexieTable").dexieResolve()).then(function(){return c})})}g.writeEdit=a;g.writeNewIncomingMsgAndEditHistory=b}),98);
__d("MAWDbGroupInviteTxns",["MAWDexieTable","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]])["delete"]()}function h(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).equals([b,c]).first()}function c(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]]).toArray()}function e(a,b){return b.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE?b.invitedParticipantUserJid==null?d("MAWDexieTable").dexieResolve():h(a,b.threadJid,b.invitedParticipantUserJid):d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvitesByThreadAndInvitedParticipant=b;g.maybeGetGroupInvite=h;g.getGroupInvitesByThreadAndInvitedParticipant=c;g.getAndCheckGroupInviteFromMsg=e}),98);
__d("MAWGroupInviteManagementTxns",["MAWDbGroupInviteTxns","MAWDbParticipantTxns","MAWDexieTable","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=!1;return d("MAWDbParticipantTxns").getInvitedParticipantsInThread(a,b).then(function(e){if(e.length===0){c=!0;var f=d("WAGlobals").getMyUserJid();return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,f).then(function(){return c})}else{var g=[];e.forEach(function(c){g.push(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,c.userJid))});return d("MAWDexieTable").dexieAll(g).then(function(){return c})}})}g.deleteGroupInvitesByThread=a}),98);
__d("MAWLoadMessageRequestCapabilitiesTxns",["MAWDexieTable","MAWIndexedDb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){for(var b=0;b<a.length;b++){var c=a[b],e=d("WAJids").interpretAsUserJid(c.jid);if(e==null)continue;d("MAWIndexedDb").afterTransaction({tag:"OneToOneMessageRequestLoaded",value:{fbid:d("WAJids").extractUserId(e),threadJid:c.jid}})}return d("MAWDexieTable").dexieResolve()}g.loadMessageRequestDataForThreads=a}),98);
__d("MAWThreadManagementTxns",["MAWBridgeEventTransmitter","MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbGroupInfoTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWGroupInviteManagementTxns","MAWIndexedDb","MAWLoadMessageRequestCapabilitiesTxns","WAGlobals","WAJids","WALogger","WAMsgType","WASortedLists","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted "," media rows and "," chunk rows"]);h=function(){return a};return a}function a(a,b){var c=b.authoritativeThreadKey,e=b.createTs,f=b.folder,g=b.lastActivityTimestamp,h=b.lastReadWatermarkTimestamp,i=b.offlineThreadingId,j=b.userJid;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:c,clientThreadKey:i,createTs:e,description:"getOrSetupOneToOneThread",folder:f,jid:j,lastActivityTimestamp:g,lastReadWatermarkTimestamp:h}).then(function(b){var c=b.created;b=b.thread;return m(a,j,c,b)})}function b(a,b){return d("MAWGetOrCreateThreadTxns").bulkGetOrCreateThread(a,b.map(function(a){var b=a.authoritativeThreadKey,c=a.createTs,d=a.folder,e=a.lastActivityTimestamp,f=a.lastReadWatermarkTimestamp,g=a.offlineThreadingId;a=a.userJid;return{authoritativeThreadKey:b,clientThreadKey:g,createTs:c,description:"getOrSetupOneToOneThread",folder:d,jid:a,lastActivityTimestamp:e,lastReadWatermarkTimestamp:f}})).then(function(c){return d("MAWDexieTable").dexieAll(c.map(function(c,d){var e=c.created;c=c.thread;return m(a,b[d].userJid,e,c)}))})}function e(a,b,c,e){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){if(!b.success)return null;var f=b.value;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(f.creationTs),description:"getOrRepairGroupThread",folder:c,jid:f.groupJid,skipVerifyThread:e}).then(function(a){var b=a.created;a=a.thread;return{created:b,groupInfo:f,thread:a}})})}function i(a,b){var c=[],e=[];b.forEach(function(a){d("MAWDbMsg").isMediaMsg(a)&&a.mediaId!=null&&(c.push(a.mediaId),e.push(a.msgId))});return a.media.bulkGet(c).then(function(b){var c=[],f=[];b.forEach(function(a,b){if(a!=null){var g=e[b];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.plaintextHash!=null&&c.push(a.hashedPlaintextHash),f.push(a.mediaId))}});b=a.media.bulkDelete(f);var g=a.chunk.where("hashedPlaintextHash").anyOf(c)["delete"]();return d("MAWDexieTable").dexieAll([b,g]).then(function(){d("WALogger").LOG(h(),f.length,c.length)})})}function j(a,b){return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b).then(function(c){return a.messages.where("threadJid").equals(b.jid).toArray().then(function(d){return k(a,b,c,d,!0)})})}function f(a,b,c,e){var f=c==null?void 0:c.lastMessageTimestamp;if(c==null)return j(a,b);var g=a.messages.where("threadJid").equals(b.jid).toArray(),h=d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b);return d("MAWDexieTable").dexieAll([g,h]).then(function(g){var h=g[0];g=g[1];var i=[],j=new Set();f!=null&&h.forEach(function(a){a.ts<=f+1&&(j.add(a.msgId),i.push(a))});if((c==null?void 0:c.messages.length)!==0){var l=new Set();c.messages.forEach(function(a){l.add((a=a.key)==null?void 0:a.id)});h.forEach(function(a){l.has(a.externalId)&&!j.has(a.msgId)&&(j.add(a.msgId),i.push(a))})}if(i.length!==h.length)for(var m=h,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}p=p;if(!j.has(p.msgId)&&p.type!==d("WAMsgType").ADMIN)return k(a,b,g,i,!1,e)}return k(a,b,g,h,!0,e)})}function k(a,b,c,e,f,g){var h=d("WAJids").interpretAsGroupJid(b.jid),j=f?d("MAWDbThreadTxns").deleteThreadRow(a,b.jid):d("MAWDexieTable").dexieResolve(),k=f?d("MAWDbParticipantTxns").deleteAllParticipantsForThread(a,b.jid):d("MAWDexieTable").dexieResolve(),l=d("MAWDexieTable").dexieResolve(!1),m=d("MAWDexieTable").dexieResolve();h!=null&&f&&(l=d("MAWGroupInviteManagementTxns").deleteGroupInvitesByThread(a,h),m=d("MAWDbGroupInfoTxns").deleteGroupInfo(a,h));return d("MAWDexieTable").dexieAll([i(a,e),d("MAWDbReactionsTxns").deleteAllReactionsForMessages(a,e),d("MAWDbMsgTxns").deleteMessages(a,e,g),j,k,m,l]).then(function(a){a[0];a[1];a[2];a[3];a[4];a[5];a=a[6];f?(d("MAWBridgeEventTransmitter").deleteMessagesOfThreadAfterTxn(b,c),h!=null&&a&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:d("MAWBridgeTypesCreators").createBridgeDeleteGroupInvite(b.jid)}),d("MAWIndexedDb").afterTransaction({tag:"ThreadHiddenV2",value:b.jid})):d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.jid,e)});return{deletedMessages:e.map(function(a){return d("MAWDbMsg").getWAMsgId(a)})}})}function l(a,b){var c=b.offlineThreadingId,e=b.userJid;return d("MAWGetOrCreateThreadTxns").createThread(a,{clientThreadKey:c,description:"setupOneToOneThread",jid:e}).then(function(b){return m(a,e,!0,b)})}function m(a,b,e,f){var g=[d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads([f])];b=[{type:"participant",userJid:b}];var h=d("WAGlobals").getMyUserJid();h!==f.jid&&b.push({type:"participant",userJid:h});if(c("gkx")("23923")){g.push(d("MAWDbParticipantTxns").bulkUpsertParticiantsInThread(a,f.jid,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})}));return d("MAWDexieTable").dexieAll(g).then(function(){return{created:e,thread:f}})}e?g.push(d("MAWDbParticipantTxns").bulkAddParticipants(a,f.jid,b).then(function(){})):g.push(d("MAWDbParticipantTxns").getParticipantsInThread(a,f.jid).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})}));return d("MAWDexieTable").dexieAll(g).then(function(){return{created:e,thread:f}})}g.getOrSetupOneToOneThread=a;g.bukGetOrSetupOneToOneThread=b;g.getGroupThread=e;g.deleteAllThreadData=j;g.metaSyncChatDeleteThread=f;g.setupOneToOneThread=l}),98);
__d("MAWWriteGroupInviteTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLowLevelApiTypes","MAWThreadManagementTxns","WAGlobals","WAGroupInviteUtils","WAJids","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){return!c.success?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP:d("MAWDbGroupInviteTxns").maybeGetGroupInvite(a,b.threadJid,b.inviteeJid).then(function(c){return c&&!d("WATimeUtils").isInFuture(c.inviteExpirationTs)?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE:d("MAWDbGroupInviteTxns").putGroupInvite(a,b)})})}function b(a,b,c,e){var f=b.caption,g=b.groupJid,h=b.inviteCode;b=b.inviteExpiration;var i=d("WAJids").interpretAsUserJid(c);if(g==null||b==null||h==null||i==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"}));c=[d("WATimeUtils").castLongIntToUnixTime(b),d("WAJids").toGroupJid(g),d("WAGroupInviteUtils").toInviteCode(h)];var j=c[0];b=c[1];var k=c[2],l={folder:e,groupJid:b,inviteCode:k,inviteExpireTs:j,inviterJid:i,type:"group_invite"};return d("MAWThreadManagementTxns").getGroupThread(a,b,e,!0).then(function(b){return b==null?d("WAResultOrError").makeError(l):d("MAWDbParticipantTxns").getParticipant(a,b.thread.jid,i)}).then(function(b){if(!b.success)return d("WAResultOrError").makeError(l);var c=d("WAGlobals").getMyUserJid(),e=d("MAWDbParticipant").craftParticipantId(b.value.threadJid,c);return d("MAWDbGroupInviteTxns").putGroupInvite(a,{caption:f==null?void 0:f.text,inviteCode:k,invitedParticipantId:e,inviteeJid:c,inviteExpirationTs:j,inviterJid:i,threadJid:b.value.threadJid}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(a)});return d("WAResultOrError").makeResult()})})}g.writeGroupInvite=a;g.writeIncomingGroupInviteMsg=b}),98);
__d("MAWExpiredXMACleaner",["MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExpiredXMACleaner: Adding timestamps backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startExpiredXMACleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.XMA))}function b(a){if(k==null){var b="Trying to add new addNewExpiredXMACleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startExpiredXMACleaner=a;g.addNewExpiredXMACleanerTimestamp=b;g.getExpiredXMACleaner_FOR_TESTING_ONLY=e;g.resetExpiredXMACleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWXMAManagementTxns",["MAWDexieTable","MAWMediaManagementTxns","MAWXMAUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){var g=b.unstoredDbXMA,i=b.unstoredFavicon,j=b.unstoredHeaderMedia,k=b.unstoredPreviews;f===void 0&&(f=!1);var l=new Map(),m=function(b){return b!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b,c,!0).then(function(a){return[b.plaintextHash,a]}):d("MAWDexieTable").dexieResolve([void 0,void 0])};f||(l.set(i==null?void 0:i.plaintextHash,m(i)).set(j==null?void 0:j.plaintextHash,m(j)),k==null?void 0:k.forEach(function(a){l.set(a==null?void 0:a.plaintextHash,m(a))}));b=Array.from(l.values());return d("MAWDexieTable").dexieAll(b).then(function(b){var l,m=new Map(b),n=((l=k)!=null?l:[]).map(function(a){return m.get(a.plaintextHash)}).filter(Boolean);return h(a,f?d("MAWXMAUtils").buildUnstoredTombstonedXMA(g):g,(l=m.get(i==null?void 0:i.plaintextHash))==null?void 0:l.mediaId,(l=m.get(j==null?void 0:j.plaintextHash))==null?void 0:l.mediaId,n.map(function(a){return a.mediaId}),c,e).then(function(a){return{dbMedias:b.map(function(a){a[0];a=a[1];return a}).filter(Boolean),dbXMA:a,firstPreview:n[0]}})})}function h(a,b,d,e,f,g,h){h=babelHelpers["extends"]({},b,{associatedMessageId:(b=h)!=null?b:void 0,defaultPreviewMediaId:f[0],faviconMediaId:d,headerMediaId:e,msgId:g.msgId,previewMediaIds:f});return a.xma.add(h).then(function(b){return a.xma.get(b)}).then(function(a){if(a==null)throw c("err")("Failed to write XMA to db");return a})}function b(a,b,c,e,f,g,h,i,j,k){var l=d("MAWXMAUtils").isXMAExpired(!1,j.targetExpiringAtSec);h=babelHelpers["extends"]({},j,{associatedMessageId:(j=h)!=null?j:void 0,author:i.author,externalId:i.externalId,isTombstoned:l,msgId:g,offlineAttachmentId:k,targetType:f,threadJid:i.chat});var m=l?h:babelHelpers["extends"]({},h,{defaultPreviewMediaId:(j=b)!=null?j:void 0,faviconMediaId:(g=e)!=null?g:void 0,headerMediaId:(k=c)!=null?k:void 0,previewMediaIds:b!=null?[b]:[]});return a.xma.add(m).then(function(a){return babelHelpers["extends"]({},m,{xmaId:a})})}g.handleUnstoredXMAContent=a;g.saveXMA=b}),98);
__d("MAWWriteXMAMessageTxns",["MAWBridgeMsg","MAWBridgeXMA","MAWDbXMATxns","MAWDexieTable","MAWExpiredXMACleaner","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWMsgType","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","WAJids","WATimeUtils","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";f=6*d("WATimeUtils").HOUR_SECONDS;var h=new Set([d("MAWMsgType").MSG_TYPE.TEXT,d("MAWMsgType").MSG_TYPE.GIF,d("MAWMsgType").MSG_TYPE.STICKER]);function a(a,b,c,e){var f=c.unstoredAssociatedMedia,g=c.unstoredAssociatedMsg,h=c.unstoredDbXMA;return d("MAWDbXMATxns").maybeGetAssociatedXMAMsg(a,g,e.jid).then(function(c){var i=b;if(c!=null&&c.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var j=c.serverTs,k=c.sortOrderMs;c=c.ts;i=babelHelpers["extends"]({},b,{serverTs:j,sortOrderMs:k!=null?k-1:k,ts:c})}j=[h.targetExpiringAtSec,h.targetType];k=j[0];c=j[1];d("MAWXMAUtils").isXMAStoryReaction(c)&&(g==null?void 0:g.msgContent)!=null&&(i=babelHelpers["extends"]({},b,{msgContent:g.msgContent}));j=d("MAWXMAUtils").isXMAExpired(h.isTombstoned,k);i.isExpiredXmaMsg=j;k=!d("MAWXMAUtils").isXMAStoryReaction(c)&&g!=null?d("MAWWriteMsgTxns").prepareMsgWriteData(a,g,e):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([d("MAWWriteMsgTxns").prepareMsgWriteData(a,i,e),k]).then(function(a){var b=a[0];a=a[1];return{associatedData:a,associatedMedia:f,associatedMsg:g,xmaData:b,xmaMsg:i}})})}function b(a,b,e,f){var g=e.unstoredDbXMA,h=[g.targetExpiringAtSec,g.targetType],i=h[0];h=h[1];if(b==null||b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("MAWDexieTable").dexieResolve({dbMedias:null,dbXMA:null});b.isExpiredXmaMsg!==!0&&i!=null&&d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(i);d("MAWXMAUtils").isXMAStoryReaction(h)&&d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b)});return d("MAWXMAManagementTxns").handleUnstoredXMAContent(a,babelHelpers["extends"]({},e,{unstoredDbXMA:g}),b,f,b.isExpiredXmaMsg===!0).then(function(e){var f=e.dbMedias,g=e.dbXMA;e=e.firstPreview;g!=null&&!d("MAWXMAUtils").isXMAStoryReply(g.targetType)&&(b.isExpiredXmaMsg!==!0&&(c("gkx")("821")?c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(e,g,a)):d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(e,g,!1)})));return{dbMedias:f,dbXMA:g}})}function e(a,b,e,f,g,i,j){if(!h.has(g.type))throw c("err")("flow check, this message type is not supported for XMA replies");var k=b.author;if(k==="@system")throw c("err")("wrong author of story reply");var l=d("WAJids").interpretAsUserJid(f);if(l==null)throw c("err")("this is a flow check, participant jid can not be null");k={author:k===d("WAJids").AUTHOR_ME?l:d("WAJids").AUTHOR_ME,externalId:e.externalId,mediaId:i?void 0:e==null?void 0:e.defaultPreviewMediaId,msgId:c("gkx")("458")?e.msgId:void 0,sourceId:(l=(k=e.defaultCTA)==null?void 0:k.nativeUrl)!=null?l:(i=e.defaultCTA)==null?void 0:i.actionUrl,ts:b.ts,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.targetType};var m=babelHelpers["extends"]({},g,{mediaId:(l=j==null?void 0:j.mediaId)!=null?l:g.mediaId,quote:{content:k,remoteJid:f}});return a.messages.put(m).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(m)})})}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=f;g.XMA_REPLY_MSG_SUPPORTED_TYPES=h;g.prepareXMAWriteData=a;g.handleIncomingXMA=b;g.handleXMAReplyMsg=e}),98);
__d("MAWHandleIncomingMsgApi",["MAWDbRavenActionTxns","MAWDexieTable","MAWEBSwitch","MAWEphemeralAdminMsgBuildTxns","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWHIMLogger","MAWJidUtils","MAWMediaManagementTxns","MAWMsgActionType","MAWMsgType","MAWPendingReceiptProcessingTxns","MAWWriteEditTxns","MAWWriteGroupInviteTxns","MAWWriteMsgTxns","MAWWriteRevokeMessageTxns","MAWWriteXMAMessageTxns","MAWXMAUtils","WAJids","WAResultOrError","err","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Could not write dbAssociatedMsg but it exists: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Finished writing the incoming message"]);i=function(){return a};return a}var j=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("MAWHandleIncomingMsgApi"),k=c("requireDeferred")("EncryptedBackupTaskSkippedFalcoEvent").__setRef("MAWHandleIncomingMsgApi"),l=d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult(void 0));function a(a,b){b.receiveFlow.addPoint("him_write_message_start");return m(a,b).then(function(a){var c;b.receiveFlow.addPoint("him_write_message_end",{bool:{outOfSync:(a==null?void 0:(c=a.value)==null?void 0:c.outOfSyncEphemeralSetting)!=null},string:{msgWrittenResultType:(c=a==null?void 0:(c=a.value)==null?void 0:c.msgType)!=null?c:"unknown"}});return a})["catch"](function(a){var c;a.message="[handleIncomingMsg] ["+((c=b.type)!=null?c:"")+"/"+b.action+"] "+a.message;throw a})}function m(a,b){if(b.action===d("MAWMsgActionType").MSG_ACTION.NO_ACTION)return l;var e=function(c,e,f){return d("MAWEphemeralMsgTxns").syncEphemeralSettingOnIncomingMsg(a,c,e,b.thread,b.device,f)};switch(b.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.msg,b.thread).then(function(){return d("WAResultOrError").makeResult(null)});case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return d("MAWDbRavenActionTxns").writeRavenActionMsg(a,b.msg,b.thread).then(function(){return d("WAResultOrError").makeResult(null)});case d("MAWMsgType").MSG_TYPE.REACTION:return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({reactToExternalId:b.msg.reactToExternalId}));case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("WAJids").isAuthorMe(b.id.author)?l:d("MAWWriteGroupInviteTxns").writeIncomingGroupInviteMsg(a,b.msg,b.thread.jid,b.folder);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(b.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME)return d("MAWWriteMsgTxns").handleDeleteForMeMessage(a,b.msg,b.thread,b.pendingDeleteForMeStanza).then(function(a){return o(a)});var f=b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT?d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.msg,b.existingMsg,b.thread,b.existingEditMsgHistory):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?d("MAWWriteMsgTxns").handleOutOfOrderRevokedMessage(a,b.msg,b.thread,b.pendingRevokedStanza):d("MAWWriteEditTxns").writeNewIncomingMsgAndEditHistory(a,b.msg,b.thread,b.editMsgHistories);return f.then(function(c){var f=b.media!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b.media,c):d("MAWDexieTable").dexieResolve();return f.then(function(f){return d("MAWDexieTable").dexieAll([p(a,b.id,c,c.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF),e(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return o(c,a,f==null?null:[f])})})});case d("MAWMsgType").MSG_TYPE.REVOKED:return d("MAWWriteRevokeMessageTxns").writeIncomingRevokeMsg(a,b.msg,b.thread,b.originalMsg,b.previousRevokeMsg).then(function(c){return d("MAWDexieTable").dexieAll([p(a,b.id,c),e(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return o(c,a)})});case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,d("MAWJidUtils").getAuthorJid(b.id.author),b.device,b.msg.ephemeralExpirationInSec,b.msg.ephemeralLastUpdatedOrSetTimestamp,b.msg.isEphemeralSettingReset,b.thread,b.ts,b.id.externalId,!0).then(function(c){return p(a,b.id,c==null?void 0:c.dbMsg).then(function(){return o(c==null?void 0:c.dbMsg,c==null?void 0:c.outOfSyncEphemeralSetting)})});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({msgType:void 0,outOfSyncEphemeralSetting:void 0,plaintextHashs:void 0}));case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralScreenshotActionMsg(a,d("MAWJidUtils").getAuthorJid(b.id.author),b.thread,b.ts,b.screenshotActionType,b.id.externalId,b.existingMsg).then(function(c){return d("MAWDexieTable").dexieAll([p(a,b.id,c),e(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return o(c,a)})});case d("MAWMsgType").MSG_TYPE.XMA:if(b.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME)return d("MAWWriteMsgTxns").handleDeleteForMeMessage(a,b.msg,b.thread,b.pendingDeleteForMeStanza).then(function(a){return o(a)});f=b.action===d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED?n(a,b).then(function(c){return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.associatedMsg,b.thread).then(function(e){if(b.associatedMedia!=null)return d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b.associatedMedia,e).then(function(d){return q(a,c,e,b.xma,b.msg,b.associatedMsg,b.thread.jid,d)});else return q(a,c,e,b.xma,b.msg,b.associatedMsg,b.thread.jid)})}):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?n(a,b):n(a,b).then(function(c){return d("MAWWriteXMAMessageTxns").handleIncomingXMA(a,c,b.xma,null).then(function(a){return babelHelpers["extends"]({},a,{dbMsg:c})})});return f.then(function(c){var f=c.dbAssociatedMsg,g=c.dbMedias,h=c.dbMsg;return d("MAWDexieTable").dexieAll([p(a,b.id,h,!0,f),e(h,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return o(h,a,g)})});default:throw c("err")("We do not support handleIncomingMsgInternal with type: "+((f=b.type)!=null?f:""))}}function n(a,b){return b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED?d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.msg,b.existingMsg,b.thread,null):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?d("MAWWriteMsgTxns").handleOutOfOrderRevokedMessage(a,b.msg,b.thread,b.pendingRevokedStanza):d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.msg,b.thread)}function o(a,b,c){return d("WAResultOrError").makeResult({msgType:a==null?void 0:a.type,outOfSyncEphemeralSetting:(a=b)!=null?a:void 0,plaintextHashs:c==null?void 0:c.map(function(a){return a.plaintextHash})})}function p(a,b,e,f,g){var h=b.author,l=b.chat,m=b.externalId;f===void 0&&(f=!1);if(e==null)return d("MAWDexieTable").dexieResolve();void j.load().then(function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:m}})});(!f||!c("MAWEBSwitch").isEnabled())&&void k.load().then(function(a){return a.log(function(){return{message_id:m,skipped_reason:"Msg type: "+e.type+", EB enabled: "+c("MAWEBSwitch").isEnabled().toString()}})});if(e==null)return d("MAWDexieTable").dexieResolve();b=d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,l,e);f=h===d("WAJids").AUTHOR_ME&&g!=null&&g.type!==d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,l,g):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b,f]).then(function(){c("MAWHIMLogger").LOG(i())})}function q(a,b,e,f,g,i,j,k){return d("MAWWriteXMAMessageTxns").handleIncomingXMA(a,b,f,e.msgId).then(function(f){var l=f.dbMedias;f=f.dbXMA;e==null&&c("MAWHIMLogger").ERROR(h(),i.externalId);return(e!=null&&f!=null&&d("MAWXMAUtils").isXMAStoryReply(f.targetType)?d("MAWWriteXMAMessageTxns").handleXMAReplyMsg(a,g,f,j,e,g.isExpiredXmaMsg===!0,k):d("MAWDexieTable").dexieResolve()).then(function(){return k!=null?{dbAssociatedMsg:e,dbMedias:l!=null?[].concat(l,[k]):[k],dbMsg:b}:{dbAssociatedMsg:e,dbMedias:l,dbMsg:b}})})}g.handleIncomingMsg=a;g.processReceipts=p}),98);
__d("MAWLinkReactionsToMsgsTxns",["LSQueryBulkUtils","MAWDbMsgTxns","MAWDbReactionUtils","MAWDexieCastToPromise","MAWRestoreDbState","MAWTransactor","WAMsgMap","asyncToGeneratorRuntime","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.reduce(function(a,b){var c,d={author:b.reactToAuthor,chat:b.threadJid,externalId:b.reactToExternalId};c=(c=a.get(d))!=null?c:[];c.push(b);return a.set(d,c)},new(d("WAMsgMap").MsgMap)())}function i(a){a.forEach(function(a){d("MAWDbReactionUtils").dispatchReaction(a)})}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("MAWTransactor").runInLSDB(function(a){return d("LSQueryBulkUtils").bulkGetByIndex(a.e2ee_reactions.index("reactToExternalId"),b)}));return a});return k.apply(this,arguments)}function l(a,b){return a.reactions.where("reactToExternalId").anyOf(b).toArray()}function m(a,b){var e=d("MAWRestoreDbState").isUsingShim_UNSAFE()&&c("qex")._("1016")?function(){return d("MAWDexieCastToPromise").promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING(j(a,b))}:function(){return l(a,b)};return e().then(function(a){return h(a.filter(function(a){return a.reactToMsgId==null}))})}function a(a,b){return m(a,b).then(function(b){return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b.keys()).then(function(a){return a.flatMap(function(a){var c={author:a.author,chat:a.threadJid,externalId:a.externalId};c=(c=b.get(c))!=null?c:[];return c.map(function(b){b.reactToMsgId=a.msgId;return b})})})})}function n(a,b){return a.reactions.bulkPut(b).then(function(){i(b)})}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){yield d("MAWTransactor").runInLSDB(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.e2ee_reactions;yield d("LSQueryBulkUtils").bulkPut(a,c)});return function(b){return a.apply(this,arguments)}}())});return p.apply(this,arguments)}function e(a,b){return d("MAWRestoreDbState").isUsingShim_UNSAFE()&&c("qex")._("1016")?d("MAWDexieCastToPromise").promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING(o(a,b)):n(a,b)}g.getReactionLinkUpdatesForExternalIds=a;g.updateReactionLinks=e}),98);
__d("MAWLinkReactionsToMsgsApi",["MAWIndexedDb","MAWLinkReactionsToMsgsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"linkReactionsToMsgs",function(a){return function(b){return d("MAWLinkReactionsToMsgsTxns").getReactionLinkUpdatesForExternalIds(a,b).then(function(b){return d("MAWLinkReactionsToMsgsTxns").updateReactionLinks(a,b)})}});function a(a){return h(a)}g.linkReactionsToMsgs=a}),98);
__d("MAWOfflineThreadTxns",["MAWBridgeThread","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThread","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLoadMessageRequestCapabilitiesTxns","MAWWriteBulkWriteIncomingAdminMsgTxns","WAArrayZip","WAGlobals","WAJids","WATagsLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Duplicated thread creation for ",""]);h=function(){return a};return a}var i=new Set();function a(a,b,c){var e=new Set(b),f=new Map(),g=new Map();c.forEach(function(a){g.set(a.jid,"exists"),f.set(a.jid,a),e["delete"](a.jid)});if(e.size===0)return d("MAWDexieTable").dexieResolve({threadCreationResult:g,threads:f});e.forEach(function(a){i.has(a)&&d("WATagsLogger").TAGS(["occamadillo","incoming_processing"]).LOG(h(),a)});return n(a,e).then(function(b){b.oneToOneThreadsCreationData.forEach(function(a){i.add(a.thread.jid)});b.groupThreadsCreationData.forEach(function(a,b){i.add(b),a.groupInfo==null&&g.set(b,"missing")});return a.threads.bulkAdd(o(b),{allKeys:!0}).then(function(b){return d("MAWDbThreadTxns").getThreads(a,Array.from(e.values())).then(function(b){l(b);var c=p(b);return d("MAWDexieTable").dexieAll([j(a,c),d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,b)]).then(function(){b.forEach(function(a){return f.set(a.jid,a)});return{threadCreationResult:g,threads:f}})})})})}function j(a,b){return d("MAWDexieTable").dexieAll([k(a,b),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(Array.from(b.values()))])}function k(a,b){var c=[],e=d("WAGlobals").getMyUserJid();b.forEach(function(a,b){c.push({threadJid:b,type:"participant",userJid:b}),e!==b&&c.push({threadJid:b,type:"participant",userJid:e})});return d("MAWDbParticipantTxns").bulkAddParticipantsInThreads(a,c).then(function(){})}function l(a){a.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,a.optimisticThreadKey,void 0,"createAllThreadsForOfflineMsgs")})})}function m(a,b){return{folder:null,jid:a,lastReadMsg:null,lastReadMsgReceiptSent:null,lastReadMsgTs:null,newestMsg:null,newestMsgTs:b!=null?d("WATimeUtils").castUnixTimeToMillisTime(b):null,oldestMsg:null,optimisticThreadKey:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(d("WATimeUtils").millisTime(),a)}}function n(a,b){var c=[],e=[];b.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return c.push(a)},user:function(a){return e.push(a)}})});return d("MAWDbGroupInfoTxns").getGroupInfos(a,c).then(function(a){var b=new Map(d("WAArrayZip").zip(c,a));a=new Map(c.map(function(a){var c=b.get(a);return[a,{groupInfo:c,thread:m(a,c==null?void 0:c.creationTs)}]}));var f=new Map(e.map(function(a){return[a,{thread:m(a,null)}]}));return{groupThreadsCreationData:a,oneToOneThreadsCreationData:f}})}function o(a){var b=a.groupThreadsCreationData;a=a.oneToOneThreadsCreationData;return Array.from(b.values()).map(function(a){a=a.thread;return a}).concat(Array.from(a.values()).map(function(a){a=a.thread;return a}))}function p(a){var b=new Map();a.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){},user:function(c){return b.set(c,a)}})});return b}g.createAllThreadsForOfflineMsgs=a}),98);
__d("MAWPreprocessMsgs",["MAWBuildIncomingMsgs","MAWDbMsgTxns","MAWDexieTable","MAWHIMLogger","MAWMediaManagementTxns","MAWMsgActionType","MAWMsgType","MAWWriteMsgTxns","MAWWriteXMAMessageTxns","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported message type on preprocessing ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media is null for StanzaID ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Preparing media for msg with StanzaID ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected msg type when writing ephemeral setting message. Should not happen"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["No unstored content for incoming message: SHOULD NEVER HAPPEN"]);l=function(){return a};return a}var m=c("MAWHIMLogger").TAGS(["MAWPreprocessMsgs"]);function a(a){var b=[],c=[];a.forEach(function(a){var d=a.msgData;a=a.unstoredContent;switch(d.type){case"IncomingMsg":if(a==null){m.ERROR(l());return}var e=a.unstoredDbEditActionMsg;a=a.unstoredDbReaction;if(a!=null){a={chatJid:d.id.chat,unstoredReaction:a};b.push(a)}e!=null&&c.push({chatJid:d.id.chat,msg:e});break;case"IncomingCiphertextMsg":default:break}});return{editActionMsgs:c,reactionMsgs:b}}function b(a,b,c){b.receiveFlow.addPoint("him_get_preprocessing_data_start");return n(a,b,c).then(function(a){var c;b.receiveFlow.addPoint("him_get_preprocessing_data_end",{string:{action:a.action,type:(c=a.type)!=null?c:""}});return a})}function n(a,b,c){var e=b.msgData,f=b.receiveFlow,g=b.unstoredContent;b=e.folder;var l=e.id,n=e.ts,p={id:l,receiveFlow:f,thread:c,ts:n},q=d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.NO_ACTION,msg:null,type:null}));switch(e.type){case"IncomingMsg":if(g==null)return q;var r=e.device,s=g.unstoredDbMsg;f=g.unstoredDbRavenActionMsg;var t=g.unstoredDbReaction,u=g.unstoredIncomingDbGroupInvite;if(f!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:f,type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION}));else if(t!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:t,type:d("MAWMsgType").MSG_TYPE.REACTION}));else if(u!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,folder:b,msg:u,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE}));else if(s==null)return q;else if(s.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN){f=e.msg;if(f.version==="v3"&&f.type==="ephemeral")return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,msg:f,type:s.type}));else{m.ERROR(k());return q}}else if(s.type===d("MAWMsgType").MSG_TYPE.ICDC_ALERT)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,data:null,device:r,folder:b,type:s.type}));else if(s.type===d("MAWMsgType").MSG_TYPE.TEXT||s.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF)return d("MAWWriteMsgTxns").prepareTextMsgWriteData(a,s,c).then(function(a){var b=a.editMsgHistories,c=a.existingEditMsgHistory,e=a.existingMsg,f=a.isDeletedWithThread,g=a.isDeleteForMeOrRevoked,h=a.pendingDeleteForMeStanza;a=a.pendingRevokedStanza;var i=o(e,s,c);if(g||f||e!=null&&i!==!0)return q;if(i&&e!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:r,existingEditMsgHistory:c,existingMsg:e,msg:s,type:s.type});if(h!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:s,pendingDeleteForMeStanza:h,type:s.type});return a!=null?babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,device:r,msg:s,pendingRevokedStanza:a,type:s.type}):babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,editMsgHistories:b,msg:s,type:s.type})});else if(s.type===d("MAWMsgType").MSG_TYPE.IMAGE||s.type===d("MAWMsgType").MSG_TYPE.VIDEO||s.type===d("MAWMsgType").MSG_TYPE.PTT||s.type===d("MAWMsgType").MSG_TYPE.GIF||s.type===d("MAWMsgType").MSG_TYPE.STICKER||s.type===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE||s.type===d("MAWMsgType").MSG_TYPE.RAVEN){s.type===d("MAWMsgType").MSG_TYPE.IMAGE&&((t=e.msg.metadata)==null?void 0:t.groupId)!=null&&(s.groupId=e.msg.metadata.groupId,s.groupIndex=e.msg.metadata.groupIndex,s.groupSize=e.msg.metadata.groupSize);m.LOG(j(),s.externalId);return d("MAWMediaManagementTxns").prepareMediaWriteData(a,s,g==null?void 0:g.unstoredDbMedia,c).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread,e=a.isDeleteForMeOrRevoked,f=a.pendingDeleteForMeStanza,h=a.pendingRevokedStanza;a=a.shouldDropDocument;var j=[g==null?void 0:g.unstoredDbMedia,o(b,s)],k=j[0];j=j[1];k==null&&m.LOG(i(),s.externalId);if(a===!0||e||c||k==null||b!=null&&!j)return q;if(j&&b!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:r,existingMsg:b,media:k,msg:s,type:s.type});if(f!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:s,pendingDeleteForMeStanza:f,type:s.type});return h!=null?babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,device:r,msg:s,pendingRevokedStanza:h,type:s.type}):babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,media:k,msg:s,type:s.type})})}else if(s.type===d("MAWMsgType").MSG_TYPE.XMA){var v=g==null?void 0:g.unstoredXMA;return v==null?q:d("MAWWriteXMAMessageTxns").prepareXMAWriteData(a,s,v,c).then(function(a){var b=a.xmaData.existingMsg,c=o(b,s);if(a.associatedMsg!=null&&a.associatedData!=null&&!a.associatedData.isDeletedWithThread&&!a.associatedData.isDeleteForMeOrRevoked)if(c&&b!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED,associatedMsg:a.associatedMsg,device:r,existingMsg:b,msg:a.xmaMsg,type:s.type,xma:v});else return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED,associatedMedia:a.associatedMedia,associatedMsg:a.associatedMsg,device:r,msg:a.xmaMsg,type:s.type,xma:v});if(c&&b!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:r,existingMsg:b,msg:a.xmaMsg,type:s.type,xma:v});c=a.xmaData;var e=c.isDeletedWithThread,f=c.isDeleteForMeOrRevoked,g=c.pendingDeleteForMeStanza;c=c.pendingRevokedStanza;if(e||f||b!=null)return q;if(g!=null)return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:a.xmaMsg,pendingDeleteForMeStanza:g,type:s.type});return c!=null?babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,device:r,msg:a.xmaMsg,pendingRevokedStanza:c,type:s.type}):babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,msg:a.xmaMsg,type:s.type,xma:v})})}else if(s.type===d("MAWMsgType").MSG_TYPE.REVOKED)return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,s.revokedExternalId,c.jid,l.author),d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,s.externalId,c.jid,l.author)]).then(function(a){var b=a[0];a=a[1];return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,msg:s,originalMsg:b,previousRevokeMsg:a,type:s.type})});else if(s.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION){u=d("WAJids").isAuthorMe(l.author)?d("WAGlobals").getMyUserJid():l.author;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,l.externalId,c.jid,u)]).then(function(a){a=a[0];return babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,existingMsg:a,screenshotActionType:s.msgContent.screenshotActionType,type:s.type})})}else if(s.type===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:r,msg:s,type:s.type}));else{m.ERROR(h(),s.type);return q}case"IncomingCiphertextMsg":if(!((f=e==null?void 0:e.createPlaceholder)!=null?f:!1))return q;var w=d("MAWBuildIncomingMsgs").buildUnstoredCiphertextMsg(l,n);return d("MAWWriteMsgTxns").prepareMsgWriteData(a,w,c).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread;a=a.isDeleteForMeOrRevoked;return a||c||b!=null?q:babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:w,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT})});case"UnavailableMsg":case"FrankingInvalidMsg":var x=d("MAWBuildIncomingMsgs").buildUnstoredUnavailableMsg(l,n);return d("MAWWriteMsgTxns").prepareMsgWriteData(a,x,c).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread;a=a.isDeleteForMeOrRevoked;return a||c||b!=null?q:babelHelpers["extends"]({},p,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:x,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE})})}}function o(a,b,c){if(a==null&&c==null)return!1;return b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?!1:(a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.CIPHERTEXT||(c==null?void 0:c.msgContent.content)===""}g.classifyIncomingMsgs=a;g.getMessageDataByType=b;g.isCiphertextUpdate=o}),98);
__d("MAWSharedOfflineQueueMetric",["$InternalEnum","FBLogger","WAGlobals","WAPREList","WATagsLogger","WATimeUtils","WAWaterFlow"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["New mailbox age is ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New mailbox age is ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Waterflow should start before the start of the processing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Possible stuck reason: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["offline-resume"]);f=b("$InternalEnum").Mirrored(["OFFLINE","ONLINE"]);var m=b("$InternalEnum").Mirrored(["WA_CLIENT_INFRA","WA_CLIENT_INFRA_DUPLICATED_START","WA_PASSIVE_MODE","WA_PASSIVE_MODE_FAIL","MAW_INFRA","MAW_NOT_IDLE_OQ"]),n=function(){function a(a,b,c,e){this.$1=0,this.$3=c,this.$2=d("WAWaterFlow").makeWaterflow("offline-resume",d("WAPREList").PRE_METRIC.OFFLINE_QUEUE),this.$6(a),this.$7(),this.$8(b),this.$9(e),this.$4=Math.round(d("WATimeUtils").performanceAbsoluteNow()/1e3)}var b=a.prototype;b.$8=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"passive-mode-start":b.$2.isOnGoing()||b.$2.startMetric();b.$2.startPoint(m.WA_PASSIVE_MODE,{passiveModeAcks:a.count});b.$10("passive");break;case"passive-mode-end":b.$2.endPoint(m.WA_PASSIVE_MODE);b.$10("passive-end");break;default:a.type,b.$2.addPoint(m.WA_PASSIVE_MODE_FAIL),b.$10("passive-end")}})};b.$9=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"new-message":if(a.commonMessageBase.offline==null)return;b.addWAMessage();b.$10("wa");break}})};b.$6=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":b.$11(a.offlineStats);b.$10("wa-start");break;case"offline-end":b.$2.isOnGoing()&&(b.$2.endPoint(m.WA_CLIENT_INFRA),b.$10("maw"));break;case"offline-entity":b.$12(a.serverTs,a.offline);b.$10("wa");break;case"offline-processed":b.$13(a.count);b.$10("wa");break;case"connection-lost":b.$2.isOnGoing()&&b.$2.endFail("connection-lost");b.$14();break;default:a}})};b.$10=function(a,b){var c=this;b===void 0&&(b=15e3);clearTimeout(this.$5);this.$2.isOnGoing()&&(this.$5=setTimeout(function(){c.$2.isOnGoing()&&(c.$2.endFail(a+"-stuck"),l.WARN(k(),a))},b))};b.$14=function(){clearTimeout(this.$5)};b.$7=function(){var a=this;this.$3.subscribe(function(b){switch(b.type){case"idle-oq-safe-guard":if(!a.$2.isOnGoing())break;a.$2.addPoint(m.MAW_NOT_IDLE_OQ);break;case"maw-infra-start":if(!a.$2.isOnGoing())break;a.$10("maw");a.$2.startPoint(m.MAW_INFRA);break;case"maw-infra-batch":a.$2.isOnGoing()||(a.$2.startMetric(),a.$2.startPoint(m.MAW_INFRA));a.$10("maw");break;case"maw-infra-end":if(!a.$2.isOnGoing())break;a.$2.endPoint(m.MAW_INFRA);a.$14();b.success?a.$2.endSuccess():a.$2.endFail("fail");break;default:b}})};b.addWAMessage=function(){this.$2.isOnGoing()&&(this.$2.reAnnotate(function(a){a=a.waMessage;return{waMessage:((a=a)!=null?a:0)+1}}),this.$10("wa"))};b.addMAWEntity=function(a){this.$2.isOnGoing()&&(this.$2.reAnnotate(function(b){b=b.mawProcessedCount;return{mawProcessedCount:((b=b)!=null?b:0)+a}}),this.$10("maw"))};b.$11=function(a){this.$2.isOnGoing()?this.$2.addPoint(m.WA_CLIENT_INFRA_DUPLICATED_START):(this.$1++,this.$2.startMetric(),this.$4=Math.round(d("WATimeUtils").performanceAbsoluteNow()/1e3)),this.$2.startPoint(m.WA_CLIENT_INFRA,{batchSize:d("WAGlobals").getConfig().batchSize(),expectedAppdata:a.appdata,expectedCount:a.count,expectedMessage:a.message,expectedNotification:a.notification,expectedReceipt:a.receipt,offlineResumeCount:this.$1,useIncreasedSignalFutureMessagesMax:d("WAGlobals").getConfig().getSignalFutureMessagesMax()>2e3,waDanglingQueue:d("WAGlobals").getConfig().waDanglingQueue()})};b.getDetails=function(){var a;return((a=this.$2)==null?void 0:a.getAnnotations())||{}};b.$13=function(a){var b;(b=this.$2)==null?void 0:b.reAnnotate(function(b){return{waProcessed:((b=b.waProcessed)!=null?b:0)+a}})};b.addRuntimeErrorDuringOffflineQueue=function(){if(this.$2.isOnGoing()){var a;(a=this.$2)==null?void 0:a.reAnnotate(function(a){return{runtimeErrors:((a=a.runtimeErrors)!=null?a:0)+1}})}};b.addDecryptionError=function(){if(this.$2.isOnGoing()){var a;(a=this.$2)==null?void 0:a.reAnnotate(function(a){return{decryptErrors:((a=a.decryptErrors)!=null?a:0)+1}})}};b.addRetriesTrack=function(a){if(this.$2.isOnGoing()){var b;(b=this.$2)==null?void 0:b.reAnnotate(function(b){return{retries:((b=b.retries)!=null?b:0)+a}})}};b.$12=function(a,b){var c=this;if(!this.$2.isOnGoing()){l.WARN(j());return}this.$2.reAnnotate(function(d){var e=d.mailboxAgeSec,f=d.maxOffline;d=d.waDownloaded;e=e;e==null&&a!=null&&(e=c.$4-a,l.LOG(i(),e));e!=null&&a!=null&&(c.$4-a>e&&(e=c.$4-a,l.LOG(h(),e)));return{mailboxAgeSec:e,maxOffline:Math.max((e=f)!=null?e:0,b),waDownloaded:((f=d)!=null?f:0)+1}})};return a}(),o;function a(a,b,d,e){if(o!=null){var f=o;c("FBLogger")("messenger_e2ee_web").mustfix("Offline sync reported is inited twice");return f}o=new n(a,b,d,e);return o}function e(){if(o==null){c("FBLogger")("messenger_e2ee_web").mustfix("Offline sync reported is not inited");return null}return o}g.OfflineMode=f;g.OfflineStages=m;g.makeOfflineQueueMetric=a;g.getOfflineQueueMetric=e}),98);
__d("WAThrottle",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=0,d=null,e;function f(){var f=Date.now(),g=f-c;for(var h=arguments.length,i=new Array(h),j=0;j<h;j++)i[j]=arguments[j];e=i;g>=b?(clearTimeout(d),d=null,a.apply(void 0,i),c=Date.now()):d==null&&(d=setTimeout(function(){return a.apply(void 0,e)},b-g))}return f}f.throttle=a}),66);
__d("MAWSharedOfflineResumeUINotifier",["MAWBridge","MAWQplProxy","MAWSharedProtocolQueueConst","WAOfflineUtils","WATagsLogger","WAThrottle","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose([' -> Unable to send "Offline Complete" event ',""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([' -> "Offline Complete" bridge event sent']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAW UI: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Set thread metadata: ",", ",""]);k=function(){return a};return a}var l=1e3/3,m=d("WATagsLogger").TAGS(["ProtocolQueue","MAWConsumer"]);a=function(){function a(){var a=this;this.$1={};this.$2={};this.$3=0;this.$4="wa";this.$5=!1;this.$6=0;this.$7=0;this.$8=0;this.$9=0;this.$10=null;this.$16=d("WAThrottle").throttle(function(){if(a.$5)return;a.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing)},l);this.$12=d("WAThrottle").throttle(function(){a.$4==="wa"&&a.$5===!1&&a.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing)},l)}var b=a.prototype;b.subscribeToWAEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":b.$10=d("MAWQplProxy").performanceAbsoluteNow();b.$6=a.offlineStats.count;b.$8=a.offlineStats.message;b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing,b.$10);b.$5=!1;b.$4="wa";break;case"offline-processed":break;case"offline-entity":b.$7++;b.$12();break;case"offline-end":b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete);b.$4="maw";break;case"connection-lost":b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed);break;default:a}})};b.subscribeToMawEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"maw-infra-start":b.$10==null&&(b.$10=d("MAWQplProxy").performanceAbsoluteNow());b.$13();break;case"maw-infra-end":a.success?b.notifyUICurrentProcessingSucceeded():b.$14();b.$10=null;break}})};b.subscribeToMessageEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"new-message":if(a.commonMessageBase.offline==null)return;b.addWAMessage();break}})};b.addWAMessage=function(){this.$9++,this.$12()};b.$13=function(){this.$3=0,this.$5=!1,this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing)};b.setThreadMetadata=function(a){var b=a.reduce(function(a,b){a[b.from]=b.t;return a},{});a=a.reduce(function(a,b){b=b.from;a[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing};return a},{});m.DEV(k(),JSON.stringify(b),JSON.stringify(a));this.$1=b;this.$2=a};b.notifyUIChatReady=function(a){this.$2[a]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete},this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing)};b.updateChatState=function(a){var b=this;Object.entries(a).forEach(function(a){var c=a[0];a=a[1];if(b.$1[c]!=null){var e=b.$1[c];a>=e&&(b.$2[c]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete})}});this.$16()};b.addMAWEntity=function(a){this.$3+=a,this.$16()};b.notifyUICurrentProcessingSucceeded=function(){var a=this;Object.keys(this.$2).forEach(function(b){a.$2[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}});this.$5=!0;this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete);this.$1={};this.$2={}};b.$14=function(){var a=this;Object.keys(this.$2).forEach(function(b){a.$2[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}});this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed);this.$1={};this.$2={}};b.maybeNotifyUI=function(){this.$16()};b.$11=function(a,b){d("MAWBridge").getBridge().fireAndForget("event","offlineSnapshot",{downloaded:{count:this.$7,message:this.$9},expected:{count:this.$6,message:this.$8},status:a,timestamp:b!=null?b:d("MAWQplProxy").performanceAbsoluteNow()})};b.$15=function(a){var b=d("MAWQplProxy").performanceAbsoluteNow();b={chatJidStatus:this.$2,startTime:this.$10!=null?this.$10:null,status:a,timestamp:b,totalExpectedCount:this.$6,totalProcessedCount:this.$3};m.LOG(j(),JSON.stringify(b));a===d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete?c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","offlineConsumerProgress",b),function(){m.LOG(i())},function(a){m.ERROR(h(),a)}):d("MAWBridge").getBridge().fireAndForget("event","offlineConsumerProgress",b)};return a}();b=new a();g.ConsumerUINotifier=a;g.offlineResumeUINotifier=b}),98);
__d("MAWLoadGroupInvitesTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDexieTable","MAWIndexedDb","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=[],e=d("WAGlobals").getMyUserJid();b.forEach(function(b){return d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(){c.push(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant(a,b.jid,e))},user:function(){}})});return d("MAWDexieTable").dexieAll(c).then(function(a){a.forEach(function(a,b){a.forEach(function(b,a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(b)})})})})}g.loadGroupInvites=a}),98);
__d("MAWLoadMsgsTxns",["MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeTypesCreators","MAWBridgeXMA","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaAfterTxns","MAWXMAUtils","WATagsLogger","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);h=function(){return a};return a}function i(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){d("MAWMediaAfterTxns").handleNewMediaAfterTxn(c,e,b,a)})}))})}function j(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(e){c("gkx")("821")?c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(e,b,a)):d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(e,b,!1)})})}))})}function k(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){a.forEach(function(a){return d("MAWDbReactionUtils").dispatchReaction(a)});return a})}function a(a,b,c,e,f,g){f===void 0&&(f=!1);return d("MAWDbMsgTxns").getMsgsFromOffset(a,b,c,e,f,!1,g).then(function(b){var c=b.msgs,e=babelHelpers.objectWithoutPropertiesLoose(b,["msgs"]);return d("MAWDexieTable").dexieAll(c.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return babelHelpers["extends"]({msgs:c,replyMediaInfo:a},e)})}).then(function(e){var l=e.hasMoreAfter,m=e.hasMoreBefore,n=e.msgs,o=e.replyMediaInfo;e=n.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(o||[])[b])}).filter(Boolean);e.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:e}});e=n.filter(function(a){return a.ephemeralCounterStarted});e.length>0&&(d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).LOG(h(),e.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(e)}));(n.length>0||c==null)&&d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(b,n,f,m,l,g)});return d("MAWDexieTable").dexieAll([k(a,n),d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,n),i(a,n),j(a,n)]).then(function(a){a=a[0];return{hasMoreAfter:l,hasMoreBefore:m,msgs:n,reactions:a}})})}g.loadMsgsAndMediaFromOffset=a}),98);
__d("MAWLoadThreadsTxns",["FBLogger","MAWBridgeParticipants","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbMsg","MAWDbParticipantTxns","MAWDbReaction","MAWDbReactionUtils","MAWDexieTable","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMessageRequestCapabilitiesTxns","MAWLoadMsgsTxns","MAWThreadSnippetBuildTxns","MAWTransactionMode","WAGlobals","WAJids","WALogger","err","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f="loadContentsForThreads");b.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,e==null?void 0:e.get(a.jid),void 0,f)})});return d("MAWDexieTable").dexieAll([].concat(b.map(function(b){return j(a,b,c)}),[h(a,b),l(a,b),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(b),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])).then(function(){return b})}function b(a,b,c,e){return d("MAWDexieTable").dexieAll([h(a,[c]),j(a,c,e),i(a,c)]).then(function(e){e=e[0];b||n(a,c.jid,d("WAJids").interpretAsGroupJid(c.jid)!=null,!1,c.cannotReplyReason,c.archived);return e})}function h(a,b){return b.length===0?d("MAWDexieTable").dexieResolve([]):d("MAWDbParticipantTxns").getParticipantsInThreads(a,b.map(function(a){return a.jid})).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)});return a})}function i(a,b){var e=b.newestMsg,f=b.snippetMsg;f=(f=f)!=null?f:e;return f==null?d("MAWDexieTable").dexieResolve():d("MAWDexieTable").dexieAll([a.messages.get({msgId:f}),a.reactions.get({reactionId:f})]).then(function(e){var f=e[0];e=e[1];f!=null&&e!=null&&c("FBLogger")("maw_db").warn("[MAWLoadThreadsTxns] msgId collision detected between Reaction and Message");e!=null&&c("qex")._("1016")!==!0&&d("MAWDbReactionUtils").dispatchReaction(e);return k(a,f,b,e).then(function(a){if(a!=null){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:c,snippetSenderContactId:e,snippetType:a,threadJid:b.jid})})}})})}function j(a,b,c){return d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,b.jid,null,c,!0)}function k(a,b,c,e){e=e!=null?d("MAWDbReaction").castToIncomingDbReaction(e):e;return e!=null&&e.ts>(b!=null?d("MAWDbMsg").getCanonicalTsFromMsg(b):0)?d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(a,e.author,e.reaction,c.jid):b==null?d("MAWDexieTable").dexieResolve(null):d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b)}function l(a,b){var c=[];b.forEach(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return c.push(a)},user:function(){}})});return a.groupInfo.bulkGet(c).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}e=function(a){a=a.threadJid;return m(a)};var m=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"checkIfGroupParticipant",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return n.apply(void 0,[a].concat(c))}});function n(a,b,e,f,g,h){e===void 0&&(e=!0);f===void 0&&(f=!0);var i=d("WAGlobals").getMyUserJid();return d("MAWDbParticipantTxns").getParticipant(a,b,i).then(function(a){if(!a.success){var j=e?"group":"one_to_one";d("WALogger").LOG(["[Occamadillo] User is not a participant of "+j+" thread\n        "+b.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);if(g==null){var k;c("FBLogger")("maw_db","checkIfParticipant").catching((k=a.payload)!=null?k:c("err")(a.error)).warn("[Occamdillo] User %s is not a participant of %s thread %s, occam: %s, archived: %s, cannotReplyReason null.",i,j,b.toString(),f,h)}c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamdillo] User not a participant from checkIfParticipant");k={cannotReplyReason:"viewer_not_subscribed",threadJid:b};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(k)})}})}g.loadContentsForThreads=a;g.loadParticipantsAndMsgs=b;g.loadParticipants=h;g.loadGroups=l;g.checkIfGroupParticipant=e}),98);
__d("MAWThreadFetchAndEmitTxns",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMessageRequestCapabilitiesTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","WAJids","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f="fetchAndEmitThread");return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThread(a,b,c).then(function(a){return a==null?null:{created:a.created,thread:a.thread}})},user:function(b){var f;return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),folder:(f=c)!=null?f:void 0,userJid:b})}}).then(function(b){return b==null||b.thread==null?null:d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b.thread],1,null,f).then(function(){return b})})}function h(a,b){if(!c("gkx")("23922"))return d("MAWDexieTable").dexieResolve();b=b.map(function(b){return d("MAWDbMsgTxns").getThreadOldestMessageId(a,b.jid).then(function(a){return{oldestMsgId:a,thread:b}})});return d("MAWDexieTable").dexieAll(b).then(function(a){a.forEach(function(a){var b=a.oldestMsgId;a=a.thread;return d("MAWIndexedDb").afterTransaction({tag:"UpdateMessageRange",value:d("MAWBridgeTypesCreators").createBridgeUpdateMessageRange({newestMsgId:null,newestMsgTs:null,oldestMsgId:b,thread:a})})})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();b=Array.from(b);return a.threads.where("jid").anyOf(b).toArray().then(function(b){return h(a,b).then(function(){var c=b.filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadParticipants(a,c),d("MAWLoadThreadsTxns").loadGroups(a,c),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(c),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,c)])})}).then(function(){})}g.fetchAndEmitThread=a;g.emitThreadContents=b}),98);
__d("MAWBulkHandleIncomingMsgApi",["MAWBulkEditMsgsTxns","MAWBulkWriteReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWHIMLogger","MAWHandleIncomingMsgApi","MAWIndexedDb","MAWLinkReactionsToMsgsApi","MAWMsgActionType","MAWMsgType","MAWODSProxy","MAWOfflineThreadTxns","MAWPreprocessMsgs","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWThreadFetchAndEmitTxns","MAWTransactionMode","WAMsgMap","WAOdsEnums","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Should never have 'write' and 'delete' in same OQ batch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Should never have 'update ciphertext' and 'delete' in same OQ batch"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling message with StanzaID ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling "," messages"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create thread for message. Reason: ",". StanzaID ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create thread for message. Reason: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Previous message processing action failed so subsequent one can't succeed"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["ERROR!!! At this point we must have fields in the map, ",""]);o=function(){return a};return a}var p=c("gkx")("2014");function a(a){var b;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READWRITE,deletedMessages:b.READWRITE,deviceChangeAlerts:b.READWRITE,editMsgHistory:b.READWRITE,ephemeralSettings:b.READWRITE,existingUsers:b.READWRITE,ftsBackloggedMessages:b.READWRITE,ftsPurgeBacklog:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READWRITE,media:b.READWRITE,mediaBackup:b.READWRITE,messages:b.READWRITE,participants:b.READWRITE,pendingReceipts:b.READWRITE,pendingStanzas:b.READWRITE,reactions:b.READWRITE,threads:b.READWRITE,unrenderedMessages:b.READWRITE,xma:b.READWRITE},"bulkHandleIncomingMsgs",function(b){return function(){var e=d("MAWDexieTable").dexieResolve(),f=new(d("WAMsgMap").MsgMap)();d("MAWODSProxy").odsBumpEntityKey({amount:a.length,entity:d("WAOdsEnums").Entity.TOTAL_INCOMING_MESSAGE,key:"msgs"});d("MAWDexieTable").setDexiePSDItem("offlineQueueSize",a.length);var g=new Set(a.map(function(a){a=a.msgData;return a.id.chat})),h=d("MAWPreprocessMsgs").classifyIncomingMsgs(a),i=h.editActionMsgs,j=h.reactionMsgs,k=function(a,b){var e=f.get(a);if(!b.success)f.set(a,b);else if(e==null)c("MAWHIMLogger").ERROR(o(),b);else if(!e.success)c("MAWHIMLogger").WARN(n());else if(p)f.set(a,d("WAResultOrError").makeResult(babelHelpers["extends"]({},e.value,b.value)));else{e=e.value;b=b.value;(b==null?void 0:b.outOfSyncEphemeralSetting)!=null&&(e=babelHelpers["extends"]({},e,{outOfSyncEphemeralSetting:b.outOfSyncEphemeralSetting}));if((b==null?void 0:b.plaintextHashs)!=null){var g;e=babelHelpers["extends"]({},e,{plaintextHashs:(g=e.plaintextHashs)!=null?g:b.plaintextHashs})}(b==null?void 0:b.reactToExternalId)!=null&&(e=babelHelpers["extends"]({},e,{reactToExternalId:b.reactToExternalId}));e=babelHelpers["extends"]({},e,{msgType:(g=(g=e)==null?void 0:g.msgType)!=null?g:b==null?void 0:b.msgType});f.set(a,d("WAResultOrError").makeResult(e))}};return q(b,g).then(function(h){var n=h.threadCreationResult,o=h.threads,q=function(a,b){f.set(a,d("WAResultOrError").makeResult({protocolMsgId:a,unknownGroup:b==="missing"}))};h=d("MAWDexieTable").dexieAll(a.map(function(a){var e;e=[o.get(a.msgData.id.chat),(e=n.get(a.msgData.id.chat))!=null?e:"missing"];var f=e[0];e=e[1];if(f==null){c("MAWHIMLogger").ERROR(m(),e);c("MAWHIMLogger").WARN(l(),e,a.msgData.id.externalId);return}q(a.msgData.id,e);return d("MAWPreprocessMsgs").getMessageDataByType(b,a,f)}).filter(Boolean))["catch"](function(a){a.message="[getAllMessagesProcessingData] "+a.message;throw a});return d("MAWDexieTable").dexieAll([d("MAWBulkWriteReactionsTxns").prepareReactionsData(b,j),h]).then(function(a){var c=a[0],h=a[1];return d("MAWBulkWriteReactionsTxns").bulkWriteReactions(b,c).then(function(){var a=p?t(h):h;a.forEach(function(a){e=e.then(function(){return d("MAWHandleIncomingMsgApi").handleIncomingMsg(b,a)}).then(function(b){k(a.id,b),r(a.id,a.ts)})});e["catch"](function(a){a.message="[writeIncomingMsgs] "+a.message;throw a});return e}).then(function(){var a=i.length===0?d("MAWDexieTable").dexieResolve():d("MAWBulkEditMsgsTxns").prepareDataForMessageEdit(b,i).then(function(a){return d("MAWBulkEditMsgsTxns").bulkEditMsgs(b,i,a)});return a.then(function(){return d("MAWThreadFetchAndEmitTxns").emitThreadContents(b,g).then(function(){return{msgResults:f}})})})})})}})().then(function(a){var b=new Set();a.msgResults.values().forEach(function(a){if(a.success){a=a.value;(a==null?void 0:a.reactToExternalId)!=null?b.add(a.reactToExternalId):(a==null?void 0:a.protocolMsgId)!=null&&b.add(a.protocolMsgId.externalId)}});return d("MAWLinkReactionsToMsgsApi").linkReactionsToMsgs(Array.from(b)).then(function(){return a})})}function q(a,b){var c=Array.from(b);return d("MAWDbThreadTxns").getThreads(a,c).then(function(b){return d("MAWOfflineThreadTxns").createAllThreadsForOfflineMsgs(a,c,b)})}function r(a,b){var c;a=a.chat.toString();d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.updateChatState((c={},c[a]=b,c));d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.addMAWEntity(1);(a=d("MAWSharedOfflineQueueMetric").getOfflineQueueMetric())==null?void 0:a.addMAWEntity(1)}var s=c("MAWHIMLogger").TAGS(["MergeActions"]);function t(a){s.LOG(k(),a.length);var b=new(d("WAMsgMap").MsgMap)();for(var c=0;c<a.length;c++){var e=a[c];s.LOG(j(),e.id.externalId);e.receiveFlow.addPoint("him_merge_actions");var f=b.get(e.id);if(f==null){b.set(e.id,e);continue}if(f.action===e.action&&f.type===e.type){e.receiveFlow.addAnnotations({bool:{merge_actions_duplicate:!0}});continue}switch(e.action){case d("MAWMsgActionType").MSG_ACTION.NO_ACTION:continue;case d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT:case d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED:if(f.action===d("MAWMsgActionType").MSG_ACTION.REVOKE||f.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME){s.ERROR(i());continue}b.set(e.id,e);continue;case d("MAWMsgActionType").MSG_ACTION.WRITE:case d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED:if(f.action===d("MAWMsgActionType").MSG_ACTION.REVOKE||f.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME){s.ERROR(h());continue}switch(e.type){case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:break;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:f.type===d("MAWMsgType").MSG_TYPE.UNAVAILABLE&&b.set(e.id,e);break;default:b.set(e.id,e)}break;case d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME:case d("MAWMsgActionType").MSG_ACTION.REVOKE:f.action!==d("MAWMsgActionType").MSG_ACTION.REVOKE&&b.set(e.id,e);break}}f=[];for(e=0;e<a.length;e++){var g;c=a[e];var l=b.get(c.id);c.receiveFlow.addAnnotations({string:{final_action:(g=l==null?void 0:l.action)!=null?g:"undefined",initial_action:c.action}});if(l==null||l.action===d("MAWMsgActionType").MSG_ACTION.NO_ACTION)continue;f.push(l);b["delete"](c.id)}return f}g.bulkHandleIncomingMsgs=a}),98);
__d("MAWConvertXMATargetTypeToExtendedContentTargetType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaTargetType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_MENTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_IMAGE_POST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_MULTIPOST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_VIDEO_POST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_CLIPS_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_IGTV_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SHOP_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_PROFILE_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_HIGHLIGHT_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_HIGHLIGHT_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REACTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_MENTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_VIDEO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_GAMING_CUSTOM_UPDATE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_PRODUCER_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_EXTERNAL_LINK_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_EVENT:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_RECEIVER_FETCH:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH;default:d("WALogger").ERROR(h(),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE}}g.convertXMATargetTypeToExtendedContentTargetType=a}),98);
__d("MAWHandleEchoMsgsRestoreApiUtils",["$InternalEnum","EchoMessage","EchoMessageMediaFieldUtils","MAWAckLevel","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWJids","MAWMsgType","MAWRepliesRestoreUtils","WAJids","WAStanzaUtils","WATagsLogger","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Message content is empty for the message: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Author info is missing from msg: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread has unsupported message type: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread has unsupported message content type: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread has unsupported message content type: ",", xContentType: ",",\n      subcontent type: "," ,\n      origin: ",""]);l=function(){return a};return a}e=b("$InternalEnum")({INITIAL_RESTORE:"initial_restore",POINT_RESTORE:"point_restore",PAGINATED_RESTORE:"paginated_restore"});function m(a,b){var e,f=a.contentType;switch(f){case d("EchoMessage").EchoMessageContentType.TEXT:return a.xContentType===d("EchoMessage").EchoXMessageContentType.BUMP&&c("gkx")("4323")?d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:d("MAWMsgType").MSG_TYPE.TEXT;case d("EchoMessage").EchoMessageContentType.MEDIA:return n(a);case d("EchoMessage").EchoMessageContentType.PLACEHOLDER:if(a.contentSubtype===d("EchoMessage").EchoMessageContentSubtype.UNSEND)return d("MAWMsgType").MSG_TYPE.REVOKED;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(e=b)!=null?e:""]).ERROR(l(),d("EchoMessage").EchoMessageContentType.getName(f),a.xContentType!=null?d("EchoMessage").EchoXMessageContentType.getName(a.xContentType):"unknown",d("EchoMessage").EchoMessageContentSubtype.getName(a.contentSubtype),a.serializationOrigin!=null?d("EchoMessage").EchoSerializationOriginType.getName(a.serializationOrigin):"unknown");break;case d("EchoMessage").EchoMessageContentType.XMA:return d("MAWMsgType").MSG_TYPE.XMA;case d("EchoMessage").EchoMessageContentType.DECRYPTION_FAILURE:return d("MAWMsgType").MSG_TYPE.CIPHERTEXT;default:d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(e=b)!=null?e:""]).ERROR(k(),d("EchoMessage").EchoMessageContentType.getName(f))}return null}function n(a,b){a=a.mediaData;if(a!=null){switch(a.attachmentType){case d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE:return d("MAWMsgType").MSG_TYPE.IMAGE;case d("EchoMessageMediaFieldUtils").AttachmentType.STICKER:return d("MAWMsgType").MSG_TYPE.STICKER;case d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO:return d("MAWMsgType").MSG_TYPE.VIDEO;case d("EchoMessageMediaFieldUtils").AttachmentType.GIF:return d("MAWMsgType").MSG_TYPE.GIF;case d("EchoMessageMediaFieldUtils").AttachmentType.PTT:return d("MAWMsgType").MSG_TYPE.PTT;case d("EchoMessageMediaFieldUtils").AttachmentType.XMA:return d("MAWMsgType").MSG_TYPE.XMA;case d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT:return d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE}d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(b=b)!=null?b:""]).ERROR(j(),d("EchoMessageMediaFieldUtils").AttachmentType.getName(a.attachmentType))}return null}function a(a,b,c,e,f){var g=a.from;if(g==null){var h;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(h=f)!=null?h:""]).ERROR(i(),e);return null}h=m(a,f);if(h==null||a.isTombstoned!=null&&a.isTombstoned)return null;switch(h){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return s(a,b,c,g,h,e,f);case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return o(a,b,c,g,h,e);case d("MAWMsgType").MSG_TYPE.XMA:return q(a,b,c,g,h,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return v(a,b,c,g,h,e)}return null}function o(a,b,c,d,e,f){a=t(a,b,c,d,e,f);return p(e,a)}function p(a,b){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE})}}function q(a,b,c,e,f,g){b=t(a,b,c,e,f,g);c=a.text;if(a.xmaData!=null&&a.xmaData.xmaTargetType!=null){e=babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(a.xmaData.xmaTargetType)});c!=null&&(e.msgContent={content:c});return e}return null}function r(a){if(a==null)return void 0;else switch(a){case d("EchoMessage").MessageTextSize.SMALL:return 1;case d("EchoMessage").MessageTextSize.MEDIUM:return 2;case d("EchoMessage").MessageTextSize.LARGE:return 3;default:return void 0}}function s(a,b,c,e,f,g,i){var j=a.text;if(j==null){var k;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(k=i)!=null?k:""]).ERROR(h(),g);return null}k=t(a,b,c,e,f,g,i);if(f===d("MAWMsgType").MSG_TYPE.REVOKED){j!=null&&(k.msgContent={content:j});a.revokeSentTimestampMs!=null&&(k.originalTs=d("WATimeUtils").castToUnixTime(a.revokeSentTimestampMs));return babelHelpers["extends"]({},k,{revokedExternalId:d("WAStanzaUtils").toStanzaId("0"),type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:a.revokeUnsentTimestampMS!=null?d("WATimeUtils").castToUnixTime(a.revokeUnsentTimestampMS):k.ts})}else if(f===d("MAWMsgType").MSG_TYPE.CIPHERTEXT)return babelHelpers["extends"]({},k,{msgContent:{content:j},specialTextSize:r(a.textSize),type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT});else{b=babelHelpers["extends"]({},k,{msgContent:{content:j},specialTextSize:r(a.textSize),type:d("MAWMsgType").MSG_TYPE.TEXT});return babelHelpers["extends"]({},b,{editCount:Math.max(a.editHistory.length-1,0),groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize})}}function t(a,b,c,e,f,g,h){h=u(e,c);e={ack:h===d("WAJids").AUTHOR_ME?d("MAWAckLevel").ACK.sent:d("MAWAckLevel").ACK.received,altIndex:void 0,author:h,externalId:g,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isForwarded:a.isForwarded,sortOrderMs:a.sortOrderMs,threadJid:b,ts:d("WATimeUtils").castToUnixTime(a.displayTimestampMs/1e3),type:f};a.authoritativeTimestampMs!=null?e.serverTs=d("WATimeUtils").castToUnixTime(a.authoritativeTimestampMs/1e3):e.serverTs=d("WATimeUtils").castToUnixTime(a.sortOrderMs/1e3);if(a.quoteData!=null){h=d("MAWRepliesRestoreUtils").getQuoteDataFromEchoMessage(a,c);h!=null&&(e.quote=h,e.quoteExternalId=h.content.externalId)}return e}function u(a,b){a=d("MAWJids").toUserJid(a.localKey);return a===b?d("WAJids").AUTHOR_ME:a}function v(a,b,c,e,f,g){a=t(a,b,c,e,f,g);return babelHelpers["extends"]({},a,{type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE})}g.MAWRestoreType=e;g.getDbMsgTypeFromEchoMessage=m;g.getUnstoredDbMessageFromEchoMessage=a;g.resolveAuthorFromEchoAddress=u}),98);
__d("MAWRepliesRestoreUtils",["EchoEncodingUtils","FBLogger","MAWBridgeMsg","MAWDexieTable","MAWGetMsgQuoteTxn","MAWHandleEchoMsgsRestoreApiUtils","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWTransactionMode","MAWUpdateQuotedMsgTxns","WALogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Quote data is missing for message: ",""]);h=function(){return a};return a}function a(a,b){if(b==null||!d("MAWMsgType").isQuotedMsgType(b.type))return a;else{b={author:b.author,externalId:b.externalId,ts:b.ts,type:b.type};b={content:b,remoteJid:null};return babelHelpers["extends"]({},a,{quote:b})}}function b(a,b){if(a.quoteData!=null&&a.quoteData.quoteMessageId!=null&&a.quoteData.quoteMessageSender!=null){b={author:d("MAWHandleEchoMsgsRestoreApiUtils").resolveAuthorFromEchoAddress(a.quoteData.quoteMessageSender,b),externalId:(b=a.quoteData)==null?void 0:b.quoteMessageId,ts:a.displayTimestampMs,type:c("gkx")("458")?(b=d("EchoEncodingUtils").convertXMessageContentTypeToDbMsgType(a.xContentType))!=null?b:d("MAWMsgType").MSG_TYPE.TEXT:d("MAWMsgType").MSG_TYPE.TEXT};return{content:b,remoteJid:null}}else d("WALogger").ERROR(h(),a.messageId);return null}f=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE,xma:e.READONLY},"updateQuoteDataForReplyMessages",function(a){return function(b,c){c==null?void 0:c.addPoint("replies_restore_start");b=b.restoredMsgsData;if(b){var e=b.existingMsgs;b=b.newlyAddedMsgs;b=b.concat(e);return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,b.threadJid,b).then(function(a){var c=[];b.quoteExternalId!=null&&c.push(b);a!=null&&c.push.apply(c,a);return c})})).then(function(b){b=b.reduce(function(a,b){return b.length>0?a.concat(b):a},[]);return i(a,b)}).then(function(a){c==null?void 0:c.addPoint("replies_restore_end",{"int":{replies:a}});return a})}return d("MAWDexieTable").dexieResolve(0)}});function i(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var e=j(b);if(b.threadJid!=null)return d("MAWGetMsgQuoteTxn").enhanceMsgWithQuoteInfo(a,e,b.threadJid).then(function(a){return babelHelpers["extends"]({},a,{msgId:b.msgId,originalTs:b.originalTs,rowId:b.rowId,threadJid:b.threadJid,unsendMsgContentDeleteTs:b.unsendMsgContentDeleteTs})});else c("FBLogger")("labyrinth_web","thread_id_absent").mustfix("Reply restore: threadId cannot be null for a restored msg")})).then(function(a){return a.filter(Boolean).filter(function(a){return a.quote!=null})}).then(function(b){return a.messages.bulkPut(b).then(function(c){return b.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a,void 0,void 0,"EncryptedBackups")})})})}).then(function(a){return(a=b==null?void 0:b.length)!=null?a:0})})}function j(a){a.msgId;a.originalTs;a.rowId;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,["msgId","originalTs","rowId","threadJid","unsendMsgContentDeleteTs"]);return a}g.addQuoteDataToReplyMessage=a;g.getQuoteDataFromEchoMessage=b;g.updateQuoteDataForReplyMessages=f;g.enhanceAndPersistReplyMessagesWithQuoteData=i}),98);
__d("MAWHandleEchoReactionsRestore",["MAWAckLevel","MAWAuthor","MAWBulkWriteReactionsTxns","MAWHandleEchoMsgsRestoreApiUtils","MAWIndexedDb","MAWTransactionMode","Promise","WAJids","WALogger","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction fields in backup data uneven in length"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reactToAuthor field is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction external id missing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction string is not a single character"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot have reactions empty author"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot have reactions for system author"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echo document is absent for a restored msg"]);o=function(){return a};return a}function a(a,c,d){d==null?void 0:d.addPoint("reactions_restore_start");var e=a.echoMsgMap,f=a.restoredMsgsData,g=0;if(f){a=f.existingMsgs;var i=f.newlyAddedMsgs;i=i.concat(a);var j=f.threadJid;a=i.filter(function(a){var b=e.get(a.externalId);return q(e,a)&&b!=null&&r(b)});if(a.length===0)return(h||(h=b("Promise"))).resolve();var k=a.flatMap(function(a){var b=e.get(a.externalId);a=u(f.threadJid,c,a.externalId,a.msgId,a.author,b);return a.map(function(a){return{chatJid:j,unstoredReaction:a}})});return k.length===0?(h||(h=b("Promise"))).resolve():p(k).then(function(a){g+=k.length,d==null?void 0:d.addPoint("reactions_restore_end",{"int":{reactions:g}})})}return(h||(h=b("Promise"))).resolve()}var p=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:(c=d("MAWTransactionMode")).READWRITE,messages:c.READWRITE,reactions:c.READWRITE,threads:c.READWRITE},"restoreWriteReactionsToDb",function(a){return function(b){return d("MAWBulkWriteReactionsTxns").prepareReactionsData(a,b).then(function(b){return d("MAWBulkWriteReactionsTxns").bulkWriteReactions(a,b)})}});function q(a,b){a=a.get(b.externalId);if(a==null){d("WALogger").ERROR(o());return!1}if(d("WAJids").isAuthorSystem(b.author)){d("WALogger").ERROR(n());return!1}if(d("MAWAuthor").getAuthorUserJid(b.author)==null){d("WALogger").ERROR(m());return!1}return!0}function r(a){return a.reactions!=null&&a.reactions.length!==0&&a.reactionXOfflineThreadingIds!=null&&a.reactionXOfflineThreadingIds.length!==0&&a.reactionAuthoritativeTimestampMs!=null&&a.reactionAuthoritativeTimestampMs.length!==0}function s(a,b,c){if((a==null?void 0:a.length)===0){d("WALogger").ERROR(l());return!1}if(b==null){d("WALogger").ERROR(k());return!1}if(c==null){d("WALogger").ERROR(j());return!1}return!0}function t(a,b,c){return(a||[]).map(function(a,e){if(c==null||b==null||(c==null?void 0:c.length)<=e||(b==null?void 0:b.length)<=e){d("WALogger").WARN(i());return[]}return[a,b[e],c[e]]})}function u(a,b,c,e,f,g){var h=d("MAWAuthor").getAuthorUserJid(f);if(g==null||h==null)return[];var i=g.reactionAuthoritativeTimestampMs;i=i===void 0?[]:i;var j=g.reactionXOfflineThreadingIds;j=j===void 0?[]:j;g=g.reactions;return t(g,j,i).filter(function(a){var b=a[0];a=a[1];return a!=null&&s(b.displayName,a.displayName,d("MAWAuthor").getAuthorUserJid(f))}).map(function(f){var g=f[0],i=f[1];f=f[2];var j=g.displayName;g=d("MAWHandleEchoMsgsRestoreApiUtils").resolveAuthorFromEchoAddress(g,b);g={ack:g===d("WAJids").AUTHOR_ME?d("MAWAckLevel").ACK.sent:d("MAWAckLevel").ACK.received,author:g,externalId:d("WAStanzaUtils").toStanzaId(i.displayName||""),groupingKey:j,reaction:j,reactToAuthor:h,reactToExternalId:c,senderTimestampMs:null,threadJid:a,ts:d("WATimeUtils").castToUnixTime(Number(f.displayName)/1e3)};return e!=null?babelHelpers["extends"]({},g,{reactToMsgId:e}):g})}g.writeEchoReactionsToReactionsStore=a;g.getReactionsForReactionStore=u}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24163")}g["default"]=a}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MAWCurrentUser").isEmployee()&&c("isUseridAnnotationEnabled")()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null}g.getUserHash=a}),98);
__d("WAServerRPCLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["ServerRPC"]);g.logger=a}),98);
__d("MAWIncomingMsg",["MAWUserHash","WAGetPlatformFromStanzaId","WAHashStringToNumber","WAServerRPCLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAServerRPCLogger").logger.TAGS(["HandleIncomingMsg"]);b=function(a){var b=a.encTypes,c=a.msg,e=a.queueType;a=a.retryCount;return{"int":{messageAge:d("WATimeUtils").unixTime()-c.ts,msgId:d("WAHashStringToNumber").hashStringToNumber(c.externalId.toString()),offlineDelivery:c.offline,retryCount:a},string:{e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(c.externalId),jid:c.from.chat,msgType:c.type,queueType:e,threadType:c.from.type,userHash:d("MAWUserHash").getUserHash()},string_array:{encTypes:b}}};g.logger=a;g.prepareAnnotationsForIncomingMessage=b}),98);
__d("MAWProtocolQueueMsg",["MAWBulkHandleIncomingMsgApi","MAWHIMLogger","MAWMsgType","MAWXMALoggingUtils","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot have null result for non-invisible msgs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle: "," msgs: done"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle: "," msgs"]);j=function(){return a};return a}function a(a){var b=new Set(),e=a.map(function(a){var c,e=a.decodedMsg,f=a.receiveFlow;a=a.stanza;var g=a.message.decrypted,h=d("MAWXMALoggingUtils").getXmaTargetTypeStringFromEnum(e==null?void 0:e.xmaTargetTypeForLogging);f.addAnnotations({bool:{furuteproof:(e==null?void 0:(c=e.unstoredDbMsg)==null?void 0:c.type)===d("MAWMsgType").MSG_TYPE.FUTUREPROOF},"int":{xmaTargetType:(c=e==null?void 0:e.xmaTargetTypeForLogging)!=null?c:-1},string:{contentType:(c=e==null?void 0:e.contentTypeForLogging)!=null?c:"",xmaTargetTypeString:h}});if(d("MAWXMAUtils").isRtcXMA(e==null?void 0:(c=e.unstoredXMA)==null?void 0:(h=c.unstoredDbXMA)==null?void 0:h.targetType)){f.endFail("rtc_xma_not_supported");b.add(a.stanzaQueueId);return null}if(g.type==="InstamadilloMsg"){f.endFail("instamadillo_not_supported");b.add(a.stanzaQueueId);return null}if(g.type==="InvisibleMsg"){b.add(a.stanzaQueueId);return null}return{msgData:g,receiveFlow:f,unstoredContent:e}}).filter(Boolean);c("MAWHIMLogger").LOG(j(),e.length);return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(e).then(function(d){var f=d.msgResults;c("MAWHIMLogger").LOG(i(),e.length);a.map(function(a){a=a.stanza;var d=f.get(a.message.decrypted.id);if(d==null){b.has(a.stanzaQueueId)||c("MAWHIMLogger").ERROR(h());return}d.success===!0&&b.add(a.stanzaQueueId)});return{followUpParams:{incomingMsgResults:f,incomingMsgs:a},toAck:Array.from(b)}})["catch"](function(b){var c="Not an Error instance",d="N/A";typeof b.message==="string"&&(c=b.message);typeof b.stack==="string"&&(d=b.stack);a.forEach(function(a){a.receiveFlow.endFail("consumer_handle_message_transaction_error",{string:{errorDescription:c,errorStack:d}})});throw b})}g.handleIncomingMessagesStanzas=a}),98);
__d("MAWProtocolQueueUtils",["MAWGetStorageQplAnnotations","MAWIncomingMsg","WAHashStringToNumber","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){b===void 0&&(b=d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE);var e=a.stanza,f=d("WAPREMetrics").startMetric(b,d("MAWIncomingMsg").prepareAnnotationsForIncomingMessage({msg:e.message.details,queueType:e.message.details.offline!=null?"offline":"online",retryCount:e.message.details.retryCount}),d("WAHashStringToNumber").hashStringToNumber(e.stanzaId.toString()),d("WAPREMetrics").QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS);c("promiseDone")(d("MAWGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){f.addAnnotations(a)}));f.addPoint("consumer_handle_message_stanza_start");return babelHelpers["extends"]({},a,{receiveFlow:f})}function a(a){return h({decodedMsg:void 0,stanza:a})}g.addMetricToMessage=h;g.addMetricToProtocolMessage=a}),98);/*FB_PKG_DELIM*/
__d("MAWThreadKeyUtils",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=d("I64"))).to_string(a)}function b(a){return a}function c(a){return(h||(h=d("I64"))).of_string(a)}function e(a){return a}g.stringThreadKeyFromThreadKey=a;g.stringThreadKeyFromString=b;g.stringThreadKeyToI64=c;g.stringThreadKeyToString=e}),98);
__d("EncryptedBackupsDYIGenerateThreadMetadata",["CurrentUser","EncryptedBackupsDYISingleton","I64","IGDWebUtils","LSMessagingThreadTypeUtil","MAWThreadKeyUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread id for thread key ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread id for thread key ",""]);k=function(){return a};return a}function l(){return d("IGDWebUtils").isOnInstagramWeb()?(i||(i=d("I64"))).of_string(c("CurrentUser").getEIMU()):(i||(i=d("I64"))).of_string(c("CurrentUser").getAccountID())}function m(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(d("MAWThreadKeyUtils").stringThreadKeyToI64(b)))}function n(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.contacts).getKeyRange(b))}function a(a,b){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.contacts).filter(function(a){return b.has((i||(i=d("I64"))).to_string(a.id))}))}function o(a,b){var c;return(c=d("ReQL")).toArrayAsync(c.leftJoin(c.fromTableAscending(a.tables.participants,["contactId"]).getKeyRange(b),c.fromTableAscending(a.tables.contacts,["name"])))}function p(a){return d("LSMessagingThreadTypeUtil").isOneToOne(a)||d("LSMessagingThreadTypeUtil").isOpenOneToOne(a)}function q(a,b,c){if(c!=null&&c.trim()!=="")return c+"_"+b;switch(a.length){case 0:return"Thread_"+b;case 1:return a[0]+"_"+b;case 2:return a[0]+"and"+a[1]+"_"+b;case 3:return""+a[0]+a[1]+"and"+a[2]+"_"+b;case 4:return""+a[0]+a[1]+a[2]+"and1other_"+b;default:return""+a[0]+a[1]+a[2]+"and"+(a.length-3)+"others_"+b}}function r(a,b,c,d,e,f){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var h=[],j=[f];f=(yield m(c,a));if(f!=null)if(p(f.threadType)){var l=b.getThreadIdForThreadKey(a);if(l==null){b.getLogger().WARN(k(),a);return}l=(yield n(c,(i||(i=d("I64"))).of_string(l)));(l==null?void 0:l.id)!=null&&(l==null?void 0:l.name)!=null&&b.setContactNameForContactId((i||(i=d("I64"))).to_string(l.id),l.name);l=(l==null?void 0:l.name)||"Unknown User";h.push(l);j.push(l);b.setThreadMetaDataByThreadKey(a,j,q(h,g,f.threadName))}else{l=(yield o(c,f.threadKey));l.forEach(function(a){var c=a[0];a=a[1];(c==null?void 0:c.contactId)!=null&&(a==null?void 0:a.name)!=null&&b.setContactNameForContactId((i||(i=d("I64"))).to_string(c.contactId),a.name);if(!(i||(i=d("I64"))).equal(c.contactId,e)){c=(a==null?void 0:a.name)||"Unknown User";h.push(c);j.push(c)}});b.setThreadMetaDataByThreadKey(a,j,q(h,g,f.threadName))}else b.setThreadMetaDataByThreadKey(a,j,q(h,g))});return s.apply(this,arguments)}function e(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,e=d("EncryptedBackupsDYISingleton").getSingleton(),f=e.getLogger(),g=(yield e.getDB()),k=(yield n(g,l())),m=(c=k==null?void 0:k.id)!=null?c:(i||(i=d("I64"))).zero,o=(c=k==null?void 0:k.name)!=null?c:"Me";e.setContactNameForContactId((i||(i=d("I64"))).to_string(m),o);return a.reduce(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){yield a;a=e.getThreadIdForThreadKey(b);a==null&&void f.WARN(j(),b);return r(b,e,g,m,o,c)});return function(b,c,d){return a.apply(this,arguments)}}(),(h||(h=b("Promise"))).resolve())});return t.apply(this,arguments)}g.getAllUnmappedContacts=a;g.EncryptedBackupsDYIGenerateThreadMetadata=e}),98);
__d("EncryptedBackupsDYIZipUtils",["EncryptedBackupsDYIFileUtils","Promise","asyncToGeneratorRuntime","jszip"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=new(c("jszip"))();for(a of a){var g=a.threadName+".json";f.file(g,JSON.stringify(a,null,2))}var i=(yield d("EncryptedBackupsDYIFileUtils").getMediaFolderHandle());yield (h||(h=b("Promise"))).all(e.map(function(a){return j(f,i,a)}));return f.generateAsync({compression:"DEFLATE",compressionOptions:{level:6},type:"blob"})});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=c.split("/").pop();b=(yield d("EncryptedBackupsDYIFileUtils").readFile(b,e));a.file(c,b)});return k.apply(this,arguments)}g.generateZipFile=a}),98);
__d("EncryptedBackupsDYISingleton",["EncryptedBackupsDYIFileUtils","EncryptedBackupsDYIGenerateThreadMetadata","EncryptedBackupsDYISingletonFactory","EncryptedBackupsDYITypes","EncryptedBackupsDYIZipUtils","FBLogger","I64","LSIntEnum","MAWBridge","MAWQplProxy","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI Exiting Early - Found "," instamadillo threads"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating DYI status with state BACKUP_RESTORE_SUCCESSFUL"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Writing file to user storage"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Generating zip file"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Generating output"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetched remaining contact names, total of "," contacts"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI flow complete - generating output"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI flow complete - generating output"]);q=function(){return a};return a}var r=null;function s(){try{return WorkerGlobalScope!==void 0&&self instanceof WorkerGlobalScope}catch(a){return!1}}function a(a,b,e){if(r==null)switch(a){case d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Armadillo:if(s())throw c("FBLogger")("labyrinth_web").mustfixThrow("EncryptedBackupsDYISingleton for Armadillo can only be initialised in the main thread");r=d("EncryptedBackupsDYISingletonFactory").getMAWEncryptedBackupsDYISingleton(b,e);break;case d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo:if(!s())throw c("FBLogger")("labyrinth_web").mustfixThrow("EncryptedBackupsDYISingleton for Instamadillo can only be initialised in the worker");r=d("EncryptedBackupsDYISingletonFactory").getIGDEncryptedBackupsDYISingleton(b,e);break}}function e(){if(r==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("EncryptedBackupsDYISingleton is not initialised. Please call EncryptedBackupsDYISingleton.initSingleton() first.");return r}var t=function(){var c=a.prototype;c.getDB=function(){return this.$1()};c.getLogger=function(){return this.$4};function a(a,b,c,d){this.$5=new Map(),this.$6=new Set(),this.$7=new Set(),this.$8=new Map(),this.$9=new Map(),this.$10=new Map(),this.$11=new Map(),this.$12=new Map(),this.$1=a,this.$2=b,this.$3=c,this.$4=d}c.getAllMediaUrls=function(){return Array.from(this.$5.values())};c.$13=function(a){return this.$5.get(a)};c.setMediaUrlByPlainTextHash=function(a,b){if(this.$5.has(a))return;this.$5.set(a,b)};c.addThreadKeyToThreadsRestoreInProgress=function(a){this.$6.add(a)};c.isThreadRestoreInProgressForThreadKey=function(a){return this.$6.has(a)};c.deleteThreadKeyFromThreadsRestoreInProgress=function(a){this.$6["delete"](a),this.$14()&&(void this.$4.LOG(q()),void this.$15()),this.logDYIQPLPoint("message_restore_complete_"+this.$6.size.toString())};c.isThreadsRestoreComplete=function(){return this.$6.size===0};c.addPlaintextHashToAttachmentDownloadsInProgress=function(a){this.$7.add(a)};c.deletePlaintextHashFromAttachmentDownloadsInProgress=function(a){this.$7["delete"](a),this.$14()&&(void this.$4.LOG(p()),void this.$15())};c.isAttachmentDownloadInProgressForPlaintextHash=function(a){return this.$7.has(a)};c.isAttachmentDownloadCompleteForPlaintextHash=function(a){return!!this.$5.get(a)};c.isAttachmentDownloadComplete=function(){return this.$7.size===0};c.setMessagesByThreadKey=function(a,b,c){a=this.getMessagesByThreadKey(a);a.set(b,c)};c.getMessagesByThreadKey=function(a){this.$16(a)||this.$8.set(a,new Map());return this.$8.get(a)};c.$16=function(a){return this.$8.has(a)};c.getThreadIdForThreadKey=function(a){return this.$10.get(a)};c.getThreadKeyForThreadId=function(a){return this.$11.get(a)};c.setThreadMapping=function(a,b){this.$10.set(a,b),this.$11.set(b,a)};c.setThreadMetaDataByThreadKey=function(a,b,c){this.$9.set(a,{participants:b,threadName:c})};c.getThreadMetadataMap=function(){return this.$9};c.setContactNameForContactId=function(a,b){this.$12.set(a,b)};c.getContactNameForContactId=function(a){return this.$12.get(a)};c.getContactNameMap=function(){return this.$12};c.getOutput=function(){var a=this;return Array.from(this.getThreadMetadataMap(),function(b){var c=b[0];b=b[1];var d=a.$16(c);d=d?Array.from(a.getMessagesByThreadKey(c),function(b){b[0];b=b[1];return babelHelpers["extends"]({},b,{media:Array.from(b.media,function(b){b=a.$13(b);return{uri:b!=null?"./"+b:"Failed to download media"}})})}):[];d=d.map(function(b){var c=b.senderId,d=babelHelpers.objectWithoutPropertiesLoose(b,["senderId"]);if(c!=null&&d.senderName==="Unknown User"){c=a.getContactNameForContactId(c);if(c!=null)return babelHelpers["extends"]({},d,{senderName:c})}return b});c=d.sort(function(a,b){return typeof a.timestamp==="number"&&typeof b.timestamp==="number"?a.timestamp-b.timestamp:0});return babelHelpers["extends"]({},b,{messages:c})})};c.$14=function(){return this.isAttachmentDownloadComplete()&&this.isThreadsRestoreComplete()};c.$17=function(a){switch(a){case 0:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.InProgress;case 1:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed;case 2:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed;case-1:default:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.NotStarted}};c.updateDYIStatus=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield this.getDB());yield c.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield b.encrypted_backups_dyi_backup_restore_status.put({currentStatus:(h||(h=d("LSIntEnum"))).ofNumber(a),pk:(i||(i=d("I64"))).zero})});return function(a){return c.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":500");d("MAWBridge").getBridge().fireAndForget("event","updateDYIStatus",{status:this.$17(a)})});function c(b){return a.apply(this,arguments)}return c}();c.$18=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,b=new Set();this.getContactNameMap().forEach(function(a,c){a==="Unknown User"&&b.add(c)});var c=(yield this.getDB());c=(yield d("EncryptedBackupsDYIGenerateThreadMetadata").getAllUnmappedContacts(c,b));c.forEach(function(b){var c=(i||(i=d("I64"))).to_string(b.id);a.setContactNameForContactId(c,b.name)});void this.$4.LOG(o(),this.getContactNameMap().size.toString())});function c(){return a.apply(this,arguments)}return c}();c.$15=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){this.logDYIQPLPoint("complete_dyi_flow_start");yield this.$18();void this.$4.LOG(n());var a=this.getOutput(),b=Array.from(this.$5.values());this.logDYIQPLPoint("write_file_start");void this.$4.LOG(m());a=(yield d("EncryptedBackupsDYIZipUtils").generateZipFile(a,b));b=(yield a.arrayBuffer());a=(yield d("EncryptedBackupsDYIFileUtils").getRootFolderHandle());void this.$4.LOG(l());var c="messages.zip";yield d("EncryptedBackupsDYIFileUtils").writeFile(a,c,b);this.logDYIQPLPoint("write_file_end");void this.$4.LOG(k());this.logDYIQPLPoint("complete_dyi_flow_end");yield this.updateDYIStatus(1);void this.clear()});function c(){return a.apply(this,arguments)}return c}();c.exitDYIEarly=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b!=null&&this.$4.LOG(j(),b),this.logDYIQPLPoint("dyi_exit_early",{"int":{dyi_threads:b}}),yield this.updateDYIStatus(a?2:1),void this.clear()});function c(b,c){return a.apply(this,arguments)}return c}();c.clear=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){this.$5=new Map();this.$6=new Set();this.$7=new Set();this.$8=new Map();this.$9=new Map();var a=(yield d("EncryptedBackupsDYIFileUtils").getRootFolderHandle());yield a.removeEntry(d("EncryptedBackupsDYIFileUtils").DyiMediaFolder,{recursive:!0})});function c(){return a.apply(this,arguments)}return c}();c.logDYIQPLPoint=function(a,b){this.$3!=null&&d("MAWQplProxy").sendQplPointThroughBridge(this.$2,a,{annotations:b,instanceKey:this.$3})};return a}();g.initSingleton=a;g.getSingleton=e;g.EncryptedBackupsDYISingleton=t}),98);
__d("EncryptedBackupsDYISingletonFactory",["EncryptedBackupsDYISingleton","WATagsLogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return new(d("EncryptedBackupsDYISingleton").EncryptedBackupsDYISingleton)(a,c("qpl")._(521478596,"1329"),b,d("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi",b==null?"":b.toString()]))}function b(a,b){return new(d("EncryptedBackupsDYISingleton").EncryptedBackupsDYISingleton)(a,c("qpl")._(521479842,"2163"),b,d("WATagsLogger").TAGS(["igd_labyrinth_web","igd_dyi",b==null?"":b.toString()]))}g.getMAWEncryptedBackupsDYISingleton=a;g.getIGDEncryptedBackupsDYISingleton=b}),98);
__d("EncryptedBackupsDYIHandleMessageRestore",["EncryptedBackupsDYISingleton","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message range query complete for thread with thread key ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Issuing next range query for thread with thread key ",", server generated next reference timestamp: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["nextTimestampMs was not supplied for thread with thread key ","."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handling message range query for thread with thread key ",", hasMoreBefore: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread key for thread id: ",""]);m=function(){return a};return a}function a(a,b,c,e,f,g,i){var o=d("EncryptedBackupsDYISingleton").getSingleton(),p=o.getLogger();o=o.getThreadKeyForThreadId(b);if(o==null){p.WARN(m(),b);return}void p.LOG(l(),b,e);c.length>0&&g(o,b,c);if(!e||f==null){e&&f==null&&void p.ERROR(k(),b);n(o);return}g=(h||(h=d("I64"))).to_string(f);void p.LOG(j(),b,g);void i(a,g,b)}function n(a){var b=d("EncryptedBackupsDYISingleton").getSingleton(),c=b.getLogger();b.deleteThreadKeyFromThreadsRestoreInProgress(a);void c.LOG(i(),a)}g.handleMessageRangeQueryRestore=a}),98);
__d("EncryptedBackupsDYIMediaDownloadHandlers",["EncryptedBackupsDYIFileUtils","EncryptedBackupsDYISingleton","FBLogger","Promise","WAResultOrError","asyncToGeneratorRuntime","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI Media download complete for attachment with hash ",""]);i=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f=(yield d("EncryptedBackupsDYIFileUtils").getMediaFolderHandle());b=b.split("/")[1];b=c("uuidv4")()+"."+b;yield d("EncryptedBackupsDYIFileUtils").writeFile(f,b,e);f=d("EncryptedBackupsDYISingleton").getSingleton();e=f.getLogger();f.setMediaUrlByPlainTextHash(a,d("EncryptedBackupsDYIFileUtils").DyiMediaFolder+"/"+b);void e.LOG(i(),a);f.deletePlaintextHashFromAttachmentDownloadsInProgress(a);return d("WAResultOrError").makeResult()});return function(b,c,d,e){return a.apply(this,arguments)}}();e=function(){c("FBLogger")("labyrinth_web").debug("[DYIMediaPreviewHandler] Skipping previews for DYI");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())};g.DYIMediaDownloadHandler=a;g.DYIMediaPreviewHandler=e}),98);
__d("IGDBuildMediaResignCdnUrlTtlcPartialPayload",["I64","WABase64","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h,i="kPxziUnMc4MUpeaqUkHj8S1MKoxDyFEukbvxsEB/fwE=";function a(a){return!a?null:{backupId:d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()),deviceId:(h||(h=d("I64"))).zero,isOpenEb:a,mailboxRootKey:new ArrayBuffer(0),ocmfClientState:d("WABase64").decodeB64(i)}}g["default"]=a}),98);
__d("LSCreateResignCDNUrlPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[10]?c.sequence([function(e){return c.blobs.neq(a[11],void 0)?c.sequence([function(e){return c.i64.neq(a[8],void 0)?c.sequence([function(e){return a[9]!==void 0?c.sequence([function(e){return c.blobs.neq(a[12],void 0)?c.sequence([function(e){return d[10]=c.createArray(),d[19]=(d[10].push(a[9]),d[10]),d[19]=(d[10].push(a[1]),d[10]),d[11]=c.toJSON(d[10]),d[12]=c.createArray(),d[19]=(d[12].push(c.i64.cast([0,32])),d[12]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[13]=a[0],a})},function(e){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[13],void 0,a[12],d[12]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!1:d[15]=!0,d[15]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[19],c.i64.cast([0,3]))},function(a){return d[16]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[14],c.i64.cast([0,0])).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return d[16]=d[19]}])},function(e){return c.blobs.neq(d[16],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[16],d[20],c.i64.cast([0,16])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[11]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[23]).then(function(a){return a=a,d[24]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[25]).then(function(a){return a=a,d[26]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[9]).then(function(a){return a=a,d[27]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[27]).then(function(a){return a=a,d[28]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[28]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[30]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[31]).then(function(a){return a=a,d[32]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[33]).then(function(a){return a=a,d[34]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(e){return d[43]=new c.Map(),d[43].set("attachment_index_key",d[26]==null?"":d[26]),d[43].set("backup_ent_fbid",a[0]),d[43].set("delivery_object_id",a[1]),d[43].set("device_id",a[8]),d[43].set("mailbox_partial_id",d[30]==null?"":d[30]),d[43].set("media_type",a[3]),d[43].set("message_partial_id",d[34]==null?"":d[34]),d[43].set("product_type",a[2]),d[43].set("salt_partial_id",d[38]==null?"":d[38]),d[43].set("sort_key",d[22]==null?"":d[22]),d[43].set("thread_partial_id",d[42]==null?"":d[42]),d[43].set("isOpenEB",a[10]===!0),d[44]=new c.Map(),d[44].set("otid",a[4]),d[44].set("server_thread_key",a[7]),d[44].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),a[11]).then(function(a){return a=a,d[45]=a[0],a})},function(e){return c.nativeOperation(b("LSBase64Encode.nop"),a[12]).then(function(a){return a=a,d[46]=a[0],a})},function(e){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),d[60]=(d[48].push(a[4]),d[48]),d[60]=(d[48].push(a[1]),d[48]),d[49]=c.toJSON(d[48]),d[43].set("raw_identifiers",d[44]),d[43].set("backup_id",a[9]),d[43].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[43].set("salt_partial_access_token",d[53]==null?"":d[53]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[11]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[43].set("salt_partial_attachment_index_key",d[57]==null?"":d[57]),d[43].set("raw_tokens",d[47]),d[58]=c.toJSON(d[43]),d[59]=new c.Map(),d[59].set("payload",d[58]),a=[d[59],void 0],d[17]=a[0],d[18]=a[1],a}]):c.resolve((d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,25])),d[19].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[19].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),e=[void 0,d[19]],d[17]=e[0],d[18]=e[1],e))},function(a){return a=[d[17],d[18]],d[8]=a[0],d[9]=a[1],a}]):c.resolve((d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,20])),d[10].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[10].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),e=[void 0,d[10]],d[8]=e[0],d[9]=e[1],e))},function(a){return a=[d[8],d[9]],d[6]=a[0],d[7]=a[1],a}]):c.resolve((d[8]=new c.Map(),d[8].set("error_code",c.i64.cast([0,1])),d[8].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[8].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),e=[void 0,d[8]],d[6]=e[0],d[7]=e[1],e))},function(a){return a=[d[6],d[7]],d[4]=a[0],d[5]=a[1],a}]):c.resolve((d[6]=new c.Map(),d[6].set("error_code",c.i64.cast([0,24])),d[6].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[6].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),e=[void 0,d[6]],d[4]=e[0],d[5]=e[1],e))},function(a){return a=[d[4],d[5]],d[2]=a[0],d[3]=a[1],a}]):c.resolve((d[4]=new c.Map(),d[4].set("error_code",c.i64.cast([0,22])),d[4].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[4].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),e=[void 0,d[4]],d[2]=e[0],d[3]=e[1],e))},function(a){return a=[d[2],d[3]],d[0]=a[0],d[1]=a[1],a}]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20])],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],f):(e=a.item,c.sequence([function(a){return d[27]=e.backupTenancy,d[26]=e.encryptionVersion,d[22]=void 0,c.i64.neq(d[22],void 0)?c.resolve(d[23]=d[22]):c.sequence([function(a){return d[28]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[38]=(d[28].push(c.i64.cast([0,0])),d[28]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[38]=(d[28].push(c.i64.cast([0,2])),d[28]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[38]=(d[28].push(c.i64.cast([0,3])),d[28]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[38]=(d[28].push(c.i64.cast([0,4])),d[28]):0,d[33]=c.createArray(),d[34]=c.i64.of_int32(d[28].length),c.i64.gt(d[34],c.i64.cast([0,0]))?c.loopAsync(d[34],function(a){return d[38]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[28],d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[41]=(d[33].push(d[39]),d[33])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[41]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[41]).then(function(a){return a=a,d[42]=a[0],d[43]=a[1],a})},function(a){return d[44]=(d[38].push(c.i64.to_string(d[42])),d[38])}])}):c.resolve()},function(a){return d[40]=d[38].join(","),d[35]=d[40]}])},function(a){return d[33].some(function(a){return c.i64.eq(d[26],a)})?d[36]=d[26]:d[36]=void 0,c.i64.neq(d[36],void 0)?d[37]=d[36]:d[37]=void 0,d[23]=d[37]}])},function(a){return c.i64.neq(d[23],void 0)?d[24]=d[23]:d[24]=c.i64.cast([0,0]),c.i64.neq(d[27],void 0)?d[25]=d[27]:d[25]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[24],d[25],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],a}]))})},function(a){return c.storedProcedure(b("LSFindBackup")).then(function(a){return a=a,d[19]=a[0],a})},function(e){return c.blobs.neq(d[5],void 0)?c.sequence([function(e){return c.i64.neq(d[3],void 0)?c.sequence([function(e){return d[19]!==void 0?c.sequence([function(e){return c.blobs.neq(d[4],void 0)?c.sequence([function(e){return d[28]=c.createArray(),d[37]=(d[28].push(d[19]),d[28]),d[37]=(d[28].push(a[1]),d[28]),d[29]=c.toJSON(d[28]),d[30]=c.createArray(),d[37]=(d[30].push(c.i64.cast([0,32])),d[30]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[31],void 0,d[4],d[30]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!1:d[33]=!0,d[33]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[37]=c.createArray(),void 0!==void 0?d[38]=(d[37].push(void 0),d[37]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[37],c.i64.cast([0,3]))},function(a){return d[34]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[32],c.i64.cast([0,0])).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(a){return d[34]=d[37]}])},function(e){return c.blobs.neq(d[34],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[34],d[38],c.i64.cast([0,16])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[19]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[59]).then(function(a){return a=a,d[60]=a[0],a})},function(e){return d[61]=new c.Map(),d[61].set("attachment_index_key",d[44]==null?"":d[44]),d[61].set("backup_ent_fbid",a[0]),d[61].set("delivery_object_id",a[1]),d[61].set("device_id",d[3]),d[61].set("mailbox_partial_id",d[48]==null?"":d[48]),d[61].set("media_type",a[3]),d[61].set("message_partial_id",d[52]==null?"":d[52]),d[61].set("product_type",a[2]),d[61].set("salt_partial_id",d[56]==null?"":d[56]),d[61].set("sort_key",d[40]==null?"":d[40]),d[61].set("thread_partial_id",d[60]==null?"":d[60]),d[61].set("isOpenEB",a[10]===!0),d[62]=new c.Map(),d[62].set("otid",a[4]),d[62].set("server_thread_key",a[7]),d[62].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[64]=a[0],a})},function(e){return d[65]=new c.Map(),d[65].set("ocmf_client_state_blob",d[63]==null?"":d[63]),d[65].set("mailbox_root_key",d[64]==null?"":d[64]),d[66]=c.createArray(),d[78]=(d[66].push(a[4]),d[66]),d[78]=(d[66].push(a[1]),d[66]),d[67]=c.toJSON(d[66]),d[61].set("raw_identifiers",d[62]),d[61].set("backup_id",d[19]),d[61].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[67]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[68]).then(function(a){return a=a,d[69]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[69]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[70]).then(function(a){return a=a,d[71]=a[0],a})},function(a){return d[61].set("salt_partial_access_token",d[71]==null?"":d[71]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[72]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[73]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[74]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[61].set("salt_partial_attachment_index_key",d[75]==null?"":d[75]),d[61].set("raw_tokens",d[65]),d[76]=c.toJSON(d[61]),d[77]=new c.Map(),d[77].set("payload",d[76]),a=[d[77],void 0],d[35]=a[0],d[36]=a[1],a}]):c.resolve((d[37]=new c.Map(),d[37].set("error_code",c.i64.cast([0,25])),d[37].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[37].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),e=[void 0,d[37]],d[35]=e[0],d[36]=e[1],e))},function(a){return a=[d[35],d[36]],d[26]=a[0],d[27]=a[1],a}]):c.resolve((d[28]=new c.Map(),d[28].set("error_code",c.i64.cast([0,20])),d[28].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[28].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),e=[void 0,d[28]],d[26]=e[0],d[27]=e[1],e))},function(a){return a=[d[26],d[27]],d[24]=a[0],d[25]=a[1],a}]):c.resolve((d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,1])),d[26].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[26].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),e=[void 0,d[26]],d[24]=e[0],d[25]=e[1],e))},function(a){return a=[d[24],d[25]],d[22]=a[0],d[23]=a[1],a}]):c.resolve((d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,24])),d[24].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[24].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1],e))},function(a){return a=[d[22],d[23]],d[20]=a[0],d[21]=a[1],a}]):c.resolve((d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,22])),d[22].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[22].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),e=[void 0,d[22]],d[20]=e[0],d[21]=e[1],e))},function(a){return a=[d[20],d[21]],d[0]=a[0],d[1]=a[1],a}])},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure";e.exports=a}),null);
__d("LSCreateResignCDNUrlPayloadStoredProcedure",["LSCreateResignCDNUrlPayload","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.backupEntFbid;d[1]=b.deliveryObjectId;d[2]=b.productType;d[3]=b.mediaType;d[4]=b.messageId;d[5]=b.threadId;d[6]=b.sortOrder;d[7]=b.serverThreadKey;d[8]=b.deviceId;d[9]=b.backupId;d[10]=b.isOpenEb;d[11]=b.ocmfClientState;d[12]=b.mailboxRootKey;return c("LSCreateResignCDNUrlPayload").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MebMIMediaDownloader",["FBLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,c){this.mediaDownloadMetadata=a;this.callbacks={onResignCdnUrlFailure:(a=c==null?void 0:c.onResignCdnUrlFailure)!=null?a:b("asyncToGeneratorRuntime").asyncToGenerator(function*(){}),onResignCdnUrlSuccess:(a=c==null?void 0:c.onResignCdnUrlSuccess)!=null?a:b("asyncToGeneratorRuntime").asyncToGenerator(function*(){})}}var d=a.prototype;d.getDownloadMetadata=function(){return this.mediaDownloadMetadata};d.handle=function(){throw c("FBLogger")("labyrinth_web").mustfixThrow("[MebMIMediaDownloader] Please don't use the base class. Instead use either MAWMIMediaDownloader or IGDMIMediaDownloader, depending on the platform.")};d["continue"]=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;yield this.callbacks.onResignCdnUrlSuccess();b=(b=this.waMediaDownloader)==null?void 0:b.getDownloadMetadata();if(b!=null){var c=b.mediaEntry;c.directPath=a;b.isUrlRenewed=!0;yield (c=this.waMediaDownloader)==null?void 0:c.handle()}});function a(b){return a.apply(this,arguments)}return a}();d.handleError=function(){return this.callbacks.onResignCdnUrlFailure()};d.setNextHandler=function(a){this.waMediaDownloader=a};return a}();g["default"]=a}),98);
__d("IGDMIMediaDownloader",["I64","IGDBuildMediaResignCdnUrlTtlcPartialPayload","LSCreateResignCDNUrlPayloadStoredProcedure","LSFactory","LSShape","MAWBridge","MAWReStoreDb","MAWThreadKeyUtils","MebMIMediaDownloader","MediaDownloadMediator","WALogger","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][meb][media download] failed to fetch cdn url for attachment. The error is ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][meb][media download] failed to fetch cdn url for attachment. The error is ",""]);j=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var f=e.prototype;f.handle=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,b=(yield d("MAWReStoreDb").getDB()),e=this.mediaDownloadMetadata.backupEntFbid;if(e!=null){var f=d("MAWThreadKeyUtils").stringThreadKeyToString(this.mediaDownloadMetadata.threadKey);b=(yield b.runInTransaction(function(b){return c("LSCreateResignCDNUrlPayloadStoredProcedure")(c("LSFactory")(b),babelHelpers["extends"]({backupEntFbid:(h||(h=d("I64"))).of_string(e),deliveryObjectId:a.mediaDownloadMetadata.deliveryObjectId,mediaType:a.mediaDownloadMetadata.mediaType,messageId:a.mediaDownloadMetadata.messageId,productType:a.mediaDownloadMetadata.productType,serverThreadKey:f,sortOrder:h.of_float(a.mediaDownloadMetadata.sortOrder),threadId:a.mediaDownloadMetadata.threadId},c("IGDBuildMediaResignCdnUrlTtlcPartialPayload")(Boolean(a.mediaDownloadMetadata.isOpenEb))))},"readwrite"));var g=b[0];if(g!=null){g=d("LSShape").toRecord(g);try{var k=d("WAMediaUtils").stringToDeliveryObjectId(this.mediaDownloadMetadata.deliveryObjectId);d("MediaDownloadMediator").mapDeliveryObjectIdToMediaDownloader(k,this);return d("MAWBridge").getBridge().fireAndForget("event","resignCdnUrl",{deliveryObjectId:k,payload:g.payload})}catch(a){d("WALogger").ERROR(j(),a)}}else if(b[1]){k=d("LSShape").toRecord(b[1]);d("WALogger").ERROR(i(),k.error_message)}}});function e(){return a.apply(this,arguments)}return e}();return e}(c("MebMIMediaDownloader"));g.IGDMIMediaDownloader=a}),98);
__d("MAWMIMediaDownloader",["FBLogger","I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueAttachmentRestoreTaskStoredProcedure","LSMEBTaskCreationSource","MAWCastToMsgrServerMediaType","MAWThreadKeyUtils","MebMIMediaDownloader","MediaDownloadMediator","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var g=e.prototype;g.handle=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,b=(yield (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton);d("MediaDownloadMediator").mapDeliveryObjectIdToMediaDownloader(d("WAMediaUtils").stringToDeliveryObjectId(this.mediaDownloadMetadata.deliveryObjectId),this);var e=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(this.mediaDownloadMetadata.mediaType);if(e==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("Unsupported media type");var g=d("MAWThreadKeyUtils").stringThreadKeyToString(this.mediaDownloadMetadata.threadKey);yield b.runInTransaction(function(b){return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(b),{backupEntFbid:(i||(i=d("I64"))).of_string(a.mediaDownloadMetadata.backupEntFbid),deliveryObjectId:a.mediaDownloadMetadata.deliveryObjectId,mediaType:e,messageId:a.mediaDownloadMetadata.messageId,productType:a.mediaDownloadMetadata.productType,serverThreadKey:g,sortOrder:i.of_float(a.mediaDownloadMetadata.sortOrder),source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").MSGR_DYI),threadId:a.mediaDownloadMetadata.threadId})},"readwrite",void 0,void 0,f.id+":49")});function e(){return a.apply(this,arguments)}return e}();return e}(c("MebMIMediaDownloader"));g.MAWMIMediaDownloader=a}),98);
__d("MebWAMediaDownloader",["MAWBridge","MAWGetMediaPlaintextApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWUpdateMediaEntryForMsgApi","WAAPI","WAIsMediaExpiredError","WALogger","WAPREList","WAPREMetrics","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloading media from MI directly"]);h=function(){return a};return a}a=function(){function a(a,b,c){this.mediaDownloadMetadata=a,this.downloadCallbacks=b,this.waApiDownloadCall=c}var e=a.prototype;e.handle=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,b=this.mediaDownloadMetadata.sortOrderMs;a=(a=this.mediaDownloadMetadata.isUrlRenewed)!=null?a:!1;if(!a&&(i(b)||c("gkx")("23960"))){d("WALogger").LOG(h());yield this.downloadCallbacks.onUrlExpired();return(a=this.mediaDownloadHandler)==null?void 0:a.handle()}b=this.mediaDownloadMetadata;a=b.hash;var e=b.mediaEntry;b=b.protocolMsgId;a=(yield this.waApiDownloadCall(a,e,b));if(a.success)return this.downloadCallbacks.onDownloadSuccess(a.value);d("WAIsMediaExpiredError").isMediaExpiredError(a.error)&&(yield this.handleError())});function e(){return a.apply(this,arguments)}return e}();e.handleError=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;yield this.downloadCallbacks.onDownloadError();return(a=this.mediaDownloadHandler)==null?void 0:a.handle()});function c(){return a.apply(this,arguments)}return c}();e.getDownloadMetadata=function(){return this.mediaDownloadMetadata};e.setNextHandler=function(a){this.mediaDownloadHandler=a};return a}();e=function(a,b,e){var f=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{string:{downloadEntry:"MebWAMediaDownloader"}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);return c("WAAPI").downloadMedia({downloadMediaMetric:f,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload,hash:a,mediaEntry:b,onlyIfMediaTTLIsValid:!1,protocolMsgId:e,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg})};f=function(a,b,c){return d("MAWBridge").getBridge().sendAndReceive("backend","dyiDownloadMedia",{hash:a,mediaEntry:b,protocolMsgId:c})};function i(a){var b=Date.now();if(typeof a!=="number")return!0;b=Math.round((b-a)/864e5);return b>30}g.MebWAMediaDownloader=a;g.MebWADownloadMediaFromWorker=e;g.MebWADownloadMediaThroughTheBridge=f}),98);
__d("EncryptedBackupsDYIMessageProcessingUtils",["EncryptedBackupsDYIMediaDownloadHandlers","EncryptedBackupsDYISingleton","IGDMIMediaDownloader","MAWMIMediaDownloader","MebWAMediaDownloader","Promise","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["initiating media download for attachment with hash ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEB][DYI] Retry download media as signature has expired and should be renewed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully downloaded media"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media"]);l=function(){return a};return a}function a(a,b){return{isUnsent:!1,media:new Set(),reactions:[],senderName:m(a),text:"",timestamp:(a=b)!=null?a:0,type:""}}function m(a){var b=d("EncryptedBackupsDYISingleton").getSingleton(),c="Unknown User";if(a!=null){b=b.getContactNameForContactId(a);b!=null&&(c=b)}return c}function c(a,c,e,f,g,m,n,o,p,q){var r=d("EncryptedBackupsDYISingleton").getSingleton(),s=r.getLogger(),t={author:d("WAJids").unsafeCoerceToUserJid(n),chat:d("WAJids").unsafeCoerceToChatJid(g),externalId:o},u={hash:p,isUrlRenewed:!1,mediaEntry:f,protocolMsgId:t,sortOrderMs:q};n={onDownloadError:function(){void s.ERROR(l());r.deletePlaintextHashFromAttachmentDownloadsInProgress(u.hash);return(h||(h=b("Promise"))).resolve()},onDownloadSuccess:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){void s.LOG(k());var b=a.mimeType;a=a.plaintext;yield d("EncryptedBackupsDYIMediaDownloadHandlers").DYIMediaDownloadHandler(u.hash,b,a,t)});function c(b){return a.apply(this,arguments)}return c}(),onUrlExpired:function(){void s.LOG(j());return(h||(h=b("Promise"))).resolve()}};var v=new(d("MebWAMediaDownloader").MebWAMediaDownloader)(u,n,a);void s.LOG(i(),p);var w=f.serverMediaType;f=f.objectId;if(w!=null&&f!=null&&typeof q==="number"){c={backupEntFbid:c,deliveryObjectId:f,hash:p,mediaType:w,messageId:o,productType:e,sortOrder:q,threadId:g,threadKey:m};f={onResignCdnUrlFailure:function(){r.deletePlaintextHashFromAttachmentDownloadsInProgress(u.hash);return(h||(h=b("Promise"))).resolve()},onResignCdnUrlSuccess:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function c(){return a.apply(this,arguments)}return c}()};p=e==="msgr"?new(d("MAWMIMediaDownloader").MAWMIMediaDownloader)(c,f):new(d("IGDMIMediaDownloader").IGDMIMediaDownloader)(c,f);v.setNextHandler(p);p.setNextHandler(new(d("MebWAMediaDownloader").MebWAMediaDownloader)(u,n,a))}void v.handle()}g.buildBaseDyiMessage=a;g.getSenderName=m;g.startMediaDownloadChain=c}),98);
__d("LSDecryptMessageV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSIsMobileClient","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[2]==null?c.i64.cast([0,0]):a[2],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[12],d[15]=d[12].get("epoch_root_key"),d[12],d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[22],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]!==void 0?c.resolve(d[27]=d[26]):c.sequence([function(a){return d[28]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] ","",d[28]].join("")),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure",[d[28]].join(""),d[29],c.i64.cast([0,3]))},function(a){return d[27]=void 0}])},function(a){return d[23]=d[27]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null"),void 0!==void 0?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return d[23]!==void 0?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1],a),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1],a}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1],e))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageV2] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageV2",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageV2StoredProcedure";e.exports=a}),null);
__d("LSDecryptMessages",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDecryptMessageV2","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessages] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,1])),d[11].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[11].set("error_message",""),g=[void 0,d[11]],d[2]=g[0],d[3]=g[1],g):(f=e.item,c.sequence([function(a){return d[19]=f.backupId,d[20]=f.deviceId,d[18]=f.backupTenancy,d[17]=f.encryptionVersion,d[11]=void 0,c.i64.neq(d[11],void 0)?c.resolve(d[12]=d[11]):c.sequence([function(a){return d[21]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[31]=(d[21].push(c.i64.cast([0,0])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[31]=(d[21].push(c.i64.cast([0,2])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[31]=(d[21].push(c.i64.cast([0,3])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[25]?d[31]=(d[21].push(c.i64.cast([0,4])),d[21]):0,d[26]=c.createArray(),d[27]=c.i64.of_int32(d[21].length),c.i64.gt(d[27],c.i64.cast([0,0]))?c.loopAsync(d[27],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[26].push(d[32]),d[26])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[31]=c.createArray(),d[32]=c.i64.of_int32(d[26].length),c.i64.gt(d[32],c.i64.cast([0,0]))?c.loopAsync(d[32],function(a){return d[34]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],d[34]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],a})},function(a){return d[37]=(d[31].push(c.i64.to_string(d[35])),d[31])}])}):c.resolve()},function(a){return d[33]=d[31].join(","),d[28]=d[33]}])},function(a){return d[26].some(function(a){return c.i64.eq(d[17],a)})?d[29]=d[17]:d[29]=void 0,c.i64.neq(d[29],void 0)?d[30]=d[29]:d[30]=void 0,d[12]=d[30]}])},function(e){return c.i64.neq(d[12],void 0)?d[13]=d[12]:d[13]=c.i64.cast([0,0]),c.i64.neq(d[18],void 0)?d[14]=d[18]:d[14]=c.i64.cast([0,1]),c.i64.neq(d[20],void 0)?c.sequence([function(e){return d[21]=c.createArray(),d[22]=c.createArray(),d[23]=new c.Map(),d[24]=c.i64.of_int32(a[0].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.loopAsync(d[24],function(e){return d[28]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return d[31]=d[29].get("epoch_anon_id"),d[29],d[32]=d[23].get(c.blobs.to_string(d[31])),d[23],d[32]!==void 0?c.resolve(d[33]=d[32]):c.sequence([function(a){return d[38]=d[29].get("epoch_anon_id"),d[29],d[39]=d[29].get("epoch_id"),d[29],c.i64.neq(d[39],void 0)?c.sequence([function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[39]]]]),function(a){return c.i64.eq(a.backupId,d[19])&&c.i64.eq(a.epochId,d[39])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[43]=new c.Map(),d[43].set("epoch_root_key",a.epochRootKeyBlob),d[43].set("epoch_anon_id",a.epochAnonIdBlob),d[44]=(d[42].push(d[43]),d[42])})},function(a){return d[40]=d[42]}]):c.sequence([function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch([[[d[19]]],"fk_secure_encrypted_backups_client_state"]),function(a){return c.i64.eq(a.backupId,d[19])&&c.blobs.eq(a.epochAnonIdBlob,d[38])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[43]=new c.Map(),d[43].set("epoch_root_key",a.epochRootKeyBlob),d[43].set("epoch_anon_id",a.epochAnonIdBlob),d[44]=(d[42].push(d[43]),d[42])})},function(a){return d[40]=d[42]}])},function(a){return d[41]=c.i64.of_int32(d[40].length),c.i64.gt(d[41],c.i64.cast([0,0]))?(d[42]=d[29].get("epoch_anon_id"),d[29],d[23].set(c.blobs.to_string(d[42]),d[40])):0,d[33]=d[40]}])},function(e){return d[34]=d[29].get("value"),d[29],d[35]=d[29].get("encryption_version"),d[29],c.storedProcedure(b("LSDecryptMessageV2"),d[34],a[1],d[35],d[33]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return d[36]!==void 0?c.resolve((d[38]=d[29].get("otid"),d[29],d[39]=new c.Map(),d[39].set("value",d[36]),d[39].set("otid",d[38]),d[40]=(d[21].push(d[39]),d[21]))):c.sequence([function(a){return d[37]!==void 0?c.sequence([function(a){return d[38]=c.i64.of_int32(d[33].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[51]=d[49].get("epoch_root_key"),d[49],d[52]=c.createArray(),d[57]=(d[52].push(c.i64.cast([0,18])),d[52]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[51],d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]!==void 0?c.sequence([function(a){return d[57]=c.i64.of_int32(d[53].length),c.i64.ge(d[57],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[53],c.i64.cast([0,0])).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[58]=d[59]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[59]=c.createArray(),void 0!==void 0?d[60]=(d[59].push(void 0),d[59]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[59],c.i64.cast([0,3]))},function(a){return d[58]=void 0}])},function(a){return d[54]=d[58]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[57]=c.createArray(),void 0!==void 0?d[58]=(d[57].push(void 0),d[57]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[57],c.i64.cast([0,3]))},function(a){return d[54]=void 0}])},function(a){return c.blobs.neq(d[54],void 0)?d[55]=!0:d[55]=!1,d[55]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.neq(d[54],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[56]=d[57]==null?"[encodingFailed]":d[57]}]):c.resolve(d[56]="[null]")},function(a){return d[39]=d[56]}]):c.resolve(d[39]="[noEpochs]")},function(a){return d[40]=d[29].get("otid"),d[29],d[41]=d[29].get("epoch_anon_id"),d[29],d[42]=d[29].get("encryption_version"),d[29],c.i64.neq(d[42],void 0)?d[43]=c.i64.to_string(d[42]):d[43]="null",d[44]=c.i64.of_int32(d[33].length),d[45]=d[29].get("epoch_fingerprint"),d[29],c.blobs.neq(d[45],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[46]=d[49]==null?"[encodingFailed]":d[49]}]):c.resolve(d[46]="[null]")},function(a){return d[47]=d[29].get("backup_id"),d[29],d[48]="",d[37].set("error_message",["Decryption failed for message with otid:",d[48],d[40],d[48]," epoch:",d[48],c.blobs.to_string(d[41]),d[48]," version:",d[48],d[43],d[48]," epoch_key_count:",d[48],c.i64.to_string(d[44]),d[48]," vsr_fingerprint:",d[48],d[46],d[48]," local_fingerprint:",d[48],d[39],d[48]," vsr_backup_id:",d[48],c.i64.to_string(d[47])==null?"[null]":c.i64.to_string(d[47]),d[48]," local_backup_id:",d[48],c.i64.to_string(d[19]),d[48]," local_device_id:",d[48],c.i64.to_string(d[20])].join(""))}]):c.resolve()},function(a){return d[38]=(d[22].push(d[37]),d[22])}])}])}):c.resolve()},function(a){return d[25]=c.i64.of_int32(d[22].length),c.i64.gt(d[25],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[22],c.i64.cast([0,0])).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],a})},function(a){return a=[void 0,d[28]],d[26]=a[0],d[27]=a[1],a}]):c.resolve((a=[d[21],void 0],d[26]=a[0],d[27]=a[1],a))},function(a){return a=[d[26],d[27]],d[15]=a[0],d[16]=a[1],a}]):c.resolve((d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,24])),d[21].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[21].set("error_message",""),e=[void 0,d[21]],d[15]=e[0],d[16]=e[1],e))},function(a){return a=[d[15],d[16]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessages] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessages",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessagesStoredProcedure";e.exports=a}),null);
__d("MAWEncryptedBackupsDYIProcessEchoMessages",["EchoMessage","EncryptedBackupsDYIMessageProcessingUtils","EncryptedBackupsDYISingleton","MAWFrontendMediaUtils","MAWHandleEchoMediaMsgsRestoreV2","MebWAMediaDownloader","WAHashUtils","WAMediaUtils","WAStanzaUtils","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media message is missing media data"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Explicitly dropping "," message type"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported message content subtype for placeholder: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message is not supported in DYI"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encountered message edits: ","\n. Edit count: ","\n. Original message content: ",""],["Encountered message edits: ","\\n. Edit count: ","\\n. Original message content: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping tombstoned message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing Echo document. Dropping the message: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot convert Echo message to DYI format. Dropping the message"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," echo messages for thread ",""]);p=function(){return a};return a}function a(a,b,c){var e=d("EncryptedBackupsDYISingleton").getSingleton(),f=e.getLogger();void f.LOG(p(),c.length,a);c.forEach(function(c){try{var g=q(a,b,c);if(g==null){void f.WARN(o());return}e.setMessagesByThreadKey(a,d("WAStanzaUtils").toStanzaId(c.messageId),g);return}catch(a){void f.ERROR(n(),a);return}})}function q(a,b,e){var f,g=d("EncryptedBackupsDYISingleton").getSingleton(),h=g.getLogger();if(e.isTombstoned!=null&&e.isTombstoned===!0){void h.LOG(m());return}f=d("EncryptedBackupsDYIMessageProcessingUtils").buildBaseDyiMessage((f=e.from)==null?void 0:f.localKey,e.sortOrderMs);(e.editCount>0||e.editHistory.length>0)&&void h.LOG(l(),JSON.stringify(e.editHistory,null,2),e.editCount,e.text);e.reactions!=null&&e.reactions.length>0&&(f.reactions=e.reactions.map(function(a){var b=a.displayName;a=a.localKey;return{actor:(a=g.getContactNameForContactId(a))!=null?a:"unknown",reaction:(a=b)!=null?a:"unknown"}}));var n=c("qex")._("172")||!1;switch(e.contentType){case d("EchoMessage").EchoMessageContentType.TEXT:if(n&&e.xContentType===d("EchoMessage").EchoXMessageContentType.BUMP){void h.WARN(k());return void 0}else f.type="text",f.text=e.text||"";break;case d("EchoMessage").EchoMessageContentType.MEDIA:f.type="media";f=r(a,b,e,f);break;case d("EchoMessage").EchoMessageContentType.PLACEHOLDER:e.contentSubtype===d("EchoMessage").EchoMessageContentSubtype.UNSEND&&(f.type="placeholder",f.isUnsent=!0,f.text="User unsent a message");void h.WARN(j(),d("EchoMessage").EchoMessageContentSubtype.getName(e.contentSubtype));return void 0;case d("EchoMessage").EchoMessageContentType.XMA:f.type="link";e.xmaData!=null&&e.xmaData.xmaDefaultCTA!=null?f.text=e.xmaData.xmaDefaultCTA:f.text=e.text||"";break;case d("EchoMessage").EchoMessageContentType.ADMIN_MESSAGE:case d("EchoMessage").EchoMessageContentType.DECRYPTION_FAILURE:case d("EchoMessage").EchoMessageContentType.NULL_STATE:case d("EchoMessage").EchoMessageContentType.UNSUPPORTED_NEEDS_UPDATE:void h.LOG(i(),e.contentType);return void 0}return f}function r(a,b,c,e){var f=d("EncryptedBackupsDYISingleton").getSingleton(),g=f.getLogger();if(c.mediaData==null){void g.WARN(h());return e}g=c.from;var i=c.xOfflineThreadingId,j=c.mediaData,k=j.attachmentObjectId,l=j.backupEntFbid,m=j.directPath,n=j.encryptedHash,o=j.filename,p=j.mediaContentType,q=j.mediaKey,r=j.mediaKeyTimestamp,s=j.plaintextHash;j=j.size;g=(g=g==null?void 0:g.localKey)!=null?g:"0";i=d("WAStanzaUtils").toStanzaId((i=i)!=null?i:"0");p=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(p||"");p=p.serverMediaType;s=d("WAHashUtils").stringToPlaintextHash(d("MAWHandleEchoMediaMsgsRestoreV2").getBase64WithoutPadding(s));e.media.add(s);if(!f.isAttachmentDownloadInProgressForPlaintextHash(s)&&!f.isAttachmentDownloadCompleteForPlaintextHash(s)){f.addPlaintextHashToAttachmentDownloadsInProgress(s);n=d("MAWHandleEchoMediaMsgsRestoreV2").constructMediaEntry(s,(f=n)!=null?f:"",q,m,r,p,o,l,k,null,j);f=d("WAMediaUtils").decodeMediaEntryData(n);void d("EncryptedBackupsDYIMessageProcessingUtils").startMediaDownloadChain(d("MebWAMediaDownloader").MebWADownloadMediaThroughTheBridge,"-8","msgr",f,b,a,g,i,s,c.sortOrderMs)}return e}g.processEBEchoMessagesForDYI=a}),98);
__d("MAWEncryptedBackupsDYIProcessProtobufMessages",["CurrentUser","EncryptedBackupsDYIMessageProcessingUtils","EncryptedBackupsDYISingleton","MAWEBUploadMessageUtils","MAWFrontendMediaUtils","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoProtobufsRestoreApi","MAWJids","MAWMsgType","MebWAMediaDownloader","WAHashUtils","WAJids","WAMediaUtils","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Starting DYI media download for attachemnt with hash ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Media message is missing media data"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Explicitly dropping "," message type"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message is not supported in DYI"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] XMA message doesn't have xmaData"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Documents are not supported in DYI"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to calculate sortOrder for protobuf message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf: ts or messageId or senderId is null"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf: metadata or message type is null"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf. Dropping the message: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error converting protobuf to DYI format. Dropping the message"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error converting protobuf to DYI format. Dropping the message"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decoded protobuf is empty"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," protobuf messages for thread ",""]);u=function(){return a};return a}function a(a,b,e){var f=d("EncryptedBackupsDYISingleton").getSingleton(),g=f.getLogger();void g.LOG(u(),e.length,b);var h=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());e.forEach(function(c){try{c=d("MAWHandleEchoProtobufsRestoreApi").decodeDecryptedMessageProtobuf(c,h);if(c==null){void g.WARN(t());return}if(c!=null&&c.metadata!=null&&c.metadata.messageId!=null){var e=d("WAStanzaUtils").toStanzaId(c.metadata.messageId);c=v(a,b,c);if(c==null){void g.WARN(s());return}f.setMessagesByThreadKey(a,e,c)}else{void g.WARN(r());return}}catch(a){void g.ERROR(q(),a);return}})}function v(a,b,e){var f,g=d("EncryptedBackupsDYISingleton").getSingleton(),h=g.getLogger(),i=e.metadata,q=e.msgType;if(i==null||q==null){void h.WARN(p());return}q=i.messageId;var r=i.senderId;i=i.timestampMs;if(i==null||typeof i!=="number"||q==null||r==null){void h.WARN(o());return}q=d("WATimeUtils").castMilliSecondsToUnixTime(i);i=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());i=d("MAWHandleEchoProtobufsRestoreApi").createUnstoredDbContentFromProtobufObject(e,d("WAJids").unsafeCoerceToChatJid(b),i);if((i==null?void 0:i.unstoredDbContent.unstoredDbMsg)==null){void h.WARN(n());return}i=d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder(i.unstoredDbContent.unstoredDbMsg);r=d("EncryptedBackupsDYIMessageProcessingUtils").buildBaseDyiMessage(r,i);f=(f=e.decodedPayload)==null?void 0:f.text;if(e.editMsgData.length>0){var s=q;e.editMsgData.forEach(function(a){var b;if(a.ts>s&&((b=a.editMsgContent.message)==null?void 0:b.text)!=null){s=a.ts;f=(b=a.editMsgContent.message)==null?void 0:b.text}})}e.reactionData.length>0&&(r.reactions=e.reactionData.map(function(a){var b=a.reaction;a=a.senderId;return{actor:(a=g.getContactNameForContactId(a))!=null?a:"unknown",reaction:(a=b.text)!=null?a:"unknown"}}));switch(e.msgType){case d("MAWMsgType").MSG_TYPE.TEXT:r.type="text";r.text=f||"";break;case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.PTT:r.type="media";r.text=f||"";r=w(a,b,e,i,r);break;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:void h.WARN(m());return;case d("MAWMsgType").MSG_TYPE.XMA:r.type="link";if(e.xmaData==null){void h.WARN(l());return}r.text=((q=e.xmaData)==null?void 0:q.ctas.map(function(a){return a.nativeUrl}).filter(Boolean).join("\n"))||"";break;case d("MAWMsgType").MSG_TYPE.REVOKED:r.type="placeholder";r.isUnsent=!0;r.text="User unsent a message";break;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:void h.WARN(k());return;default:void h.LOG(j(),e.msgType);return}return r}function w(a,b,c,e,f){var g,j=d("EncryptedBackupsDYISingleton").getSingleton(),k=j.getLogger();if(c.mediaMetadata==null){void k.WARN(i());return f}var l=c.mediaMetadata,m=l.attachmentObjectId,n=l.backupEntFbid,o=l.directPath,p=l.encryptedHash,q=l.filename,r=l.mediaContentType,s=l.mediaKey,t=l.mediaKeyTimestamp,u=l.plaintextHash;l=l.size;g=(g=(g=c.metadata)==null?void 0:g.senderId)!=null?g:"0";c=d("WAStanzaUtils").toStanzaId(c.externalId);u=d("WAHashUtils").stringToPlaintextHash(u);r=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(r||"");r=r.serverMediaType;f.media.add(u);if(!j.isAttachmentDownloadInProgressForPlaintextHash(u)&&!j.isAttachmentDownloadCompleteForPlaintextHash(u)){void k.LOG(h(),u);j.addPlaintextHashToAttachmentDownloadsInProgress(u);j=d("MAWHandleEchoMediaMsgsRestoreV2").constructMediaEntry(u,(k=p)!=null?k:"",s,o,t,r,q,n,m,null,l);p=d("WAMediaUtils").decodeMediaEntryData(j);void d("EncryptedBackupsDYIMessageProcessingUtils").startMediaDownloadChain(d("MebWAMediaDownloader").MebWADownloadMediaThroughTheBridge,"-8","msgr",p,b,a,g,c,u,e)}return f}g.processEBProtobufMessagesForDYI=a}),98);
__d("MAWEncryptedBackupsDYIHandleMessageRestore",["EncryptedBackupsDYIHandleMessageRestore","I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsDYIProcessEchoMessages","MAWEncryptedBackupsDYIProcessProtobufMessages","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("LSIntEnum")).ofNumber(c("LSMEBTaskCreationSource").MSGR_DYI),l=c("justknobx")._("1485"),m=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("MAWEBRestoreTrackingUtils").markEBRestoreDYI(c("LSMEBTaskCreationSource").MSGR_DYI),yield a.runInTransaction(function(a){return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),{isPointQuery:!1,newerNumMessages:(i||(i=d("I64"))).zero,numMessages:i.of_int32(l),source:k,startSortKey:b,threadId:e})},"readwrite",void 0,void 0,f.id+":41")});return function(b,c,d){return a.apply(this,arguments)}}();function a(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton);void d("EncryptedBackupsDYIHandleMessageRestore").handleMessageRangeQueryRestore(f,a,b,c,e,d("MAWEncryptedBackupsDYIProcessEchoMessages").processEBEchoMessagesForDYI,m)});return n.apply(this,arguments)}function e(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton);void d("EncryptedBackupsDYIHandleMessageRestore").handleMessageRangeQueryRestore(f,a,b,c,e,d("MAWEncryptedBackupsDYIProcessProtobufMessages").processEBProtobufMessagesForDYI,m)});return o.apply(this,arguments)}g.taskCreationSource=k;g.MESSENGER_DYI_BATCH_SIZE=l;g.handleMAWEchoMessageRangeQueryRestore=a;g.handleMAWProtobufMessageRangeQueryRestore=e}),98);
__d("MAWRestoreMessagesFromEncryptedBackupsDeferred",["LSDatabaseSingleton","LSVec","MAWEncryptedBackupUtils","Promise","gkx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("MAWRestoreMessagesFromEncryptedBackupsNOP").__setRef("MAWRestoreMessagesFromEncryptedBackupsDeferred");function a(a,e,f,g,k,l,m,n,o,p,q){return j.load().then(function(j){var r=p!=null?Number(p):void 0;r=c("gkx")("201")?d("MAWEncryptedBackupUtils").getMessageMetadataFromDeanonAPI(e,f.length,r):(i||(i=b("Promise"))).resolve();return r.then(function(b){c("promiseDone")((h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(c){return c.runInTransaction(function(c){return j.call(c,a,e,f,g,k,l,m,n,o,p,q,b)},"readwrite")}));return[c("LSVec").ofArray([]),c("LSVec").ofArray([]),!1]})})}g.call=a}),98);
__d("LSRestoreEchoBlobs.nop",["CurrentUser","EchoMessage","I64","LSIntEnum","LSMEBTaskCreationSource","LSVec","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWEncryptedBackupsDYIHandleMessageRestore","MAWHandleEBRestoreWithHIM","MAWJids","MAWJobDefinitions","MAWRestoreMessagesFromEncryptedBackupsDeferred","Promise","WAJids","WALogger","WATagsLogger","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["LSRestoreEchoBlobs error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["LSRestoreEchoBlobs error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring Messenger DYI batch"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreEchoBlobs - no messages returned but hasMoreBefore is true"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreEchoBlobs - Failed to decode echo message, with error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreEchoBlobs - "," "," ",""]);p=function(){return a};return a}a=function(a,e,f,g,q,r,s,t,u,v,w,x,y){try{if(w!=null){d("WATagsLogger").TAGS(["labyrinth_web","echo_restore",(a=w)!=null?a:"no_request_id"]).LOG(p(),w,v,(e=x)!=null?e:"");d("MAWEBRestoreTrackingUtils").markEBRestoreEcho(y);f=c("LSVec").toArray(g);d("MAWEBRestoreTrackingUtils").addQPLRestorePoint("native_op_run_echo",y,w,"echo");d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryIfPresent(w,{hasMoreAfter:s,hasMoreBefore:q,messages:f.map(function(a){try{a=d("EchoMessage").decodeEchoMessage(a);if(a==null)return null;var b=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());b=d("MAWHandleEBRestoreWithHIM").convertEchoMessage(a,d("WAJids").unsafeCoerceToChatJid("threadId"+d("WAJids").MSGR_USER_DOMAIN),b);if(b==null||b.length===0)return null;b=(b=b[0].decodedMsg)==null?void 0:b.unstoredDbMsg;if(b==null)return null;b.sortOrderMs=a.sortOrderMs;return b}catch(b){d("WATagsLogger").TAGS(["labyrinth_web","echo_restore",(a=w)!=null?a:"no_request_id"]).ERROR(o(),b.message);return null}}).filter(Boolean),nextMessageTimestampMsBefore:r,restoreType:"echo"})}a=c("LSVec").toArray(g);d("MAWEncryptedBackupUtils").logIfDuplicateMessagesFoundInRestore(a,"echo_restore");if(q===!0&&a.length===0){d("WATagsLogger").TAGS(["labyrinth_web","echo_restore",(e=w)!=null?e:"no_request_id"]).ERROR(n())}f=y!=null&&(j||(j=d("LSIntEnum"))).toNumber(y)===c("LSMEBTaskCreationSource").BULK_QUERY_FOR_SEARCH_RESULT;if(f)return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])]);g=y!=null&&(j||(j=d("LSIntEnum"))).toNumber(y)===c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB;if(g)return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])]);e=y!=null&&(j||(j=d("LSIntEnum"))).toNumber(y)===c("LSMEBTaskCreationSource").MSGR_DYI;f=c("gkx")("3057");if(e&&f){d("WATagsLogger").TAGS(["labyrinth_web","echo_restore",(g=w)!=null?g:"no_request_id"]).LOG(m());e=a.map(d("EchoMessage").decodeEchoMessage).filter(Boolean);void d("MAWEncryptedBackupsDYIHandleMessageRestore").handleMAWEchoMessageRangeQueryRestore(v,e,q,r);return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])}c("promiseDone")(d("MAWRestoreMessagesFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(v),a.map(d("MAWJobDefinitions").toEncodedEchoMessage),q,r==null?void 0:(i||(i=d("I64"))).to_int32(r),s,t==null?void 0:(i||(i=d("I64"))).to_int32(t),u,w,x,y!=null?(j||(j=d("LSIntEnum"))).unwrapIntEnum(y):-1)["catch"](function(a){d("WALogger").ERROR(l(),a)}));return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])}catch(a){d("WALogger").ERROR(k(),a);w!=null&&d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(w,a);return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])}};g["default"]=a}),98);
__d("LSHandleMessageRestoreResponse",["LSArrayGetObjectAt","LSDecryptMessages","LSDeleteBackupOnClient","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSIssuePointQueryRestoreTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop","LSLogWebQpl.nop","LSRestoreEchoBlobs.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][handleMessageRestoreResponse] Beginning execution."),d[1]=c.i64.of_float(Date.now()),a[7]?(d[11]="handleMessageRestoreResponse was called with instructions to delete the user's EB client state",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ","",d[11]].join("")),d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[11]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(e){return d[2]=a[5].get("request_id"),a[5],d[3]=c.i64.of_int32(a[0].length),d[2]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[2],c.i64.cast([0,521476165]),"call_from_client",d[3],void 0):c.resolve()},function(b){return c.i64.neq(a[6],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b,e){var f=b.done;b=b.value;return f?d[11]=!1:(e=b.item,d[14]=e.deviceId,c.i64.neq(d[14],void 0)?d[13]=c.i64.neq(d[14],a[6]):d[13]=!1,d[11]=d[13])})},function(a){return d[4]=d[11]}]):c.resolve(d[4]=!1)},function(e){return d[4]?(d[11]="Exiting early due to EBDevice ID mismatch",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ","",d[11]].join("")),d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[11]].join(""),d[12],c.i64.cast([0,4]))):c.sequence([function(b){return d[11]=a[5].get("reference_timestamp"),a[5],d[12]=a[5].get("request_id"),a[5],d[13]=a[5].get("restore_task_source"),a[5],c.i64.neq(a[6],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b,e){var f=b.done;b=b.value;return f?d[20]=!1:(e=b.item,d[23]=e.deviceId,c.i64.neq(d[23],void 0)?d[22]=c.i64.neq(d[23],a[6]):d[22]=!1,d[20]=d[22])})},function(a){return d[14]=d[20]}]):c.resolve(d[14]=!1)},function(e){return d[14]?c.resolve((d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,110])),d[20].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[20].set("error_message",""),d[15]=d[20])):c.sequence([function(e){return d[20]=c.i64.of_int32(a[0].length),d[12]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[12],c.i64.cast([0,521476165]),"decryption_start",d[20],d[13]):c.resolve()},function(e){return c.storedProcedure(b("LSDecryptMessages"),a[0],a[2]).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(e){return d[21]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[2]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(e){return c.i64.neq(d[24],void 0)?c.sequence([function(e){return d[27]=c.i64.of_int32(a[0].length),d[12]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[12],c.i64.cast([0,521476165]),"decryption_success",d[27],d[13]):c.resolve()},function(e){return void 0!==void 0?c.resolve(d[28]=void 0):c.sequence([function(a){return d[29]=c.createArray(),d[30]=c.i64.of_int32(d[21].length),c.i64.gt(d[30],c.i64.cast([0,0]))?c.loopAsync(d[30],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=d[40].get("value"),d[40],d[43]=(d[29].push(d[42]),d[29])}])}):c.resolve()},function(e){return d[31]=a[1].get("has_more_before"),a[1],d[32]=a[1].get("next_message_timestamp_ms_before"),a[1],d[33]=a[1].get("has_more_after"),a[1],d[34]=a[1].get("next_message_timestamp_ms_after"),a[1],c.nativeOperation(b("LSRestoreEchoBlobs.nop"),d[24],d[29],d[31],d[32],d[33],d[34],a[4],a[2],d[12],d[11],d[13]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],d[37]=a[2],a})},function(e){return a[7]?c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[12],void 0,!0):c.resolve()},function(e){return d[35]?c.sequence([function(e){return d[39]=c.i64.of_int32(d[37].length),d[40]=c.i64.of_int32(d[36].length),c.i64.eq(d[40],d[39])?c.sequence([function(e){return d[42]=c.i64.cast([0,0]),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(e){return d[44]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],d[42]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(e){return c.storedProcedure(b("LSIssuePointQueryRestoreTask"),a[2],d[47],d[45],void 0,c.i64.cast([0,35])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[42]=c.i64.add(d[42],c.i64.cast([0,1]))}])}):c.resolve()},function(a){return d[41]=void 0}]):c.resolve((d[42]=new c.Map(),d[42].set("error_code",c.i64.cast([0,106])),d[42].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[42].set("error_message",""),d[41]=d[42]))},function(a){return d[38]=void 0}]):c.resolve((d[39]=new c.Map(),d[39].set("error_code",c.i64.cast([0,105])),d[39].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[39].set("error_message",""),d[38]=d[39]))},function(a){return d[28]=d[38]}])},function(a){return d[26]=d[28]}]):c.resolve(d[26]=d[25])},function(a){return d[23]=d[26]}]):c.resolve((d[22]!==void 0?(d[24]=d[22].get("error_code"),d[22],c.i64.eq(d[24],c.i64.cast([0,1]))?0:0):0,d[23]=d[22]))},function(a){return d[15]=d[23]}])},function(e){return d[15]!==void 0?c.sequence([function(e){return d[20]=c.i64.of_int32(a[0].length),d[12]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[12],c.i64.cast([0,521476165]),"decryption_fail",d[20],d[13]):c.resolve()},function(e){return a[7]?c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[12],void 0,!0):c.resolve()},function(e){return d[21]=d[15].get("error_code"),d[15],d[22]=d[15].get("stored_procedure"),d[15],d[23]=a[5].get("restore_operation_type"),a[5],d[24]=d[15].get("error_message"),d[15],c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?d[25]=void 0:(e=a.item,c.sequence([function(a){return d[45]=e.deviceId,d[44]=e.backupTenancy,d[43]=e.encryptionVersion,d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[56]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[56]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[56]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[56]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[51].push(d[57]),d[51])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=(d[56].push(c.i64.to_string(d[60])),d[56])}])}):c.resolve()},function(a){return d[58]=d[56].join(","),d[53]=d[58]}])},function(a){return d[51].some(function(a){return c.i64.eq(d[43],a)})?d[54]=d[43]:d[54]=void 0,c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=void 0,d[39]=d[55]}])},function(a){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[44],void 0)?d[41]=d[44]:d[41]=c.i64.cast([0,1]),c.i64.neq(d[45],void 0)?d[42]=d[45]:d[42]=void 0,d[25]=d[42]}]))})},function(e){return d[27]=new c.Map(),d[27].set("error_code",d[21]),d[27].set("error_message",d[24]==null?"":d[24]),d[27].set("stored_procedure",d[22]),d[28]=new c.Map(),d[28].set("act_thread_id",a[2]),d[28].set("source",d[13]),d[28].set("restore_operation_type",d[23]),d[28].set("request_id",d[12]),d[28].set("device_id",d[25]),d[29]=new c.Map(),d[29].set("restore_context",d[28]),d[29].set("failure",d[27]),d[30]=d[29].get("restore_context"),d[29],d[31]=d[30].get("act_thread_id"),d[30],d[32]=c.toJSON(d[29]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[31]].join(""),c.i64.cast([0,50030]),d[32],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[33]=a[0],a})},function(b){return d[34]=a[5].get("restore_operation_type"),a[5],d[35]=d[15].get("error_code"),d[15],d[36]=d[15].get("error_code"),d[15],d[37]=" ",d[16]=["Failed (",d[37],c.i64.to_string(d[36]),d[37],")"].join("")}]):c.resolve((d[20]=a[5].get("restore_operation_type"),a[5],d[16]="Succeeded"))},function(e){return d[17]="",d[18]=["Message Restore Status: ",d[17],d[16],d[17],". ACT Thread ID: ",d[17],a[2]].join(""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ","",d[18]].join("")),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[18]].join(""),d[19],c.i64.cast([0,4]))}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure";e.exports=a}),null);/*FB_PKG_DELIM*/
__d("WAGetSenderKeyStatusApi",["MAWDexieTable","MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"getSenderKeyStatus",function(a){return function(b){return a.personalSenderKeyStatuses.get(b).then(function(c){c!=null?c=d("MAWDexieTable").dexieResolve(c):c=d("WADbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus(a,b);return c.then(function(a){var b=a.hasSenderKey,c=a.rotateSenderKey,d=a.senderKeyId;a=a.senderKeyTs;return{hasSenderKey:b,rotateSenderKey:c,senderKeyId:d,ts:a}})})}});g.getSenderKeyStatus=a}),98);
__d("WAGetUserDevices",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(c.storage.bulkLoadIdentities(a));case 2:d=e.sent;return e.abrupt("return",Array.from(d).flatMap(function(a){a=a[1];return Array.from(a.keys())}));case 4:case"end":return e.stop()}},null,this)}f.getUserDevices=a}),66);
__d("WAMarkSenderKeyAsRotatedApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"markSEnderKeyAsRotated",function(a){return function(b,c,e){return d("WADbPersonalSenderKeyStatusTxns").updateSenderKeyStatusAsRotated(a,b,c,e).then(function(){})}});g.markSenderKeyAsRotated=a}),98);
__d("WAEncGroupMsg",["WAAsMessageTransport","WACryptoManager","WACryptoManagerUtils","WAEncUserMsg","WAGetSenderKeyStatusApi","WAGetUserDevices","WAGlobals","WAHex","WALogger","WAMarkSenderKeyAsRotatedApi","WAMsgTransport.pb","WAPhash","WAPromiseQueue","WAProtocolMediaType","WASortedLists","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - end key distribution"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - start key distribution"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Encrypt success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish encrypt group content"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish group fanout msg "]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish rotate participant info "]);m=function(){return a};return a}var n=30*d("WATimeUtils").DAY_SECONDS,o=new(d("WAPromiseQueue").PromiseQueue)();function p(a,c,e,f){return o.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WAGetSenderKeyStatusApi").getSenderKeyStatus(a)),g=b.ts,h=b.rotateSenderKey,i=b.hasSenderKey;b=b.senderKeyId;h=b==null||h||!d("WATimeUtils").happenedWithin(g,n);g=(yield d("WAGetUserDevices").getUserDevices(c,e.cryptoManager));var j=new Set(g);if(h||b==null){h=(yield d("WACryptoManager").rotateGroupSenderKey(e.cryptoManager,a,d("WAGlobals").getMyDeviceJid()));b=h.senderKeyId;yield d("WAMarkSenderKeyAsRotatedApi").markSenderKeyAsRotated(a,b,d("WATimeUtils").unixTime());f==null?void 0:f.addPoint("finish_sk_rotation")}else(i||[]).forEach(function(a){return j["delete"](a)}),f==null?void 0:f.addPoint("no_sk_rotation",{"int":{noRotationNeedsSK:j.size}});return{senderKeyId:b,needsSenderKey:j,groupParticipants:new Set(g)}}))}function a(a,b,c,d,e,f){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){g==null?void 0:g.addPoint("enc_group_start");var n=(yield p(a,b.map(function(a){return a.user}),f,g)),o=n.senderKeyId,q=n.needsSenderKey;n=n.groupParticipants;d("WALogger").LOG(m());g==null?void 0:g.addPoint("rotated_participant_info");var s=null,t,u;b=b.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});n["delete"](d("WAGlobals").getMyDeviceJid());var v=!d("WASortedLists").areEqual(d("WASortedLists").asSortedSet(n),d("WASortedLists").sortAndDedupe(b)),w=e.type==="text"&&e.isRevoked,x=e.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(e.mediaType):null;if(v||w){v=(yield d("WAEncUserMsg").encryptGroupFanoutMsg(b,{type:"message",messageBytes:c,messageType:e,chat:a},f));v&&!(e.type==="text"&&e.isInvisible===!0)&&(t=v,u={encType:"group",to:a,v:c.version==="v3"?"3":"2",type:"skmsg",mediaType:x,ciphertext:null});d("WALogger").LOG(l());g==null?void 0:g.addPoint("finish_group_fanout_msg")}else{if(c.version==="v3"){w=d("WAAsMessageTransport").asMessageTransport(c.bytes);v=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,w).readByteArray()}else v=c.bytes;w=(yield d("WACryptoManagerUtils").encryptGroupContentWithMetrics(a,v,f));d("WALogger").LOG(k());g==null?void 0:g.addPoint("finish_encrypt_group_content");if(w.success){d("WALogger").LOG(j());v=w.value;o!==v.senderKeyId&&n.forEach(function(a){return q.add(a)});if(q.size>0){w={groupId:a,axolotlSenderKeyDistributionMessage:d("WAHex").bytesToBuffer(v.senderKeyDistributionProto)};d("WALogger").LOG(i());o=b.filter(function(a){return q.has(a)});n=(yield r(o,w,f));d("WALogger").LOG(h());g==null?void 0:g.addPoint("finish_skdm_enc_node");n.length>0&&(t=n,s={group:a,senderKeyId:v.senderKeyId,knowsSenderKey:new Set(o)})}u={encType:"group",to:a,v:c.version==="v2"?"2":"3",type:v.ciphertext.type,mediaType:x,ciphertext:v.ciphertext.ciphertext};e.type==="text"&&e.isInvisible===!0&&(u={encType:"group",to:a,v:c.version==="v2"?"2":"3",type:"skmsg",mediaType:null,ciphertext:null})}}w=(yield d("WAPhash").calculatePHash(b.concat(d("WAGlobals").getMyDeviceJid())));g==null?void 0:g.addPoint("phash_finish");return{phash:w,participants:t,encNode:u,senderKeyDistributionInfo:s}});return q.apply(this,arguments)}function r(a,b,c){b=d("WAAsMessageTransport").asMessageTransport(null,null,b,null);var e=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArray();return d("WACryptoManagerUtils").bulkEncrypt(new Map(a.map(function(a){return[a,{plaintext:e}]})),c).then(function(a){var b=[];a.forEach(function(a,c){b.push({encType:"device",to:c,v:"3",type:a.type,ciphertext:a.ciphertext,mediaType:null,count:null,baseKey:null})});return b})}g.encryptGroupMsg=a}),98);
__d("WAGetDeviceIdentityMixin",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a!=null?{deviceIdentityElementValue:a}:null}f.getDeviceIdentityMixin=a}),66);
__d("WALoadReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READONLY},"loadReceipt",function(a){return function(b){var c=d("WAMsg").craftWAMsgIdString(b);return a.receipts.get({waMsgId:c}).then(function(a){var c;return a==null?d("WAResultOrError").makeError("missing-receipt"):d("WAResultOrError").makeResult({id:b,permittedIdentitiesPerDevice:(c=a.permittedIdentitiesPerDevice)!=null?c:new Map(),recipientDevices:a.recipientDevices})})}});g.loadReceipt=a}),98);
__d("WAMarkSenderKeyAsSentApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"markSenderKeyAsSent",function(a){return function(b,c,d){return a.personalSenderKeyStatuses.get(b).then(function(b){if(b==null)return;if(b.senderKeyId!=c)return;d.forEach(function(a){b.hasSenderKey.add(a)});return a.personalSenderKeyStatuses.put(b).then(function(){})})}});g.markSenderKeyAsSent=a}),98);
__d("WAParseFranking",["WAFranking","WAFrankingTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;if(a==null)return null;b=(b=a.maybeChild("franking_tag"))==null?void 0:b.contentBytes();return{frankingKey:null,frankingTag:b!=null?d("WAFrankingTypes").castToFrankingTag(b):null,reportingTag:(b=a.maybeChild("reporting_tag"))==null?void 0:b.contentBytes(),frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null}}g.parseFrankingNode=a}),98);
__d("WASmaxInMessagePublishAckAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","3");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminEditMixin=a}),98);
__d("WASmaxInMessagePublishAckAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","8");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminRevokeMixin=a}),98);
__d("WASmaxInMessagePublishAckMessageEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","1");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessageEditMixin=a}),98);
__d("WASmaxInMessagePublishAckMessagePinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","2");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessagePinMixin=a}),98);
__d("WASmaxInMessagePublishEnums",[],(function(a,b,c,d,e,f){a={CBP:"CBP",NBP:"NBP"};b={delivery:"delivery",no_optimization:"no_optimization"};c={"false":"false","true":"true"};d={lid:"lid",pn:"pn"};f.ENUM_CBP_NBP=a;f.ENUM_DELIVERY_NOOPTIMIZATION=b;f.ENUM_FALSE_TRUE=c;f.ENUM_LID_PN=d}),66);
__d("WASmaxInMessagePublishAckPaidConversationMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"delivery_context");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"optimization_goal",d("WASmaxInMessagePublishEnums").ENUM_DELIVERY_NOOPTIMIZATION);return!b.success?b:d("WAResultOrError").makeResult({optimizationGoal:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"source_url");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"referral");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"source_url",i);if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"source_type");return!a.success?a:d("WAResultOrError").makeResult({sourceType:a.value,sourceUrl:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"origin");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"referral",j);if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"type");return!a.success?a:d("WAResultOrError").makeResult({type:a.value,referral:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"biz");if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(b.value,"delivery_context",h);if(!a.success)return a;var c=d("WASmaxParseUtils").optionalChildWithTag(b.value,"origin",k);if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"paid_convo_id");if(!e.success)return e;var f=d("WASmaxParseUtils").attrStringEnum(b.value,"pricing_model",d("WASmaxInMessagePublishEnums").ENUM_CBP_NBP);if(!f.success)return f;var g=d("WASmaxParseUtils").attrStringEnum(b.value,"billable",d("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);if(!g.success)return g;var i=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"expiration_timestamp",0,void 0);if(!i.success)return i;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"pricing_category");return!b.success?b:d("WAResultOrError").makeResult({bizPaidConvoId:e.value,bizPricingModel:f.value,bizBillable:g.value,bizExpirationTimestamp:i.value,bizPricingCategory:b.value,bizDeliveryContext:a.value,bizOrigin:c.value})}g.parseAckPaidConversationBizDeliveryContext=h;g.parseAckPaidConversationBizOriginReferralSourceUrl=i;g.parseAckPaidConversationBizOriginReferral=j;g.parseAckPaidConversationBizOrigin=k;g.parseAckPaidConversationMixin=a}),98);
__d("WASmaxInMessagePublishAckRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","7");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckRevokeMixin=a}),98);
__d("WASmaxInMessagePublishServerFrankingTagMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"franking");if(!a.success)return a;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"reporting_tag");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,16,128);return!a.success?a:d("WAResultOrError").makeResult({frankingReportingTagElementValue:a.value})}g.parseServerFrankingTagMixin=a}),98);
__d("WASmaxInMessagePublishAckMixin",["WAResultOrError","WASmaxInMessagePublishAckAdminEditMixin","WASmaxInMessagePublishAckAdminRevokeMixin","WASmaxInMessagePublishAckMessageEditMixin","WASmaxInMessagePublishAckMessagePinMixin","WASmaxInMessagePublishAckPaidConversationMixin","WASmaxInMessagePublishAckRevokeMixin","WASmaxInMessagePublishServerFrankingTagMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","message");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var e=d("WASmaxInMessagePublishAckMessageEditMixin").parseAckMessageEditMixin(a),f=d("WASmaxInMessagePublishAckAdminEditMixin").parseAckAdminEditMixin(a),g=d("WASmaxInMessagePublishAckMessagePinMixin").parseAckMessagePinMixin(a),h=d("WASmaxInMessagePublishAckAdminRevokeMixin").parseAckAdminRevokeMixin(a),i=d("WASmaxInMessagePublishAckRevokeMixin").parseAckRevokeMixin(a),j=d("WASmaxInMessagePublishAckPaidConversationMixin").parseAckPaidConversationMixin(a);a=d("WASmaxInMessagePublishServerFrankingTagMixin").parseServerFrankingTagMixin(a);return d("WAResultOrError").makeResult({"class":c.value,t:b.value,ackMessageEditMixin:e.success?e.value:null,ackAdminEditMixin:f.success?f.value:null,ackMessagePinMixin:g.success?g.value:null,ackAdminRevokeMixin:h.success?h.value:null,ackRevokeMixin:i.success?i.value:null,ackPaidConversationMixin:j.success?j.value:null,serverFrankingTagMixin:a.success?a.value:null})}g.parseAckMixin=a}),98);
__d("WASmaxInMessagePublishApplicationNegativeAckMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"application_error",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({applicationError:b.value})}g.parseApplicationNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishMessageNackRetryAttributesMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"backoff",0,86400);return!b.success?b:d("WAResultOrError").makeResult({backoff:b.value})}g.parseMessageNackRetryAttributesMixin=a}),98);
__d("WASmaxInMessagePublishNegativeAckMixin",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishApplicationNegativeAckMixin","WASmaxInMessagePublishMessageNackRetryAttributesMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var e=d("WASmaxInMessagePublishApplicationNegativeAckMixin").parseApplicationNegativeAckMixin(a);a=d("WASmaxInMessagePublishMessageNackRetryAttributesMixin").parseMessageNackRetryAttributesMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},b.value,{applicationNegativeAckMixin:e.success?e.value:null,messageNackRetryAttributesMixin:a.success?a.value:null}))}g.parseNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseNegative",["WAResultOrError","WASmaxInMessagePublishNegativeAckMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;a=d("WASmaxInMessagePublishNegativeAckMixin").parseNegativeAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value},a.value))}g.parseIndividualResponseNegative=a}),98);
__d("WASmaxInMessagePublishAckRcatMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"rcat");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytes(b.value);return!a.success?a:d("WAResultOrError").makeResult({rcatElementValue:a.value})}g.parseAckRcatMixin=a}),98);
__d("WASmaxInMessagePublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseSuccess",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishAckRcatMixin","WASmaxInMessagePublishDeviceListStaleMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!e.success)return e;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var f=d("WASmaxInMessagePublishDeviceListStaleMixin").parseDeviceListStaleMixin(a);a=d("WASmaxInMessagePublishAckRcatMixin").parseAckRcatMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value,participant:e.value},b.value,{deviceListStaleMixin:f.success?f.value:null,ackRcatMixin:a.success?a.value:null}))}g.parseIndividualResponseSuccess=a}),98);
__d("WASmaxOutMessagePublishAutomatedMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("automated",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAutomatedMixin=a}),98);
__d("WASmaxOutMessagePublishAuthMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.authVerificationTimestamp;a=a.authEnableRiskCheck;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("auth",{verification_timestamp:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b),enable_risk_check:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAuthMixin=a}),98);
__d("WASmaxOutMessagePublishBizAcceptTsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAcceptTs;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{accept_ts:d("WAWap").INT(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAcceptTsMixin=a}),98);
__d("WASmaxOutMessagePublishBizAutoResponseMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAutoResponse;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{auto_response:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAutoResponseMixin=a}),98);
__d("WASmaxOutMessagePublishBizCampaignMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizCampaignId;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{campaign_id:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizCampaignMixin=a}),98);
__d("WASmaxOutMessagePublishBizMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.metadataAppOwner,f=a.metadataCsidBm,g=a.metadataPaymentBm;a=a.metadataCustomerCategory;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("metadata",{app_owner:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),csid_bm:b.OPTIONAL(c.CUSTOM_STRING,f),payment_bm:b.OPTIONAL(c.CUSTOM_STRING,g),customer_category:b.OPTIONAL(c.CUSTOM_STRING,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishBizRolesMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizHostStorage,c=a.bizActualActors;a=a.bizPrivacyModeTs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{host_storage:d("WAWap").INT(b),actual_actors:d("WAWap").INT(c),privacy_mode_ts:d("WAWap").INT(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizRolesMixin=a}),98);
__d("WASmaxOutMessagePublishButtonsMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("buttons",null)));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeButtonsMixin=a}),98);
__d("WASmaxOutMessagePublishExtensionsMetadataMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.capabilityArgs;a=d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").REPEATED_CHILD(i,a,1,50));return a}function i(a){a=a.capabilityName;a=d("WASmaxJsx").smax("capability",{name:d("WAWap").CUSTOM_STRING(a)});return a}function j(a){var b=a.capabilitiesArgs,c=a.extensionsMetadataWellVersion,e=a.extensionsMetadataDataApiVersion;a=a.extensionsMetadataFlowMessageVersion;c=d("WASmaxJsx").smax("native_flow",null,d("WASmaxJsx").smax("extensions_metadata",{well_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),data_api_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),flow_message_version:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)));return c}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeExtensionsMetadataExtensionsMetadataCapabilities=h;g.makeExtensionsMetadataExtensionsMetadataCapabilitiesCapability=i;g.mergeExtensionsMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishExtensionsMetadataMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.nativeFlowName,c=a.nativeFlowV;a=a.extensionsMetadataMixinArgs;b=d("WASmaxJsx").smax("interactive",{type:"native_flow"},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishExtensionsMetadataMixin").mergeExtensionsMetadataMixin,d("WASmaxJsx").smax("native_flow",{name:d("WAWap").CUSTOM_STRING(b),v:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c)}),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishInteractiveMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishNativeFlowMessageTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.hasInteractiveV1;a=a.nativeFlowMessageTypeMixinArgs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin").mergeNativeFlowMessageTypeMixin(d("WASmaxJsx").smax("interactive",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",b)}),a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInteractiveMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizNativeFlowName;a=a.bizNativeFlowVersion;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{native_flow_name:d("WAWap").CUSTOM_STRING(b),native_flow_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMixin=a}),98);
__d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishButtonsMixin","WASmaxOutMessagePublishInteractiveMixin","WASmaxOutMessagePublishNativeFlowMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isButtons)return d("WASmaxOutMessagePublishButtonsMixin").mergeButtonsMixin(a);if(b.nativeFlow)return d("WASmaxOutMessagePublishNativeFlowMixin").mergeNativeFlowMixin(a,b.nativeFlow);if(b.interactive)return d("WASmaxOutMessagePublishInteractiveMixin").mergeInteractiveMixin(a,b.interactive);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeButtonsOrNativeFlowOrInteractiveMixinGroup=a}),98);
__d("WASmaxOutMessagePublishConversionRecipientStatusMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.conversionRecipientStatus;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("conversion",{recipient_status:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeConversionRecipientStatusMixin=a}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.sourceUrlElementValue;a=d("WASmaxJsx").smax("source_url",null,a);return a}function i(a){var b,c,e=a.sourceUrlArgs,f=a.ctwaConversionSource,g=a.ctwaConversionData,i=a.ctwaSourceType,j=a.ctwaEntryPointConversionSource;a=a.ctwaEntryPointConversionApp;f=d("WASmaxJsx").smax("ctwa",{conversion_source:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),conversion_data:b.OPTIONAL(c.CUSTOM_STRING,g),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),entry_point_conversion_source:b.OPTIONAL(c.CUSTOM_STRING,j),entry_point_conversion_app:b.OPTIONAL(c.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,e));return f}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeClickToWhatsAppTypeSourceUrl=h;g.mergeClickToWhatsAppTypeMixin=a}),98);
__d("WASmaxOutMessagePublishCtwaConversionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin").mergeClickToWhatsAppTypeMixin(d("WASmaxJsx").smax("ctwa",null),a);return a}function i(a){a=a.ctwaArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCtwaConversionCtwa=h;g.mergeCtwaConversionMixin=a}),98);
__d("WASmaxOutMessagePublishDeliveryContextMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.deliveryContextHsmMaxBid,f=a.deliveryContextOptimizationGoal,g=a.deliveryContextTemplateId,h=a.deliveryContextCampaignId,i=a.deliveryContextSourceType,j=a.deliveryContextTierType,k=a.deliveryContextDeliveryType,l=a.deliveryContextClientToken;a=a.deliveryContextPrice;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("delivery_context",{hsm_max_bid:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).INT,e),optimization_goal:b.OPTIONAL(c.CUSTOM_STRING,f),template_id:b.OPTIONAL(c.CUSTOM_STRING,g),campaign_id:b.OPTIONAL(c.CUSTOM_STRING,h),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),tier_type:b.OPTIONAL(c.CUSTOM_STRING,j),delivery_type:b.OPTIONAL(c.CUSTOM_STRING,k),client_token:b.OPTIONAL(c.CUSTOM_STRING,l),price:b.OPTIONAL(c.INT,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeliveryContextMixin=a}),98);
__d("WASmaxOutMessagePublishCapabilitiesMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasFeatureV1;a=d("WASmaxJsx").smax("feature",{name:"full_catalog",v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",a)});return a}function i(a){a=a.featureArgs;a=d("WASmaxJsx").smax("hsm",null,d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCapabilitiesCapabilitiesFeature=h;g.mergeCapabilitiesMixin=a}),98);
__d("WASmaxOutMessagePublishHSMReviewMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.anyCategory,f=a.anyTag,g=a.anyId;a=a.anySubTag;e=d("WASmaxJsx").smax("smax$any",{category:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),tag:b.OPTIONAL(c.CUSTOM_STRING,f),id:b.OPTIONAL(c.CUSTOM_STRING,g),sub_tag:b.OPTIONAL(c.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHSMReviewMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishHsmMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishCapabilitiesMixin","WASmaxOutMessagePublishHSMReviewMetadataMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageTtl,c=a.hasHsmV1,e=a.hasHsmButtons1,f=a.hSMReviewMetadataMixinArgs;a=a.capabilitiesMixinArgs;b=d("WASmaxJsx").smax("message",{ttl:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishCapabilitiesMixin").mergeCapabilitiesMixin,d("WASmaxOutMessagePublishHSMReviewMetadataMixin").mergeHSMReviewMetadataMixin(d("WASmaxJsx").smax("hsm",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",c),buttons:d("WASmaxAttrs").OPTIONAL_LITERAL("1",e)}),f),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHsmMixin=a}),98);
__d("WASmaxOutMessagePublishBizMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAuthMixin","WASmaxOutMessagePublishBizAcceptTsMixin","WASmaxOutMessagePublishBizAutoResponseMixin","WASmaxOutMessagePublishBizCampaignMixin","WASmaxOutMessagePublishBizMetadataMixin","WASmaxOutMessagePublishBizRolesMixin","WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup","WASmaxOutMessagePublishConversionRecipientStatusMixin","WASmaxOutMessagePublishCtwaConversionMixin","WASmaxOutMessagePublishDeliveryContextMixin","WASmaxOutMessagePublishHsmMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.hsmMixinArgs,e=a.bizRolesMixinArgs,f=a.bizAutoResponseMixinArgs,g=a.bizAcceptTsMixinArgs,h=a.bizCampaignMixinArgs,i=a.deliveryContextMixinArgs,j=a.authMixinArgs,k=a.conversionRecipientStatusMixinArgs,l=a.ctwaConversionMixinArgs,m=a.bizMetadataMixinArgs;a=a.buttonsOrNativeFlowOrInteractiveMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup").mergeButtonsOrNativeFlowOrInteractiveMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishBizMetadataMixin").mergeBizMetadataMixin,b.optionalMerge(d("WASmaxOutMessagePublishCtwaConversionMixin").mergeCtwaConversionMixin,b.optionalMerge(d("WASmaxOutMessagePublishConversionRecipientStatusMixin").mergeConversionRecipientStatusMixin,b.optionalMerge(d("WASmaxOutMessagePublishAuthMixin").mergeAuthMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeliveryContextMixin").mergeDeliveryContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizCampaignMixin").mergeBizCampaignMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAcceptTsMixin").mergeBizAcceptTsMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAutoResponseMixin").mergeBizAutoResponseMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizRolesMixin").mergeBizRolesMixin,b.optionalMerge(d("WASmaxOutMessagePublishHsmMixin").mergeHsmMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMixin=a}),98);
__d("WASmaxOutMessagePublishClientFrankingTagMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.frankingTagElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("franking",null,d("WASmaxJsx").smax("franking_tag",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientFrankingTagMixin=a}),98);
__d("WASmaxOutMessagePublishClientReportingTokenMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.reportingTokenElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("reporting",null,d("WASmaxJsx").smax("reporting_token",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientReportingTokenMixin=a}),98);
__d("WASmaxOutMessagePublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutMessagePublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutMessagePublishLIDSessionDeprecationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaDeprecatedLidSession;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{deprecated_lid_session:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLIDSessionDeprecationMixin=a}),98);
__d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("meta",{"decrypt-fail":"hide"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMetaHideDecryptionPlaceholderMixin=a}),98);
__d("WASmaxOutMessagePublishMulticastMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("multicast",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMulticastMixin=a}),98);
__d("WASmaxOutMessagePublishNoExtraFanoutMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{device_fanout:"false"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNoExtraFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledNumberMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_number",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledNumberMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_text",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledTextMixin=a}),98);
__d("WASmaxOutMessagePublishSenderIntentMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{sender_intent:"hosted"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderIntentMixin=a}),98);
__d("WASmaxOutMessagePublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutMessagePublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.edgeIdArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRequestIDMixin","WASmaxOutMessagePublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutMessagePublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutMessagePublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutMessagePublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutMessagePublishVerifiedNameNameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageVerifiedName;a=d("WASmaxJsx").smax("message",{verified_name:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameNameMixin=a}),98);
__d("WASmaxOutMessagePublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAutomatedMixin","WASmaxOutMessagePublishBizMixin","WASmaxOutMessagePublishClientFrankingTagMixin","WASmaxOutMessagePublishClientReportingTokenMixin","WASmaxOutMessagePublishDeviceIdentityMixin","WASmaxOutMessagePublishInternalTestMixin","WASmaxOutMessagePublishLIDSessionDeprecationMixin","WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin","WASmaxOutMessagePublishMulticastMixin","WASmaxOutMessagePublishNoExtraFanoutMixin","WASmaxOutMessagePublishPreFilledNumberMixin","WASmaxOutMessagePublishPreFilledTextMixin","WASmaxOutMessagePublishSenderIntentMixin","WASmaxOutMessagePublishTraceContextMixin","WASmaxOutMessagePublishVerifiedNameNameMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.hasNoExtraFanout,f=a.hasMulticast,g=a.hasPreFilledText,h=a.hasPreFilledNumber,i=a.hasAutomated,j=a.bizMixinArgs,k=a.verifiedNameNameMixinArgs,l=a.clientFrankingTagMixinArgs,m=a.clientReportingTokenMixinArgs,n=a.internalTestMixinArgs,o=a.hasMetaHideDecryptionPlaceholder,p=a.traceContextMixinArgs,q=a.hasSenderIntent;a=a.lIDSessionDeprecationMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishLIDSessionDeprecationMixin").mergeLIDSessionDeprecationMixin,b.optionalMerge(d("WASmaxOutMessagePublishSenderIntentMixin").mergeSenderIntentMixin,b.optionalMerge(d("WASmaxOutMessagePublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin").mergeMetaHideDecryptionPlaceholderMixin,b.optionalMerge(d("WASmaxOutMessagePublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientReportingTokenMixin").mergeClientReportingTokenMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientFrankingTagMixin").mergeClientFrankingTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishVerifiedNameNameMixin").mergeVerifiedNameNameMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizMixin").mergeBizMixin,b.optionalMerge(d("WASmaxOutMessagePublishAutomatedMixin").mergeAutomatedMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledNumberMixin").mergePreFilledNumberMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledTextMixin").mergePreFilledTextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMulticastMixin").mergeMulticastMixin,b.optionalMerge(d("WASmaxOutMessagePublishNoExtraFanoutMixin").mergeNoExtraFanoutMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),n),o),p),q),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutMessagePublishGroupInviteTargetMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaGroupInvite;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{group_invite:d("WAWap").GROUP_JID(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupInviteTargetMixin=a}),98);
__d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("bot",{type:"feedback"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotFeedbackMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutMessagePublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutMessagePublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion2Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.encVersionFutureproof)return d("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(a,b.encVersionFutureproof);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersion2OrFutureproofMixinGroup=a}),98);
__d("WASmaxOutMessagePublishMediaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encMediatype;a=d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotRequestMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encRetryMixinArgs,e=a.encTypeIndividualMixinArgs,f=a.mediaTypeMixinArgs;a=a.encVersion2OrFutureproofMixinGroupArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup").mergeEncVersion2OrFutureproofMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),c),e),f),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotRequestMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"media"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"text"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeTextMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeTextMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrMediaMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botLocalAutomatedType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{local_automated_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotLocalAutomatedTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotMessageTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botBizBot;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{biz_bot:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBusinessBotMessageMixin=a}),98);
__d("WASmaxOutMessagePublishProductListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"product_list"})));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeProductListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectListMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.listV;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"single_select",v:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSingleSelectListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishProductListMixin","WASmaxOutMessagePublishSingleSelectListMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.singleSelectList)return d("WASmaxOutMessagePublishSingleSelectListMixin").mergeSingleSelectListMixin(a,b.singleSelectList);if(b.isProductList)return d("WASmaxOutMessagePublishProductListMixin").mergeProductListMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeSingleSelectOrProductListMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeListFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"list"}));return a}function i(a){var b=a.toCount;a=a.singleSelectOrProductListMixinGroupArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD_COUNT(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeListFanoutParticipantsTo=h;g.mergeContentTypeListFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishLiveLocationModeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaLivelocMode;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{liveloc_mode:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLiveLocationModeMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return a}function i(a){var b=a.toArgs;a=a.liveLocationModeMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeLiveLocationFanoutDeprecatedParticipantsTo=h;g.mergeContentTypeLiveLocationFanoutDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WAWap").INT(a)}));return a}function i(a){var b=a.toArgs;a=a.liveLocationModeMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeLiveLocationFanoutParticipantsTo=h;g.mergeContentTypeLiveLocationFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMedianotifyMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"medianotify"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMedianotifyMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeMediaOrMedianotifyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishSenderContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.senderContentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("sender_content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutDeprecatedParticipantsTo=h;g.mergeContentTypeMediaFanoutDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutParticipantsTo=h;g.mergeContentTypeMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollCreationMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"creation"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollCreationMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollVoteMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"vote"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollVoteMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeReactionMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"reaction"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeReactionMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePayMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"pay"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePayMixin=a}),98);
__d("WASmaxOutMessagePublishPayNodeTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payType;a=d("WASmaxJsx").smax("pay",{type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayNodeTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBasePayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPayNodeTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCountry,c=a.payVersion,e=a.payIsFirstSend;b=d("WASmaxOutMessagePublishPayNodeTypeMixin").mergePayNodeTypeMixin(d("WASmaxJsx").smax("pay",{country:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),version:d("WAWap").INT(c),is_first_send:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,e)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBasePayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishLegacyAmountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCurrency;a=a.payAmount;b=d("WASmaxJsx").smax("pay",{currency:d("WAWap").CUSTOM_STRING(b),amount:d("WAWap").CUSTOM_STRING(a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLegacyAmountMixin=a}),98);
__d("WASmaxOutMessagePublishMoneyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.moneyValue,c=a.moneyOffset;a=a.moneyCurrency;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("money",{value:d("WAWap").CUSTOM_STRING(b),offset:d("WAWap").CUSTOM_STRING(c),currency:d("WAWap").CUSTOM_STRING(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMoneyMixin=a}),98);
__d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WASmaxOutMessagePublishLegacyAmountMixin","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("amount",null),a);return a}function i(a){var b=a.amountArgs,c=a.payCredentialId,e=a.payDeviceId,f=a.payRequestId,g=a.legacyAmountMixinArgs;c=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLegacyAmountMixin").mergeLegacyAmountMixin,d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{"credential-id":d("WAWap").CUSTOM_STRING(c),"device-id":d("WAWap").CUSTOM_STRING(e),"request-id":d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,f)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a),g);return c}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBaseIndividualPublishSendPayNodeAmount=h;g.mergeBaseIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishInstallmentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("due_amount",null),a);return a}function i(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("interest",null),a);return a}function j(a){var b=a.dueAmountArgs,c=a.interestArgs,e=a.installmentMaxCount;a=a.installmentSelectedCount;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("installment",{max_count:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),selected_count:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b),d("WASmaxChildren").OPTIONAL_CHILD(i,c)));return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeInstallmentInstallmentDueAmount=h;g.makeInstallmentInstallmentInterest=i;g.mergeInstallmentMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiaryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.beneficiaryName,e=a.beneficiaryAddressLine1,f=a.beneficiaryAddressLine2,g=a.beneficiaryCity,h=a.beneficiaryState,i=a.beneficiaryCountry;a=a.beneficiaryPostalCode;c=d("WASmaxJsx").smax("beneficiary",{name:(b=d("WAWap")).CUSTOM_STRING(c),address_line1:b.CUSTOM_STRING(e),address_line2:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,f),city:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,g),state:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,h),country:b.CUSTOM_STRING(i),postal_code:b.CUSTOM_STRING(a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBeneficiaryMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiariesMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiaryMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiaryMixin").mergeBeneficiaryMixin(d("WASmaxJsx").smax("beneficiary",null),a);return a}function i(a){a=a.beneficiaryArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,5));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBeneficiariesBeneficiary=h;g.mergeBeneficiariesMixin=a}),98);
__d("WASmaxOutMessagePublishOrderInPaymentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiariesMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiariesMixin").mergeBeneficiariesMixin(d("WASmaxJsx").smax("beneficiaries",null),a);return a}function i(a){var b,c=a.beneficiariesArgs,e=a.orderId,f=a.orderMessageId,g=a.orderPaymentConfigId;a=a.orderType;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("order",{id:(b=d("WAWap")).CUSTOM_STRING(e),message_id:d("WASmaxAttrs").OPTIONAL(b.STANZA_ID,f),payment_config_id:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,g),type:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,c)));return e}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeOrderInPaymentOrderBeneficiaries=h;g.mergeOrderInPaymentMixin=a}),98);
__d("WASmaxOutMessagePublishPaymentInitiatorMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPaymentInitiator;a=d("WASmaxJsx").smax("smax$any",{payment_initiator:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePaymentInitiatorMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishInstallmentMixin","WASmaxOutMessagePublishOrderInPaymentMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.orderInPaymentMixinArgs,c=a.paymentInitiatorMixinArgs;a=a.installmentMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishInstallmentMixin").mergeInstallmentMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishOrderInPaymentMixin").mergeOrderInPaymentMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"}),b),c),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("pay",{"transaction-type":"p2p"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isBRPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin").mergeBRPublishSendPayNodeP2PMixin(a);if(b.bRPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin").mergeBRPublishSendPayNodeP2MMixin(a,b.bRPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBRSendPayEloNodeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.eloDeviceSignature,e=a.eloWalletSignature,f=a.eloChallengeId;a=a.eloCardholderVerificationMethod;c=d("WASmaxJsx").smax("pay",null,d("WASmaxJsx").smax("elo",{device_signature:(b=d("WAWap")).CUSTOM_STRING(c),wallet_signature:b.CUSTOM_STRING(e),challenge_id:b.CUSTOM_STRING(f),cardholder_verification_method:b.CUSTOM_STRING(a)}));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRSendPayEloNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.payId,e=a.payPaymentRails,f=a.payTrustedDeviceInfo,g=a.payNonce,h=a.bRSendPayEloNodeMixinArgs;a=a.bRPublishSendPayNodeP2POrMMixinGroupArgs;c=d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,d("WASmaxJsx").smax("pay",{id:(b=d("WAWap")).CUSTOM_STRING(c),"payment-rails":d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,e),"trusted-device-info":d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,f),nonce:b.CUSTOM_STRING(g)}),h),a);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.payId,e=a.payPaymentRails,f=a.payTrustedDeviceInfo,g=a.payNonce,h=a.bRSendPayEloNodeMixinArgs;a=a.bRPublishSendPayNodeP2POrMMixinGroupArgs;c=d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,d("WASmaxJsx").smax("pay",{id:(b=d("WAWap")).CUSTOM_STRING(c),"payment-rails":b.CUSTOM_STRING(e),"trusted-device-info":b.CUSTOM_STRING(f),nonce:b.CUSTOM_STRING(g)}),h),a);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishOrderMessageMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.orderOrderId,e=a.orderOrderMessageId,f=a.orderExpiryTs,g=a.orderOrderType;a=a.orderDiscountProgramName;e=d("WASmaxJsx").smax("order",{"order-id":(b=d("WAWap")).CUSTOM_STRING(c),"order-message-id":(c=d("WASmaxAttrs")).OPTIONAL(b.CUSTOM_STRING,e),"expiry-ts":c.OPTIONAL(b.INT,f),"order-type":c.OPTIONAL(b.CUSTOM_STRING,g),"discount-program-name":c.OPTIONAL(b.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeOrderMessageMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishOrderMessageMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.orderArgs;a=d("WASmaxJsx").smax("upi",null,d("WASmaxChildren").OPTIONAL_CHILD(i,a));return a}function i(a){a=d("WASmaxOutMessagePublishOrderMessageMixin").mergeOrderMessageMixin(d("WASmaxJsx").smax("order",null),a);return a}function j(a){var b=a.upiArgs;a=a.paymentInitiatorMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a);return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeP2MUpi=h;g.makeUPIPublishSendPayNodeP2MUpiOrder=i;g.mergeUPIPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasPayTransactionTypeP2P;a=d("WASmaxJsx").smax("pay",{"transaction-type":d("WASmaxAttrs").OPTIONAL_LITERAL("p2p",a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUPIPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.uPIPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin").mergeUPIPublishSendPayNodeP2PMixin(a,b.uPIPublishSendPayNodeP2P);if(b.uPIPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin").mergeUPIPublishSendPayNodeP2MMixin(a,b.uPIPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeUPIPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.upiToken;a=d("WASmaxJsx").smax("upi",{token:d("WAWap").CUSTOM_STRING(a)});return a}function i(a){var b,c,e=a.upiArgs,f=a.payId,g=a.payMpin,i=a.payReceiverVpa,j=a.payReceiverVpaId,k=a.paySenderVpa,l=a.paySenderVpaId,m=a.paySeqNo,n=a.payUpiBankInfo,o=a.payMode,p=a.payPurposeCode,q=a.payMcc,r=a.payRefId;a=a.uPIPublishSendPayNodeP2POrMMixinGroupArgs;f=d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup").mergeUPIPublishSendPayNodeP2POrMMixinGroup(d("WASmaxJsx").smax("pay",{id:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),mpin:b.OPTIONAL(c.CUSTOM_STRING,g),"receiver-vpa":c.CUSTOM_STRING(i),"receiver-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,j),"sender-vpa":c.CUSTOM_STRING(k),"sender-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,l),"seq-no":c.CUSTOM_STRING(m),"upi-bank-info":c.CUSTOM_STRING(n),mode:b.OPTIONAL(c.CUSTOM_STRING,o),"purpose-code":b.OPTIONAL(c.CUSTOM_STRING,p),mcc:b.OPTIONAL(c.CUSTOM_STRING,q),"ref-id":b.OPTIONAL(c.CUSTOM_STRING,r)},d("WASmaxChildren").OPTIONAL_CHILD(h,e)),a);return f}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeUpi=h;g.mergeUPIPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeDeprecatedMixin","WASmaxOutMessagePublishBRPublishSendPayNodeMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.bRPublishSendPayNode)return d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin").mergeBRPublishSendPayNodeMixin(a,b.bRPublishSendPayNode);if(b.bRPublishSendPayNodeDeprecated)return d("WASmaxOutMessagePublishBRPublishSendPayNodeDeprecatedMixin").mergeBRPublishSendPayNodeDeprecatedMixin(a,b.bRPublishSendPayNodeDeprecated);if(b.uPIPublishSendPayNode)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin").mergeUPIPublishSendPayNodeMixin(a,b.uPIPublishSendPayNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.bRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup").mergeBRPublishSendPayNodeOrBRPublishSendPayNodeDeprecatedOrUPIPublishSendPayNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIntegrationPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIntegrationPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin").mergeIntegrationPublishPayNodeMixin(d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin").mergeBaseIndividualPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualNonNoviPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin").mergeIndividualNonNoviPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payExpiryTs,c=a.payRequestId;b=d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{"expiry-ts":d("WAWap").CUSTOM_STRING(b),"request-id":d("WAWap").CUSTOM_STRING(c)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRequestPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishPayInviteNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payService;a=d("WASmaxJsx").smax("pay",{type:"invite",service:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayInviteNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIndividualRequestPayNodeMixin","WASmaxOutMessagePublishPayInviteNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualPublishSendPayNode)return d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin").mergeIndividualPublishSendPayNodeMixin(a,b.individualPublishSendPayNode);if(b.individualRequestPayNode)return d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin").mergeIndividualRequestPayNodeMixin(a,b.individualRequestPayNode);if(b.payInviteNode)return d("WASmaxOutMessagePublishPayInviteNodeMixin").mergePayInviteNodeMixin(a,b.payInviteNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup").mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin").mergeIndividualPublishPayNodeMixin(d("WASmaxJsx").smax("pay",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualPublishPayNodeMessageMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypePayMixin","WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualIndividualPublishPayNodeMessageMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin").mergeIndividualIndividualPublishPayNodeMessageMixin,d("WASmaxOutMessagePublishContentTypePayMixin").mergeContentTypePayMixin(d("WASmaxJsx").smax("message",null)),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualContentTypePayIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishContentFanoutMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeListFanoutMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin","WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeMediaFanoutMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaFanout)return d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin").mergeContentTypeMediaFanoutMixin(a,b.contentTypeMediaFanout);if(b.contentTypeMediaFanoutDeprecated)return d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin").mergeContentTypeMediaFanoutDeprecatedMixin(a,b.contentTypeMediaFanoutDeprecated);if(b.contentTypeLiveLocationFanout)return d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin").mergeContentTypeLiveLocationFanoutMixin(a,b.contentTypeLiveLocationFanout);if(b.contentTypeLiveLocationFanoutDeprecated)return d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutDeprecatedMixin").mergeContentTypeLiveLocationFanoutDeprecatedMixin(a,b.contentTypeLiveLocationFanoutDeprecated);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeListFanout)return d("WASmaxOutMessagePublishContentTypeListFanoutMixin").mergeContentTypeListFanoutMixin(a,b.contentTypeListFanout);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.isContentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a);if(b.isContentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentFanoutMixins=a}),98);
__d("WASmaxOutMessagePublishLidChatOriginMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.metaOrigin;a=a.metaSharePn;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:d("WAWap").CUSTOM_STRING(b),share_pn:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLidChatOriginMixin=a}),98);
__d("WASmaxOutMessagePublishTDeprecatedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageT;a=d("WASmaxJsx").smax("message",{t:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishToContentBindingMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid;a=a.contentBindingElementValue;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").DEVICE_JID(b)},d("WASmaxJsx").smax("content_binding",null,a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishAvatarStickerTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{sticker_type:"avatar"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAvatarStickerTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.encNativeFlowName;a=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion3Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"3"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion3Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2Or3MixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersion3Mixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.isEncVersion3)return d("WASmaxOutMessagePublishEncVersion3Mixin").mergeEncVersion3Mixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersion2Or3MixinGroup=a}),98);
__d("WASmaxOutMessagePublishToDeviceMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion2Or3MixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encTypeIndividualMixinArgs,e=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersion2Or3MixinGroupArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersion2Or3MixinGroup").mergeEncVersion2Or3MixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),c),e),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToDeviceMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentFanoutMixins","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishTDeprecatedMixin","WASmaxOutMessagePublishToContentBindingMixin","WASmaxOutMessagePublishToDeviceMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toContentBindingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishToContentBindingMixin").mergeToContentBindingMixin,d("WASmaxOutMessagePublishToDeviceMixin").mergeToDeviceMixin(d("WASmaxJsx").smax("to",null),a),b);return a}function a(){var a=d("WASmaxJsx").smax("enc",null);return a}function i(a){var b,c=a.toArgs,e=a.messageTo,f=a.tDeprecatedMixinArgs,g=a.botMessageTypeMixinArgs,i=a.businessBotMessageMixinArgs,j=a.lidChatOriginMixinArgs,k=a.botLocalAutomatedTypeMixinArgs;a=a.contentFanoutMixinsArgs;b=d("WASmaxOutMessagePublishContentFanoutMixins").mergeContentFanoutMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishTDeprecatedMixin").mergeTDeprecatedMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(e)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,c,1,1997))),f),g),i),j),k),a);return b}function b(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualIndividualFanoutParticipantsTo=h;g.makeIndividualIndividualFanoutEnc=a;g.mergeIndividualIndividualFanoutMixin=b}),98);
__d("WASmaxOutMessagePublishEncListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{mediatype:"list"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncListMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeListMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncListMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.singleSelectOrProductListMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncListMixin").mergeEncListMixin(d("WASmaxJsx").smax("enc",null)))),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeListMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin","WASmaxOutMessagePublishEncLiveLocationMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encLiveLocation)return d("WASmaxOutMessagePublishEncLiveLocationMixin").mergeEncLiveLocationMixin(a,b.encLiveLocation);if(b.encLiveLocationDeprecated)return d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin").mergeEncLiveLocationDeprecatedMixin(a,b.encLiveLocationDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup","WASmaxOutMessagePublishLiveLocationModeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.liveLocationModeMixinArgs;a=a.encLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup").mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a))),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeLiveLocationSingleMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encNativeFlowName,c=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin(d("WASmaxJsx").smax("enc",{native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b)}),a),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncMediaTypeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encMediaType)return d("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin(a,b.encMediaType);if(b.encMediaTypeDeprecated)return d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin(a,b.encMediaTypeDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.senderContentBindingMixinArgs,c=a.contentTypeMediaOrMedianotifyMixinGroupArgs;a=a.encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs;a=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup").mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaSingleMixin=a}),98);
__d("WASmaxOutMessagePublishContentMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeListMixin","WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin","WASmaxOutMessagePublishContentTypeMediaSingleMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaSingle)return d("WASmaxOutMessagePublishContentTypeMediaSingleMixin").mergeContentTypeMediaSingleMixin(a,b.contentTypeMediaSingle);if(b.contentTypeLiveLocationSingle)return d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin").mergeContentTypeLiveLocationSingleMixin(a,b.contentTypeLiveLocationSingle);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeList)return d("WASmaxOutMessagePublishContentTypeListMixin").mergeContentTypeListMixin(a,b.contentTypeList);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.isContentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a);if(b.isContentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentMixins=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryToPeerMixin=a}),98);
__d("WASmaxOutMessagePublishRetryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("message",{t:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin","WASmaxOutMessagePublishRetryMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.individualIndividualRetryToPeerMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin").mergeIndividualIndividualRetryToPeerMixin,d("WASmaxOutMessagePublishRetryMixin").mergeRetryMixin(d("WASmaxJsx").smax("message",null),a),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.contentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion2Or3MixinGroup","WASmaxOutMessagePublishIndividualIndividualRetryMixin","WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin","WASmaxOutMessagePublishLidChatOriginMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.messageTo,e=a.individualIndividualRetryMixinArgs,f=a.individualIndividualSingleContentBindingMixinArgs,g=a.botMessageTypeMixinArgs,h=a.businessBotMessageMixinArgs,i=a.lidChatOriginMixinArgs,j=a.botLocalAutomatedTypeMixinArgs,k=a.contentMixinsArgs,l=a.encTypeIndividualMixinArgs,m=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersion2Or3MixinGroupArgs;c=d("WASmaxOutMessagePublishContentMixins").mergeContentMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin").mergeIndividualIndividualSingleContentBindingMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryMixin").mergeIndividualIndividualRetryMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(c)},d("WASmaxOutMessagePublishEncVersion2Or3MixinGroup").mergeEncVersion2Or3MixinGroup(b.optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),l),m),a)),e),f),g),h),i),j),k);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualIndividualSingleOrIndividualFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotFeedbackMessageTypeMixin","WASmaxOutMessagePublishBotRequestMixin","WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup","WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualFanoutMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageTo,c=a.contentTypeTextOrMediaMixinGroupArgs,e=a.individualIndividualSingleOrIndividualFanoutMixinGroupArgs,f=a.hasBotFeedbackMessageType;a=a.botRequestMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualFanoutMixinGroup").mergeIndividualIndividualSingleOrIndividualFanoutMixinGroup,d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup").mergeContentTypeTextOrMediaMixinGroup(d("WASmaxJsx").smax("message",{to:d("WAWap").USER_JID(b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin").mergeBotFeedbackMessageTypeMixin,d("WASmaxJsx").smax("bot",null,d("WASmaxOutMessagePublishBotRequestMixin").mergeBotRequestMixin(d("WASmaxJsx").smax("to",null),a)),f)),c),e);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualBotRequestMessageMixin=a}),98);
__d("WASmaxOutMessagePublishBotResponseMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.botEditTargetId,c=a.botSenderTimestampMs;a=a.botEdit;b=d("WASmaxJsx").smax("bot",{edit_target_id:d("WASmaxAttrs").OPTIONAL(d("WAWap").STANZA_ID,b),sender_timestamp_ms:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),edit:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotResponseMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.toCount;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD_COUNT(i,a,2,2));return a}function i(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"image"}));return a}function j(a){a=a.participantsArgs;a=d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualContentTypeBotResponseMediaFanoutParticipants=h;g.makeIndividualContentTypeBotResponseMediaFanoutParticipantsTo=i;g.mergeIndividualContentTypeBotResponseMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.individualContentTypeBotResponseMediaFanout)return d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin").mergeIndividualContentTypeBotResponseMediaFanoutMixin(a,b.individualContentTypeBotResponseMediaFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:"msmsg"}),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeMessageSecretMessageMixin=a}),98);
__d("WASmaxOutMessagePublishFromProxyAccountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botActualFrom;a=d("WASmaxJsx").smax("bot",{actual_from:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeFromProxyAccountMixin=a}),98);
__d("WASmaxOutMessagePublishMessageTargetMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.metaTargetId,c=a.metaTargetSenderJid;a=a.metaTargetChatJid;b=d("WASmaxJsx").smax("meta",{target_id:d("WAWap").STANZA_ID(b),target_sender_jid:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,c),target_chat_jid:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageTargetMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotResponseMixin","WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup","WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin","WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup","WASmaxOutMessagePublishFromProxyAccountMixin","WASmaxOutMessagePublishMessageTargetMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.toArgs;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(i,a,2,2));return a}function i(a){a=a.toJid;a=d("WASmaxJsx").smax("to",{jid:d("WAWap").USER_JID(a)});return a}function j(a){var b,c=a.participantsArgs,e=a.messageTo,f=a.contentTypeTextOrIndividualBotResponseMediaFanoutMixinGroupArgs,g=a.botResponseMixinArgs,i=a.fromProxyAccountMixinArgs,j=a.messageTargetMixinArgs,k=a.encTypeMessageSecretMessageMixinArgs;a=a.encVersion2OrFutureproofMixinGroupArgs;e=d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup").mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup((b=d("WASmaxJsx")).smax("message",{to:d("WAWap").USER_JID(e)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishFromProxyAccountMixin").mergeFromProxyAccountMixin,d("WASmaxOutMessagePublishBotResponseMixin").mergeBotResponseMixin(b.smax("bot",null),g),i),d("WASmaxOutMessagePublishMessageTargetMixin").mergeMessageTargetMixin(b.smax("meta",null),j),d("WASmaxOutMessagePublishEncVersion2OrFutureproofMixinGroup").mergeEncVersion2OrFutureproofMixinGroup(d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin").mergeEncTypeMessageSecretMessageMixin(b.smax("enc",null),k),a),d("WASmaxChildren").OPTIONAL_CHILD(h,c)),f);return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualBotResponseFanoutParticipants=h;g.makeIndividualBotResponseFanoutParticipantsTo=i;g.mergeIndividualBotResponseFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualBotRequestMessageMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualBotResponseFanout)return d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin").mergeIndividualBotResponseFanoutMixin(a,b.individualBotResponseFanout);if(b.individualBotRequestMessage)return d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin").mergeIndividualBotRequestMessageMixin(a,b.individualBotRequestMessage);if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRecipientDeprecaredMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"1"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageEditMixin=a}),98);
__d("WASmaxOutMessagePublishMessagePinMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessagePinMixin=a}),98);
__d("WASmaxOutMessagePublishRevokeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"7"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRevokeMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishMessageEditMixin","WASmaxOutMessagePublishMessagePinMixin","WASmaxOutMessagePublishRevokeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isMessageEdit)return d("WASmaxOutMessagePublishMessageEditMixin").mergeMessageEditMixin(a);if(b.isMessagePin)return d("WASmaxOutMessagePublishMessagePinMixin").mergeMessagePinMixin(a);if(b.isRevoke)return d("WASmaxOutMessagePublishRevokeMixin").mergeRevokeMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeMessageEditOrMessagePinOrRevokeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipientPn;a=d("WASmaxJsx").smax("message",{recipient_pn:d("WAWap").USER_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRecipientPNMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientUsernameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipientUsername;a=d("WASmaxJsx").smax("message",{recipient_username:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRecipientUsernameMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientPNOrUsernameMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRecipientPNMixin","WASmaxOutMessagePublishRecipientUsernameMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.recipientPN)return d("WASmaxOutMessagePublishRecipientPNMixin").mergeRecipientPNMixin(a,b.recipientPN);if(b.recipientUsername)return d("WASmaxOutMessagePublishRecipientUsernameMixin").mergeRecipientUsernameMixin(a,b.recipientUsername);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRecipientPNOrUsernameMixinGroup=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagEnumMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagLegacyMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishThreadTypeTagEnumMixin","WASmaxOutMessagePublishThreadTypeTagLegacyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.threadTypeTagEnum)return d("WASmaxOutMessagePublishThreadTypeTagEnumMixin").mergeThreadTypeTagEnumMixin(a,b.threadTypeTagEnum);if(b.threadTypeTagLegacy)return d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin").mergeThreadTypeTagLegacyMixin(a,b.threadTypeTagLegacy);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeThreadTypeTagEnumOrLegacyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.threadTypeTagEnumOrLegacyMixinGroupArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup").mergeThreadTypeTagEnumOrLegacyMixinGroup(d("WASmaxJsx").smax("meta",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseMixin","WASmaxOutMessagePublishGroupInviteTargetMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup","WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin","WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup","WASmaxOutMessagePublishRecipientPNOrUsernameMixinGroup","WASmaxOutMessagePublishThreadTypeTagMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.messageId,e=a.groupInviteTargetMixinArgs,f=a.threadTypeTagMixinArgs,g=a.individualRecipientDeprecaredMixinArgs,h=a.individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs,i=a.messageEditOrMessagePinOrRevokeMixinGroupArgs,j=a.recipientPNOrUsernameMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishRecipientPNOrUsernameMixinGroup").mergeRecipientPNOrUsernameMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup").mergeMessageEditOrMessagePinOrRevokeMixinGroup,d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup").mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup(b.optionalMerge(d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin").mergeIndividualRecipientDeprecaredMixin,b.optionalMerge(d("WASmaxOutMessagePublishThreadTypeTagMixin").mergeThreadTypeTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishGroupInviteTargetMixin").mergeGroupInviteTargetMixin,d("WASmaxOutMessagePublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("message",{id:d("WAWap").STANZA_ID(c)}),a),e),f),g),h),i),j);return b}g.makeIndividualRequest=a}),98);
__d("WASmaxMessagePublishIndividualRPC",["WAComms","WASmaxInMessagePublishIndividualResponseNegative","WASmaxInMessagePublishIndividualResponseSuccess","WASmaxOutMessagePublishIndividualRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutMessagePublishIndividualRequest").makeIndividualRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInMessagePublishIndividualResponseNegative").parseIndividualResponseNegative(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"IndividualResponseNegative",value:g.value});case 7:h=d("WASmaxInMessagePublishIndividualResponseSuccess").parseIndividualResponseSuccess(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"IndividualResponseSuccess",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Individual",{Negative:g,Success:h}));case 11:case"end":return i.stop()}},null,this)}g.sendIndividualRPC=a}),98);
__d("WASendMsgRPC",["WADeprecatedSendIq","WADeprecatedWapParser","WAGetDeviceIdentityMixin","WAJids","WALogger","WAParseFranking","WASmaxMessagePublishIndividualRPC","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WASendMsgRPC: Wrong media type: ",""]);h=function(){return a};return a}function a(a,b,c,d,e){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e===void 0&&(e=!1);var g=d("WAJids").interpretAsGroupJid(a.protocolMsgId.chat),h=a.messageType.type==="text"&&a.messageType.invitedParticipantUserJid!=null;if(b.type==="direct_user"){var i={individualIndividualSingle:{messageTo:b.message.to,individualIndividualRetryMixinArgs:m(a.count,b.recipient),contentMixinsArgs:l(a,b.message),encTypeIndividualMixinArgs:n(b.message),encVersion2Or3MixinGroupArgs:o(b.message)}};i={messageId:a.externalId,deviceIdentityMixinArgs:d("WAGetDeviceIdentityMixin").getDeviceIdentityMixin(a.deviceIdentity),hasNoExtraFanout:a.messageType.isInvisible===!0?!0:null,messageEditOrMessagePinOrRevokeMixinGroupArgs:p(a.messageType),clientFrankingTagMixinArgs:(c==null?void 0:c.frankingTag)?{frankingTagElementValue:c.frankingTag}:null,hasMetaHideDecryptionPlaceholder:a.messageType.isInvisible===!0?!0:null,groupInviteTargetMixinArgs:h&&g!=null?{metaGroupInvite:g}:null,individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs:i,internalTestMixinArgs:e?{testConfig:"armadillo_express"}:null};f==null?void 0:f.addPoint("send_individual_rpc");i=(yield d("WASmaxMessagePublishIndividualRPC").sendIndividualRPC(i));if(i.name==="IndividualResponseSuccess"){var q;q=((q=i.value.deviceListStaleMixin)==null?void 0:q.phash)!=null?{type:"mismatch",local:null,server:i.value.deviceListStaleMixin.phash}:{type:"ok"};var r=i.value.serverFrankingTagMixin!=null&&c!=null?babelHelpers["extends"]({},c,{reportingTag:i.value.serverFrankingTagMixin.frankingReportingTagElementValue}):null;return{type:"success",ts:d("WATimeUtils").castToUnixTime(i.value.t),phash:q,count:null,reportingMeta:r}}else{i.name;return{type:"error",errorCode:parseInt(i.value.error,10),backoff:parseInt((q=i.value.messageNackRetryAttributesMixin)==null?void 0:q.backoff,10),applicationError:(r=i.value.applicationNegativeAckMixin)==null?void 0:r.applicationError}}}q=a.messageType.isInvisible===!0?"false":d("WAWap").DROP_ATTR;i=b.participant!=null?d("WAWap").JID(b.participant):d("WAWap").DROP_ATTR;r=b.phash!=null&&b.type==="group"?d("WAWap").CUSTOM_STRING(b.phash):d("WAWap").DROP_ATTR;var s=a.messageType.type==="text"&&a.messageType.isRevoked?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR;h=!h||g==null?null:d("WAWap").wap("meta",{group_invite:d("WAWap").CUSTOM_STRING(g)});g=e?d("WAWap").wap("test",{config:d("WAWap").CUSTOM_STRING("armadillo_express")}):null;e=a.messageType.isInvisible===!0?d("WAWap").wap("meta",{"decrypt-fail":"hide"}):null;var t=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null,u=(c==null?void 0:c.frankingTag)!=null?d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,c.frankingTag)):null,v=null;b.participants!=null&&(v=d("WAWap").wap("participants",null,b.participants.map(function(a){return j(a)})));var w=null;b.message!=null&&(w=j(b.message,!0));q=d("WAWap").wap("message",{device_fanout:q,edit:s,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:i,phash:r,to:d("WAWap").JID(b.messageTo),type:d("WAWap").CUSTOM_STRING(a.messageType.type)},h,u,v,w,e,t,g);f==null?void 0:f.addPoint("send_stanza_and_return_ack");s=(yield d("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(q,{id:a.externalId,"class":"message",from:b.messageTo,participant:b.participant!=null?b.participant:null}));f==null?void 0:f.addPoint("send_msg_ack_parser");i=k.parse(s);if(i.success){f==null?void 0:f.addPoint("send_msg_ack_parser_success");r=i.success;h=r.errorCode;u=r.applicationError;v=r.backoff;if(h==null){w=i.success;e=w.ts;t=w.phash;g=w.count;a=c!=null?babelHelpers["extends"]({},c,{reportingTag:(q=i.success.reportingMeta)==null?void 0:q.reportingTag}):null;return{type:"success",ts:e,phash:t==null||t===b.phash?{type:"ok"}:{type:"mismatch",local:b.phash,server:t},count:g,reportingMeta:a}}else{f==null?void 0:f.addPoint("send_msg_ack_parser_failed");return{type:"error",errorCode:h,applicationError:u,backoff:v}}}else return{type:"parsing_error"}});return i.apply(this,arguments)}function j(a,b){b===void 0&&(b=!1);var c=d("WAWap").wap("enc",{count:a.count!=null?d("WAWap").INT(a.count):d("WAWap").DROP_ATTR,mediatype:a.mediaType!=null?d("WAWap").CUSTOM_STRING(a.mediaType):d("WAWap").DROP_ATTR,type:d("WAWap").CUSTOM_STRING(a.type),v:d("WAWap").CUSTOM_STRING(a.v)},a.ciphertext);if(b||a.encType==="group")return c;else return d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(a.to)},c)}var k=new(c("WADeprecatedWapParser"))("sendMsgAck",function(a){a.assertTag("ack");return{count:a.maybeAttrInt("count"),errorCode:a.maybeAttrInt("error"),phash:a.maybeAttrString("phash"),applicationError:a.maybeAttrInt("application_error"),ts:a.attrTime("t"),reportingMeta:d("WAParseFranking").parseFrankingNode(a.maybeChild("franking")),backoff:a.maybeAttrInt("backoff")}});function l(a,b){if(a.messageType.type==="reaction")return{isContentTypeReaction:!0};if(a.messageType.type==="text")return{isContentTypeText:!0};a.messageType.type;if(b.mediaType!=null){b={contentTypeMediaOrMedianotifyMixinGroupArgs:{isContentTypeMedia:!0},encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs:{encMediaType:{encMediatype:b.mediaType}}};return{contentTypeMediaSingle:b}}d("WALogger").ERROR(h(),a.messageType.mediaType);return{isContentTypeText:!0}}function m(a,b){a=a!=null?{encCount:a}:null;b=b!=null?{messageRecipient:b}:null;return{encRetryMixinArgs:a,individualIndividualRetryToPeerMixinArgs:b}}function n(a){return{encType:a.type,encElementValue:a.ciphertext}}function o(a){return a.v==="2"?{isEncVersion2:!0}:{isEncVersion3:!0}}function p(a){return a.type==="text"&&a.isRevoked?{isRevoke:!0}:null}g.sendStanza=a;g.createEncWapNode=j}),98);
__d("WASendMsgInternal",["Promise","WABridge","WADevicesState","WAEncGroupMsg","WAEncUserMsg","WAGlobals","WAJids","WALogger","WAMarkSenderKeyAsSentApi","WAOdsEnums","WAQueryGroups","WAResultOrError","WASendMsgRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during send message post-processing. Err: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", chatType:",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"]);o=function(){return a};return a}var p=10002;function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f;e===void 0&&(e=!1);A(a,c);var g=e?3:2,i=function(b){return a.type==="chat"?v(a,c,g,{cryptoManager:b}):t(a,{cryptoManager:b},g)},l=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return i(a)},{operationType:"encrypt",flush:!0})),m=l.success?l.value.type:l.error;B(m,c);if(l.success===!1){c==null?void 0:c.endFail("fail_encrypt");d("WALogger").ERROR(k(),m);return d("WAResultOrError").makeError({type:"encryption-error"})}l=l.value;c==null?void 0:c.addPoint("sending_stanza",{string:{encryptionType:l.type},"int":{ciphertextByteLength:(f=(f=(f=l.message)==null?void 0:(f=f.ciphertext)==null?void 0:f.length)!=null?f:(f=l.participants)==null?void 0:(f=f[0].ciphertext)==null?void 0:f.length)!=null?f:0}});f=(yield d("WASendMsgRPC").sendStanza(a,l,a.reportingMeta,e));c==null?void 0:c.addPoint("ack_returned");if(f.type==="success"){c==null?void 0:c.addPoint("send_stanza_success");try{e=(yield (h||(h=b("Promise"))).all([w(a,l,f,c),y(l,c)]));e=e[0];return d("WAResultOrError").makeResult({baseKey:(l=l.message)==null?void 0:l.baseKey,reportingMeta:null,serverTs:f.ts,meta:{pOrDhashMismatch:e}})}catch(a){c==null?void 0:c.addPoint("send_stanza_failed");d("WALogger").ERROR(j(),a.message);return d("WAResultOrError").makeError({type:"unknown-error"})}}f.type;C(f,m,c);f.applicationError===p&&(yield d("WAGlobals").getDependencies().handleReachabilityErrorAdminMsg(a.chat));if(f.type==="error"){l=f.errorCode!=null&&f.errorCode>=500;if(f.backoff!=null||l)return d("WAResultOrError").makeError({type:"retryable-error",backoff:f.backoff});else return d("WAResultOrError").makeError({type:"non-retryable-error"})}return d("WAResultOrError").makeError({type:"unknown-error"})});return q.apply(this,arguments)}function r(a){d("WADevicesState").getDevicesState().reset([a]);return d("WADevicesState").getDevicesState().waitForUserDevices([a],"SendMsgUtil_recoverUser",!0)}function s(a,b){return d("WAJids").switchOnChatJidType(b,{interopUser:r,msgrUser:r,lidUser:r,phoneUser:r,group:function(b){return d("WAQueryGroups").queryGroups(a,{type:"array",groups:[b]})}})}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.chat,f=a.to,g=a.messageBytes,h=a.messageType,i=a.count,j=a.sessionInfo,k=a.identityKey,l=(yield d("WAEncUserMsg").encryptDeviceJidMessage(f,{type:"message",chat:e,messageBytes:g,messageType:h,applicationPayloadVersion:c},b,i,j,k));return d("WAJids").switchOnUserChatJidType(e,{user:function(b){return l!=null?d("WAResultOrError").makeResult({type:"direct_user",messageTo:a.to,message:l,recipient:d("WAGlobals").isPeerDevice(a.to)?b:null}):d("WAResultOrError").makeError("direct_user")},group:function(b){return l!=null?d("WAResultOrError").makeResult({type:"direct_group",messageTo:b,participant:a.to,message:l}):d("WAResultOrError").makeError("direct_group")}})});return u.apply(this,arguments)}function v(a,c,e,f){var g=a.recipients,h=a.messageBytes,i=a.messageType,j=a.chat,k=a.icdcInfo;return d("WAJids").switchOnUserChatJidType(j,{user:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAEncUserMsg").encryptUserMsg(g,{type:"message",messageBytes:h,messageType:i,chat:a,applicationPayloadVersion:e},k,f)),c=b.participants;return c!=null&&c.length>0?d("WAResultOrError").makeResult({type:"user",messageTo:a,participants:c,phash:b.phash}):d("WAResultOrError").makeError("user")});function c(b){return a.apply(this,arguments)}return c}(),group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(o());var b=(yield d("WAEncGroupMsg").encryptGroupMsg(a,g,h,i,f,c));d("WALogger").LOG(n());var e=b.participants,j=b.encNode;return e==null&&j==null?d("WAResultOrError").makeError("group"):d("WAResultOrError").makeResult({type:"group",messageTo:a,participants:e,message:j,senderKeyDistributionInfo:b.senderKeyDistributionInfo,phash:b.phash})});function e(b){return a.apply(this,arguments)}return e}()})}function w(a,b,c,d){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){if(c.type!=="success")return!1;c=c.phash;if(c.type==="mismatch"){d("WALogger").LOG(i(),c.local,c.server);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:b.type});yield s(e,a.chat);e==null?void 0:e.addPoint("participant_recovery_finished");return!0}return!1});return x.apply(this,arguments)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.senderKeyDistributionInfo!=null){a=a.senderKeyDistributionInfo;var c=a.group,e=a.senderKeyId;a=a.knowsSenderKey;yield d("WAMarkSenderKeyAsSentApi").markSenderKeyAsSent(c,e,a);b==null?void 0:b.addPoint("mark_sender_key_sent")}});return z.apply(this,arguments)}function A(a,b){var c=0;a.type==="chat"&&(c=a.recipients.reduce(function(a,b){return a+b.devicesInfo.length},0));var d=a.messageType.type==="text"&&a.messageType.isRevoked;d=d?"revoke":a.messageType.type;b==null?void 0:b.addPoint("start_encrypt",{string:{sentMessageType:d},"int":{numDevices:c},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}})}function B(a,b){b==null?void 0:b.addPoint("finish_encrypt",{string:{chatType:a}})}function C(a,b,c){if(a.type==="success")return;a.type==="parsing_error"&&(d("WALogger").ERROR(m(),b),c==null?void 0:c.addPoint("ack_parse_fail"));var e=a.errorCode;a=a.applicationError;a===p&&(c==null?void 0:c.addPoint("reachability_error_code"));d("WALogger").ERROR(l(),e,b);e!=null&&(c==null?void 0:c.addPoint("ack_success_error_"+e));c==null?void 0:c.endFail("failed")}g.sendMessage=a}),98);
__d("WASentBytesCacheApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";c=(a=d("WADbTransactor")).makeSignalTransactor({sentBytesCache:(b=d("MAWTransactionMode")).READWRITE},"deleteSentBytes",function(a){return function(b){return a.sentBytesCache.bulkDelete(b)}});e=a.makeSignalTransactor({sentBytesCache:b.READONLY},"loadExpired",function(a){return function(b){return a.sentBytesCache.where("ts").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){return a.waMsgId})})}});f=a.makeSignalTransactor({sentBytesCache:b.READONLY},"loadSentBytes",function(a){return function(b){return a.sentBytesCache.bulkGet(b).then(function(a){return a.filter(Boolean)})}});d=a.makeSignalTransactor({sentBytesCache:b.READWRITE},"saveSentBytes",function(a){return function(b){return a.sentBytesCache.put(b).then(function(){})}});g.deleteSentBytes=c;g.loadExpired=e;g.loadSentBytes=f;g.saveSentBytes=d}),98);
__d("WASentBytesCache",["WAGlobals","WAJids","WAMsg","WASentBytesCacheApi","WATagsLogger","WATimeUtils","WAWaitForUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["It fails to bulkLoadIdentities: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to prune sent bytes: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["SentBytesCache"]),k=30*24*60*60;c=function(){function a(){var a=this;void d("WAWaitForUser").waitForUserUnblocked().then(function(){a.$1()["catch"](function(a){j.ERROR(i(),a)})})}var c=a.prototype;c.loadSentBytes=function(a){return d("WASentBytesCacheApi").loadSentBytes(a)};c.getMsgsForRetry=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=Array.from(new Set(a.map(function(a){a=a.deviceJid;return d("WAJids").extractUserJid(a)}))),c=new Map();try{c=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(b)},{operationType:"retries_load_identities",flush:!1,afterInit:!0}))}catch(a){j.ERROR(h(),a.toString())}var e=(yield this.loadSentBytes(a.map(function(a){a=a.protocolMsgId;return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.chat,externalId:a.externalId})})));return a.map(function(a){var b=a.deviceJid,f=a.protocolMsgId,g=d("WAMsg").craftWAMsgIdString({author:f.author,chat:f.chat,externalId:f.externalId});f=(f=c.get(d("WAJids").extractUserJid(b)))==null?void 0:f.get(b);if(f==null)return{type:"unauthorized"};b=e.find(function(a){return a.waMsgId===g});if(b==null)return{type:"missing"};else if(!d("WATimeUtils").happenedWithin(b.ts,k))return{type:"unauthorized"};return{frankingKey:b.frankingKey,frankingVersion:b.frankingVersion,messageBytes:b.messageBytes,messageType:b.messageType,protocolMsgId:b.protocolMsgId,retryCount:a.retryCount+1,type:"unacked"}})});function c(b){return a.apply(this,arguments)}return c}();c.saveSentBytes=function(a){return d("WASentBytesCacheApi").saveSentBytes(a)};c.$1=function(){return d("WASentBytesCacheApi").loadExpired(d("WATimeUtils").pastUnixTime(k)).then(function(a){return d("WASentBytesCacheApi").deleteSentBytes(a)})};return a}();var l=new c();function a(){return l}g.SentBytesCache=c;g.sentBytesCache=a}),98);/*FB_PKG_DELIM*/
__d("LSContactUtils",["I64","LSContactBitOffset","LSContactBlockedByViewerStatus","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return!(h||(h=d("I64"))).equal(a.blockedByViewerStatus,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED))}function b(a){return(a=d("LSContactBitOffset").has(66,a))!=null?a:!1}g.isContactBlocked=a;g.isContactRestricted=b}),98);
__d("LSPlatformLockState",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Waiting:"waiting",Acquired:"acquired",Cleaning:"cleaning",Canceled:"canceled"});f.LockState=a}),66);
__d("MessengerLocksManagerFallback",["MWLocalStorageErrorHandler","WebStorageLockManager"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WebStorageLockManager").make(a,{onQuotaExceeded:d("MWLocalStorageErrorHandler").onQuotaExceeded})}g["default"]=a}),98);
__d("ReStoreNameUtils",["CurrentMessengerUser"],(function(a,b,c,d,e,f,g){"use strict";a=d("CurrentMessengerUser").getIDorEIMU();b="RestoreIDBMainLock-"+a;c="dbLock-"+a;e="RestoreConcurrency-"+a;f="lsPlatformLock-"+a;d="syncLock-"+a;a="single-instance-pdb-"+a;g.reStoreCMLockName=b;g.reStoreDBLockName=c;g.restoreConcurrencyBroadcastChannelName=e;g.lsPlatformLockBroadcastChannelName=f;g.lsPlatformLockName=d;g.singleTabLockName=a}),98);
__d("saveHandler",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c={};a.set(c,b);return function(){a["delete"](c)}}f["default"]=a}),66);
__d("LSPlatformSyncLock",["BrowserLockManager","FBLogger","LSPlatformErrorChannel","LSPlatformLockState","LSPlatformLsInitLog","MWBroadcastChannel","MessengerLocksManagerFallback","MessengerLogHistory","Promise","ReStoreNameUtils","Run","asyncToGeneratorRuntime","clearTimeout","emptyFunction","gkx","justknobx","pageID","promiseDone","saveHandler","setTimeout","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MessengerLogHistory").getInstance("client_init"),j=typeof window!=="undefined"?window:self,k="iwantlock",l="lockRequestOnDemand";f="mw_msgr_mutex";function m(a,e){a===void 0&&(a=j);e===void 0&&(e=function(){return document.hasFocus()});var f=new Map(),g=new Map(),m=d("LSPlatformLockState").LockState.Waiting,n=c("emptyFunction"),o,p=c("gkx")("24155")?d("MWBroadcastChannel").MWBroadcastChannel(d("ReStoreNameUtils").lsPlatformLockBroadcastChannelName):void 0,q=function(){if(!c("gkx")("24155"))return;o!=null&&c("clearTimeout")(o);if(m===d("LSPlatformLockState").LockState.Canceled||m===d("LSPlatformLockState").LockState.Acquired)return;o=c("setTimeout")(function(){e()&&m!==d("LSPlatformLockState").LockState.Acquired&&(i.debug("tab has focus and wants to acquire sync lock"),p==null?void 0:p.postMessage(k))},c("justknobx")._("1764"))};function r(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){i.debug("Sync lock acquired"),m=d("LSPlatformLockState").LockState.Acquired,yield (h||(h=b("Promise"))).all(Array.from(f.values()).map(function(a){return a()}))});return s.apply(this,arguments)}function t(){m=d("LSPlatformLockState").LockState.Cleaning,n=c("emptyFunction"),g.forEach(function(a){return a()})}function u(){var b=new AbortController(),f=c("LSPlatformErrorChannel").subscribe(function(e){i.debug("syncLock aborted due to ["+e.name+"] "+e.message),c("FBLogger")("ls_web_init").info("SyncLock aborted due to [%s] %s",e.name,e.message),n(),b.abort(),m=d("LSPlatformLockState").LockState.Canceled,p==null?void 0:p.removeEventListener("message",g),a.removeEventListener("focus",q),f()}),g=function a(g){if(g==null||g.data==null||(g.data!==k||e())&&g.data!==l)return;i.debug("got message from other tab to abort request to sync lock");n();b.abort();f();p==null?void 0:p.removeEventListener("message",a);m=d("LSPlatformLockState").LockState.Waiting;c("promiseDone")(v())};p==null?void 0:p.addEventListener("message",g);return b}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,e=(a=c("BrowserLockManager"))!=null?a:c("MessengerLocksManagerFallback")(c("pageID"));if(e){m=d("LSPlatformLockState").LockState.Waiting;d("LSPlatformLsInitLog").addPoint("sync_lock_start");i.debug("Sync lock requested if available");yield new(h||(h=b("Promise")))(function(a){return e.request(d("ReStoreNameUtils").lsPlatformLockName,{ifAvailable:!0},function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){if(c==null){i.debug("Attempted to acquire sync lock but it already taken");d("LSPlatformLsInitLog").addPoint("sync_lock_unavailable");a();return}i.debug("Attempted to acquire sync lock and suceeded");yield r();d("LSPlatformLsInitLog").addPoint("sync_lock_acquired");a();return new(h||(h=b("Promise")))(function(a){n=function(){i.debug("Releasing sync lock"),t(),a()}})});return function(a){return c.apply(this,arguments)}}())});a=u();m!==d("LSPlatformLockState").LockState.Acquired&&(i.debug("Sync lock requested and will wait"),d("LSPlatformLsInitLog").addPoint("sync_lock_requests_again"),c("promiseDone")(e.request(d("ReStoreNameUtils").lsPlatformLockName,{signal:a.signal},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){i.debug("Previous attempt to get sync lock failed, getting in queue for when/if it becomes available");yield r();return new(h||(h=b("Promise")))(function(a){n=function(){i.debug("Releasing sync lock"),t(),a()}})});return function(b){return a.apply(this,arguments)}}()),function(a){},function(a){if((a==null?void 0:a.name)==="AbortError")i.debug("Aborting attempt to acquire sync lock");else{d("LSPlatformLsInitLog").addPoint("sync_lock_request_failure");throw a}}));d("LSPlatformLsInitLog").addPoint("lock_requested")}else{d("LSPlatformLsInitLog").addPoint("sync_lock_end_failure");throw c("unrecoverableViolation")("No lock manager inited","ls_web_init")}});return w.apply(this,arguments)}p!=null&&(a.addEventListener("focus",q),q(),d("LSPlatformLsInitLog").addPoint("onfocus_set"));d("Run").onBeforeUnload(function(){n()},!1);d("LSPlatformLsInitLog").addPoint("beforeunload_set");return{_getStateInternal:function(){return m},hasLock:function(){return m===d("LSPlatformLockState").LockState.Acquired},onAcquired:function(a){return c("saveHandler")(f,a)},onLost:function(a){return c("saveHandler")(g,a)},onLostOnce:function(a){var b=c("saveHandler")(g,function(){a(),b()})},release:function(){n()},requestLock:v}}var n=null;function a(){n==null&&(n=m());return n}function e(){n!=null&&n.release()}g.SYNC_KEY=f;g.init=m;g.use=a;g.releaseIfExist=e}),98);
__d("MAWEphemeralConsts",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=300;b=600;c=900;e=1800;d=Math.imul((f=d("WATimeUtils")).HOUR_SECONDS,6);var h=Math.imul(f.HOUR_SECONDS,12),i=Math.imul(f.DAY_SECONDS,14),j=1e3,k=5,l=10,m=30,n=60,o=d;g.fiveMinutesInSeconds=a;g.tenMinutesInSeconds=b;g.fifteenMinutesInSeconds=c;g.thirtyMinutesInSeconds=e;g.oneHourInSeconds=f.HOUR_SECONDS;g.sixHoursInSeconds=d;g.twelveHoursInSeconds=h;g.oneDayInSeconds=f.DAY_SECONDS;g.ephemeralMaxDelectionWindowForUnseenMessage=i;g.msPerSec=j;g.fiveSeconds=k;g.tenSeconds=l;g.thirtySeconds=m;g.oneMinuteInSeconds=n;g.ephemeralReportingWindowInSeconds=o}),98);
__d("MAWThreadEvent",["LSContactUtils","MAWBridge","MAWBridgeSendAndReceive","MAWContactRelationshipType","MAWJobDefinitions","MAWUIJob","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";b="placeholderConvertSubscription";function a(a,b,e){d("MAWBridge").getBridge().setHandlers("threadEvent",{placeholderConvertSubscription:function(f){var g=f.chatJid;f=f.msgId;a===g&&c("promiseDone")(d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:f}).then(function(a){if(a==null)return;d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(g,b&&d("MAWContactRelationshipType").getContactRelationshipType(b),b?d("LSContactUtils").isContactBlocked(b):!1,b?d("LSContactUtils").isContactRestricted(b):!1,a,e))}))}})}g.PLACEHOLDER_CONVERT_SUBSCRIPTION=b;g.setThreadEventHandler=a}),98);
__d("MAWXMALoggingUtils",["WAArmadilloXMA.pb","objectEntries"],(function(a,b,c,d,e,f,g){"use strict";var h=c("objectEntries")(d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function a(a){return a!=null?h.get(a):void 0}g.getXmaTargetTypeStringFromEnum=a}),98);
__d("ReStoreBinaryEncoding",["I64","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new TextDecoder(),j=new TextEncoder(),k=1,l={true:1,false:2,null:3,undefined:4,emptyString:5,string:6,binary:7,u8binary:8,struct:9,number:10,list:11,i64:12,set:13,map:14},m={boolean:function(a){return a===!0?l.true:l.false},number:function(){return l.number},object:function(a){if(a===null)return l.null;if((h||(h=d("I64"))).isI64(a))return l.i64;if(a instanceof ArrayBuffer)return l.binary;if(a instanceof Uint8Array)return l.u8binary;if(Array.isArray(a))return l.list;if(a instanceof Set)return l.set;return a instanceof Map?l.map:l.struct},string:function(a){return a===""?l.emptyString:l.string},undefined:function(){return l.undefined}};function n(a){return m[typeof a](a)}function o(a,b){a=[a,b];a._tag="i64";return a}var p=j.encodeInto!=null?function(a,b){return j.encodeInto(a,b)}:function(a,b){a=j.encode(a);b.set(a,0);return{written:a.length}};b=function(){function a(){var a=this;this.$1=0;this.$2=[];this.$3=0;this.$4=new DataView(new ArrayBuffer(0));this.$8=function(){a.$3+=a.$5(a.$6());var b=a.$2[a.$3];return b};this.$9=function(){var b=a.$6(),c=a.$4.buffer.slice(a.$4.byteOffset+a.$1,a.$4.byteOffset+b+a.$1);a.$1+=b;return c};this.$10=function(){return new Uint8Array(a.$9(),a.$6(),a.$6())};this.$11=function(){return a.$4.getFloat64((a.$1+=8)-8)};this.$12=function(){var b={},c;while((c=a.$4.getUint8(a.$1++))!==0)b[a.$8()]=a.$13.get(c)();return b};this.$14=function(){var b=[],c;while((c=a.$4.getUint8(a.$1++))!==0)b.push(a.$13.get(c)());return b};this.$15=function(){var b=o(a.$4.getInt32(a.$1),a.$4.getUint32(a.$1+4));a.$1+=8;return b};this.$16=function(){var b=new Set(),c;while((c=a.$4.getUint8(a.$1++))!==0)b.add(a.$13.get(c)());return b};this.$17=function(){var b=new Map(),c;while((c=a.$4.getUint8(a.$1++))!==0)b.set(a.$13.get(a.$4.getUint8(a.$1++))(),a.$13.get(c)());return b};this.$13=new Map([[l.true,function(){return!0}],[l.false,function(){return!1}],[l.null,function(){return null}],[l.undefined,function(){return void 0}],[l.emptyString,function(){return""}],[l.string,this.$8],[l.binary,this.$9],[l.u8binary,this.$10],[l.number,this.$11],[l.struct,this.$12],[l.list,this.$14],[l.i64,this.$15],[l.set,this.$16],[l.map,this.$17]])}var b=a.prototype;b.$5=function(a){return a>>>1^(-(a&1)|0)};b.$6=function(){var a=0,b=!0;for(var d=0;b;d++,this.$1++){if(d>4)throw c("unrecoverableViolation")("expected end of var int","maw_db");var e=this.$4.getUint8(this.$1);b=(e&128)!==0;e=e&-129;a+=e<<7*d}return a};b.$7=function(){this.$1=this.$4.getUint32(0);if(this.$1!==0){while(this.$4.getUint8(this.$1)!==0)this.$2.push(this.$6());this.$1++;var a=this.$4.getUint32(this.$1);a=i.decode(this.$4.buffer.slice(this.$4.byteOffset+this.$1+4,this.$4.byteOffset+a+this.$1+4));var b=0;for(var c=0;c<this.$2.length;c++){var d=this.$2[c];this.$2[c]=a.substr(b,d);b+=d}}this.$1=4};b.decode=function(a){this.$1=0;this.$2=[];this.$3=0;this.$4=new DataView(a.buffer,a.byteOffset,a.byteLength);this.$7();return this.$13.get(this.$4.getUint8(this.$1++))()};return a}();e=function(){function a(){var a=this;this.$1=new ArrayBuffer(65536);this.$2=new Map();this.$3=this.$1;this.$4=new DataView(this.$3);this.$5=4;this.$6=0;this.$7=function(b){if(a.$5+b>a.$3.byteLength){var c=a.$3;a.$3=new ArrayBuffer(Math.max(Math.ceil(a.$3.byteLength*1.5),a.$5+b));new Uint8Array(a.$3).set(new Uint8Array(c));a.$4=new DataView(a.$3)}};this.$9=function(b){b=b;while(b>=128){var c=b&127,d=b>>>7;a.$7(1);a.$4.setUint8(a.$5++,c+128);b=d}a.$7(1);a.$4.setUint8(a.$5++,b)};this.$10=function(){if(a.$2.size>0){a.$4.setUint32(0,a.$5);var b="";for(var c=a.$2.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;a.$9(f.length);b+=f}a.$7(1+b.length*3+4);a.$4.setUint32(a.$5++,0);f=p(b,new Uint8Array(a.$3,a.$5+4));e=f.written;a.$4.setUint32(a.$5,e);a.$5+=e+4}else a.$7(1),a.$4.setUint32(0,0)};this.$11=function(b){var c=Object.keys(b);for(var d=0;d<c.length;d++){var e=c[d],f=b[e],g=n(f);a.$7(1);a.$4.setUint8(a.$5++,g);a.$12(e);if(g<6)continue;a.$13.get(g)(f)}a.$7(1);a.$4.setUint8(a.$5++,0)};this.$12=function(b){var c=a.$2.get(b);c==null&&a.$2.set(b,c=a.$2.size);a.$9(a.$8(c-a.$6));a.$6=c};this.$14=function(b){a.$9(b.byteLength),a.$7(b.byteLength),new Uint8Array(a.$3).set(new Uint8Array(b),a.$5),a.$5+=b.byteLength};this.$15=function(b){a.$14(b.buffer),a.$9(b.byteOffset),a.$9(b.byteLength)};this.$16=function(b){a.$7(8),a.$4.setFloat64(a.$5,b),a.$5+=8};this.$17=function(b){a.$7(8),a.$4.setInt32(a.$5,b[0]),a.$4.setUint32(a.$5+4,b[1]),a.$5+=8};this.$18=function(b){for(var b=b,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var f=n(e);a.$7(1);a.$4.setUint8(a.$5++,f);if(f<6)continue;a.$13.get(f)(e)}a.$7(1);a.$4.setUint8(a.$5++,0)};this.$19=function(b){for(var b=b,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var f=e[0];e=e[1];var g=n(e);a.$7(1);a.$4.setUint8(a.$5++,g);var h=n(f);a.$7(1);a.$4.setUint8(a.$5++,h);h>5&&a.$13.get(h)(f);if(g<6)continue;a.$13.get(g)(e)}a.$7(1);a.$4.setUint8(a.$5++,0)};this.$13=new Map([[l.struct,this.$11],[l.string,this.$12],[l.binary,this.$14],[l.u8binary,this.$15],[l.number,this.$16],[l.i64,this.$17],[l.list,this.$18],[l.set,this.$18],[l.map,this.$19]])}var b=a.prototype;b.$8=function(a){return a<<1^a>>31};b.encode=function(a){this.$3=this.$1;this.$4=new DataView(this.$3);this.$2=new Map();this.$5=4;this.$6=0;var b=n(a);this.$7(1);this.$4.setUint8(this.$5++,b);b>4&&(this.$13.get(b)(a),this.$10());return new Uint8Array(this.$3,0,this.$5)};return a}();function a(a){var b=new Set();function e(a){if(a==null||a===!0||a===!1||a==="")return 1;if(typeof a==="number"||(h||(h=d("I64"))).isI64(a))return 9;if(typeof a==="string"){if(b.has(a))return 2;b.add(a);return a.length*k+4}if(Array.isArray(a)){var f=2;for(var g=a,i=Array.isArray(g),j=0,g=i?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(i){if(j>=g.length)break;l=g[j++]}else{j=g.next();if(j.done)break;l=j.value}l=l;f+=e(l)}return f}if(a instanceof ArrayBuffer)return a.byteLength+3;if(a instanceof Uint8Array)return a.byteLength+6;if(a instanceof Map){l=0;for(j=a,i=Array.isArray(j),g=0,j=i?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(i){if(g>=j.length)break;f=j[g++]}else{g=j.next();if(g.done)break;f=g.value}f=f;var m=f[0];f=f[1];l+=e(m)+e(f)}return l+2}if(typeof a==="object"){m=0;f=Object.keys(a);for(g=0;g<f.length;g++){i=f[g];j=a[i];m+=e(i)+e(j)-2}return m+2}throw c("unrecoverableViolation")("unsupported type: "+typeof a,"messenger_web_product")}return e(a)+4+(b.size?5:0)}g.Decoder=b;g.Encoder=e;g.estimateSize=a}),98);
__d("ReStoreDbConfigStore",["asyncToGeneratorRuntime","promiseFromRequest","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h="_db_config",i="name",j="epoch",k="main",l="dbCorruption";function m(a){a=a.objectStoreNames;return a.contains("_db_config")}function a(a,b){if(m(a))return;a=a.createObjectStore(h,{autoIncrement:!0,keyPath:i});a.createIndex(i,i,{unique:!0});a.add(b);a.put({name:j,value:c("uuidv4")()})}function d(a){return c("promiseFromRequest")(a.objectStore(h).get(l))}function e(a,b){a=a.objectStore(h);return c("promiseFromRequest")(a.put({name:l,value:b+1}))}function n(a){return c("promiseFromRequest")(a.objectStore(h).get(k))}function f(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield n(a));b=!b.isEqual(a);return b});return o.apply(this,arguments)}g.CONFIG_STORE_NAME=h;g.CACHE_VERSION_KEY=j;g.DB_CONFIG_KEY=k;g.createDbConfig=a;g.readCorruptionFailuresFromConfig=d;g.writeCorruptionFailuresToConfig=e;g.readDbConfig=n;g.detectConfigMismatch=f}),98);
__d("ReStoreErrorAction",["ClientConsistencyEventEmitter","LSPlatformSyncLock","MAWCurrentUser"],(function(a,b,c,d,e,f,g){"use strict";function a(){switch(d("MAWCurrentUser").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh","ls_forced_refresh");break;default:h()}}function h(){c("ClientConsistencyEventEmitter").emit("softRefresh","ls_forced_refresh")}function b(){d("LSPlatformSyncLock").releaseIfExist()}g.refresh=a;g.softRefresh=h;g.stopClient=b}),98);
__d("ReStoreDbVersionChange",["ReStoreErrorAction"],(function(a,b,c,d,e,f,g){"use strict";var h="LS DB changed version",i="ReStoreDbVersionChange";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c=h;b=a.call(this,c)||this;b.message=c;b.name=i;d("ReStoreErrorAction").stopClient();d("ReStoreErrorAction").refresh();return b}return b}(babelHelpers.wrapNativeSuper(Error));g.ERROR_NAME=i;g.ReStoreDbVersionChange=a}),98);
__d("ReStoreEARInit",["FBLogger","IndexedDbPolyfills","MAWCryptoConsts","MAWEARGenNewKeychainCryptoKey","MAWGenKeychainCryptoKeyWithVersion","MWEARKeychainV3Errors","Promise","ReStoreEARSetupFailure","WATimeUtils","asyncToGeneratorRuntime","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;b("IndexedDbPolyfills");var i="browserEncryptionMeta";function a(a){a.createObjectStore(i)}var j=function(a){var b=Array.from(a.databaseEncryptionKeys.keys());b.length>0?a.latestVersion=Math.max.apply(Math,b):c("FBLogger")("maw_db").warn("No Ear Keys to set as latest")};function e(a,b){var c=a.databaseEncryptionKeys.get(b);if(c==null)throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+b+" was null. Latest version: "+a.latestVersion);return{key:c,version:b}}function k(a){a=a.objectStore(i);var c=a.openCursor(),d=[];return new(h||(h=b("Promise")))(function(a,b){c.onsuccess=function(b){b=b.target.result;if(b){var c=b.primaryKey,e=b.value;d.push(babelHelpers["extends"]({version:c},e));b["continue"]()}else a(d)},c.onerror=function(a){b(a)}})}function f(a,b,c){a=a.objectStore(i);a.add(c,b)}function l(a){return a.length===0||!d("WATimeUtils").isInFuture(a[a.length-1].expiration)}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("MAWEARGenNewKeychainCryptoKey")());a=babelHelpers["extends"]({},a,{version:d("MAWCryptoConsts").VERSION});return a});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b==null?void 0:b.addPoint("ear_gen_start");a=a.transaction([i],"readonly");a=(yield k(a));if(l(a)){var d=(yield c("MAWEARGenNewKeychainCryptoKey")());a=(a=(a=a[a.length-1])==null?void 0:a.version)!=null?a:0;d=babelHelpers["extends"]({},d,{version:a+1});b==null?void 0:b.addPoint("ear_gen_end");return d}else{b==null?void 0:b.addPoint("ear_gen_skip");return null}});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("gkx")("1838"))throw new(d("ReStoreEARSetupFailure").ReStoreEARSetupFailure)("Testing EAR setup failure");a=a.transaction([i],"readonly");a=(yield k(a));l(a)&&c("FBLogger")("maw_db").mustfix("Shouldn't be generating a new ear key");a=(yield (h||(h=b("Promise"))).allSettled(a.map(function(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)})));for(var f of a)if(f.status==="fulfilled"){var g=f.value;e.databaseEncryptionKeys.set(g.version,g.key)}j(e);g=Array.from(a?a.values():[]).find(function(a){return a.status==="rejected"});if(g&&g.status==="rejected")throw new(d("ReStoreEARSetupFailure").ReStoreEARSetupFailure)(g.reason)});return r.apply(this,arguments)}function s(a,b){b.databaseEncryptionKeys["delete"](a)}function t(a,b,d){c("promiseDone")(c("MAWGenKeychainCryptoKeyWithVersion")(b.key,b.seed,a,b.formatVersion,b.accountKeyString,b.userKeyBaseString,b.appIdOrigin).then(function(a){d.databaseEncryptionKeys.set(a.version,a.key),j(d)}))}g.EAR_STORE_NAME=i;g.createEARStore=a;g.setLatestVersion=j;g.getDbEncryptionKey=e;g.fetchAll=k;g.storeEARKey=f;g.generateKeyWithDefaultVersion=m;g.generateEARKey=o;g.initEAR=q;g.deleteKeys=s;g.rotateKeys=t}),98);
__d("ReStoreEncryptionFailure",[],(function(a,b,c,d,e,f){"use strict";var g="ReStoreEncryptionFailure";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;b=b+" - Encrypted Restore was unable to encrypt an entity for table "+c;d=a.call(this,b)||this;d.message=b;d.name=g;d.tableName=c;return d}return b}(babelHelpers.wrapNativeSuper(Error));f.ERROR_NAME=g;f.ReStoreEncryptionFailure=a}),66);
__d("ReStoreIndexedDbCreatedEvent",["ReStoreEvent"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("ReStoreEvent"));g["default"]=a}),98);
__d("ReStoreIndexedDbOpenedEvent",["ReStoreEvent"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("ReStoreEvent"));g["default"]=a}),98);
__d("createReStoreIndexedDbPersistence",["BrowserLockManager","ClientConsistency","CurrentMessengerUser","Deferred","ExecutionEnvironment","FBLogger","MAWCryptoConsts","MAWKeychainNaClCrypto","MWBroadcastChannel","MessengerLocksManagerFallback","ODS","ReStoreBinaryEncoding","ReStoreDbClosedError","ReStoreDbConfigStore","ReStoreDbVersionChange","ReStoreDecryptionFailure","ReStoreEARInit","ReStoreEARSetupFailure","ReStoreEncryptionFailure","ReStoreErrorAction","ReStoreIndexedDbClosedEvent","ReStoreIndexedDbCreatedEvent","ReStoreIndexedDbFailToOpenEvent","ReStoreIndexedDbOpenedEvent","ReStoreIndexedDbUpgradedEvent","ReStoreIndexeddbPersistenceInitFailure","ReStorePersistence","ReStoreTabNotifier","ReStoreUnexpectedlyClosed","WAExceededStorageQuota","clearTimeout","gkx","justknobx","nullthrows","pageID","promiseDone","promiseFromRequest","qex","recoverableViolation","setTimeout","tweetnacl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("CurrentMessengerUser").getIDorEIMU(),k=4096,l=new Set([d("ReStoreDbConfigStore").CONFIG_STORE_NAME]),m=new(d("ReStoreBinaryEncoding").Encoder)(),n=new(d("ReStoreBinaryEncoding").Decoder)();function o(a,b,e,f){if(a==null){a===null&&c("FBLogger")("maw_db").mustfix("Attempting to decrypt null. This should never happen",String((i||(i=c("ExecutionEnvironment"))).isInWorker));return a}var g=new Uint8Array(a);try{g=g[1];f=d("ReStoreEARInit").getDbEncryptionKey(f,g);f=f.key;var h=3;a=d("tweetnacl").secretbox.open(new Uint8Array(a,h+d("tweetnacl").secretbox.nonceLength),new Uint8Array(a,h,d("tweetnacl").secretbox.nonceLength),new Uint8Array(f));if(a==null){throw new(d("MAWKeychainNaClCrypto").EARDecryptionError)("ReStore was unable to decrypt an entity. Attempting to use key version : "+((h=g)!=null?h:"non-provided")+".")}return n.decode(a)}catch(a){f=new(d("ReStoreDecryptionFailure").ReStoreDecryptionFailure)(a.message,b);e(f);throw f}}function p(a,b,c){try{c=d("ReStoreEARInit").getDbEncryptionKey(c,c.latestVersion);var e=c.key;c=c.version;c=new Uint8Array([0,c,d("MAWCryptoConsts").CIPHER_ID]);var f=d("tweetnacl").randomBytes(d("tweetnacl").secretbox.nonceLength);a=d("tweetnacl").secretbox(m.encode(a),f,new Uint8Array(e));e=new Uint8Array(c.length+f.length+a.length);e.set(c);e.set(f,c.length);e.set(a,c.length+f.length);return e.buffer}catch(a){throw new(d("ReStoreEncryptionFailure").ReStoreEncryptionFailure)(a.message,b)}}function q(a){for(a of a.values())if(a.size!==0)return!1;return!0}function r(a,b){var c=[];a=new Set(a);for(var d of a)b.objectStoreNames.contains(d)||c.push(d);d=[];for(var e=0;e<b.objectStoreNames.length;e++){var f=b.objectStoreNames[e];!a.has(f)&&!l.has(f)&&d.push(f)}if(c.length!==0||d.length!==0)return[c,d]}function s(a,b,c,d){d===void 0&&(d={});if(c==null){b.debug("Schema doesn't have changes to apply");return}b.debug("Schema has changes to apply");b=c[0];c=c[1];b.forEach(function(b){a.objectStoreNames.contains(b)||(d[b]!=null?d[b](a):a.createObjectStore(b,{autoIncrement:!0}))});c.forEach(function(b){a.objectStoreNames.contains(b)&&a.deleteObjectStore(b)})}function t(a,b,e,f,g,h){function j(a){e(new(c("ReStoreIndexedDbClosedEvent"))(a.target,new(d("ReStoreDbVersionChange").ReStoreDbVersionChange)())),g.debug("DB onversionchange TABID="+c("pageID")),c("FBLogger")("maw_db").info("[pdb] onversionchange inWorker=%s",String((i||(i=c("ExecutionEnvironment"))).isInWorker)),f.endFail("version_change")}return new Promise(function(g,i){var k=c("setTimeout")(function(){f.addPoint("pdb_open_timeout"),i(new(d("ReStoreIndexeddbPersistenceInitFailure").ReStoreIndexeddbPersistenceInitFailure)("IndexedDB onsuccess and onerror were never called for indexeddb"))},1e4),l=indexedDB.open(a,h);l.onupgradeneeded=function(a){var d=a.oldVersion;a=a.target;var g=a.result;a=a.transaction;c("clearTimeout")(k);f.addPoint("onupgradeneeded_start");b(g,a);e(d===0?new(c("ReStoreIndexedDbCreatedEvent"))():new(c("ReStoreIndexedDbUpgradedEvent"))());f.addPoint("onupgradeneeded_finish")};l.onerror=function(a){c("clearTimeout")(k),f.addPoint("failed_to_open_pdb"),i(new(d("ReStoreIndexeddbPersistenceInitFailure").ReStoreIndexeddbPersistenceInitFailure)("indexeddb failed to open")),c("FBLogger")("maw_db").catching(a).mustfix("Fail to open indexeddb"),e(new(c("ReStoreIndexedDbFailToOpenEvent"))())};l.onsuccess=function(a){var b=a.target.result;c("clearTimeout")(k);b.addEventListener("versionchange",j);b.onclose=function(){e(new(c("ReStoreIndexedDbClosedEvent"))(b,new(d("ReStoreUnexpectedlyClosed").ReStoreUnexpectedlyClosed)()))};e(new(c("ReStoreIndexedDbOpenedEvent"))());g(b)}})}async function u(a,b,d){a=a.objectStore(b);if(!("getAll"in a)||!("getAllKeys"in a))return new Map();var e=await c("promiseFromRequest")(a.getAllKeys());e=e.length>d?e[e.length-d]:void 0;e=e!=null?IDBKeyRange.lowerBound(e,!1):void 0;a=await Promise.all([c("promiseFromRequest")(a.getAllKeys(e,d)),c("promiseFromRequest")(a.getAll(e,d))]);e=a[0];d=a[1];if(e.length!==d.length){c("recoverableViolation")("Error pre-caching "+b+" IDB table","maw_db");return new Map()}a=new Map();for(b=0;b<e.length;++b)a.set(e[b],{status:"encrypted",value:d[b]});return a}async function v(a,b,d){var e;d.addPoint("cache_start");var f=(e=c("qex")._("338"))!=null?e:100;try{e=Array.from(a.objectStoreNames).filter(function(a){return!a.startsWith("_")});var g=a.transaction([].concat(e),"readonly");await Promise.all(e.map(async function(a){var c=await u(g,a,f);b.set(a,c)}));d.addPoint("cache_end")}catch(a){c("recoverableViolation")("Error initting ReStore cache","maw_db",{error:a}),d.addPoint("cache_failed"),b.clear()}return a}async function w(a,b,e,f,g,h,j){var k=[].concat(b,[d("ReStoreEARInit").EAR_STORE_NAME]),l=(b={},b[d("ReStoreEARInit").EAR_STORE_NAME]=d("ReStoreEARInit").createEARStore,b),m;try{g.addPoint("generate_ear_key_default_start"),m=await d("ReStoreEARInit").generateKeyWithDefaultVersion(),g.addPoint("generate_ear_key_default_end")}catch(a){g.addPoint("generate_ear_key_default_failed"),c("FBLogger")("maw_db").catching(a).mustfix("EAR generateKeyWithDefaultVersion failed")}function n(b,a){g.addAnnotations({bool:{dbEmpty:!0}});d("ReStoreDbConfigStore").createDbConfig(b,f.defaultConfig);for(var c of k)l[c]!=null?l[c](b):b.createObjectStore(c,{autoIncrement:!0});if(m!=null){b=m;c=b.version;b=babelHelpers.objectWithoutPropertiesLoose(b,["version"]);d("ReStoreEARInit").storeEARKey(a,c,b)}}g.addPoint("idb_open_start");b=await t(a,n,e,g,h);g.addPoint("idb_open_end");var o=b.transaction(d("ReStoreDbConfigStore").CONFIG_STORE_NAME,"readonly");o=await Promise.all([d("ReStoreDbConfigStore").detectConfigMismatch(o,f),d("ReStoreDbConfigStore").readCorruptionFailuresFromConfig(o).then(function(a){return(a=a==null?void 0:a.value)!=null?a:0})]);var p=o[0];o=o[1];var q=o>0;q&&(c("FBLogger")("maw_db").info("[pdb] opening corrupted db failures=%s inWorker=%s",String(o),String((i||(i=c("ExecutionEnvironment"))).isInWorker)),h.debug("DB corrupted, deleting db"));p&&h.debug("DB config mismatch, deleting db");g.addAnnotations({bool:{configMismatch:p,dbCorruptionOccured:q}});if(p||q)b.close(),g.addPoint("delete_db_start"),await c("promiseFromRequest")(indexedDB.deleteDatabase(a)),g.addPoint("delete_db_end"),g.addPoint("reopen_db_start"),b=await t(a,n,e,g,h),g.addPoint("reopen_db_end");else{var u=r(k,b),v=await d("ReStoreEARInit").generateEARKey(b,g);(u!=null||v!=null)&&(h.debug("Schema mismatch, bumping db version"),b.close(),g.addPoint("mismatch_start"),b=await t(a,function(a,b){s(a,h,u,l);if(v!=null){a=v.version;var c=babelHelpers.objectWithoutPropertiesLoose(v,["version"]);d("ReStoreEARInit").storeEARKey(b,a,c)}},e,g,h,b.version+1),g.addPoint("mismatch_end"))}try{g.addPoint("ear_keys_init_start"),await d("ReStoreEARInit").initEAR(b,j),g.addPoint("ear_keys_init_end")}catch(f){g.addPoint("ear_keys_init_failed");b.close();c("FBLogger")("maw_db").catching(f).mustfix("EAR failed to init as part of ReStore");c("promiseDone")(c("promiseFromRequest")(indexedDB.deleteDatabase(a)),function(a){},function(a){return c("FBLogger")("maw_db").catching(a).warn("Failed to delete DB")});e(new(c("ReStoreIndexedDbClosedEvent"))(b,new(d("ReStoreEARSetupFailure").ReStoreEARSetupFailure)("Failed to setup EAR in Restore")));throw new(d("ReStoreEARSetupFailure").ReStoreEARSetupFailure)("Failed to setup EAR in Restore")}return b}function a(a,b,e,f,g){var l=Object.keys(b.tableNames),m={accountKey:null,databaseEncryptionKeys:new Map(),latestVersion:d("MAWCryptoConsts").VERSION},n=f.logHistory,r=f.transactionLockQplLogger,s=f.userFlow,u=j+"-"+a,x="dbLock-"+u,y=!0,z,A=[],B=null,C=!1;n.debug("PDB is ON");s.addPoint("init_idb_start");b="mwChat-flushchanges-"+j+"-"+a;var D=d("MWBroadcastChannel").MWBroadcastChannel(b),E=void 0,F=new Map(),G=c("nullthrows")((b=c("BrowserLockManager"))!=null?b:c("MessengerLocksManagerFallback")(c("uuidv4")().toString())),H=new AbortController(),I=U(),J;I==null?void 0:I.onEventReceive("abortTransaction",function(){c("FBLogger")("maw_db").mustfix("Request to abort transaction: %s",J)});var K=new Promise(function(b,d){var f=r.startTracking(!0,void 0,x);f.addAnnotations({string:{source:"createReStoreIndexedDbPersistence",type:"initDB"}});f.mark("lock_requested");var g=c("setTimeout")(function(){I==null?void 0:I.postMessage("abortTransaction")},15e3);c("promiseDone")(G.request(x,{signal:H.signal},async function(){J="idbPromise";c("clearTimeout")(g);f.mark("lock_granted");try{var h=await w(a,l,L,e,s,n,m);f.mark("db_initialized");D.addEventListener("message",R);b(h);f.end();J=null}catch(a){d(a);c("FBLogger")("maw_db").catching(a).warn("[pdb] dbLock initDB issue");f.fail();J=null;throw a}}),function(a){f.end()},function(a){J=null,c("FBLogger")("maw_db").catching(a).warn("[pdb] dbLock idbPromise issue"),f.fail()})});c("promiseDone")(K.then(function(){s.addPoint("init_idb_end")}));c("qex")._("403")&&c("promiseDone")(W(function(){return Promise.resolve([function(){return K.then(function(a){return v(a,F,s)})},"readonly"])},"initCache"));function L(a){a instanceof c("ReStoreIndexedDbClosedEvent")?(H.abort(),a.idb.close(),y=!1,D.removeEventListener("message",R)):a instanceof c("ReStoreIndexedDbFailToOpenEvent")&&H.abort(),H=new AbortController(),g==null?void 0:g(a)}function M(a,b,c){c=a.transaction(c!=null&&c.length>0?c:a.objectStoreNames,b,{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(c);return c}function N(a){var b=F.get(a);b==null&&(b=new Map(),F.set(a,b));return b}async function O(a){return(a=await Q(function(a){return c("promiseFromRequest")(a.objectStore(d("ReStoreDbConfigStore").CONFIG_STORE_NAME).get(d("ReStoreDbConfigStore").CACHE_VERSION_KEY))},"readonly",a))==null?void 0:a.value}function P(){if(B)return;B=new Promise(async function(a){var b;try{var d=async function(){if(z==null){var a;b=(a=b)!=null?a:await K;var d=M(b,A.some(function(a){return a.writemode==="readwrite"||a.expectingWrite})?"readwrite":"readonly");d.onabort=function(){z===d&&(z=null)};z=d}var e=z;a=[];for(var f of A){if(f.writemode==="readwrite"){e.mode==="readwrite"&&a.push(f);z=null;break}a.push(f)}A.splice(0,a.length);a.length&&await Promise.all(a.map(function(a){a=a.thunk;return a(e)}));!A.length&&z!=null&&await c("promiseFromRequest")(z.objectStore(z.objectStoreNames[0]).get(""))};while(A.length)await d();(d=z)==null?void 0:d.commit==null?void 0:d.commit()}finally{z=null,a(),B=null}})}function Q(a,b,c){c===void 0&&(c=!1);return new Promise(function(d,e){A.push({expectingWrite:c,thunk:async function(b){var c;try{c=await a(b)}catch(a){e(a);return}d(c)},writemode:b}),P()})}function R(a){a=a.data;var b=a.changeSet,d=a.fromVersion,e=a.sentinelDeleted;a=a.toVersion;if(C){c("FBLogger")("maw_db").info("[pdb] unexpected cache update received after verifying cache matches db, ignoring");return}E!==d&&E!=null&&(F.clear(),c("FBLogger")("maw_db").info("[pdb] out of order cache update received"));E=a;b.forEach(function(a,b){var c=N(b);a.forEach(function(a,b){a===e?c.delete(b):c.set(b,{status:"decrypted",value:a})})})}function S(){if(!y)return;c("promiseDone")(K,async function(a){var b;a=M(a,"readwrite");b=(b=(b=await d("ReStoreDbConfigStore").readCorruptionFailuresFromConfig(a))==null?void 0:b.value)!=null?b:0;await d("ReStoreDbConfigStore").writeCorruptionFailuresToConfig(a,b)})}function T(){c("promiseDone")(K,function(a){L(new(c("ReStoreIndexedDbClosedEvent"))(a))})}function U(){var a="restore-table-"+u;a=(i||(i=c("ExecutionEnvironment"))).isInBrowser?c("ReStoreTabNotifier")(a):void 0;return a}function V(){if(!y){f.logHistory.error("DB closed, transaction failed");f.userFlow.addPoint("db_closed");throw new(c("ReStoreDbClosedError"))()}}async function W(a,b){await K;c("gkx")("2138")&&V();if(c("gkx")("23662")&&c("justknobx")._("1699")){var e=c("ClientConsistency").getAdditionalRevisions();e.size>0&&(c("FBLogger")("maw_db").info("[pdb] js mismatch detected"),d("ReStoreErrorAction").softRefresh())}return new Promise(function(d,e){var f=r.startTracking(!0,void 0,x);f.addAnnotations({string:{source:"createReStoreIndexedDbPersistence",type:"runExclusivelyLock"}});f.mark("lock_requested");c("promiseDone")(G.request(x,{signal:H.signal},async function(){J=b;f.mark("lock_granted");var g=await a(),h=g[0];g=g[1];try{g=await O(g==="readwrite");f.mark("cache_version_read");E!==g&&E!=null&&(f.mark("cache_clearing"),F.clear(),c("FBLogger")("maw_db").info("[pdb] cache dropped, out of date cache version"),f.mark("cache_cleared"));E=g;C=!0;g=await h();C=!1;d(g);f.end();J=null}catch(a){C=!1;e(a);f.fail();J=null;throw a}}),function(a){f.end()},function(a){J=null,f.fail()})})}async function X(b,e){e=e.upgrade;if(!y)return;var f=c("uuidv4")(),g=c("nullthrows")(E);async function h(a){var e=new Promise(function(e,h){a.oncomplete=function(a){try{D.postMessage({changeSet:b,fromVersion:g,sentinelDeleted:d("ReStorePersistence").sentinelDeleted,toVersion:f})}catch(a){c("recoverableViolation")("Failed to broadcast changes","maw_db",a)}e(a.target.result)},a.onerror=a.onabort=function(a){E=null,F.clear(),h(a)}}),h=!1;for(var i of b){var j=i[0],k=i[1],l=a.objectStore(j);for(k of k){var n=k[0],o=k[1],q;if(o===d("ReStorePersistence").sentinelDeleted)q=l.delete(n);else{o=p(o,j,m);q=l.put(o,n)}q.onerror=function(){return h=!0}}}await c("promiseFromRequest")(a.objectStore(d("ReStoreDbConfigStore").CONFIG_STORE_NAME).put({name:d("ReStoreDbConfigStore").CACHE_VERSION_KEY,value:f}));h?a.abort():a.commit!=null&&a.commit();await e}function i(){Array.from(b).forEach(function(a){var b=a[0];a=a[1];var c=N(b);Array.from(a).forEach(function(a){var b=a[0];a=a[1];a===d("ReStorePersistence").sentinelDeleted?c.delete(b):c.set(b,{status:"decrypted",value:a})})}),E=f}if(q(b))return;var j=await K;if(e===!0){c("FBLogger")("maw_db").info("[pdb] Updating IDB version, fromVersion: %s, non-empty tables: %s",j.version,Array.from(b.entries()).filter(function(a){a[0];a=a[1];return a.size>0}).map(function(a){a=a[0];return a}).sort().toString());await B;(e=z)==null?void 0:e.abort();z=null;j.close();F.clear();E=null;K=async function(){var b=new(c("Deferred"))(),d=await t(a,function(a,d){i(),c("promiseDone")(h(d),function(){b.resolve()},function(a){c("FBLogger")("maw_db").catching(a).warn("Failed to complete db flush"),b.reject("Failed to complete db flush")})},L,s,n,j.version+1);await b.getPromise();return d}();await K;return}if(b.size===0)return;i();e=Array.from(b.keys());e.push(d("ReStoreDbConfigStore").CONFIG_STORE_NAME);return Q(function(a){return h(a)},"readwrite")}function Y(b){c("promiseDone")(K,function(e){L(new(c("ReStoreIndexedDbClosedEvent"))(e,b));e=indexedDB.deleteDatabase(a);e.onerror=function(){(h||(h=d("ODS"))).bumpEntityKey(3185,"db_delete","error.persistence"),c("recoverableViolation")("[pdb] Failed to delete db","maw_db")};e.onblocked=function(){(h||(h=d("ODS"))).bumpEntityKey(3185,"db_delete","block.persistence")};e.onsuccess=function(){(h||(h=d("ODS"))).bumpEntityKey(3185,"db_delete","success.persistence")}})}return{abortTransaction:function(){H.abort()},clearCache:function(){F.clear()},close:T,flush:X,get:function(a,b,d){try{var e=N(b);if(e.has(d)){a=e.get(d);if((a==null?void 0:a.status)==="encrypted"){var f=o(a.value,b,Y,m);e.set(d,{status:"decrypted",value:f});return f}return a==null?void 0:a.value}else{if(!y)return new Promise(function(){});var g=Q(function(a){return c("promiseFromRequest")(a.objectStore(b).get(d))},"readonly").then(function(a){var c=e.get(d);if((c==null?void 0:c.value)!==g)return c==null?void 0:c.value;c=o(a,b,Y,m);e.set(d,{status:"decrypted",value:c});return c});e.set(d,{status:"pending",value:g});return g}}catch(a){c("FBLogger")("maw_db").catching(a).warn("Error occurs in indexeddb persistence get");throw a}},isClosed:function(){return!y},isPersistenceSupported:async function(){try{await K;return!0}catch(a){return!1}},logError:function(a,b,d,e){if(d==="dbCorruption"){b==="readwrite"&&S();throw c("FBLogger")("maw_db").mustfixThrow("Got unexpected undefined in pdb, mode: %s, table: %s, id: %s, deletedInThisTxn: %s",b,a,(d=e==null?void 0:e.id)!=null?d:"",(b=e==null?void 0:e.deletedInThisTxn)!=null?b:"")}},queueCommitWork:function(a){return a()},runExclusively:W,shouldApplySync:function(){return!0},shouldInline:function(a,b){return d("ReStoreBinaryEncoding").estimateSize(b)<k},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},tabTablesNotifier:function(){return I},types:["indexeddb"],uniqueId:u}}a.schemaDiff=r;a.applyChanges=s;g.default=a}),98);/*FB_PKG_DELIM*/
__d("WAParsableWapNode",["WABinary","WAErr","WAJids","WALogger","WALongInt","WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap","WAWapJid"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""]);i=function(){return a};return a}var j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"XmppParsingFailure: "+a+": "+c)||this;d.name="XmppParsingFailure";d.parser=a;d.reason=c;return d}var c=a.prototype;c.toString=function(){return"XmppParsingFailure: "+this.parser+": "+this.reason};return a}(babelHelpers.wrapNativeSuper(Error));a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){return a.call(this,b,c)||this}var e=b.prototype;e.assertFromServer=function(){var a=this.attrString("from");a!==d("WAJids").WA_SERVER_JID_SUFFIX&&this["throw"]('to have "from"="s.whatsapp.net", but instead has "'+a+'"')};e.attrUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.userJid==null?this["throw"]('to have "'+a+'"={UserJid}, but instead has "'+b+'"'):c.userJid};e.attrPhoneUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="phoneUser"?c.userJid:this["throw"]('to have "'+a+'"={PhoneUserJid}, but instead has "'+b+'"')};e.attrLidUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="lidUser"?c.userJid:this["throw"]('to have "'+a+'"={LidUserJid}, but instead has "'+b+'"')};e.maybeAttrUserJid=function(a){return this.hasAttr(a)?this.attrUserJid(a):null};e.maybeAttrPhoneUserJid=function(a){return this.hasAttr(a)?this.attrPhoneUserJid(a):null};e.maybeAttrLidUserJid=function(a){return this.hasAttr(a)?this.attrLidUserJid(a):null};e.attrGroupJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.groupJid==null?this["throw"]('to have "'+a+'"={GroupJid}, but instead has "'+b+'"'):c.groupJid};e.maybeAttrGroupJid=function(a){return this.hasAttr(a)?this.attrGroupJid(a):null};e.attrChatJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.userJid!=null)return c.userJid;return c.groupJid!=null?c.groupJid:this["throw"]('to have "'+a+'"={ChatJid}, but instead has "'+b+'"')};e.attrPhoneChatJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="phoneUser")return c.userJid;else if(c.jidType==="group")return c.groupJid;else return this["throw"]('to have "'+a+'"={ChatJid}, but instead has "'+b+'"')};e.attrDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.deviceJid!=null)return c.deviceJid;if(c.userJid!=null)return d("WAJids").defaultDeviceJidForUser(c.userJid);if(c.hostedDeviceJid!=null)return c.hostedDeviceJid;return c.hostedLidDeviceJid!=null?c.hostedLidDeviceJid:this["throw"]('to have "'+a+'"={DeviceJid}, but instead has "'+b+'"')};e.attrPhoneDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="phoneDevice")return c.deviceJid;return c.jidType==="phoneUser"?d("WAJids").defaultPhoneDeviceJidForUser(c.userJid):this["throw"]('to have "'+a+'"={PhoneDeviceJid}, but instead has "'+b+'"')};e.attrLidDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="lidDevice")return c.deviceJid;return c.jidType==="lidUser"?d("WAJids").defaultLidDeviceJidForLidUserJid(c.userJid):this["throw"]('to have "'+a+'"={LidDeviceJid}, but instead has "'+b+'"')};e.attrDeviceId=function(a){a=this.attrInt(a);return d("WAJids").interpretAsDeviceId(a)};e.attrFromJidChat=function(){var a=this.attrJidWithType();switch(a.jidType){case"msgrUser":var b=a.userJid,e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"interopUser":b=a.userJid;e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneUser":b=a.userJid;e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"lidUser":b=a.userJid;e=d("WAJids").defaultLidDeviceJidForLidUserJid(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"msgrDevice":e=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"interopDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"lidDevice":e=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"group":b=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return b==null?this["throw"]("expected to have participant JID for group"):{type:"group",chat:a.groupJid,groupJid:a.groupJid,author:b};case"broadcast":e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return e==null?this["throw"]("expected to have participant JID for group"):{type:"broadcast",broadcastJid:a.broadcastJid,chat:d("WAJids").extractUserJid(e),author:e};case"hosted":b=a.hostedDeviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"hostedLid":e=a.hostedLidDeviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"call":d("WALogger").ERROR(i(),a.callJid);throw c("WAErr")("ParsableWapNode: attrFromJid() does not support CallJid");default:a.jidType;return this["throw"]("attrFromJidChat should not be used with jid of type "+a.jidType)}};e.attrFromJidPhoneChat=function(){var a=this.attrJidWithType();switch(a.jidType){case"phoneUser":var b=a.userJid,e=d("WAJids").defaultPhoneDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractPhoneUserJid(b),deviceJid:b,author:b};case"group":e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e==null?this["throw"]("expected to have participant JID for group"):{type:"group",chat:a.groupJid,groupJid:a.groupJid,author:e};case"broadcast":b=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return b==null?this["throw"]("expected to have participant JID for group"):{type:"broadcast",broadcastJid:a.broadcastJid,chat:d("WAJids").extractPhoneUserJid(b),author:b};case"call":d("WALogger").ERROR(h(),a.callJid);throw c("WAErr")("ParsableWapNode: attrFromJid() does not support CallJid");default:a.jidType;return this["throw"]("attrFromJidChat should not be used with jid of type "+a.jidType)}};e.attrFromPhoneJid=function(){var a=this.attrJidWithType();if(a.jidType==="status"){a=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return a==null?this["throw"]("to have participant for status msg"):{type:"status",author:a}}else return this.attrFromJidPhoneChat()};e.attrFromJid=function(){var a=this.attrJidWithType();if(a.jidType==="status"){var b=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return b==null?this["throw"]("to have participant for status msg"):{type:"status",author:b}}if(a.jidType==="newsletter")return{type:"newsletter",newsletterJid:a.newsletterJid};if(a.jidType==="hosted")return{type:"hosted",hostedDeviceJid:a.hostedDeviceJid};return a.jidType==="hostedLid"?{type:"hostedLid",hostedLidDeviceJid:a.hostedLidDeviceJid}:this.attrFromJidChat()};e.attrJidWithType=function(a){a===void 0&&(a="from");var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="unknown"?this["throw"]('to have "'+a+'"={Jid}, but instead has "'+b+'"'):c};e.attrWapJid=function(a){a===void 0&&(a="from");a=this.attrString(a);var b=d("WAJids").interpretAndValidateJid(a);return b.jidType==="unknown"?d("WAWapJid").WapJid.create(null,a):d("WAWap").JID(d("WAJids").extractFromJid(b))};e.attrLongInt=function(a){a=this.attrString(a);return d("WALongInt").decimalStringToLongInt(a)};e.attrTime=function(a){return d("WATimeUtils").castToUnixTime(this.attrInt(a))};e.attrFutureTime=function(a){a=this.attrInt(a);return d("WATimeUtils").futureUnixTime(a)};e.contentString=function(){if(this.hasChildren())return this["throw"]("to have string content, but has children instead");else if(this.hasContent()){var a=new(d("WABinary").Binary)(this.contentBytes());return a.readString(a.size())}else return this["throw"]("to have content")};e.decodeAsString=function(a){return d("WAWap").decodeAsString(a)};e.contentSerializedPubKey=function(){if(this.hasContent())return d("WASignalKeys").serializeIdentity(this.contentBytes());else return this["throw"]("to have content")};e.createParseError=function(a){return new j(this.name(),"expected <"+this.tag()+"> "+a)};e["throw"]=function(a){throw this.createParseError(a)};return b}(d("WAParsableXmlNode").ParsableXmlNode);g.XmppParsingFailure=j;g.ParsableWapNode=a}),98);
__d("WADeprecatedWapParser",["WAErr","WAParsableWapNode"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.parse=function(a){a=new(d("WAParsableWapNode").ParsableWapNode)(this.$1,a);try{return{success:this.$2(a)}}catch(a){if(a instanceof d("WAParsableWapNode").XmppParsingFailure)return{error:a};else throw a}};b.parseOrThrow=function(a){a=this.parse(a);if(a.error)throw c("WAErr")(String(a.error));return a.success};return a}();g["default"]=a}),98);
__d("WAAckParser",["WADeprecatedWapParser","WAJids"],(function(a,b,c,d,e,f,g){"use strict";b=new(c("WADeprecatedWapParser"))("ack",function(a){a.assertTag("ack");return{id:a.attrString("id"),ts:a.maybeAttrString("t"),"class":a.attrString("class"),type:a.maybeAttrString("type"),from:a.attrJidWithType(),participant:a.hasAttr("participant")?a.attrDeviceJid("participant"):null,recipient:a.hasAttr("recipient")?a.attrUserJid("recipient"):null}});function a(a,b){return a.id===b.id&&(b["class"]===void 0||a["class"]===b["class"])&&(b.type===void 0||a.type===b.type)&&(b.from===void 0||h(a.from,b.from))&&(b.participant===void 0||a.participant===b.participant)&&(b.recipient===void 0||a.recipient===b.recipient)&&(b.ts===void 0||a.ts===b.ts)}function h(a,b){if(d("WAJids").extractFromJid(a)===b)return!0;if(a.userJid!=null)return d("WAJids").defaultDeviceJidForUser(a.userJid)===b;if(a.deviceJid!=null){a=a.deviceJid;return d("WAJids").extractDeviceId(a)===0&&d("WAJids").extractUserJid(a)===b}return!1}g.AckParser=b;g.ackMatchesTemplate=a;g.fromJidsAreEqual=h}),98);
__d("WAConsumerApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={SMALL:1,MEDIUM:2,LARGE:3};b={SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5};c={NONE:0,VIDEO:1};e={};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={};e.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,f],metadata:[2,h.TYPES.MESSAGE,j]};f.internalSpec={content:[1,h.TYPES.MESSAGE,m],applicationData:[2,h.TYPES.MESSAGE,l],signal:[3,h.TYPES.MESSAGE,k],subProtocol:[4,h.TYPES.MESSAGE,i],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};i.internalSpec={futureProof:[1,h.TYPES.ENUM,(d=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};j.internalSpec={specialTextSize:[1,h.TYPES.ENUM,a]};k.internalSpec={};l.internalSpec={revoke:[1,h.TYPES.MESSAGE,v],__oneofs__:{applicationContent:["revoke"]}};m.internalSpec={messageText:[1,h.TYPES.MESSAGE,d.MessageTextSpec],imageMessage:[2,h.TYPES.MESSAGE,I],contactMessage:[3,h.TYPES.MESSAGE,A],locationMessage:[4,h.TYPES.MESSAGE,D],extendedTextMessage:[5,h.TYPES.MESSAGE,C],statusTextMessage:[6,h.TYPES.MESSAGE,B],documentMessage:[7,h.TYPES.MESSAGE,F],audioMessage:[8,h.TYPES.MESSAGE,H],videoMessage:[9,h.TYPES.MESSAGE,G],contactsArrayMessage:[10,h.TYPES.MESSAGE,z],liveLocationMessage:[11,h.TYPES.MESSAGE,y],stickerMessage:[12,h.TYPES.MESSAGE,E],groupInviteMessage:[13,h.TYPES.MESSAGE,x],viewOnceMessage:[14,h.TYPES.MESSAGE,w],reactionMessage:[16,h.TYPES.MESSAGE,u],pollCreationMessage:[17,h.TYPES.MESSAGE,s],pollUpdateMessage:[18,h.TYPES.MESSAGE,r],editMessage:[19,h.TYPES.MESSAGE,n],__oneofs__:{content:["messageText","imageMessage","contactMessage","locationMessage","extendedTextMessage","statusTextMessage","documentMessage","audioMessage","videoMessage","contactsArrayMessage","liveLocationMessage","stickerMessage","groupInviteMessage","viewOnceMessage","reactionMessage","pollCreationMessage","pollUpdateMessage","editMessage"]}};n.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],message:[2,h.TYPES.MESSAGE,d.MessageTextSpec],timestampMs:[3,h.TYPES.INT64]};o.internalSpec={pollOption:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t]};p.internalSpec={selectedOptions:[1,h.FLAGS.REPEATED|h.TYPES.BYTES],senderTimestampMs:[2,h.TYPES.INT64]};q.internalSpec={encPayload:[1,h.TYPES.BYTES],encIv:[2,h.TYPES.BYTES]};r.internalSpec={pollCreationMessageKey:[1,h.TYPES.MESSAGE,d.MessageKeySpec],vote:[2,h.TYPES.MESSAGE,q],addOption:[3,h.TYPES.MESSAGE,q]};s.internalSpec={encKey:[1,h.TYPES.BYTES],name:[2,h.TYPES.STRING],options:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t],selectableOptionsCount:[4,h.TYPES.UINT32]};t.internalSpec={optionName:[1,h.TYPES.STRING]};u.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],text:[2,h.TYPES.STRING],groupingKey:[3,h.TYPES.STRING],senderTimestampMs:[4,h.TYPES.INT64],reactionMetadataDataclassData:[5,h.TYPES.STRING],style:[6,h.TYPES.INT32]};v.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec]};w.internalSpec={imageMessage:[1,h.TYPES.MESSAGE,I],videoMessage:[2,h.TYPES.MESSAGE,G],__oneofs__:{viewOnceContent:["imageMessage","videoMessage"]}};x.internalSpec={groupJid:[1,h.TYPES.STRING],inviteCode:[2,h.TYPES.STRING],inviteExpiration:[3,h.TYPES.INT64],groupName:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],caption:[6,h.TYPES.MESSAGE,d.MessageTextSpec]};y.internalSpec={location:[1,h.TYPES.MESSAGE,L],accuracyInMeters:[2,h.TYPES.UINT32],speedInMps:[3,h.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[4,h.TYPES.UINT32],caption:[5,h.TYPES.MESSAGE,d.MessageTextSpec],sequenceNumber:[6,h.TYPES.INT64],timeOffset:[7,h.TYPES.UINT32]};z.internalSpec={displayName:[1,h.TYPES.STRING],contacts:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,A]};A.internalSpec={contact:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};B.internalSpec={text:[1,h.TYPES.MESSAGE,C],textArgb:[6,h.TYPES.FIXED32],backgroundArgb:[7,h.TYPES.FIXED32],font:[8,h.TYPES.ENUM,b]};C.internalSpec={text:[1,h.TYPES.MESSAGE,d.MessageTextSpec],matchedText:[2,h.TYPES.STRING],canonicalUrl:[3,h.TYPES.STRING],description:[4,h.TYPES.STRING],title:[5,h.TYPES.STRING],thumbnail:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],previewType:[7,h.TYPES.ENUM,c]};D.internalSpec={location:[1,h.TYPES.MESSAGE,L],address:[2,h.TYPES.STRING]};E.internalSpec={sticker:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};F.internalSpec={document:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],fileName:[2,h.TYPES.STRING]};G.internalSpec={video:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};H.internalSpec={audio:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],ptt:[2,h.TYPES.BOOL]};I.internalSpec={image:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};J.internalSpec={polygonVertices:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,K],location:[2,h.TYPES.MESSAGE,L],__oneofs__:{action:["location"]}};K.internalSpec={x:[1,h.TYPES.DOUBLE],y:[2,h.TYPES.DOUBLE]};L.internalSpec={degreesLatitude:[1,h.TYPES.DOUBLE],degreesLongitude:[2,h.TYPES.DOUBLE],name:[3,h.TYPES.STRING]};M.internalSpec={protocol:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};g.CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE=a;g.CONSUMER_APPLICATION_STATUS_TEXT_MESAGE_FONT_TYPE=b;g.CONSUMER_APPLICATION_EXTENDED_TEXT_MESSAGE_PREVIEW_TYPE=c;g.ConsumerApplicationSpec=e;g.ConsumerApplication$PayloadSpec=f;g.ConsumerApplication$SubProtocolPayloadSpec=i;g.ConsumerApplication$MetadataSpec=j;g.ConsumerApplication$SignalSpec=k;g.ConsumerApplication$ApplicationDataSpec=l;g.ConsumerApplication$ContentSpec=m;g.ConsumerApplication$EditMessageSpec=n;g.ConsumerApplication$PollAddOptionMessageSpec=o;g.ConsumerApplication$PollVoteMessageSpec=p;g.ConsumerApplication$PollEncValueSpec=q;g.ConsumerApplication$PollUpdateMessageSpec=r;g.ConsumerApplication$PollCreationMessageSpec=s;g.ConsumerApplication$OptionSpec=t;g.ConsumerApplication$ReactionMessageSpec=u;g.ConsumerApplication$RevokeMessageSpec=v;g.ConsumerApplication$ViewOnceMessageSpec=w;g.ConsumerApplication$GroupInviteMessageSpec=x;g.ConsumerApplication$LiveLocationMessageSpec=y;g.ConsumerApplication$ContactsArrayMessageSpec=z;g.ConsumerApplication$ContactMessageSpec=A;g.ConsumerApplication$StatusTextMesageSpec=B;g.ConsumerApplication$ExtendedTextMessageSpec=C;g.ConsumerApplication$LocationMessageSpec=D;g.ConsumerApplication$StickerMessageSpec=E;g.ConsumerApplication$DocumentMessageSpec=F;g.ConsumerApplication$VideoMessageSpec=G;g.ConsumerApplication$AudioMessageSpec=H;g.ConsumerApplication$ImageMessageSpec=I;g.ConsumerApplication$InteractiveAnnotationSpec=J;g.ConsumerApplication$PointSpec=K;g.ConsumerApplication$LocationSpec=L;g.ConsumerApplication$MediaPayloadSpec=M}),98);
__d("WAMsgIdToMessageKey",["WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.externalId;a=a.chat;var e=d("WAJids").isAuthorMe(b),f=d("WAJids").interpretAsGroupJid(a);b=e?d("WAGlobals").getMyUserJid():b;a=a;f=f!=null?b:void 0;return{fromMe:e,id:c,remoteJid:a,participant:f}}g.msgIdToMessageKey=a}),98);
__d("WAAsConsumerApplication",["WAAssertUnreachable","WAConsumerApplication.pb","WAErr","WAMsgIdToMessageKey","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";b="image/jpeg";e="video/mp4";f="audio/wav";var h="image/gif",i="image/webp";function a(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return j(a);case d("WAMsgType").MSG_TYPE.REACTION:return k(a);case d("WAMsgType").MSG_TYPE.REVOKED:return l(a);default:return c("WAAssertUnreachable")(a.type)}}function j(a){var b={payload:{content:{messageText:{mentionedJid:[],text:a.msgContent.content}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function k(a){if(a.reactToMsgId==null)throw c("WAErr")("cannot send reaction that reacts to no message");var b=d("WAMsgIdToMessageKey").msgIdToMessageKey(a.reactToMsgId);b={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:b,senderTimestampMs:a.ts,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:b}}}}function l(a){a={remoteJid:a.id.chat,fromMe:!0,id:a.revokedExternalId};return{payload:{applicationData:{revoke:{key:a}}}}}g.IMAGE_MIME_TYPE=b;g.VIDEO_MIME_TYPE=e;g.AUDIO_MIME_TYPE=f;g.GIF_MIME_TYPE=h;g.STICKER_MIME_TYPE=i;g.asConsumerApplication=a;g.encodeTextMessage=j;g.encodeReactionMessage=k}),98);
__d("WAFrankingTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.castToFrankingTag=a;f.castToFrankingKey=b}),66);
__d("WAFranking",["$InternalEnum","WACryptoDependencies","WACryptoHmac","WACryptoUtils","WAFrankingTypes","WAGlobals","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=0,j=b("$InternalEnum").Mirrored(["KEEP","DROP"]);function a(){var a=new Uint8Array(h);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WAFrankingTypes").castToFrankingKey(a)}function c(a){return(a=a)!=null?a:i}function e(a,b){return d("WACryptoHmac").hmacSha256(a,b).then(function(a){return d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a))})}function k(a,c,e,f){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.t0=f;h.next=h.t0===void 0?3:h.t0===0?3:7;break;case 3:h.next=5;return b("regeneratorRuntime").awrap(d("WACryptoHmac").hmacSha256(c,a));case 5:g=h.sent;return h.abrupt("return",d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(g),e));case 7:return h.abrupt("return",!0);case 8:case"end":return h.stop()}},null,this)}function f(a,c){var e,f,g,h,i,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:if(!(!d("WAGlobals").getConfig().isFrankingEnabled()||a.version==="v3"&&a.type==="instamadillo")){o.next=2;break}return o.abrupt("return",{decision:j.KEEP,updatedReportingMeta:c});case 2:g=d("WAGlobals").getConfig().isFrankingDropOnInvalid();if(!((c==null?void 0:c.frankingTag)!=null&&((e=a.metadata)==null?void 0:e.frankingKey)==null)){o.next=7;break}c.frankingTag=null;c.reportingTag=null;return o.abrupt("return",{decision:j.KEEP,updatedReportingMeta:c});case 7:if(!((c==null?void 0:c.frankingTag)!=null&&a.version==="v3"&&a.type==="subprotocol"&&((f=a.metadata)==null?void 0:f.frankingKey)!=null&&a.frankingContent!=null)){o.next=24;break}h=c.frankingTag;i=a.frankingContent,l=a.metadata.frankingVersion;m=d("WAFrankingTypes").castToFrankingKey(new Uint8Array(a.metadata.frankingKey));n=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.FRANKING_VALIDATION);if(!(m==null)){o.next=15;break}n.endFail("tagButNoKey");return o.abrupt("return",g?{decision:j.DROP,updatedReportingMeta:c}:{decision:j.KEEP,updatedReportingMeta:c});case 15:o.next=17;return b("regeneratorRuntime").awrap(k(new Uint8Array(i),m,h,l));case 17:if(o.sent){o.next=20;break}n.endFail("tagMismatch");return o.abrupt("return",g?{decision:j.DROP,updatedReportingMeta:c}:{decision:j.KEEP,updatedReportingMeta:c});case 20:c.frankingKey=m;c.reportingContent=i;n.endSuccess();return o.abrupt("return",{decision:j.KEEP,updatedReportingMeta:c});case 24:return o.abrupt("return",d("WAGlobals").getConfig().isFrankingDropOnMissing()?{decision:j.DROP,updatedReportingMeta:c}:{decision:j.KEEP,updatedReportingMeta:c});case 25:case"end":return o.stop()}},null,this)}g.FrankingDecision=j;g.createFrankingKey=a;g.getFrankingVersion=c;g.genFrankingTag=e;g.validateFrankingTag=k;g.handleAndValidateFrankingFromIncomingMsg=f}),98);
__d("WAMsgApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={DEFAULT:0,VANISH_MODE:1,DISAPPEARING_MESSAGES:2};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={};b.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,i],metadata:[2,h.TYPES.MESSAGE,c]};c.internalSpec={chatEphemeralSetting:[1,h.TYPES.MESSAGE,n],ephemeralSettingList:[2,h.TYPES.MESSAGE,f],ephemeralSharedSecret:[3,h.TYPES.BYTES],forwardingScore:[5,h.TYPES.UINT32],isForwarded:[6,h.TYPES.BOOL],businessMetadata:[7,h.TYPES.MESSAGE,(d=d("WACommon.pb")).SubProtocolSpec],frankingKey:[8,h.TYPES.BYTES],frankingVersion:[9,h.TYPES.INT32],quotedMessage:[10,h.TYPES.MESSAGE,e],threadType:[11,h.TYPES.ENUM,a],readonlyMetadataDataclass:[12,h.TYPES.STRING],groupId:[13,h.TYPES.STRING],groupSize:[14,h.TYPES.UINT32],groupIndex:[15,h.TYPES.UINT32],botResponseId:[16,h.TYPES.STRING],collapsibleId:[17,h.TYPES.STRING],__oneofs__:{ephemeral:["chatEphemeralSetting","ephemeralSettingList","ephemeralSharedSecret"]}};e.internalSpec={stanzaId:[1,h.TYPES.STRING],remoteJid:[2,h.TYPES.STRING],participant:[3,h.TYPES.STRING],payload:[4,h.TYPES.MESSAGE,i]};f.internalSpec={chatJid:[1,h.TYPES.STRING],ephemeralSetting:[2,h.TYPES.MESSAGE,n]};i.internalSpec={coreContent:[1,h.TYPES.MESSAGE,m],signal:[2,h.TYPES.MESSAGE,l],applicationData:[3,h.TYPES.MESSAGE,k],subProtocol:[4,h.TYPES.MESSAGE,j],__oneofs__:{content:["coreContent","signal","applicationData","subProtocol"]}};j.internalSpec={futureProof:[1,h.TYPES.ENUM,d.FUTURE_PROOF_BEHAVIOR],consumerMessage:[2,h.TYPES.MESSAGE,d.SubProtocolSpec],businessMessage:[3,h.TYPES.MESSAGE,d.SubProtocolSpec],paymentMessage:[4,h.TYPES.MESSAGE,d.SubProtocolSpec],multiDevice:[5,h.TYPES.MESSAGE,d.SubProtocolSpec],voip:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],armadillo:[7,h.TYPES.MESSAGE,d.SubProtocolSpec],__oneofs__:{subProtocol:["consumerMessage","businessMessage","paymentMessage","multiDevice","voip","armadillo"]}};k.internalSpec={};l.internalSpec={};m.internalSpec={};n.internalSpec={ephemeralExpiration:[2,h.TYPES.UINT32],ephemeralSettingTimestamp:[3,h.TYPES.INT64],isEphemeralSettingReset:[4,h.TYPES.BOOL]};g.MESSAGE_APPLICATION_METADATA_THREAD_TYPE=a;g.MessageApplicationSpec=b;g.MessageApplication$MetadataSpec=c;g.MessageApplication$Metadata$QuotedMessageSpec=e;g.MessageApplication$Metadata$EphemeralSettingMapSpec=f;g.MessageApplication$PayloadSpec=i;g.MessageApplication$SubProtocolPayloadSpec=j;g.MessageApplication$ApplicationDataSpec=k;g.MessageApplication$SignalSpec=l;g.MessageApplication$ContentSpec=m;g.MessageApplication$EphemeralSettingSpec=n}),98);
__d("WAAsMessageApplication",["WAAsConsumerApplication","WAConsumerApplication.pb","WAFranking","WAMsgApplication.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;switch(a.type){default:b=d("WAAsConsumerApplication").asConsumerApplication(a)}var c=a.forwardingScore!=null?a.forwardingScore:0;a=a.isForwarded!=null?a.isForwarded:!1;c={metadata:{chatEphemeralSetting:null,forwardingScore:c,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:a,quotedMessage:null}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);c.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c).readByteArray()}function b(a){return a}g.asMessageApplication=a;g.castToMessageApplicationBytes=b}),98);
__d("WADbPersonalSenderKeyStatusTxns",["MAWDexieTable","MAWTransactionMode","WADbTransactor","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h={hasSenderKey:new Set(),rotateSenderKey:!0,senderKeyId:null,senderKeyTs:d("WATimeUtils").castToUnixTime(0)},i=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"putNewPersonalSenderKeyStatus",function(a){return function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return j(a,b)})).then(function(){})}});function j(a,b){var c=babelHelpers["extends"]({},h,{groupJid:b});return a.personalSenderKeyStatuses.put(c).then(function(){return c})}function a(a,b,c){return l(a,b).then(function(b){var d=[];b.forEach(function(a){if(a==null||a.rotateSenderKey)return;c.forEach(function(b){return a.hasSenderKey["delete"](b)});d.push(a)});return a.personalSenderKeyStatuses.bulkPut(d).then(function(){return b})})}function b(a,b){return a.personalSenderKeyStatuses.bulkDelete(b)}function c(a,b){return k(a,[b]).then(function(a){return a[0]})}function k(a,b){return l(a,b).then(function(b){var c=[];b.forEach(function(a){if(a==null)return;a.rotateSenderKey=!0;c.push(a)});return a.personalSenderKeyStatuses.bulkPut(c).then(function(){return b})})}function e(a,b){return a.personalSenderKeyStatuses.bulkPut(b).then(function(){})}function f(a,b,c,d){return a.personalSenderKeyStatuses.get(b).then(function(e){var f=babelHelpers["extends"]({},e||h,{groupJid:b,rotateSenderKey:!1,senderKeyId:c,senderKeyTs:d});return a.personalSenderKeyStatuses.put(f).then(function(){return f})})}function l(a,b){return a.personalSenderKeyStatuses.bulkGet(b)}g.bulkPutNewPersonalSenderKeyStatus=i;g.putNewPersonalSenderKeyStatus=j;g.removeDevicesToMultiplePersonalSenderKeyStatuses=a;g.bulkDeletePersonalSenderKeyStatus=b;g.setRotateSenderKeyToTrue=c;g.bulkSetRotateSenderKeyToTrueTxn=k;g.bulkUpdateSenderKeyStatus=e;g.updateSenderKeyStatusAsRotated=f;g.bulkGetPersonalSenderKeyStatuses=l}),98);
__d("WACreateGroup",["WADbPersonalSenderKeyStatusTxns","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAGlobals").getDependencies().createGroups(a),yield d("WADbPersonalSenderKeyStatusTxns").bulkPutNewPersonalSenderKeyStatus(a.map(function(a){return a.groupToCreate.jid}))});return function(b){return a.apply(this,arguments)}}();g.createGroups=a}),98);
__d("WACryptoSha256",["Promise","WABase64","WACryptoDependencies"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.digest({name:"SHA-256"},a))}function j(a){return(h||(h=b("Promise"))).resolve(i(a).then(d("WABase64").encodeB64))}function a(a){return j(k(a))}function k(a){var b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(var d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b}g.sha256=i;g.sha256Base64=j;g.sha256Str=a}),98);
__d("WAParseIqResponse",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=a.content;if(e&&Array.isArray(e)&&e[0]){e=e[0];if(e.tag==="error"){var f=e.attrs||{},g;c&&(typeof c==="function"?g=c(a):g=c.parseOrThrow(e));c=g;return{success:!1,errorCode:parseInt(f.code,10),errorText:d("WAWap").decodeAsString(f.text)||"",errorType:d("WAWap").decodeAsString(f.type)||"",errorBackoff:parseInt(f.backoff,10),toString:h,customError:c}}}if(typeof b==="function")return{success:!0,result:b(a)};else return{success:!0,result:b.parseOrThrow(a)}}function h(){return"IqError "+this.errorCode+": "+this.errorText}g.parseIqResponse=a}),98);
__d("WADeprecatedSendIq",["Promise","WAAckParser","WAArrayUtils","WAComms","WALogger","WAParseIqResponse"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will send stanza when socket opens"]);i=function(){return a};return a}function a(a,b){return d("WAComms")._sendIq(a,!1).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function c(a,b,c){return d("WAComms")._sendIq(a,!1).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b,c)})}function e(a,b,c){return d("WAComms")._sendIq(a,!1,c).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function f(a,b){return d("WAComms")._sendIq(a,!0).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function j(a,b){return k(a,b).then(function(){})}function k(a,c){return new(h||(h=b("Promise")))(function(e){var f=d("WAComms").singletonOrThrowIfUninitialized("deprecatedSendStanzaAndReturnAck"),g=function(a){var b=d("WAAckParser").AckParser.parse(a);return!b.error&&d("WAAckParser").ackMatchesTemplate(b.success,c)?a:null},j={type:"ack",parseAndTest:g,resolve:e,stanza:a,attachedToSocketId:d("WAComms").DEFAULT_SOCKET_ID,orderedId:d("WAComms").getAndIncrementNextOrderedId()};f.ackHandlers.push(j);if(!f.socket){d("WALogger").LOG(i());return}f.callStanza(a)["catch"](function(a){var c=f.ackHandlers.indexOf(j);if(c===-1)return;d("WAArrayUtils").removeIndexWithoutPreservingOrder(f.ackHandlers,c);j.resolve((h||(h=b("Promise"))).reject(a))})})}function l(a,b){d("WAComms").castSmaxStanza(a,b)}g.deprecatedSendIq=a;g.deprecatedSendIqErrorParser=c;g.deprecatedSendIqIfConnectedWithin=e;g.deprecatedSendIqWithoutRetry=f;g.deprecatedSendStanzaAndWaitForAck=j;g.deprecatedSendStanzaAndReturnAck=k;g.deprecatedCastStanza=l}),98);
__d("WAFrankingNode",["Promise","WAFranking","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"]);j=function(){return a};return a}function a(a,c,e){if(c==null){d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(null)}if(e!=null&&e!==0){d("WALogger").ERROR(i(),e);return(h||(h=b("Promise"))).resolve(null)}return d("WAFranking").genFrankingTag(c,a)}g.genFrankingTagFromMessageApplicationEncode=a}),98);
__d("WAGenReportingMeta",["WAByteArray","WAFranking","WAFrankingNode","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(d("WAGlobals").getConfig().isFrankingEnabled()){var e=(yield d("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(a,b,c));return{frankingKey:b,frankingTag:e,frankingVersion:d("WAFranking").getFrankingVersion(c),reportingContent:d("WAByteArray").uint8ArrayToBuffer(a),reportingTag:null}}else return{frankingKey:b,frankingTag:null,frankingVersion:d("WAFranking").getFrankingVersion(c),reportingContent:null,reportingTag:null}});return h.apply(this,arguments)}g.genReportingMeta=a}),98);
__d("WAGroupParserUtils",["WAErr","WAGroupInviteUtils","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["received unknown participant error code: ",""]);h=function(){return a};return a}var i={superadmin:"superadmin",admin:"admin",participant:"participant",nonparticipant:"nonparticipant"};function j(a){if(!a.hasAttr("error"))throw c("WAErr")("Expected participant node to have error attr");var b=a.attrInt("error"),e=a.attrUserJid("jid");switch(b){case 401:return{errorCode:b,text:"not-authorized",user:e};case 403:a=a.child("add_request");return{errorCode:b,text:"request-code",code:d("WAGroupInviteUtils").toInviteCode(a.attrString("code")),expiration:a.attrTime("expiration"),user:e};case 404:return{errorCode:b,text:"not-found",user:e};case 406:return{errorCode:b,text:"enterprise-not-allowed",user:e};case 408:return{errorCode:b,text:"temporarily-blocked",user:e};case 409:return{errorCode:b,text:"conflict",user:e};case 500:return{errorCode:b,text:"resource-constraint",user:e};default:d("WALogger").ERROR(h(),b);return{errorCode:-1,text:"unknown",user:e}}}function k(a,b){a.assertTag("participant");var c="participant";switch(b){case"add":case"demote":c="participant";break;case"promote":c="admin";break;case"remove":c="nonparticipant";break}b=a.attrUserJid("jid");if(a.hasAttr("error")){var e=j(a);return d("WAResultOrError").makeError(e)}else{e=a.attrEnumOrDefault("type",i,c);c=a.maybeAttrString("addressable")!=="false";return d("WAResultOrError").makeResult({user:b,type:e,addressable:c})}}function a(a){a.assertTag("group");var b,c=a.attrString("id");c.includes("@")?b=a.attrGroupJid("id"):b=d("WAJids").toGroupJid(c);return{jid:b,creator:a.maybeAttrUserJid("creator")||void 0,creationTs:a.attrTime("creation"),subject:{content:a.maybeAttrString("subject")||void 0,user:a.maybeAttrUserJid("s_o")||void 0,ts:a.hasAttr("s_t")?a.attrTime("s_t"):void 0},description:m(a)||void 0,participantVersion:a.maybeAttrString("p_v_id")||void 0,participants:a.mapChildrenWithTag("participant",function(a){return k(a)}),memberAddMode:l(a)||void 0}}function l(a){if(a.hasChild("member_add_mode")){a=a.child("member_add_mode");if(a.hasContent()){a=a.contentString();if(a==="admin_add"||a==="all_member_add")return a}}return null}function m(a){if(a.hasChild("description")){a=a.child("description");if(a.hasChild("body")){var b=a.child("body");if(b.hasContent())return{id:a.attrString("id"),ts:a.attrTime("t"),content:b.contentString(),user:b.maybeAttrUserJid("participant")||void 0}}}return null}g.PARTICIPANT_TYPES=i;g.parseProtocolGroupParticipantNode=k;g.parseGroupNode=a}),98);
__d("WAMediaQplHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null||a<0||a>100*1024*1024)return"invalid_size";else if(a<=1*1024)return"size lower than 1 KB";else if(a<=100*1024)return"size between 1 KB and 100 KB";else if(a<=1*1024*1024)return"size between 100 KB and 1 MB";else if(a<=10*1024*1024)return"size between 1 and 10 MB";else if(a<=50*1024*1024)return"size between 10 and 50 MB";else return"size above 50 MB"}f.convertIntegerSizeToStringBucket=a}),66);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NOOP:0,UPSERT:1,DELETE:2,UPSERT_AND_DELETE:3};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};b.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,c],protocol:[2,h.TYPES.MESSAGE,e]};c.internalSpec={applicationPayload:[1,h.TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],futureProof:[3,h.TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};e.internalSpec={integral:[1,h.TYPES.MESSAGE,m],ancillary:[2,h.TYPES.MESSAGE,f]};f.internalSpec={skdm:[2,h.TYPES.MESSAGE,l],deviceListMetadata:[3,h.TYPES.MESSAGE,o],icdc:[4,h.TYPES.MESSAGE,j],backupDirective:[5,h.TYPES.MESSAGE,i]};i.internalSpec={messageId:[1,h.TYPES.STRING],actionType:[2,h.TYPES.ENUM,a],supplementalKey:[3,h.TYPES.STRING]};j.internalSpec={senderIdentity:[1,h.TYPES.MESSAGE,k],recipientIdentities:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,k],recipientUserJids:[3,h.FLAGS.REPEATED|h.TYPES.STRING]};k.internalSpec={seq:[1,h.TYPES.INT32],signingDevice:[2,h.TYPES.BYTES],unknownDevices:[3,h.FLAGS.REPEATED|h.TYPES.BYTES],unknownDeviceIds:[4,h.FLAGS.REPEATED|h.TYPES.INT32]};l.internalSpec={groupId:[1,h.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,h.TYPES.BYTES]};m.internalSpec={padding:[1,h.TYPES.BYTES],dsm:[2,h.TYPES.MESSAGE,n]};n.internalSpec={destinationJid:[1,h.TYPES.STRING],phash:[2,h.TYPES.STRING]};o.internalSpec={senderKeyHash:[1,h.TYPES.BYTES],senderTimestamp:[2,h.TYPES.UINT64],recipientKeyHash:[8,h.TYPES.BYTES],recipientTimestamp:[9,h.TYPES.UINT64]};g.MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE=a;g.MessageTransportSpec=b;g.MessageTransport$PayloadSpec=c;g.MessageTransport$ProtocolSpec=e;g.MessageTransport$Protocol$AncillarySpec=f;g.MessageTransport$Protocol$Ancillary$BackupDirectiveSpec=i;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=j;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=k;g.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=l;g.MessageTransport$Protocol$IntegralSpec=m;g.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=n;g.DeviceListMetadataSpec=o}),98);
__d("WASmaxAttrs",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("WAWap").DROP_ATTR;else return a(b)}function b(a,b){if(b)return a;else return d("WAWap").DROP_ATTR}g.OPTIONAL=a;g.OPTIONAL_LITERAL=b}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="SmaxMixinGroupExhaustiveError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxMixinGroupExhaustiveError=a}),66);/*FB_PKG_DELIM*/
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1],e):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1],a),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";e.exports=a}),null);
__d("LSIssueMessageRangeQueryTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] Beginning execution."),d[6]=c.i64.gt(a[1],c.i64.cast([0,0]))&&c.i64.gt(a[5],c.i64.cast([0,0])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return d[6]?(d[12]=new c.Map(),d[12].set("error_code",c.i64.cast([0,1])),d[12].set("error_message",""),d[12].set("stored_procedure","issueMessageRangeQueryTask"),d[13]=new c.Map(),d[13].set("act_thread_id",a[0]),d[14]=new c.Map(),d[14].set("restore_context",d[13]),d[14].set("failure",d[12]),d[15]=d[14].get("restore_context"),d[14],d[16]=d[15].get("act_thread_id"),d[15],d[17]=c.toJSON(d[14]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[16]].join(""),c.i64.cast([0,50031]),d[17],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[18]=a[0],a})):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?d[12]=void 0:(f=e.item,c.sequence([function(a){return d[28]=f.deviceId,d[27]=f.backupTenancy,d[26]=f.encryptionVersion,d[21]=void 0,c.i64.neq(d[21],void 0)?c.resolve(d[22]=d[21]):c.sequence([function(a){return d[29]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[39]=(d[29].push(c.i64.cast([0,0])),d[29]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[39]=(d[29].push(c.i64.cast([0,2])),d[29]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[39]=(d[29].push(c.i64.cast([0,3])),d[29]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[39]=(d[29].push(c.i64.cast([0,4])),d[29]):0,d[34]=c.createArray(),d[35]=c.i64.of_int32(d[29].length),c.i64.gt(d[35],c.i64.cast([0,0]))?c.loopAsync(d[35],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=(d[34].push(d[40]),d[34])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[39]=c.createArray(),d[40]=c.i64.of_int32(d[34].length),c.i64.gt(d[40],c.i64.cast([0,0]))?c.loopAsync(d[40],function(a){return d[42]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],d[42]).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[45]=(d[39].push(c.i64.to_string(d[43])),d[39])}])}):c.resolve()},function(a){return d[41]=d[39].join(","),d[36]=d[41]}])},function(a){return d[34].some(function(a){return c.i64.eq(d[26],a)})?d[37]=d[26]:d[37]=void 0,c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=void 0,d[22]=d[38]}])},function(a){return c.i64.neq(d[22],void 0)?d[23]=d[22]:d[23]=c.i64.cast([0,0]),c.i64.neq(d[27],void 0)?d[24]=d[27]:d[24]=c.i64.cast([0,1]),c.i64.neq(d[28],void 0)?d[25]=d[28]:d[25]=void 0,d[12]=d[25]}]))})},function(e){return d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,1])),d[14].set("error_message",void 0==null?"":void 0),d[14].set("stored_procedure","issueMessageRangeQueryTask"),d[15]=new c.Map(),d[15].set("act_thread_id",a[0]),d[15].set("source",a[6]),d[15].set("restore_operation_type",c.i64.cast([0,2])),d[15].set("request_id",a[4]),d[15].set("device_id",d[12]),d[16]=new c.Map(),d[16].set("restore_context",d[15]),d[16].set("failure",d[14]),d[17]=d[16].get("restore_context"),d[16],d[18]=d[17].get("act_thread_id"),d[17],d[19]=c.toJSON(d[16]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[18]].join(""),c.i64.cast([0,50030]),d[19],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[20]=a[0],a})}])},function(e){return d[11]="backup not found",d[11]!==void 0?c.sequence([function(e){return d[13]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[11]].join(""),function(a){c.logger(a).mustfix(a)}(d[13]),d[12]=c.createArray(),a[4]!==void 0?d[14]=(d[12].push(a[4]),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[11],d[12],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[13],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]?d[10]=c.i64.cast([0,5]):d[10]=c.i64.cast([0,2]),d[1]=!1}]):(f=e.item,c.sequence([function(a){return d[19]=f.mailboxRootKeyBlob,d[18]=f.ocmfClientStateBlob,d[17]=f.deviceId,d[16]=f.backupTenancy,d[15]=f.encryptionVersion,d[10]=void 0,c.i64.neq(d[10],void 0)?c.resolve(d[11]=d[10]):c.sequence([function(a){return d[20]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[30]=(d[20].push(c.i64.cast([0,0])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[30]=(d[20].push(c.i64.cast([0,2])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[30]=(d[20].push(c.i64.cast([0,3])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[30]=(d[20].push(c.i64.cast([0,4])),d[20]):0,d[25]=c.createArray(),d[26]=c.i64.of_int32(d[20].length),c.i64.gt(d[26],c.i64.cast([0,0]))?c.loopAsync(d[26],function(a){return d[30]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return d[33]=(d[25].push(d[31]),d[25])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[30]=c.createArray(),d[31]=c.i64.of_int32(d[25].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(a){return d[33]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[33]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[36]=(d[30].push(c.i64.to_string(d[34])),d[30])}])}):c.resolve()},function(a){return d[32]=d[30].join(","),d[27]=d[32]}])},function(a){return d[25].some(function(a){return c.i64.eq(d[15],a)})?d[28]=d[15]:d[28]=void 0,c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=void 0,d[11]=d[29]}])},function(e){return c.i64.neq(d[11],void 0)?d[12]=d[11]:d[12]=c.i64.cast([0,0]),c.i64.neq(d[16],void 0)?d[13]=d[16]:d[13]=c.i64.cast([0,1]),c.i64.neq(d[17],void 0)?c.sequence([function(e){return c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(e){return c.i64.neq(d[20],void 0)?d[6]?c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[22]=c.i64.cast([0,4]):d[22]=c.i64.cast([0,0]),d[23]=new c.Map(),d[23].set("act_thread_id",a[0]),d[23].set("tam_thread_subtype",d[22]),d[23].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("ocmf_client_state_blob",d[24]==null?"":d[24]),d[26].set("mailbox_root_key",d[25]==null?"":d[25]),d[27]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[39]=(d[27].push(a.epochId),d[27])})},function(a){return d[37]="Queried locally available epochs. Count: ",d[28]=c.i64.of_int32(d[27].length),d[38]=c.i64.to_string(d[28]),d[29]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[29],d[37],d[29],d[38]].join("")),c.resolve()},function(e){return d[30]=new c.Map(),d[30].set("device_id",d[17]),d[30].set("raw_tokens",d[26]),d[30].set("locally_available_epochs",d[27]),d[31]=new c.Map(),d[31].set("reference_timestamp",a[2]),d[31].set("server_thread_key",void 0),d[31].set("device_context",d[30]),d[32]=new c.Map(),d[32].set("restore_context",d[23]),d[32].set("success",d[31]),d[33]=d[32].get("restore_context"),d[32],d[34]=d[33].get("act_thread_id"),d[33],d[35]=c.toJSON(d[32]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[34]].join(""),c.i64.cast([0,50031]),d[35],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[36]=a[0],a})}]):c.i64.gt(a[1],c.i64.cast([0,0]))?c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[22]=c.i64.cast([0,4]):d[22]=c.i64.cast([0,0]),d[23]=new c.Map(),d[23].set("act_thread_id",a[0]),d[23].set("request_id",a[4]),d[23].set("tam_thread_subtype",d[22]),d[23].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("ocmf_client_state_blob",d[24]==null?"":d[24]),d[26].set("mailbox_root_key",d[25]==null?"":d[25]),d[27]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[39]=(d[27].push(a.epochId),d[27])})},function(a){return d[37]="Queried locally available epochs. Count: ",d[28]=c.i64.of_int32(d[27].length),d[38]=c.i64.to_string(d[28]),d[29]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[29],d[37],d[29],d[38]].join("")),c.resolve()},function(e){return d[30]=new c.Map(),d[30].set("device_id",d[17]),d[30].set("raw_tokens",d[26]),d[30].set("locally_available_epochs",d[27]),d[31]=new c.Map(),d[31].set("reference_timestamp",a[2]),d[31].set("direction",c.i64.cast([0,1])),d[31].set("server_thread_key",void 0),d[31].set("device_context",d[30]),d[32]=new c.Map(),d[32].set("restore_context",d[23]),d[32].set("success",d[31]),d[33]=d[32].get("restore_context"),d[32],d[34]=d[33].get("act_thread_id"),d[33],d[35]=c.toJSON(d[32]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[34]].join(""),c.i64.cast([0,50030]),d[35],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[36]=a[0],a})}]):c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[22]=c.i64.cast([0,4]):d[22]=c.i64.cast([0,0]),d[23]=new c.Map(),d[23].set("act_thread_id",a[0]),d[23].set("request_id",a[4]),d[23].set("tam_thread_subtype",d[22]),d[23].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("ocmf_client_state_blob",d[24]==null?"":d[24]),d[26].set("mailbox_root_key",d[25]==null?"":d[25]),d[27]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[39]=(d[27].push(a.epochId),d[27])})},function(a){return d[37]="Queried locally available epochs. Count: ",d[28]=c.i64.of_int32(d[27].length),d[38]=c.i64.to_string(d[28]),d[29]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[29],d[37],d[29],d[38]].join("")),c.resolve()},function(e){return d[30]=new c.Map(),d[30].set("device_id",d[17]),d[30].set("raw_tokens",d[26]),d[30].set("locally_available_epochs",d[27]),d[31]=new c.Map(),d[31].set("reference_timestamp",a[2]),d[31].set("direction",c.i64.cast([0,2])),d[31].set("server_thread_key",void 0),d[31].set("device_context",d[30]),d[32]=new c.Map(),d[32].set("restore_context",d[23]),d[32].set("success",d[31]),d[33]=d[32].get("restore_context"),d[32],d[34]=d[33].get("act_thread_id"),d[33],d[35]=c.toJSON(d[32]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[34]].join(""),c.i64.cast([0,50030]),d[35],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[36]=a[0],a})}]):c.sequence([function(e){return d[6]?(d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,100])),d[24].set("error_message",""),d[24].set("stored_procedure","issueMessageRangeQueryTask"),d[25]=new c.Map(),d[25].set("act_thread_id",a[0]),d[26]=new c.Map(),d[26].set("restore_context",d[25]),d[26].set("failure",d[24]),d[27]=d[26].get("restore_context"),d[26],d[28]=d[27].get("act_thread_id"),d[27],d[29]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[28]].join(""),c.i64.cast([0,50031]),d[29],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?d[24]=void 0:(f=e.item,c.sequence([function(a){return d[40]=f.deviceId,d[39]=f.backupTenancy,d[38]=f.encryptionVersion,d[33]=void 0,c.i64.neq(d[33],void 0)?c.resolve(d[34]=d[33]):c.sequence([function(a){return d[41]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[51]=(d[41].push(c.i64.cast([0,0])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[51]=(d[41].push(c.i64.cast([0,2])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[51]=(d[41].push(c.i64.cast([0,3])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[51]=(d[41].push(c.i64.cast([0,4])),d[41]):0,d[46]=c.createArray(),d[47]=c.i64.of_int32(d[41].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[46].push(d[52]),d[46])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[51].push(c.i64.to_string(d[55])),d[51])}])}):c.resolve()},function(a){return d[53]=d[51].join(","),d[48]=d[53]}])},function(a){return d[46].some(function(a){return c.i64.eq(d[38],a)})?d[49]=d[38]:d[49]=void 0,c.i64.neq(d[49],void 0)?d[50]=d[49]:d[50]=void 0,d[34]=d[50]}])},function(a){return c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=c.i64.cast([0,0]),c.i64.neq(d[39],void 0)?d[36]=d[39]:d[36]=c.i64.cast([0,1]),c.i64.neq(d[40],void 0)?d[37]=d[40]:d[37]=void 0,d[24]=d[37]}]))})},function(e){return d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,100])),d[26].set("error_message",void 0==null?"":void 0),d[26].set("stored_procedure","issueMessageRangeQueryTask"),d[27]=new c.Map(),d[27].set("act_thread_id",a[0]),d[27].set("source",a[6]),d[27].set("restore_operation_type",c.i64.cast([0,2])),d[27].set("request_id",a[4]),d[27].set("device_id",d[24]),d[28]=new c.Map(),d[28].set("restore_context",d[27]),d[28].set("failure",d[26]),d[29]=d[28].get("restore_context"),d[28],d[30]=d[29].get("act_thread_id"),d[29],d[31]=c.toJSON(d[28]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[30]].join(""),c.i64.cast([0,50030]),d[31],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[32]=a[0],a})}])},function(e){return d[23]="threak pk not found for jid",d[23]!==void 0?c.sequence([function(e){return d[25]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[23]].join(""),function(a){c.logger(a).mustfix(a)}(d[25]),d[24]=c.createArray(),a[4]!==void 0?d[26]=(d[24].push(a[4]),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[23],d[24],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[25],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]?d[22]=c.i64.cast([0,5]):d[22]=c.i64.cast([0,2])}])},function(a){return d[14]=!0}]):c.sequence([function(e){return d[6]?(d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,1])),d[22].set("error_message",""),d[22].set("stored_procedure","issueMessageRangeQueryTask"),d[23]=new c.Map(),d[23].set("act_thread_id",a[0]),d[24]=new c.Map(),d[24].set("restore_context",d[23]),d[24].set("failure",d[22]),d[25]=d[24].get("restore_context"),d[24],d[26]=d[25].get("act_thread_id"),d[25],d[27]=c.toJSON(d[24]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[26]].join(""),c.i64.cast([0,50031]),d[27],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[28]=a[0],a})):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?d[22]=void 0:(f=e.item,c.sequence([function(a){return d[38]=f.deviceId,d[37]=f.backupTenancy,d[36]=f.encryptionVersion,d[31]=void 0,c.i64.neq(d[31],void 0)?c.resolve(d[32]=d[31]):c.sequence([function(a){return d[39]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[49]=(d[39].push(c.i64.cast([0,0])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[49]=(d[39].push(c.i64.cast([0,2])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[49]=(d[39].push(c.i64.cast([0,3])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[49]=(d[39].push(c.i64.cast([0,4])),d[39]):0,d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[49]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[39],d[49]).then(function(a){return a=a,d[50]=a[0],d[51]=a[1],a})},function(a){return d[52]=(d[44].push(d[50]),d[44])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[49]=c.createArray(),d[50]=c.i64.of_int32(d[44].length),c.i64.gt(d[50],c.i64.cast([0,0]))?c.loopAsync(d[50],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[44],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[49].push(c.i64.to_string(d[53])),d[49])}])}):c.resolve()},function(a){return d[51]=d[49].join(","),d[46]=d[51]}])},function(a){return d[44].some(function(a){return c.i64.eq(d[36],a)})?d[47]=d[36]:d[47]=void 0,c.i64.neq(d[47],void 0)?d[48]=d[47]:d[48]=void 0,d[32]=d[48]}])},function(a){return c.i64.neq(d[32],void 0)?d[33]=d[32]:d[33]=c.i64.cast([0,0]),c.i64.neq(d[37],void 0)?d[34]=d[37]:d[34]=c.i64.cast([0,1]),c.i64.neq(d[38],void 0)?d[35]=d[38]:d[35]=void 0,d[22]=d[35]}]))})},function(e){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,1])),d[24].set("error_message",void 0==null?"":void 0),d[24].set("stored_procedure","issueMessageRangeQueryTask"),d[25]=new c.Map(),d[25].set("act_thread_id",a[0]),d[25].set("source",a[6]),d[25].set("restore_operation_type",c.i64.cast([0,2])),d[25].set("request_id",a[4]),d[25].set("device_id",d[22]),d[26]=new c.Map(),d[26].set("restore_context",d[25]),d[26].set("failure",d[24]),d[27]=d[26].get("restore_context"),d[26],d[28]=d[27].get("act_thread_id"),d[27],d[29]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",":",d[28]].join(""),c.i64.cast([0,50030]),d[29],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})}])},function(e){return d[21]="backup not found",d[21]!==void 0?c.sequence([function(e){return d[23]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[21]].join(""),function(a){c.logger(a).mustfix(a)}(d[23]),d[22]=c.createArray(),a[4]!==void 0?d[24]=(d[22].push(a[4]),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[21],d[22],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[23],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[23]=!0:d[23]=!1,d[23]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[24],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]?d[20]=c.i64.cast([0,5]):d[20]=c.i64.cast([0,2]),d[14]=!1}])},function(a){return d[1]=d[14]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[9]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ",d[5],d[7],d[5],d[8],d[5],d[9]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure";e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadId;d[1]=b.numMessages;d[2]=b.startSortKey;d[3]=b.isPointQuery;d[4]=b.traceId;d[5]=b.newerNumMessages;d[6]=b.source;return c("LSIssueMessageRangeQueryTask").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWEncryptedBackupsIssueRangeQuery",["I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSDataTraceType","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWMainTraceUtils","MWEncryptedBackUpEBNotEnabledError","Promise","WAJids","WATagsLogger","asyncToGeneratorRuntime","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Issuing message range query for chatJid: "," skipped. EB not enabled"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Issuing message range query for thread: "," startSortKey: "," numMessages: ","} "]);l=function(){return a};return a}function a(a,e,g,m,n,o,p,q){if(c("gkx")("23914")){var r=q!=null?q:d("MAWMainTraceUtils").createTraceId();c("promiseDone")(d("MAWEncryptedBackupUtils").getBackupTenancy(e.tables).then(function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(g){if(g!=null&&(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION)))return e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("MAWMainTraceUtils").startTraceWithTxn(b,(i||(i=d("I64"))).of_float(Date.now()),r,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE));yield c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(b),{checkPointId:j.ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ISSUE_MESSAGE_RANGE_QUERY),dataTraceId:r,syncChannel:i.neg_one});d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",r]).LOG(l(),r,a,i.to_string(m),i.to_string(n));d("MAWEBRestoreTrackingUtils").markEBRestorePaginated(p,q);return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(b),{isPointQuery:!1,newerNumMessages:o,numMessages:n,source:j.ofNumber((b=p)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN),startSortKey:i.to_string(m),threadId:d("WAJids").threadIdForChatJid(a),traceId:r})});return function(a){return e.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":60");else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore"]).WARN(k(),a);d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(r,c("err")(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED));return(h||(h=b("Promise"))).resolve()}});return function(a){return g.apply(this,arguments)}}()));return r}return null}g.runQuery=a}),98);
__d("MAWAsyncEBIssueRangeQuery",["I64","MAWAsyncEBPendingQueryPromise","MWEncryptedBackupsIssueRangeQuery"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e,f,g,i){f===void 0&&(f=0);b=d("MWEncryptedBackupsIssueRangeQuery").runQuery(b,a,void 0,c,(h||(h=d("I64"))).of_int32(e),h.of_int32(f),g,i);return b==null?null:d("MAWAsyncEBPendingQueryPromise").getWaitForRestorePromiseFromTrace(b)}function b(a,b,c,e,f,g,i){f===void 0&&(f=0);b=d("MWEncryptedBackupsIssueRangeQuery").runQuery(b,a,void 0,c,(h||(h=d("I64"))).of_int32(e),h.of_int32(f),g,i);return b==null?null:d("MAWAsyncEBPendingQueryPromise").getPendingQueryPromiseFromTrace(b)}g.issueQueryAndWaitForReStoreAsPromise=a;g.issueQueryAsPromise=b}),98);
__d("MAWEBFetch",["FBLogger","I64","LSMEBTaskCreationSource","MAWAsyncEBIssueRangeQuery","MWEncryptedBackUpEBNotEnabledError","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,e=a.count,f=a.db,g=a.direction,h=a.skipFullRestore;h=h===void 0?!1:h;var i=a.timestampMs;a=a.traceId;e=k(e,g);var l=e[0];e=e[1];h=!h&&c("gkx")("3278")?d("MAWAsyncEBIssueRangeQuery").issueQueryAndWaitForReStoreAsPromise:d("MAWAsyncEBIssueRangeQuery").issueQueryAsPromise;h=h(f,b,j(i,g),l,e,c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION,a);if(h==null)return d("WAResultOrError").makeResult({hasMoreAfter:!1,hasMoreBefore:!1,messages:[],restoreType:"none"});f=(yield h.then(function(a){return d("WAResultOrError").makeResult(a)})["catch"](function(a){if(a&&(a==null?void 0:a.message)===d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED)return d("WAResultOrError").makeError(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[EBFetch] Failed to fetch");return d("WAResultOrError").makeError(null)}));if(f.success===!1)return f;b=f.value;i=b.hasMoreAfter;g=b.hasMoreBefore;l=b.messages;e=b.restoreType;return d("WAResultOrError").makeResult({hasMoreAfter:i,hasMoreBefore:g,messages:l,restoreType:e})});return i.apply(this,arguments)}function j(a,b){if(a!=null)return(h||(h=d("I64"))).min(a,h.of_float(d("WATimeUtils").millisTime()));switch(b){case"before":return(h||(h=d("I64"))).of_float(d("WATimeUtils").millisTime());case"after":return(h||(h=d("I64"))).zero;default:b;return(h||(h=d("I64"))).max_int}}function k(a,b){switch(b){case"before":return[a,0];case"after":return[0,a];default:b;return[Math.ceil(a/2),Math.ceil(a/2)]}}g["default"]=a}),98);
__d("MWPReplyLogging",["I64","QPLUserFlow","deepEquals","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function j(a){var b=Date.now()|0;i.set((h||(h=d("I64"))).to_string(a),b);return b}function k(a){var b=i.get((h||(h=d("I64"))).to_string(a));if(b==null)return j(a);else return b}function a(a,b,e){if(e){a?c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:k(b)}):c("QPLUserFlow").endSuccess(c("qpl")._(25298086,"3996"),{instanceKey:k(b)});i["delete"]((h||(h=d("I64"))).to_string(b));return}}function b(a,b,d){if(a!=null){if(c("deepEquals")(a,b)){c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"same_message",{instanceKey:k(d)});return}if(!c("deepEquals")(a,b)){a=k(d);c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"switch_message",{instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:a});c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:j(d),timeoutInMs:6e4});return}}c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:j(d),timeoutInMs:6e4})}e={logClearReply:a,logSetReply:b};g["default"]=e}),98);
__d("SoundPlayer",["ODS","URI","createArrayFromMixed"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map();function k(a){var b=new(i||(i=c("URI")))(a);return b.getDomain()?a:new(i||(i=c("URI")))(window.location.href).setPath(b.getPath()).toString()}function l(a){a=new(i||(i=c("URI")))(a).getPath();if(/\.mp3$/.test(a))return"audio/mpeg";return/\.og[ga]$/.test(a)?"audio/ogg":""}var m=function(a,b){for(var a=c("createArrayFromMixed")(a),d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(j.has(f))return;var g=document.createElement("audio");if(!g||!g.canPlayType||!g.canPlayType(l(f)))continue;g.preload="auto";g.src=k(f);document.body&&document.body.appendChild(g);j.set(f,g);(b==null?void 0:b.onPreload)!=null&&b.onPreload(g);return}};a=function(a,b){b===void 0&&(b={});for(var a=c("createArrayFromMixed")(a),e=Array.isArray(a),f=0,a=e?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;j.has(g)||m(g,b.callbacks);g=j.get(g);if(!g)continue;b.loop&&g.setAttribute("loop","");b.volume&&(g.volume=b.volume);g=g.play();g!=null&&typeof g.then==="function"?g.then(function(a){(h||(h=d("ODS"))).bumpEntityKey(2966,"sound_player","play.success")})["catch"](function(a){(h||(h=d("ODS"))).bumpEntityKey(2966,"sound_player","play.error")}):(h||(h=d("ODS"))).bumpEntityKey(2966,"sound_player","non_promise");return}};b=function(a){for(var a=c("createArrayFromMixed")(a),b=Array.isArray(a),d=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(b){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=j.get(e);if(e){e.pause();return}}};e=function(a){for(var a=c("createArrayFromMixed")(a),b=Array.isArray(a),d=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(b){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;var f=j.get(e);f&&(f.pause(),f.removeAttribute("src"),f.src=k(e))}};g.preload=m;g.play=a;g.pause=b;g.stop=e}),98);
__d("SoundSynchronizer",["SoundPlayer","WebStorage","createArrayFromMixed"],(function(a,b,c,d,e,f){var g,h="fb_sounds_playing3";function i(){var a=(g||(g=b("WebStorage"))).getLocalStorage();if(a)try{a=a[h];if(a){a=JSON.parse(a);if(Array.isArray(a))return a}}catch(a){}return[]}function j(a){var c=(g||(g=b("WebStorage"))).getLocalStorage();if(c){var d=i();d.push(a);while(d.length>5)d.shift();try{c[h]=JSON.stringify(d)}catch(a){}}}function k(a){return i().some(function(b){return b===a})}a={play:function(a,c,d,e){a=b("createArrayFromMixed")(a);c=c||a[0]+Math.floor(Date.now()/1e3);if(k(c))return;b("SoundPlayer").play(a,{loop:!!d,callbacks:e});j(c)},isSupported:function(){return!!(g||(g=b("WebStorage"))).getLocalStorage()}};e.exports=a}),null);
__d("SoundRPC",["FBJSON","SecurePostMessage","SoundSynchronizer","cr:950105"],(function(a,b,c,d,e,f,g){function h(a,b,c,e){d("SoundSynchronizer").play(a,b,c,e)}function a(a,b,c,e){b={name:"SoundRPC",data:{paths:b,sync:c,loop:e}};d("SecurePostMessage").sendMessageAllowAnyOrigin_UNSAFE(a,d("FBJSON").stringify(b))}function c(){return!!window.postMessage}function e(){var a=function(a){if(!/\.facebook.com$/.test(a.origin))return;var b={};try{a=a.data;typeof a==="string"&&(b=d("FBJSON").parse(a))}catch(a){}a=b;b=a.name;a=a.data;b==="SoundRPC"&&a!=null&&typeof a==="object"&&h(a.paths,a.sync,a.loop)};b("cr:950105")!=null?b("cr:950105").listen(window,"message",a):window.addEventListener("message",a)}g.playLocal=h;g.playRemote=a;g.supportsRPC=c;g._listen=e}),98);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","Visibility","isFacebookURI","justknobx"],(function(a,b,c,d,e,f,g){var h,i=null,j=!1;function a(a){}function k(a,b,c,e){i?d("SoundRPC").playRemote(i.contentWindow,a,b,!1):d("SoundRPC").playLocal(a,b,c,e),j=!0}function b(){return j}function e(a,b,d){if(!j&&c("Visibility").isHidden())return;k(a,b,d)}function f(a){i||d("SoundPlayer").stop(a)}var l=new(h||c("URI"))(location.href),m=new Set(["comet","www"]);c("justknobx")._("2674")&&m.add("business");l.getSubdomain()&&!m.has(l.getSubdomain())&&l.setSubdomain("www");m=l.getDomain();function n(){if(d("UserAgent_DEPRECATED").ie()<9)return!1;return c("SoundInitialData").RPC_DISABLED?!1:d("SoundSynchronizer").isSupported()&&d("SoundRPC").supportsRPC()}c("isFacebookURI")(l)&&location.host!==m&&n()&&(i=document.createElement("iframe"),i.setAttribute("src","//"+m+"/sound_iframe.php"),i.style.display="none",document.body&&document.body.appendChild(i));g.init=a;g.play=k;g.hasPlayedSoundBefore=b;g.playOnlyIfImmediate=e;g.stop=f}),98);
__d("mwEBCheckIfEBKeysExistInDisk",["FBLogger","MAWCurrentUser","MAWIndexedDbMetadata","MWChatEncryptedBackupsQPLEvents","Promise","QPLUserFlow","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("gkx")("415");function a(a){return new(h||(h=b("Promise")))(function(b,e){if(!i||a==="true")return b(null);var f,g;try{var h=d("MAWCurrentUser").getID();g=d("MAWIndexedDbMetadata").ebLSDBName(h);f=indexedDB.open(g)}catch(a){h="[labyrinth_web] Failed to open DB due to: "+a;c("FBLogger")("labyrinth_web").warn(h);c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"failed_to_start_open_db"}});return e(null)}f.onerror=function(){c("FBLogger")("labyrinth_web").warn("[labyrinth_web] Failed to open DB: "+g);c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"failed_to_open_db"}});return e(null)};f.onsuccess=function(a){var f="secure_encrypted_backups_client_state";a=a.target.result;if(!a.objectStoreNames.contains(f)){c("FBLogger")("labyrinth_web").warn("[labyrinth_web] client state not present in IDB");c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"table_not_present"}});return e(null)}var g;try{a=a.transaction(f);a=a.objectStore(f);g=a.count()}catch(a){c("FBLogger")("labyrinth_web").warn("[labyrinth_web] Failed to get count of rows in table: "+f+" error: "+a);c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"failed_to_get_count_of_rows"}});return e(null)}g.onsuccess=function(a){a=a.target.result;a=a>0;c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:a.toString()}});b(null)};g.onerror=function(){c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"get_rows_failed"}});return e(null)}}})}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("ArmadilloReceiveWriteDbSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5721");b=d("FalcoLoggerInternal").create("armadillo_receive_write_db_success",a);e=b;g["default"]=e}),98);
__d("BootloaderEventsPerf",["invariant","Bootloader","BootloaderEvents","ResourceTimingStore","objectEntries","objectValues"],(function(a,b,c,d,e,f,g,h){var i={total_count:0,total_bytes:0,downloaded_count:0,downloaded_bytes:0,cached_count:0,cached_bytes:0,inlined_count:0,inlined_bytes:0,duration:0,missing_count:0};function j(a,b,c){return Math.max(0,((c=c)!=null?c:0)-Math.max(a,(c=b)!=null?c:0))}function k(){return{blocking:babelHelpers["extends"]({},i),nonblocking:babelHelpers["extends"]({},i),"default":babelHelpers["extends"]({},i)}}function l(a,b,c){var e,f;if(c==null)e=0,f="downloaded";else if(c[1])e=c[0].length,f="inlined";else{c=d("ResourceTimingStore").getEntryForURL(c[0]);c?(e=c.encodedBodySize,f=c.transferSize===0?"cached":"downloaded"):(e=0,f="downloaded",a.missing_count++)}a.total_count++;a.total_bytes+=e;if(!b)return;a.duration=Math.max(a.duration,b);switch(f){case"downloaded":a.downloaded_count++;a.downloaded_bytes+=e;break;case"inlined":a.inlined_count++;a.inlined_bytes+=e;break;case"cached":a.cached_count++;a.cached_bytes+=e;break}}function m(a,b,d,e,f){var g=c("Bootloader").getResourceState(b);l(a,j(d,g.loadStart,g.loadEnd),e);g.loadError!=null&&f.add(b)}function n(a,b,d,e){var f=k();for(var a=c("objectEntries")(a),g=Array.isArray(a),i=0,a=g?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(g){if(i>=a.length)break;j=a[i++]}else{i=a.next();if(i.done)break;j=i.value}j=j;var l=j[0];j=j[1];for(var j=j,n=Array.isArray(j),o=0,j=n?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=j.length)break;p=j[o++]}else{o=j.next();if(o.done)break;p=o.value}p=p;var q=p[0];p=p[1];var r=void 0,s=void 0;switch(p.type){case"async":s=null;r=d;break;case"js":case"css":s=[p.src,p.d===1];r=f;break;default:p,h(0,3721)}m(r[l],q,b,s,e)}}return f}function o(a,b){var e={unpredicted:d("BootloaderEvents").newResourceMapSet(),ef:d("BootloaderEvents").newResourceMapSet(),overpredicted:d("BootloaderEvents").newResourceMapSet()};for(var f=c("objectEntries")(b),g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i[0];i=i[1];for(var i=i.entries(),k=Array.isArray(i),l=0,i=k?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=i.length)break;m=i[l++]}else{l=i.next();if(l.done)break;m=l.value}m=m;var n=m[0];m=m[1];a[j].has(n)?e.ef[j].set(n,m):e.overpredicted[j].set(n,m)}}for(n=c("objectEntries")(a),m=Array.isArray(n),l=0,n=m?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(m){if(l>=n.length)break;k=n[l++]}else{l=n.next();if(l.done)break;k=l.value}i=k;j=i[0];h=i[1];for(g=h.entries(),f=Array.isArray(g),a=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(a>=g.length)break;k=g[a++]}else{a=g.next();if(a.done)break;k=a.value}i=k;h=i[0];k=i[1];b[j].has(h)||e.unpredicted[j].set(h,k)}}return e}function a(a){var b=a.efData,c=a.rsrcs,d=a.startTime,e=new Set(),f;if(b){var g=o(c,b.tierOne);f=g.unpredicted;g={ef:n(g.ef,b.fetchRsrcsStart,k(),e),overpredicted:n(g.overpredicted,b.fetchRsrcsStart,k(),e)};b={ef_fetch_predictions:b.fetchPredictionsEnd-b.fetchPredictionsStart,ef_fetch_start_wait:b.fetchPredictionsEnd-b.fetchRsrcsStart,ef_head_start:d-b.fetchRsrcsStart}}else f=c,g={},b={};c=babelHelpers["extends"]({unpredicted:n(f,d,k(),e)},g);return{source:a.source,source_detail:a.sourceDetail,is_first_identical:a.isFirstIdentical,timeslice_context:(f=a.timesliceContext)==null?void 0:f.name,start_time:d,err_count:e.size,resources:c,durations:babelHelpers["extends"]({jsmods_wait:a.jsmodsStart-d,jsmods:a.jsmodsEnd-a.jsmodsStart,jsmods_done_wait:a.jsmodsEnd-d,download_done_wait:a.logTime-d},b),payloadStats:a.payloadStats}}function b(a){var b=a.startTime,e=0,f=0,g=0,h=0;for(var i=a.components,m=Array.isArray(i),o=0,i=m?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(m){if(o>=i.length)break;p=i[o++]}else{o=i.next();if(o.done)break;p=o.value}p=p;p=c("Bootloader").getComponentTiming(p);var q=p.tierTwoStart,r=p.tierTwoEnd,s=p.tierThreeStart;p=p.tierThreeEnd;e=Math.max(e,j(b,q,r));f=Math.max(f,j(b,b,r));g=Math.max(g,j(b,s,p));h=Math.max(h,j(b,b,p))}q=new Set();r=k();s=n(a.tierOne,b,r,q);p=n(a.tierTwo,b,r,q);o=n(a.tierThree,b,r,q);m=r.blocking.downloaded_count!=0;i=k();var t=d("BootloaderEvents").newResourceMapSet(),u=new Set(),v=[a.tierOne,a.tierTwo,a.tierThree];for(var w=0;w<v.length;w++){var x=v[w];for(var x=c("objectValues")(x),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{z=x.next();if(z.done)break;A=z.value}A=A;for(var A=A.keys(),B=Array.isArray(A),C=0,A=B?A:A[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var D;if(B){if(C>=A.length)break;D=A[C++]}else{C=A.next();if(C.done)break;D=C.value}D=D;u.add(D)}}}D=0;C=0;B=0;for(A=a.beRequests.values(),z=Array.isArray(A),y=0,A=z?A:A[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(z){if(y>=A.length)break;x=A[y++]}else{y=A.next();if(y.done)break;x=y.value}v=x;D+=j(b,b,v.requestStart);C+=v.serverGenTime;B+=v.jsmodsEnd-v.jsmodsStart;l(i[m?"blocking":"nonblocking"],v.responseStart-v.requestStart,[v.uri,!1]);for(w=c("objectEntries")(v.rsrcs),x=Array.isArray(w),v=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var E;if(x){if(v>=w.length)break;E=w[v++]}else{v=w.next();if(v.done)break;E=v.value}E=E;var F=E[0];E=E[1];for(var E=E,G=Array.isArray(E),H=0,E=G?E:E[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var I;if(G){if(H>=E.length)break;I=E[H++]}else{H=E.next();if(H.done)break;I=H.value}I=I;var J=I[0];I=I[1];u.has(J)||t[F].set(J,I)}}}J=n(t,b,r,q);return{ref:a.ref,components:a.components,timeslice_context:(I=a.timesliceContext)==null?void 0:I.name,start_time:b,err_count:q.size,resources:{t1:s,t2:p,t3:o,be:i,unpredicted:J,async:r},durations:{fetch_start_wait:a.fetchStartTime-b,be_start_wait:D,be_server_gen:C,be_jsmods:B,callback_wait:a.callbackStart-b,callback:a.callbackEnd-a.callbackStart,bootload_done_wait:a.callbackEnd-b,rdfd_requirelazy:e,rdfd_done_wait:f,rd_requirelazy:g,rd_done_wait:h}}}function e(a){a.start_time;var b=a.resources,d=a.durations;a=babelHelpers.objectWithoutPropertiesLoose(a,["start_time","resources","durations"]);for(var b=c("objectEntries")(b),e=Array.isArray(b),f=0,b=e?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=b.length)break;g=b[f++]}else{f=b.next();if(f.done)break;g=f.value}g=g;var h=g[0];g=g[1];for(var g=c("objectEntries")(g),i=Array.isArray(g),j=0,g=i?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(i){if(j>=g.length)break;k=g[j++]}else{j=g.next();if(j.done)break;k=j.value}k=k;var l=k[0];k=k[1];for(var k=c("objectEntries")(k),m=Array.isArray(k),n=0,k=m?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=k.length)break;o=k[n++]}else{n=k.next();if(n.done)break;o=n.value}o=o;var p=o[0];o=o[1];a[h+"_"+l+"_resources_"+p]=Math.round(Number(o))}}}for(p=c("objectEntries")(d),o=Array.isArray(p),n=0,p=o?p:p[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(o){if(n>=p.length)break;m=p[n++]}else{n=p.next();if(n.done)break;m=n.value}k=m;l=k[0];j=k[1];a[l+"_duration"]=Math.round(Number(j))}if(a.payloadStats){for(i=c("objectEntries")(a.payloadStats),g=Array.isArray(i),h=0,i=g?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(h>=i.length)break;f=i[h++]}else{h=i.next();if(h.done)break;f=h.value}e=f;b=e[0];d=e[1];for(m=c("objectEntries")(d),k=Array.isArray(m),l=0,m=k?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(k){if(l>=m.length)break;j=m[l++]}else{l=m.next();if(l.done)break;j=l.value}n=j;o=n[0];p=n[1];a[b+"_"+o+"_count"]=Math.round(Number(p))}}delete a.payloadStats}return a}g.computeHRData=a;g.computeBLData=b;g.flattenData=e}),98);
__d("BootloaderLoggingStatusEnum",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["SUCCESS","TIMEOUT"]);c=a;f["default"]=c}),66);
__d("CometBootloaderEventsTypedLoggerLite",["generateLiteTypedLogger"],(function(a,b,c,d,e,f){"use strict";e.exports=b("generateLiteTypedLogger")("logger:CometBootloaderEventsLoggerConfig")}),null);
__d("HasteResponseFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1823926");b=d("FalcoLoggerInternal").create("haste_response",a);e=b;g["default"]=e}),98);
__d("CometBootloaderLoggerUtil",["BootloaderEvents","BootloaderEventsPerf","CometBootloaderEventsTypedLoggerLite","CometTimeSpentNavigation","HasteResponseFalcoEvent","ResourceTimingStore","SiteData","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h=!1;function a(a){var b=a.bl_sample_rate,e=a.hr_sample_rate,f=a.parent_lid;if(h||!(b||e))return;h=!0;d("ResourceTimingStore").init();var g=function(a){return{ms_since_navstart:Math.round(a-c("performanceNavigationStart")()),parent_lid:f,pkg_cohort:c("SiteData").pkg_cohort,request_path:(a=c("CometTimeSpentNavigation").getPathInfo())==null?void 0:a.name,svn_rev:c("SiteData").client_revision}};e&&d("BootloaderEvents").onHasteResponse(function(a){return c("HasteResponseFalcoEvent").log(function(){var b=d("BootloaderEventsPerf").computeHRData(a),c=d("BootloaderEventsPerf").flattenData(b);return babelHelpers["extends"]({},c,g(b.start_time))})});var i=function(a,b,e){a=d("BootloaderEventsPerf").computeBLData(a);var f=d("BootloaderEventsPerf").flattenData(a);c("CometBootloaderEventsTypedLoggerLite").log(babelHelpers["extends"]({},f,g(a.start_time),{status:b}),{weight:e})};b&&d("BootloaderEvents").onBootload(function(a){return i(a,"SUCCESS",b)});var j=1;d("BootloaderEvents").onBootloaderCallbackTimeout(function(a){return i(a,"TIMEOUT",j)})}g.initLogging=a}),98);
__d("EBMessageRangeQuery",["Promise","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a={hasMoreAfter:!1,hasMoreBefore:!1,instanceKey:"123",messageAfterTimestamp:void 0,messageBeforeTimestamp:void 0,messages:[],threadId:"abc"};return a==null?(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("error")):(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult(a))}g.messageRangeQuery=a}),98);
__d("EBPointQuery",["Promise","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a={hasMoreAfter:!1,hasMoreBefore:!1,instanceKey:"123",messageAfterTimestamp:void 0,messageBeforeTimestamp:void 0,messages:[],threadId:"abc"};return a==null?(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("error")):(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult(a))}g.pointQuery=a}),98);
__d("EchoSerializationFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5722");b=d("FalcoLoggerInternal").create("echo_serialization_failure",a);e=b;g["default"]=e}),98);
__d("EchoSerializationSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5723");b=d("FalcoLoggerInternal").create("echo_serialization_success",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupTaskSkippedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5727");b=d("FalcoLoggerInternal").create("encrypted_backup_task_skipped",a);e=b;g["default"]=e}),98);
__d("MAWHandleEBRestoreWithHIM",["EchoMessage","FBLogger","MAWAckLevel","MAWHandleEchoMsgsRestoreApiUtils","MAWHandleEchoReactionsRestore","MAWJids","MAWMsgType","MAWProtocolQueueMsg","MAWProtocolQueueUtils","MAWSharedCOPLogger","MAWUnsafeCoerce","Promise","WAJids","WAPREList","WAProtocolQueue","WAStanzaUtils","WATimeUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Messages consumer: ",""]);i=function(){return a};return a}var j=new Set([d("EchoMessage").EchoMessageContentType.TEXT,d("EchoMessage").EchoMessageContentType.PLACEHOLDER]);function k(a){return c("gkx")("1645")&&j.has(a)}function l(a,b){if(a==="@me"||a==="@system")return b;else return a}function m(a,b,c,e,f){var g=[];if(a.reactionXOfflineThreadingIds!=null)for(var h=0;h<a.reactionXOfflineThreadingIds.length;++h){var i=d("MAWHandleEchoReactionsRestore").getReactionsForReactionStore(b,c,e,null,f,a);i=i.map(function(a){return{decodedMsg:{unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:a},stanza:q(a.externalId,a.ts,l(a.author,c),b,"reaction")}});g.push.apply(g,i)}return g}function n(a,b,c,e){return e?e.map(function(e){var f=e.messageId;return f!=null?{decodedMsg:{unstoredDbEditActionMsg:{ack:d("MAWAckLevel").ACK.sent,author:c,editMsgContent:{content:e.text},externalId:d("WAStanzaUtils").toStanzaId(f),originalMsgExternalId:a,serverTs:d("WATimeUtils").castToUnixTime(e.timestamp),ts:d("WATimeUtils").castToUnixTime(e.timestamp),type:d("MAWMsgType").MSG_TYPE.EDIT_ACTION},unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:void 0},stanza:q(d("WAStanzaUtils").toStanzaId(f),d("WATimeUtils").castToUnixTime(e.timestamp),c,b,"text")}:null}).filter(Boolean):[]}function o(a,b,c){return a.map(function(a){return p(a,b,c)}).filter(Boolean).flat()}function p(a,b,e){var f,g=a.from,h=d("MAWHandleEchoMsgsRestoreApiUtils").getDbMsgTypeFromEchoMessage(a);if(g==null||h==null)return null;h=a.xOfflineThreadingId;if(h==null){c("FBLogger")("labyrinth_web").warn("xOfflineThreadingId is null for Echo message");return null}h=d("WAStanzaUtils").toStanzaId(h);f=d("WATimeUtils").castToUnixTime(((f=a.authoritativeTimestampMs)!=null?f:a.sortOrderMs)/1e3);g=d("MAWJids").toUserJid(g.localKey);var i=s(a,b,e,h);if(i==null)return null;e=m(a,b,e,h,g);var j=a.contentType===d("EchoMessage").EchoMessageContentType.TEXT||a.contentType===d("EchoMessage").EchoMessageContentType.PLACEHOLDER?"text":"media";a=n(h,b,g,a.editHistory);return[{decodedMsg:i,stanza:q(h,f,g,b,j)}].concat(e,a)}function q(a,b,c,e,f){var g={icdc:null,metadata:null,protobuf:new Uint8Array(0),subprotocol:new Uint8Array(0),subprotocolType:"consumerMessage",type:"subprotocol",version:"v3"};g={device:{id:d("WAJids").DEFAULT_DEVICE_ID,identity:null},folder:null,id:{author:c,chat:e,externalId:a},msg:g,recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"};return{incomingType:"ebrestore",jid:e,message:{decrypted:g,details:{count:0,externalId:a,folder:void 0,from:d("WAJids").switchOnMsgrChatJidType(e,{group:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,groupJid:a,type:"group"}},user:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,deviceJid:d("WAJids").defaultDeviceJidForUser(c),type:"device"}}}),hideDecryptionFailure:!0,isInstamadillo:!1,offline:null,recipient:null,reportingMeta:null,retryCount:0,ts:b,type:f}},priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,stanzaId:a,stanzaQueueId:d("MAWUnsafeCoerce").unsafeCoerce(-1),type:"message"}}function r(a,b){return null}function s(a,b,c,e){c=d("MAWHandleEchoMsgsRestoreApiUtils").getUnstoredDbMessageFromEchoMessage(a,b,c,e);if(c==null)return null;c.originalTs;c.threadJid;c.unsendMsgContentDeleteTs;e=babelHelpers.objectWithoutPropertiesLoose(c,["originalTs","threadJid","unsendMsgContentDeleteTs"]);c=a.contentType===d("EchoMessage").EchoMessageContentType.MEDIA||a.contentType===d("EchoMessage").EchoMessageContentType.XMA;return{unstoredDbMedia:c?r(a,b):void 0,unstoredDbMsg:e,unstoredDbReaction:void 0}}function a(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=[],j=[];a.forEach(function(a){k(a.contentType)?j.push(a):g.push(a)});if(j.length!==0){a=o(j,e,f).filter(Boolean);var l=a.map(function(a){return d("MAWProtocolQueueUtils").addMetricToMessage(a,d("WAPREList").PRE_METRIC.EB_RESTORE_WITH_HIM)}),m=(yield d("MAWProtocolQueueMsg").handleIncomingMessagesStanzas(l)["catch"](function(a){c("MAWSharedCOPLogger").TAGS(["EB_RESTORE_WITH_HIM"]).ERROR(i(),a);l.forEach(function(a){a=a.receiveFlow;a.endFail("consumer_handle_message_db_error")});return(h||(h=b("Promise"))).resolve()}));m!=null&&m.followUpParams.incomingMsgs.forEach(function(a){var b=m.followUpParams.incomingMsgResults.get(a.stanza.message.decrypted.id);(b==null?void 0:b.success)===!0?a.receiveFlow.endSuccess():a.receiveFlow.endFail((b=b==null?void 0:(a=b.error)==null?void 0:a.type)!=null?b:"unknown handle incoming msg error")})}return g});return t.apply(this,arguments)}g.isHandleEbRestoreWithHIM=k;g.convertEchoMessages=o;g.convertEchoMessage=p;g.restoreWithHIM=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){a=a.signedPreKeyMixinArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),a)));return a}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"RotateSignedResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"RotateSignedResponseValidationError",value:h.value});case 10:i=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"RotateSignedResponseRequestError",value:i.value});case 13:j=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"RotateSignedResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:g,ValidationError:h,RequestError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);function a(){var a,c,e,f,g,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:n.LOG(m());u.prev=1;u.next=4;return b("regeneratorRuntime").awrap(d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WACryptoManager").generateSignedPreKey(a)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0}));case 4:a=u.sent;n.LOG(l());u.next=8;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a)}));case 8:c=u.sent;u.t0=c.name;u.next=u.t0==="RotateSignedResponseValidationError"?12:u.t0==="RotateSignedResponseRequestError"?15:u.t0==="RotateSignedResponseServerError"?19:23;break;case 12:e=c.value,f=e.errorCode,g=e.errorText,o=e.errorIdentityKeyMixin;n.ERROR(k(),f,g);return u.abrupt("return",d("WAResultOrError").makeError({type:"validation-error",identity:o.elementValue}));case 15:p=c.value.errorRequestErrors.value.code;q=c.value.errorRequestErrors.name;n.ERROR(j(),p,q);return u.abrupt("return",d("WAResultOrError").makeError({type:"request-error"}));case 19:r=c.value.errorServerErrors.value.code;s=c.value.errorServerErrors.name;n.ERROR(i(),r,s);return u.abrupt("return",d("WAResultOrError").makeError({type:"server-error"}));case 23:c.name;n.LOG(h());return u.abrupt("return",d("WAResultOrError").makeResult());case 26:u.next=36;break;case 28:u.prev=28;u.t1=u["catch"](1);t=d("WAErrorMessage").maybeGetMessageFromError(u.t1);if(!t.includes("No lastSignedPrekeyId and registration")){u.next=35;break}u.next=34;return b("regeneratorRuntime").awrap(d("WAHandleFailureUtils").reregisterPhone());case 34:return u.abrupt("return",d("WAResultOrError").makeError({type:"no-prekey-reregistered"}));case 35:throw u.t1;case 36:case"end":return u.stop()}},null,this,[[1,28]])}g.rotateSignedPreKeyProtocol=a}),98);
__d("WARotateSignedPreKey",["Promise","WAErr","WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekeyRotation,c("WALoggerTag").SignedPrekey]);function a(a){var e;return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(d("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol());case 2:e=a.sent;if(!(e.success||e.error.type==="no-prekey-reregistered")){a.next=5;break}return a.abrupt("return");case 5:if(!(e.error.type==="validation-error")){a.next=9;break}l.ERROR(k());d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"signed prekey failed server validation"})["catch"](function(a){l.ERROR(j(),a)});return a.abrupt("return",(h||(h=b("Promise"))).resolve());case 9:l.ERROR(i());throw c("WAErr")("rotateSignedPreKey RPC failed: "+e.error.type);case 11:case"end":return a.stop()}},null,this)}g.rotateSignedPreKey=a}),98);
__d("WebWorkerInitDeferred",["cr:7429"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a.blLoggingCavalryFields&&b("cr:7429").initLogging(a.blLoggingCavalryFields)}g.initDeferred=a}),98);/*FB_PKG_DELIM*/
__d("Base64Utils",["XPlatReactTextEncoder","base64Binary"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("base64Binary").encode(new(d("XPlatReactTextEncoder").TextEncoder)().encode(a))}function b(a){return d("base64Binary").encode(new Uint8Array(a))}function c(a){return d("base64Binary").decode(a).buffer}g.encodeUnicode=a;g.fromArrayBuffer=b;g.toArrayBuffer=c}),98);
__d("CryptoLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("FBLogger")("labyrinth_web","crypto."+a)}function b(a,b){return b instanceof Error?a.catching(b):a}g.CryptoLogger=a;g.captureError=b}),98);
__d("LSAppendDataTraceAddonStoredProcedure",["LSAppendDataTraceAddon","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.dataTraceId;d[1]=b.checkPointId;d[2]=b.syncChannel;d[3]=b.errorMessage;d[4]=b.tags;return c("LSAppendDataTraceAddon").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSBase64Encode.nop",["Base64Utils","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){return(h||(h=b("Promise"))).resolve(c("LSResult")(f?d("Base64Utils").fromArrayBuffer(f):void 0))};g["default"]=a}),98);
__d("LSCreateDataTrace",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(153).add({traceId:a[0],initTimestampMs:c[0],traceType:a[4],shouldFlush:!1,contextOne:a[1],contextTwo:a[2],contextThree:a[3]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSDataTraceCreateDataTraceStoredProcedure";e.exports=a}),null);
__d("LSCreateDataTraceID.nop",["LSRequestId","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d){return(h||(h=b("Promise"))).resolve(c("LSResult")(c("LSRequestId").generate()))};g["default"]=a}),98);
__d("LSEncryptedBackupsBackupTenancy",[],(function(a,b,c,d,e,f){a=Object.freeze({PRODUCTION:1,SHADOW:2,OPEN:3});f["default"]=a}),66);
__d("updateAndFlushLSDataTrace",["I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","Promise","ReQLTable","requireDeferred","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("LSDataTraceFlush").__setRef("updateAndFlushLSDataTrace");function a(a,e){return e==null?(j||(j=b("Promise"))).resolve():c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").CLIENT_READY_TO_FLUSH),dataTraceId:e,syncChannel:(i||(i=d("I64"))).neg_one}).then(function(){return d("ReQLTable").update(a.data_trace_meta,[e],function(a){if(a!=null)return{contextOne:a.contextOne,contextThree:a.contextThree,contextTwo:a.contextTwo,foregroundTimestampMs:a.foregroundTimestampMs,initTimestampMs:a.initTimestampMs,predefinedId:a.predefinedId,shouldFlush:!0,traceId:a.traceId,traceType:a.traceType};else throw c("unrecoverableViolation")("Data trace is missing "+e,"maw_db")}).then(function(){return k.load().then(function(b){return b.flush(a,e)})})})}g["default"]=a}),98);
__d("LSFlushDataTrace.nop",["MetaConfig","Promise","ReQL","updateAndFlushLSDataTrace"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){return!c("MetaConfig")._("62")?(h||(h=b("Promise"))).resolve():d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.data_trace_meta).getKeyRange(f)).then(function(d){if(d!=null)return c("updateAndFlushLSDataTrace")(a,f);else return(h||(h=b("Promise"))).resolve()})};g["default"]=a}),98);
__d("LSGetBlobFromString.nop",["CryptoLogger","LSResult","Promise","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){a=new(d("XPlatReactTextEncoder").TextEncoder)();try{e=a.encode(f).buffer;return(h||(h=b("Promise"))).resolve(c("LSResult")(e))}catch(g){e=d("CryptoLogger").CryptoLogger("get_blob_from_string");e.catching(g).mustfix(g.message?g.message:"Error in get blob from string.");e=a.encode(f).buffer;return(h||(h=b("Promise"))).resolve(c("LSResult")(e))}};g["default"]=a}),98);
__d("LSHmac_v2.nop",["CryptoLogger","LSResult","Promise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g){return d("XPlatReactCrypto").subtleImportKey("raw",f,{hash:"SHA-256",name:"HMAC"},!1,["sign"]).then(function(a){return d("XPlatReactCrypto").subtleSign("HMAC",a,g)}).then(function(a){return(h||(h=b("Promise"))).resolve(c("LSResult")(a))})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("hmac_v2"),a).mustfix("Crypto signing failed");throw a})};g["default"]=a}),98);
__d("LSIsEncryptionVersionSecure",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.i64.eq(a[0],b.i64.cast([0,4]))?c[0]=!1:(b.i64.eq(a[0],b.i64.cast([0,3]))?c[1]=!0:(b.i64.eq(a[0],b.i64.cast([0,2]))?c[2]=!0:(b.i64.eq(a[0],b.i64.cast([0,0]))?c[3]=!0:(b.i64.eq(a[0],b.i64.cast([0,99]))?c[4]=!1:c[4]=!1,c[3]=c[4]),c[2]=c[3]),c[1]=c[2]),c[0]=c[1]),d[0]=c[0],b.resolve(d)}a.__sproc_name__="LSEncryptedBackupsVersioningIsEncryptionVersionSecureStoredProcedure";e.exports=a}),null);
__d("LSIsMobileClient",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return c[0]=!1,b.resolve(c)}a.__sproc_name__="LSEncryptedBackupsIsMobileClientStoredProcedure";e.exports=a}),null);
__d("LSIssueNewEbTaskAndGetTaskIDV2",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],void 0,void 0,c.i64.cast([0,0]),a[3],a[4],void 0,a[5],a[7]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueNewEbTaskAndGetTaskIDV2StoredProcedure";e.exports=a}),null);
__d("MebClientLogsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("3226");b=d("FalcoLoggerInternal").create("meb_client_logs",a);e=b;g["default"]=e}),98);
__d("LSLogMebClientEvent.nop",["I64","LSVec","MebClientLogsFalcoEvent","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j,k){c("MebClientLogsFalcoEvent").log(function(){return{calling_class:f,device_family_id:void 0,device_registration_id:void 0,log_level:(i||(i=d("I64"))).to_string(k),msg:g,trace_ids:c("LSVec").toArray(j)}});return(h||(h=b("Promise"))).resolve()};g["default"]=a}),98);
__d("LSMediaUrlAttachment",["I64","LSMediaUrlUtils","rewriteFallbackUrl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.previewUrlExpirationTimestampMs;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired(b)?c("rewriteFallbackUrl")(a.previewUrlFallback):a.previewUrl}function b(a){var b=a.previewUrlExpirationTimestampMs;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired(b)?c("rewriteFallbackUrl")(a.previewUrlFallback):a.previewUrlLarge}function e(a){var b=a.playableUrlExpirationTimestampMs;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired(b)?c("rewriteFallbackUrl")(a.playableUrlFallback):a.playableUrl}function f(a){var b=a.imageUrlExpirationTimestampMs;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired(b)?c("rewriteFallbackUrl")(a.imageUrlFallback):a.imageUrl}function i(a){var b=a.faviconUrlExpirationTimestampMs;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired(b)?c("rewriteFallbackUrl")(a.faviconUrlFallback):a.faviconUrl}function j(a){try{var b=a.listItemContactUrlExpirationTimestampList1;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired((h||(h=d("I64"))).of_string(b))?c("rewriteFallbackUrl")(a.listItemContactUrlFallbackList1):a.listItemContactUrlList1}catch(b){return a.listItemContactUrlList1}}function k(a){try{var b=a.listItemContactUrlExpirationTimestampList2;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired((h||(h=d("I64"))).of_string(b))?c("rewriteFallbackUrl")(a.listItemContactUrlFallbackList2):a.listItemContactUrlList2}catch(b){return a.listItemContactUrlList2}}function l(a){try{var b=a.listItemContactUrlExpirationTimestampList3;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired((h||(h=d("I64"))).of_string(b))?c("rewriteFallbackUrl")(a.listItemContactUrlFallbackList3):a.listItemContactUrlList3}catch(b){return a.listItemContactUrlList3}}function m(a){var b=a.headerImageUrlExpirationTimestampMs;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired(b)?c("rewriteFallbackUrl")(a.headerImageUrlFallback):a.headerImageUrl}function n(a){try{var b=a.listItemProfilePictureUrlExpirationTimestamp1;if(b!=null&&d("LSMediaUrlUtils").isTimestampExpired((h||(h=d("I64"))).of_string(b)))return c("rewriteFallbackUrl")(a.listItemProfilePictureUrlFallback1);else return a.listItemProfilePictureUrl1}catch(b){return a.listItemProfilePictureUrl1}}function o(a){try{var b=a.listItemProfilePictureUrlExpirationTimestamp2;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired((h||(h=d("I64"))).of_string(b))?c("rewriteFallbackUrl")(a.listItemProfilePictureUrlFallback2):a.listItemProfilePictureUrl2}catch(b){return a.listItemProfilePictureUrl2}}function p(a){try{var b=a.listItemProfilePictureUrlExpirationTimestamp3;return b!=null&&d("LSMediaUrlUtils").isTimestampExpired((h||(h=d("I64"))).of_string(b))?c("rewriteFallbackUrl")(a.listItemProfilePictureUrlFallback3):a.listItemProfilePictureUrl3}catch(b){return a.listItemProfilePictureUrl3}}g.previewUrl=a;g.previewUrlLarge=b;g.playableUrl=e;g.imageUrl=f;g.faviconUrl=i;g.listItemContactUrlList1=j;g.listItemContactUrlList2=k;g.listItemContactUrlList3=l;g.headerImageUrl=m;g.listItemProfilePictureUrl1=n;g.listItemProfilePictureUrl2=o;g.listItemProfilePictureUrl3=p}),98);
__d("LSOcmfClientMap.nop",["CryptoLogger","LSResult","Promise","XPlatReactCrypto","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ristretto255").__setRef("LSOcmfClientMap.nop");a=function(a,e,f,g){return(h||(h=b("Promise"))).all([d("XPlatReactCrypto").subtleDigest("SHA-512",g),i.load()]).then(function(a){var b=a[0];a=a[1];b=a.fromHash(new Uint8Array(b));a=a.scalarMult(new Uint8Array(f),b);return c("LSResult")(a.buffer)})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_map"),a).mustfix("Failed OcmfClientMap.");throw a})};g["default"]=a}),98);
__d("MAWDeanonMessagesMetadataQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="25233882372925667"}),null);
__d("MAWDeanonMessagesMetadataQuery.graphql",["MAWDeanonMessagesMetadataQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"data"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"data"}],concreteType:"XFBTDeanonMessagesResponse",kind:"LinkedField",name:"xfb_fetch_deanon_messages_data",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"offline_threading_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sort_order_ms",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"MAWDeanonMessagesMetadataQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"MAWDeanonMessagesMetadataQuery",selections:c},params:{id:b("MAWDeanonMessagesMetadataQuery_facebookRelayOperation"),metadata:{},name:"MAWDeanonMessagesMetadataQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWDeanonMessagesMetadataQuery",["CometRelay","FBLogger","I64","MAWDeanonMessagesMetadataQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h!==void 0?h:h=b("MAWDeanonMessagesMetadataQuery.graphql");function a(a,b,e,f,g){g===void 0&&(g=null);return d("CometRelay").fetchQuery(a,j,{data:{act_thread_id:b,direction:e,reference_timestamp:g,requested_messages:f}}).toPromise().then(function(a){a=a==null?void 0:a.xfb_fetch_deanon_messages_data;var b=new Set();return((a=a)!=null?a:[]).map(function(a){var e=a.offline_threading_id;e!=null&&(b.has(e)&&c("FBLogger")("labyrinth_web").warn("[MAWDeanonMessagesMetadataQuery] Duplicate message returned from server in the deanon API"),b.add(e));return{offline_threading_id:a.offline_threading_id,sort_order_ms:a.sort_order_ms!=null?(i||(i=d("I64"))).of_string(a.sort_order_ms):null}})})}g.fetchDeanonMsgsMetadata=a}),98);
__d("MAWEBFrontendQPLLogger",["MAWBridgeFireAndForget","QPLUserFlow","Random","gkx","hashString","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("Random").uint32();c("QPLUserFlow").start(c("qpl")._(521478596,"1329"),{instanceKey:a});return a}function b(a){if(a==null)return;c("QPLUserFlow").addPoint(c("qpl")._(521478596,"1329"),"processing_threads_from_occamadillo",{instanceKey:a})}function e(a,b){if(a==null)return;b===!0?c("QPLUserFlow").addPoint(c("qpl")._(521478596,"1329"),"backup_restore_completed_success",{instanceKey:a}):c("QPLUserFlow").addPoint(c("qpl")._(521478596,"1329"),"backup_restore_completed_failed",{instanceKey:a})}function f(a,b,d){if(a==null)return;if(b===!0)c("QPLUserFlow").endSuccess(c("qpl")._(521478596,"1329"),{instanceKey:a});else{d=(b=d)!=null?b:"dyi_e2e_failed_unspecifed_reason";c("QPLUserFlow").endFailure(c("qpl")._(521478596,"1329"),d,{instanceKey:a})}}function h(a,b,d){if(c("gkx")("23946")!==!0||a==null)return;a=c("hashString")(a);c("QPLUserFlow").addPoint(c("qpl")._(521485625,"1876"),b,{data:d,instanceKey:a})}function i(a,b,d){if(c("gkx")("23946")!==!0||a==null)return;a=c("hashString")(a);c("QPLUserFlow").addPoint(c("qpl")._(521485625,"1876"),b,{data:d,instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(521485625,"1876"),{annotations:d,instanceKey:a})}function j(a,b,d){if(c("gkx")("23946")!==!0||a==null)return;a=c("hashString")(a);if(b){c("QPLUserFlow").endSuccess(c("qpl")._(521485625,"1876"),{instanceKey:a});return}c("QPLUserFlow").endFailure(c("qpl")._(521485625,"1876"),(b=d)!=null?b:"upload_message_backup_failed",{instanceKey:a})}function k(a,b,c){d("MAWBridgeFireAndForget").fireAndForget("backend","addEbUploadTrackingWorkerQPL",{annotations:c,pointName:b,qplInstanceKey:a,qplType:"point"})}function l(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","addEbUploadTrackingWorkerQPL",{annotations:b,pointName:"upload_tracking_completed",qplInstanceKey:a,qplType:"success"})}function m(a,b,c){d("MAWBridgeFireAndForget").fireAndForget("backend","addEbUploadTrackingWorkerQPL",{annotations:c,pointName:b,qplInstanceKey:a,qplType:"fail"})}g.startDyiQplE2EUserFlow=a;g.logDyiE2EProcessThreadsFromOccamadillo=b;g.logDyiE2EDyiBackupRestoreCompleted=e;g.endDyiE2ECompleted=f;g.addPointUploadMessageBackup=h;g.addPointAndEndFlowUploadMessageBackup=i;g.endFlowUploadMessageBackup=j;g.addPointEBUploadTracking=k;g.endEBUploadTracking=l;g.failEBUploadTracking=m}),98);
__d("MAWEncryptedBackupUtils",["FBLogger","I64","LSAuthorityLevel","LSDataTraceCheckPoint","LSIntEnum","MAWDeanonMessagesMetadataQuery","MAWEBFrontendQPLLogger","MAWTraceUtils","Promise","ReQL","XPlatRelayEnvironment","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c,e,f){d("MAWTraceUtils").recordCheckpointForTrace(a,b,c,e,f)}function a(a,e,f){d("MAWEBFrontendQPLLogger").addPointUploadMessageBackup(e,"get_backup_tenancy");k(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_GET_BACKUP_TENANCY),[],!1);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_client_state)).then(function(a){var e;if(a==null){f!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(f,"get_backup_tenancy_null_client_state_row");return(h||(h=b("Promise"))).resolve()}e=(e=a.backupTenancy)!=null?e:(i||(i=d("I64"))).one;a=a.authorityLevel;if(f!=null){var g;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(f,"get_backup_tenancy",{"int":{authorityLevel:(i||(i=d("I64"))).to_int32((g=a)!=null?g:(i||(i=d("I64"))).zero),backupTenancy:i.to_int32((g=e)!=null?g:(i||(i=d("I64"))).zero)}})}if(e!=null&&(i||(i=d("I64"))).equal((j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a))return e})}function e(a,b){var d=new Set(),e=a.length;for(a of a.entries()){var f=a[0],g=a[1];d.has(g)&&c("FBLogger")("labyrinth_web").warn("Duplicate messages returned from server for restoreType: %s, index: %s of batchSize: %s",b,f,e);d.add(g)}}function f(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){try{a=(yield d("MAWDeanonMessagesMetadataQuery").fetchDeanonMsgsMetadata(d("XPlatRelayEnvironment").getRelayEnvironment(),a,"BEFORE",b,e));return a.reduce(function(a,b){var c=b.offline_threading_id;b=b.sort_order_ms;b!=null&&c!=null&&a.push({externalId:c,msgType:"unknown-deanon",sortOrderMs:(i||(i=d("I64"))).to_float(b)});return a},[]).reverse()}catch(a){c("FBLogger")("messenger_web_missing_messages").catching(a).mustfix("Deanon GraphQL fails with error")}});return l.apply(this,arguments)}g.getBackupTenancy=a;g.logIfDuplicateMessagesFoundInRestore=e;g.getMessageMetadataFromDeanonAPI=f}),98);
__d("MWChatEncryptedBackupsQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("qpl"))._(521476140,"378");d=a._(521472542,"295");e=a._(521482085,"409");f=a._(521482763,"296");c=a._(521484295,"1460");var h=a._(521482969,"1519"),i=a._(521479124,"1939"),j=a._(521474385,"263"),k=a._(521476098,"504"),l=a._(521482858,"1290"),m=a._(521473194,"1331");a=a._(521471024,"2275");g.pinCodeChangeQplEvent=b;g.optOutQplEvent=d;g.backupSetupQplEvent=e;g.restoreQplEvent=f;g.restoreDeviceAuthQplEvent=c;g.messageRestoreQplEvent=h;g.restoreWithAutoRestoreConsentQplEvent=i;g.hsmFleetMigrationQplEvent=j;g.virtualDeviceRevocationQplEvent=k;g.onboardingAuthQplEvent=l;g.processBackupIdsQPLEvent=m;g.fetchBackupIdsQPLEvent=a}),98);
__d("MWEncryptedBackUpEBNotEnabledError",[],(function(a,b,c,d,e,f){"use strict";a="EB not enabled";f.EB_NOT_ENABLED=a}),66);
__d("MWXDivider.react",["BaseDivider.react"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("BaseDivider.react")}),98);
__d("MWXMenuItem.react",["BaseTheme.react","MWXSvgIcon","MWXThreadThemeColor","MessengerWebUXLogger","cr:2466","cr:4318","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;var j=e.useCallback,k=e.useMemo;e=i.forwardRef(a);function a(a,e){a=babelHelpers["extends"]({},a);var f=a.icon,g=a.iconColor,h=a.loggingEvent,k=a.onClick;a=babelHelpers.objectWithoutPropertiesLoose(a,["icon","iconColor","loggingEvent","onClick"]);var m=g instanceof d("MWXThreadThemeColor").MWXThreadThemeColor?"primary":g,n=c("MessengerWebUXLogger").useInteractionLogger(),o=j(function(a){k==null?void 0:k(a),h&&(n==null?void 0:n(h))},[n,h,k]);if(b("cr:4318")!=null)return i.jsx(l,{iconColor:g,children:i.jsx(b("cr:4318"),babelHelpers["extends"]({icon:f,iconColor:m,onClick:o},a,{ref:e}))});return b("cr:2466")!=null?i.jsx(l,{iconColor:g,children:i.jsx(b("cr:2466"),babelHelpers["extends"]({icon:f instanceof d("MWXSvgIcon").MWXSvgMenuItemIcon?f.component:f,iconColor:m,onClick:o},a,{ref:e}))}):null}a.displayName=a.name+" [from "+f.id+"]";a=e;function l(a){var b=a.children,e=a.iconColor;a=k(function(){return e instanceof d("MWXThreadThemeColor").MWXThreadThemeColor?{dark:{"primary-icon":e.color},light:{"primary-icon":e.color},type:"VARIABLES"}:void 0},[e]);return a==null?b:i.jsx(c("BaseTheme.react"),{config:a,children:b})}l.displayName=l.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWXPopoverLoadingState.react",["cr:2518","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||d("react");g["default"]=b("cr:2518")}),98);/*FB_PKG_DELIM*/
__d("LSCreateOpenToE2EEThreadLink",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(193).put({openThreadId:a[0],armadilloThreadId:a[1],showOpenMessageHistory:a[2],timestampMs:a[3]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateOpenToE2EEThreadLinkStoredProcedure";e.exports=a}),null);
__d("LSShimHybridThreadDeleteUtil",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table).getKeyRange(b)).then(function(a){return a})}function c(a,c){if(c!=null)return(h||(h=b("Promise"))).all([a.threads["delete"](c.serverThreadKey),a.mi_act_mapping_table["delete"](c.serverThreadKey,c.clientThreadPk,c.jid)]).then(function(){});else return(h||(h=b("Promise"))).resolve()}g.getMiActMappingRow=a;g.deleteE2EEMetadataTable=c}),98);
__d("LSShimHybridThreadDeleteByThreadKey.nop",["LSShimHybridThreadDeleteUtil","asyncToGeneratorRuntime","qex"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(c("qex")._("1016")!==!0&&c("qex")._("1034")!==!0){b=(yield d("LSShimHybridThreadDeleteUtil").getMiActMappingRow(a,e));return d("LSShimHybridThreadDeleteUtil").deleteE2EEMetadataTable(a,b)}});function e(b,c,d){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("LSHybridThreadDelete",["LSShimHybridThreadDeleteByThreadKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSShimHybridThreadDeleteByThreadKey.nop"),a[0])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxHybridThreadDeleteStoredProcedure";e.exports=a}),null);
__d("LSMoveThreadToE2EECutoverFolder",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?0:(c.item,b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){var c=a.update;a.item;return c({folderName:"e2ee_cutover",parentThreadKey:b.i64.cast([-1,4294967279])})}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxMoveThreadToE2EECutoverFolderStoredProcedure";e.exports=a}),null);
__d("LSReplaceOptimisticThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(9).fetch([[[a[1]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?b.forEach(b.filter(b.db.table(9).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.le(c.authorityLevel,b.i64.cast([0,20]))}),function(c){var d=c.update;c.item;return d({threadKey:a[1],authorityLevel:b.i64.cast([0,40])})}):(c.item,b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){return a["delete"]()}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxReplaceOptimisticThreadStoredProcedure";e.exports=a}),null);
__d("LSShimCopyAllParticipantNicknamesForThread",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1],d=[];return c("gkx")("26379")===!1?0:0,b.resolve(d)}a.__sproc_name__="LSMailboxShimCopyAllParticipantNicknamesForThreadStoredProcedure";b=a;g["default"]=b}),98);
__d("LSShimGetServerThreadKeyFromJIDV2.nop",["ReQL","RetUtil","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(c)));return d("RetUtil").getNullableRetResult(b==null?void 0:b.serverThreadKey)});function c(b,c,d){return a.apply(this,arguments)}return c}();g["default"]=a}),98);
__d("MAWMiActBulkCreateThreadInActWithMiData",["I64","MAWBridgeFireAndForget","MAWBridgeSendAndReceive","MAWJids","MAWMIC","MAWTrackPendingOccamadilloThreads","MAWWaitForBackendSetup","MWCookieUtil","Promise","WABridgedAPI","WAJids","WALoggerDeferred","asyncToGeneratorRuntime","getErrorSafe","gkx","promiseDone","useMWInboxURIState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Querying WA server for group: ",""]);j=function(){return a};return a}var k=1,l=10,m=10,n=20;function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var e=function(){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","bulkCreateThread",{threads:f})},f=a.map(function(a){var b=a.fbid,e=a.isGroupThread,f=a.jid,g=a.lastActivityTimestampMs;a=a.lastReadWatermarkTimestampMs;f=(i||(i=d("I64"))).to_string(f);f=e?d("WAJids").toGroupJid(f):d("MAWJids").toUserJid(f);var h=d("MWCookieUtil").getAutoChatTabFromCookie();h=h?(i||(i=d("I64"))).equal(h.threadKey,b):!1;var j=h?l:k;j=c("gkx")("33030")&&!h&&!e?m:j;h=document.URL;e=d("useMWInboxURIState").getRouteTokens(h);c("gkx")("2316")&&e.indexOf((i||(i=d("I64"))).to_string(b))>-1&&(j=n);return{authoritativeThreadKey:i.to_string(b),chatJid:f,lastActivityTimestampMs:i.to_float(g),lastReadWatermarkTimestampMs:i.to_float(a),numOfMsgsToLoad:j}});e=(yield c("gkx")("4568")?d("MAWWaitForBackendSetup").waitForBackendSetup("bulk-occamadillo-mapping-await").then(e):e());d("MAWMIC").markEvent("occamadillo_mapping_bridge_event_received");yield (h||(h=b("Promise"))).all(e.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){if(b.status==="rejected")throw b.reason;e=a[e];var f=e.isGroupThread;e=e.jid;e=(i||(i=d("I64"))).to_string(e);if(f){f=d("WAJids").toGroupJid(e);if(b.value.isCreated||c("gkx")("23923")&&b.value.shouldQueryForGroup){c("promiseDone")(d("WALoggerDeferred").DEV(j(),e));try{yield c("WABridgedAPI").queryGroups({groups:[f],type:"array"})}catch(a){var g=a instanceof Error&&a.message.includes('"errorCode":403');if(!g)throw a}d("MAWBridgeFireAndForget").fireAndForget("backend","checkIfGroupParticipant",{threadJid:b.value.chatJid})}else c("gkx")("33036")&&d("MAWBridgeFireAndForget").fireAndForget("backend","updateLSThreadFromGroupInfo",{groupJid:f})}c("promiseDone")(d("MAWTrackPendingOccamadilloThreads").removePendingThread(e))});return function(a,b){return e.apply(this,arguments)}}()));return e}catch(a){d("MAWMIC").fail("thread_mapping_error",c("getErrorSafe")(a));throw a}});return o.apply(this,arguments)}g.miActBulkCreateThreadInActWithMiData=a}),98);
__d("WABatcher",["Promise","WAErr","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){var e=a.delayMs,f=a.maxSize,g=null;function i(a){g&&g.args===a&&(g=null);return d(a)}var j=function(){if(g==null)return(h||(h=b("Promise"))).resolve();var a=g;g=null;clearTimeout(a.timer);a.run();return a.batchPromise};a=function(a){if(g)g.args.push(a);else{var d,k=[a];a=new(h||(h=b("Promise")))(function(a){d=function(){return void a(k)}}).then(i);var l=d;g={args:k,batchPromise:a,run:l,timer:setTimeout(l,e)}}if(g==null)throw c("WAErr")("activeBatch should not be null here");a=g;l=a.args;a=a.batchPromise;var m=l.length-1;f!=null&&l.length>=f&&void j();return a.then(function(a){return a[m]})};return{accept:a,runActiveBatch:j}}function a(a,b){var c=i(a,b);return function(a){return c.accept(a)}}function e(a){var e=[],f=new(d("WAResolvable").Resolvable)(),g=function(c){if(e.length===0)return(h||(h=b("Promise"))).resolve(new Map());var g=e,i=f;e=[];f=new(d("WAResolvable").Resolvable)();return(h||(h=b("Promise"))).resolve(a(g,c)).then(function(a){i.resolve(a);return a})},i=function(a){e.push(a);return f.promise.then(function(b){b=b.get(a);if(b==null)throw c("WAErr")("This should not happen because we just added it to the batch");return b})};return{accept:i,runActiveBatch:g}}g.createSimpleBatcher=i;g.batch=a;g.createBatcher=e}),98);
__d("LSShimVerifyThreadExists.nop",["I64","LSAuthorityLevel","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSPlatformArmadilloUtils","LSVec","LSVerifyContactRowExistsStoredProcedure","MAWMiActBulkCreateThreadInActWithMiData","MAWMiActCreateThreadInActWithMiData","MAWTrackPendingOccamadilloThreads","MWCookieUtil","Promise","ReQL","TemporaryLoggingUtilsForS406998Only","WABatcher","WALoggerDeferred","asyncToGeneratorRuntime","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] MI thread insertion for fbid: "," with last activity timestamp: "," and last read timestamp: ",", read = ",""]);k=function(){return a};return a}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){yield (j||(j=b("Promise"))).all(c("LSVec").toArray(f).map(function(b){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:h.ofNumber(0),contactIdType:h.ofNumber(c("LSContactIdType").FBID),contactType:h.ofNumber(c("LSContactType").USER),contactViewerRelationship:h.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:h.ofNumber(c("LSContactGender").UNKNOWN),id:b,isBlocked:!1,isMemorialized:!1,isSelf:!1,workForeignEntityType:h.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)}).then(function(){return a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),contactId:b,deliveredWatermarkTimestampMs:(i||(i=d("I64"))).zero,groupParticipantJoinState:h.ofNumber(c("LSGroupParticipantJoinState").MEMBER),isModerator:!1,readActionTimestampMs:i.zero,readWatermarkTimestampMs:i.zero,threadKey:e},"LSShimVerifyThreadExists.nop"))})}))});return m.apply(this,arguments)}function n(a,b,c){return a.mi_act_mapping_table.put({clientThreadPk:(i||(i=d("I64"))).neg(b),jid:c,serverThreadKey:b})}a=200;e=15;var o=d("WABatcher").createSimpleBatcher({delayMs:a,maxSize:e},function(a){c("promiseDone")(d("MAWMiActBulkCreateThreadInActWithMiData").miActBulkCreateThreadInActWithMiData(a));return[]});d("LSPlatformArmadilloUtils").executeOnThreadMappingEnd(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o.runActiveBatch()}));f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,j,m,p){b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table).getKeyRange(e)));b==null&&(yield n(a,e,f));c("promiseDone")(d("WALoggerDeferred").LOG(k(),(i||(i=d("I64"))).to_string(e),i.to_string(m),i.to_string(p),i.le(m,p)));c("gkx")("773")||(yield l(a,e,g));h=d("MWCookieUtil").getAutoChatTabFromCookie();b=h?(i||(i=d("I64"))).equal(h.threadKey,e):!1;d("MAWTrackPendingOccamadilloThreads").addPendingThread(i.to_string(f));!b&&c("gkx")("1623")?c("promiseDone")(o.accept({fbid:e,isGroupThread:j,jid:f,lastActivityTimestampMs:m,lastReadWatermarkTimestampMs:p})):c("promiseDone")(d("MAWMiActCreateThreadInActWithMiData").miActCreateThreadInActWithMiData(e,f,m,p,j));return});function e(b,c,d,e,f,g,h,i,j){return a.apply(this,arguments)}return e}();g["default"]=f}),98);
__d("LSTransportHybridParticipantUpdateReceipts",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTransportHybridParticipantUpdateReceiptsStoredProcedure";e.exports=a}),null);
__d("LSUpdateOccamadilloMostRecentMessagePerThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(292).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[1]=b.i64.of_float(Date.now()),b.db.table(292).add({threadKey:a[0],timestampMs:a[1],fetchTimestampMs:c[1]})):(e=d.item,c[2]=e.fetchTimestampMs,c[1]=b.i64.of_float(Date.now()),b.i64.neq(c[2],void 0)?b.i64.ge(c[1],b.i64.add(c[2],b.i64.cast([0,2592e6])))?b.db.table(292).put({threadKey:a[0],timestampMs:a[1],fetchTimestampMs:c[1]}):b.resolve():b.forEach(b.db.table(292).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({fetchTimestampMs:c[1]})}))})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateOccamadilloMostRecentMessagePerThreadStoredProcedure";e.exports=a}),null);
__d("LSUpdateOptimisticContextThreadKeys",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.filter(b.db.table(32).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})},function(c){return b.forEach(b.filter(b.db.table(31).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateOptimisticContextThreadKeysStoredProcedure";e.exports=a}),null);
__d("LSUpdateTaskQueueName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b.item;return c({queueName:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateTaskQueueNameStoredProcedure";e.exports=a}),null);
__d("LSUpdateTaskValue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b=b.item;return c({taskValue:b.taskValue.split(a[1]).join(a[2])})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateTaskValueStoredProcedure";e.exports=a}),null);
__d("LSUpdateThreadAuthorityAndMapping",["LSDeleteThread","LSReplaceOptimisticThread","LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateOptimisticContextThreadKeys","LSUpdateTaskQueueName","LSUpdateTaskValue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(b){return c.filter(c.db.table(9).fetch(),function(b){return c.i64.eq(b.threadKey,a[2])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(e){return d[5]=c.i64.neq(d[0],void 0),d[7]=c.i64.eq(d[0],a[2])&&d[5],!d[7]&&!(c.i64.eq(d[0],a[1])&&d[5])&&d[5]?function(a){c.logger(a).mustfix(a)}("The mi_act_mapping row did not correspond to either the authoritative or optimistic thread key."):0,c.i64.neq(a[2],void 0)?d[6]=a[2]:d[6]=c.i64.cast([0,0]),d[5]?d[7]?c.sequence([function(e){return d[1]?c.storedProcedure(b("LSDeleteThread"),a[1],!1):c.resolve()},function(a){return c.i64.neq(d[6],void 0)?c.forEach(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.storedProcedure(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.storedProcedure(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):d[3]?c.storedProcedure(b("LSDeleteThread"),d[6],!1):c.resolve():d[3]?d[1]?c.storedProcedure(b("LSDeleteThread"),d[6],!1):c.sequence([function(a){return c.i64.neq(d[6],void 0)?c.forEach(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.storedProcedure(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.storedProcedure(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):c.resolve()},function(e){return d[3]?c.sequence([function(e){return d[9]=c.i64.to_string(d[6]),d[8]=c.i64.to_string(a[1]),c.storedProcedure(b("LSUpdateTaskQueueName"),d[9],d[8])},function(a){return c.storedProcedure(b("LSUpdateTaskValue"),d[8],d[9],d[8])}]):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateThreadAuthorityAndMappingStoredProcedure";e.exports=a}),null);
__d("LSUpdateThreadAuthorityAndMappingWithOTIDFromJID",["LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateThreadAuthorityAndMapping"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.i64.neq(d[0],a[1])?d[1]=d[0]:d[1]=void 0,c.storedProcedure(b("LSUpdateThreadAuthorityAndMapping"),a[0],a[1],d[1])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateThreadAuthorityAndMappingWithOTIDFromJIDStoredProcedure";e.exports=a}),null);
__d("LSVerifyHybridThreadExists",["LSShimVerifyThreadExists.nop","LSVerifyE2EEMetadataThreadExistsV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSVerifyE2EEMetadataThreadExistsV2"),a[2],a[0],c.i64.cast([0,60])).then(function(a){return a=a,d[0]=a[0],a})},function(b){return d[1]=c.i64.of_float(Date.now()),c.i64.neq(a[11],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b,e){var f=b.done;b=b.value;return f?d[4]=!1:(e=b.item,d[7]=e.deviceId,c.i64.neq(d[7],void 0)?d[6]=c.i64.neq(d[7],a[11]):d[6]=!1,d[4]=d[6])})},function(a){return d[2]=d[4]}]):c.resolve(d[2]=!1)},function(e){return d[2]?d[3]=!0:d[3]=a[8],c.nativeOperation(b("LSShimVerifyThreadExists.nop"),a[0],a[1],a[3],a[4],a[5],a[6],a[7])},function(a){return e[0]=c.i64.cast([0,0])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxVerifyHybridThreadExistsStoredProcedure";e.exports=a}),null);/*FB_PKG_DELIM*/
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(a,b,c,d,e,f){"use strict";a=16;b=28;c=16;d=128;f.hChaCha20SubKeyNonceLengthInBytes=a;f.totalNonceLengthInBytes=b;f.aesGcmTagLengthInBytes=c;f.aesGcmTagLength=d}),66);
__d("HChaCha20",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}a.fromHexString=function(a){var b=a.match(/[A-Fa-f0-9]{1,2}/g);if(a.length===0||a.length%2!==0||b==null)throw c("err")('The string "'+a+'" is not valid hex.');return new Uint8Array(b.map(function(a){return parseInt(a,16)}))};a.bufferToUint32Array=function(a){var b=new DataView(a),c=[];a=a.byteLength/4;for(var d=0;d<a;d++)c.push(new DataView(b.buffer.slice(d*4,d*4+4)).getInt32(0));return Uint32Array.from(c)};a.rotate=function(a,b){a=a&4294967295;b=b&31;return(a<<b|a>>>32-b)>>>0};a.quarterRound=function(b,c,d,e){b=b;c=c;d=d;e=e;b=b+c&4294967295;e=a.rotate(e^b,16);d=d+e&4294967295;c=a.rotate(c^d,12);b=b+c&4294967295;e=a.rotate(e^b,8);d=d+e&4294967295;c=a.rotate(c^d,7);return[b>>>0,c>>>0,d>>>0,e>>>0]};var b=a.prototype;b.createHCtx=function(b,d){var e=new Uint32Array(16),f=a.fromHexString("657870616e642033322d62797465206b");if(f.byteLength!==16)throw c("err")("Could not create context. Invalid constant buffer length of "+f.byteLength+". Expected a length of 16");else if(b.byteLength!==32)throw c("err")("Could not create context. Invalid key buffer length of "+b.byteLength+". Expected a length of 32");else if(d.byteLength!==16)throw c("err")("Could not create context. Invalid nonce buffer length of "+d.byteLength+". Expected a length of 16");f=a.bufferToUint32Array(f.buffer);b=a.bufferToUint32Array(b);d=a.bufferToUint32Array(d);e.set(f);e.set(b,f.length);e.set(d,f.length+b.length);return e.buffer};b.hChaCha20Bytes=function(b,c){c=new DataView(this.createHCtx(c,b));b=c.getInt32(0);var d=c.getInt32(1<<2),e=c.getInt32(2<<2),f=c.getInt32(3<<2),g=c.getInt32(4<<2),h=c.getInt32(5<<2),i=c.getInt32(6<<2),j=c.getInt32(7<<2),k=c.getInt32(8<<2),l=c.getInt32(9<<2),m=c.getInt32(10<<2),n=c.getInt32(11<<2),o=c.getInt32(12<<2),p=c.getInt32(13<<2),q=c.getInt32(14<<2);c=c.getInt32(15<<2);for(var r=0;r<10;r++){var s=a.quarterRound(b,g,k,o);b=s[0];g=s[1];k=s[2];o=s[3];s=a.quarterRound(d,h,l,p);d=s[0];h=s[1];l=s[2];p=s[3];s=a.quarterRound(e,i,m,q);e=s[0];i=s[1];m=s[2];q=s[3];s=a.quarterRound(f,j,n,c);f=s[0];j=s[1];n=s[2];c=s[3];s=a.quarterRound(b,h,m,c);b=s[0];h=s[1];m=s[2];c=s[3];s=a.quarterRound(d,i,n,o);d=s[0];i=s[1];n=s[2];o=s[3];s=a.quarterRound(e,j,k,p);e=s[0];j=s[1];k=s[2];p=s[3];s=a.quarterRound(f,g,l,q);f=s[0];g=s[1];l=s[2];q=s[3]}return Uint32Array.from([b,d,e,f,o,p,q,c]).buffer};return a}();g.HChaCha20=a}),98);
__d("LSBase64Decode.nop",["Base64Utils","CryptoLogger","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){a=a.replace(/-/g,"+").replace(/_/g,"/").replace(/\./g,"=").replace("/,/","=");var b=4-a.length%4;if(b<4)for(var c=0;c<b;c++)a+="=";return a}function j(a){var b=d("CryptoLogger").CryptoLogger("base64decode");try{return a!=null?d("Base64Utils").toArrayBuffer(i(a)):void 0}catch(c){if((c==null?void 0:c.message)==null)return;if(c instanceof Error)b.catching(c).mustfix(c.message);else{b.mustfix("Base64decode : empty error message for exception: %s, input string: %s",c.message,(b=a)!=null?b:"undefined")}}}a=function(a,d,e){return(h||(h=b("Promise"))).resolve(c("LSResult")(j(e)))};g["default"]=a}),98);
__d("LSBinaryToHex.nop",["LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d,e){a=Array.from(new Uint8Array(e));d=a.map(function(a){return a.toString(16).padStart(2,"0")});e=d.join("").toUpperCase();return(h||(h=b("Promise"))).resolve(c("LSResult")(e))};g["default"]=a}),98);
__d("LSMaxInt32",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("I64")).of_int32(2147483647);g["default"]=a}),98);
__d("RetUtil",["LSResult"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSResult")(a)}g.getNullableRetResult=a}),98);
__d("LSCreateDerivedKeys.nop",["CryptoLogger","I64","LSMaxInt32","LSVec","Promise","RetUtil","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j,k){var l=d("CryptoLogger").CryptoLogger("create_derived_keys");a=c("LSVec").toArray(k);if(a.length<1||a.some(function(a){return(i||(i=d("I64"))).gt(a,c("LSMaxInt32"))})){l.mustfix("Invalid key lengths for derive keys");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))}var m=a.map((i||(i=d("I64"))).to_int32),n=a.map(i.to_int32).reduce(function(a,b){return a+b},0)*8;return d("XPlatReactCrypto").subtleImportKey("raw",j,"HKDF",!1,["deriveBits"]).then(function(a){var b;return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:f,name:"HKDF",salt:(b=g)!=null?b:new Uint8Array(10).buffer},a,n)}).then(function(a){a=new Uint8Array(a);var b=[],e=0;for(var f=0,g=m.length;f<g;++f){var h=e+m[f];b.push(a.slice(e,h).buffer);e=h}return d("RetUtil").getNullableRetResult(c("LSVec").ofArray(b))})["catch"](function(a){l.catching(a).mustfix("Failed to create derived keys");return d("RetUtil").getNullableRetResult()})};g["default"]=a}),98);
__d("LSCryptoUtils",["FBLogger","XPlatReactTextDecoder","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return new Uint8Array(a)}function h(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();return b.encode(a)}function i(a){var b=new(d("XPlatReactTextDecoder").TextDecoder)();return b.decode(a)}function b(a){return i(new Uint8Array(a))}function e(a){return h(a).buffer}function f(a,b){var d=a.byteLength,e=b.byteLength;if(d!==e)throw c("FBLogger")("ls_web_init").mustfixThrow("Mismatched lengths for modAdd, %d != %d",d,e);var f=new Uint8Array(d);new Uint8Array(d).reduceRight(function(c,d,e){d=a[e];var g=b[e];d=d+g+c;g=d>255?[d-256,1]:[d,0];f[e]=g[0];return g[1]},0);return f}g.bufToUint8=a;g.strToUint8=h;g.uint8ToStr=i;g.bufToStr=b;g.strToBuf=e;g.modAddBytes=f}),98);
__d("LSDeleteBackupOnClient",["LSAppendDataTraceAddon","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] Beginning execution."),d[1]="Beginning deleteBackupOnClient stored procedure",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[1]].join("")),d[2]=c.createArray(),void 0!==void 0?d[9]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[1]].join(""),d[2],c.i64.cast([0,4]))},function(e){return c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1423]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.forEach(c.db.table(168).fetch(),function(a){return a["delete"]()})},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(169).fetch([[[a[0]]],"fk_secure_encrypted_backups_client_state"]),function(a){return a["delete"]()}):c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.db.table(190).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.db.table(174).fetch(),function(a){return a["delete"]()})},function(b){return a[1]==="fetch_virtual_device"?c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,4])}):c.resolve()},function(e){return a[2]?c.sequence([function(a){return d[9]="Clearing backups tables",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[9]].join("")),d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[9]].join(""),d[10],c.i64.cast([0,4]))},function(e){return c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1891]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.forEach(c.db.table(172).fetch([[[c.i64.cast([0,1])]]]),function(a){var b=a.update;a.item;return b({backupId:void 0})})},function(e){return c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1892]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}])},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.filter(c.db.table(184).fetch(),function(b){return c.i64.eq(b.backupId,a[0])}),function(a){return a["delete"]()}):c.forEach(c.db.table(184).fetch(),function(a){return a["delete"]()})},function(e){return c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1893]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}])},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(196).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.forEach(c.db.table(196).fetch(),function(a){return a["delete"]()})}]):c.resolve()},function(e){return a[5]?c.sequence([function(e){return a[5]?c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,84]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}]):a[3]!==void 0?c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,85]),c.i64.cast([0,2]),"The flow did not succeed",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}]):a[4]!==void 0?c.sequence([function(e){return d[10]=["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ","",a[4]].join(""),function(a){c.logger(a).mustfix(a)}(d[10]),d[9]=c.createArray(),a[3]!==void 0?d[11]=(d[9].push(a[3]),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",a[4],d[9],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,85]),c.i64.cast([0,2]),d[10],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[3]!==void 0?c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeleteBackupOnClientStoredProcedure";e.exports=a}),null);
__d("LSPlatformArmadilloUtils",["MAWMICSafe","Promise","cr:6998","cr:7349","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h=b("cr:6998"))!=null?h:b("cr:7349"),k=[];function a(a){k.push(a)}function e(){j==null?void 0:j.completeSync();if(k.length===0){j==null?void 0:j.maybeEndOccamadilloThreadMapping();return}c("promiseDone")((i||(i=b("Promise"))).allSettled(k.map(function(a){return a()})),function(){return j==null?void 0:j.maybeEndOccamadilloThreadMapping()})}function f(){d("MAWMICSafe").markEvent("ls_init_end")}function l(a){d("MAWMICSafe").fail("init_sync_failure",a)}g.executeOnThreadMappingEnd=a;g.occamadilloInitEnd=e;g.reportInitEnd=f;g.reportInitSyncFailure=l}),98);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a<10)return 10-a;var b=Math.floor(Math.log2(a)),c=Math.floor(Math.log2(b))+1;b=b-c;c=(1<<b)-1;b=a+c&(c^-1);return b-a}function i(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=a.byteLength,d=h(c);d=b+c+d;d=new DataView(new ArrayBuffer(d));d.setUint32(0,c);c=new Uint8Array(d.buffer);c.set(new Uint8Array(a),b);return c.buffer}function a(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();b=b.encode(a).buffer;return i(b)}function b(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(a);if(c.byteLength<b)return;var d=a.byteLength;c=c.getUint32(0);d=d-b;if(c>=0&&c<=d)return a.slice(b,b+c)}g.getPaddingLength=h;g.padData=i;g.pad=a;g.stripPadding=b}),98);
__d("LSSymmetricEncryptionCreateDecryptedData.nop",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_data");a=function(a,c,e,f,g){if(g.byteLength<d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes){i.mustfix("cipher text is invalid");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}a=new Uint8Array(g);var j=a.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);c=new(d("HChaCha20").HChaCha20)();var k=a.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;g=c.hChaCha20Bytes(j.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,e);return d("XPlatReactCrypto").subtleImportKey("raw",g,"AES-GCM",!1,["decrypt"]).then(function(a){return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(j.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,k)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);a==null&&i.mustfix("Failed to strip padding for symmetric decryption");return d("RetUtil").getNullableRetResult(a)})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric data decryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.nop",["Base64Utils","CryptoLogger","LSResult","LSSymmetricEncryptionCreateDecryptedData.nop","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return c("LSResult")(a)}a=function(a,b,e,f,g){var i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_string");g=d("Base64Utils").toArrayBuffer(g);return c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,g).then(function(a){a=a[0];return a}).then(function(a){return a==null?h():h(new(d("XPlatReactTextDecoder").TextDecoder)().decode(a))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric string decryption failed");return h()})};g["default"]=a}),98);
__d("UInt8Array",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.length;if(!(b>0&&b%2===0&&/^[\da-f]+$/gi.test(a)))return;var c=[];for(var d=0,b=b/2|0;d<b;++d){var e=parseInt(a.substring(d<<1,(d<<1)+2|0),16);c.push(e)}return new Uint8Array(c)}function b(a){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(a)).buffer}function c(a){a=a.filter(function(a){return a.byteLength!==0});var b=a.reduce(function(a,b){return a+b.byteLength|0},0),c=new Uint8Array(b);a.reduce(function(a,b){c.set(b,a);return a+b.byteLength|0},0);return c}g.fromHexString=a;g.getBufferWithRandomValuesFromLength=b;g.concatBytes=c}),98);/*FB_PKG_DELIM*/
__d("LSFindBackup",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure] Beginning execution."),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?d[1]=void 0:(b=a.item,d[1]=c.i64.to_string(b.backupId))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFindBackupStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFindBackupStoredProcedure";e.exports=a}),null);
__d("LSIssueAttachmentRestoreTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSFlushDataTrace.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] Beginning execution."),a[7]!==void 0?c.resolve(d[1]=a[7]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[26]=!1:(a.item,d[26]=!0)})},function(a){return d[26]?d[28]=c.i64.or_(c.i64.cast([0,82]),c.i64.cast([0,128])):d[28]=c.i64.cast([0,82]),c.sequence([function(a){return c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.sequence([function(a){return d[34]="EncryptedBackups MCD Trace ID",d[35]=c.i64.to_string(d[28]),d[33]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[33],d[34],d[33],d[35]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[30],void 0,void 0,"media_restore",d[28])}])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!0:d[32]=!1,d[32]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()},function(a){return d[29]=d[30]}])},function(a){return d[1]=d[29]}])},function(a){return c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,1829]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20])],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],f):(e=a.item,c.sequence([function(a){return d[31]=e.backupTenancy,d[30]=e.encryptionVersion,d[26]=void 0,c.i64.neq(d[26],void 0)?c.resolve(d[27]=d[26]):c.sequence([function(a){return d[32]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[42]=(d[32].push(c.i64.cast([0,0])),d[32]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[42]=(d[32].push(c.i64.cast([0,2])),d[32]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[42]=(d[32].push(c.i64.cast([0,3])),d[32]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[42]=(d[32].push(c.i64.cast([0,4])),d[32]):0,d[37]=c.createArray(),d[38]=c.i64.of_int32(d[32].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(a){return d[42]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[32],d[42]).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[45]=(d[37].push(d[43]),d[37])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[42]=c.createArray(),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[45]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[45]).then(function(a){return a=a,d[46]=a[0],d[47]=a[1],a})},function(a){return d[48]=(d[42].push(c.i64.to_string(d[46])),d[42])}])}):c.resolve()},function(a){return d[44]=d[42].join(","),d[39]=d[44]}])},function(a){return d[37].some(function(a){return c.i64.eq(d[30],a)})?d[40]=d[30]:d[40]=void 0,c.i64.neq(d[40],void 0)?d[41]=d[40]:d[41]=void 0,d[27]=d[41]}])},function(a){return c.i64.neq(d[27],void 0)?d[28]=d[27]:d[28]=c.i64.cast([0,0]),c.i64.neq(d[31],void 0)?d[29]=d[31]:d[29]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[28],d[29],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],a}]))})},function(a){return c.storedProcedure(b("LSFindBackup")).then(function(a){return a=a,d[19]=a[0],a})},function(e){return c.blobs.neq(d[5],void 0)?c.i64.neq(d[3],void 0)?d[19]!==void 0?c.blobs.neq(d[4],void 0)?c.sequence([function(e){return d[26]=c.createArray(),d[33]=(d[26].push(d[19]),d[26]),d[33]=(d[26].push(a[1]),d[26]),d[27]=c.toJSON(d[26]),d[28]=c.createArray(),d[33]=(d[28].push(c.i64.cast([0,32])),d[28]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[29],void 0,d[4],d[28]).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!1:d[31]=!0,d[31]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[33],c.i64.cast([0,3]))},function(a){return d[32]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[30],c.i64.cast([0,0])).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(a){return d[32]=d[33]}])},function(e){return c.blobs.neq(d[32],void 0)?c.sequence([function(e){return c.i64.neq(a[9],void 0)?d[33]=a[9]:d[33]=c.i64.cast([-1,4294967295]),c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[32],d[35],c.i64.cast([0,16])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[27]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[38]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[19]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(e){return d[58]=new c.Map(),d[58].set("attachment_index_key",d[41]==null?"":d[41]),d[58].set("backup_ent_fbid",a[0]),d[58].set("delivery_object_id",a[1]),d[58].set("device_id",d[3]),d[58].set("mailbox_partial_id",d[45]==null?"":d[45]),d[58].set("media_type",a[3]),d[58].set("message_partial_id",d[49]==null?"":d[49]),d[58].set("product_type",a[2]),d[58].set("salt_partial_id",d[53]==null?"":d[53]),d[58].set("sort_key",d[37]==null?"":d[37]),d[58].set("thread_partial_id",d[57]==null?"":d[57]),d[58].set("trace_id",d[1]),d[58].set("source",d[33]),d[59]=new c.Map(),d[59].set("otid",a[4]),d[59].set("server_thread_key",a[8]),d[59].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[60]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[61]=a[0],a})},function(e){return d[62]=new c.Map(),d[62].set("ocmf_client_state_blob",d[60]==null?"":d[60]),d[62].set("mailbox_root_key",d[61]==null?"":d[61]),d[63]=c.createArray(),d[75]=(d[63].push(a[4]),d[63]),d[75]=(d[63].push(a[1]),d[63]),d[64]=c.toJSON(d[63]),d[58].set("raw_identifiers",d[59]),d[58].set("backup_id",d[19]),d[58].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[64]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[66]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[67]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return d[58].set("salt_partial_access_token",d[68]==null?"":d[68]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[27]).then(function(a){return a=a,d[69]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[69]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[70]).then(function(a){return a=a,d[71]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return d[58].set("salt_partial_attachment_index_key",d[72]==null?"":d[72]),d[58].set("raw_tokens",d[62]),d[73]=c.toJSON(d[58]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_attachment_restore",c.i64.cast([0,50020]),d[73],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),d[1],c.i64.cast([0,0])).then(function(a){return a=a,d[74]=a[0],a})}]):(d[33]="OPE key is null for IssueAttachmentRestoreTask",d[33]!==void 0?c.sequence([function(a){return d[35]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[33]].join(""),function(a){c.logger(a).mustfix(a)}(d[35]),d[34]=c.createArray(),d[1]!==void 0?d[36]=(d[34].push(d[1]),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[33],d[34],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[35],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[39]=!0:d[39]=!1,d[39]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[40]=c.createArray(),void 0!==void 0?d[41]=(d[40].push(void 0),d[40]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[40],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[37]=!0:d[37]=!1,d[37]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[38]=c.createArray(),void 0!==void 0?d[39]=(d[38].push(void 0),d[38]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[38],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[37]=!0:d[37]=!1,d[37]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[38]=c.createArray(),void 0!==void 0?d[39]=(d[38].push(void 0),d[38]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[38],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[35]=!0:d[35]=!1,d[35]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[36]=c.createArray(),void 0!==void 0?d[37]=(d[36].push(void 0),d[36]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[36],c.i64.cast([0,3]))):c.resolve()}]))}]):(d[26]="Missing mailbox_root_key for IssueAttachmentRestoreTask",d[26]!==void 0?c.sequence([function(a){return d[28]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[26]].join(""),function(a){c.logger(a).mustfix(a)}(d[28]),d[27]=c.createArray(),d[1]!==void 0?d[29]=(d[27].push(d[1]),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[26],d[27],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[28],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!0:d[32]=!1,d[32]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}])):(d[26]="Missing backup_id for IssueAttachmentRestoreTask",d[26]!==void 0?c.sequence([function(a){return d[28]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[26]].join(""),function(a){c.logger(a).mustfix(a)}(d[28]),d[27]=c.createArray(),d[1]!==void 0?d[29]=(d[27].push(d[1]),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[26],d[27],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[28],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!0:d[32]=!1,d[32]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}])):(d[26]="Missing device_id for IssueAttachmentRestoreTask",d[26]!==void 0?c.sequence([function(a){return d[28]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[26]].join(""),function(a){c.logger(a).mustfix(a)}(d[28]),d[27]=c.createArray(),d[1]!==void 0?d[29]=(d[27].push(d[1]),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[26],d[27],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[28],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!0:d[32]=!1,d[32]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}])):(d[26]="Missing ocmf_client_state_blob for IssueAttachmentRestoreTask",d[26]!==void 0?c.sequence([function(a){return d[28]=["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[26]].join(""),function(a){c.logger(a).mustfix(a)}(d[28]),d[27]=c.createArray(),d[1]!==void 0?d[29]=(d[27].push(d[1]),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[26],d[27],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),d[28],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!0:d[32]=!1,d[32]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[1]!==void 0?c.sequence([function(a){return d[1]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[1],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[1]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}]))},function(a){return d[20]=c.i64.of_float(Date.now()),d[21]=c.i64.random(),d[23]="Finishing execution. Execution time: ",d[24]=c.i64.to_string(c.i64.sub(d[20],d[0])),d[25]=" ms",d[22]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ",d[22],d[23],d[22],d[24],d[22],d[25]].join("")),c.i64.eq(c.i64.mod_(d[21],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[26]=",",d[27]=c.createArray(),void 0!==void 0?d[28]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",[d[23],d[26],d[24],d[26],d[25]].join(""),d[27],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure";e.exports=a}),null);
__d("LSIssueAttachmentRestoreTaskStoredProcedure",["LSIssueAttachmentRestoreTask","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.backupEntFbid;d[1]=b.deliveryObjectId;d[2]=b.productType;d[3]=b.mediaType;d[4]=b.messageId;d[5]=b.threadId;d[6]=b.sortOrder;d[7]=b.traceId;d[8]=b.serverThreadKey;d[9]=b.source;return c("LSIssueAttachmentRestoreTask").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MAWBridgeResignAttachmentCDNUrlHandler",["I64","LSFactory","LSIssueAttachmentRestoreTaskStoredProcedure","MAWMiActOnMiThreadReadyForJid","Promise","QPLUserFlow","WAHashStringToNumber","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="-8";function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeResignAttachmentCDNUrlHandler",function(a,f){var g=j;if(g==null)return(i||(i=b("Promise"))).resolve();g=(h||(h=d("I64"))).of_string(g);f=h.to_string(f);var k=e.traceId;g={backupEntFbid:g,deliveryObjectId:e.deliveryObjectId,mediaType:e.mediaType,messageId:e.messageId,productType:e.productType,serverThreadKey:f,sortOrder:h.of_float(e.sortOrder),threadId:e.threadId};if(k!=null){f=d("WAHashStringToNumber").hashStringToNumber(k);c("QPLUserFlow").addPoint(c("qpl")._(521485815,"2166"),"issue_attachment_task",{instanceKey:f});return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(a),babelHelpers["extends"]({},g,{traceId:k}))}else return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(a),g)})}g.call=a}),98);/*FB_PKG_DELIM*/
__d("BizKitScopingContext",["emptyFunction","react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({assets:[],globalScope:null,setAssets:c("emptyFunction"),setGlobalScope:c("emptyFunction")});g["default"]=b}),98);
__d("BusinessAssetTypeEnum.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["ADS_EVENT_SOURCE","ADVANCED_ANALYTICS_INSTANCE","AD_ACCOUNT","AD_ACCOUNT_CREATION_REQUEST","AD_DRAFT_WORKSPACE","AD_IMAGE","AD_STUDY","APP","BANK","BLOCK_LIST","BRAND","BUSINESS_CREATIVE_ASSET","BUSINESS_CREATIVE_FOLDER","BUSINESS_FRANCHISE_CONFIG","BUSINESS_IMAGE","BUSINESS_LOCATIONS_WRAPPER","BUSINESS_LOYALTY_PROGRAM","BUSINESS_PAYOUT_ACCOUNT","BUSINESS_PERSON","BUSINESS_REQUEST","BUSINESS_RESOURCE_GROUP","BUSINESS_UNIT","BUSINESS_VIDEO","CAIPT_ASSET","CLOUD_PLAYABLE_ASSET","CONTENT_BLOCK_LIST","CREATOR_MARKETPLACE_BRAND_PROFILE","CREATOR_SELLER_PROFILE","CREDENTIAL_SHARE_REQUEST","CREDIT_CARD","CREDIT_PARTITION","CREDIT_PARTITION_CONFIG","CUSTOM_AUDIENCE","CUSTOM_CONVERSION","DYNAMIC_CONTENT_SET","EVENTS_DATASET","EVENTS_DATASET_NEW","EVENT_SOURCE_GROUP","EXAMPLE_CAT","FINANCE","FUNDING_SOURCE","GRP_PLAN","HOTEL_PRICE_FETCHER_PULL_CONFIG","INSTAGRAM_ACCOUNT","INSTAGRAM_ACCOUNT_V2","INSTAGRAM_BUSINESS_ASSET","IP","LEADS_ACCESS","LEGACY_LOGIN","LEGAL_ENTITY","MESSAGING_DATASET","MONETIZATION_PROPERTY","MV4B_BILLABLE_ACCOUNT","NEWS_PAGE","NME_BUSINESS_SUBSCRIPTION_ASSET","OFFLINE_CONVERSION_DATA_SET","OFFSITE_EMAIL_ACCOUNT","OWNED_DOMAIN","PAGE","PAGE_FOR_LOCATIONS","PAYOUT_ACCOUNT","PHOTO","PIXEL","PLACE_PAGE_SET","PLATFORM_CUSTOM_AUDIENCE","PRODUCT_CATALOG","PROFILE_PLUS","PROJECT","PUBLISHER_WHITE_LIST","RECEIPT","REGISTERED_TRADEMARK","RESELLER_VETTING_OE_REQUEST","SAVED_AUDIENCE","SELLER_PROFILE","SIGNALS_EVENT_NAME","SIGNAL_SEGMENT","SLICED_EVENT_SOURCE_GROUP","SPACO_DS_DATA_COLLECTION","SYSTEM_USER","UNKNOWN","USER","VIDEO_ASSET","WHATSAPP_BUSINESS_ACCOUNT"]);c=a;f["default"]=c}),66);
__d("LSDatabaseProviderType",[],(function(a,b,c,d,e,f){"use strict";function a(a){return g(a.persistenceTypes)}function g(a){return a.includes("indexeddb")}f.isProviderPersisted=a;f.hasPersistentType=g}),66);
__d("LSGetBlobFromInt64BE.nop",["I64","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f){var g=new Uint8Array(8);g.reduceRight(function(a,b,c){b=(i||(i=d("I64"))).to_int32(i.mod_(a,i.of_string("256")));g[c]=b;return i.div(a,i.of_string("256"))},f);return(h||(h=b("Promise"))).resolve(c("LSResult")(g.buffer))};g["default"]=a}),98);
__d("OrderPreservingEncryption",["FBLogger","LSCryptoUtils","Promise","UInt8Array","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer}function i(a){var b=a.length;return b%2!==0?"0"+a:a}function j(a){a=BigInt(a);var b=i(a.toString(16));a=b.length;a=a/2;var c=[];for(var d=0;d<a;++d)c.push(d*2);return new Uint8Array(c.map(function(a){var c=a+2;return b.slice(a,c)}).map(function(a){return parseInt(a,16)}))}function k(a){a=a.map(function(a){return a._0});return{_0:d("UInt8Array").concatBytes(a)}}function l(a){return"OPE key has length "+String(a)+", expected  "+String(32)}function m(a,b,c){return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey","deriveBits"]).then(function(a){var e=new ArrayBuffer(0);return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:b.buffer,name:"HKDF",salt:e},a,c*8)}).then(function(a){return{_0:d("LSCryptoUtils").bufToUint8(a)}})}function n(a,b){return{_0:d("LSCryptoUtils").modAddBytes(a._0,b)}}function o(a,e,f,g){var i=f.byteLength;if(i!==32)throw c("FBLogger")("labyrinth_web").mustfixThrow(l(i));var j=g.byteLength,o=function(a,b){var c=new Uint8Array(1+j),d=new Uint8Array(j-b).fill(0);c.set([b]);c.set(a.subarray(0,b),1);c.set(d,b+1);return c};if(j>=255)throw c("FBLogger")("labyrinth_web").mustfixThrow("Input is too large");return(h||(h=b("Promise"))).all(Array.from(g).map(function(b,c){c=o(g,c);var e=new Uint8Array(a);e[a-1]=b;b=d("LSCryptoUtils").bufToUint8(f);return m(b,c,a).then(function(a){return n(a,e)})})).then(function(a){return d("UInt8Array").concatBytes([new Uint8Array([e]),k(a)._0])})}function e(a,b,c,d){d=j(d);return o(a,b,c,d)}g.keyGen=a;g.intStringToBEBytes=j;g.buildKeyLengthErrorMsg=l;g.encryptBigEndianBytes=o;g.encryptIntString=e}),98);
__d("LSOpeEncrypt.nop",["CryptoLogger","I64","LSResult","OrderPreservingEncryption","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j){var k=d("CryptoLogger").CryptoLogger("ope_encrypt");return d("OrderPreservingEncryption").encryptBigEndianBytes((i||(i=d("I64"))).to_int32(j),1,f,new Uint8Array(g)).then(function(a){return(h||(h=b("Promise"))).resolve(c("LSResult")(a.buffer))})["catch"](function(a){d("CryptoLogger").captureError(k,a).mustfix("OpeEncrypt_impl failed");throw a})};g["default"]=a}),98);
__d("LSTruncateSortKey.nop",["CryptoLogger","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("truncate_sort_key");a=function(a,d,e){if(e.byteLength!==8)throw i.mustfixThrow("Bad length on sort key for truncation");a=new Uint8Array(e);d=a.subarray(0,2);if(d.some(function(a){return a!==0}))throw i.mustfixThrow("Bad prefix on sort key for truncation");return(h||(h=b("Promise"))).resolve(c("LSResult")(e.slice(2)))};g["default"]=a}),98);
__d("RTWebCometIncomingUnsupportedDialogNameQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7125909224150321"}),null);
__d("RTWebCometIncomingUnsupportedDialogNameQuery$Parameters",["RTWebCometIncomingUnsupportedDialogNameQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("RTWebCometIncomingUnsupportedDialogNameQuery_facebookRelayOperation"),metadata:{},name:"RTWebCometIncomingUnsupportedDialogNameQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("RTWebCometIncomingUnsupportedDialog.entrypoint",["JSResourceForInteraction","RTWebCometIncomingUnsupportedDialogNameQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){a=a.id;return{queries:{queryReference:{parameters:b("RTWebCometIncomingUnsupportedDialogNameQuery$Parameters"),variables:{id:a}}}}},root:c("JSResourceForInteraction")("RTWebCometIncomingUnsupportedDialog.react").__setRef("RTWebCometIncomingUnsupportedDialog.entrypoint")};g["default"]=a}),98);
__d("RTWebDropInUtils",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h="drop_in_metadata";a=function(a){var b;return b={},b[h]=JSON.stringify({is_drop_in:a?"1":"0"}),b};b=function(a){a=i(a);a=a.isDropIn;return a};var i=function(a){a=a==null?void 0:a[h];if(a!=null)try{a=JSON.parse(a);return{isDropIn:a.is_drop_in==="1"}}catch(a){c("FBLogger")("rtc_www").catching(a).warn("Failed to parse drop_in_metadata app message");return{isDropIn:!1}}return{isDropIn:!1}};g.getDropInAppMessages=a;g.isDropInFromAppMessages=b}),98);
__d("RTWebUnsupportedUpsellDialogWrapper.react",["CometPlaceholder.react","RTWebCometIncomingUnsupportedDialog.entrypoint","RelayHooks","react","useCometRelayEntrypointContextualEnvironmentProvider"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=a.inviterID,e=a.onClose;a=a.threadType;var f=c("useCometRelayEntrypointContextualEnvironmentProvider")();f=d("RelayHooks").loadEntryPoint(f,c("RTWebCometIncomingUnsupportedDialog.entrypoint"),{id:b});return i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(d("RelayHooks").EntryPointContainer,{entryPointReference:f,props:{onClose:e,threadType:a}})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("XCometGamingVanityControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/gaming/{vanity}/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("chunkArray",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=[],d=0;while(a.length>d)c.push(a.slice(d,d+b)),d+=b;return c}f["default"]=a}),66);
__d("getAssetsByType",[],(function(a,b,c,d,e,f){"use strict";function a(a){return{adAccount:a.filter(function(a){return a.type==="AD_ACCOUNT"}),appAccount:a.filter(function(a){return a.type==="APP"}),igAccount:a.filter(function(a){return a.type==="INSTAGRAM_ACCOUNT_V2"}),pageAccount:a.filter(function(a){return a.type==="PAGE"}),wabAccount:a.filter(function(a){return a.type==="WHATSAPP_BUSINESS_ACCOUNT"})}}f["default"]=a}),66);
__d("getFirstAssetOfType",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.find(function(a){return a.type===b})}f["default"]=a}),66);
__d("personalGlobalScope",["CurrentUser"],(function(a,b,c,d,e,f,g){"use strict";a={id:c("CurrentUser").getAccountID(),type:"PERSONAL"};g.personalGlobalScope=a}),98);
__d("useBizKitSelectedAssets",["BizKitScopingContext","getAssetsByType","getFirstAssetOfType","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useContext;function a(){var a=i(c("BizKitScopingContext")),b=a.assets,d=a.setAssets;a=(a=(a=c("getFirstAssetOfType")(b,"PAGE"))!=null?a:b[0])!=null?a:null;return{assetID:a==null?void 0:a.id,assets:b,assetsByType:c("getAssetsByType")(b),assetType:a==null?void 0:a.type,setAssets:d,setSelectedLinkedAsset:function(a){d(a.assets)}}}g["default"]=a}),98);
__d("useGlobalScope",["BizKitScopingContext","personalGlobalScope","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useContext;function a(){var a=i(c("BizKitScopingContext"));a=a.globalScope;return(a=a)!=null?a:d("personalGlobalScope").personalGlobalScope}g["default"]=a}),98);
__d("useMWChatOpenTabCount",["MWChatStateContext","MWChatStateV2TabGroups","useMWChatStateV2MaxTabCount","useMWIsTopLevelRouteMediaViewerExperiment"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MWChatStateContext").useChatState(function(a){return[a.tabs,a.focusedTabId,a.mediaViewerOpenWatermark]}),b=a[0],e=a[1];a=a[2];var f=c("useMWIsTopLevelRouteMediaViewerExperiment")(),g=c("useMWChatStateV2MaxTabCount")(f);f=f?a:void 0;a=d("MWChatStateV2TabGroups").getTabGroups(f,b,e,g);f=a.openTabs;return f.length}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("EncryptedBackupsDYIFileUtils",["FBLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h="media";f="messages.zip";function i(){if(navigator.storage!=null&&navigator.storage.getDirectory!=null)return navigator.storage.getDirectory();throw c("FBLogger")("labyrinth_web").mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.")}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield i());return a.getDirectoryHandle(h,{create:!0})});return j.apply(this,arguments)}function d(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){a=(yield a.getFileHandle(b,{create:!0}));try{b=(yield a.createSyncAccessHandle());b.write(d);b.flush();b.close()}catch(e){if(e instanceof Error){if(e instanceof TypeError)try{b=(yield a.createWritable());yield b.write(d);yield b.close();return}catch(a){if(a instanceof Error){if(a instanceof TypeError)throw c("FBLogger")("labyrinth_web").mustfixThrow("Write operation is not supported. Please try one of the supported browsers.");throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to write using writable: %e",a.message)}throw a}throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to write using sync access handle: %s",e.message)}throw e}});return k.apply(this,arguments)}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.getFileHandle(b));try{var d=(yield a.createSyncAccessHandle()),e=new ArrayBuffer(d.getSize());d.read(e);d.close();return new Blob([e])}catch(d){if(d instanceof Error){if(d instanceof TypeError)return a.getFile();throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to read file %s, %s",b,d.message)}throw d}});return l.apply(this,arguments)}g.DyiMediaFolder=h;g.DyiArchiveFilename=f;g.getRootFolderHandle=i;g.getMediaFolderHandle=a;g.writeFile=d;g.readFile=e}),98);
__d("LSIssuePointQueryRestoreTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Beginning execution."),c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,2512]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])},function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Point query restore v2 is enabled"),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return d[9]=new c.Map(),d[9].set("error_code",c.i64.cast([0,1])),d[9].set("error_message",""),d[9].set("stored_procedure","issuePointQueryRestoreTask"),d[10]=new c.Map(),d[10].set("act_thread_id",a[0]),d[11]=new c.Map(),d[11].set("restore_context",d[10]),d[11].set("failure",d[9]),d[12]=d[11].get("restore_context"),d[11],d[13]=d[11].get("success"),d[11],d[13]!==void 0?(d[19]=d[13].get("message_id"),d[13],d[14]=d[19]):d[14]="",d[15]=d[12].get("act_thread_id"),d[12],d[16]=":",d[17]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",d[16],d[15],d[16],d[14]].join(""),c.i64.cast([0,50035]),d[17],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[1]=d[18]}]):(f=e.item,c.sequence([function(a){return d[16]=f.deviceId,d[15]=f.backupTenancy,d[14]=f.encryptionVersion,d[9]=void 0,c.i64.neq(d[9],void 0)?c.resolve(d[10]=d[9]):c.sequence([function(a){return d[17]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[27]=(d[17].push(c.i64.cast([0,0])),d[17]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[27]=(d[17].push(c.i64.cast([0,2])),d[17]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[27]=(d[17].push(c.i64.cast([0,3])),d[17]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[27]=(d[17].push(c.i64.cast([0,4])),d[17]):0,d[22]=c.createArray(),d[23]=c.i64.of_int32(d[17].length),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(a){return d[27]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[17],d[27]).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],a})},function(a){return d[30]=(d[22].push(d[28]),d[22])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[27]=c.createArray(),d[28]=c.i64.of_int32(d[22].length),c.i64.gt(d[28],c.i64.cast([0,0]))?c.loopAsync(d[28],function(a){return d[30]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[22],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return d[33]=(d[27].push(c.i64.to_string(d[31])),d[27])}])}):c.resolve()},function(a){return d[29]=d[27].join(","),d[24]=d[29]}])},function(a){return d[22].some(function(a){return c.i64.eq(d[14],a)})?d[25]=d[14]:d[25]=void 0,c.i64.neq(d[25],void 0)?d[26]=d[25]:d[26]=void 0,d[10]=d[26]}])},function(e){return c.i64.neq(d[10],void 0)?d[11]=d[10]:d[11]=c.i64.cast([0,0]),c.i64.neq(d[15],void 0)?d[12]=d[15]:d[12]=c.i64.cast([0,1]),c.i64.neq(d[16],void 0)?c.sequence([function(e){return d[17]=new c.Map(),d[17].set("act_thread_id",a[0]),d[17].set("request_id",a[3]),d[17].set("tam_thread_subtype",c.i64.cast([0,0])),d[17].set("source",a[4]),c.nativeOperation(b("LSBase64Encode.nop"),f.ocmfClientStateBlob).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.mailboxRootKeyBlob).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[20]=new c.Map(),d[20].set("ocmf_client_state_blob",d[18]==null?"":d[18]),d[20].set("mailbox_root_key",d[19]==null?"":d[19]),d[21]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[36]=(d[21].push(a.epochId),d[21])})},function(a){return d[34]="Queried locally available epochs. Count: ",d[22]=c.i64.of_int32(d[21].length),d[35]=c.i64.to_string(d[22]),d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[23],d[34],d[23],d[35]].join("")),c.resolve()},function(e){return d[24]=new c.Map(),d[24].set("device_id",d[16]),d[24].set("raw_tokens",d[20]),d[24].set("locally_available_epochs",d[21]),d[25]=new c.Map(),d[25].set("reference_timestamp",a[2]),d[25].set("device_context",d[24]),d[25].set("message_id",a[1]),d[26]=new c.Map(),d[26].set("restore_context",d[17]),d[26].set("success",d[25]),d[27]=d[26].get("restore_context"),d[26],d[28]=d[26].get("success"),d[26],d[28]!==void 0?(d[36]=d[28].get("message_id"),d[28],d[29]=d[36]):d[29]="",d[30]=d[27].get("act_thread_id"),d[27],d[31]=":",d[32]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",d[31],d[30],d[31],d[29]].join(""),c.i64.cast([0,50035]),d[32],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[13]=d[33]}]):c.sequence([function(e){return d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,1])),d[17].set("error_message",""),d[17].set("stored_procedure","issuePointQueryRestoreTask"),d[18]=new c.Map(),d[18].set("act_thread_id",a[0]),d[19]=new c.Map(),d[19].set("restore_context",d[18]),d[19].set("failure",d[17]),d[20]=d[19].get("restore_context"),d[19],d[21]=d[19].get("success"),d[19],d[21]!==void 0?(d[27]=d[21].get("message_id"),d[21],d[22]=d[27]):d[22]="",d[23]=d[20].get("act_thread_id"),d[20],d[24]=":",d[25]=c.toJSON(d[19]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),["encrypted_backups_restore",d[24],d[23],d[24],d[22]].join(""),c.i64.cast([0,50035]),d[25],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[13]=d[26]}])},function(a){return d[1]=d[13]}]))})},function(e){return c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,2513]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure";e.exports=a}),null);
__d("WellbeingGenericFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("255");b=d("FalcoLoggerInternal").create("wellbeing_generic",a);e=b;g["default"]=e}),98);/*FB_PKG_DELIM*/
__d("MAWHandleXmaTransactionUtil",["MAWBridgeXMA","MAWDbChunkTxns","MAWDexieCastToPromise","MAWIndexedDb","MAWTransactionMode","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=!1;a!=null&&b.defaultPreviewMediaId===a.mediaId&&(c=(yield l(a)));return d("MAWBridgeXMA").createBridgeXMA(a,b,c)});return h.apply(this,arguments)}function c(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield j(a,b,c));d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:a})});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=!1;a!=null&&(e=(yield d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbChunkTxns").hasMediaChunk(c,a.hashedPlaintextHash))));return d("MAWBridgeXMA").createBridgeXMA(a,b,e)});return k.apply(this,arguments)}var l=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"MAWHandleXmaTransactionUtil.hasMediaChunkTransaction",function(a){return function(b){return d("MAWDbChunkTxns").hasMediaChunk(a,b.hashedPlaintextHash)}});g.checkMediaChunkTransactionAndCreatedBridgeXma=a;g.checkMediaChunkAndHandleXmaAfterTransaction=c;g.checkMediaChunkAndCreatedBridgeXma=j}),98);
__d("WAGetPlatformFromStanzaId",["I64","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse stanza id "," for platform: ",""]);i=function(){return a};return a}function a(a){try{var b=(h||(h=d("I64"))).of_float(4063232),c=h.of_float(0),e=h.of_float(131072);b=h.and_(h.of_string(a),b);if((h||(h=d("I64"))).equal(b,c))return"web";return(h||(h=d("I64"))).equal(b,e)?"mobile":"unknown"}catch(b){d("WALogger").ERROR(i(),a,b);return"error"}}g.getPlatformFromStanzaId=a}),98);/*FB_PKG_DELIM*/
__d("MAWEBUploadMessageUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["echoOverrideMessageSortOrder called without ID"]);l=function(){return a};return a}function a(a){var b=a.revokedExternalId!=null?a.revokedExternalId:a.externalId;b==null&&d("WALogger").ERROR(l());b=(h||(h=d("I64"))).of_string_opt(b);if(a.serverTs==null){if(a.sortOrderMs!=null)return a.sortOrderMs;b==null&&d("WALogger").WARN(k());var c=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return d("MAWDbMsg").getCanonicalTsFromMsg(a)*1e3+((c=c)!=null?c:0)}if(b!=null){c=d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);if(c!=null){b=a.originalTs!=null?a.originalTs:a.serverTs;return Number(b)*1e3+c}else d("WALogger").WARN(j())}else d("WALogger").WARN(i());return d("MAWDbMsg").getSortOrderWithFallback(a)}g.echoOverrideMessageSortOrder=a}),98);
__d("WAGroupInviteUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.toInviteCode=a}),66);
__d("WorkerUtils",[],(function(a,b,c,d,e,f){"use strict";function b(){try{return"WorkerGlobalScope"in a&&a instanceof a.WorkerGlobalScope}catch(a){return!1}}function c(){try{return"SharedWorkerGlobalScope"in a&&a instanceof a.SharedWorkerGlobalScope}catch(a){return!1}}f.isWorkerContext=b;f.isSharedWorkerContext=c}),66);/*FB_PKG_DELIM*/
__d("CometGroupAboutRootQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7768856596503445"}),null);
__d("CometGroupAboutRootQuery$Parameters",["CometGroupAboutRootQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("CometGroupAboutRootQuery_facebookRelayOperation"),metadata:{},name:"CometGroupAboutRootQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("CometGroupAboutRoot.entrypoint",["CometGroupAboutRootQuery$Parameters","JSResourceForInteraction","WebPixelRatio","buildGroupCometRootRoute.entrypoint"],(function(a,b,c,d,e,f,g){"use strict";a=c("buildGroupCometRootRoute.entrypoint")(c("JSResourceForInteraction")("CometGroupAboutRoot.react").__setRef("CometGroupAboutRoot.entrypoint"),function(a){a=a.routeProps;a=a.groupID;return{queries:{aboutQueryReference:{parameters:b("CometGroupAboutRootQuery$Parameters"),variables:{groupID:a,scale:d("WebPixelRatio").get()}}}}});g["default"]=a}),98);
__d("WAPushSafeTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeNotNullable=a}),66);